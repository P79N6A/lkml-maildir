Date: Thu, 15 Jan 2009 08:29:04 +0100
From: Peter Zijlstra <>
Subject: Re: 2.6.28 has unconfigurable group sched?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/15/49

On Wed, 2009-01-14 at 06:46 -0800, Mark Glines wrote:
> Peter Zijlstra wrote:
> >> So it seems rt_schedulable() is never succeeding.  Any ideas?
> > 
> > Yeah, I should test this user grouping stuff more often :/
> > 
> > The below fixes it for me.
> > ---
> > Subject: sched: fix bandwidth validation for UID grouping 
> > 
> > For UID grouping we initialize the root group with infinite bandwidth
> > which by default is actually more than the global limit, therefore the
> > bandwidth check always fails.
> > 
> > Because the root group is a phantom group (for UID grouping) we cannot
> > runtime adjust it, therefore we let it reflect the global bandwidth
> > settings.
> 
> 
> Thanks.  Sadly, this doesn't seem to change anything for me.  I applied
> it to 2.6.28, rebuilt and reinstalled, and got the same result.  I did a
> clean rebuild to be sure; and got the same behavior again.
> 
> Please let me know if there are any additional diagnostics I can provide.
Most strange, I did the patch on .28 just to be sure (my initial testing
was done on -linus since I couldn't remember it having changed in a
while), and it still works for me.
CONFIG_GROUP_SCHED=y
CONFIG_FAIR_GROUP_SCHED=y
CONFIG_RT_GROUP_SCHED=y
CONFIG_USER_SCHED=y
# CONFIG_CGROUP_SCHED is not set
Linux opteron 2.6.28 #634 SMP PREEMPT Wed Jan 14 18:13:31 CET 2009
x86_64 x86_64 x86_64 GNU/Linux
# echo 450000 > /sys/kernel/uids/0/cpu_rt_runtime 
# cat /sys/kernel/uids/0/cpu_rt_runtime
450000