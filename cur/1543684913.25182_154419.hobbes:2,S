Date: Tue, 5 Aug 2003 02:28:10 +0200 (MET DST)
From: Bartlomiej Zolnierkiewicz <>
Subject: Re: IDE locking problem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/4/267

On 3 Aug 2003, Benjamin Herrenschmidt wrote:
> And there's more to it... ide_unregister() doesn't copy hwif->hold from
> old to new hwif causing my hotswap bay to lose it's iops on next plug,
> it doesn't call unregister_device() for neither hwif->gendev nor
> drive[n]->gendev, causing the device model list to be corrupted after
> an unregister, ...
What is a goal of calling init_hwif_data() in ide_unregister()?
I guess it is used mainly to clear hwif->io_ports and hwif->irq.
Therefore even if you are using hwif->hold flag io_ports will be set to
default values, so how do you later find your hwif?
Hmmm... what about not copying anything and calling init_hwif_data()
only if !hwif->hold?
--
Bartlomiej
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/