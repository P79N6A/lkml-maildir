Date: Fri, 2 Dec 2005 15:18:49 +0800
From: Wu Fengguang <>
Subject: Re: [PATCH 02/12] mm: supporting variables and functions for balanced zone aging
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/2/9

On Thu, Dec 01, 2005 at 09:49:31PM -0800, Andrew Morton wrote:
> From: Andrew Morton <akpm@osdl.org>
> 
> Revert a patch which went into 2.6.8-rc1.  The changelog for that patch was:
> 
>   The shrink_zone() logic can, under some circumstances, cause far too many
>   pages to be reclaimed.  Say, we're scanning at high priority and suddenly
>   hit a large number of reclaimable pages on the LRU.
> 
>   Change things so we bale out when SWAP_CLUSTER_MAX pages have been
>   reclaimed.
> 
> Problem is, this change caused significant imbalance in inter-zone scan
> balancing by truncating scans of larger zones.
> 
> Suppose, for example, ZONE_HIGHMEM is 10x the size of ZONE_NORMAL.  The zone
> balancing algorithm would require that if we're scanning 100 pages of
> ZONE_HIGHMEM, we should scan 10 pages of ZONE_NORMAL.  But this logic will
> cause the scanning of ZONE_HIGHMEM to bale out after only 32 pages are
> reclaimed.  Thus effectively causing smaller zones to be scanned relatively
> harder than large ones.
> 
> Now I need to remember what the workload was which caused me to write this
> patch originally, then fix it up in a different way...
Maybe it's a situation like this:
__|____|________|________________|________________________________|________________________________________________________________|________________________________________________________________________________________________________________________________|________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        _: pinned chunk
        -: reclaimable chunk
        |: shrink_zone() invocation
        
First we run into a large range of pinned chunks, which lowered the scan
priority.  And then there are plenty of reclaimable chunks, bomb...
Thanks,
Wu
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/