Date: Thu, 13 Mar 2008 11:25:28 +0000 (GMT)
From: Hugh Dickins <>
Subject: Re: [PATCH 0/2] lockdep vs recursive read locks
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/13/128

On Wed, 12 Mar 2008, Peter Zijlstra wrote:
> We seemed to have some lockdep trouble wrt recursive read locks. Today Gautham
> asked me some specific questions about it, which led to these patches.
> 
> IIRC Hugh ran into something similar a while back. This hopefully fixes it.
Hmm, I don't remember that myself: can you jog my memory?
What I do remember is that when I fixed madvise(MADV_REMOVE i.e. holepunch)
not to hold mmap_sem (at that time down_write but today down_read, though
would still be bad) across vmtruncate_range which takes i_mutex (contrast
writing from an unfaulted area that takes i_mutex then down_read mmap_sem),
Ingo asked me offline if lockdep caught that and it didn't.  Just tried
again now, with your patches applied, and madvise_remove restored to its
old misbehaviour, and it looks like lockdep still doesn't catch it
(but suspect me of pilot error if you find otherwise).
Hugh