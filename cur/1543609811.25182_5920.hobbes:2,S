Date: Wed, 14 Nov 2001 15:26:56 -0800
From: Paul Mundt <>
Subject: [PATCH] fb_mmap() holding BKL
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/11/14/182

Hello,
Just a minor cleanup.. in the event of some sanity checking in fb_mmap(), the
BKL is accidentally held on a return.. this trivial patch fixes this issue.
(Against 2.4.14).
Please apply.
Regards,
-- 
Paul Mundt <pmundt@mvista.com>
MontaVista Software, Inc.
--- linux/drivers/video/fbmem.c.orig	Wed Nov 14 15:17:40 2001
+++ linux/drivers/video/fbmem.c	Wed Nov 14 15:17:50 2001
@@ -563,8 +563,10 @@
 		/* memory mapped io */
 		off -= len;
 		fb->fb_get_var(&var, PROC_CONSOLE(info), info);
-		if (var.accel_flags)
+		if (var.accel_flags) {
+			unlock_kernel();
 			return -EINVAL;
+		}
 		start = fix.mmio_start;
 		len = PAGE_ALIGN((start & ~PAGE_MASK)+fix.mmio_len);
 	}[unhandled content-type:application/pgp-signature]