Date: Mon, 13 Sep 1999 10:19:27 -0700
From: "Tom Livingston" <>
Subject: IDE + SMP Lockup (no OOPS) in 2.2.12, 2.2.10
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/9/13/100

Hello,
I'm running into a problem running an SMP box with heavy ide disk access.
If the I/O subsystem is stressed, you can lock the machine up in seconds.
If it's not stressed it can stay up for hours, but will always crash.
My system:  Abit BP-6 dual 366 celerons, 128MB PC100 RAM, redhat 6.0, 12 ide
disks attached (to primary PIIX4 and three PCI PDC20246's... note, I am NOT
using the onboard HPT-366), 3com 3c905b 100mbit ethernet
I have two other very similar systems, both Abit BP-6 dual celeron 366,
128MB RAM,  3c905b's, redhat 6.0, 2.12.12 but using Tekram 390F controllers
and UW SCSI disks + raid, and they are both 100% stable.
But for the ide system:
Using 2.2.12 + raid0145-19990824-2.2.11 + 2.2.12.uniform-ide-6.20.hydra,
with SMP enabled:
#!/bin/sh
for i in 1 2 3 4 5
do
  for i in hdb1 hdc1 hde1 hdg1 hdi1
    do
      dd if=/dev/$i of=/dev/null count=500000 &
    done
    dd if=/dev/hdk1 of=/dev/null count=500000
done
[root@music /root]# ./crashme.sh
[machine locks up quickly, responds to nothing, requires hard reset]
Using a vanilla 2.2.12 kernel, with SMP enabled (note only first two PDC
controllers are active in this configuration) - the same crashme.sh script
locks up the computer just as quickly, no messages.
Using 2.2.12 + raid0145-19990824-2.2.11 + 2.2.12.uniform-ide-6.20.hydra with
SMP disabled -or- 2.2.12 with no patches and SMP disabled results in no
crashes, the system will not crash.
Using 2.2.10 with or without raid & ide patches results in the same lockup
if SMP is enabled, but worked for weeks of heavy use when SMP was disabled.
Using 2.2.6 + raid0145-19990421-2.2.6 + 2.2.7.uniform-ide-6.19 with SMP
enabled passes the test over and over with flying colors, and no lockups in
2+ months of service (though it does not work with the last promise
controller either)
Thanks for your time!
Attached is a boot log from the 2.2.12 vanilla kernel:
Sep 13 09:05:46 music syslogd 1.3-3: restart.
Sep 13 09:05:46 music syslog: syslogd startup succeeded
Sep 13 09:05:46 music kernel: klogd 1.3-3, log source = /proc/kmsg started.
Sep 13 09:05:46 music kernel: Inspecting /boot/System.map
Sep 13 09:05:46 music syslog: klogd startup succeeded
Sep 13 09:05:46 music kernel: Loaded 5217 symbols from /boot/System.map.
Sep 13 09:05:46 music kernel: Symbols match kernel version 2.2.12.
Sep 13 09:05:46 music kernel: No module symbols loaded.
Sep 13 09:05:46 music kernel: Linux version 2.2.12 (root@music.volition.org)
(gcc version
 egcs-2.91.66 19990314/Linux (egcs-1.1.2 release)) #1 SMP Mon Sep 13
08:51:46 PDT 1999
Sep 13 09:05:46 music kernel: Intel MultiProcessor Specification v1.1
Sep 13 09:05:46 music kernel:     Virtual Wire compatibility mode.
Sep 13 09:05:46 music kernel: OEM ID: OEM00000 Product ID: PROD00000000 APIC
at: 0xFEE000
00
Sep 13 09:05:46 music kernel: Processor #0 Pentium(tm) Pro APIC version 17
Sep 13 09:05:46 music kernel: Processor #1 Pentium(tm) Pro APIC version 17
Sep 13 09:05:46 music kernel: I/O APIC #2 Version 17 at 0xFEC00000.
Sep 13 09:05:46 music kernel: Processors: 2
Sep 13 09:05:46 music kernel: mapped APIC to ffffe000 (fee00000)
Sep 13 09:05:46 music kernel: mapped IOAPIC to ffffd000 (fec00000)
Sep 13 09:05:46 music kernel: Detected 367518013 Hz processor.
Sep 13 09:05:46 music kernel: Console: colour VGA+ 80x25
Sep 13 09:05:46 music kernel: Calibrating delay loop... 367.00 BogoMIPS
Sep 13 09:05:46 music kernel: Memory: 128060k/131072k available (972k kernel
code, 420k r
eserved, 1556k data, 64k init)
Sep 13 09:05:46 music kernel: Checking 386/387 coupling... OK, FPU using
exception 16 err
or reporting.
Sep 13 09:05:46 music kernel: Checking 'hlt' instruction... OK.
Sep 13 09:05:46 music kernel: POSIX conformance testing by UNIFIX
Sep 13 09:05:46 music kernel: per-CPU timeslice cutoff: 25.03 usecs.
Sep 13 09:05:46 music kernel: CPU0: Intel Celeron (Mendocino) stepping 05
Sep 13 09:05:46 music kernel: calibrating APIC timer ...
Sep 13 09:05:46 music kernel: ..... CPU clock speed is 367.5025 MHz.
Sep 13 09:05:46 music kernel: ..... system bus clock speed is 66.8185 MHz.
Sep 13 09:05:46 music kernel: Booting processor 1 eip 2000
Sep 13 09:05:46 music kernel: Calibrating delay loop... 367.00 BogoMIPS
Sep 13 09:05:46 music kernel: OK.
Sep 13 09:05:46 music kernel: CPU1: Intel Celeron (Mendocino) stepping 05
Sep 13 09:05:46 music kernel: Total of 2 processors activated (734.00
BogoMIPS).
Sep 13 09:05:46 music kernel: enabling symmetric IO mode... ...done.
Sep 13 09:05:46 music kernel: ENABLING IO-APIC IRQs
Sep 13 09:05:46 music kernel: init IO_APIC IRQs
Sep 13 09:05:46 music kernel:  IO-APIC pin 0, 5, 7, 10, 11, 20, 21, 22, 23
not connected.
Sep 13 09:05:46 music kernel: number of MP IRQ sources: 16.
Sep 13 09:05:46 music kernel: number of IO-APIC registers: 24.
Sep 13 09:05:46 music kernel: testing the IO APIC.......................
Sep 13 09:05:46 music kernel: .... register #00: 02000000
Sep 13 09:05:46 music kernel: .......    : physical APIC id: 02
Sep 13 09:05:46 music kernel: .... register #01: 00170011
Sep 13 09:05:46 music kernel: .......     : max redirection entries: 0017
Sep 13 09:05:46 music kernel: .......     : IO APIC version: 0011
Sep 13 09:05:46 music kernel: .... register #02: 00000000
Sep 13 09:05:46 music kernel: .......     : arbitration: 00
Sep 13 09:05:46 music kernel: .... IRQ redirection table:
Sep 13 09:05:47 music atd: atd startup succeeded
Sep 13 09:05:46 music kernel:  NR Log Phy Mask Trig IRR Pol Stat Dest Deli
Vect:
Sep 13 09:05:46 music kernel:  00 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  01 000 00  0    0    0   0   0    1    1
59
Sep 13 09:05:46 music kernel:  02 0FF 0F  0    0    0   0   0    1    1
51
Sep 13 09:05:46 music kernel:  03 000 00  0    0    0   0   0    1    1
61
Sep 13 09:05:46 music kernel:  04 000 00  0    0    0   0   0    1    1
69
Sep 13 09:05:46 music kernel:  05 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  06 000 00  0    0    0   0   0    1    1
71
Sep 13 09:05:46 music kernel:  07 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  08 000 00  0    0    0   0   0    1    1
79
Sep 13 09:05:46 music kernel:  09 000 00  0    0    0   0   0    1    1
81
Sep 13 09:05:46 music kernel:  0a 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  0b 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:47 music crond: crond startup succeeded
Sep 13 09:05:46 music kernel:  0c 000 00  0    0    0   0   0    1    1
89
Sep 13 09:05:46 music kernel:  0d 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  0e 000 00  0    0    0   0   0    1    1
91
Sep 13 09:05:46 music kernel:  0f 000 00  0    0    0   0   0    1    1
99
Sep 13 09:05:46 music kernel:  10 0FF 0F  1    1    0   1   0    1    1
A1
Sep 13 09:05:46 music kernel:  11 0FF 0F  1    1    0   1   0    1    1
A9
Sep 13 09:05:46 music kernel:  12 0FF 0F  1    1    0   1   0    1    1
B1
Sep 13 09:05:46 music kernel:  13 0FF 0F  1    1    0   1   0    1    1
B9
Sep 13 09:05:46 music kernel:  14 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  15 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  16 000 00  1    0    0   0   0    0    0
00
Sep 13 09:05:46 music kernel:  17 000 00  1    0    0   0   0    0    0
00
Sep 13 02:05:40 music rc.sysinit: Loading default keymap succeeded
Sep 13 02:05:40 music rc.sysinit: Setting default font succeeded
Sep 13 02:05:40 music swapon: swapon: warning: /dev/hda5 has insecure
permissions 0660, 0
600 suggested
Sep 13 02:05:40 music swapon: swapon: warning: /dev/hda6 has insecure
permissions 0660, 0
600 suggested
Sep 13 02:05:40 music rc.sysinit: Activating swap partitions succeeded
Sep 13 02:05:40 music rc.sysinit: Setting hostname music.volition.org
succeeded
Sep 13 02:05:40 music fsck: /dev/hda7: clean, 88550/514000 files,
1864522/2048001 blocks
Sep 13 02:05:40 music rc.sysinit: Checking root filesystem succeeded
Sep 13 02:05:40 music rc.sysinit: Remounting root filesystem in read-write
mode succeeded
Sep 13 02:05:40 music depmod: can't open /lib/modules/2.2.12/modules.dep
Sep 13 02:05:40 music rc.sysinit: Finding module dependencies failed
Sep 13 02:05:40 music fsck: /dev/hda1: clean, 62/52208 files, 28756/208813
blocks
Sep 13 09:05:46 music kernel: .................................... done.
Sep 13 09:05:46 music kernel: PCI: PCI BIOS revision 2.10 entry at 0xfb420
Sep 13 09:05:46 music kernel: PCI: Using configuration type 1
Sep 13 09:05:46 music kernel: PCI: Probing PCI hardware
Sep 13 09:05:46 music kernel: Linux NET4.0 for Linux 2.2
Sep 13 09:05:46 music kernel: Based upon Swansea University Computer Society
NET3.039
Sep 13 09:05:46 music kernel: NET4: Unix domain sockets 1.0 for Linux
NET4.0.
Sep 13 09:05:46 music kernel: NET4: Linux TCP/IP 1.0 for NET4.0
Sep 13 02:05:40 music rc.sysinit: Checking filesystems succeeded
Sep 13 02:05:41 music rc.sysinit: Mounting local filesystems succeeded
Sep 13 02:05:41 music rc.sysinit: Turning on user and group quotas for local
filesystems
succeeded
Sep 13 09:05:43 music date: Mon Sep 13 09:05:43 PDT 1999
Sep 13 09:05:43 music rc.sysinit: Setting clock : Mon Sep 13 09:05:43 PDT
1999 succeeded
Sep 13 09:05:43 music rc.sysinit: Enabling swap space succeeded
Sep 13 09:05:43 music init: Entering runlevel: 3
Sep 13 09:05:45 music network: Bringing up interface lo succeeded
Sep 13 09:05:45 music network: Bringing up interface eth0 succeeded
Sep 13 09:05:46 music portmap: portmap startup succeeded
Sep 13 09:05:46 music random: Initializing random number generator succeeded
Sep 13 09:05:47 music inet: inetd startup succeeded
Sep 13 09:05:46 music kernel: IP Protocols: ICMP, UDP, TCP
Sep 13 09:05:46 music kernel: Starting kswapd v 1.5
Sep 13 09:05:46 music kernel: Detected PS/2 Mouse Port.
Sep 13 09:05:46 music kernel: Serial driver version 4.27 with no serial
options enabled
Sep 13 09:05:46 music kernel: pty: 256 Unix98 ptys configured
Sep 13 09:05:46 music kernel: PIIX4: IDE controller on PCI bus 00 dev 39
Sep 13 09:05:46 music kernel: PIIX4: not 100% native mode: will probe irqs
later
Sep 13 09:05:46 music kernel:     ide0: BM-DMA at 0xf000-0xf007, BIOS
settings: hda:DMA,
hdb:DMA
Sep 13 09:05:46 music kernel:     ide1: BM-DMA at 0xf008-0xf00f, BIOS
settings: hdc:DMA,
hdd:DMA
Sep 13 09:05:46 music kernel: PDC20246: IDE controller on PCI bus 00 dev 58
Sep 13 09:05:46 music kernel: PDC20246: not 100% native mode: will probe
irqs later
Sep 13 09:05:46 music kernel: PDC20246: ROM enabled at 0xe6000000
Sep 13 09:05:46 music kernel:     ide2: BM-DMA at 0xa400-0xa407, BIOS
settings: hde:DMA,
hdf:DMA
Sep 13 09:05:48 music named[324]: starting.  named 8.2 Wed Mar 31 10:57:12
EST 1999 ^Iroo
t@porky.devel.redhat.com:/usr/src/bs/BUILD/bind-8.2/src/bin/named
Sep 13 09:05:48 music named[324]: cache zone "" (IN) loaded (serial 0)
Sep 13 09:05:48 music named[324]: Zone "0.0.127.in-addr.arpa" (file
named.local): No defa
ult TTL set using SOA minimum instead
Sep 13 09:05:48 music named[324]: master zone "0.0.127.in-addr.arpa" (IN)
loaded (serial
1997022700)
Sep 13 09:05:48 music named[324]: listening on [127.0.0.1].53 (lo)
Sep 13 09:05:48 music named[324]: listening on [10.10.10.199].53 (eth0)
Sep 13 09:05:48 music named[324]: Forwarding source address is
[0.0.0.0].1024
Sep 13 09:05:46 music kernel:     ide3: BM-DMA at 0xa408-0xa40f, BIOS
settings: hdg:DMA,
hdh:DMA
Sep 13 09:05:46 music kernel: PDC20246: IDE controller on PCI bus 00 dev 68
Sep 13 09:05:46 music kernel: PDC20246: not 100% native mode: will probe
irqs later
Sep 13 09:05:46 music kernel: PDC20246: ROM enabled at 0xe7000000
Sep 13 09:05:46 music kernel:     ide4: BM-DMA at 0xb800-0xb807, BIOS
settings: hdi:DMA,
hdj:pio
Sep 13 09:05:46 music kernel:     ide5: BM-DMA at 0xb808-0xb80f, BIOS
settings: hdk:DMA,
hdl:pio
Sep 13 09:05:46 music kernel: PDC20246: IDE controller on PCI bus 00 dev 78
Sep 13 09:05:46 music kernel: PDC20246: not 100% native mode: will probe
irqs later
Sep 13 09:05:46 music kernel: PDC20246: ROM enabled at 0xe8000000
Sep 13 09:05:46 music kernel: PDC20246: too many IDE interfaces, no room in
table
Sep 13 09:05:46 music kernel: PDC20246: too many IDE interfaces, no room in
table
Sep 13 09:05:46 music kernel: hda: QUANTUM FIREBALL ST4.3A, ATA DISK drive
Sep 13 09:05:46 music kernel: hdb: Maxtor 90845D4, ATA DISK drive
Sep 13 09:05:48 music named: named startup succeeded
Sep 13 09:05:48 music named[325]: Ready to answer queries.
Sep 13 09:05:46 music kernel: hdc: Maxtor 90845D4, ATA DISK drive
Sep 13 09:05:46 music kernel: hdd: Maxtor 90845D4, ATA DISK drive
Sep 13 09:05:46 music kernel: hde: Maxtor 90845D4, ATA DISK drive
Sep 13 09:05:46 music kernel: hdf: Maxtor 90840D6, ATA DISK drive
Sep 13 09:05:46 music kernel: hdg: Maxtor 90840D5, ATA DISK drive
Sep 13 09:05:46 music kernel: hdi: Maxtor 90840D6, ATA DISK drive
Sep 13 09:05:46 music kernel: hdk: Maxtor 90845D4, ATA DISK drive
Sep 13 09:05:46 music kernel: ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
Sep 13 09:05:46 music kernel: ide1 at 0x170-0x177,0x376 on irq 15
Sep 13 09:05:46 music kernel: ide2 at 0x9400-0x9407,0x9806 on irq 11
Sep 13 09:05:46 music kernel: ide3 at 0x9c00-0x9c07,0xa006 on irq 11
Sep 13 09:05:46 music kernel: ide4 at 0xa800-0xa807,0xac06 on irq 7
Sep 13 09:05:46 music kernel: ide5 at 0xb000-0xb007,0xb406 on irq 7
Sep 13 09:05:46 music kernel: hda: QUANTUM FIREBALL ST4.3A, 4110MB w/81kB
Cache, CHS=524/
255/63, UDMA
Sep 13 09:05:48 music keytable: Loading keymap:
Sep 13 09:05:46 music kernel: hdb: Maxtor 90845D4, 8063MB w/256kB Cache,
CHS=16383/16/63,
 UDMA
Sep 13 09:05:46 music kernel: hdc: Maxtor 90845D4, 8063MB w/256kB Cache,
CHS=16383/16/63,
 UDMA
Sep 13 09:05:46 music kernel: hdd: Maxtor 90845D4, 8063MB w/256kB Cache,
CHS=16383/16/63,
 UDMA
Sep 13 09:05:46 music kernel: hde: Maxtor 90845D4, 8063MB w/256kB Cache,
CHS=16383/16/63,
 UDMA
Sep 13 09:05:46 music kernel: hdf: Maxtor 90840D6, 8010MB w/256kB Cache,
CHS=16276/16/63,
 UDMA
Sep 13 09:05:46 music kernel: hdg: Maxtor 90840D5, 8047MB w/256kB Cache,
CHS=16351/16/63,
 UDMA
Sep 13 09:05:46 music kernel: hdi: Maxtor 90840D6, 8010MB w/256kB Cache,
CHS=16276/16/63,
 UDMA
Sep 13 09:05:46 music kernel: hdk: Maxtor 90845D4, 8063MB w/256kB Cache,
CHS=16383/16/63,
 UDMA
Sep 13 09:05:46 music kernel: Floppy drive(s): fd0 is 1.44M
Sep 13 09:05:46 music kernel: FDC 0 is a post-1991 82077
Sep 13 09:05:46 music kernel: scsi : 0 hosts.
Sep 13 09:05:46 music kernel: scsi : detected total.
Sep 13 09:05:46 music kernel: 3c59x.c:v0.99H 11/17/98 Donald Becker
http://cesdis.gsfc.na
sa.gov/linux/drivers/vortex.html
Sep 13 09:05:49 music keytable: Loading
/usr/lib/kbd/keymaps/i386/qwerty/us.kmap.gz
Sep 13 09:05:46 music kernel: eth0: 3Com 3c905 Boomerang 100baseTx at
0xd000,  00:60:08:b
0:2e:3c, IRQ 10
Sep 13 09:05:46 music kernel:   8K word-wide RAM 3:5 Rx:Tx split,
autoselect/MII interfac
e.
Sep 13 09:05:46 music kernel:   MII transceiver found at address 24, status
786f.
Sep 13 09:05:46 music kernel:   Enabling bus-master transmits and
whole-frame receives.
Sep 13 09:05:46 music kernel: Partition check:
Sep 13 09:05:46 music kernel:  hda: hda1 hda2 < hda5 hda6 hda7 >
Sep 13 09:05:46 music kernel:  hdb: hdb1
Sep 13 09:05:46 music kernel:  hdc: hdc1
Sep 13 09:05:46 music kernel:  hdd: hdd1
Sep 13 09:05:46 music kernel:  hde: hde1
Sep 13 09:05:46 music kernel:  hdf: hdf1
Sep 13 09:05:46 music kernel:  hdg: hdg1
Sep 13 09:05:46 music kernel:  hdi: hdi1
Sep 13 09:05:46 music kernel:  hdk: hdk1
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/