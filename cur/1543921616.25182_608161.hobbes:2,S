Date: Mon, 22 Oct 2007 17:07:54 +0400
From: Alexey Starikovskiy <>
Subject: Re: latest 2.6.23 git missing ACPI POWER_SUPPLY
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/22/145

Frans Pop wrote:
> Jeff Chua wrote:
>> Just pulled latest linux-2.6, and couldn't get ACPI to detect
>> ACPI_BATTERY and ACPI_AC.
>>
>> It seems ACPI POWER_SUPPLY is still missing.
> 
> I had the same problem. It turns out you need to enable
>    drivers -> Power supply class support
> (either built in or as module) to get ACPI AC/Battery support.
> 
> I must say that having these relatively top-level ACPI settings depending on something that is relatively buried away is not very intuitive!
> Especially not since at first glance you don't really seem to need that option except for some weird hardware.
> 
> CC'ing ACPI mailing list for other opinions.
I was thinking that 'select' might be more appropriate here...
Please take a look on attached patch.
> -
> To unsubscribe from this list: send the line "unsubscribe linux-acpi" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  
http://vger.kernel.org/majordomo-info.html
> 
ACPI: use select POWER_SUPPLY for AC, BATTERY and SBS
From: Alexey Starikovskiy <astarikovskiy@suse.de>
POWER_SUPPLY is needed for AC, battery, and SBS sysfs support.
Use 'select' instead of 'depends on', as it is will not be selected
by anything else, leading to confusion.
Signed-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>
---
 drivers/acpi/Kconfig |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)
diff --git a/drivers/acpi/Kconfig b/drivers/acpi/Kconfig
index 5d0e26a..ecd87d7 100644
--- a/drivers/acpi/Kconfig
+++ b/drivers/acpi/Kconfig
@@ -88,7 +88,8 @@ config ACPI_PROC_EVENT
 
 config ACPI_AC
 	tristate "AC Adapter"
-	depends on X86 && POWER_SUPPLY
+	depends on X86
+	select POWER_SUPPLY
 	default y
 	help
 	  This driver adds support for the AC Adapter object, which indicates
@@ -97,7 +98,8 @@ config ACPI_AC
 
 config ACPI_BATTERY
 	tristate "Battery"
-	depends on X86 && POWER_SUPPLY
+	depends on X86
+	select POWER_SUPPLY
 	default y
 	help
 	  This driver adds support for battery information through
@@ -352,7 +354,7 @@ config ACPI_HOTPLUG_MEMORY
 config ACPI_SBS
 	tristate "Smart Battery System"
 	depends on X86
-	depends on POWER_SUPPLY
+	select POWER_SUPPLY
 	help
 	  This driver adds support for the Smart Battery System, another
 	  type of access to battery information, found on some laptops.