Date: Tue, 8 Oct 2002 20:30:10 +0200 (CEST)
From: Peter Osterlund <>
Subject: Re: [linux-usb-devel] 2.5.40 panic in uhci-hcd
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/8/181

On Tue, 8 Oct 2002, Greg KH wrote:
> On Tue, Oct 08, 2002 at 08:01:34PM +0200, Peter Osterlund wrote:
> > On Tue, 8 Oct 2002, Greg KH wrote:
> > 
> > > On Sun, Oct 06, 2002 at 02:03:49PM +0200, Peter Osterlund wrote:
> > > > Sometimes when booting 2.5.40 and my Freecom USB-IDE controller (CDRW)
> > > > is connected, the kernel panics when trying to initialize the usb
> > > > subsystem. It happens right after the RH73 boot scripts print out:
> > > > 
> > > >         Initializing USB controller (uhci-hcd):  [  OK  ]
> > > > 
> > > > In 2.5.39, this happened every time I tried to boot, but in 2.5.40 it
> > > > seems to happen about 20% of the time.
> > > 
> > > Hey, we're getting better :)
> > > 
> > > How does 2.5.41 work for you?
> > 
> > It seems to be fixed. Thanks.
> 
> Heh, that's pretty funny.  There were not any uhci specific fixes in
> 2.5.41...
> 
> Not complaining,
Actually, there were. This patch is in 2.5.41.
diff -Nru a/drivers/usb/host/uhci-hcd.c b/drivers/usb/host/uhci-hcd.c
--- a/drivers/usb/host/uhci-hcd.c       Mon Oct  7 11:25:38 2002
+++ b/drivers/usb/host/uhci-hcd.c       Mon Oct  7 11:25:38 2002
@@ -2149,14 +2149,14 @@
        uhci->fl->dma_handle = dma_handle;
 
        uhci->td_pool = pci_pool_create("uhci_td", hcd->pdev,
-               sizeof(struct uhci_td), 16, 0, GFP_ATOMIC);
+               sizeof(struct uhci_td), 16, 0);
        if (!uhci->td_pool) {
                err("unable to create td pci_pool");
                goto err_create_td_pool;
        }
 
        uhci->qh_pool = pci_pool_create("uhci_qh", hcd->pdev,
-               sizeof(struct uhci_qh), 16, 0, GFP_ATOMIC);
+               sizeof(struct uhci_qh), 16, 0);
        if (!uhci->qh_pool) {
                err("unable to create qh pci_pool");
                goto err_create_qh_pool;
-- 
Peter Osterlund - petero2@telia.com
http://w1.894.telia.com/~u89404340
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/