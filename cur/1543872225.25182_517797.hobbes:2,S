Date: Thu, 8 Mar 2007 21:22:08 -0500
From: Mathieu Desnoyers <>
Subject: Re: [PATCH] Fix atomicity of TIF update in flush_thread() for x86_64
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/8/475

* David Miller (davem@davemloft.net) wrote:
> From: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
> Date: Thu, 8 Mar 2007 21:15:53 -0500
> 
> > Fix atomicity of TIF update in flush_thread() for x86_64
> > 
> > Race :
> > 
> > parent process executing :
> > sys_ptrace()
> >  (lock_kernel())
> >  (ptrace_get_task_struct(pid))
> >  arch_ptrace()
> >    ptrace_detach()
> >      ptrace_disable(child);
> >        clear_singlestep(child);
> >          clear_tsk_thread_flag(child, TIF_SINGLESTEP);
> >          (which clears the TIF_SINGLESTEP flag atomically from a different
> > 	  process)
> >  (put_task_struct(child))
> >  (unlock_kernel())
> > 
> > And at the same time, in the child process :
> > sys_execve()
> >  do_execve()
> >    search_binary_handler()
> >      load_elf_binary()
> >        flush_old_exec()
> >          flush_thread()
> >            doing a non-atomic thread flag update 
> > 
> > It applies on 2.6.20.
> > 
> > Signed-off-by: Rebecca Schultz <rschultz@google.com>
> > Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
> 
> Please fix all platforms, not just your favorite one, kthx.
> :-)
Please be comprehensive of the speed at which fingers can type on my
keyboard. Your quickness at replying to email is impressive though ;)
I am working on it, it won't take long.
Regards,
Mathieu
-- 
Mathieu Desnoyers
Computer Engineering Ph.D. Student, Ecole Polytechnique de Montreal
OpenPGP key fingerprint: 8CD5 52C3 8E3C 4140 715F  BA06 3F25 A8FE 3BAE 9A68
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/