Date: Sat, 2 Aug 2003 01:53:24 -0400
From: Diffie <>
Subject: Re: Badness in device_release at drivers/base/core.c:84
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/2/11

On Fri, Aug 01, 2003 at 02:44:55PM -0700, Andrew Morton wrote:
> 
> This patch should fix the oops.
> 
> As for why the proc reading code was unable to locate the HBA: dunno, but
> this is a first step.
> 
> Or maybe you don't have any adaptec controllers in the machine?
> 
> (jejb, please apply..)
> 
> 
>  25-akpm/drivers/scsi/aic7xxx_old/aic7xxx_proc.c |    2 +-
>  1 files changed, 1 insertion(+), 1 deletion(-)
> 
> diff -puN drivers/scsi/aic7xxx_old/aic7xxx_proc.c~aic7xxx_old-oops-fix drivers/scsi/aic7xxx_old/aic7xxx_proc.c
> --- 25/drivers/scsi/aic7xxx_old/aic7xxx_proc.c~aic7xxx_old-oops-fix	Fri Aug  1 14:41:14 2003
> +++ 25-akpm/drivers/scsi/aic7xxx_old/aic7xxx_proc.c	Fri Aug  1 14:41:20 2003
> @@ -92,7 +92,7 @@ aic7xxx_proc_info ( struct Scsi_Host *HB
> 
>    HBAptr = NULL;
> 
> -  for(p=first_aic7xxx; p->host != HBAptr; p=p->next)
> +  for(p=first_aic7xxx; p && p->host != HBAptr; p=p->next)
>      ;
> 
>    if (!p)
> 
> _
> 
>
Andrew,
I will test the patch shortly :). I do have Adaptec AHA-2940U2W
controller installed in my machine, 
http://www.blazebox.homeip.net:81/diffie/images/comp/amd_box8.png.
From dmesg:
(scsi0) <Adaptec AHA-294X Ultra2 SCSI host adapter> found at PCI 1/10/0
(scsi0) Wide Channel, SCSI ID=7, 32/255 SCBs
(scsi0) Downloading sequencer code... 398 instructions downloaded
scsi0 : Adaptec AHA274x/284x/294x (EISA/VLB/PCI-Fast SCSI) 5.2.6/5.2.0
       <Adaptec AHA-294X Ultra2 SCSI host adapter>
sda: Spinning up disk......<5>Attached scsi disk sda at scsi0, channel 0, id 3, lun 0
(scsi0:0:6:0) Synchronous at 80.0 Mbyte/sec, offset 63.
SCSI device sdb: 71687340 512-byte hdwr sectors (36704 MB)
SCSI device sdb: drive cache: write back
 /dev/scsi/host0/bus0/target6/lun0: p1 p2 p3 p4 < p5 p6 p7 p8 p9 p10 >
From lspci:
01:0a.0 SCSI storage controller: Adaptec AHA-2940U2/U2W
Regards,
Paul
[unhandled content-type:application/pgp-signature]