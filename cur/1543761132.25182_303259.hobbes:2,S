Date: Tue, 15 Mar 2005 16:51:01 -0600
From: Linas Vepstas <>
Subject: Re: [PATCH 1/6] PCI Express Advanced Error Reporting Driver
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/3/15/314

Hi,
On Fri, Mar 11, 2005 at 04:12:18PM -0800, long was heard to remark:
> +void hw_aer_unregister(void)
> +{
> +	struct pci_dev *dev = (struct pci_dev*)host->dev;
> +	unsigned short id;
> +
> +	id = (dev->bus->number << 8) | dev->devfn;
> +	
> +	/* Unregister with AER Root driver */
> +	pcie_aer_unregister(id);
> +}
I don't understand how this can work on a system with 
more than one domain.  On any midrange/high-end system, 
you'll have a number of devices with identical values
for (bus->number << 8) | devfn)
For example, on my system, lspci prints out:
mosquito:~ # lspci
0000:00:01.0 Co-processor: IBM: Unknown device 00e0 (rev 01)
0000:00:03.0 ISA bridge: Symphony Labs W83C553 (rev 10)
0001:00:02.0 PCI bridge: IBM: Unknown device 0188 (rev 02)
0001:00:02.2 PCI bridge: IBM: Unknown device 0188 (rev 02)
0001:00:02.3 PCI bridge: IBM: Unknown device 0188 (rev 02)
0001:00:02.4 PCI bridge: IBM: Unknown device 0188 (rev 02)
0001:00:02.6 PCI bridge: IBM: Unknown device 0188 (rev 02)
0001:01:01.0 SCSI storage controller: LSI Logic / Symbios Logic 53c1010
66MHz  Ultra3 SCSI Adapter (rev 01)
0001:01:01.1 SCSI storage controller: LSI Logic / Symbios Logic 53c1010
66MHz  Ultra3 SCSI Adapter (rev 01)
0001:21:01.0 Ethernet controller: Intel Corp. 82557/8/9 [Ethernet Pro
100] (rev 0d)
0002:00:02.0 PCI bridge: IBM: Unknown device 0188 (rev 02)
0002:00:02.2 PCI bridge: IBM: Unknown device 0188 (rev 02)
0002:00:02.4 PCI bridge: IBM: Unknown device 0188 (rev 02)
0002:00:02.6 PCI bridge: IBM: Unknown device 0188 (rev 02)
Here, 'Unknown device' is actually an empty slot.
If I plugged the ethernet card in a few slots over, it would 
show up as
0002:01:01.0 Ethernet controller: Intel Corp. 82557/8/9 [Ethernet Pro
and so it would have the exact same (bus->number << 8) | devfn)
as the scsi device.
Or am I being stupid/dense/all-of-the-above?
--linas
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/