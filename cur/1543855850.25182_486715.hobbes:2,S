Date: Thu, 30 Nov 2006 01:26:00 +0100
From: "Udo A. Steinberg" <>
Subject: Re: Linux 2.6.19
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/11/29/302

On Wed, 29 Nov 2006 14:21:21 -0800 (PST) Linus Torvalds (LT) wrote:
LT> So go get it. It's one of those rare "perfect" kernels. So if it doesn't 
LT> happen to compile with your config (or it does compile, but then does 
LT> unspeakable acts of perversion with your pet dachshund), you can rest easy 
LT> knowing that it's all your own d*mn fault, and you should just fix your 
LT> evil ways.
Ok, so 2.6.18 used to get along fine with cryptoloop and 2.6.19 refuses to
cooperate. An strace of "losetup -e aes /dev/loop0 /dev/hda7" without all the
terminal interaction shows:
open("/dev/hda7", O_RDWR|O_LARGEFILE)   = 3
open("/dev/loop0", O_RDWR|O_LARGEFILE)  = 4
mlockall(MCL_CURRENT|MCL_FUTURE)        = 0
...
munmap(0xb7fc8000, 4096)                = 0
ioctl(4, 0x4c00, 0x3)                   = 0
close(3)                                = 0
ioctl(4, 0x4c04, 0xbfc21670)            = -1 ENOENT (No such file or directory)
ioctl(4, 0x4c02, 0xbfc215e0)            = -1 ENOENT (No such file or directory)
dup(2)                                  = 3
fcntl64(3, F_GETFL)                     = 0x8002 (flags O_RDWR|O_LARGEFILE)
fstat64(3, {st_mode=S_IFCHR|0720, st_rdev=makedev(4, 1), ...}) = 0
ioctl(3, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig icanon echo ...}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7fc8000
_llseek(3, 0, 0xbfc21040, SEEK_CUR)     = -1 ESPIPE (Illegal seek)
write(3, "ioctl: LOOP_SET_STATUS: No such "..., 50ioctl: LOOP_SET_STATUS: No such file or directory) = 50
close(3)                                = 0
munmap(0xb7fc8000, 4096)                = 0
ioctl(4, 0x4c01, 0)                     = 0
close(4)                                = 0
exit_group(1)                           = ?
Linux 2.6.18 does not fail at
	ioctl(4, 0x4c04, ...)
I know that dm-crypt is now the preferred method of doing such things, but as
long as cryptoloop exists in the kernel I'd expect it to work.
Cheers,
	- Udo
[unhandled content-type:application/pgp-signature]