Date: Tue, 13 Apr 1999 02:29:15 +0200 (CEST)
From: Wieger Opmeer <>
Subject: Re: Alpha and xntpd...
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/4/13/11

On Wed, 7 Apr 1999, Tim Waugh wrote:
> On Tue, 6 Apr 1999, John Fulmer wrote:
> 
> > Everything works find, EXCEPT xntpd gives me an error saying
> > "xntpd[6127]: tick value of 4831837056 is unreasonably large". Ntpdate
> > works find, and the clock is correct. Is this a problem with the 2.2.x
> > kernels and my Multia, or is it something else?
> 
> It's running on my UDB under 2.2.5 without that problem.  What I'm seeing
> is that every twenty minutes or so it steps the time by about a second, in
> alternate directions: +0.99, -1.18, -0.99, +1.20.  But I think that's just
> because the clock battery needs replacing.  xntpd 3-5.93.
> 
The problems you are seeing are solved by this little patch:
--- arch/alpha/kernel/osf_sys.c.org	Mon Mar 29 17:29:02 1999
+++ arch/alpha/kernel/osf_sys.c	Thu Apr  1 13:41:36 1999
@@ -1408,8 +1408,7 @@
 			   offsetof(struct timex32, time)))
 	  return -EFAULT;
 	
-	if ((ret = do_adjtimex(&txc)))
-	  return ret;
+	ret = do_adjtimex(&txc);
 	
 	/* copy back to timex32 */
 	if (copy_to_user(txc_p, &txc, offsetof(struct timex32, time)) ||
@@ -1418,5 +1417,5 @@
 	    (put_tv32(&txc_p->time, &txc.time)))
 	  return -EFAULT;
 
-	return 0;
+	return ret;
 }
What is does is that it removes the overoptimisation of the adjtimex
syscall someone put in somewhere in the 2.1.x series and wich breaks
xntpd. I've had lots of 'fun' tracking this little bug down.
This fix is in Alan's tree, so I hope it will end up in Linus' tree also.
~~  Wieger
> Tim.
> */
> 
> 
> -
> To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
> the body of a message to majordomo@vger.rutgers.edu
> Please read the FAQ at 
http://www.tux.org/lkml/
> 
~~  Wieger
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/