Date: Sun, 05 Jan 2003 11:47:56 +0100
From: Kasper Dupont <>
Subject: [RFC] VM86 patch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/1/5/44

Is there some reason for not applying
http://dosemu.sourceforge.net/stas/traps.diff
to the 2.5 kernel? Or was it just forgotten?
I have attached a version that applies cleanly
to 2.5.54.
-- 
Kasper Dupont -- der bruger for meget tid pÃ¥ usenet.
For sending spam use mailto:aaarep@daimi.au.dk
for(_=52;_;(_%5)||(_/=5),(_%5)&&(_-=2))putchar(_);diff -Nur linux.old/arch/i386/kernel/traps.c linux.new/arch/i386/kernel/traps.c
--- linux.old/arch/i386/kernel/traps.c	Sun Jan  5 11:26:56 2003
+++ linux.new/arch/i386/kernel/traps.c	Sun Jan  5 11:28:20 2003
@@ -320,8 +320,12 @@
 static inline void do_trap(int trapnr, int signr, char *str, int vm86,
 			   struct pt_regs * regs, long error_code, siginfo_t *info)
 {
-	if (vm86 && regs->eflags & VM_MASK)
-		goto vm86_trap;
+	if (regs->eflags & VM_MASK) {
+		if (vm86)
+			goto vm86_trap;
+		else
+			goto trap_signal;
+	}
 
 	if (!(regs->xcs & 3))
 		goto kernel_trap;