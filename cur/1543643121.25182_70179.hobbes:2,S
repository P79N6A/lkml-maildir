Date: Thu, 12 Sep 2002 08:39:23 -0700
From: Mike Anderson <>
Subject: Re: 2.4.19 SCSI core bug?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/9/12/12

Russell King [rmk@arm.linux.org.uk] wrote:
> On Wed, Sep 11, 2002 at 10:19:00PM +0100, Russell King wrote:
> > Ok, so we were asking for 0xfe 512-byte sectors, which is 130048.
> > So why did SCSI tell me that it wanted 38400 bytes in
> > SCpnt->request_bufflen?
> 
> Ok, problem found.
> 
> There's a nice loop in scsi_send_eh_cmnd() which just loops endlessly
> trying to retry a SCpnt command on medium error without restoring it
> to its pristine state before giving it back to the host, or limiting
> the number of retries.
The scsi_eh_completed_normally function should be limiting your retries.
So you should not be looping endlessly unless the problem of sending
down a dirty command is causing another issue.
I have a cleanup patch for 2.5 scsi_error I will add this fix in.
scsi_send_eh_cmnd should not be retrying the command it should return to
the caller the status and let them decide. We also should create a
?restore_scsi_cb? function that is shared so that it is done
consistently.
Eventually the retry policy is going to be changed, but until then we
should fix this problem.
-andmike
-- 
Michael Anderson
andmike@us.ibm.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/