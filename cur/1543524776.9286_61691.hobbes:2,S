Date: Mon, 7 Feb 2000 10:50:18 +0100 (CET)
From: Patrik Rak <>
Subject: PROBLEM: NULL dereference in get_new_inode()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/2/7/19

[1.] NULL dereference in get_new_inode()
[2.] There is something wrong with the new inode lookup or at least with
how it is beeing called from ext2_lookup(). The problem is that not only
one process dies, but as this happens done while the some lock is being
held, any other process accessing the same area blocks as well.
Exactly the same thing happened to me about one week ago, with 2.2.13.
This time it was 2.2.14.
[3.] ext2fs
[4.] Linux version 2.2.14 (root@ash) (gcc version 2.7.2.3) #1 Mon Jan 31 11:32:39 CET 2000
[5.]
Unable to handle kernel NULL pointer dereference at virtual address 0000002b
current->tss.cr3 = 03357000, %cr3 = 03357000
*pde = 00000000
Oops: 0000
CPU:    0
EIP:    0010:[get_new_inode+76/284]
EFLAGS: 00010293
eax: c09be668   ebx: c37c2880   ecx: c01c3278   edx: c37c2888
esi: 002a9021   edi: 0000002b   ebp: c2c74800   esp: c137fefc
ds: 0018   es: 0018   ss: 0018
Process processlogs (pid: 9043, process nr: 94, stackpage=c137f000)
Stack: c2c74800 c1035ba0 c012fd98 c2c74800 002a9021 0000002b 002a9021 c379f9e0
       c0795870 00000000 c013a480 c2c74800 002a9021 fffffff4 c379f9e0 c0795870
       c3be1ac0 c012a00f c0795870 c379f9e0 c137ff80 c3b0d039 00000001 c1035ba0
Call Trace: [iget+96/108] [ext2_lookup+92/144] [real_lookup+79/164] [lookup_dentry+268/428] [__namei+41/92] [sys_newstat+19/100] [system_call+52/56]
Code: 8b 07 89 58 04 89 03 89 7b 04 89 1f 89 6b 68 66 8b 45 08 66
[6.] not available
[7.]
[7.1.]
Kernel modules         2.1.121
Gnu C                  2.7.2.3
Binutils               2.9.1.0.19
Linux C Library        2.0.7
Dynamic linker         ldd: version 1.9.10
Procps                 1.2.9
Mount                  2.9g
Net-tools              2.01
Kbd                    0.96
Sh-utils               1.16
[7.2.]
processor       : 0
vendor_id       : GenuineIntel
cpu family      : 5
model           : 4
model name      : Pentium MMX
stepping        : 3
cpu MHz         : 166.404097
fdiv_bug        : no
hlt_bug         : no
sep_bug         : no
f00f_bug        : yes
coma_bug        : no
fpu             : yes
fpu_exception   : yes
cpuid level     : 1
wp              : yes
flags           : fpu vme de pse tsc msr mce cx8 mmx
bogomips        : 331.78
[7.3.] none
[7.4.] not used
[7.5.]
The inode was always on the hdc. Below is dump of various disk info.
ash:/proc# mount
/dev/hda2 on / type ext2 (rw,errors=remount-ro)
proc on /proc type proc (rw)
/dev/hda5 on /usr type ext2 (ro)
/dev/hda6 on /var type ext2 (rw)
/dev/hda7 on /home type ext2 (rw)
/dev/hdc1 on /data type ext2 (rw)
----- ide0/hda/smart_thresholds -----
0005 3301 0000 0000 0000 0000 0000 0a04
0000 0000 0000 0000 0000 330a 0000 0000
0000 0000 0000 330b 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 3e00
----- ide0/hda/smart_values -----
0005 0b01 c600 01c6 0000 0000 0000 1204
6400 5964 0000 0000 0000 130a 6400 0064
0000 0000 0000 130b 5200 0052 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0100 0002 0301
0002 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 7b00
----- ide0/hda/geometry -----
physical     2484/16/63
logical      621/64/63
----- ide0/hda/cache -----
128
----- ide0/hda/capacity -----
2503872
----- ide0/hda/settings -----
name			value		min		max		mode
----			-----		---		---		----
bios_cyl                621             0               65535           rw
bios_head               64              0               255             rw
bios_sect               63              0               63              rw
breada_readahead        4               0               127             rw
bswap                   0               0               1               r
file_readahead          124             0               2097151         rw
io_32bit                0               0               3               rw
keepsettings            0               0               1               rw
max_kb_per_request      64              1               127             rw
multcount               0               0               8               rw
nice1                   1               0               1               rw
nowerr                  0               0               1               rw
pio_mode                write-only      0               255             w
slow                    0               0               1               rw
unmaskirq               0               0               1               rw
using_dma               1               0               1               rw
----- ide0/hda/model -----
WDC AC21200H
----- ide0/hda/media -----
disk
----- ide0/hda/identify -----
427a 09b4 0000 0010 e100 0258 003f 0010
0000 000e 5744 2d57 4d33 3432 3131 3533
3634 3820 2020 2020 0003 0100 0016 3035
2e30 3145 3535 5744 4320 4143 3231 3230
3048 2020 2020 2020 2020 2020 2020 2020
2020 2020 2020 2020 2020 2020 2020 8010
0000 2f00 0000 0280 0000 0003 09b4 0010
003f 34c0 0026 0110 34c0 0026 0000 0407
0003 0078 0078 00a0 0078 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0078
----- ide0/hda/driver -----
ide-disk version 1.08
----- ide0/model -----
pci
----- ide0/mate -----
ide1
----- ide0/config -----
pci bus 00 device 39 vid 1106 did 0571 channel 0
06 11 71 05 05 00 80 02 06 8a 01 01 00 20 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
01 60 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0b f2 09 3a 68 03 f0 00 a8 31 a8 31 ff 00 ff ff
03 03 03 03 00 00 00 00 a8 a8 a8 a8 00 00 00 00
00 02 00 00 00 00 00 00 00 02 00 00 00 00 00 00
02 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00
00 00 fc 03 00 00 00 00 00 08 fc 03 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
06 00 71 05 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
----- ide0/channel -----
0
----- ide1/hdc/smart_thresholds -----
000a 0001 0000 0000 0000 0000 0000 0003
0000 0000 0000 0000 0000 1404 0000 0000
0000 0000 0000 2405 0000 0000 0000 0000
0000 1e07 0000 0000 0000 0000 0000 0009
0000 0000 0000 0000 0000 610a 0000 0000
0000 0000 0000 140c 0000 0000 0000 0000
0000 00c7 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 3100
----- ide1/hdc/smart_values -----
000a 0801 5b00 b15a 6ebc 0005 0000 0603
4600 0046 0000 0000 0000 1304 6400 1264
0000 0000 0000 1305 6400 0064 0000 0000
0000 0b07 4b00 093c 6e4c 0102 0000 1209
8f00 0001 0000 0000 0000 130a 6400 0064
0000 0000 0000 130c 6400 0d64 0000 0000
0000 0ac7 c800 00c8 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0082 0960 1b00
0002 0001 2302 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0128
0000 1e03 1e1e 1e1e 1e1e 001e 0000 0000
0000 0100 e5d2 0039 0000 0000 0000 f20e
3991 0072 0000 0000 0000 0000 0000 3700
----- ide1/hdc/geometry -----
physical     16383/16/63
logical      33416/16/63
----- ide1/hdc/cache -----
512
----- ide1/hdc/capacity -----
33683328
----- ide1/hdc/settings -----
name			value		min		max		mode
----			-----		---		---		----
bios_cyl                33416           0               65535           rw
bios_head               16              0               255             rw
bios_sect               63              0               63              rw
breada_readahead        4               0               127             rw
bswap                   0               0               1               r
file_readahead          124             0               2097151         rw
io_32bit                0               0               3               rw
keepsettings            0               0               1               rw
max_kb_per_request      64              1               127             rw
multcount               0               0               8               rw
nice1                   1               0               1               rw
nowerr                  0               0               1               rw
pio_mode                write-only      0               255             w
slow                    0               0               1               rw
unmaskirq               0               0               1               rw
using_dma               1               0               1               rw
----- ide1/hdc/model -----
ST317242A
----- ide1/hdc/media -----
disk
----- ide1/hdc/identify -----
0c5a 3fff 0000 0010 0000 0000 003f 0000
0000 0000 3742 5030 3246 3153 2020 2020
2020 2020 2020 2020 0000 0400 0000 332e
3039 2020 2020 5354 3331 3732 3432 4120
2020 2020 2020 2020 2020 2020 2020 2020
2020 2020 2020 2020 2020 2020 2020 8010
0000 2f00 0000 0200 0200 0007 3fff 0010
003f fc10 00fb 0010 f780 0201 0000 0407
0003 0078 0078 00f0 0078 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
001e 0000 3069 4001 4000 3069 0001 4000
0007 0000 0000 0000 0000 6000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 9d60 0205 9d60 0205 2020 0002 0000
c001 0000 0002 0401 0801 0140 0401 0000
3c24 0201 4001 3cb4 0100 0100 0072 3001
0001 0140 0000 0000 ffff 094b 0007 0009
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
----- ide1/hdc/driver -----
ide-disk version 1.08
----- ide1/model -----
pci
----- ide1/mate -----
ide0
----- ide1/config -----
pci bus 00 device 39 vid 1106 did 0571 channel 1
06 11 71 05 05 00 80 02 06 8a 01 01 00 20 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
01 60 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0b f2 09 3a 68 03 f0 00 a8 31 a8 31 ff 00 ff ff
03 03 03 03 00 00 00 00 a8 a8 a8 a8 00 00 00 00
00 02 00 00 00 00 00 00 00 02 00 00 00 00 00 00
02 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00
00 00 fc 03 00 00 00 00 00 08 fc 03 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
06 00 71 05 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
----- ide1/channel -----
1
----- drivers -----
ide-disk version 1.08
PCI devices found:
  Bus  0, device   0, function  0:
    Host bridge: VIA Technologies VT 82C585 Apollo VP1/VPX (rev 35).
      Medium devsel.  Fast back-to-back capable.  Master
Capable.  Latency=32.
  Bus  0, device   7, function  0:
    ISA bridge: VIA Technologies VT 82C586 Apollo ISA (rev 39).
      Medium devsel.  Master Capable.  No bursts.
  Bus  0, device   7, function  1:
    IDE interface: VIA Technologies VT 82C586 Apollo IDE (rev 6).
      Medium devsel.  Fast back-to-back capable.  Master
Capable.  Latency=32.
      I/O at 0x6000 [0x6001].
  Bus  0, device   8, function  0:
    Ethernet controller: Realtek 8139 (rev 16).
      Medium devsel.  Fast back-to-back capable.  IRQ 11.  Master
Capable.  Latency=32.  Min Gnt=32.Max Lat=64.
      I/O at 0x6200 [0x6201].
      Non-prefetchable 32 bit memory at 0xe4000000 [0xe4000000].
  Bus  0, device  10, function  0:
    VGA compatible controller: S3 Inc. ViRGE/DX or /GX (rev 1).
      Medium devsel.  Master Capable.  Latency=32.  Min Gnt=4.Max Lat=255.
      Non-prefetchable 32 bit memory at 0xe0000000 [0xe0000000].
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/