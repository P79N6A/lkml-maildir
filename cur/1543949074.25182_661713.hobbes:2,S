Date: Fri, 29 Feb 2008 20:13:20 +0200
From: Dimitrios Apostolou <>
Subject: Re: swap file over jffs2 partition
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/29/282

Bernd Petrovitsch wrote:
> On Fre, 2008-02-29 at 04:50 +0200, Dimitrios Apostolou wrote:
>> Hello list,
>>
>> I intend to build a diskless linux system (root over NFS). Because it
>> has 1GB of embedded flash storage, I'm thinking of using this as swap 
>> (I've been bitten many times by the problems linux has with *no* 
> 
> Put more RAM on the hardware and/or reduce the software on it.
> If that means heavily customizing the distribution: Do it.
> If that means you can't run some specific common distribution[0]: Throw
> it out and roll your own minimalistic one with just the tools and
> especially libraries you need.
> We run Linux on embedded hardware all the time without swapspace without
> any problems (related to the "missing" swapspace).
I have been running swapless linux systems a long time ago, but I think 
I have had more problems than not. I have tried setting swappiness and 
overcommit settings but these don't help much. Let me explain:
When it is not certain that your system will run a specific task and 
only that, it is almost certain that sometime you will run out of 
memory. For example in the thin client case a user might open too many 
windows and fill the RAM with X server pixmaps...
So when the out of memory condition happens the system will start 
swapping. And if you have no swap enabled, the system will swap even 
harder: it will swap out all mmap'ed read-only memory segments, which 
mostly are the executables themselves. And because these will be needed 
immediately they will be swapped in immediately afterwards...
This renders the system *unusable* for all cases. Sometimes it even 
stops responding to ping... On the other hand if you have a swap 
partition then the kernel will choose to swap out other memory segments, 
not the executable ones that are so much needed.
> 
>> swap...). And to avoid wearing out the flash storage too fast, I 'm 
> 
> Swapping (and constantly writing logfiles) will wear it out much faster
> than without. Perhaps not at development time but for sure in the field.
That's why I want to do it over a wear-levelling layer. Given that the 
partition is large enough it will hopefully take a while to wear it out.
Thanks,
Dimitris
> 
> [....]
> 
> 	Bernd
> 
> [0]: Which I highly doubt.