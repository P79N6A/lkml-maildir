Date: Thu, 2 Aug 2007 03:07:58 +0530 (IST)
From: Satyam Sharma <>
Subject: Re: [BUG] Linux 2.6.22 - Atomic counter underflow in NFS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/1/438

On Wed, 1 Aug 2007, Chris Rankin wrote:
> --- Satyam Sharma <satyam@infradead.org> wrote:
> > I expect this is easy to reproduce at will (when shutting down nfs
> > services, probably), right?
> 
> I'm not sure about the "at will" part because this is the first time I've seen it since 2.6.22 was
> released. However, I was upgrading my Fedora 7 nfs-utils package at the time so it probably did
> happen when the NFS service was being shut down.
Hmm, the backtrace suggests it should be reproducible fairly frequently.
> > Please try the latest mainline -git kernel (say 2.6.23-rc1-git10 from
> > kernel.org) and let us know if this still occurs? There were some fixes
> > regarding sysfs symlink refcounting that went in recently, and this looks
> > like one of those cases to me.
> 
> Do you have the actual patches instead?
I was thinking maybe this one: 
http://lkml.org/lkml/diff/2007/7/18/48/1
The kref_put() there happens on the sysfs_remove_link() path, and the
patch above fixed an extra put() during create_link(), which lead to
the final put() during remove_link() being what causes this underflow.
However, a lot changed in sysfs in the past few months, and I'm not
really sure that patch would apply cleanly. Hence, if you can try with
the latest -git ...
Thanks,
Satyam
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/