Date: Sat, 6 Oct 2007 11:17:13 +0800
From: WANG Cong <>
Subject: [Patch]Documentation/watchdog/src/watchdog-simple.c: improve this code
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/5/309

Make some improvements for Documentation/watchdog/src/watchdog-simple.c.
CC: Wim Van Sebroeck <wim@iguana.be>
Signed-off-by: WANG Cong <xiyou.wangcong@gmail.com>
---
 Documentation/watchdog/src/watchdog-simple.c |   17 +++++++++++++----
 1 file changed, 13 insertions(+), 4 deletions(-)
Index: linux-2.6.23-rc9/Documentation/watchdog/src/watchdog-simple.c
===================================================================
--- linux-2.6.23-rc9.orig/Documentation/watchdog/src/watchdog-simple.c
+++ linux-2.6.23-rc9/Documentation/watchdog/src/watchdog-simple.c
@@ -3,15 +3,24 @@
 #include <unistd.h>
 #include <fcntl.h>
 
-int main(int argc, const char *argv[]) {
+int main(void) {
 	int fd = open("/dev/watchdog", O_WRONLY);
+	int ret = 0;
 	if (fd == -1) {
 		perror("watchdog");
-		exit(1);
+		exit(EXIT_FAILURE);
 	}
 	while (1) {
-		write(fd, "\0", 1);
-		fsync(fd);
+		ret = write(fd, "\0", 1);
+		if (ret != 1) {
+			ret = -1;
+			break;
+		}
+		ret = fsync(fd);
+		if (ret)
+			break;
 		sleep(10);
 	}
+	close(fd);
+	return ret;
 }
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/