Date: Thu, 30 Jun 2005 14:20:52 +0200
From: Pierre Ossman <>
Subject: Re: ISA DMA controller hangs
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/6/30/97

Alan Cox wrote:
>
>It is spelt "weird"
> 
>
Ooops... :)
>Looks basically OK although it would be good to document the situation
>for a bus mastering DMA controller. Does the device have to reconfigure
>the DMA on a resume or is that something the restore code for the device
>should handle ?
>
>My own feeling is tha we should dump that on the device (safer) and also
>expect the device to prevent suspends during an active DMA transfer (eg
>floppy)
>
> 
>
If you mean that the device drivers should restore any state then I
fully agree. A central restore of the complete state of the DMA
controller would require keeping a copy of all data passed to it (since
some registers are write only). The reason for my piece of code here is
that nobody "owns" channel 4 so it must be restored centrally. Also,
resetting the other registers makes the DMA controller behave the same
way on all systems (from the drivers' point of view at least).
Preventing suspend also needs to be done from the drivers. Simply
because only they can determine when the devices are doing the transfer
(examining the DMA controller will only tell us if it's _prepared_ for a
transfer).
I'll fix the typo and whip up a patch for x86_64 then.
Rgds
Pierre
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/