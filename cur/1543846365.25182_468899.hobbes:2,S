Date: Mon, 2 Oct 2006 22:28:39 -0700
From: Greg KH <>
Subject: Re: debugfs oddity
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/3/18

On Mon, Oct 02, 2006 at 11:25:04AM +0200, Johannes Berg wrote:
> Recently, I observed (in bcm43xx) that debugfs seems to keep things
> alive when userspace still has a directory open. Consider the following
> sequence of events:
>  (a) kernel code creates a directory in debugfs
>  (b) user changes current directory to that
>  (c) kernel code removes that directory in debugfs
> 
> Now, consider the equivalent sequence in a regular filesystem (or
> tmpfs):
>  (a') user creates directory
>  (b') user cd's into it
>  (c') user deletes directory from a different shell
> 
> The same thing should happen, in both cases the directory is kept around
> in a way until the process that has the current dir in the dead
> directory gives it up.
> 
> Now, however, consider
>  (d') user creates directory with the same name
> 
> This works fine, and the old process sees nothing that happens in the
> new directory, as expected. However,
>  (d) kernel code tries to create a debugfs directory with the same name
> 
> does not work at all.
True, that is because the kernel thinks there is still an active dentry
with that name present in the system.
> Is this expected behaviour? It seems that once a driver requested that a
> directory is removed it can rightfully expect to be able to recreate it
> afterwards even if there's still the need to keep it lingering around
> for a bit.
> 
> Similar things can probably happen when attributes are kept open, but I
> haven't tested this. I have also not tested sysfs or configfs.
sysfs works much differently here, as does configfs.  debugfs just uses
the vfs layer's ramfs stack, so any potential problem here is probably
also present in ramfs.  Have you tried that out?
thanks,
greg k-h
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/