Date: Tue, 13 Jan 2004 17:47:31 -0800
From: James Cleverdon <>
Subject: [PATCH] 2.6.1-mm2: Adjust MAX_MP_BUSSES for summit and generic subarches
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/1/13/265

We're overflowing some of the bus arrays on 32-way x445s (the BIOS reserves 
lots of busses for PCI hot-plug), and probably would do the same on a 16-way 
x440 with dual PCI expansion boxes.  This should make enough room.
diff -pru 2.6.1-mm2/include/asm-i386/mach-generic/mach_mpspec.h 
q1mm2/include/asm-i386/mach-generic/mach_mpspec.h
--- 2.6.1-mm2/include/asm-i386/mach-generic/mach_mpspec.h	2004-01-08 
22:59:45.000000000 -0800
+++ q1mm2/include/asm-i386/mach-generic/mach_mpspec.h	2004-01-13 
17:08:23.823784680 -0800
@@ -8,6 +8,12 @@
 
 #define MAX_IRQ_SOURCES 256
 
-#define MAX_MP_BUSSES 32
+/* Summit or generic (i.e. installer) kernels need lots of bus entries. */
+#if defined(CONFIG_X86_SUMMIT) || defined(CONFIG_X86_GENERICARCH)
+/* Maximum 256 PCI busses, plus 1 ISA bus in each of 4 cabinets. */
+# define MAX_MP_BUSSES 260
+#else
+# define MAX_MP_BUSSES 32
+#endif
 
 #endif /* __ASM_MACH_MPSPEC_H */
diff -pru 2.6.1-mm2/include/asm-i386/mach-summit/mach_mpspec.h 
q1mm2/include/asm-i386/mach-summit/mach_mpspec.h
--- 2.6.1-mm2/include/asm-i386/mach-summit/mach_mpspec.h	2004-01-08 
22:59:26.000000000 -0800
+++ q1mm2/include/asm-i386/mach-summit/mach_mpspec.h	2004-01-13 
16:59:24.706742928 -0800
@@ -8,6 +8,7 @@
 
 #define MAX_IRQ_SOURCES 256
 
-#define MAX_MP_BUSSES 32
+/* Maximum 256 PCI busses, plus 1 ISA bus in each of 4 cabinets. */
+#define MAX_MP_BUSSES 260
 
 #endif /* __ASM_MACH_MPSPEC_H */diff -pru 2.6.1-mm2/include/asm-i386/mach-generic/mach_mpspec.h q1mm2/include/asm-i386/mach-generic/mach_mpspec.h
--- 2.6.1-mm2/include/asm-i386/mach-generic/mach_mpspec.h	2004-01-08 22:59:45.000000000 -0800
+++ q1mm2/include/asm-i386/mach-generic/mach_mpspec.h	2004-01-13 17:08:23.823784680 -0800
@@ -8,6 +8,12 @@
 
 #define MAX_IRQ_SOURCES 256
 
-#define MAX_MP_BUSSES 32
+/* Summit or generic (i.e. installer) kernels need lots of bus entries. */
+#if defined(CONFIG_X86_SUMMIT) || defined(CONFIG_X86_GENERICARCH)
+/* Maximum 256 PCI busses, plus 1 ISA bus in each of 4 cabinets. */
+# define MAX_MP_BUSSES 260
+#else
+# define MAX_MP_BUSSES 32
+#endif
 
 #endif /* __ASM_MACH_MPSPEC_H */
diff -pru 2.6.1-mm2/include/asm-i386/mach-summit/mach_mpspec.h q1mm2/include/asm-i386/mach-summit/mach_mpspec.h
--- 2.6.1-mm2/include/asm-i386/mach-summit/mach_mpspec.h	2004-01-08 22:59:26.000000000 -0800
+++ q1mm2/include/asm-i386/mach-summit/mach_mpspec.h	2004-01-13 16:59:24.706742928 -0800
@@ -8,6 +8,7 @@
 
 #define MAX_IRQ_SOURCES 256
 
-#define MAX_MP_BUSSES 32
+/* Maximum 256 PCI busses, plus 1 ISA bus in each of 4 cabinets. */
+#define MAX_MP_BUSSES 260
 
 #endif /* __ASM_MACH_MPSPEC_H */