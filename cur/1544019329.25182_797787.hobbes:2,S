Date: Wed, 28 Jan 2009 20:59:50 +0900
From: Kenji Kaneshige <>
Subject: [PATCH 8/8] PCI: fix wrong assumption in pci_common_swizzle
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/28/113

Current pci_common_swizzle() seems to have a assumption that
pci_bus->self is NULL on the pci root bus. But it might not be true on
some platforms. Because of this wrong assumption, pci_common_swizzle()
might cause endless loop. We must check pci_bus->parent instead.
Signed-off-by: Kenji Kaneshige <kaneshige.kenji@jp.fujitsu.com>
---
 drivers/pci/pci.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
Index: linux-2.6.29-rc2/drivers/pci/pci.c
===================================================================
--- linux-2.6.29-rc2.orig/drivers/pci/pci.c
+++ linux-2.6.29-rc2/drivers/pci/pci.c
@@ -1453,7 +1453,7 @@ u8 pci_common_swizzle(struct pci_dev *de
 {
 	u8 pin = *pinp;
 
-	while (dev->bus->self) {
+	while (dev->bus->parent) {
 		pin = pci_swizzle_interrupt_pin(dev, pin);
 		dev = dev->bus->self;
 	}