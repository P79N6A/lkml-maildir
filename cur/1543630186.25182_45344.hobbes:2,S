Date: 11 May 2002 21:19:31 +0200
From: Luca Barbieri <>
Subject: [PATCH] [2.4] [2.5] Fix PPPoATM crash on disconnection (tasklet_disable; kfree(tasklet))
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/5/11/62

PPPoATM uses tasklet_disable() on a tasklet inside a struct and then
frees the struct, leaving a pointer to the freed tasklet inside tasklet
lists.
This patch replaces tasklet_disable() with tasklet_kill().
This bug is present in both 2.4.18 and 2.5.15 (and the patch applies to
both).
--- linux-old/net/atm/pppoatm.c	Wed Apr 10 14:37:34 2002
+++ linux/net/atm/pppoatm.c	Fri May 10 21:56:28 2002
@@ -125,7 +125,7 @@
 	pvcc = atmvcc_to_pvcc(atmvcc);
 	atmvcc->push = pvcc->old_push;
 	atmvcc->pop = pvcc->old_pop;
-	tasklet_disable(&pvcc->wakeup_tasklet);
+	tasklet_kill(&pvcc->wakeup_tasklet);
 	ppp_unregister_channel(&pvcc->chan);
 	atmvcc->user_back = NULL;
 	kfree(pvcc);[unhandled content-type:application/pgp-signature]