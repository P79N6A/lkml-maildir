Date: Thu, 18 Aug 2005 01:56:53 +0200
From: Patrick McHardy <>
Subject: Re: [PATCH] fix dst_entry leak in icmp_push_reply()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/8/17/180

Ollie Wild wrote:
> If the ip_append_data() call in icmp_push_reply() fails, 
> ip_flush_pending_frames() needs to be called.  Otherwise, ip_rt_put() is 
> never called on inet_sk(icmp_socket->sk)->cork.rt, which prevents the 
> route (and net_device) from ever being freed.
> 
> I've attached a patch which fixes the problem.
> 
> Ollie Wild
> 
> 
> ------------------------------------------------------------------------
> 
> diff --git a/net/ipv4/icmp.c b/net/ipv4/icmp.c
> --- a/net/ipv4/icmp.c
> +++ b/net/ipv4/icmp.c
> @@ -368,6 +368,8 @@ static void icmp_push_reply(struct icmp_
>  		icmph->checksum = csum_fold(csum);
>  		skb->ip_summed = CHECKSUM_NONE;
>  		ip_push_pending_frames(icmp_socket->sk);
> +	} else {
> +		ip_flush_pending_frames(icmp_socket->sk);
>
Your patch doesn't fit your description, the else-condition you're
adding triggers when the queue is empty, so what is the point?
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/