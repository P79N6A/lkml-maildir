Date: Tue, 8 Apr 2003 01:41:30 +0100
From: Alan Cox <>
Subject: PATCH; ics2101 needs to match the gus_lock name too
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/4/7/317

diff -u --new-file --recursive --exclude-from /usr/src/exclude linux-2.5.67/sound/oss/ics2101.c linux-2.5.67-ac1/sound/oss/ics2101.c
--- linux-2.5.67/sound/oss/ics2101.c	2003-02-10 18:38:00.000000000 +0000
+++ linux-2.5.67-ac1/sound/oss/ics2101.c	2003-04-03 23:45:12.000000000 +0100
@@ -29,7 +29,7 @@
 
 extern int     *gus_osp;
 extern int      gus_base;
-extern spinlock_t lock;
+extern spinlock_t gus_lock;
 static int      volumes[ICS_MIXDEVS];
 static int      left_fix[ICS_MIXDEVS] =
 {1, 1, 1, 2, 1, 2};
@@ -87,12 +87,12 @@
 		attn_addr |= 0x03;
 	}
 
-	spin_lock_irqsave(&lock, flags);
+	spin_lock_irqsave(&gus_lock, flags);
 	outb((ctrl_addr), u_MixSelect);
 	outb((selector[dev]), u_MixData);
 	outb((attn_addr), u_MixSelect);
 	outb(((unsigned char) vol), u_MixData);
-	spin_unlock_irqrestore(&lock,flags);
+	spin_unlock_irqrestore(&gus_lock,flags);
 }
 
 static int set_volumes(int dev, int vol)
@@ -209,10 +209,10 @@
 
 static struct mixer_operations ics2101_mixer_operations =
 {
-	owner:	THIS_MODULE,
-	id:	"ICS2101",
-	name:	"ICS2101 Multimedia Mixer",
-	ioctl:	ics2101_mixer_ioctl
+	.owner	= THIS_MODULE,
+	.id	= "ICS2101",
+	.name	= "ICS2101 Multimedia Mixer",
+	.ioctl	= ics2101_mixer_ioctl
 };
 
 int __init ics2101_mixer_init(void)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/