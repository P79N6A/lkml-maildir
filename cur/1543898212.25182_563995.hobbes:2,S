Date: Sun, 1 Jul 2007 01:13:24 +0400
From: Andrey Borzenkov <>
Subject: Re: 2.6.22-rc: regression: no irda0 interface (2.6.21 was OK), smsc does not find chip
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/30/138

On Saturday 30 June 2007, Andrey Borzenkov wrote:
> On Saturday 30 June 2007, Bjorn Helgaas wrote:
> > This means that the SMCf010 device *did* respond, I think at the
> > FIR address 0x100.  (I can't figure out the "right" way to print
> > those resource_size_t things, so I added some casts in the appended
> > patch.)
>
> Those can be 64 bit if CONFIG_RESOURCE_64BIT is set; so you probably should
> cast to unsigned long long and use %llx. Or do it conditionally depending
> on above macro.
>
> > Well, the whole problem I'm trying to fix is that we aren't doing
> > resource allocation correctly.  The BIOS has configured the IR
> > device to use port 0x100, and then something else came along and
> > decided to also use port 0x100.
>
After some digging, it works now :) So the story:
PCMCIA includes code for checking for free IO range(s)
code is active only if CONFIG_ISA is defined
CONFIG_ISA has this excellent help text:
          Find out whether you have ISA slots on your motherboard. 
and I was stupid enough to take this literally (having notebook I obviously do 
not have any slots at all)
So after recompiling with CONFIG_ISA defined I now get
[ 2254.136611] cs: IO port probe 0x100-0x3af: excluding 0x100-0x107 
0x2e8-0x2ef 0x378-0x37f
[ 2254.166638] cs: IO port probe 0x3e0-0x4ff: excluding 0x3f8-0x3ff 
0x408-0x40f 0x480-0x48f 0x4d0-0x4d7
[ 2254.194838] cs: IO port probe 0x820-0x8ff: clean.
[ 2254.222401] cs: IO port probe 0xc00-0xcf7: clean.
[ 2254.250056] cs: IO port probe 0xa00-0xaff: clean.
(I wonder why this is repeated 3 times, but well ...) and smsc-ircc2 takes 
over ports 0x100 - 0x107 and is happy.
THANK YOU!
Bjorn, I believe last touch that is needed is to sort out printf issues, 
otherwise patch is fine here.
-andrey
[unhandled content-type:application/pgp-signature]