Date: Wed, 29 Aug 2001 07:58:07 -0500 (CDT)
From: Jesse Pollard <>
Subject: Re: Shutting down NFS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/8/29/56

VDA <VDA@port.imtp.ilyichevsk.odessa.ua>:
> Hello Jesse,
> 
> Tuesday, August 28, 2001, 4:42:48 AM, you wrote:
> JP> On Mon, 27 Aug 2001, VDA wrote:
> >>...
> >>  killall5 -15; sleep 2; killall5 -9:
> >>    1st run - nothing
> >>    2nd run - nfsd dies
> >>    3rd run - lockd/statd die
> >>    (This is strange. Complicates shutdown script)
> 
> JP> You are using 2 second delay, which might be a bit short, but not unreasonable.
> 
> I have tested this not by shutting down my system but by running a
> test script, watching "ps -AH e" after each run.
> After first run of "killall5 -15; sleep 2; killall5 -9" NFS daemons
> DON'T die at all. After second run only nfsd dies. Only third run
> kills lockd and statd. It does not matter how long I wait between
> runs. (however I didn't wait for minutes. Do you want me to try it?)
> Am I supposed to do the same in shutdown script, i.e.
> 
> killall5 -15; sleep 5; killall5 -9; sleep 5
> killall5 -15; sleep 5; killall5 -9; sleep 5
> killall5 -15; sleep 5; killall5 -9 ?
> 
> This looks ugly and total sleep time is 25 sec.
> A better way is to make NFS daemons understand what user wants after
> first call, not a third.
This already looks like overkill :-) Only the first one should be
needed. I can understand that NFSD could disable signal 15, but not
how it can disable 9... The only way I know for that to happen is
if the process is in an uninterruptable sleep for some reason (and
that should only delay signal delivery, not eliminate it).
I'll have to look at the sources  to get more details.
Everything else looks reasonable (even with a two second sleep).
-------------------------------------------------------------------------
Jesse I Pollard, II
Email: pollard@navo.hpc.mil
Any opinions expressed are solely my own.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/