Date: Fri, 5 Nov 1999 15:41:00 +0100 (CET)
From: Trond Myklebust <>
Subject: Re: Data loss on NFS mounted directory (2.2.13)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/5/39

>>>>> " " == Jens Benecke <jens@pinguin.conetix.de> writes:
     > On Thu, Nov 04, 1999 at 01:28:09PM +0100, Trond Myklebust
     > wrote:
    >> > Hi, I just downloaded something from Netscape (4.61, glibc2)
    >> > onto a NFS mounted directory (server: 2.2.13 with gcc 2.95.1,
    >> > absolutely stable so far).  (client: 2.2.13pre7, Mandrake 6.1
    >> > standard setup).
    >>
    >> > When the download was about half finished, I 'mv'ed the file
    >> > into another directory - same NFS filesystem, same partition
    >> > on server, just a subdirectory. No problem, I thought, this
    >> > has always worked on all machines I know.
 
    >> I don't see this problem on my own setup: mv on an 'iozone'
    >> output file when it's half-finished writing works fine.
     > Hm.
 
    >> Could you run a 'tcpdump -s 256' before and after the 'mv', so
    >> that we can capture a write or two? I have a feeling this is a
    >> server bug (BTW
     > Yes. That's just about what I wanted to hear: how to trace the
     > issue. (Note that I'm not calling it a bug yet...)
 The dump you provided of activity after the 'mv' seemed to be missing 
'write' calls. Is this an accident, or do the 'write' really stop
going down the wire?
If the latter is the case, it would be useful to see what goes on
exactly at the moment around the 'mv' itself. I suspect that the
server is stating that the file handle is stale: if we can capture the
first 'write' (and the server reply) after the mv, that should tell us 
whether this is indeed happening or not.
Note: you might also want to look at the debugging output from
'echo "9" > /proc/sys/sunrpc/nfs_debug'
during the 'mv'.
Cheers,
  Trond
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/