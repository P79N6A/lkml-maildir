Date: Fri, 03 Feb 2006 22:33:46 +0300
From: Oleg Nesterov <>
Subject: [PATCH 2/2] don't use REMOVE_LINKS/SET_LINKS for reparenting
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/2/3/193

There are places where kernel uses REMOVE_LINKS/SET_LINKS while
changing process's ->parent. Use add_parent/remove_parent instead,
they don't abuse of global process list.
Signed-off-by: Oleg Nesterov <oleg@tv-sign.ru>
--- RC-1/kernel/exit.c~2_LINKS	2006-02-04 00:28:49.000000000 +0300
+++ RC-1/kernel/exit.c	2006-02-04 00:53:54.000000000 +0300
@@ -220,10 +220,10 @@ static void reparent_to_init(void)
 
 	ptrace_unlink(current);
 	/* Reparent to init */
-	REMOVE_LINKS(current);
+	remove_parent(current);
 	current->parent = child_reaper;
 	current->real_parent = child_reaper;
-	SET_LINKS(current);
+	add_parent(current);
 
 	/* Set the exit signal to SIGCHLD so we signal init on exit */
 	current->exit_signal = SIGCHLD;
--- RC-1/kernel/ptrace.c~2_LINKS	2006-02-04 00:23:41.000000000 +0300
+++ RC-1/kernel/ptrace.c	2006-02-04 00:53:54.000000000 +0300
@@ -35,9 +35,9 @@ void __ptrace_link(task_t *child, task_t
 	if (child->parent == new_parent)
 		return;
 	list_add(&child->ptrace_list, &child->parent->ptrace_children);
-	REMOVE_LINKS(child);
+	remove_parent(child);
 	child->parent = new_parent;
-	SET_LINKS(child);
+	add_parent(child);
 }
  
 /*
@@ -77,9 +77,9 @@ void __ptrace_unlink(task_t *child)
 	child->ptrace = 0;
 	if (!list_empty(&child->ptrace_list)) {
 		list_del_init(&child->ptrace_list);
-		REMOVE_LINKS(child);
+		remove_parent(child);
 		child->parent = child->real_parent;
-		SET_LINKS(child);
+		add_parent(child);
 	}
 
 	ptrace_untrace(child);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/