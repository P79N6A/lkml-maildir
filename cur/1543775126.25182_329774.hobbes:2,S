Date: Wed, 29 Jun 2005 09:03:09 +0200
From: Christoph Hellwig <>
Subject: [PATCH] fix Coverity braindamage in UDF
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/6/29/24

Andrew, please don't blindly apply Coverity patches.  While the checker
is smart at finding inconsistencies, that "obvious" fix is wrong most of
the item.  As in this unreviewed UDF patch that got in:
udf_find_entry can never be called with a NULL argument, so we shouldn't
check for it instead of adding more assignments behind the check.
Signed-off-by: Christoph Hellwig <hch@lst.de>
Index: linux-2.6/fs/udf/namei.c
===================================================================
--- linux-2.6.orig/fs/udf/namei.c	2005-06-29 08:56:02.000000000 +0200
+++ linux-2.6/fs/udf/namei.c	2005-06-29 08:59:25.000000000 +0200
@@ -153,24 +153,17 @@
 	struct fileIdentDesc *cfi)
 {
 	struct fileIdentDesc *fi=NULL;
-	loff_t f_pos;
+	loff_t f_pos = (udf_ext0_offset(dir) >> 2);
 	int block, flen;
 	char fname[UDF_NAME_LEN];
 	char *nameptr;
 	uint8_t lfi;
 	uint16_t liu;
-	loff_t size;
+	loff_t size = (udf_ext0_offset(dir) + dir->i_size) >> 2;
 	kernel_lb_addr bloc, eloc;
 	uint32_t extoffset, elen, offset;
 	struct buffer_head *bh = NULL;
 
-	if (!dir)
-		return NULL;
-
-	size = (udf_ext0_offset(dir) + dir->i_size) >> 2;
-
-	f_pos = (udf_ext0_offset(dir) >> 2);
-
 	fibh->soffset = fibh->eoffset = (f_pos & ((dir->i_sb->s_blocksize - 1) >> 2)) << 2;
 	if (UDF_I_ALLOCTYPE(dir) == ICBTAG_FLAG_AD_IN_ICB)
 		fibh->sbh = fibh->ebh = NULL;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/