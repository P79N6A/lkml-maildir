Date: Fri, 5 Nov 1999 10:01:24 -0500
From: "Theodore Y. Ts'o" <>
Subject: Re: Common IRQ pitfall results in lockup.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/5/42

   Date: Fri, 5 Nov 1999 13:23:47 +0100 (MET)
   From: R.E.Wolff@BitWizard.nl (Rogier Wolff)
   Alan, I'd like to discuss with you and Ted what we'll do about the 2.2
   serial driver: Leave as is (please, no!), upgrade to Teds newest
   driver with PCI serial card support (with fix), or just a minimal fix.
I'm still working on fixing some problems with the serial console in my
latest driver, so it's not ready for 2.2 yet.  But I hope to have an
updated serial driver (with some additional PCI cards supported) ready
soon.
   A client reports that this problem occurred (and that my fix fixed
   it), when his SCSI card was sharing the interrupt. The cards driver
   however isn't listed as "misbehaving", so I'm not so sure that the
   problem ONLY occurs when both drivers are "misbehaving". If that's the
   case, the bug isn't (in genetic terms) "recessive" (i.e. happens only
   when BOTH drivers misbehave) as my analysis would make you believe,
   but "dominant" (i.e. can happen when either driver misbehaves).
I'll fix the dev_id problem in request_irq, but my reading of how
request_irq and free_irq works is that it finds the first matching
dev_id, and free's it.  So if only one driver is using a NULL irq, there
shouldn't be a problem.  If you think otherwise, could you do a bit more
investigating?  There may be something else that we're not seeing, and
that makes me nervous.
(Also, note that until recently, the serial driver didn't allow IRQ
sharing at all, so the 2.2 serial driver, which doesn't support PCI,
shouldn't really be a problem except for PCMCIA cards, which were the
only exeception to that rule to support multifunction serial/network
cards, and none of the ethernet drivers are affected.  So the current
2.2 serial driver shouldn't be causing any problems as far as I can
tell.)
						- Ted
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/