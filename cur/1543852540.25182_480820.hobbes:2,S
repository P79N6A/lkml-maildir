Date: Thu, 09 Nov 2006 16:25:26 +0100
From: Mike Galbraith <>
Subject: Re: 2.6.19-rc5 breaks klogd 1.4.1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/11/9/108

On Thu, 2006-11-09 at 11:11 +0100, Mike Galbraith wrote:
> On Wed, 2006-11-08 at 23:35 -0800, Andrew Morton wrote:
> 
> > And, predictably, reads from /proc/kmsg aren't blocking.
> > 
> > I can't see what might have caused that.  Are you sure that 2.6.19-rc4 was
> > OK?  And are you sure that nothing else has changed on that system?
> 
> Here, both rc4 and rc5 do the same if printk is configured out.
Well duh, of course it does.  Testing and _then_ looking at the source
was not the correct order in this case :)
> Why do we have a /proc/ksmg when nothing can get to it?
The sensible thing seemed to be to whack it, but when I did that, klogd
just switched interfaces, and proceeded to eat 100% cpu doing
syslog(0x2, 0xb7fc0008, 0x1ffff) instead.  Leaving it in place, but
making it block to simulate an empty buffer works fine, but seems kinda
cheezy.
Whacking /proc/kmsg, and making sys_syslog() block on read to simulate
the empty buffer seemed much better, but SuSE's boot scripts hang when
they try to create /var/log/boot.msg ala /sbin/klogd -s -o -n
-f /var/log/boot.msg.  That seems to work now only because there is
always something there to grab.
The correct answer seems to be "fix klogd, or don't disable printk".
	-Mike
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/