Date: Wed, 17 Oct 2007 10:05:34 +0200
From: Jens Axboe <>
Subject: Re: [PATCH] swiotlb: fix map_sg failure handling
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/17/66

On Wed, Oct 17 2007, FUJITA Tomonori wrote:
> sg list elements might not be continuous.
> 
> Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp>
> ---
>  lib/swiotlb.c |    2 +-
>  1 files changed, 1 insertions(+), 1 deletions(-)
> 
> diff --git a/lib/swiotlb.c b/lib/swiotlb.c
> index c419ecf..752fd95 100644
> --- a/lib/swiotlb.c
> +++ b/lib/swiotlb.c
> @@ -696,7 +696,7 @@ swiotlb_map_sg(struct device *hwdev, struct scatterlist *sgl, int nelems,
>  				/* Don't panic here, we expect map_sg users
>  				   to do proper error handling. */
>  				swiotlb_full(hwdev, sg->length, dir, 0);
> -				swiotlb_unmap_sg(hwdev, sg - i, i, dir);
> +				swiotlb_unmap_sg(hwdev, sgl, i, dir);
>  				sgl[0].dma_length = 0;
>  				return 0;
>  			}
Auch indeed, no math on sg entries! Applied.
-- 
Jens Axboe
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/