Date: Fri, 4 Aug 2000 12:52:01 -0400
From: Simon Kirby <>
Subject: 2.4.0-test6-pre2 EXT2-related Lockup [Was: Re: 2.4.0-test6-pre2 man euid error]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/4/90

On Fri, Aug 04, 2000 at 12:44:12AM -0700, Conrad Heiney wrote:
> When I moved from 2.4.0-test5 to 2.4.0-test6 (pre1 and now pre2) I lost the ability to run the 'man' command as an ordinary user. When running the command (e.g., "man man") I get an error that I am unable to set effective user ID, and permission denied.
> 
> I am using Debian Woody on Intel. Any details needed, I can supply.
Same here, also with woody.  I just tried to strace it as root to see if
I could find what would be failing and was hit with a nice lockup! :)
Dual SMP, gcc version 2.95.2 20000220 (oops), reproducible every time. 
Al, you did some EXT2 locking/cleanup changes recently, right?
Traces of sysreq-P from serial console:
[sroot@oof:/root]# grep EIP: /foo/tmp/cap | sed 's/EIP: 0010:/Trace: /' | cut -f1-2 -d' ' | sort -u | ksymoops
Trace; c014c700 <ext2_get_block+64/59c>
Trace; c014c715 <ext2_get_block+79/59c>
Trace; c014c730 <ext2_get_block+94/59c>
Trace; c014c74f <ext2_get_block+b3/59c>
Trace; c014c751 <ext2_get_block+b5/59c>
Trace; c014c8f3 <ext2_get_block+257/59c>
Trace; c014c960 <ext2_get_block+2c4/59c>
Trace; c014c994 <ext2_get_block+2f8/59c>
Trace; c014c9ae <ext2_get_block+312/59c>
Trace; c014c9c2 <ext2_get_block+326/59c>
Trace; c014c9c4 <ext2_get_block+328/59c>
Trace; c014c9e2 <ext2_get_block+346/59c>
Trace; c014c9ec <ext2_get_block+350/59c>
Trace; c014ca04 <ext2_get_block+368/59c>
Trace; c014ca1b <ext2_get_block+37f/59c>
Trace; c014ca26 <ext2_get_block+38a/59c>
Trace; c014cc00 <ext2_get_block+564/59c>
Trace; c022c4cb <stext_lock+3927/86d8>
Trace; c022c4d2 <stext_lock+392e/86d8>
(gdb) x/5i 0xc022c4cb
0xc022c4cb <stext_lock+14631>:  cmpb   $0x0,0xc02859e0
0xc022c4d2 <stext_lock+14638>:  repz nop
0xc022c4d4 <stext_lock+14640>:  jle    0xc022c4cb <stext_lock+14631>
0xc022c4d6 <stext_lock+14642>:  jmp    0xc0186508 <tty_write+464>
0xc022c4db <stext_lock+14647>:  call   0xc01092b4 <__up_wakeup>
(gdb) x/5i 0xc0186508
0xc0186508 <tty_write+464>:     lock decb 0xc02859e0
0xc018650f <tty_write+471>:     js     0xc022c4cb <stext_lock+14631>
0xc0186515 <tty_write+477>:     push   %edx
0xc0186516 <tty_write+478>:     push   %edi
0xc0186517 <tty_write+479>:     mov    0x30(%esp,1),%eax
(gdb) x/x 0xc02859e0
0xc02859e0 <kernel_flag>:       0x00000001
Hmm... the lockup I got the first time I tried to see what was happening
is different from this one (which happened the second time), but it seems
to be similar:
Trace; c014c700 <ext2_get_block+64/59c>
Trace; c014c70c <ext2_get_block+70/59c>
Trace; c014c721 <ext2_get_block+85/59c>
Trace; c014c730 <ext2_get_block+94/59c>
Trace; c014c73a <ext2_get_block+9e/59c>
Trace; c014c74f <ext2_get_block+b3/59c>
Trace; c014c751 <ext2_get_block+b5/59c>
Trace; c014c8ba <ext2_get_block+21e/59c>
Trace; c014c960 <ext2_get_block+2c4/59c>
Trace; c014c98c <ext2_get_block+2f0/59c>
Trace; c014c994 <ext2_get_block+2f8/59c>
Trace; c014c9a9 <ext2_get_block+30d/59c>
Trace; c014c9ae <ext2_get_block+312/59c>
Trace; c014c9b0 <ext2_get_block+314/59c>
Trace; c014c9c2 <ext2_get_block+326/59c>
Trace; c014c9c4 <ext2_get_block+328/59c>
Trace; c014c9db <ext2_get_block+33f/59c>
Trace; c014c9f3 <ext2_get_block+357/59c>
Trace; c014ca04 <ext2_get_block+368/59c>
Trace; c014ca0e <ext2_get_block+372/59c>
Trace; c014ca1b <ext2_get_block+37f/59c>
Trace; c014ca24 <ext2_get_block+388/59c>
Trace; c014ca26 <ext2_get_block+38a/59c>
Trace; c014cc00 <ext2_get_block+564/59c>
Trace; c022acb6 <stext_lock+2112/86d8>
Trace; c022acbd <stext_lock+2119/86d8>
(gdb) x/5i 0xc022acb6
0xc022acb6 <stext_lock+8466>:   cmpb   $0x0,0xc02859e0
0xc022acbd <stext_lock+8473>:   repz nop
0xc022acbf <stext_lock+8475>:   jle    0xc022acb6 <stext_lock+8466>
0xc022acc1 <stext_lock+8477>:   jmp    0xc013c5c7 <sys_ioctl+59>
0xc022acc6 <stext_lock+8482>:   call   0xc0109290 <__down_failed>
(gdb) x/5i 0xc013c5c7
0xc013c5c7 <sys_ioctl+59>:      lock decb 0xc02859e0
0xc013c5ce <sys_ioctl+66>:      js     0xc022acb6 <stext_lock+8466>
0xc013c5d4 <sys_ioctl+72>:      cmp    $0x5450,%edi
0xc013c5da <sys_ioctl+78>:      je     0xc013c620 <sys_ioctl+148>
0xc013c5dc <sys_ioctl+80>:      ja     0xc013c5f0 <sys_ioctl+100>
...Still the BKL.
I'll try again with pre1...
Simon-
[  Stormix Technologies Inc.  ][  NetNation Communications Inc. ]
[       sim@stormix.com       ][       sim@netnation.com        ]
[ Opinions expressed are not necessarily those of my employers. ]
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/