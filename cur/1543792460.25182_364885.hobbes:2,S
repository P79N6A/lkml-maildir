Date: Tue, 8 Nov 2005 17:38:05 +0100
From: Rolf Eike Beer <>
Subject: Re: oops with USB Storage on 2.6.14
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/11/8/159

Am Dienstag, 8. November 2005 17:24 schrieb goggin, edward:
>I've run into a bug like this several times using 2.6.14-rc4 while
>testing dm-multipath's reaction to uevents generated by forcing
>fiber channel transport failures -- which leads to the scsi device
>being detached and the queuedata pointer in the device's queue being
>reset in scsi_device_dev_release.  The fix I've used is below and
>it seems to work well for me.  I was going to place this patch on
>dm-devel today or tomorrow anyway.
>
>drivers/scsi/scsi_lib.c:scsi_next_command()
>Call scsi_device_get and scsi_device_put around the calls to
>scsi_put_command
>and scsi_run_queue so that the scsi host structure will not be de-allocated
>between scsi_put_command and scsi_run_queue.
>
>*** ../base/linux-2.6.14-rc4/drivers/scsi/scsi_lib.c	Mon Oct 10 20:19:19
>2005
>--- drivers/scsi/scsi_lib.c	Thu Nov  3 13:30:03 2005
>***************
>*** 592,601 ****
Your patch is linewrapped. Also please use unified diff format, good choice 
for diff options is "-Naurp".
Eike
[unhandled content-type:application/pgp-signature]