Date: Fri, 19 Sep 2003 15:16:23 -0400
From: Rob Landley <>
Subject: Re: Make modules_install doesn't create /lib/modules/$version
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/19/118

On Friday 19 September 2003 12:01, Martin Schlemmer wrote:
> On Fri, 2003-09-19 at 11:10, Mikael Pettersson wrote:
> > Martin Schlemmer writes:
> >  > On Fri, 2003-09-19 at 04:25, Rusty Russell wrote:
> >  > > In message <20030918091511.276309a6.rddunlap@osdl.org> you write:
> >  > > > On Thu, 18 Sep 2003 03:21:40 -0400 Rob Landley <rob@landley.net> 
wrote:
> >  > > > | I've installed -test3, -test4, and now -test5, and each time
> >  > > > | make modules_install died with the following error:
> >  > > > |
> >  > > > | Kernel: arch/i386/boot/bzImage is ready
> >  > > > | sh arch/i386/boot/install.sh 2.6.0-test5 arch/i386/boot/bzImage
> >  > > > | System.map "" /lib/modules/2.6.0-test5 is not a directory.
> >  > >
> >  > > Looks like arch/i386/boot/install.sh is calling ~/bin/installkernel
> >  > > or /sbin/installkernel, which is not creating the directory.
> >  > >
> >  > > Should depmod create the directory?  It can, of course, but AFAICT
> >  > > the old one didn't.
> >  > >
> >  > > Maybe a RedHat issue?
> >  >
> >  > Likely, it works fine here with the one we are using
> >  > from debianutils.
> >
> > So how come it's never been a problem on my RH boxes?
> > (Currently RH9 + module-init-tools but none of Arjan's .rpms)
> >
> > I basically do
> > make bzImage modules |& tee /tmp/log
> > grep Warning /tmp/log
> > su
> > make modules_install
> > make install
> >
> > Creating the /lib/modules/<version> directory is the kernel's
> > job, not installkernel (it's never done that before).
>
> Yes, OK, so I have not checked =)  I just reacted on if
> installkernel form non RH misbehave or not.
The kernel isn't doing it.  A script called from installkernel (in Red Hat 9) 
calls depmod, which has to be Rusty's new depmod or it doesn't create the 
directory.  This means depmod is running against the OLD modules.
I've been bitten by this before, by the way.  I switched from an accidental 
SMP kernel to a UP kernel on my laptop, and the install complained about 
unresolved SMP symbols in the modules.  (This is how I got in the habit of 
doing make modules_install before make install, which I thought might also be 
responsible for the directory creation problem, but wasn't.  Neither creates 
the directory: depmod does).
Rob
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/