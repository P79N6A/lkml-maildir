Date: Wed, 30 Jan 2008 09:56:41 +0100
From: Haavard Skinnemoen <>
Subject: Re: [RFC v2 0/5] dmaengine: Slave DMA interface and example users
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/30/83

On Tue, 29 Jan 2008 22:56:14 -0800
David Brownell <david-b@pacbell.net> wrote:
> On Tuesday 29 January 2008, Haavard Skinnemoen wrote:
> >
> > Btw, there's one issue I forgot to mention: I believe the DMA Engine
> > framework is currently misusing the DMA mapping API, and this patchset
> > makes things worse.
> > 
> > Currently, the async_tx bits of the API do the required calls to
> > dma_map_single() and/or dma_map_page(), but they rely on the driver to
> > do the unmapping. This is problematic ...
> > 
> > How do we solve this?  
> 
> How about:  for peripheral DMA, don't let the engine see anything
> except dma_addr_t values.
I don't think it does, but the dma_addr_t value is enough to call
dma_unmap_single() and dma_unmap_page().
> The engine needs to be able to dma_alloc_coherent() memory too,
> which is pre-mapped.
Right, which is another argument for not doing any unmapping in the DMA
engine driver. We really need to push this responsibility to the client.
Haavard