Date: Mon, 05 May 2008 12:14:23 +1000
From: John Williams <>
Subject: Re: [PATCH 13/56] microblaze_v2: PVR support, cpuinfo support
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/5/4/320

> +int cpu_has_pvr(void)
> +{
> +	unsigned flags;
> +	unsigned pvr0;
> +	int ret = 0;
> +
> +	local_irq_save(flags);
> +
...
> +out:
> +	local_irq_restore(flags);
> +	return ret;
> +}
The actual IRQ clear/restore is not required - can you just use
local_save_flags() or similar to read the MSR?