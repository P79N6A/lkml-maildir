Date: 14 Mar 1999 15:56:54 +0100
From: Turbo Fredriksson <>
Subject: booting via bootparamd/rbootd
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/3/14/33

I'm trying to boot my HP9000/433 from my Linux machine by using rbootd
and bootparamd on the Linux machine.
The  HP (milpix)  is getting  the kernel  options/bootloaders  and the
kernel  from the  Linux machine  (papadoc), and  the NetBSD  kernel is
booting, but  when it  tries to  mount the root  fs from  papadoc, the
NetBSD kernel times out.
When papadoc is running 2.0.36-ac15, everything is working as it should,
but I have tried both 2.2.2, 2.2.3 and 2.2.3-ac1 with and without KNFSD
support, without luck.
It  seems like  bootparamd 'gives  up' after  the first  connect... It
answer the  first time (when  the bootloader is fetching  the kernel),
but not the second time (when the kernel wants to mount the fs)
Is there any '/proc/sys/net/ipv4/*' option I have forgotten about?
I read about  ip_bootp_agent in the kernel docs, but  can not find any
reference to that in ether the kernel sources, nor in the directory
----- [tcpdump -i eth1] -----
tcpdump: listening on eth1
15:50:09.713174 arp who-has milpix.bergsjon.gbg.org tell milpix.bergsjon.gbg.org
15:50:09.714994 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
15:50:10.715313 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
15:50:12.715253 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
15:50:15.715234 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
15:50:19.715224 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
15:50:22.399304 ns.bergsjon.gbg.org.who > 42.42.40.255.who: udp 180
15:50:24.759025 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
15:50:29.798998 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
15:50:34.839006 milpix.bergsjon.gbg.org.1023 > 42.255.255.255.sunrpc: udp 96
----- [strace on bootparamd -d] -----
3542  execve("/usr/sbin/rpc.bootparamd", ["rpc.bootparamd", "-d", "-s", "-r", "42.42.40.90", "-f", "/etc/bootparams"], [/* 38 vars */]) = 0
3542  brk(0)                            = 0x804bbd0
3542  open("/etc/ld.so.preload", O_RDONLY) = 4
3542  fstat(4, {st_mode=0403, st_size=0, ...}) = 0
3542  mmap(0, 18, PROT_READ|PROT_WRITE, MAP_PRIVATE, 4, 0) = 0x4000c000
3542  close(4)                          = 0
3542  open("/lib/nfslock.so.0", O_RDONLY) = 4
3542  mmap(0, 4096, PROT_READ, MAP_PRIVATE, 4, 0) = 0x4000d000
3542  munmap(0x4000d000, 4096)          = 0
3542  mmap(0, 8024, PROT_READ|PROT_EXEC, MAP_PRIVATE, 4, 0) = 0x4000d000
3542  mprotect(0x4000e000, 3928, PROT_NONE) = 0
3542  mmap(0x4000e000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 4, 0) = 0x4000e000
3542  close(4)                          = 0
3542  munmap(0x4000c000, 18)            = 0
3542  open("/etc/ld.so.cache", O_RDONLY) = 4
3542  fstat(4, {st_mode=S_ISUID|01, st_size=0, ...}) = 0
3542  mmap(0, 26923, PROT_READ, MAP_PRIVATE, 4, 0) = 0x4000f000
3542  close(4)                          = 0
3542  open("/lib/libc.so.6", O_RDONLY)  = 4
3542  mmap(0, 4096, PROT_READ, MAP_PRIVATE, 4, 0) = 0x4000c000
3542  munmap(0x4000c000, 4096)          = 0
3542  mmap(0, 673220, PROT_READ|PROT_EXEC, MAP_PRIVATE, 4, 0) = 0x40016000
3542  mprotect(0x400a8000, 75204, PROT_NONE) = 0
3542  mmap(0x400a8000, 28672, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 4, 0x91000) = 0x400a8000
3542  mmap(0x400af000, 46532, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x400af000
3542  close(4)                          = 0
3542  munmap(0x4000f000, 26923)         = 0
3542  personality(PER_LINUX)            = 0
3542  getpid()                          = 3542
3542  stat("/etc/bootparams", {st_mode=0, st_size=0, ...}) = 0
3542  socket(PF_INET, SOCK_DGRAM, IPPROTO_IP) = 4
3542  ioctl(4, SIOCGIFCONF, 0xbfffd7dc) = 0
3542  ioctl(4, SIOCGIFFLAGS, 0xbfffd7e4) = 0
3542  close(4)                          = 0
3542  brk(0)                            = 0x804bbd0
3542  brk(0x804bbf0)                    = 0x804bbf0
3542  brk(0x804c000)                    = 0x804c000
3542  gettimeofday({921422328, 718948}, NULL) = 0
3542  getpid()                          = 3542
3542  socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP) = 4
3542  getpid()                          = 3542
3542  bind(4, {sin_family=AF_INET, sin_port=htons(750), sin_addr=inet_addr("0.0.0.0")}, 16) = -1 EADDRINUSE (Address already in use)
3542  bind(4, {sin_family=AF_INET, sin_port=htons(751), sin_addr=inet_addr("0.0.0.0")}, 16) = 0
3542  ioctl(4, FIONBIO, [1])            = 0
3542  sendto(4, "7\341<J\0\0\0\0\0\0\0\2\0\1\206\240"..., 56, 0, {sin_family=AF_INET, sin_port=htons(111), sin_addr=inet_addr("127.0.0.1")}, 16) = 56
3542  getrlimit(RLIMIT_NOFILE, {rlim_cur=1024, rlim_max=1024}) = 0
3542  select(1024, [4], NULL, NULL, {5, 0}) = 1 (in [4], left {5, 0})
3542  recvfrom(4, "7\341<J\0\0\0\1\0\0\0\0\0\0\0\0\0"..., 400, 0, {sin_family=AF_INET, sin_port=htons(111), sin_addr=inet_addr("127.0.0.1")}, [16]) = 28
3542  close(4)                          = 0
3542  socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP) = 4
3542  bind(4, {sin_family=AF_INET, sin_port=htons(752), sin_addr=inet_addr("0.0.0.0")}, 16) = 0
3542  getsockname(4, {sin_family=AF_INET, sin_port=htons(752), sin_addr=inet_addr("0.0.0.0")}, [16]) = 0
3542  brk(0x804f000)                    = 0x804f000
3542  brk(0x8051000)                    = 0x8051000
3542  socket(PF_INET, SOCK_DGRAM, IPPROTO_IP) = 5
3542  ioctl(5, SIOCGIFCONF, 0xbfffd7a8) = 0
3542  ioctl(5, SIOCGIFFLAGS, 0xbfffd7b0) = 0
3542  close(5)                          = 0
3542  gettimeofday({921422328, 731433}, NULL) = 0
3542  getpid()                          = 3542
3542  socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP) = 5
3542  bind(5, {sin_family=AF_INET, sin_port=htons(753), sin_addr=inet_addr("0.0.0.0")}, 16) = 0
3542  ioctl(5, FIONBIO, [1])            = 0
3542  sendto(5, "7\340\355\7\0\0\0\0\0\0\0\2\0\1\206"..., 56, 0, {sin_family=AF_INET, sin_port=htons(111), sin_addr=inet_addr("127.0.0.1")}, 16) = 56
3542  select(1024, [5], NULL, NULL, {5, 0}) = 1 (in [5], left {5, 0})
3542  recvfrom(5, "7\340\355\7\0\0\0\1\0\0\0\0\0\0\0"..., 400, 0, {sin_family=AF_INET, sin_port=htons(111), sin_addr=inet_addr("127.0.0.1")}, [16]) = 28
3542  close(5)                          = 0
3542  select(1024, [4], NULL, NULL, NULL) = ? ERESTARTNOHAND (To be restarted)
3542  --- SIGINT (Interrupt) ---
3542  +++ killed by SIGINT +++
----- [output from bootparamd] -----
(absolutly nothing!)
-- 
 Turbo     __ _     Debian GNU     Unix _IS_ user friendly - it's just 
 ^^^^^    / /(_)_ __  _   ___  __  selective about who its friends are 
         / / | | '_ \| | | \ \/ /   Debian Certified Linux Developer  
  _ /// / /__| | | | | |_| |>  <  Turbo Fredriksson   turbo@tripnet.se
  \\\/  \____/_|_| |_|\__,_/_/\_\ Gothenburg/Sweden
-- 
nuclear Ft. Meade munitions security cracking Uzi NORAD Treasury
plutonium Kennedy SDI Noriega CIA FBI counter-intelligence
[unhandled content-type:application/pgp-signature]