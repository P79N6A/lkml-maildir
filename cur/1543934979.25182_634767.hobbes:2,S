Date: 06 Jan 2008 11:17:46 +0100
From: Peter Osterlund <>
Subject: Re: [patch] scsi: revert "[SCSI] Get rid of scsi_cmnd->done"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/6/45

Linus Torvalds <torvalds@linux-foundation.org> writes:
> Does a patch like this change the behaviour you see at all?
> +			bd_inode->i_size = (loff_t)get_capacity(disk)<<9;
It does fix my scenario, with the trivial fix of adding bdev-> at the
beginning of that line, ie:
diff --git a/fs/block_dev.c b/fs/block_dev.c
index 993f78c..a8ed344 100644
--- a/fs/block_dev.c
+++ b/fs/block_dev.c
@@ -1191,6 +1191,7 @@ static int do_open(struct block_device *bdev, struct file *file, int for_part)
 			}
 			if (bdev->bd_invalidated)
 				rescan_partitions(bdev->bd_disk, bdev);
+			bdev->bd_inode->i_size = (loff_t)get_capacity(disk)<<9;
 		}
 	}
 	bdev->bd_openers++;
-- 
Peter Osterlund - petero2@telia.com
http://web.telia.com/~u89404340