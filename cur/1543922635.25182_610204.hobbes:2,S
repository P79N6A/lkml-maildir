Date: Thu, 25 Oct 2007 18:37:21 -0700
From: Paul Jackson <>
Subject: Re: [2.6 patch] kernel/cgroup.c: remove dead code
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/25/532

pj wrote:
> Check out the assembly code generated by:
>
>     BUG_ON(sizeof(cgrp->root->release_agent_path) < PATH_MAX));
>
> (Hint: you can't find it ;)
>
> It -is- compile time!
To be clear, BUG_ON() in general is a runtime check.
But the compiler can optimize out constant expressions,
and code conditionally executed in the case of a constant
that can never be true.
Adrian wrote:
> > It -is- compile time!
> 
> But when the condition is fulfilled, you get a runtime error, not a 
> compile error.
Correct you are.  And when I advocated BUG_ON in this role, I did
two things:
 1) I was blissfully ignorant of BUILD_BUG_ON(), which would be
    better here, for the reasons you state, and
 2) I did a silent calculation in my head, noticing that if the
    constants ever changed so as to trigger this check, it would
    show up really quickly in testing, because it was on code path
    that would be hard to miss.  Because of this, the delay until
    runtime of this check was less of a disaster than it would
    have been on a rarely traveled code path.
In sum - Adrian is right - use BUILD_BUG_ON() here.
Thanks, Adrian.
-- 
                  I won't rest till it's the best ...
                  Programmer, Linux Scalability
                  Paul Jackson <pj@sgi.com> 1.925.600.0401
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/