Date: Fri, 12 Nov 2004 10:50:58 +0000
From: David Howells <>
Subject: [PATCH] Fix SHMEM options
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/11/12/40

> This change permits CONFIG_SHMEM=n on !CONFIG_MMU, even if !EMBEDDED.  Or
> something.  I'm not really sure what it's trying to do, nor am I clear on
> what semantics we wanted to have for CONFIG_SHMEM on CONFIG_MMU machines.
> 
> I think the semantics we want are: you always get shmem, unless you
> selected EMBEDDED.  So perhaps we want:
It boils down to:
 (1) You can't use full shmem if !MMU. You have to use tinyshmem instead.
 (2) On an embedded system, you might want to drop shmem because you don't
     have much flash in which to store your kernel.
This seems to have the desired effect:
	config SHMEM
		bool "Use full shmem filesystem" if EMBEDDED
		depends on MMU
		default y if MMU
David
---
The attached patch fixes the semantics of the SHMEM kernel configuration
option. Manual selectability is not contingent on EMBEDDED being configured,
and the option as a whole is only available if MMU is configured.
Signed-Off-By: David Howells <dhowells@redhat.com>
---
diff -uNrp /warthog/kernels/linux-2.6.10-rc1-mm5/init/Kconfig linux-2.6.10-rc1-mm5-frv/init/Kconfig
--- /warthog/kernels/linux-2.6.10-rc1-mm5/init/Kconfig	2004-11-11 11:48:41.000000000 +0000
+++ linux-2.6.10-rc1-mm5-frv/init/Kconfig	2004-11-12 10:40:28.583887179 +0000
@@ -327,8 +327,8 @@ config CC_OPTIMIZE_FOR_SIZE
 	  If unsure, say N.
 
 config SHMEM
-	bool "Use full shmem filesystem"
-	default y if EMBEDDED
+	bool "Use full shmem filesystem" if EMBEDDED
+	default y if MMU
 	depends on MMU
 	help
 	  The shmem is an internal filesystem used to manage shared memory.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/