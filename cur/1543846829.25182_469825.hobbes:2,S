Date: Thu, 5 Oct 2006 01:36:35 -0700
From: Andrew Morton <>
Subject: Re: [PATCH] Fix WARN_ON / WARN_ON_ONCE regression
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/5/62

On Thu, 5 Oct 2006 04:13:07 -0400
Andrew James Wade <andrew.j.wade@gmail.com> wrote:
> (from earlier)
> > Perhaps the `static int __warn_once' is getting put in the same cacheline
> > as some frequently-modified thing.
> 
> hmm:
> 
> 00000460 l     O .data  00000044 task_exit_notifier
> 000004c0 l     O .data  0000002c task_free_notifier
> 000004ec l     O .data  00000004 warnlimit.15904
> 000004f0 l     O .data  00000004 firsttime.15774
> 000004f4 l     O .data  00000004 __warn_once.15180
> 000004f8 l     O .data  00000004 __warn_once.15174
> 000004fc l     O .data  00000004 __warn_once.15213
> 00000500 l     O .data  00000004 __warn_once.15207
> 00000504 l     O .data  00000004 __warn_once.15145
> 00000508 l     O .data  00000004 __warn_once.15309
> 0000050c l     O .data  00000004 __warn_once.15256
> 00000510 l     O .data  00000004 __warn_once.15250
> 000005a0 l     O .data  0000006c proc_iomem_operations
> (extracted from objdump -t kernel/built-in.o)
That all looks OK (by sheer luck).
Well.  What's the cache line size on that machine?  Every exit() will cause
a down_read() on task_exit_notifier's lock which might affect things.  And
I think you snipped the above list a bit short (depending on that line
size).
But still, we know that moving those things into __read_mostly didn't fix
it, yes?
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/