Date: Wed, 28 Jul 2004 12:25:47 +0200
From: Olaf Hering <>
Subject: [PATCH] mark swim3 floppy controller as removable device
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/7/28/68

Mark the mac floppy controller driver as removable media.
This prevents an entry in /proc/partitions.
Several tools will not try to access the floppy anymore with
this change.
Signed-off-by: Olaf Hering <olh@suse.de>
diff -purN linux-2.6.8-rc2-bk6.orig/drivers/block/swim3.c linux-2.6.8-rc2-bk6/drivers/block/swim3.c
--- linux-2.6.8-rc2-bk6.orig/drivers/block/swim3.c	2004-06-16 05:19:13.000000000 +0000
+++ linux-2.6.8-rc2-bk6/drivers/block/swim3.c	2004-07-28 10:11:37.236364106 +0000
@@ -1058,6 +1058,7 @@ int swim3_init(void)
 		disk->fops = &floppy_fops;
 		disk->private_data = &floppy_states[i];
 		disk->queue = swim3_queue;
+		disk->flags |= GENHD_FL_REMOVABLE;
 		sprintf(disk->disk_name, "fd%d", i);
 		sprintf(disk->devfs_name, "floppy/%d", i);
 		set_capacity(disk, 2880);
-- 
USB is for mice, FireWire is for men!
sUse lINUX ag, n√úRNBERG
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/