Date: Tue, 25 Jan 2005 14:02:43 -0800
From: Ram <>
Subject: Re: [RFC] shared subtrees
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/1/25/302

On Tue, 2005-01-25 at 13:47, Mike Waychison wrote:
 ...snip...
> > 
> > Question 2:
> > 
> > When a mount gets propogated to a slave, but the slave
> > has mounted something else at the same place, and hence 
> > that mount point is masked, what will happen?
> > 
> >         Concrete example:
> > 
> >         mount <device1> /tmp/mnt1
> >         mkdir -p /tmp/mnt1/a/b
> >         mount --rbind /tmp/mnt1 /tmp/mnt2
> >         mount --make-slave /tmp/mnt2
> 
> EINVAL.  You should only be able to demote a mountpoint to a slave if it
> was part of a p-node (shared).
oops. I had the following in mind.
	mount <device1> /tmp/mnt1
      **  mount --make-shared /tmp/mnt1  **
        mkdir -p /tmp/mnt1/a/b
        mount --rbind /tmp/mnt1 /tmp/mnt2
        mount --make-slave /tmp/mnt2
In this case it cannot be EINVAL, because /tmp/mnt1 and /tmp/mnt2 will
both be part of a pnode and hence /tmp/mnt2 can be demoted to be a
slave. 
> 
> >         mount <device2> /tmp/mnt2/a
> >         rm -f /tmp/mnt2/a/*
> > 
> >         what happens when a mount is attempted on /tmp/mnt1/a/b?
> >         will that be reflected in /tmp/mnt2/a ?
> > 
> >         I believe the answer is 'no', because that part of the subtree 
> >         in /tmp/mnt2 no more mirrors its parent subtree.
> > 
> > RP 
> > 
> > -
> > To unsubscribe from this list: send the line "unsubscribe linux-fsdevel" in
> > the body of a message to majordomo@vger.kernel.org
> > More majordomo info at  
http://vger.kernel.org/majordomo-info.html
> 
> 
> - --
> Mike Waychison
> Sun Microsystems, Inc.
> 1 (650) 352-5299 voice
> 1 (416) 202-8336 voice
> 
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> NOTICE:  The opinions expressed in this email are held by me,
> and may not represent the views of Sun Microsystems, Inc.
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.2.5 (GNU/Linux)
> Comment: Using GnuPG with Thunderbird - 
http://enigmail.mozdev.org
> 
> iD8DBQFB9r5YdQs4kOxk3/MRApT3AJ9xxpdacU0mp8IvsY395MDtEktJ+wCeOvRT
> /g7qXO9nGxMT/iFAZoUO8F4=
> =9D2G
> -----END PGP SIGNATURE-----
> -
> To unsubscribe from this list: send the line "unsubscribe linux-fsdevel" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  
http://vger.kernel.org/majordomo-info.html
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/