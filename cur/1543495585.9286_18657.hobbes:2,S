Date: Wed, 12 May 1999 19:14:56 -0700
From:  cjohnson@kookie ...
Subject: Re: 2.2.7 - brief net loss, message logged
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/5/13/102

    > eth0: insufficient memory; nuking packet
    > Last message repeated ~6000 times
Assuming you aren't really out of memory/swap, you may be
bumping into a problem we found under heavy 100bT load.
We have a 2.0.34 kernel, and I'm not a linux expert, so
feel free to be skeptical of the following.
Under heavy load the network layer can surge to consume all
the available memory that the paging system has reserved.
Since the page daemon runs as a kernel process, and the
interrupt and protocol layers starve the scheduler, there
is no way to free up more memory even if plenty of swap is
available.
I fixed it by adding routines to reserve/free "physical"
memory.  Reserve boosts min_free_pages and friends so that
physical resources will be available during interrupt surges
when the pager can't run.  Then I made a tweak to net/dev.c
to reserve the memory necessary for the backlog queue.
Packets still fall on the floor under heavy load, but at
least memory isn't exhausted.
I would post a patch, but I have no confidence that the
2.0.34 diff would have any use in any other universe.
Feel free to suggest other treatments.
Cheers,
cj*
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/