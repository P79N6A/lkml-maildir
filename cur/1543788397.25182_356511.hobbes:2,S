Date: Thu, 06 Oct 2005 20:49:06 +0200
From: Miklos Szeredi <>
Subject: Re: [RFC] atomic create+open
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/10/6/223

> > And if the bind is umounted after NFS determined not to open the file,
> > and at the same time it changes to a symlink on the server (not very
> > likely I agree, but possible nonetheless), then shit happens.
> 
> Please elaborate. What would you expect to see happen in this situation?
For simplicity case let's omit the creation of simlink, just say, the
file is removed.
So NFS calls have_submounts(), which returns true.
Then the bind is umounted.  Nothing prevents this happening
concurrently with the lookup.
Then the file is removed on the server.
When open_namei() gets around to following the mounts, it is not there
any more, so the dentry for /mnt/foo (the NFS one is returned) and
NFS's ->open is called on the file, which returns -ENOENT.  But
open(..., O_CREAT, ...) should never return -ENOENT.
The symlink case is similar, just even more unlikely.
Miklos
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/