Date: Fri, 30 Aug 2002 15:53:06 -0700
From: Andrew Morton <>
Subject: Re: Oops after removing PCMCIA modem with low latency patch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/8/30/185

Diego Biurrun wrote:
> 
> Hello!
> 
> I just tried your 2.4.19-low-latency patch on a stock 2.4.19 kernel and
> my box oopses when I manually remove my PCMCIA modem.
Yup.  The pcmcia drivers like to call sleeping devfs functions
from within a timer handler.  The kernel tries to perform a
context switch in interrupt context and bugs out.  This can happen
without the low-latency patch, but doesn't.
The fix for that is to change the (strange) deferred deregister thing
in several of the CardServices drivers to punt the activity up to
process context via schedule_task(), but nobody has done that yet.
Probably, you can add
	if (in_interrupt())
		return;
to schedule() to make the BUGs go away.   Not using devfs makes
them go away too - but it is not a devfs bug.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/