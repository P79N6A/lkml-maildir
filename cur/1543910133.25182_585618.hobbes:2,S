Date: Fri, 17 Aug 2007 16:03:14 +0300
From: Avi Kivity <>
Subject: Re: [kvm-devel] [PATCH/RFC 4/4,	second shot]KVM uses "account_guest_time()"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/17/122

Laurent Vivier wrote:
> KVM updates vtime in task_struct to allow account_guest_time() to modify user,
> system and guest time in cpustat accordingly.
> 
> --- kvm.orig/drivers/kvm/Kconfig	2007-08-17 10:24:46.000000000 +0200
> +++ kvm/drivers/kvm/Kconfig	2007-08-17 10:25:25.000000000 +0200
> @@ -41,4 +41,10 @@
>  	  Provides support for KVM on AMD processors equipped with the AMD-V
>  	  (SVM) extensions.
> 
> +config GUEST_ACCOUNTING
> +	bool "Virtual Machine accounting support"
> +	depends on KVM
> +	---help---
> +	  Allows to account CPU time used by the Virtual Machines.
> +
Other way round.  In the patch that adds account_guest_time(), have a
CONFIG_GUEST_ACCOUNTING (defaulting to n, with no description, help, or
dependencies.  Then, CONFIG_KVM can select GUEST_ACCOUNTING.
The advantages of this are:
- the puppyvisor can also select this if it so wishes
- we don't have core code reference some obscure module
CONFIG_PREEMPT_NOTIFIERS does the same thing.
-- 
Do not meddle in the internals of kernels, for they are subtle and quick to panic.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/