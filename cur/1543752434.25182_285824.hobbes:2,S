Date: Wed, 12 Jan 2005 15:27:58 -0600
From: James Nelson <>
Subject: [PATCH] vino: Remove cli()/sti() in drivers/media/video/vino.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/1/12/232

I know this driver isn't working, but cleanup is cleanup :)
Signed-off-by: James Nelson <james4765@gmail.com>
diff -urN --exclude='*~' linux-2.6.10-mm2-original/drivers/media/video/vino.c linux-2.6.10-mm2/drivers/media/video/vino.c
--- linux-2.6.10-mm2-original/drivers/media/video/vino.c	2005-01-08 12:16:37.000000000 -0500
+++ linux-2.6.10-mm2/drivers/media/video/vino.c	2005-01-12 16:14:54.940750449 -0500
@@ -48,7 +48,7 @@
 	unsigned long virt_addr = KSEG1ADDR(addr + VINO_BASE);
 	unsigned long flags;
 
-	save_and_cli(flags);
+	local_irq_save(flags);
 	__asm__ __volatile__(
 		".set\tmips3\n\t"
 		".set\tnoat\n\t"
@@ -60,7 +60,7 @@
 		:"r" (virt_addr),
 		 "r" (&ret)
 		:"$1");
-	restore_flags(flags);
+	local_irq_restore(flags);
 
 	return ret;
 }
@@ -74,7 +74,7 @@
 	/* we might lose the upper parts of the registers which are not saved
 	 * if there comes an interrupt in our way, play safe */
 
-	save_and_cli(flags);
+	local_irq_save(flags);
 	__asm__ __volatile__(
 		".set\tmips3\n\t"
 		".set\tnoat\n\t"
@@ -86,7 +86,7 @@
 		:"r" (&value),
 		 "r" (virt_addr)
 		:"$1");
-	restore_flags(flags);
+	local_irq_restore(flags);
 }
 
 static __inline__ void vino_reg_and(unsigned long long value,
@@ -95,7 +95,7 @@
 	unsigned long virt_addr = KSEG1ADDR(addr + VINO_BASE);
 	unsigned long flags;
 
-	save_and_cli(flags);
+	local_irq_save(flags);
 	__asm__ __volatile__(
 		".set\tmips3\n\t"
 		".set\tnoat\n\t"
@@ -109,7 +109,7 @@
 		:"r" (virt_addr),
 		 "r" (&value)
 		:"$1","$2");
-	restore_flags(flags);
+	local_irq_restore(flags);
 }
 
 static __inline__ void vino_reg_or(unsigned long long value,
@@ -118,7 +118,7 @@
 	unsigned long virt_addr = KSEG1ADDR(addr + VINO_BASE);
 	unsigned long flags;
 
-	save_and_cli(flags);
+	local_irq_save(flags);
 	__asm__ __volatile__(
 		".set\tmips3\n\t"
 		".set\tnoat\n\t"
@@ -132,7 +132,7 @@
 		:"r" (virt_addr),
 		 "r" (&value)
 		:"$1","$2");
-	restore_flags(flags);
+	local_irq_restore(flags);
 }
 
 static int vino_dma_setup(void)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/