Date: Wed, 21 Jun 2006 06:05:57 +0200
From: Willy Tarreau <>
Subject: Re: Linux 2.4.33-rc1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/6/21/4

Hi Grant,
On Wed, Jun 21, 2006 at 11:09:15AM +1000, Grant Coady wrote:
> >What puzzles me is how are we supposed to up(&nd.dentry->d_inode->i_sem) if
> >dentry->d_inode can become NULL ? simply by keeping a copy of it ? I thought
> >that the down() protected the whole thing, but may be that's stupid anyway.
> >I've been running rc1 without this patch for a few hours and during kernel
> >compiles without a problem, so I'm not sure about what to think about the
> >other changes which were apparently harmless too :-/
> 
> So what's the final fixup?  Last two patches don't seem to cause the 
> problems previously reported by me.  They don't play together though, 
> so I'll add my general sense of confusion to this issue ;)  
:-)
Marcelo's patch applies to sys_unlink(). It prevents sys_unlink() from
oopsing while releasing the inode's semaphore after vfs_unlink() has
nullified the inode pointer.
Mine did nearly the same within vfs_unlink(), where you got your original
oopses.
> Should I run the thing (which patch?) and compile a hundred kernels 
> or something to see what (if anything) breaks.  Shortest day of year 
> here, I don't mind running the test box as part of room heating :o)
If you want to heat your room, you should effectively apply both
patches, then run a hundred kernel compiles. Removing the "-pipe"
option to gcc would help a lot since it will have to create temp files.
> Thanks,
> Grant.
Thanks for your time,
Willy
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/