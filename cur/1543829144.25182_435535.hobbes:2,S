Date: Wed, 21 Jun 2006 23:55:40 -0700 (PDT)
From: Dave Olson <>
Subject: Re: [PATCH 3/6] Blacklist PCI-E chipsets depending on Hypertransport MSI capabality
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/6/22/40

On Wed, 21 Jun 2006, Brice Goglin wrote:
| [PATCH 3/6] Blacklist PCI-E chipsets depending on Hypertransport MSI capabality
| 
| Introduce msi_ht_cap_enabled() to check the MSI capability in the
| Hypertransport configuration space.
| It is used in a generic quirk quirk_msi_ht_cap() to check whether
| MSI is enabled on hypertransport chipset, and a nVidia specific quirk
| quirk_nvidia_ck804_msi_ht_cap() where two 2 HT MSI mappings have to
| be checked.
| Both quirks set the PCI_BUS_FLAGS_NO_MSI flags when MSI is disabled.
...
| Index: linux-mm/drivers/pci/quirks.c
| +/* Returns 1 if the HT MSI capability is found and enabled */
| +static pci_bus_flags_t __devinit msi_ht_cap_enabled(struct pci_dev *dev)
| +{
| +
| +	/* go through all caps looking for a hypertransport msi mapping */
| +	while (pci_read_config_byte(dev, cap_off + 1, &cap_off) == 0 &&
Perhaps this could be modified to use pci_find_capability() and pci_find_next_capability(),
rather than writing your own code to do it?
Dave Olson
olson@unixfolk.com
http://www.unixfolk.com/dave
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/