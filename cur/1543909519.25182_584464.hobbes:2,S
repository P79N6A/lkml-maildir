Date: Tue, 14 Aug 2007 21:12:20 +0100
From: Alasdair G Kergon <>
Subject: Re: [PATCH] remove unneded lock_kernel in drivers/md/dm.c and use unlocked_ioctl.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/14/317

On Mon, Jul 30, 2007 at 11:23:49PM -0300, Diego Woitasen wrote:
> -static int dm_blk_ioctl(struct inode *inode, struct file *file,
> -			unsigned int cmd, unsigned long arg)
> +static long dm_blk_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
> -	/* We don't really need this lock, but we do need 'inode'. */
> -	unlock_kernel();
> +	inode = file->f_path.dentry->d_inode;
Have the call paths that pass a NULL 'file' parameter down all been
changed?  If not, perhaps pass the 'inode' parameter into
unlocked_ioctl(), as happens with ioctl(), to get rid of the lock.
Alasdair
-- 
agk@redhat.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/