Date: Mon, 23 Jan 2006 18:52:20 -0800
From: john stultz <>
Subject: [PATCH -mm] Time: Keep clock=pmtmr functional, but depricated
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/23/366

With the new clocksource code, the ACPI PM timer is now called acpi_pm.
This has confused users that are familiar w/ using the clock=pmtmr boot
option.
This patch insures that the clock=pmtmr boot option will still function,
but will warn the users to use clocksource=acpi_pm in the future.
Signed-off-by: John Stultz <johnstul@us.ibm.com>
---
diff --git a/kernel/time/clocksource.c b/kernel/time/clocksource.c
index d62cff0..c974305 100644
--- a/kernel/time/clocksource.c
+++ b/kernel/time/clocksource.c
@@ -325,8 +325,13 @@ __setup("clocksource=", boot_override_cl
  */
 static int __init boot_override_clock(char* str)
 {
-	printk("Warning! clock= boot option is deprecated.\n");
-
+	if (!strcmp(str, "pmtmr")) {
+		printk("Warning: clock=pmtmr is depricated. "
+			"Use clocksource=acpi_pm.\n");
+		return boot_override_clocksource("acpi_pm");
+	}
+	printk("Warning! clock= boot option is deprecated. "
+		"Use clocksource=xyz\n");
 	return boot_override_clocksource(str);
 }
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/