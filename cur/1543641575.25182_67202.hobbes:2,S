Date: Thu, 29 Aug 2002 20:52:36 -0700 (PDT)
From: Andy Tai <>
Subject: file locking (fcntl) bug in 2.4.19
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/8/29/280

Hi, there is a bug on file locking (via fcntl) on
linux kernel 2.4.19 when locking files in a NFS
volume.
Try to mount a remote NFS server on a directory in a
machine running Linux 2.4.19 as follows:
mount -o nfsvers=3,intr <remote NFS server path> /mnt
Then run the attached program which demonstrates the
bug:
lockbug /mnt/xx
and it keeps showing the error 
lock failed with error: No locks available
The file has not been locked so there must be locks
available.  The error message is wrong.
Trying this on a file in a local drive does not show
the error.
The attached program basically forks a child and in
the child it tries to lock a file descriptor that was
opened in the parent.
Thanks for any help on working around this bug.
__________________________________________________
Do You Yahoo!?
Yahoo! Finance - Get real-time stock quotes
http://finance.yahoo.com
[unhandled content-type:application/octet-stream]