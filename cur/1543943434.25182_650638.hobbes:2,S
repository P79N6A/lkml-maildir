Date: Fri, 8 Feb 2008 14:02:44 -0800
From: Andrew Morton <>
Subject: Re: [PATCH 1/1] NBD: make nbd default to deadline I/O scheduler
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/8/454

On Fri, 08 Feb 2008 16:23:01 -0500
Paul Clements <paul.clements@steeleye.com> wrote:
> --- ./drivers/block/nbd.c.max_nbd_killed	2008-02-07 16:46:24.000000000 -0500
> +++ ./drivers/block/nbd.c	2008-02-08 16:13:01.000000000 -0500
> @@ -667,6 +667,12 @@ static int __init nbd_init(void)
>  			put_disk(disk);
>  			goto out;
>  		}
> +		if (elevator_init(disk->queue, "deadline") != 0) {
> +			if (elevator_init(disk->queue, "noop") != 0) {
> +				put_disk(disk);
> +				goto out;
> +			}
> +		}
>  	}
- if the user doesn't have deadline or noop configured, NBD will now
  fail.  That's a non-backward-compatible change.
- when it fails, it will fail silently.  Puzzled and angry users.
- when it fails, it will inappropriately return -ENOMEM.