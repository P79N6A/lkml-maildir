Date: Tue, 18 Oct 2005 15:15:26 +0400
From: Sergey Vlasov <>
Subject: Re: [PATCH] libata: fix broken Kconfig setup
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/10/18/70

On Mon, 17 Oct 2005 13:01:57 -0400 Jeff Garzik wrote:
> Here's a patch for the quirk.  I'll split this off from the sata-menu 
> discussion.  Jesse, I presume this also fixes the problem for you?
> 
> 
> This change makes quirk_intel_ide_combined() dependent on the precise 
> conditions under which it is needed:
> * IDE is built in
> * IDE SATA option is not set
> * ata_piix or ahci drivers are enabled
> 
> This fixes an issue where some modular configurations would not cause 
> the quirk to be enabled.
> 
> Signed-off-by: Jeff Garzik <jgarzik@pobox.com>
> +config SCSI_SATA_INTEL_COMBINED
> +	bool
> +	depends on IDE=y && !BLK_DEV_IDE_SATA && (SCSI_SATA_AHCI || SCSI_ATA_PIIX)
> +	default y
The IDE=y part seems to be incorrect - quirk_intel_ide_combined() is
needed even with modular IDE.  Without this quirk you will get one of
these configurations depending on the module load order:
1) ata_piix loads first - it grabs the whole controller, including the
PATA port; the IDE module loaded later finds nothing.
2) IDE modules are loaded first - without the quirk IDE drivers will
grab the whole controller, including the SATA part.
The binding you get with builtin IDE (ata_piix/ahci for SATA, generic
IDE driver for PATA) would be impossible to get with modular IDE without
the quirk, which does not seem to be good...
[unhandled content-type:application/pgp-signature]