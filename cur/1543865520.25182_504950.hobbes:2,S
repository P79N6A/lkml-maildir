Date: Sun, 04 Feb 2007 11:42:33 -0600
From: Larry Finger <>
Subject: Re: Bcm43xx oops after suspend to disk
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/4/104

roucaries bastien wrote:
> 
> Sorry for the delay it works. This time I can use iwlist eth scan.
> I have some difficulties to associate and I need to rmmod/modprobe in
> order to associate but it is another problem linked to a really weak
> power.
Bastien,
Please try this patch instead.
Thanks,
Larry
============================
Index: wireless-2.6/drivers/net/wireless/bcm43xx/bcm43xx_main.c
===================================================================
--- wireless-2.6.orig/drivers/net/wireless/bcm43xx/bcm43xx_main.c
+++ wireless-2.6/drivers/net/wireless/bcm43xx/bcm43xx_main.c
@@ -3638,6 +3638,7 @@ error:
 static int bcm43xx_init_board(struct bcm43xx_private *bcm)
 {
 	int err;
+	struct bcm43xx_phyinfo *phy = bcm43xx_current_phy(bcm);
 	mutex_lock(&(bcm)->mutex);
@@ -3658,6 +3659,8 @@ static int bcm43xx_init_board(struct bcm
 	if (err)
 		goto err_sysfs_unreg;
 	bcm43xx_periodic_tasks_setup(bcm);
+	/* force initial LO calibration */
+	phy->lo_control->txctl2 = 0xFFFF;
 	/*FIXME: This should be handled by softmac instead. */
 	schedule_delayed_work(&bcm->softmac->associnfo.work, 0);
@@ -3763,7 +3766,6 @@ static int bcm43xx_read_phyinfo(struct b
 		phy->lo_control = kzalloc(sizeof(*(phy->lo_control)), GFP_KERNEL);
 		if (!phy->lo_control)
 			return -ENOMEM;
-		phy->lo_control->txctl2 = 0xFFFF;//FIXME this is the wrong place
 	}
 	return 0;
----
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/