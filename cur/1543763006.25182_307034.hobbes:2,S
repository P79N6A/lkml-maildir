Date: Tue, 29 Mar 2005 21:16:45 +0200
From: Guillaume Foliard <>
Subject: [patch] Fix tg3 driver disable interrupts bug for realtime-preempt-2.6.12-rc1-V0.7.41-14
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/3/29/214

Hi,
I just noticed you've accepted a patch from Yang Yi dealing with interrupts
in the e1000 drivers on a PREEMPT_RT kernel. I did not yet understood the
problem but I blindly applied the same fix on the tg3 driver to get rid of the
following message :
network driver disabled interrupts: tg3_start_xmit+0x0/0x620
Signed-off-by: Guillaume Foliard <guifo@wanadoo.fr>
--- linux-2.6.12-rc1/drivers/net/tg3.c  2005-03-18 02:34:13 +0100
+++ linux-2.6.12-rc1-RT-V0.7.41-14/drivers/net/tg3.c    2005-03-29 20:25:33 +0200
@@ -3085,9 +3085,9 @@ static int tg3_start_xmit(struct sk_buff
         * So we really do need to disable interrupts when taking
         * tx_lock here.
         */
-       local_irq_save(flags);
+       local_irq_save_nort(flags);
        if (!spin_trylock(&tp->tx_lock)) {
-               local_irq_restore(flags);
+               local_irq_restore_nort(flags);
                return NETDEV_TX_LOCKED;
        }
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/