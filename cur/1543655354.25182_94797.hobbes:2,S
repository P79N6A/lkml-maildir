Date: Sun, 8 Dec 2002 08:25:59 -0500 (EST)
From: Bill Davidsen <>
Subject: [BENCHMARK] ctxbench 2.4.18 and 2.5.50
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/12/8/42

The results of these tests indicate that there may be some odd SMP locking 
issues still in 2.5.xx which were either much less obvious or not present 
in 2.4.
The oddness I see
As these results show, best results were from using a uni kernel, but an 
SMP kernel with "nosmp" was faster than running SMP. The problem is that 
with 2.5 kernels the SMP results for multiple runs vary by up to 2:1, and 
for uni kernels it's more like 5-10% max. I have tried longer runs, more 
runs, and gotten the same results even in single user mode.
The ctxbench measures the number of times two processes can take turns 
running using various forms of IPC. I'll post a more complete sescription 
of the benchmark and a link later today. The IPC in question is signals, 
semiphores, and message queues. Pipes are disabled (didn't work in 2.5.50) 
and sockets are not currently tested.
I am going to enable the pipe testing code, and will rerun the tests and 
post the results as well as the link to source code by tomorrow at the 
latest.
-- 
bill davidsen, CTO TMR Associates, Inc <davidsen@tmr.com>
  Having the feature freeze for Linux 2.5 on Hallow'een is appropriate,
since using 2.5 kernels includes a lot of things jumping out of dark
corners to scare you.
================================================================
    Run information
================================================================
Run: 2.4.18-10-bl
  CPU_MHz              498.014
  CPUtype              Celeron (Mendocino)
  Ncpu                 1
Run: 2.4.18-10smp-bl
  CPU_MHz              498.007
  CPUtype              Celeron (Mendocino)
  Ncpu                 2
Run: 2.4.18-10uni-bl
  CPU_MHz              498.016
  CPUtype              Celeron (Mendocino)
  Ncpu                 1
================================================================
    Results by IPC type
================================================================
                                   loops/sec
SIGUSR1                     low       high    average
  2.4.18-10-bl            70703      71028      70914
  2.4.18-10smp-bl         31772      32508      32181
  2.4.18-10uni-bl         63017      63430      63165
                                   loops/sec
message queue               low       high    average
  2.4.18-10-bl           129994     130446     130212
  2.4.18-10smp-bl         45030      50691      48218
  2.4.18-10uni-bl        105649     106529     106180
                                   loops/sec
semiphore                   low       high    average
  2.4.18-10-bl           141706     142895     142358
  2.4.18-10smp-bl         44712      45401      44983
  2.4.18-10uni-bl        113527     114013     113774
                                   loops/sec
spin+yield                  low       high    average
  2.4.18-10-bl           286882     300989     293864
  2.4.18-10smp-bl        592585     648768     620266
  2.4.18-10uni-bl        173367     185063     179160
                                   loops/sec
spinlock                    low       high    average
  2.4.18-10-bl                3          3          3
  2.4.18-10smp-bl       1206672    1207471    1207192
  2.4.18-10uni-bl             3          3          3
================================================================
    Run information
================================================================
Run: 2.5.50-bl
  CPU_MHz              497.950
  CPUtype              Celeron (Mendocino)
  Ncpu                 1
Run: 2.5.50smp-bl
  CPU_MHz              497.953
  CPUtype              Celeron (Mendocino)
  Ncpu                 2
Run: 2.5.50uni-bl
  CPU_MHz              497.914
  CPUtype              Celeron (Mendocino)
  Ncpu                 1
================================================================
    Results by IPC type
================================================================
                                   loops/sec
SIGUSR1                     low       high    average
  2.5.50-bl               66098      66638      66321
  2.5.50smp-bl             6586      47026      31266
  2.5.50uni-bl            55482      55647      55565
                                   loops/sec
message queue               low       high    average
  2.5.50-bl              120720     122101     121574
  2.5.50smp-bl            52365      74617      66059
  2.5.50uni-bl           101765     101832     101795
                                   loops/sec
semiphore                   low       high    average
  2.5.50-bl              129564     130683     129992
  2.5.50smp-bl            60871      87154      71212
  2.5.50uni-bl           107290     107719     107523
                                   loops/sec
spin+yield                  low       high    average
  2.5.50-bl              327325     329358     328365
  2.5.50smp-bl           391104     560007     492187
  2.5.50uni-bl           249595     249734     249685
                                   loops/sec
spinlock                    low       high    average
  2.5.50-bl                   3          3          3
  2.5.50smp-bl          1195403    1196519    1196095
  2.5.50uni-bl                3          3          3