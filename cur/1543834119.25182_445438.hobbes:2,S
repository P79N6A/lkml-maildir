Date: Wed, 19 Jul 2006 17:16:49 +0300 (EEST)
From: Pekka J Enberg <>
Subject: Re: [PATCH] libfs: remove page up-to-date check from simple_readpage
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/19/68

Uh, oh, removed too much. We obviously need to set the PG_uptodate flag 
in simple_readpage(). Sorry about that. Updated patch follows.
From: Pekka Enberg <penberg@cs.helsinki.fi>
This patch removes the unnecessary PageUptodate check from simple_readpage.
The only two callers for ->readpage that don't have explicit PageUptodate
check are read_cache_pages and page_cache_read which operate on newly
allocated pages which don't have the flag set.
Signed-off-by: Pekka Enberg <penberg@cs.helsinki.fi>
---
 fs/libfs.c |    4 ----
 1 files changed, 0 insertions(+), 4 deletions(-)
diff --git a/fs/libfs.c b/fs/libfs.c
index ac02ea6..0d2cc61 100644
--- a/fs/libfs.c
+++ b/fs/libfs.c
@@ -319,15 +319,11 @@ int simple_readpage(struct file *file, s
 {
 	void *kaddr;
 
-	if (PageUptodate(page))
-		goto out;
-
 	kaddr = kmap_atomic(page, KM_USER0);
 	memset(kaddr, 0, PAGE_CACHE_SIZE);
 	kunmap_atomic(kaddr, KM_USER0);
 	flush_dcache_page(page);
 	SetPageUptodate(page);
-out:
 	unlock_page(page);
 	return 0;
 }
-- 
1.4.1
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/