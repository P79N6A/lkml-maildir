Date: Sat, 26 Aug 2000 06:46:11 +0200
From: Bernd Kischnick <>
Subject: BUG/PATCH: include/asm-*/fcntl.h
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/26/41

Hello Linux-Kernel port maintainers, 
An hour ago I posted a patch for asm-ppc/fcntl.h.
Now I scanned the other asm-directories and found the same bug in
most of the other architectures as well:
The definition for "struct flock64" seems to be missing, as well as some
constant defines:
#define F_GETLK64	12
#define F_SETLK64	13
#define F_SETLKW64	14
The PPC port didn't compile without the patch, so I suppose this is critical
for your ports as well. Please have a look at the patch.
A special note for Ralf Baechle (the MIPS maintainer): 
asm-mips/fcntl.h and maybe asm-mips64/fcntl.h would have to be changed, too.
But simply applying the same change as for the other architectures woudln't
work, because in the MIPS headers, the constant 14 is already used for F_GETLK
(which is 5 elsewhere).
Regards,
- Bernd Kischnickdiff -ru v2.4.0-test7/linux/include/asm-m68k/fcntl.h linux/include/asm-m68k/fcntl.h
--- v2.4.0-test7/linux/include/asm-m68k/fcntl.h	Wed Jul  5 20:13:39 2000
+++ linux/include/asm-m68k/fcntl.h	Sat Aug 26 06:13:46 2000
@@ -35,6 +35,10 @@
 #define F_SETSIG	10	/*  for sockets. */
 #define F_GETSIG	11	/*  for sockets. */
 
+#define F_GETLK64	12	/*  using 'struct flock64' */
+#define F_SETLK64	13
+#define F_SETLKW64	14
+
 /* for F_[GET|SET]FL */
 #define FD_CLOEXEC	1	/* actually anything with low bit set goes */
 
@@ -60,6 +64,14 @@
 	off_t l_start;
 	off_t l_len;
 	pid_t l_pid;
+};
+
+struct flock64 {
+	short  l_type;
+	short  l_whence;
+	loff_t l_start;
+	loff_t l_len;
+	pid_t  l_pid;
 };
 
 #endif /* _M68K_FCNTL_H */
diff -ru v2.4.0-test7/linux/include/asm-ppc/fcntl.h linux/include/asm-ppc/fcntl.h
--- v2.4.0-test7/linux/include/asm-ppc/fcntl.h	Wed Jul  5 20:13:39 2000
+++ linux/include/asm-ppc/fcntl.h	Sat Aug 26 03:00:36 2000
@@ -35,6 +35,10 @@
 #define F_SETSIG	10	/*  for sockets. */
 #define F_GETSIG	11	/*  for sockets. */
 
+#define F_GETLK64	12	/*  using 'struct flock64' */
+#define F_SETLK64	13
+#define F_SETLKW64	14
+
 /* for F_[GET|SET]FL */
 #define FD_CLOEXEC	1	/* actually anything with low bit set goes */
 
@@ -66,6 +70,14 @@
 	off_t l_start;
 	off_t l_len;
 	pid_t l_pid;
+};
+
+struct flock64 {
+	short  l_type;
+	short  l_whence;
+	loff_t l_start;
+	loff_t l_len;
+	pid_t  l_pid;
 };
 
 #endif
diff -ru v2.4.0-test7/linux/include/asm-sh/fcntl.h linux/include/asm-sh/fcntl.h
--- v2.4.0-test7/linux/include/asm-sh/fcntl.h	Wed Jul  5 20:13:39 2000
+++ linux/include/asm-sh/fcntl.h	Sat Aug 26 06:23:26 2000
@@ -35,6 +35,10 @@
 #define F_SETSIG	10	/*  for sockets. */
 #define F_GETSIG	11	/*  for sockets. */
 
+#define F_GETLK64	12	/*  using 'struct flock64' */
+#define F_SETLK64	13
+#define F_SETLKW64	14
+
 /* for F_[GET|SET]FL */
 #define FD_CLOEXEC	1	/* actually anything with low bit set goes */
 
@@ -60,6 +64,14 @@
 	off_t l_start;
 	off_t l_len;
 	pid_t l_pid;
+};
+
+struct flock64 {
+	short  l_type;
+	short  l_whence;
+	loff_t l_start;
+	loff_t l_len;
+	pid_t  l_pid;
 };
 
 #endif /* __ASM_SH_FCNTL_H */
diff -ru v2.4.0-test7/linux/include/asm-ia64/fcntl.h linux/include/asm-ia64/fcntl.h
--- v2.4.0-test7/linux/include/asm-ia64/fcntl.h	Wed Jul  5 20:13:39 2000
+++ linux/include/asm-ia64/fcntl.h	Sat Aug 26 06:12:09 2000
@@ -70,4 +70,8 @@
 	pid_t l_pid;
 };
 
+#ifdef __KERNEL__
+#define flock64 flock
+#endif
+
 #endif /* _ASM_IA64_FCNTL_H */
diff -ru v2.4.0-test7/linux/include/asm-mips64/fcntl.h linux/include/asm-mips64/fcntl.h
--- v2.4.0-test7/linux/include/asm-mips64/fcntl.h	Wed Jul  5 20:13:39 2000
+++ linux/include/asm-mips64/fcntl.h	Sat Aug 26 06:20:15 2000
@@ -73,4 +73,8 @@
 	long  pad[4];			/* ZZZZZZZZZZZZZZZZZZZZZZZZZZ */
 } flock_t;
 
+#ifdef __KERNEL__
+#define flock64 flock
+#endif
+
 #endif /* _ASM_FCNTL_H */
diff -ru v2.4.0-test7/linux/include/asm-s390/fcntl.h linux/include/asm-s390/fcntl.h
--- v2.4.0-test7/linux/include/asm-s390/fcntl.h	Wed Jul  5 20:13:39 2000
+++ linux/include/asm-s390/fcntl.h	Sat Aug 26 06:22:07 2000
@@ -42,6 +42,10 @@
 #define F_SETSIG	10	/*  for sockets. */
 #define F_GETSIG	11	/*  for sockets. */
 
+#define F_GETLK64	12	/*  using 'struct flock64' */
+#define F_SETLK64	13
+#define F_SETLKW64	14
+
 /* for F_[GET|SET]FL */
 #define FD_CLOEXEC	1	/* actually anything with low bit set goes */
 
@@ -67,6 +71,14 @@
 	off_t l_start;
 	off_t l_len;
 	pid_t l_pid;
+};
+
+struct flock64 {
+	short  l_type;
+	short  l_whence;
+	loff_t l_start;
+	loff_t l_len;
+	pid_t  l_pid;
 };
 
 #endif