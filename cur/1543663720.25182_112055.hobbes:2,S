Date: 24 Feb 2003 05:34:24 +0800
From: Antonino Daplas <>
Subject: Re: [Linux-fbdev-devel] cat /dev/fb1 produces kernel bug
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/2/23/178

On Mon, 2003-02-24 at 02:07, Siim Vahtre wrote:
> Call Trace:
>  [<c020e678>] kobject_register+0x58/0x70
>  [<c021a58b>] bus_add_driver+0x5b/0xe0
>  [<c021a9df>] driver_register+0x2f/0x40
>  [<c017a8e3>] create_proc_entry+0x83/0xd0
>  [<c021170b>] pci_register_driver+0x4b/0x60
>  [<c010507f>] init+0x3f/0x160
>  [<c0105040>] init+0x0/0x160
>  [<c010726d>] kernel_thread_helper+0x5/0x18
> 
For a quick fix, try this:
diff -Naur linux-2.5.61/drivers/video/riva/fbdev.c linux/drivers/video/riva/fbdev.c
--- linux-2.5.61/drivers/video/riva/fbdev.c	2003-02-16 00:49:23.000000000 +0000
+++ linux/drivers/video/riva/fbdev.c	2003-02-23 21:30:50.000000000 +0000
@@ -1961,12 +1961,10 @@
 
 int __init rivafb_init(void)
 {
-	int err;
-	err = pci_module_init(&rivafb_driver);
-	if (err)
-		return err;
-	pci_register_driver(&rivafb_driver);
-	return 0;
+	if (pci_register_driver(&rivafb_driver) > 0) 
+		return 0;
+	pci_unregister_driver(&rivafb_driver);
+	return -ENODEV;
 }
 
Or Try James' patch...
http://phoenix.infradead.org/~jsimmons/fbdev.diff.gz
...and Geert's "Logo Updates" which he just sent recently.
Tony
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/