Date: Wed, 23 Jan 2008 11:04:09 +0100
From: "Loïc Grenié" <>
Subject: Re: vmalloc_32 and SLAB incompatible in 2.6.23.9
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/23/53

23 Jan 2008 10:35:28 +0100, Andi Kleen <andi@firstfloor.org>:
> "Loïc Grenié" <loic.grenie@gmail.com> writes:
>
> >      Since GFP_DMA32 is not considered a valid flag, vmalloc_32 and
> >   SLAB are incompatible in kernel 2.6.23.9 (and probably later ones).
> >   It might be as simple as adding GFP_DMA32 everywhere where
> >   GFP_DMA is used in mm/slab.c, but I don't dare do it. I personally
> >   switched to SLUB.
>
> I don't think it would really work for slub either.
>
> If you look at /proc/slabinfo you see that there are separate DMA
> caches. That is because sl[abo]b all cache objects and if the
> objects have different requirements (like GFP_DMA, GFP_DMA32, GFP_KERNEL)
> they would need different caches. Otherwise you risk getting
> later objects originally allocated with the wrong flags.
>
> To make GFP_DMA32 work would require adding another set of DMA32
> caches to all kmalloc caches etc or a separate one for each
> custom kmem cache that you use that only gets _DMA32 objects.
>
> Better just use __get_free_pages() directly.
     vmalloc_32 is using __vmalloc. I am much too ignorant to try and change
  anything in mm/*.[ch]. If vmalloc_32 is incompatible with sl[aou]b, should'nt
  it be either modified or removed ?
        Thanks,
              Loïc Grenié
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/