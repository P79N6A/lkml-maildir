Date: Thu, 18 Oct 2007 15:23:49 -0400 (EDT)
From: Alan Stern <>
Subject: BUG in: Driver core: convert block from raw kobjects to core devices
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/18/344

This patch (as1004) fixes a refcounting bug in the development version
of the block-device core.
Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
---
Kay, you have got to start testing your patches better!  Finding and
fixing refcount errors is _not_ one of my favorite ways to pass the
time.  For example, you could see what happens when you insert and
unplug a USB flash disk a few times.
Greg, you'll probably want to just fold this in with Kay's 
block-device.patch.
Alan Stern
Index: usb-2.6/fs/partitions/check.c
===================================================================
--- usb-2.6.orig/fs/partitions/check.c
+++ usb-2.6/fs/partitions/check.c
@@ -516,5 +516,4 @@ void del_gendisk(struct gendisk *disk)
 	sysfs_remove_link(&block_depr, disk->dev.bus_id);
 #endif
 	device_del(&disk->dev);
-	put_device(&disk->dev);
 }
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/