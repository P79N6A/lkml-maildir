Date: Sun, 12 Sep 2004 13:20:30 +0200 (MEST)
From: Mikael Pettersson <>
Subject: [PATCH][2.4.28-pre3] ips scsi driver compile failure fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/12/83

drivers/scsi/ips.c fails to compile in the 2.4.28-pre3 kernel:
In file included from ips.c:190:
ips.h:101: error: redefinition of typedef 'irqreturn_t'
/tmp/linux-2.4.28-pre3/include/linux/interrupt.h:16: error: previous declaration of 'irqreturn_t' was here
The irqreturn_t etc compat definitions in ips.h are in conflict
with the compat definitions in interrupt.h, added in kernel 2.4.23.
The patch below fixes the issue for me.
/Mikael
--- linux-2.4.28-pre3/drivers/scsi/ips.h.~1~	2004-09-12 00:23:20.000000000 +0200
+++ linux-2.4.28-pre3/drivers/scsi/ips.h	2004-09-12 02:09:04.000000000 +0200
@@ -97,13 +97,13 @@
 
    #if LINUX_VERSION_CODE < KERNEL_VERSION(2,5,0)
    
-      #ifndef irqreturn_t
+      #if LINUX_VERSION_CODE < KERNEL_VERSION(2,4,23)
          typedef void irqreturn_t;
+         #define IRQ_NONE
+         #define IRQ_HANDLED
+         #define IRQ_RETVAL(x)
       #endif 
       
-      #define IRQ_NONE
-      #define IRQ_HANDLED
-      #define IRQ_RETVAL(x)
       #define IPS_REGISTER_HOSTS(SHT)      scsi_register_module(MODULE_SCSI_HA,SHT)
       #define IPS_UNREGISTER_HOSTS(SHT)    scsi_unregister_module(MODULE_SCSI_HA,SHT)
       #define IPS_ADD_HOST(shost,device)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/