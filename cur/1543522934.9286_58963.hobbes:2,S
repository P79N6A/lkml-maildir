Date: Fri, 21 Jan 2000 09:33:16 +0100
From: Reinhold Huber <>
Subject: Problems with FS buffering on Linux 2.2.14
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/1/21/188

Hello,
When I use two Linux boxes with a RAID array as shared storage, the following
problem occurs:
Machine 1 mounts the shared FS, modifies and unmounts it. Then machine 2
mounts the filesystem, makes another change and unmounts it. When I look
at the changes by mounting the FS on machine 1 again, then the changes
disappear. Another look by machine 2 shows the correct changes.
Both machines are identical Celeron-400 PC's with SuSE 6.2 on them, the
2.2.14 kernel was manually installed from source. They are connected to
the RAID with Adaptec 2940 U2W controllers. The raid has two independent
host channels, each is connected to one machine.
Swapping the two host channels doesn't solve the problem, so the RAID array
is innocent, and this type of RAID (IFT 3102) is known not to have this
problem with UltraSparc/Solaris and HP PA-Risc/HP-UX.
This problem also occured with two other Linux PC's. On these, removing
the SCSI host adapter kernel module and reloading it had the result that
the machine recognized the changes the other machine made.
So I assume that the Linux kernel keeps the read buffers for filesystems
even after the FS is unmounted, and re-uses them for the next mount of
the same FS. I prefer having monolithic kernels with the subsystems I
always need compiled-in, so the workaround with rmmod'ing the SCSI
module does not work for me.
Is there a kernel compiling option I missed which tells the kernel to
remove the reading buffers after every umount, and if so, which one?
I'm looking forward to your answer.
As I'm not subscribed to the list, it would be very kind of you to
cc your answer directly to me.
Thanks in advance,
Reinhold Huber
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/