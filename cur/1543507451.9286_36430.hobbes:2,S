Date: Mon, 30 Aug 1999 00:39:07 -0400 (EDT)
From: Chuck Mead <>
Subject: Re: fdomain + CD-ROM access -> kernel panic
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/8/29/120

On Sat, 28 Aug 1999, Dean Martin Townsley spewed into the bitstream:
> I am using
> Linux version 2.2.12 (gcc version egcs-2.91.66 19990314/Linux (egcs-1.1.2 release))
> on an RH 6.0 system (this has also occured with 2.2.10 and 2.2.11) with a
> AHA2920 (fdomain) scsi adaptor, a VIA motherboard, AMD K6-3D, and an Acer
> CRW-6206A cd-r/w drive.
> 
> I can panic the system by copying a few tens of Megs of files from the CD
> drive (through ide-cd) to the scsi disk.  The system panics after the
> message:
Does it do the same thing when ftp'ing from the LAN? Ours does, which tells me
the problem doesn't relate to cdrom file xfers. I applied Alan's suggestion when
he passed it on to me and I haven't had a reoccurence, though I haven't tested
it hard either... just normal ops. Perhaps I need to test it now to help out
with this!
> kernel: scsi : aborting command due to timeout : pid 2 114, scsi0, channel 0, id 6, lun 0 Write (6) 13 6a 12 80 00
> 
> and the last screen contains the messages (typed in from the screen)
> 
> FIFO status      = 0x08
> Int. Condition   = 0x00
> Configuration 1  = 0x87
> Configuration 2  = 0x03
> scsi0 channel 0 : resetting for second half of retries.
> SCSI bus is being reset for host 0 channel 0.
> scsi: <fdomain> SCSI bus Reset
> Future Domain 16-bit SCSI Driver Version 5.50
> scsi0: <fdomain> No BIOS; using scsi id 7
> scsi0: <fdomain> TMC-36C70 (PCI bus) chip at 0xec00 irq 11
> unknown (34), target = 6 cmnd = 0x0a pieces = 64 size = 65536
> sent_command = 0, have_data_in = 0, timeout = 0
> in_interrupt_flag = 0
> IMR = 0x02c0, IRR = 0x0080, ISR = 0x0000
> SCSI Status      = 0x11
> TMC Status       = 0x40 (interrupt)
> Interrupt Status = 0x00
> FIFO status      = 0x08
> Int. Condition   = 0x00
> Configuration 1  = 0x87
> Configuration 2  = 0x03
> Kernel panic: scsi: <fdomain> fdomain_16x0_queue() NOT REENTRANT!
> In swapper task - not syncing
> 
> There was more before this, but it scrolled off and there's no scrollback
> once the kernel panics.  Also note these are from different crashes as I had
> to get the system to log to the network to catch the syslog message hopefully
> they are still consistent.
> 
> Miscellaneous info:
> 
> Both the SCSI and the CD work ok individually.  The system boots and I can
> use it normally, and I can use the CD normally as long as there is only a
> very small amount of disk activity.  I can burn a cd (through ide-scsi ->
> scsi-cd) as long as the source is coming in over the network and I don't do
> anything that generates significant disk activity.  Notice I say significant,
> I can copy maybe a few hundred k to a 1 Meg file across cd -> scsi drive
> without killing the system.
> 
> I tried the fix proposed in the archives by Alan Cox in "fdomain.o w/ RH6.0"
> changing in drivers/scsi/fdomain.h:
> can_queue: 1, \
> to
> can_queue: 0, \
> and it did not help.
> 
> I originally started using this drive through ide-scsi, with the same
> problem, and have switched to ide-cd in hopes of isolating the bug more
> closely.  Also I do not have another CD-ROM drive to try in this computer so
> I cannot eliminate the drive as the source of the problem.  Also, copies
> from an (old, i.e. slow by modern standards) 240MB IDE drive on the system to
> the SCSI drive seem to work fine.
> 
> I hope this is a well-enough formatted report.  Also I am not subscribed to
> linux-kernel so a cc: would be appreciated.
> Thanks to all,
> -Dean Townsley
> <townsley@physics.ucsb.edu>
> 
> -
> To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
> the body of a message to majordomo@vger.rutgers.edu
> Please read the FAQ at 
http://www.tux.org/lkml/
> 
-- 
Chuck Mead, CTO, MoonGroup Consulting, Inc. <
http://moongroup.com
> 
Mail problems? Send "s-u-b-s-c-r-i-b-e mailhelp" (no quotes and no
hyphens) in the body of a message to mailhelp-request@moongroup.com.
                              
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/