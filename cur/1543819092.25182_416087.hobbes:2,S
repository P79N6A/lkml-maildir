Date: Fri, 14 Apr 2006 19:33:37 -0500
From: Dustin Kirkland <>
Subject: Re: [PATCH] make: add modules_update target
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/14/184

On Fri, 2006-04-14 at 22:02 +0300, Avi Kivity wrote:
> Use rsync only if it is available:
> 
>     rsync-available := $(shell rsync --version > /dev/null 2>&1 && echo y)
>     copy := $(if $(rsync-available), rsync --delete, cp)
> 
>     modules_install:
>                [...]
>                $(copy) source target
Actually, rsync --delete is not a viable option either.  If you first
build a kernel with a particular item built as a module, and then
afterward rebuild with the same item as built-in (or not at all),
the .ko file remains in your kernel build tree (ie, it won't be deleted
on the source such that the --delete would have your desired effect).
Furthermore, rsync's performance is considerably worse in my testing
than "cp -u", almost back to the original performance of the "rm -rf, cp
all" of the original modules_install.  (Note that I tested, rsync's
default, checksum, mod-times, and size-only.)
:-Dustin
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/