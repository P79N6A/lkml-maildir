Date: Sun, 8 Feb 2004 17:42:48 -0500
From: Willem Riede <>
Subject: [PATCH] Selective attach for ide-scsi
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/8/112

Today, if you boot 2.6.x with hdd=ide-scsi, ide-scsi will attach to
all your Atapi drives, not just hdd, unless you explicitely specified
another driver for those.
Given that we don't want people to use ide-scsi for cdroms and cd-writers,
that behavior is IMHO suboptimal.
The patch below makes ide-scsi attach ONLY to those drives that you tell
it to. So if you want it to handle hdb and hdd, but not hdc, you boot
with hdb=ide-scsi hdd=ide-scsi.
Regards, Willem Riede.
--- p0/drivers/scsi/ide-scsi.c	2004-01-31 10:29:11.000000000 -0500
+++ a1/drivers/scsi/ide-scsi.c	2004-02-08 16:40:19.000000000 -0500
@@ -955,17 +955,18 @@
 	static int warned;
 	int err;
 
-	if (!warned && drive->media == ide_cdrom) {
-		printk(KERN_WARNING "ide-scsi is deprecated for cd burning! Use ide-cd and give dev=/dev/hdX as device\n");
-		warned = 1;
-	}
-
-	if (!strstr("ide-scsi", drive->driver_req) ||
+	if (!drive->driver_req ||
+	    !strstr(drive->driver_req, "ide-scsi") ||
 	    !drive->present ||
 	    drive->media == ide_disk ||
 	    !(host = scsi_host_alloc(&idescsi_template,sizeof(idescsi_scsi_t))))
 		return 1;
 
+	if (!warned && drive->media == ide_cdrom) {
+		printk(KERN_WARNING "ide-scsi is deprecated for cd burning! Use ide-cd and give dev=/dev/hdX as device\n");
+		warned = 1;
+	}
+
 	host->max_id = 1;
 	host->max_lun = 1;
 	drive->driver_data = host;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/