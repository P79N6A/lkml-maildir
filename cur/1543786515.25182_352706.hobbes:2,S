Date: Thu, 22 Sep 2005 14:29:41 +0100
From: Russell King <>
Subject: Re: [RFC/BUG?] ide_cs's removable status
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/22/143

On Thu, Sep 22, 2005 at 02:39:42PM +0100, Alan Cox wrote:
> On Iau, 2005-09-22 at 11:22 +0100, Russell King wrote:
> > If you have a CF adapter which behaves as you describe above, could
> > you please check what happens as far as PCMCIA goes when you unplug
> > the CF card - particularly what happens to cardctl status / cardctl
> > ident ?
> 
> If I remove the CF card I get garbage reported. I don't however get a
> card plug/unplug event.
That's interesting, because PCMCIA caches the CIS data and only
invalidates the CIS cache when an unplug event is seen.  I assume
the whole lot isn't garbage, just some parts of it?
> On the other card I have I get a card plug/unplug event.
Using the same CF card with these two adapters, do you get differing
CIS data?  Can you post the entire CIS data from both using dump_cis
please?
I'm wondering if your first adapter is somehow "inteligent" and isn't
operating the CF card in "PCMCIA" mode.  If this is the case, PCMCIA
should be more inteligent about it than it currently is - telling IDE
that the media is replaceable when the interface is registered.
There is another concern I have in all this, one which seems to have
been completely missed.  Yes we do this partition rescanning each time
a "removable" IDE device is opened, but do we re-read the identity?
I'm asking this because what happens if you replace a 64MB CF card
with a 256MB CF card in your first adapter?  Do we assume that it's
still a 64MB CF card with weird partitions?
> The pcmcia ide floppy (40MB clik! drive if anyone
> wants to play) I have always shows up as present. It triggers the same
> hotplug behaviour being complained about as far as I can see and
> correctly so.
Not having a clik drive, but "ide floppy" sounds like standard floppy
behaviour - the "other" class of hotplug where the media is replaceable
independent of the controller itself, so this is a slightly different
problem, and one which we handle correctly.
-- 
Russell King
 Linux kernel    2.6 ARM Linux   - 
http://www.arm.linux.org.uk/
 maintainer of:  2.6 Serial core
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/