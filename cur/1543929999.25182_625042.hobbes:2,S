Date: Thu, 6 Dec 2007 08:02:52 -0800
From: David Brownell <>
Subject: Re: [PATCH] usb: at91_udc: correct hanging while disconnecting usb cable
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/6/191

On Thursday 06 December 2007, Nicolas Ferre wrote:
> Correct hanging while disconnecting the USB device 
> cable. Prevent a race between vbus and UDP interrupts.
> This bug was tracked on at91sam9260ek boards.
> 
> Signed-off-by: Nicolas Ferre <nicolas.ferre@rfo.atmel.com> 
> ---
> 
> A usb resume interrupt was firing after the vbus 
> interrupt : the IP was then already stoped and not able 
> to deal with it (no more clock). A simple interrupt disabling 
> is ok as the "end of bus reset" irq is non maskable and ok 
> to resume the USB device IP.
Good, thanks for finding this.  The bug was reported
recently, and obviously can't be reproduced except on
boards which *have* a VBUS interrupt!
I've signed off on this and suggested Greg merge it
before the 2.6.24-final freeze.
- Dave