Date: Thu, 14 Jan 1999 18:50:06 +0100
From: Daniel Deimert <>
Subject: 2.0.37-pre4 "MASQ: failed..." even though NO masquerading active
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/14/138

Hi!
On a threaded socks server using 2.0.37-pre4 I get "MASQ: failed TCP/UDP
checksum from a.b.c.d" messages.
Well, I was confused because:
- No masquerade routing entries has been entered with ipfwadm
- No active masquerade connections shows up in ipfwadm -M -l (of course)
- No TCP or UDP connections to or from the "a.b.c.d" host shows up in
netstat, nor in the socks log.
- No TCP or UDP ports in the masquerade range are active, so that printk
should never be called - right?
from ipmasq.c it looks as if only ports 61000-up should ever get this
message, by default.
     /* Make sure packet is in the masq range */
    portptr = (__u16 *)&(((char *)iph)[iph->ihl*4]);
    if ((ntohs(portptr[1]) < PORT_MASQ_BEGIN ||
         ntohs(portptr[1]) > PORT_MASQ_END))
Are the packets with the bad checksum so broken that the port number is
wrong too, or how come it reaches this printk?
I can't understand from the sources if these messages are harmless or
not. I can't see why the kernel should print out messages about normal
protocol operation, though.
A Cc: of replies would be appreciated since vger is so slow.
--
Daniel.Deimert@intermec.com     Intermec Printer AB, GÃ¶teborg, Sweden
http://www.intermec.com/
        Intermec Identification Systems Division
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/