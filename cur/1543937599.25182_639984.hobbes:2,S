Date: Thu, 17 Jan 2008 19:59:31 -0500
From: "H. Peter Anvin" <>
Subject: Re: [PATCH] x86: Use v8086_mode helper, trivial unification
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/17/514

Harvey Harrison wrote:
> 
> Sorry, missed that detail in ptrace.h, I notice now.
> 
> Is there some better way this could be organized, would the following
> be an improvement, as opposed to two long ifdef sections?
> 
> Patch will follow if you think it's a good idea.
It is actually quite a bit easier to read.
> 
> static inline unsigned long stack_pointer(struct pt_regs *regs)
> {
> #ifdef CONFIG_X86_32
> 	return (unsigned long)regs;
> #else
> 	return regs->sp;
> #endif
> }
This one is kind of strange.  In particular, the 32-bit definition isn't 
exactly what one would expect.  It makes me concerned that it actually 
refers to two different kinds of stack pointers?
> /* still need a define here, as one is long and one is unsigned long.
>  * but this is another target for unification I guess. */
> #define regs_return_value(regs) ((regs)->ax)
Indeed...
	-hpa