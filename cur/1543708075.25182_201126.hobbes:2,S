Date: Mon, 23 Feb 2004 12:24:31 -0500
From: "Bagalkote, Sreenivas" <>
Subject: [PATCH][BUGFIX] : megaraid patch for 2.10.1 (irq disable bug fix)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/23/137

Hello all,
The following patch fixes a bug in megaraid driver version 2.10.1
where irq was erroneously being disabled.
Thanks,
Sreenivas
diff -Naur current/drivers/scsi/megaraid.c patched/drivers/scsi/megaraid.c
--- current/drivers/scsi/megaraid.c	2004-02-23 23:56:10.000000000 -0500
+++ patched/drivers/scsi/megaraid.c	2004-02-23 23:56:18.000000000 -0500
@@ -2474,7 +2474,9 @@
 	memset(raw_mbox, 0, sizeof(raw_mbox));
 	raw_mbox[0] = FLUSH_ADAPTER;
 
-	irq_disable(adapter);
+	if( adapter->flag & BOARD_IOMAP ) 
+		irq_disable(adapter);
+
 	free_irq(adapter->host->irq, adapter);
 
 	/* Issue a blocking (interrupts disabled) command to the card */
@@ -4040,7 +4042,9 @@
 		memset(raw_mbox, 0, sizeof(raw_mbox));
 		raw_mbox[0] = FLUSH_ADAPTER;
 
-		irq_disable(adapter);
+		if( adapter->flag & BOARD_IOMAP ) 
+			irq_disable(adapter);
+
 		free_irq(adapter->host->irq, adapter);
 
 		/*
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/