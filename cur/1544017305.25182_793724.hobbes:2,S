Date: Sat, 17 Jan 2009 15:03:12 +0900
From: 	hooanon05@yahoo ...
Subject: Re: [Ecryptfs-devel] [PATCH] ecryptfs: some inode attrs, and a question
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/17/3

Dave Kleikamp:
> I think you're hitting on something here.  I never understood  the need
> for the d_drop()s, but taking them out broke things.  They probably are
> just papering over bugs where the ecryptfs inode is not being properly
> updated after changes are made to the lower inode.
As long as cifs_hardlink() calls d_drop() for the target dentry (as the
old version of NFS did), ecryptfs may have to call d_drop() too. But I
believe the d_drop() for the source dentry is unnecessary, as long as
the inode attributes are maintained correctly.
Additionally, when the lower filesystem does NOT call d_drop(), ecryptfs
has no necessary to call it. I'd like to suggest ecryptfs_link() to
check it by d_unhashed().
J. R. Okajima