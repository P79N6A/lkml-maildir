Date: Mon, 13 Nov 2006 21:07:08 +0530
From: Gautham R Shenoy <>
Subject: Re: [RFC] [PATCH] cpu_hotplug on IBM JS20 system
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/11/13/123

On Mon, Nov 13, 2006 at 02:09:26PM +0100, Heiko Carstens wrote:
> > Since we are not supported by hardware for cpu hotplug. I have developed
> > the patch which will disable cpu hotplug on IBM bladecentre JS20. Please
> > let me know your comments on this please.
> 
> > +extern  int cpu_hotplug_disabled;
> > +extern  struct mutex cpu_add_remove_lock;
> [...]
> > +	if(rtas_stop_self_args.token == RTAS_UNKNOWN_SERVICE) {
> > +		mutex_lock(&cpu_add_remove_lock);
> > +		cpu_hotplug_disabled = 1;
> > +		mutex_unlock(&cpu_add_remove_lock);
> > +	}
> > +
> >  #endif /* CONFIG_HOTPLUG_CPU */
> >  #ifdef CONFIG_RTAS_ERROR_LOGGING
> >  	rtas_last_error_token = rtas_token("rtas-last-error");
> 
> You should add a function to kernel/cpu.c which you can call in order to
> disable cpu hotplug instead of exporting its private data structures.
Yup. Also, considering the fact that enable_nonboot_cpus() can reset
the cpu_hotplug_disabled flag, I would suggest the following:
a) create one additional state for cpu_hotplug_disabled, something
like
#define PERMANENTLY_DISABLED -1 
b) Define a function kernel/cpu.c
void disable_cpu_hotplug_perm()
{
	cpu_hotplug_disabled = PERMANENTLY_DISABLED;
}
and call it in rtas.c
c) Check for status of cpu_hotplug_disabled in functions cpu_up, 
   cpu_down, enable_nonboot_cpus and disable_nonboot_cpus and 
   if cpu_hotplug_disabled == PERMANENTLY_DISABLED, 
   return bypassing further code.
Thoughts?
Regards,
gautham.
-- 
Gautham R Shenoy
Linux Technology Center
IBM India.
"Freedom comes with a price tag of responsibility, which is still a bargain,
because Freedom is priceless!"
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/