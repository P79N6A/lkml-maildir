Date: Wed, 12 Jan 2005 16:05:49 -0800
From: Andrew Morton <>
Subject: Re: [PATCH 2.6.10-mm2 Resend] Fix preemption race [1/3] (Core/i386)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/1/12/303

tglx@linutronix.de wrote:
>
> --- 2.6.10-mm2/arch/i386/kernel/entry.S	(revision 148)
> +++ 2.6.10-mm2/arch/i386/kernel/entry.S	(working copy)
> @@ -189,6 +189,7 @@
> 
>  #ifdef CONFIG_PREEMPT
>  ENTRY(resume_kernel)
> +	cli
>  	cmpl $0,TI_preempt_count(%ebp)	# non-zero preempt_count ?
>  	jnz restore_all
>  need_resched:
> @@ -197,10 +198,7 @@
>  	jz restore_all
>  	testl $IF_MASK,EFLAGS(%esp)     # interrupts off (exception path) ?
>  	jz restore_all
> -	sti
> -	call preempt_schedule
> -	cli
> -	movl $0,TI_preempt_count(%ebp)
> +	call preempt_schedule_irq(); 
whee, who needs a C compiler anyway?  Did that actually assemble?
I'll fix that one up ;)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/