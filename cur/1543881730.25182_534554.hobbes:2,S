Date: Wed, 25 Apr 2007 15:50:27 +0400
From: Vasily Tarasov <>
Subject: Re: [PATCH] cfq: get rid of cfqq hash
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/4/25/45

>> @@ -1806,7 +1765,11 @@ static int cfq_may_queue(request_queue_t
>>  	 * so just lookup a possibly existing queue, or return 'may queue'
>>  	 * if that fails
>>  	 */
>> -	cfqq = cfq_find_cfq_hash(cfqd, key, tsk->ioprio);
>> +	cic = cfq_get_io_context_noalloc(cfqd, tsk);
>> +	if (!cic)
>> +		return ELV_MQUEUE_MAY; 
>> +
>> +	cfqq = cic->cfqq[rw & REQ_RW_SYNC];
>>  	if (cfqq) {
>>  		cfq_init_prio_data(cfqq);
>>  		cfq_prio_boost(cfqq);
> 
> Ahem, how well did you test this patch?
Ugh, again: bio_sync() returns not only 0/1
Sorry for giving so much trouble...
BTW, what tests do you use to check patches?
I'll run them on our nodes each time when sending it to you.
At the moment I use some self made tests and a bit fio scripts.
> 
> -- 
> Jens Axboe
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/