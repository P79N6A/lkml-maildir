Date: Tue, 26 Feb 2008 22:56:41 +0100
From: Pavel Machek <>
Subject: Re: broken suspend in .2.6.25-rc3 on T61p (was Re: new regression in 2.6.25-rc3: no keyboard/lid acpi events on thinkpad T61p)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/26/417

On Tue 2008-02-26 13:22:41, Dave Jones wrote:
> On Tue, Feb 26, 2008 at 07:16:11PM +0100, Pavel Machek wrote:
>  > On Tue 2008-02-26 13:10:01, Dave Jones wrote:
>  > > On Tue, Feb 26, 2008 at 06:59:54PM +0100, Pavel Machek wrote:
>  > > 
>  > >  > > if by 'custom' you mean the solution everyone agreed to work
>  > >  > > toward at the power management summit several years ago
>  > >  > > (hal/pm-utils) then, yes.
>  > >  > 
>  > >  > I must have been on different summit... I believe it is bad to tie
>  > >  > s2ram to hal, because it makes testing on minimal system hard.
>  > >  > 
>  > >  > Anyway, what is the "default" way to trigger s2ram for Andrew? Perhaps
>  > >  > Fedora already has his machine whitelisted...
>  > > 
>  > > There is no s2ram. pm-suspend uses the white/black-lists in pm-utils.
>  > > Remember that? The cross-distro package everyone agreed was a good idea
>  > > so that every distro didn't have their own magic utility ?
>  > 
>  > Well, we have cross-distro package, it is at suspend.sf.net , and it
>  > can bring up video - which is kind of important. (It is single binary,
>  > so it can be pagelocked -- which is important for s2disk).
>  > 
>  > Plus it does not depend on HAL.
> 
> Neither does pm-utils.  Once again for the hard of thinking..
> 
> The mechanism belongs in pm-utils.  HAL is just a fancy wrapper around that.
> Don't want/like hal? fine, a smaller wrapper around pm-suspend and friends
> is trivial (or even unnecessary if you're happy with running pm-suspend by hand)
Seems like pm-utils is just a thin wrapper around s2ram, at least in
version debian ships. It does not seem to have its own whitelist.
Now, take a look at 
/usr/lib/pm-utils/functions
... 
        if [ -x /usr/sbin/s2ram ]; then
                if [ -n "$S2RAM_OPTS" ]; then
                        # Trust HAL or the user to pass the correct
options
                        /usr/sbin/s2ram $S2RAM_OPTS
                elif /usr/sbin/s2ram --test > /dev/null ; then
                        # Trust s2ram's internal whitelist
                        /usr/sbin/s2ram
                else
                        # Unknown machine
                        echo "This machine is unkown, please try to
find out how to suspend this machine. See s2ram(8)."
                fi
        else
                echo -n "mem" > /sys/power/state
        fi
...so it is ready to use s2ram, but will fall back to
echo. Unfortunately, that will mean no video resume on _many_
machines.
To give some numbers: according to s2ram whitelist, we can restore
video on 410 machines. On 74 of them, s2ram is not needed. So
approximately 80% of machines need s2ram (at least in configuration
without X running)....
Pretty please, can we get s2ram for Fedora, so that video is restored
there?
								Pavel
-- 
(english) 
http://www.livejournal.com/~pavelmachek
(cesky, pictures) 
http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html