Date: Thu, 27 Jan 2005 13:37:54 -0800
From: Zach Brown <>
Subject: __getblk() spinning when size != bdev->...i_blkbits
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/1/27/272

Recently I debugged something that was spinning in the for(;;) in
__getblk_slow().  It turned out it was calling __getblk() with a size
argument that didn't match the bdev's inode's i_blkbits.
grow_buffers() would add a page at the index calculated from the 4k size
argument but when __getblk_slow() got back around to looking for the
instantiated page __find_get_block_slow() would look at the index
calculated from the 1k i_blkbits and not find the new page.  Round and
round she goes.
If the different size inputs are intentional, would a simple BUG_ON() be
acceptible so that we can tell straight away if the caller messed up?
- z
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/