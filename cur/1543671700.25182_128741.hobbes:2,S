Date: 30 Apr 2003 14:07:08 +0200
From: Arjan van de Ven <>
Subject: Re: [PATCH] PATCH: ibm hot plug driver fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/4/30/62

On Tue, 2003-04-01 at 21:30, Linux Kernel Mailing List wrote:
> # This patch includes the following deltas:
> #	           ChangeSet	1.1044  -> 1.1045 
> #	drivers/hotplug/ibmphp_ebda.c	1.6     -> 1.7    
> #
> 
>  ibmphp_ebda.c |   25 ++++++++++++++++++++++---
>  1 files changed, 22 insertions(+), 3 deletions(-)
> 
> 
> diff -Nru a/drivers/hotplug/ibmphp_ebda.c b/drivers/hotplug/ibmphp_ebda.c
> --- a/drivers/hotplug/ibmphp_ebda.c	Tue Apr  1 13:05:41 2003
> +++ b/drivers/hotplug/ibmphp_ebda.c	Tue Apr  1 13:05:41 2003
> @@ -608,13 +608,20 @@
>  		return str;
>  	default: 	
>  		//2 digits number
> +		str1 = (char *) kmalloc (2, GFP_KERNEL);
> +		if (!str1) {
> +			break;
> +		}
> +		memset (str, 0, 3);
>  		*str1 = (char)(bit + 48);
>  		strncpy (str, str1, 1);
>  		memset (str1, 0, 3);
>  		*str1 = (char)((var % 10) + 48);
>  		strcat (str, str1);
> +		kfree(str1);
>  		return str;
> -	}	
> +	}
> +	kfree(str);
>  	return NULL;	
>  }
ehm I'd suggest backing out this change. Not only do we have snprintf
nowadays, it also corrupts memory by memsetting stuff bigger than it
allocated....
[unhandled content-type:application/pgp-signature]