Date: Fri, 06 Jan 2006 17:19:34 +0300
From: Kirill Korotaev <>
Subject: [PATCH] oom kill of current task
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/6/144

When oom_killer kills current there's no need
to call schedule_timeout_interruptible() since task
must die ASAP.
Signed-Off-By: Pavel Emelianov <xemul@sw.ru>
Signed-Off-By: Kirill Korotaev <dev@openvz.org>
P.S. against 2.6.15
--- ./mm/oom_kill.c.oomkill	2006-01-06 15:16:45.000000000 +0300
+++ ./mm/oom_kill.c	2006-01-06 15:19:21.130652864 +0300
@@ -298,7 +298,8 @@ retry:
 
 	/*
 	 * Give "p" a good chance of killing itself before we
-	 * retry to allocate memory.
+	 * retry to allocate memory unless "p" is current
 	 */
-	schedule_timeout_interruptible(1);
+	if (!test_thread_flag(TIF_MEMDIE))
+		schedule_timeout_interruptible(1);
 }