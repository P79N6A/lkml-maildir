Date: Tue, 21 Sep 1999 23:52:54 +0200
From: f5ibh <>
Subject: ps2esdi [patch]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/9/21/179

Hi,
I've an IBM PS/2 notebook (and old one : 386sx16, 80Mb ESDI HDD & 16MB RAM).
I run linux on it and, at boot time I get the message :
"Whaa. Error occurred..."
This is harmless but I don't like ... The related file is
linux/driver/block/ps2esdi.c
The driver check for a second drive on the adapter. As it is an integrated
adapter, it has _ONE_ disk attached no more !! This can be seen in the comment
inside the file. I suggest the following patch. Only one test at 2 places and
a new variable ...
--
--- linux/drivers/block/ps2esdi.c	Tue Sep 21 23:26:48 1999
+++ ps2esdi.c	Tue Sep 21 17:17:21 1999
@@ -124,7 +124,7 @@
 static int reset_status;
 static int ps2esdi_slot = -1;
 int tp720esdi = 0;		/* Is it Integrated ESDI of ThinkPad-720? */
-
+int intg_esdi = 0;              /* If integrated adapter */
 struct ps2esdi_i_struct {
 	unsigned int head, sect, cyl, wpcom, lzone, ctl;
 };
@@ -401,8 +401,9 @@
 
 
 	/* Integrated ESDI Disk and Controller has only one drive! */
-	if (adapterID == INTG_ESDI_ID)	/* if not "normal" PS2 ESDI adapter */
-		ps2esdi_drives = 1;	/* then we have only one physical disk! */
+	if (adapterID == INTG_ESDI_ID) {/* if not "normal" PS2 ESDI adapter */
+		ps2esdi_drives = 1;	/* then we have only one physical disk! */		intg_esdi = 1;
+	}
 
 
 
@@ -812,7 +813,8 @@
 						ps2esdi_info[0].wpcom = 0;
 						ps2esdi_info[0].lzone = reply[3];
 					} else {
-						ps2esdi_drives++;
+						if (!intg_esdi)
+							ps2esdi_drives++;
 					}
 				}
 #ifdef OBSOLETE
--
Regards
Jean-Luc
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/