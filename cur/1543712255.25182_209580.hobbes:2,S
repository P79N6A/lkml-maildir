Date: Fri, 26 Mar 2004 21:45:07 +0100
From: Edgar Toernig <>
Subject: Re: [PATCH] Consolidate multiple implementations of jiffies-msecs conversions.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/3/26/179

Sridhar Samudrala wrote:
> 
> On Fri, 26 Mar 2004, Edgar Toernig wrote:
> 
> > Sridhar Samudrala wrote:
> > >
> > >[...]
> > > -#define MSECS(ms)  (((ms)*HZ/1000)+1)
> > > -return (((ms)*HZ+999)/1000);
> > > +return (msecs / 1000) * HZ + (msecs % 1000) * HZ / 1000;
> >
> > Did you check that all users of the new version will work correctly
> > with your rounding?  Explicit round-up of delays is often required,
> > especially when talking to hardware...
>[...] 
> I guess you are referring to cases when HZ < 1000(ex: 100) and msecs is
> less than 10. In those cases, the new version returns 0, whereas some of the
> older versions return 1.
Exactly - but not only <10.  Any value that is not exactly representable
in jiffies.  I.e. for a delay of 15ms one has to wait 2 jiffies on a 100HZ
system.  Your version would give 1 jiffy = 10ms -- too short.
Ciao, ET.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/