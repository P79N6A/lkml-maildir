Date: Tue, 03 Jul 2007 15:28:36 -0400
From: "Chris Friesen" <>
Subject: Re: 2.6.21.5 june 30th to july 1st date hang?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/3/281

Arne Georg Gleditsch wrote:
> An interesting exercise might be to
> code up a small program to call adjtimex with timex.status |= STA_INS,
> to see if this can trigger the problem.
Setting the date to just before midnight June 30 UTC and then running the 
following as root triggered the crash on a modified 2.6.10.  Anyone see anything 
wrong with the code below, or is this a valid indication of a bug in the leap 
second code?
Chris
#include <sys/timex.h>
#include <stdio.h>
#include <errno.h>
struct timex buf;
int main(void)
{
	int rc = adjtimex(&buf);
	printf("initial status: 0x%x\n", buf.status);
	buf.status |= STA_INS;
	buf.modes = ADJ_STATUS;
	rc = adjtimex(&buf);
	if (rc == -1) {
		printf("unable to set status: %m\n");
		return -1;
	} else
		printf("rc: %d\n", rc);
	printf("final status: 0x%x\n", buf.status);
	return 0;
}
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/