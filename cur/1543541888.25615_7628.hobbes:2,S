Date: Sun, 20 Aug 2000 03:18:22 -0300
From: Arnaldo Carvalho de Melo <>
Subject: [PATCH] net/appletalk/ddp.c: small fix in skb usage
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/20/39

Hi,
        Please take a look and consider applying.
                        - Arnaldo
--- linux-2.4.0-test7-pre3/net/appletalk/ddp.c.orig	Sun Aug 20 03:10:24 2000
+++ linux-2.4.0-test7-pre3/net/appletalk/ddp.c	Sun Aug 20 03:13:21 2000
@@ -37,7 +37,8 @@
  *                                              port assignment. we lose a 
  *                                              valid localtalk port as a 
  *                                              result.
- *              
+ *              Arnaldo Carvalho de Melo:	fix some skb manipulation in
+ *              				atalk_rcv
  *
  *		This program is free software; you can redistribute it and/or
  *		modify it under the terms of the GNU General Public License
@@ -1611,7 +1612,10 @@
 			struct sk_buff *newskb;
 			/* 22 bytes - 12 ether, 2 len, 3 802.2 5 snap */
 			newskb = skb_realloc_headroom(skb, 32);
-			kfree(skb);
+			kfree_skb(skb);
+			if (!newskb)
+				return 0;
+			skb = NULL;
 		}
 		else
 			skb = skb_unshare(skb, GFP_ATOMIC);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/