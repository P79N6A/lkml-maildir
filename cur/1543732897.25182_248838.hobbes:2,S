Date: Fri, 03 Sep 2004 15:19:57 -0400
From: Mike Waychison <>
Subject: Re: TG3 doesn't work in kernel 2.4.27 (David S. Miller)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/3/310

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
Paul Larson wrote:
> I tried this patch alone on top of 2.6.9-rc1 and tg3 is still broken for
> me on JS20 blades.  Was there another patch I should have applied in
> conjunction with this?
>
Is this with or without autonegotiation enabled on the switch?
> Thanks,
> Paul Larson
>
> On Mon, 2004-08-30 at 18:11, David S. Miller wrote:
>
>>Michael Chan at Broadcom spotted the bug.
>>
>>Things are totally broken if the switch/hub does not support
>>autonegotiation.  Checking for the MAC_STATUS_SIGNAL_DET bit
>>in the tg3 polling timer fixes the problem.
>>
>>This is probably why it worked for you and doesn't with the
>>IBM blades as blades are more likely to be connected to
>>non-autoneg'ing devices.
>>
>>===== drivers/net/tg3.c 1.199 vs edited =====
>>--- 1.199/drivers/net/tg3.c	2004-08-18 19:52:35 -07:00
>>+++ edited/drivers/net/tg3.c	2004-08-30 15:08:07 -07:00
>>@@ -5602,7 +5602,8 @@
>> 				need_setup = 1;
>> 			}
>> 			if (! netif_carrier_ok(tp->dev) &&
>>-			    (mac_stat & MAC_STATUS_PCS_SYNCED)) {
>>+			    (mac_stat & (MAC_STATUS_PCS_SYNCED |
>>+					 MAC_STATUS_SIGNAL_DET))) {
>> 				need_setup = 1;
>> 			}
>> 			if (need_setup) {
>>-
>>To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
>>the body of a message to majordomo@vger.kernel.org
>>More majordomo info at  
http://vger.kernel.org/majordomo-info.html
>>Please read the FAQ at  
http://www.tux.org/lkml/
>>
>
>
- --
Mike Waychison
Sun Microsystems, Inc.
1 (650) 352-5299 voice
1 (416) 202-8336 voice
http://www.sun.com
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
NOTICE:  The opinions expressed in this email are held by me,
and may not represent the views of Sun Microsystems, Inc.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.5 (GNU/Linux)
iD8DBQFBOMPcdQs4kOxk3/MRAoJiAJoCZV1AKTQcOiOz0jNX1eZq9ZkiYACfaYDc
lWGl0C2xVNRuPuaKqt8/J90=
=mWO4
-----END PGP SIGNATURE-----
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/