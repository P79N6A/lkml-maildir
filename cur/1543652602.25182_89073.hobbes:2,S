Date: 13 Nov 2002 14:32:22 +0000
From: Alan Cox <>
Subject: Re: Kill obsolete and  unused suspend/resume code from IDE
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/11/13/82

On Wed, 2002-11-13 at 13:42, Pavel Machek wrote:
> > The code is not obsolete, it is not unused.
> 
> Can you point out what uses it? I certainly could not find it and
> killing standby/etc produced no compilation errors.
>
You were right - actually the code that uses it isnt committed into the
tree. Its also not going to be now you are doing sysfs
> As of obsolete... It is doing power managment outside of sysfs
> framework... Which is not how it should be done.
> 
> > > +	do_idedisk_standby(drive);
> > >  	if ((drive->id->cfs_enable_2 & 0x3000) && drive->wcache)
> > >  		if (do_idedisk_flushcache(drive))
> > >  			printk (KERN_INFO "%s: Write Cache FAILED Flushing!\n",
> > 
> > What locking rules are you using here ?
flushcache takes the ide lock which is already held at that point. The
code splits the unregister/standby path in two so that the unregister
doesnt deadlock
> Linus actually asked me for the patch, and discussion about it was
> public, then he silently droped it. This was "only" retransmit.
Ok.
I think your flushcache thing is safe in the new code, and I'm more than
happy for the PM changes against the new code to use sysfs to go into
the tree. 2.5.47-ac2 has pretty current ide - there isnt anything going
to get moved around dramatically again just yet (I wamt to move the
disk, tape, floppy,... drivers into a subdir later but not yet)
Alan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/