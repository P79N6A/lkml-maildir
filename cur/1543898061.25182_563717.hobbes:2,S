Date: Fri, 29 Jun 2007 16:55:47 +0100
From: David Woodhouse <>
Subject: Re: [PATCH] LinuxPPS (with new syscalls API) - new version
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/29/184

On Fri, 2007-06-29 at 17:08 +0200, Rodolfo Giometti wrote:
> 
> +asmlinkage long sys_time_pps_fetch(int source, const int tsformat,
> +                                       struct pps_info __user *info, 
> +                                       const struct timespec __user *timeout)
> +{
> +       int ret;
> +       struct timespec to;
> +
> +       if (timeout) {
> +               ret = copy_from_user(&to, timeout, sizeof(struct timespec));
> +               if (ret)
> +                       return ret; 
You missed one. This should be -EFAULT too. And there's not a huge
amount of point in keeping the access_ok() checks elsewhere, since
copy_to_user() does that for itself.
Oh, and I think you do need compat magic for 'struct pps_info' and
'struct pps_params' too -- there's a struct timespec hidden deep in
there, as well as 'unsigned long longpad[3]'.
Can you explain the 'union pps_timeu'? It seems very odd. How do we know
which member of the union should be used?
-- 
dwmw2
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/