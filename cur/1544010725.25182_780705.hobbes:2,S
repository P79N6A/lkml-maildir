Date: Mon, 15 Dec 2008 22:23:54 +0530
From: Jaswinder Singh <>
Subject: [PATCH] x86: process_64.c declare __switch_to and sys_arch_prctl before they get used
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/15/178

Signed-off-by: Jaswinder Singh <jaswinder@infradead.org>
In asm/system.h moved out __switch_to from CONFIG_X86_32 as it is common for both 32 and 64 bit.
In asm/pctl.h defined sys_arch_prctl
---
 arch/x86/include/asm/prctl.h  |    3 +++
 arch/x86/include/asm/system.h |    4 ++--
 2 files changed, 5 insertions(+), 2 deletions(-)
diff --git a/arch/x86/include/asm/prctl.h b/arch/x86/include/asm/prctl.h
index fe68114..a889464 100644
--- a/arch/x86/include/asm/prctl.h
+++ b/arch/x86/include/asm/prctl.h
@@ -6,5 +6,8 @@
 #define ARCH_GET_FS 0x1003
 #define ARCH_GET_GS 0x1004
 
+#ifdef CONFIG_X86_64
+extern long sys_arch_prctl(int, unsigned long);
+#endif /* CONFIG_X86_64 */
 
 #endif /* _ASM_X86_PRCTL_H */
diff --git a/arch/x86/include/asm/system.h b/arch/x86/include/asm/system.h
index f2025b0..2f6340a 100644
--- a/arch/x86/include/asm/system.h
+++ b/arch/x86/include/asm/system.h
@@ -17,12 +17,12 @@
 # define AT_VECTOR_SIZE_ARCH 1
 #endif
 
-#ifdef CONFIG_X86_32
-
 struct task_struct; /* one of the stranger aspects of C forward declarations */
 struct task_struct *__switch_to(struct task_struct *prev,
 				struct task_struct *next);
 
+#ifdef CONFIG_X86_32
+
 /*
  * Saving eflags is important. It switches not only IOPL between tasks,
  * it also protects other tasks from NT leaking through sysenter etc.
-- 
1.5.5.1