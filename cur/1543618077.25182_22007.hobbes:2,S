Date: Mon, 21 Jan 2002 11:35:49 +0100
From: Jens Axboe <>
Subject: Re: Linux 2.5.3-pre1-aia1 (fwd)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/1/21/53

On Mon, Jan 21 2002, Andre Hedrick wrote:
> @@ -189,13 +189,14 @@
>  	memset(&taskfile, 0, sizeof(task_struct_t));
>  	memset(&hobfile, 0, sizeof(hob_struct_t));
> 
> -	sectors = rq->nr_sectors;
>  	if (sectors == 256)
>  		sectors = 0;
> -	if (command == WIN_MULTWRITE_EXT || command == WIN_MULTWRITE) {
> +	if (command == WIN_MULTWRITE) {
>  		sectors = drive->mult_count;
>  		if (sectors > rq->current_nr_sectors)
>  			sectors = rq->current_nr_sectors;
> +		if (sectors != drive->mult_count)
> +			command = WIN_WRITE;
I think this is too restrictive, something ala
		if (sectors % drive->mult_count)
			command = WIN_WRITE;
should suffice. However, we still need to cover the read... So something
like this maybe:
	if (sectors % drive->mult_count)
		don't use multi write _or_ read, use WIN_{READ,WRITE}
	/* usual setup */
> -	sectors = rq->nr_sectors;
> -	if (sectors == 256)
> +	if (sectors == 65536)
>  		sectors = 0;
Yeah this was my silly, sorry.
-- 
Jens Axboe
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/