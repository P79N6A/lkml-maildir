Date: Mon, 17 Mar 2008 22:09:00 +0100
From: Anders Eriksson <>
Subject: Re: Linux 2.6.25-rc4
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/17/311

torvalds@linux-foundation.org said:
> Can you try to sprinkle printk's around to see where it actually ends up
> stopping?
> Since all special commands should now go through the taskfile interface
> (Bartlomiej - correct?), I guess just a printk() at the top of
> do_rw_taskfile() should at least get the ball rolling. Even something that
> just prints out task->data_phase and tf->command would start to unravel at
> least what the last command is before it hangs.. 
Tossing a prink in like so:
ide_startstop_t do_rw_taskfile (ide_drive_t *drive, ide_task_t *task)
{
        ide_hwif_t *hwif        = HWIF(drive);
        struct ide_taskfile *tf = &task->tf;
        ide_handler_t *handler = NULL;
        printk("do_rw_taskfile(task->data_phase=%i, tf->command=%i\n",task->data_phase,tf->command);
        if (task->data_phase == TASKFILE_MULTI_IN ||
Yields:
Mar 17 21:57:29 tippex smartd[5810]: smartd version 5.37 [i686-pc-linux-gnu] Copyright (C) 2002-6 Bruce Allen
Mar 17 21:57:29 tippex smartd[5810]: Home page is 
http://smartmontools.sourceforge.net/
Mar 17 21:57:29 tippex smartd[5810]: Opened configuration file /etc/smartd.conf
Mar 17 21:57:29 tippex do_rw_taskfile(task->data_phase=32, tf->command=37
Mar 17 21:57:29 tippex do_rw_taskfile(task->data_phase=1, tf->command=236
Mar 17 21:57:29 tippex smartd[5810]: Configuration file /etc/smartd.conf parsed.
Mar 17 21:57:29 tippex smartd[5810]: Device: /dev/hda, opened
Mar 17 21:57:29 tippex do_rw_taskfile(task->data_phase=0, tf->command=176
Mar 17 21:57:29 tippex smartd[5810]: Device: /dev/hda, found in smartd database.
Mar 17 21:57:29 tippex do_rw_taskfile(task->data_phase=0, tf->command=176
Mar 17 21:57:30 tippex do_rw_taskfile(task->data_phase=1, tf->command=176
Mar 17 21:57:30 tippex do_rw_taskfile(task->data_phase=1, tf->command=176
Mar 17 21:57:30 tippex do_rw_taskfile(task->data_phase=1, tf->command=236
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, can't monitor Current Pending Sector count - no Attribute 197
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, can't monitor Offline Uncorrectable Sector count  - no Attribute 198
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, can't monitor Temperature, ignoring -W Directive
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, appears to lack SMART Self-Test log; disabling -l selftest (override with -T permissive Directive)
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, appears to lack SMART Error log; disabling -l error (override with -T permissive Directive)
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, is SMART capable. Adding to "monitor" list.
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, opened
Mar 17 21:57:30 tippex smartd[5810]: Device: /dev/hda, found in smartd database.
Mar 17 21:57:30 tippex do_rw_taskfile(task->data_phase=0, tf->command=176
Mar 17 21:57:30 tippex do_rw_taskfile(task->data_phase=1, tf->command=176
Mar 17 21:58:00 tippex hda: lost interrupt
And the usual freeze. This is on -rc5 with Barts latest suggestion.
next?
/A