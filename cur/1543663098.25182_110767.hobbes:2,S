Date: 18 Feb 2003 21:49:27 +0100
From: Benjamin Herrenschmidt <>
Subject: Re: PATCH: make the sl82c105 work again
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/2/18/199

On Tue, 2003-02-18 at 19:53, Russell King wrote:
> On Tue, Feb 18, 2003 at 06:34:29PM +0000, Alan Cox wrote:
> > +	hwif->drives[0].pio_speed = XFER_PIO_0;
> > +	hwif->drives[0].autotune = 1;
> > +	hwif->drives[1].pio_speed = XFER_PIO_1;
> > +	hwif->drives[1].autotune = 1;
> 
> Is there some reason why drive 1 is PIO 1 and drive 0 is PIO 0 ?
No, just a typo from me that I forgot to send a patch for.
There is also still a problem. If DMA fails, the main IDE layer
goes back to PIO, that works, and then goes back to DMA, it
calls hwif->ide_dma_on() from IRQ with lock held etc...
The problem is that if I fix that, that means the proper setting
up of the disk for DMA etc... will not be done in ide_dma_on
anymore but only on ide_dma_check() (so once upon discovery)
and when setting xfer mode. Not on hdparm -d1. I'm still wondering
what is the best fix for that. For ide-pmac, I did the later
(only do the job in check()), but I also think we should change
ide.c to actually call hwif->ide_dma_check() when DMA is turned
ON with hdparm instead of ide_dma_on().
Ben.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/