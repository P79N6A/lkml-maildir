Date: Tue, 01 Jun 1999 11:32:58 +0200
From: Jorge Gonzalez Villalonga <>
Subject: Re:
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/6/1/37

Cristian Prevedello wrote:
> 
>  Good morning,
>  i've an intel server (slink) which export homes over nfs.
>  The client (a sparc with slink) use autofs to mount dinamically homes.
>  The problem is with quota, which is ignored if i use autofs to mount only
>  user's home which are currently logged and not the entire filesystem.
>  The quota works perfectly if i mount the entire file system
>  (mount -t nfs server-name:/home-dir /home).
> 
>  I use a configuration like this for autofs
> 
>  /etc/auto.master
> 
>  /home   yp auto.home
> 
>  and the auto.home nismap contains entry like these
>  plasma chiara.dei.unipd.it:/home/plasma
> 
>  Since the quota should be checked be the server, it's a server problem, i
>  think nfs-server. Any idea why this strange behaviour?
> 
>  thank in advance
>  regards
>      Cristian Prevedello
I have the same problem with  a RH5.2 server over here, and the problem
is the user-space nfs server: when it writes to a file, it does so as
root, and not the user, so quotas are not checked. I did a
very-very-very-ugly hack to the nfs daemon to do the checking, but it
involved doing a stat for each write to the file, and it hurts
performance very badly (yes, performance is even worse than before! ;-).
I don't think hacking it is worth the time, since the kernel-space nfs
server does quotas well (i have checked it in the source - in fact I
took the hack from there), and it seems to get going quite well; I'm
testing it thoroughly, and probably will go kernel-nfs by next academic
year - which in Spain happens to be in september.
Cheers
Jorge
-- 
Jorge Gonzalez  <jorgegv@icai.upco.es>       -o)
ICAI - Universidad Pontificia Comillas       /\\
Administrador de Sistemas                   _\_v
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/