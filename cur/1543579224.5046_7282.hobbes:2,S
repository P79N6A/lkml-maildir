Date: Thu, 18 Jan 2001 16:39:18 +0000 (GMT)
From: Hugh Dickins <>
Subject: [PATCH] udf writepage UnlockPage
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/1/18/78

Although fs/udf's args to writepage() were updated in 2.4.0-test12,
its page unlocking was overlooked.  udf_adinicb_writepage() should
now UnlockPage, udf_expand_file_adinicb() should not now UnlockPage
after udf_writepage i.e. block_write_full_page.  Al Viro posted a
patch for the latter, still lurking in Alan's -ac9; the former seems
to have gone unnoticed.  Warning: from source inspection: untested.
Hugh
--- linux-2.4.1-pre8/fs/udf/file.c	Fri Dec 29 22:07:57 2000
+++ linux/fs/udf/file.c	Thu Jan 18 15:42:11 2001
@@ -86,6 +86,7 @@
 	brelse(bh);
 	SetPageUptodate(page);
 	kunmap(page);
+	UnlockPage(page);
 	return 0;
 }
 
--- linux-2.4.1-pre8/fs/udf/inode.c	Tue Dec  5 17:41:51 2000
+++ linux/fs/udf/inode.c	Thu Jan 18 15:43:50 2001
@@ -203,7 +203,6 @@
 	udf_release_data(bh);
 
 	inode->i_data.a_ops->writepage(page);
-	UnlockPage(page);
 	page_cache_release(page);
 
 	mark_inode_dirty(inode);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/