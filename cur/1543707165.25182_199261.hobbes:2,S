Date: Tue, 17 Feb 2004 13:30:49 +0100
From: Vincent ROQUETA <>
Subject: A little bug in quotas ext3 2.6.3-rc3-mm1 patch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/17/75

kernel patch 2.6.3-rc3-mm1
file : /fs/ext3/super.c
+static int
+ext3_quota_on(struct super_block *sb, int type, int format_id, char *path)
+{
+       int err;
+       struct nameidata nd;
+
+       if (!EXT3_SB(sb)->s_qf_names[0] && !EXT3_SB(sb)->s_qf_names[1]) {
+               /* Not journalling quota? */
+               return vfs_quota_on(sb, type, format_id, path);
+       }
+       err = path_lookup(path, LOOKUP_FOLLOW, &nd);
+       if (err)
+               return err;
+       if (nd.mnt->mnt_sb != sb)       /* Quotafile not on the same fs? */
+               return -EXDEV;
+       if (nd.dentry->d_parent->d_inode != sb->s_root->d_inode) {
+               /* Quotafile not of fs root? */
+               printk(KERN_WARNING "EXT3-fs: Quota file not on filesystem "
+                               "root. Journalled quota will not work\n");
	} /* Close if ...*/
+       if (!ext3_should_journal_data(nd.dentry->d_inode))
+               printk(KERN_WARNING "EXT3-fs: Quota file does not have "
+                       "data-journalling. Journalled quota will not
 work\n"); +       path_release(&nd);
+       return vfs_quota_on(sb, type, format_id, path);
+}
+
 #endif
-------------------------------------------------------
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/