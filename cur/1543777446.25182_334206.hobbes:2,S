Date: Sun, 17 Jul 2005 11:51:59 -0500
From: 	ericvh@gmail ...
Subject: [PATCH 2.6.13-rc2-mm2] v9fs: fix problems spotted in previous patchset (2.0.2)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/7/14/215

Fix formating errors and a memory leak that crept in the
previous round of revisions to v9fs.  These will be reincorperated 
into the patchset and resent to akpm.
Signed-off-by: Eric Van Hensbergen <ericvh@gmail.com>
---
commit 22d785a22895513c6ab67dfa53c25b8b833fe235
tree 88822e96e339bf071d63576c87a15ddc7f4419b6
parent fe7cd649688d12dfaeeef2c594d131584c488dcd
author Eric Van Hensbergen <ericvh@gmail.com> Thu, 14 Jul 2005 16:22:29 -0500
committer Eric Van Hensbergen <ericvh@gmail.com> Thu, 14 Jul 2005 16:22:29 -0500
 fs/9p/fid.c       |    2 +-
 fs/9p/mux.c       |    6 +++---
 fs/9p/vfs_file.c  |    5 +++--
 fs/9p/vfs_inode.c |    6 +++---
 4 files changed, 10 insertions(+), 9 deletions(-)
diff --git a/fs/9p/fid.c b/fs/9p/fid.c
--- a/fs/9p/fid.c
+++ b/fs/9p/fid.c
@@ -206,7 +206,7 @@ struct v9fs_fid *v9fs_fid_lookup(struct 
 			/* TODO: take advantage of multiwalk */
 
 			fidnum = v9fs_get_idpool(&v9ses->fidpool);
-			if(fidnum < 0) {
+			if (fidnum < 0) {
 				dprintk(DEBUG_ERROR,
 					"could not get a new fid num\n");
 				return return_fid;
diff --git a/fs/9p/mux.c b/fs/9p/mux.c
--- a/fs/9p/mux.c
+++ b/fs/9p/mux.c
@@ -262,7 +262,7 @@ v9fs_mux_rpc(struct v9fs_session_info *v
 	ret = v9fs_send(v9ses, &req);
 
 	if (ret < 0) {
-		if(tcall->id != TVERSION)
+		if (tcall->id != TVERSION)
 			v9fs_put_idpool(tid, &v9ses->tidpool);
 		dprintk(DEBUG_MUX, "error %d\n", ret);
 		return ret;
@@ -313,7 +313,7 @@ v9fs_mux_rpc(struct v9fs_session_info *v
 	}
 
       release_req:
-	if(tcall->id != TVERSION)
+	if (tcall->id != TVERSION)
 		v9fs_put_idpool(tid, &v9ses->tidpool);
 	if (rcall)
 		*rcall = fcall;
@@ -345,7 +345,7 @@ static int v9fs_recvproc(void *data)
 		req = rptr = rreq = NULL;
 
 		rcall = kmalloc(v9ses->maxdata + V9FS_IOHDRSZ, GFP_KERNEL);
-		if(!rcall) {
+		if (!rcall) {
 			eprintk(KERN_ERR, "no memory for buffers\n");
 			break;
 		}
diff --git a/fs/9p/vfs_file.c b/fs/9p/vfs_file.c
--- a/fs/9p/vfs_file.c
+++ b/fs/9p/vfs_file.c
@@ -381,9 +381,10 @@ v9fs_file_write(struct file *filp, const
 	ret = copy_from_user(buffer, data, count);
 	if (ret) {
 		dprintk(DEBUG_ERROR, "Problem copying from user\n");
-		return -EFAULT;
-	} else
+		ret = -EFAULT;
+	} else {
 		ret = v9fs_write(filp, buffer, count, offset);
+	}
 
 	kfree(buffer);
 
diff --git a/fs/9p/vfs_inode.c b/fs/9p/vfs_inode.c
--- a/fs/9p/vfs_inode.c
+++ b/fs/9p/vfs_inode.c
@@ -666,7 +666,7 @@ v9fs_vfs_rename(struct inode *old_dir, s
 
 	dprintk(DEBUG_VFS, "\n");
 
-	if(!mistat)
+	if (!mistat)
 		return -ENOMEM;
 
 	if ((!oldfid) || (!olddirfid) || (!newdirfid)) {
@@ -934,7 +934,7 @@ v9fs_vfs_symlink(struct inode *dir, stru
 	dprintk(DEBUG_VFS, " %lu,%s,%s\n", dir->i_ino, dentry->d_name.name,
 		symname);
 
-	if(!mistat)
+	if (!mistat)
 		return -ENOMEM;
 
 	if (!v9ses->extended) {
@@ -1217,7 +1217,7 @@ v9fs_vfs_mknod(struct inode *dir, struct
 	dprintk(DEBUG_VFS, " %lu,%s mode: %x MAJOR: %u MINOR: %u\n", dir->i_ino,
 		dentry->d_name.name, mode, MAJOR(rdev), MINOR(rdev));
 
-	if(!mistat)
+	if (!mistat)
 		return -ENOMEM;
 
 	if (!new_valid_dev(rdev)) {
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/