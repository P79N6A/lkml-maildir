Date: Wed, 9 Aug 2000 09:16:27 +0200 (CEST)
From: Mike Galbraith <>
Subject: Re: [2.4.x] Loop deadlock workaround?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/9/13

On Tue, 8 Aug 2000, Aaron Tiensivu wrote:
> So far so good.. I've mounted my loopback ext2 partition with 'sync' mount options.. 
> 
> Am I just lucky or is this a valid workaround until loop gets fixed?
Hi Aaron,
AFAIKT, Linus fixed the deadlock problem.  Do you have a formula for
locking the thing up with a post test6-pre5 kernel?
The only problems I'm aware of with the loop device atm are:
1.  Strange problem whereby read errors occur (only under vm stress)
    iff bs=1k and mount -oloop blkdev is used.. mount -oremount,loop
    previously mounted blkdev works fine 100% of the time. [1]
2.  Lack of large file support for filebacked device.
	-Mike
1.  If someone would confirm/deny this, I'd be grateful.  This is too
    weird to be real :-/ trouble is it's 100% repeatable here.
HowToReproduce:
create 1k bs fs;mount it;copy kernel source into same
unmount fs;mount -oloop fs
make dep;make -jN bzImage [N is enough to make your box swap heartily]
	(here: watch cpp bitch like crazy after vm pressure builds)
umount fs
mount fs;mount -oremount,loop fs
make dep;make -jN bzImage
	(here: watch it always work fine)
repeat many times in any order you like, then try same with 4k bs.
	(here: watch it always work fine with 4k bs.. smoke pours out ears;)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/