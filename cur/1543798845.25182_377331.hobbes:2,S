Date: Sun, 18 Dec 2005 12:05:08 +0000
From: Alan Cox <>
Subject: Re: IT821x driver
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/18/22

On Sul, 2005-12-18 at 06:22 -0500, Kernel - Noah Blumenfeld wrote:
> As far as I can tell - and from the information within the driver's file 
>   /drivers/ide/pci/it821x.c - the current driver does not support mwdma 
> or dma, only udma. It also says that if - and I quote Alan Cox -
The 2.6.14 kernel has a version of the driver built in that should
support all modes properly. In hardware raid mode DMA mode selection is
handled by the controller and we actually don't deal with it.
In pass through/atapi supporting mode we handle the mode selection and
support MWDMA/UDMA. The chip is really designed to be best for UDMA (as
you'd expect) but does handle other modes.
> Is there a way to restrict the size of the files being written by the 
> kernel to a hardware device? I.e. make it so it will not write LBA48 
We do the following in init_hwif_it821x already
    if(conf & 1) {
                idev->smart = 1;
                hwif->atapi_dma = 0;
                /* Long I/O's although allowed in LBA48 space cause the
                   onboard firmware to enter the twighlight zone */
                hwif->rqsize = 256;
        }
So the driver should be doing this correctly. Also for DMA on the smart
mode, use hdparm -d1, but don't try and program the drives - that is
handled by the controller and that may be upsetting it. Let me know if
that helps.
If you are doing raid0 btw its faster in non-raid mode and using
software raid. In raid1 it seems to be faster to use the chip in smart
mode.
Alan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/