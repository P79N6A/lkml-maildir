Date: Fri, 24 Aug 2007 19:21:55 -0700
From: Matt Colyer <>
Subject: Re: [linux-usb-devel] [RFC] USB: driver for iphone charging
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/25/13

On Fri, 2007-08-24 at 14:55 -0400, Alan Stern wrote:
> On Fri, 24 Aug 2007, Greg KH wrote:
> 
> > Can someone with a iphone test this out?  If you look at how the
> > berry_charge driver does it, the set_config stuff happens after the
> > magic command.  As I don't have an iphone, nor have I ever seen any
> > dumps of the command streams, I don't really know if the set_config
> > message really is necessary or not.
> 
> You know, now that I think back on it, it may be that the Set-Config
> really does have to come after the magic command.  Perhaps it triggers
> the changeover.  In which case the subroutine should look like this:
> 
Hi all,
 I was the one who wrote the patch initially (sorry I haven't been able
to chime in sooner). It turns out that the configuration must be set
after the magic command (I tried both versions of the code tonight and
only the one which changes the configuration after the command works).
That said, I am not opposed to using a userspace program to accomplish
this task (I tried to pursue that avenue at first and couldn't find a
way to do, probably because it doesn't exist yet). I don't really have
much experience in this area, so I am not really sure how to proceed.
However the other part of this puzzle is that when you call lsusb the
iPhone disconnects from the bus. Greg suggested that it might be an
issue with the USB_SUSPEND support being broken on the iPhone and he
suggested I tried adding it to the quirks.c file. I'll be sure to let
you guys know when I figure it out.
-Matt
[unhandled content-type:application/pgp-signature]