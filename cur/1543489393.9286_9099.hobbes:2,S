Date: Tue, 9 Mar 1999 18:00:33 -0700 (MST)
From: Godmar Back <>
Subject: mountd not responding in 2.2.3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/3/10/20

 Hi, I'm not really sure this is the right mailing list for this,
but the problem occurred after updating to 2.2.3 on my RH 5.2 box.
It's probably not a kernel problem, but it did show up for me in 
conjunction with installing a new kernel.
So, if you feel this is the wrong mailing list for that, take replies
to "unfsd@monad.swb.de" only and please cc me since I don't know where
unfsd@monad.swb.de is archived.
Thank you for your attention.
I'm just posting this in case it rings a bell for anyone.
Having tackled the NFS client side (see separate thread), I'm now looking 
at the server side.  I'm using the userland "Universal NFS Server 2.2beta40"
After I reboot, RH 5.2 starts rpc.mountd and rpc.nfsd just fine, but 
mountd does not respond.
rpcinfo shows that portmap registered it just fine:
gback@marker [7](~) > rpcinfo -p peerless
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100007    2   udp    803  ypbind
    100007    2   tcp    805  ypbind
    100005    1   udp    635  mountd
    100005    2   udp    635  mountd
    100005    1   tcp    635  mountd
    100005    2   tcp    635  mountd
    100003    2   udp   2049  nfs
    100003    2   tcp   2049  nfs
    300019    1   tcp    915  amd
    300019    1   udp    916  amd
    100021    1   udp   1024  nlockmgr
    100021    3   udp   1024  nlockmgr
    100021    1   tcp   1024  nlockmgr
    100021    3   tcp   1024  nlockmgr
Portmap works just fine too, I can talk to other services:
gback@marker [5](~) > rpcinfo -t peerless  100007
program 100007 version 2 ready and waiting
I cannot talk to mountd, however:
    rpcinfo -t peerless 100005
    rpcinfo -t peerless 100005 1
    rpcinfo -t peerless 100005 2
    rpcinfo -u peerless 100005 
    rpcinfo -u peerless 100005 1
    rpcinfo -u peerless 100005 2
all fail with
    rpcinfo: RPC: Timed out
Now when I type "netstat -t inet" on the machine on which rpc.mountd
runs, I see this:
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp       45      0 peerless.cs.utah.ed:635 marker.cs.utah.edu:1249 CLOSE_WAIT  
This looks to me as though rpc.mountd does not pick up the data.
Note that this happened already with the 2.2beta37 version that came
with RH 5.2; upgrading to beta40 didn't make a difference.
[root@peerless init.d]# rpc.mountd -v
Universal NFS Server 2.2beta40
Now comes the funny part.
I stop and restart nfs (both rpc.nfsd and rpc.mountd) like so:
	cd /etc/rc.d/init.d
	./nfs stop
	./nfs start
Nothing changes (i.e., rpcinfo still fails.)
Now, I manually look up the pid of rpc.mountd:
    [root@peerless init.d]# pidof rpc.mountd
    565
Kill it:
    [root@peerless init.d]# kill 565
and start it manually like so:
    [root@peerless init.d]# rpc.mountd
and voila, mountd responds.
gback@marker [15](~) > rpcinfo -t peerless 100005
program 100005 version 1 ready and waiting
program 100005 version 2 ready and waiting
and subsequently, it exports the filesystems like it should.
So, my question is this:
What weird interaction of kernel version, NFS server version and RedHat
setup do I fall victim here?
A second question: would people recommend I use the in-kernel nfsd instead?
Does this in-kernel nfsd also use an in-kernel mountd?  What's the future
outlook here?
Thanks,
	- Godmar
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/