Date: Thu, 7 Sep 2000 02:19:48 +0200
From: Andries Brouwer <>
Subject: Re: [PATCH?] Extended PTBL partition check for 2.4
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/6/93

On Thu, Sep 07, 2000 at 12:42:42AM +0200, Luca Montecchiani wrote:
> few ours ago I discover that my kernel 2.4.0-test8pre5 was unable to
> correctly identify the geometry of my second ide HD (*),
Always remember: a disk does not have a geometry.
> this is very bad
Why precisely?
> and fdisk come out with a lot of warnings
Ignore them if you do not also have DOS/Windows on the same disk.
> Follow the patch that works for me (tm):
> 
> --- msdos.c.ORI Wed Jul 19 08:29:16 2000
> +++ msdos.c     Wed Sep  6 23:46:29 2000
> @@ -398,9 +398,10 @@
>                         struct partition *q = &p[i];
>                         if (NR_SECTS(q)) {
>                                 if ((q->sector & 63) == 1 &&
> -                                   (q->end_sector & 63) == 63)
> +                                   (q->end_sector & 63) == 63) {
>                                         heads = q->end_head + 1;
> -                               break;
> +                                       break;
> +                               }
>                         }
>                 }
>                 if (SYS_IND(p) == EZD_PARTITION) {
Yes, nothing wrong with your patch.
(There will be minor differences between 2.4.0 and 2.2.x and 2.0.x -
after writing the code for 2.3.21 or so, a largish change, I made
a smaller change to 2.2.14 and a still smaller change to 2.0.38.
That means that there will be people who see a different geometry
when they upgrade. That does not matter at all. On the one hand
one can always force a desired geometry by giving kernel boot
parameters or, for recent kernels, by echoing the desired numbers
to the appropriate /proc file. On the other hand, this geometry
only affects LILO and *fdisk. When there are LILO problems,
give the "linear" keyword or use a modern LILO. When fdisk warns
and there are no other operating systems on the same disk, ignore
the warnings. If there are, specify the desired geometry to fdisk.)
I think I prefer the current version over your patched version.
But will probably change my mind when many people complain.
Andries
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/