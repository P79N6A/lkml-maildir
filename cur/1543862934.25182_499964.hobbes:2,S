Date: Thu, 18 Jan 2007 08:52:49 -0800
From: Brian Beattie <>
Subject: Re: A question about break and sysrq on a serial console (2.6.19.1)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/18/117

On Thu, 2007-01-18 at 16:47 +0000, Russell King wrote:
> On Thu, Jan 18, 2007 at 08:19:47AM -0800, Brian Beattie wrote:
> > On Thu, 2007-01-18 at 09:13 +0000, Russell King wrote:
> > > On Wed, Jan 17, 2007 at 03:56:54PM -0800, Brian Beattie wrote:
> > > > I'm trying to do a SYSRQ over a serial console.  As I understand it a
> > > > break will do that, but I'm not seeing the SYSRQ.  In looking at
> > > > uart_handle_break() in drivers/serial/8250.c it looks like the code will
> > > > toggle port->sysrq, rather than just setting it when the port is a
> > > > console.  I think the correct code would be to move the "port->sysrq =
> > > > 0;" to follow the closing brace on the next line, or am I missing
> > > > something.
> > > 
> > > Thereby preventing the action of <break> (which may be to cause a SAK
> > > event, which would be rather important on a console to ensure that
> > > you're really logging in rather than typing your password into another
> > > users program which just looks like a login program.)
> > > 
> > > Note that the sequence for sysrq is:
> > > 
> > > (non-break characters or nothing) <break> <sysrq-char>
> > > 
> > well the code as is, is not working.  Printk's tell me that
> > uart_handle_break() is called repeatedly while the break condition is
> > active, toggling port->sysrq so that it's a 50/50 chance on whether
> > port->sysrq will be set or cleared when the break condition ends.  On
> > the other hand the 8250 break condition handling code is not working
> > anyway, so the problem may be that the 8250 code is not calling
> > uart_handle_break() correctly.
> 
> Please learn to use the "reply to all" button when using mailing lists.
I don't post much to LKML, I realized after I hit send I needed to reply
all.
> 
> Works fine here.  Which UART are you actually using?  At a guess, it's
> probably a bad clone which does not have a correct break implementation.
it's the built-in mpc8349 powerpc uart.
> 
-- 
Brian Beattie
Firmware Engineer
APCON, Inc.
BrianB@apcon.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/