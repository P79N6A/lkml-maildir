Date: Wed, 10 Nov 1999 15:06:56 -0700
From: "Jeff V. Merkey" <>
Subject: Re: Getting IOCTL's into VFS File System Drivers
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/10/162

Also,
Along the same lines, it would be really cool if the fsck capability was
made a part of the VFS as a function call (which is how it is in Windows
2000 FS drivers), so Linux could have a single FSCK utility that would
do file system fixup on all of the FS's in the kernel, rather than
requiring each FS to provide it's own.  In the Microsoft Windows 2000
Implementation, it's implemented as a single function call that gets
invoked automatically (or manually) when a volume mount fails.  They did
it this way so that all their Windows tools would work with the
different file system drivers without having to need a specially written
program for each file system.  They also have hooks for file system
defrag, and backup/restore integrated into their IFS.  If we could
extend the VFS to do the same types of things, it would mean Linux would
only need a single set of "generic" file system repair, defrag, and
backup/restore utilities that would work with all the FS drivers in
Linux.
Just a suggestion.
Jeff
"Jeff V. Merkey" wrote:
> 
> Alan/Ingo/Pavel,
> 
> Do you one you guys know a good way to get IOCTL calls into the FS
> drivers?  I noticed there is an IOCTL path for FILE objects, but there
> does not appear to be a general purpose IOCTL call to the File System
> Drivers themselves (but there is to symbolic devices files created by
> these FS's).  I basically need this for the utilities that create and
> config volumes and mirroring so I can query as to whether a file system
> is mounted from the tools, and prohibit users from blowing away volume
> segments, namespaces, etc. while a volume is mounted.  There are also
> some question/answer stuff during boot from a Netware file system if
> NWFSCK (Netware volume repair utility) gets invoked due to mounting
> problems.  I need to be able to pass back and forth, such as asking
> whether an imcomplete mirror group should be activated and failing
> mirrors dropped during system boot if FS errors are detected.
> 
> I am calling open() from the utilities with symbolic handles for device
> objects (i.e. /dev/hda, /dev/hdb, etc.) and this is how I am creating
> partitions, volumes, etc.  Is there a symbolic handle that will map to
> the FS driver so I can pass IOCTL commands between the utilities and the
> file system driver, like /proc/filesystems/nwfs or something to that
> effect?  I religously poured over the code in Linux until 4 a.m. this
> morning, and it doesn't look like this is supported.
> 
> Thanks in advance for the fabulous help.
> 
> Jeff
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/