Date: Wed, 16 Jan 2008 23:25:31 +0100
From: Bartlomiej Zolnierkiewicz <>
Subject: Re: [PATCH 10/12] ide-floppy: remove atomic test_*bit macros
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/16/372

On Tuesday 15 January 2008, Borislav Petkov wrote:
[...]
> .. this is the second one...
> 
> 
> From: Borislav Petkov <bbpetkov@yahoo.de>
> Date: Tue, 15 Jan 2008 20:49:18 +0100
> Subject: [PATCH 16/18] ide-floppy: remove atomic test_*bit macros
> 
> ..and replace them with flag enums.
> 
> Signed-off-by: Borislav Petkov <bbpetkov@yahoo.de>
applied
[...]
> @@ -1713,13 +1723,16 @@ static int idefloppy_media_changed(struct gendisk *disk)
>  {
>  	struct ide_floppy_obj *floppy = ide_floppy_g(disk);
>  	ide_drive_t *drive = floppy->drive;
> +	int ret;
> 
>  	/* do not scan partitions twice if this is a removable device */
>  	if (drive->attach) {
>  		drive->attach = 0;
>  		return 0;
>  	}
> -	return test_and_clear_bit(IDEFLOPPY_MEDIA_CHANGED, &floppy->flags);
> +	ret = floppy->flags & IDEFLOPPY_FLAG_MEDIA_CHANGED;
> +	floppy->flags &= ~IDEFLOPPY_FLAG_MEDIA_CHANGED;
> +	return ret;
>  }
this chunk (idefloppy_media_changed() return value is now 2 instead of 1
if IDEFLOPPY_FLAG_MEDIA_CHANGED flag is set) seems to have slipped through
[ I fixed it while merging the patch ]