Date: Wed, 8 Mar 2000 23:30:24 +0000 (GMT)
From: Matthew Kirkwood <>
Subject: Re: [PATCH] towards a /proc-less user space
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/8/137

On Wed, 8 Mar 2000, Erik Andersen wrote:
> > > [andersen@slag andersen]$ strace lsmod 2>&1 | grep proc
> > > open("/proc/modules", O_RDONLY)         = 3
> > matthew@jim:~$ strace /sbin/lsmod 2>&1 | grep proc
> [andersen@slag andersen]$ dpkg -l modutils strace  | tail -n2
> ii  modutils       2.3.9-3        Linux module utilities.
> ii  strace         4.2-4          A system call tracer.
matthew@timmy:~$ rpm -q strace
strace-3.99.1-2
> I don't know where you got your strace, but I suspect it is broken.  
> If it is indeed working, I would dearly love to see the interface
> lsmod used to get the kernel module information.
'tis attached.
I'm not disputing that it doesn't work for you, but it would
make some sense to fix the existing interface if it's broken,
rather than add new ones.
Matthew.
execve("/sbin/lsmod", ["/sbin/lsmod"], [/* 34 vars */]) = 0
brk(0)                                  = 0x804a0d8
open("/etc/ld.so.preload", O_RDONLY)    = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY)      = 4
fstat(4, {st_mode=S_IFREG|0644, st_size=19788, ...}) = 0
mmap(0, 19788, PROT_READ, MAP_PRIVATE, 4, 0) = 0x40013000
close(4)                                = 0
open("/lib/libc.so.6", O_RDONLY)        = 4
fstat(4, {st_mode=S_IFREG|0755, st_size=4118299, ...}) = 0
read(4, "\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\250\202"..., 4096) = 4096
mmap(0, 993500, PROT_READ|PROT_EXEC, MAP_PRIVATE, 4, 0) = 0x40018000
mprotect(0x40103000, 30940, PROT_NONE)  = 0
mmap(0x40103000, 16384, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 4, 0xea000) = 0x40103000
mmap(0x40107000, 14556, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x40107000
close(4)                                = 0
mprotect(0x40018000, 962560, PROT_READ|PROT_WRITE) = 0
mprotect(0x40018000, 962560, PROT_READ|PROT_EXEC) = 0
munmap(0x40013000, 19788)               = 0
personality(0 /* PER_??? */)            = 0
getpid()                                = 2084
brk(0)                                  = 0x804a0d8
brk(0x804a278)                          = 0x804a278
brk(0x804b000)                          = 0x804b000
query_module(NULL, 0, NULL, 0)          = 0
fstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 1), ...}) = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x40013000
ioctl(1, TCGETS, {B9600 opost isig icanon echo ...}) = 0
write(1, "Module                  Size  Us"..., 38) = 38
query_module(NULL, QM_MODULES, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
query_module("pcnet_cs", QM_INFO, "\314\213\4\10\0\0\0\0\0\0\0\0\0\0\0\0", 0xbffffb5c) = 0
query_module("pcnet_cs", QM_REFS, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
write(1, "pcnet_cs                7572   1"..., 34) = 34
query_module("8390", QM_INFO, "\0P\5\304\224\35\0\0\31\0\0\0\1\0\0\0", 0xbffffb5c) = 0
query_module("8390", QM_REFS, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
write(1, "8390                    5920   0"..., 45) = 45
query_module("ds", QM_INFO, "\0\200\3\304 \27\0\0\21\0\0\0\0\0\0\0", 0xbffffb5c) = 0
query_module("ds", QM_REFS, "pcnet_cs\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
write(1, "ds                      5740   2"..., 45) = 45
query_module("i82365", QM_INFO, "\0P\3\304l\26\0\0\31\0\0\0\2\0\0\0", 0xbffffb5c) = 0
query_module("i82365", QM_REFS, "pcnet_cs\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
write(1, "i82365                 22640   2"..., 34) = 34
query_module("pcmcia_core", QM_INFO, "\0\240\2\304pX\0\0\31\0\0\0\2\0\0\0", 0xbffffb5c) = 0
query_module("pcmcia_core", QM_REFS, "pcnet_cs\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
write(1, "pcmcia_core            39912   0"..., 55) = 55
query_module("maestro", QM_INFO, "\0\360\1\304\350\233\0\0\21\0\0\0\0\0\0\0", 0xbffffb5c) = 0
query_module("maestro", QM_REFS, "pcnet_cs\0ds\0i82365\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
write(1, "maestro                27100   0"..., 34) = 34
query_module("soundcore", QM_INFO, "\0p\1\304\334i\0\0\31\0\0\0\0\0\0\0", 0xbffffb5c) = 0
query_module("soundcore", QM_REFS, "pcnet_cs\0ds\0i82365\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 0xbffffb5c) = 0
write(1, "soundcore               2372   2"..., 44) = 44
munmap(0x40013000, 4096)                = 0
_exit(0)                                = ?