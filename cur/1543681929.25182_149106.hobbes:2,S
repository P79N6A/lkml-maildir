Date: Thu, 17 Jul 2003 15:34:21 +0200
From: "Jean-Luc Coulon (f5ibh)" <>
Subject: 2.4.22-pre, framebuffer issue
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/17/103

Hi,
I've a matrox Mystique. I've compiled the kernel with the framebuffer.
I pass the boot parameter : video=matrox:vesa=0x1b8
It works well with 2.4.21 but with 2.4.22-pre[1-6], at boot, I've a
640x480x8bpp graphics console instead of a 1280x768x24bpp as expected.
After booting, the fbset command works.
Here is the dmesg output for 2.4.21 and 2.4.22-pre1. I use the same
.config file for both (attached).
Linux version 2.4.21 (root@tangerine) (version gcc 3.3.1 20030626 
(Debian prerelease)) #1 jeu jui 17 12:32:21 CEST 2003
BIOS-provided physical RAM map:
  BIOS-e820: 0000000000000000 - 000000000009fc00 (usable)
  BIOS-e820: 000000000009fc00 - 00000000000a0000 (reserved)
  BIOS-e820: 00000000000f0000 - 0000000000100000 (reserved)
  BIOS-e820: 0000000000100000 - 0000000017ffc000 (usable)
  BIOS-e820: 0000000017ffc000 - 0000000017fff000 (ACPI data)
  BIOS-e820: 0000000017fff000 - 0000000018000000 (ACPI NVS)
  BIOS-e820: 00000000ffff0000 - 0000000100000000 (reserved)
383MB LOWMEM available.
On node 0 totalpages: 98300
zone(0): 4096 pages.
zone(1): 94204 pages.
zone(2): 0 pages.
Kernel command line: root=/dev/hda2 reboot=warm hdc=ide-scsi hdd=ide-
scsi pci=biosirq video=matrox:vesa:0x1b8
ide_setup: hdc=ide-scsi
ide_setup: hdd=ide-scsi
Initializing CPU#0
Detected 501.153 MHz processor.
Console: colour VGA+ 80x25
Calibrating delay loop... 999.42 BogoMIPS
Memory: 386904k/393200k available (975k kernel code, 5908k reserved, 
388k data, 80k init, 0k highmem)
Dentry cache hash table entries: 65536 (order: 7, 524288 bytes)
Inode cache hash table entries: 32768 (order: 6, 262144 bytes)
Mount cache hash table entries: 512 (order: 0, 4096 bytes)
Buffer-cache hash table entries: 32768 (order: 5, 131072 bytes)
Page-cache hash table entries: 131072 (order: 7, 524288 bytes)
CPU: L1 I Cache: 32K (32 bytes/line), D cache 32K (32 bytes/line)
CPU:     After generic, caps: 008021bf 808029bf 00000000 00000002
CPU:             Common caps: 008021bf 808029bf 00000000 00000002
CPU: AMD-K6(tm) 3D processor stepping 0c
Checking 'hlt' instruction... OK.
POSIX conformance testing by UNIFIX
mtrr: v1.40 (20010327) Richard Gooch (rgooch@atnf.csiro.au)
mtrr: detected mtrr type: AMD K6
PCI: PCI BIOS revision 2.10 entry at 0xf06c0, last bus=1
PCI: Using configuration type 1
PCI: Probing PCI hardware
PCI: Using IRQ router ALI [10b9/1533] at 00:07.0
Linux NET4.0 for Linux 2.4
Based upon Swansea University Computer Society NET3.039
Initializing RT netlink socket
Starting kswapd
VFS: Diskquotas version dquot_6.4.0 initialized
Journalled Block Device driver loaded
PCI: Found IRQ 10 for device 00:0c.0
matroxfb: Matrox Mystique (PCI) detected
matroxfb: MTRR's turned on
matroxfb: 1024x768x24bpp (virtual: 1024x2729)
matroxfb: framebuffer at 0xE7000000, mapped to 0xd8805000, size 8388608
Console: switching to colour frame buffer device 128x48
fb0: MATROX VGA frame buffer device
Linux version 2.4.22-pre1 (root@tangerine) (version gcc 3.3.1 20030626 
(Debian prerelease)) #1 jeu jui 17 13:59:47 CEST 2003
BIOS-provided physical RAM map:
  BIOS-e820: 0000000000000000 - 000000000009fc00 (usable)
  BIOS-e820: 000000000009fc00 - 00000000000a0000 (reserved)
  BIOS-e820: 00000000000f0000 - 0000000000100000 (reserved)
  BIOS-e820: 0000000000100000 - 0000000017ffc000 (usable)
  BIOS-e820: 0000000017ffc000 - 0000000017fff000 (ACPI data)
  BIOS-e820: 0000000017fff000 - 0000000018000000 (ACPI NVS)
  BIOS-e820: 00000000ffff0000 - 0000000100000000 (reserved)
383MB LOWMEM available.
On node 0 totalpages: 98300
zone(0): 4096 pages.
zone(1): 94204 pages.
zone(2): 0 pages.
Kernel command line: root=/dev/hda2 reboot=warm hdc=ide-scsi hdd=ide-
scsi pci=biosirq video=matrox:vesa=0x1b8 ide_setup: hdc=ide-scsi
ide_setup: hdd=ide-scsi
Initializing CPU#0
Detected 501.152 MHz processor.
Console: colour VGA+ 80x25
Calibrating delay loop... 999.42 BogoMIPS
Memory: 386888k/393200k available (989k kernel code, 5924k reserved, 
388k data, 80k init, 0k highmem)
Dentry cache hash table entries: 65536 (order: 7, 524288 bytes)
Inode cache hash table entries: 32768 (order: 6, 262144 bytes)
Mount cache hash table entries: 512 (order: 0, 4096 bytes)
Buffer-cache hash table entries: 32768 (order: 5, 131072 bytes)
Page-cache hash table entries: 131072 (order: 7, 524288 bytes)
CPU: L1 I Cache: 32K (32 bytes/line), D cache 32K (32 bytes/line)
CPU:     After generic, caps: 008021bf 808029bf 00000000 00000002
CPU:             Common caps: 008021bf 808029bf 00000000 00000002
CPU: AMD-K6(tm) 3D processor stepping 0c
Checking 'hlt' instruction... OK.
POSIX conformance testing by UNIFIX
mtrr: v1.40 (20010327) Richard Gooch (rgooch@atnf.csiro.au)
mtrr: detected mtrr type: AMD K6
PCI: PCI BIOS revision 2.10 entry at 0xf06c0, last bus=1
PCI: Using configuration type 1
PCI: Probing PCI hardware
PCI: Probing PCI hardware (bus 00)
PCI: Using IRQ router ALI [10b9/1533] at 00:07.0
Linux NET4.0 for Linux 2.4
Based upon Swansea University Computer Society NET3.039
Initializing RT netlink socket
Starting kswapd
VFS: Diskquotas version dquot_6.4.0 initialized
Journalled Block Device driver loaded
PCI: Found IRQ 10 for device 00:0c.0
matroxfb: Matrox Mystique (PCI) detected
matroxfb: MTRR's turned on
matroxfb: 640x480x8bpp (virtual: 640x13100)
matroxfb: framebuffer at 0xE7000000, mapped to 0xd8805000, size 8388608
Console: switching to colour frame buffer device 80x30
fb0: MATROX VGA frame buffer device
------------------------------------------------------------------------
                                     ____         __     _
Jean-Luc Coulon (f5ibh)            / __ \ ___   / /_   (_)____ _ ____ 
28 rue d'Evette                   / / / // _ \ / __ \ / // __ `// __ \
90350 Evette-Salbert             / /_/ //  __// /_/ // // /_/ // / / /
France                          /_____/ \___//_.___//_/ \__,_//_/ /_/ 