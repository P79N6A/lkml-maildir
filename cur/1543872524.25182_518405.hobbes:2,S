Date: Fri, 09 Mar 2007 23:01:21 -0800
From: Zachary Amsden <>
Subject: Re: PATCH: Fix VMI and COMPAT_VDSO for 2.6.21
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/10/45

Zachary Amsden wrote:
> VMI is broken under COMPAT_VDSO, as Xen and other non hardware 
> assisted hypervisors will be.  I have been working on a fix for this 
> which works for older glibcs that panic when the new relocatable VDSO 
> is used.  However, I believe at this time that the fix is going to be 
> too radical to consider at this stage in the release of 2.6.21.  We 
> don't expect this config option to be turned on by vendors for new 
> distributions, so at this point we are willing to drop support for it 
> when VMI is compiled in, and work on a patch for 2.6.22 which more 
> fully addresses the problem.
>
> Please apply, thanks.
I suppose it would be better if I attached the patch.
Zach
Signed-off-by: Zachary Amsden <zach@vmware.com>
Index: linux-2.6.21/arch/i386/Kconfig
===================================================================
--- linux-2.6.21.orig/arch/i386/Kconfig	2007-03-06 18:51:33.000000000 -0800
+++ linux-2.6.21/arch/i386/Kconfig	2007-03-09 22:36:15.000000000 -0800
@@ -220,7 +220,7 @@ config PARAVIRT
 
 config VMI
 	bool "VMI Paravirt-ops support"
-	depends on PARAVIRT
+	depends on PARAVIRT && !COMPAT_VDSO
 	help
 	  VMI provides a paravirtualized interface to the VMware ESX server
 	  (it could be used by other hypervisors in theory too, but is not