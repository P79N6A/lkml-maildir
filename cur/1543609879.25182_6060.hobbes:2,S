Date: Thu, 15 Nov 2001 17:41:52 +0100 (CET)
From: Igmar Palsenberg <>
Subject: [PATCH] broken ISDN chargehup
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/11/15/97

Hi,
Applied patch fixes 2 problems :
- If chargeint was > 10, chargehup was activated
- If chargehup was activated, the next call to isdn_net_autohup()
  terminated the link
Both changes makes IPPP idle hangups functional again.
	Regards,
		Igmar
-- 
Igmar Palsenberg
JDI Media Solutions
Boulevard Heuvelink 102
6828 KT Arnhem
The Netherlands
mailto: i.palsenberg@jdimedia.nl
PGP/GPG key : 
http://www.jdimedia.nl/formulier/pgp/igmar
--- linux-2.4.14/drivers/isdn/isdn_net.c.orig	Thu Nov 15 15:21:49 2001
+++ linux-2.4.14/drivers/isdn/isdn_net.c	Thu Nov 15 17:00:40 2001
@@ -369,8 +369,6 @@
 							       l->name, l->chargetime, l->chargeint);
 							isdn_net_hangup(&p->dev);
 						}
-					} else
-						isdn_net_hangup(&p->dev);
 				} else if (l->hupflags & ISDN_INHUP)
 					isdn_net_hangup(&p->dev);
 			}
@@ -2872,7 +2870,7 @@
 		else
 			lp->hupflags &= ~ISDN_INHUP;
 		if (cfg->chargeint > 10) {
-			lp->hupflags |= ISDN_CHARGEHUP | ISDN_HAVECHARGE | ISDN_MANCHARGE;
+			lp->hupflags |= ISDN_HAVECHARGE | ISDN_MANCHARGE;
 			lp->chargeint = cfg->chargeint * HZ;
 		}
 		if (cfg->p_encap != lp->p_encap) {