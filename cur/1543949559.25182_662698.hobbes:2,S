Date: Mon, 3 Mar 2008 18:49:54 +0100
From: Jens Axboe <>
Subject: Re: [RFC PATCH 1/3] block: add rq->complete_io hook for request stacking
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/3/336

On Mon, Mar 03 2008, Hannes Reinecke wrote:
> Hi Kiyoshi,
> 
> Kiyoshi Ueda wrote:
> > This patch adds ->complete_io() hook for request stacking.
> > Request stacking drivers (such as request-based dm) can set
> > a callback for completion.
> > (The hook is not called in blk_end_io(), since request-based dm uses
> >  it for clone completion in the following appendix patches.)
> > 
> [ .. ]
> I would rather have rq->complete_io() to be pointing to blk_end_io in the
> default case, this way rq->complete_io() would always be valid and we
> would be saving us the if() clause.
The whole point of this ->complete_io() thread is that we cannot use the
above approach, before all drivers are converted from using
__blk_end_request() to blk_end_request(). And that requires some work.
-- 
Jens Axboe