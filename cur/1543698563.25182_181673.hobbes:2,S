Date: Thu, 4 Dec 2003 14:36:57 +0100
From: "Tvrtko A. Ur≈°ulin" <>
Subject: Re: 2.4.23-ck1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/12/4/61

On Thursday 04 December 2003 14:31, Tim Schmielau wrote:
> Warning: totally untested. Pretty much obvious, however.
oxygene:/usr/src/linux-2.4.23-ck1 # patch --dry-run 
<../patches/2.4.23-ck1-stat-fix.patch -p1 --global-reject=bla
patching file fs/proc/proc_misc.c
Hunk #1 FAILED at 422.
Hunk #2 FAILED at 460.
2 out of 2 hunks FAILED -- saving rejects to file fs/proc/proc_misc.c.rej
oxygene:/usr/src/linux-2.4.23-ck1 # cat bla
*************** fs/proc/proc_misc.c
*** 422,428 ****
                         (unsigned long long) jiffies_64_to_clock_t(user),
                         (unsigned long long) jiffies_64_to_clock_t(nice),
                         (unsigned long long) jiffies_64_to_clock_t(system),
-                        (unsigned long long) jiffies_64_to_clock_t(jif - user 
-
 nice - system));
         }
         proc_sprintf(page, &off, &len,
                 "page %u %u\n"
--- 422,428 ----
                         (unsigned long long) jiffies_64_to_clock_t(user),
                         (unsigned long long) jiffies_64_to_clock_t(nice),
                         (unsigned long long) jiffies_64_to_clock_t(system),
+                        (unsigned long long) jif - jiffies_64_to_clock_t(user 
+
 nice + system));
         }
         proc_sprintf(page, &off, &len,
                 "page %u %u\n"
*************** fs/proc/proc_misc.c
*** 460,466 ****
                 }
         }
-        do_div(jif, HZ);
         proc_sprintf(page, &off, &len,
                 "\nctxt %lu\n"
                 "btime %lu\n"
--- 460,466 ----
                 }
         }
+        do_div(jif, USER_HZ);
         proc_sprintf(page, &off, &len,
                 "\nctxt %lu\n"
                 "btime %lu\n"
> Sorry,
> Tim
>
>
> --- linux-2.4.23-ck1/fs/proc/proc_misc.c	2003-12-04 14:15:59.000000000
> +0100 +++ linux-2.4.23-ck1-fix/fs/proc/proc_misc.c	2003-12-04
> 14:20:07.000000000 +0100 @@ -422,7 +422,7 @@
>  			(unsigned long long) jiffies_64_to_clock_t(user),
>  			(unsigned long long) jiffies_64_to_clock_t(nice),
>  			(unsigned long long) jiffies_64_to_clock_t(system),
> -			(unsigned long long) jiffies_64_to_clock_t(jif - user - nice -
> system)); +			(unsigned long long) jif - jiffies_64_to_clock_t(user + nice
> + system)); }
>  	proc_sprintf(page, &off, &len,
>  		"page %u %u\n"
> @@ -460,7 +460,7 @@
>  		}
>  	}
>
> -	do_div(jif, HZ);
> +	do_div(jif, USER_HZ);
>  	proc_sprintf(page, &off, &len,
>  		"\nctxt %lu\n"
>  		"btime %lu\n"
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/