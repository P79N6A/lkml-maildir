Date: Thu, 12 Oct 2000 23:28:12 -0700
From: Greg KH <>
Subject: [PATCH] USB wacom driver fix for test10-pre2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/10/13/67

On Thu, Oct 12, 2000 at 08:06:46AM -0400, tytso@mit.edu wrote:
> 
>      * USB: fix setting urb->dev in plusb, wacom, mdc800) (Greg KH)
>        {CRITICAL}
Attached is a patch against 2.4.0-test10-pre2 for the wacom.c driver to
fix this problem.
Could anyone who has this device, verify that this patch works properly
and enables the device to work again?
thanks,
greg k-h
-- 
greg@(kroah|wirex).com
diff -Naur -X dontdiff linux-2.4.0-test10-pre2/drivers/usb/wacom.c linux-2.4.0-test10-pre2-greg/drivers/usb/wacom.c
--- linux-2.4.0-test10-pre2/drivers/usb/wacom.c	Thu Jul 27 18:36:54 2000
+++ linux-2.4.0-test10-pre2-greg/drivers/usb/wacom.c	Fri Oct 13 00:17:18 2000
@@ -117,6 +117,7 @@
 struct wacom {
 	signed char data[10];
 	struct input_dev dev;
+	struct usb_device *usbdev;
 	struct urb irq;
 	struct wacom_features *features;
 	int tool;
@@ -239,6 +240,7 @@
 	if (wacom->open++)
 		return 0;
 
+	wacom->irq.dev = wacom->usbdev;
 	if (usb_submit_urb(&wacom->irq))
 		return -EIO;
 
@@ -293,6 +295,7 @@
 	wacom->dev.idvendor = dev->descriptor.idVendor;
 	wacom->dev.idproduct = dev->descriptor.idProduct;
 	wacom->dev.idversion = dev->descriptor.bcdDevice;
+	wacom->usbdev = dev;
 
 	FILL_INT_URB(&wacom->irq, dev, usb_rcvintpipe(dev, endpoint->bEndpointAddress),
 		     wacom->data, wacom->features->pktlen, wacom->features->irq, wacom, endpoint->bInterval);[unhandled content-type:application/pgp-signature]