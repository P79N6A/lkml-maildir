Date: Thu, 26 Sep 2002 00:57:27 +0100
From: Richard Drummond <>
Subject: Kernel and Open Firmware problems with my G3 upgrade card
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/9/25/214

Hi 
Not sure whether this is the right place to ask these question, but I've been 
searching for some answers for a while, and - because part of the problem is 
kernel-related - I'm gonna ask here anyway.
I upgraded my Old Word Mac recently (a Starmax Tanzania-based machine) with a 
Met@box G3 card. This is the type of expansion that plugs into the cache RAM 
socket. It seems to be stable under Linux, but there are a few nagging 
problems.
1. The machine will no longer boot with Quik. It fails with one of those nasty 
DEFAULT CLAIM messages,  and the usual OF hack to wait for disk spin-up makes 
no difference. To use Linux, I now have to boot MacOS and start Linux via 
BootX - which is a pain.
2. The Kernel doesn't recognize this G3 processor properly. It claims the 
clock speed is 80MHz, when actually it's 260MHz; and it claims that the L2 
cache's size is 256K, when actually it is 512K. (Output from /proc/cpuinfo on 
kernel 2.4.19 attached.)
I suspect these problems are related and are due to the fact that the version 
of Open Firmware in this machine was never designed to handle a G3 processor 
and so the L2 cache doesn't get set up properly. Interestingly, OF reports 
the CPU as a PowerPC,608 and there's no L2CR property present at all. I'm 
guessing the Quik booting problem is due to the improperly set-up cache 
interfering with disk access. The reason Linux boots from MacOS is that the 
MacOS extension for this card sets up the L2 cache correctly, and so lets 
BootX load the kernel. 
My questions are:
Is there some way to set the L2CR from OF - bearing in mind there's no l2cr 
property in OF's CPU node? (BTW, the cache control utility under MacOS, whose 
name escapes me, reports the L2CR's contents as 0xA910000.)
Would be it feasible to modify the kernel to properly recognize the processor 
on this card? (I suppose setting up the L2CR properly would at least get it 
to report the cache size correctly. But what about the clock speed?)
Any suggestions, anybody?
Cheers,
Rich
cpu		: 740/750
temperature 	: 15-17 C (uncalibrated)
clock		: 80MHz
revision	: 2.2 (pvr 0008 0202)
bogomips	: 519.37
machine		: Power Macintosh
motherboard	: AAPL,e826 MacRISC
detected as	: 47 (Unknown OHare-based)
pmac flags	: 00000000
L2 cache	: 256K unified
memory		: 144MB
pmac-generation	: OldWorld