Date: Thu, 06 Dec 2001 10:45:16 +0100
From: Heinz-Ado Arnolds <>
Subject: Re: 2.4.16: running *really* short on DMA buffers
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/12/6/79

GÃ©rard Roudier wrote:
> 
> On Wed, 5 Dec 2001, Heinz-Ado Arnolds wrote:
> 
> > Hi all,
> >
> > I get the message "kernel: Warning - running *really* short on DMA
> > buffers" frequently with medium to heavy disk i/o (running several
> > tar and/or moving huge directories).
...
> So, they are the allocations internal to the scsi layer that may well
> exhaust the ISA DMA pool. This pool is divided into 512 bytes chunks.
> Under heavy reordering of IOs, it can get very fragmented and much memory
> being wasted as a result.
> 
> An immediate solution might be to hack the scsi code for it to allocate
> more memory.
I'm not an experienced kernel hacker. Please help me: would it be right
to increase the constant 2 in
   new_dma_sectors = 2 * SECTORS_PER_PAGE;
                     ^
in drivers/scsi/scsi_dma.c, scsi_resize_dma_pool() to 3 or 4 as a first
solution. Or is there an other place I should start?
> The error string in well known since years, so you shouldn't have missed
> it from sources. :-)
Sorry, my stupid fault. For sure, it's in drivers/scsi/scsi_merge.c.
Thanks for your attention
Ado
-- 
------------------------------------------------------------------------
  Heinz-Ado Arnolds                        Ado.Arnolds@web-systems.net
  Websystems GmbH                              +49 2234 1840-0 (voice)
  Max-Planck-Strasse 2, 50858 Koeln, Germany   +49 2234 1840-40  (fax)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/