Date: Tue, 13 Jan 2009 01:31:47 +0100
From: Ingo Molnar <>
Subject: Re: [patch] x86: fix PTE corruption issue while mapping RAM using /dev/mem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/12/608

* pageexec@freemail.hu <pageexec@freemail.hu> wrote:
> On 13 Jan 2009 at 0:51, Ingo Molnar wrote:
> 
> > applied to tip/x86/urgent, thanks Suresh!
> > 
> > note that the patch caused some conflicts (there were other changes in 
> > pat.c) - i merged it up manually but could you please check the final 
> > commit in tip/master whether it's all OK?
> 
> i don't think that it got applied properly:
> 
> diff --git a/arch/x86/mm/pat.c b/arch/x86/mm/pat.c
> index 85cbd3c..ea36ed7 100644
> --- a/arch/x86/mm/pat.c
> +++ b/arch/x86/mm/pat.c
> @@ -347,9 +347,6 @@ int reserve_memtype(u64 start, u64 end, unsigned long req_type,
>         new->end        = end;
>         new->type       = actual_type;
> 
> -       if (new_type)
> -               *new_type = actual_type;
> -
>         spin_lock(&memtype_lock);
> 
>         if (cached_entry && start >= cached_start)
> @@ -437,6 +434,9 @@ int free_memtype(u64 start, u64 end)
>         if (is_ISA_range(start, end - 1))
>                 return 0;
> 
> +       if (new_type)
> +               *new_type = actual_type;
> +
>         is_range_ram = pagerange_is_ram(start, end);
>         if (is_range_ram == 1)
>                 return free_ram_pages_type(start, end);
> 
> free_memtype doesn't even have a new_type argument for starters ;), 
> patch must have applied it at the wrong place...
yeah, and Mr. Compiler agrees:
arch/x86/mm/pat.c: In function 'free_memtype':
arch/x86/mm/pat.c:437: error: 'new_type' undeclared (first use in this function)
arch/x86/mm/pat.c:437: error: (Each undeclared identifier is reported only once
arch/x86/mm/pat.c:437: error: for each function it appears in.)
arch/x86/mm/pat.c:438: error: 'actual_type' undeclared (first use in this function)
Suresh, could you please resend against tip/master? Thanks,
	Ingo