Date: Sun, 22 Jan 2006 13:31:28 -0500
From: Theodore Ts'o <>
Subject: Re: [Ext2-devel] [PATCH] ext3: Extends blocksize up to pagesize
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/22/131

On Fri, Jan 20, 2006 at 11:10:16PM -0800, Andrew Morton wrote:
> Andreas Dilger <adilger@clusterfs.com> wrote:
> > Just for others' info - the fill_super change has been tested in the past
> > by Sonny Rao at IBM also.  e2fsprogs has supported this for a long time
> > already.
> 
> I have a vague memory that there's some piece of metadata (per-block-group
> info, I think) which will overflow at 8kb blocksize.  I say this in the
> hope that you'll remmeber what it was ;)
The limiting factor is bg_free_blocks_count (and to some extent,
possibly bg_free_inodes_dir), which is a 16 bit field.  At 8kb, the
default block group size is 8kb * 8 bits/byte == 65536.  At 16kb, a
block group size of 131072 would overflow bg_free_blocks_count.  You
could of course artificially limit the block group size to 65536 for
block sizes > 16kb.  The better thing to do would be to use the extra
space in the per-block group metadata to extend those fields to 32
bits.
						- Ted
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/