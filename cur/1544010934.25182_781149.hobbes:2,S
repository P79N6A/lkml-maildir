Date: Tue, 16 Dec 2008 10:42:08 -0800
From: Jesse Barnes <>
Subject: Re: [PATCH] ibmphp: Fix module ref count underflow
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/16/286

On Wednesday, December 10, 2008 11:43 am Neil Horman wrote:
> Hey-
> 	I happened to notice that the ibmphp hotplug driver does something
> rather silly in its init routine.  It purposely calls module_put so as to
> underflow its module ref count to avoid being removed from the kernel. 
> This is bad practice, and wrong, since it provides a window for subsequent
> module_gets to reset the refcount to zero, allowing an unload to race in
> and cause all sorts of mysterious panics.  If the module is unsafe to load,
> it should inform the kernel as such with a call to __unsafe.  The patch
> below does that.
Thanks Neil, applied this to my for-linus branch since it sounds potentially 
serious (but also low risk since who uses ibmphp anymore? :)
Jesse