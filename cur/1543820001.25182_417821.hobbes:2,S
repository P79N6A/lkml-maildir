Date: Sat, 22 Apr 2006 04:31:05 +0900
From: OGAWA Hirofumi <>
Subject: Re: [PATCH] X86_NUMAQ build fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/21/282

Dave Hansen <haveblue@us.ibm.com> writes:
> On Sat, 2006-04-22 at 03:50 +0900, OGAWA Hirofumi wrote:
>> Dave Hansen <haveblue@us.ibm.com> writes:
>
> Ahh, so NUMAQ and VISWS don't seem to allow or want ACPI code.
> Especially for the NUMAQ, I don't think we should even mess with this
> too much.  Just fix it in the build system and directly disallow NUMAQ
> && ACPI. 
>
> We already have this:
>
> menu "ACPI (Advanced Configuration and Power Interface) Support"
>         depends on !X86_VISWS
>
> Just add the NUMAQ in there, too.
Oh, thanks a lot for noticeing this. Fixed patch is here.
[compile test only. I don't have NUMAQ, and I just wanted to see
"objdump -S" of NUMA's code.]
-- 
OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>
Signed-off-by: OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>
---
 arch/i386/boot/compressed/misc.c |    4 +++-
 arch/i386/kernel/smpboot.c       |    2 +-
 drivers/acpi/Kconfig             |    1 +
 3 files changed, 5 insertions(+), 2 deletions(-)
diff -puN arch/i386/pci/Makefile~numaq-build-fix arch/i386/pci/Makefile
diff -puN arch/i386/boot/compressed/misc.c~numaq-build-fix arch/i386/boot/compressed/misc.c
--- linux-2.6/arch/i386/boot/compressed/misc.c~numaq-build-fix	2006-04-22 04:15:04.000000000 +0900
+++ linux-2.6-hirofumi/arch/i386/boot/compressed/misc.c	2006-04-22 04:15:04.000000000 +0900
@@ -122,7 +122,9 @@ static int vidport;
 static int lines, cols;
 
 #ifdef CONFIG_X86_NUMAQ
-static void * xquad_portio = NULL;
+/* hack to avoid using xquad_portio=NULL */
+#undef outb_p
+#define outb_p		outb_local_p
 #endif
 
 #include "../../../../lib/inflate.c"
diff -puN arch/i386/kernel/smpboot.c~numaq-build-fix arch/i386/kernel/smpboot.c
--- linux-2.6/arch/i386/kernel/smpboot.c~numaq-build-fix	2006-04-22 04:15:04.000000000 +0900
+++ linux-2.6-hirofumi/arch/i386/kernel/smpboot.c	2006-04-22 04:15:04.000000000 +0900
@@ -1116,9 +1116,9 @@ static void smp_tune_scheduling (void)
  */
 
 static int boot_cpu_logical_apicid;
+#ifdef CONFIG_X86_NUMAQ
 /* Where the IO area was mapped on multiquad, always 0 otherwise */
 void *xquad_portio;
-#ifdef CONFIG_X86_NUMAQ
 EXPORT_SYMBOL(xquad_portio);
 #endif
 
diff -puN drivers/acpi/Kconfig~numaq-build-fix drivers/acpi/Kconfig
--- linux-2.6/drivers/acpi/Kconfig~numaq-build-fix	2006-04-22 04:16:35.000000000 +0900
+++ linux-2.6-hirofumi/drivers/acpi/Kconfig	2006-04-22 04:16:41.000000000 +0900
@@ -4,6 +4,7 @@
 
 menu "ACPI (Advanced Configuration and Power Interface) Support"
 	depends on !X86_VISWS
+	depends on !X86_NUMAQ
 	depends on !IA64_HP_SIM
 	depends on IA64 || X86
 
_
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/