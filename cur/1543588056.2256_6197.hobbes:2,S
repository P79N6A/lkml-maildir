Date: Wed, 18 Apr 2001 08:04:35 -0400
From:  kambo@home ...
Subject: CONFIG_PACKET_MMAP help
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/4/18/178

Hi,
I upgrading an application to the CONFIG_PACKET_MMAP
interface, and was trying to figure out how the api works.  I 'RTFS'
But had a few questions:
1. for tp_frame_size, I dont want to truncate any data on ethernet, I
need 1514 bytes, is this the best way to do it and not waste space?
static const int  TURBO_FRAME_SIZE=TPACKET_ALIGN(TPACKET_ALIGN(sizeof(tpacket_hdr))+TPACKET_ALIGN(sizeof(struct sockaddr_ll)+ETH_HLEN) + 1500);
2. what is tp_block_nr for?  I dont understand it, I just set it to 1
and make tp_block_size big enough for all the frames I need, so its
just one contiguous space, all I need is about a megabyte I think.
3. is this the general approach for the api?
open socket
set ring size
mmap()
h starts at frame[0] of the mmaped area
while(1) {
   if (tp->status == 0) poll() for pollin on the socket  /* is there a
   race here? */
   parse/copy out what I want from h + h->tp_mac
   set tp->status to 0 when I am done
   h = next packet in ring, or wraps
}
4. what does the copy threshold setsockopt tuning accomplish? doesnt it always
have to copy anyway, to the mmaped area?
Thanks,
c.c. me por favor...
K. Lohan
------------------------
kambo at home dawt com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/