Date: Wed, 21 Jul 2004 21:27:27 +0200
From: 	sam@ravnborg ...
Subject: Re: module name is KBUILD_MODNAME
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/7/21/64

On Wed, Jul 21, 2004 at 10:05:33AM +0200, Idan Spektor wrote:
> Here is the makefile I am using to create the .ko
> object. Please notice that I compile my objects
> by myself in a different makefile and only then
> use the kbuild infrastructure.
This may be a source of many problem in the future.
I advise you to use kbuild.
Try sending me ls -R in a clean tree,
your current Makefile or eventueally the src.
Then I will try to guide you.
> makefile:
> 
> ifeq ($(KERNELRELEASE),)
> 
> PWD		:= /home/idan/my_module
> KDIR	:= /usr/src/linux-$(shell uname -r)/
> 
> default:
> 	$(MAKE) -C $(KDIR) SUBDIRS=$(PWD) modules
> 
> else
> 
> obj-m	:= my_module.o
> my_module-objs := my_module_main.o
> 
> $(PWD)/my_module_main.o:
> 	echo do nothing
> 
> endif
The above should not result in the error you describe.
KBUILD_MODNAME is defined to the name of the module
when compiling my_module.mod.c.
Take a look at the output when you use the V=1 option when running make.
If you do not see something like:
$> make -C ~/bk/mars O=~/o M=$PWD V=1
...
	  gcc -Wp,-MD,/home/sam/bk/external/sam/.sam.o.d -nostdinc -iwithprefix include -D__KERNEL__ -Iinclude -Iinclude2 -I/home/sam/bk/mars/include  -I/home/sam/bk/external/sam -Wall -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -pipe -msoft-float -mpreferred-stack-boundary=2 -march=pentium3 -I/home/sam/bk/mars/include/asm-i386/mach-default -Iinclude/asm-i386/mach-default -O2 -fomit-frame-pointer -Wdeclaration-after-statement -I/home/sam/bk/mars/ -I /home/sam/bk/external/sam/include -DMODULE -DKBUILD_BASENAME=sam -DKBUILD_MODNAME=sammy -c -o /home/sam/bk/external/sam/sam.o /home/sam/bk/external/sam/sam.c
...
[file is named sam.o, module is named sammy]
Then there is something wrong. You should see -DKBUILD_MODNAME=my_module
	Sam
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/