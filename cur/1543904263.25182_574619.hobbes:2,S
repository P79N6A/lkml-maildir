Date: Wed, 25 Jul 2007 09:58:08 +0200
From: Cornelia Huck <>
Subject: Re: sysfs/udev broken in 2.6.23-rc1 [input, i2c, ...] (Was: sysfs/udev broken in latest git?)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/25/83

On Wed, 25 Jul 2007 02:19:18 +0200,
"Kay Sievers" <kay.sievers@vrfy.org> wrote:
> > >> Removing the dev->parent->bus check fixes it:
> 
> Yes, let's remove the check, I will check now if we possibly need to
> fix more than this or only the block-device patch.
It seems this is the only place we check for dev->parent->bus in the
current git tree.
Patch below.
driver core: revert "device" link creation check
Commit 2ee97caf0a6602f749ddbfdb1449e383e1212707 introduced an extra
check on when to create the "device" symlink. Unfortunately, this
breaks input, so let's revert to the old behaviour.
Signed-off-by: Cornelia Huck <cornelia.huck@de.ibm.com>
---
 drivers/base/core.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)
--- linux-2.6.orig/drivers/base/core.c
+++ linux-2.6/drivers/base/core.c
@@ -680,8 +680,7 @@ static int device_add_class_symlinks(str
 		if (error)
 			goto out_subsys;
 	}
-	/* only bus-device parents get a "device"-link */
-	if (dev->parent && dev->parent->bus) {
+	if (dev->parent) {
 		error = sysfs_create_link(&dev->kobj, &dev->parent->kobj,
 					  "device");
 		if (error)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/