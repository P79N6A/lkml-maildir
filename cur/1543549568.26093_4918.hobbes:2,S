Date: Sat, 23 Sep 2000 00:58:11 -0400
From: Bennett Feitell <>
Subject: Oops: kernel BUG at ll_rw_blk.c:711! despite patch.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/23/71

Here is the ksymoops decode.  This Oops occurs fairly often even after
applying the patch (appended here following the oops), before the patch the
file system was generally extremely slow.  The patch was posted by David S.
Miller as a fix for a known bug and may be found at:
http://x58.deja.com/=dnc/
[ST_rn=ps]/getdoc.xp?AN=669208918&threaded=1&CONTEXT=969683703.1203175464&hitnum=11
The patch seems to take care of Netscape falling into a Zombie state with
the system unable to shutdown, CTRL-ALT-SYSRQ-S and then CTRL-ALT-SYSRQ-U
fails to save the file system from an fsck on forcible reboot when in this
state.
The system is a K6-2+/FIC va503+/128MB Which was completely stable under
2.4.0-test7.
I hope this helps someone, if more info is needed please ask.  I have pre
patch oopses of this nature floating in my logs.
Regards,
Bennett Feitell
--START Of Oops--
[root@bfeitell log]# ksymoops -m /boot/System.map-2.4.0-test8 latest.oops
ksymoops 0.7c on i586 2.4.0-test8.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.4.0-test8/ (default)
     -m /boot/System.map-2.4.0-test8 (specified)
Sep 23 00:07:14 bfeitell kernel: invalid operand: 0000
Sep 23 00:07:14 bfeitell kernel: CPU:    0
Sep 23 00:07:14 bfeitell kernel: EIP:    0010:[__make_request+178/1556]
Sep 23 00:07:14 bfeitell kernel: EFLAGS: 00010296
Sep 23 00:07:14 bfeitell kernel: eax: 0000001f   ebx: c291a5c0   ecx:
c6332820   edx: 00000002
Sep 23 00:07:14 bfeitell kernel: esi: c291a5c0   edi: 00000000   ebp:
c02e5a00   esp: c4e13e94
Sep 23 00:07:14 bfeitell kernel: ds: 0018   es: 0018   ss: 0018
Sep 23 00:07:14 bfeitell kernel: Process netscape (pid: 694,
stackpage=c4e13000)
Sep 23 00:07:14 bfeitell kernel: Stack: c0240685 c0240922 000002c7 c291a5c0
00000002 0000000c 0000000
0 000000c0
Sep 23 00:07:14 bfeitell kernel:        00000002 c02e5a10 001e8480 c02e5a18
c02e5a10 00000000 0000000
2 00000000
Sep 23 00:07:14 bfeitell kernel:        00000000 c0187824 000000fe c018841d
c02e5a00 00000001 c291a5c
datasync+73/120]
Sep 23 00:07:14 bfeitell kernel: Code: 0f 0b 83 c4 0c 90 66 8b 5e 14 0f b6
46 15 8b 14 85 80 a0 2d
Using defaults from ksymoops -t elf32-i386 -a i386
 
Code;  00000000 Before first symbol
00000000 <_EIP>:
Code;  00000000 Before first symbol
   0:   0f 0b                     ud2a
Code;  00000002 Before first symbol
   2:   83 c4 0c                  add    $0xc,%esp
Code;  00000005 Before first symbol
   5:   90                        nop
Code;  00000006 Before first symbol
   6:   66 8b 5e 14               mov    0x14(%esi),%bx
Code;  0000000a Before first symbol
   a:   0f b6 46 15               movzbl 0x15(%esi),%eax
Code;  0000000e Before first symbol
   e:   8b 14 85 80 a0 2d 00      mov    0x2da080(,%eax,4),%edx
--END of Oops--
--Start of Patch--
--- vanilla/linux/fs/buffer.c   Wed Sep  6 08:29:45 2000
+++ linux/fs/buffer.c   Sun Sep 10 17:25:26 2000
@@ -1758,13 +1758,13 @@
                pos += blocksize;
        }
 
+       err = 0;
+       if (!buffer_mapped(bh)) {
+               get_block(inode, iblock, bh, 0);
+               if (!buffer_mapped(bh))
+                       goto unlock;
+       }
        if (!buffer_uptodate(bh)) {
-               err = 0;
-               if (!buffer_mapped(bh)) {
-                       get_block(inode, iblock, bh, 0);
-                       if (!buffer_mapped(bh))
-                               goto unlock;
-               }
                err = -EIO;
                bh->b_end_io = end_buffer_io_sync;
                ll_rw_block(READ, 1, &bh);
--End of Patch--
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/