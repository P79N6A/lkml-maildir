Date: Sun, 21 Sep 2003 15:05:08 +0200
From: Stephan Maciej <>
Subject: Re: 2.4.2[12] v VIA Rhine and VIA82x audio (working with a fight)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/21/38

On Sunday 21 September 2003 00:14, Alan Cox wrote:
> On Sad, 2003-09-20 at 21:09, Jamie Lokier wrote:
> > On a 2.5.75 kernel, I don't hear anything from the analogue input.
>
> CMPCI in everything pre 2.4.22pre10-ac or so is obsolete and has all
> sorts of problems with the later chips. C Tien of Cmedia sent a lot of
> updates to the driver that were merged at that point.  
Are these in 2.4.23-pre4?
> I'd be interested 
> to know if you still have problems wiht that
If yes, there are problems with the updates. Sound randomly locks my machine 
up, without any oops message and not even blinking keyboard lights. Only a 
hard reset helps.
I have suspected this as being the reason for the lockups:
static ssize_t cm_read(struct file *file, char *buffer, size_t count, loff_t 
*ppos)
{
	[...]
	DECLARE_WAITQUEUE(wait, current);
	[...]
        add_wait_queue(&s->dma_adc.wait, &wait);
	while (count > 0) {
		[...]
		if (cnt <= 0) {
			start_adc(s);
			if (file->f_flags & O_NONBLOCK)
				return ret ? ret : -EAGAIN;
Shouldn't we do a remove_wait_queue before the return()?
There are many more places to fix if that's a bug. I am willing to provide a 
patch if anyone tells me if I am right with the assumption above.
Stephan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/