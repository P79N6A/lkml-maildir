Date: Mon, 18 Jan 1999 20:20:45 +0100
From: Henner Eisen <>
Subject: 2.2-pre: partial isdn upgrade patch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/19/17

Hi,
As I understand, a monolithic patch to upgrade the current isdn
subsystem to the isdn4linux CVS version is currently not acceptable,
because such a patch would be too huge and very difficult to review.
Therefore, I've started splitting the isdn upgrade patch into
different parts. This is the first one, consisting of extracted bug fixes.
Test status: The changes contained in this patch have all been included in
the CVS tree and thus were tested by several users. This
particular patch has also been verified to apply, compile, and work
cleanly with 2.2-pre7. I tested with ippp, ttyI/X.75 and X.25. Please
test, in particular if you can set up other protocol combinations.
Description:
The patch includes several bug fixes to the isdn link level which have
been accumulated in the isdn4linux CVS repository after the last merge
with the official kernel. New features are not included.
- added remark about outdated isdn subsystem to Configure.help
  (requested in Alan's showstopper list)
- fixed return types caused by failed copy_to/from_user to -EFAULT
- some minor fixes (added missing restore_flags, mark_bh)
- the (layer-violating) icmp_send in
  isdn_net.c::isdn_net_unreachable() has been replaced by a 
  dst_link_failure(). This results in the same action in response to
  (non-icmp) ip packets but does not generate bogus icmp messages in
  response to non-ip or icmp packets.
- fixed several user space access with interrupts off. 
  This also involves the following:
  - Operations which access or manipulate the linked lists of isdn
    network interfaces and phone number storage from process context
    (and which might sleep while walking through the lists) are now
    serialized by means of a semaphore instead of blocking irq.
  - some functions subject to this bug are just removed because they
    only where called on behalf of undocumented and unused ioctl's.
  
Maybe, the patch is readable and short enough to qualify for
immediate integration in the official kernel. As the fixes are
scattered over the whole kernel tree, applying it will also improve
readability of future patches which add the new features.
As this patch does not add any new features nor does it affect the user
interface, isdn4k-utils compiled against stock 2.2-pre-X kernel should
work without problems.
Henner
begin 644 isdn-2.2-partial-1.patch.gz
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
?(QA`;JM5@,T8@_OUL/D.J!BX?K3F`@"(<D@JQE<`````
`
end
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/