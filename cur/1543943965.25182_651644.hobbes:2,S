Date: Mon, 11 Feb 2008 10:37:33 -0500
From: Steven Rostedt <>
Subject: Re: preempt rcu bug on s390
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/11/212

Heiko Carstens wrote:
>> Does s390 start out in nohz mode?  The reason I ask is that it feels like
>> an off-by-one error for the dynticks_progress_counter.
> 
> Actually I forgot to add a few ifdefs to make the code do something :)
> That just reveals that we have a conflict with the dynticks implementation
> and s390's nohz that shows up in what rcu_irq_enter/exit assume.
> I didn't patch s390 and common code so it will work, but I think the
> patch you mentionened will fix the problem I reported.
> So I guess we should either convert s390 to use the generic dynticks
> implementation or disable preemptible rcu on s390 until we converted
> our code.
> 
> Thanks for helping debugging this!
Heiko, thanks for reporting this.
This patch still didn't make it into -rc1, and it really should. Because 
without this patch, PREEMPT_RCU and NO_HZ together is broken, on all boxes.
The patch is in Ingo's sched-devel git tree, as 
9460545f81ea48b07dbb20456a8ede776d8ebc1b (last I checked) and titled:
     rcu: add support for dynamic ticks and preempt rcu
-- Steve