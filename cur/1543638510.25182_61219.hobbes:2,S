Date: Sat, 03 Aug 2002 01:15:15 -0400
From: Milosz Tanski <>
Subject: Fix: DEVFS compile failuer [2.5.30]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/8/3/32

There is a compile time error in Linux 2.5.30 in fs/partitions/check.c,
in function devfs_register_partitions. The line 470 contains an error,
dev->part[p].de = NULL; p is a pointer to a structure (hd_stuct). I
searched around 2.4.18, and it is  dev->part[part + minor].de = NULL; I
tried changing that line, and I investigated, now it compiles and works.
A patch is attached, thx.
--- fs/partitions/check.c.orig	2002-08-01 17:16:19.000000000 -0400
+++ fs/partitions/check.c	2002-08-03 00:51:49.000000000 -0400
@@ -467,7 +467,7 @@
 	for (part = 1; part < max_p; part++) {
 		if ( unregister || (p[part].nr_sects < 1) ) {
 			devfs_unregister(p[part].de);
-			dev->part[p].de = NULL;
+			dev->part[part + minor].de = NULL;
 			continue;
 		}
 		devfs_register_partition (dev, minor, part);