Date: Wed, 19 Mar 2008 19:40:52 +0100
From: matthieu castet <>
Subject: Re: [PATCH]  mass storage : emulation of sat scsi_pass_thru with ATACB
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/19/71

Matthew Dharm wrote:
> Matt --
> 
> I just noticed that it's been about a week since I sent this...
> 
> Any progress?
Sorry I was a bit busy.
Matt
> 
> On Thu, Mar 13, 2008 at 05:51:39PM -0700, Matthew Dharm wrote:
>> On Thu, Mar 13, 2008 at 10:22:09PM +0100, matthieu castet wrote:
>>> Matthew Dharm wrote:
>>>> On Sun, Mar 09, 2008 at 10:42:50PM +0100, matthieu castet wrote:
>>>>> Hi
>>>>>
>>>>> here an update version of the patch
>>>> We're getting very close here.
>>> +		unsigned char sk, asc, ascq;
>>> +		sk = RECOVERED_ERROR;
>>> +		asc = 0; /* ATA PASS THROUGH INFORMATION AVAILABLE */
>>> +		ascq = 0x1D;
>>> +		/* XXX we should generate sk, asc, ascq from status and error
>>> +		 * regs
>>> +		 * (see 11.1 Error translation ? ATA device error to SCSI error map)
>>> +		 * and ata_to_sense_error from libata.
>>> +		 */
>>> +		sb[1] = sk;
>>> +		sb[2] = asc;
>>> +		sb[3] = ascq;
>> I may have missed this in an earlier patch, but why to you declare and use
>> these 3 variables like this?  Seems odd and confusing to me....
I did that because in previous patch I was saving value from the first 
sense buffer if the first atacb command failed.
But after some test, I saw the returned values were always 0 and I 
always set the same value.
I think I can remove them now.
Patch with sk, asc, ascq removed attached.
Matthieu