Date: Mon, 1 Apr 2002 21:43:03 +0200 (CEST)
From: Patrick McHardy <>
Subject: bug in sch_generic.c:pfifo_fast_enqueue
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/4/1/85

Hi Alexey.
I found a small bug in pfifo_fast_enqueue, instead of
if (list->qlen <= skb->dev->tx_queue_len)
it should be
if (list->qlen <= qdisc->dev->tx_queue_len)
i guess. the attached patch fixes it.
Bye,
Patrick
diff -urN linux-2.4.18-clean/net/sched/sch_generic.c linux-2.4.18-sched_fixed/net/sched/sch_generic.c
--- linux-2.4.18-clean/net/sched/sch_generic.c	Fri Aug 18 19:26:25 2000
+++ linux-2.4.18-sched_fixed/net/sched/sch_generic.c	Sat Mar 30 11:45:56 2002
@@ -280,7 +280,7 @@
 	list = ((struct sk_buff_head*)qdisc->data) +
 		prio2band[skb->priority&TC_PRIO_MAX];
 
-	if (list->qlen <= skb->dev->tx_queue_len) {
+	if (list->qlen <= qdisc->dev->tx_queue_len) {
 		__skb_queue_tail(list, skb);
 		qdisc->q.qlen++;
 		return 0;