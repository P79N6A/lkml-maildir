Date: Tue, 2 Nov 2004 15:23:12 +0100
From: Anders Saaby <>
Subject: 2.6.9: NFS (+XFS) Problem - Clients getting Stale filehandles.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/11/2/107

Hi List,
I'm having a rather vierd(!) NFS (+XFS) Problem. We have a disk-backup server 
running an NFS server exporting an XFS filesystem to a number of clients 
which use it for nightly backups.
These clients get a stale filehandle on the NFS mount after ~10 mins of 
inactivity. Client and server are on the same LAN - no firewall.
- Here's the vierd thing: To get these mounts working again, I simply have to 
run a "ls /exported_dir" serverside. - then all NFS mounts work again (for 
~10 mins). This behavior is always reproducable. - I have absolutely no clue 
to what is causing this behavior.
Example:
- Serverside: /mnt/backup/ is exported
- Serverside: "mkdir /mnt/backup/server_name"
- Clientside: /mnt/backup/server_name is mounted.
- Wait for ~10 mins without activity on the mount.
- Clientside: "ls /mnt/backup/server_name" gives: "bash: cd: server_name: 
Stale NFS file" handle
- Serverside: "ls /mnt/backup/server_name"
- Clientside: "ls /mnt/backup/server_name" returns ok.
Any ideas anyone? - I will be happy to test and give more info!
System info:
Server kernel: Linux server_name 2.6.9 #1 SMP Thu Oct 21 01:13:17 CEST 2004 
i686 unknown
Client kernels are different 2.4 and 2.6 kernels.
Client kernel log: "nfs_statfs: statfs error = 116" is repeated.
Server kernel log has no NFS related entries.
Tcpdump between server and client:
client > server: 132 getattr [|nfs] (DF) (ttl 64, id 458, len 160)
server > client reply ok 28 getattr ERROR: Stale NFS file handle (DF) (ttl 64, 
id 17733, len 56)
client > server: 136 access [|nfs] (DF) (ttl 64, id 459, len 164)
server > client: reply ok 32 access ERROR: Stale NFS file handle attr: (DF) 
(ttl 64, id 17734, len 60
-- 
Med venlig hilsen - Best regards - Meilleures salutations
Anders Saaby
Systems Engineer
------------------------------------------------
Cohaesio A/S - Maglebjergvej 5D - DK-2800 Lyngby
Phone: +45 45 880 888 - Fax: +45 45 880 777
Mail: as@cohaesio.com - 
http://www.cohaesio.com
------------------------------------------------
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/