Date: 21 Mar 2005 23:04:28 -0500
From: Len Brown <>
Subject: Re: 2.6.12-rc1-mm1: Kernel BUG at pci:389
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/3/21/393

Will this do it for the moment?
If so, lets use it until Pavel's flag-day is over -- when we'll send an
updated patch.
thanks,
-Len
===== drivers/pci/pci-acpi.c 1.4 vs edited =====
--- 1.4/drivers/pci/pci-acpi.c	2005-03-03 04:28:23 -05:00
+++ edited/drivers/pci/pci-acpi.c	2005-03-21 22:59:39 -05:00
@@ -237,19 +237,8 @@
 
 static int acpi_pci_choose_state(struct pci_dev *pdev, pm_message_t state)
 {
-	char dstate_str[] = "_S0D";
-	acpi_status status;
-	unsigned long val;
-	struct device *dev = &pdev->dev;
+	/* TBD */
 
-	/* Fixme: the check is wrong after pm_message_t is a struct */
-	if ((state >= PM_SUSPEND_MAX) || !DEVICE_ACPI_HANDLE(dev))
-		return -EINVAL;
-	dstate_str[2] += state;	/* _S1D, _S2D, _S3D, _S4D */
-	status = acpi_evaluate_integer(DEVICE_ACPI_HANDLE(dev), dstate_str,
-		NULL, &val);
-	if (ACPI_SUCCESS(status))
-		return val;
 	return -ENODEV;
 }
 