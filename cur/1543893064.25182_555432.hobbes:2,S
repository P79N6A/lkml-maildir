Date: Sat, 9 Jun 2007 12:52:21 +0200
From: Jean Delvare <>
Subject: Re: [i2c] i2c module aliases
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/9/68

On Fri, 8 Jun 2007 16:48:45 +0200 (CEST), Geert Uytterhoeven wrote:
> On Fri, 8 Jun 2007, Jean Delvare wrote:
> > OK. Geert, care to submit a new patch removing struct i2c_device_id
> > altogether?
> 
> Sorry, probably not...
> 
> I just thought I found a grave bug while looking into adding zorro
> support to scripts/mod/file2alias.c, so that's why I reported it.
OK, no problem. I gave it a try myself. Greg, is it OK or did I miss
other parts which can be removed?
* * * * *
Subject: i2c: Kill struct i2c_device_id
I2C devices do not have any form of ID as PCI or USB devices have.
No driver uses "MODULE_DEVICE_TABLE(i2c, ...)" because it doesn't
make sense. So we can get rid of struct i2c_device_id and the
associated support code.
Signed-off-by: Jean Delvare <khali@linux-fr.org>
Cc: Greg KH <greg@kroah.com>
---
 include/linux/mod_devicetable.h |    5 -----
 scripts/mod/file2alias.c        |   11 -----------
 2 files changed, 16 deletions(-)
--- linux-2.6.22-rc4.orig/include/linux/mod_devicetable.h	2007-05-13 10:01:23.000000000 +0200
+++ linux-2.6.22-rc4/include/linux/mod_devicetable.h	2007-06-08 19:08:29.000000000 +0200
@@ -255,11 +255,6 @@ struct pcmcia_device_id {
 #define PCMCIA_DEV_ID_MATCH_FAKE_CIS	0x0200
 #define PCMCIA_DEV_ID_MATCH_ANONYMOUS	0x0400
 
-/* I2C */
-struct i2c_device_id {
-	__u16 id;
-};
-
 /* Input */
 #define INPUT_DEVICE_ID_EV_MAX		0x1f
 #define INPUT_DEVICE_ID_KEY_MIN_INTERESTING	0x71
--- linux-2.6.22-rc4.orig/scripts/mod/file2alias.c	2007-06-08 18:56:36.000000000 +0200
+++ linux-2.6.22-rc4/scripts/mod/file2alias.c	2007-06-08 19:14:18.000000000 +0200
@@ -388,13 +388,6 @@ static int do_vio_entry(const char *file
 	return 1;
 }
 
-static int do_i2c_entry(const char *filename, struct i2c_device_id *i2c, char *alias)
-{
-	strcpy(alias, "i2c:");
-	ADD(alias, "id", 1, i2c->id);
-	return 1;
-}
-
 #define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0]))
 
 static void do_input(char *alias,
@@ -571,10 +564,6 @@ void handle_moddevtable(struct module *m
 		do_table(symval, sym->st_size,
 			 sizeof(struct vio_device_id), "vio",
 			 do_vio_entry, mod);
-	else if (sym_is(symname, "__mod_i2c_device_table"))
-		do_table(symval, sym->st_size,
-			 sizeof(struct i2c_device_id), "i2c",
-			 do_i2c_entry, mod);
 	else if (sym_is(symname, "__mod_input_device_table"))
 		do_table(symval, sym->st_size,
 			 sizeof(struct input_device_id), "input",
-- 
Jean Delvare
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/