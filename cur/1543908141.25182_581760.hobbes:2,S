Date: Thu, 9 Aug 2007 13:56:14 -0700
From: Andrew Morton <>
Subject: Re: 2.6.23-rc2-mm1: silly df numbers on 32bit extN
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/9/454

On Thu, 9 Aug 2007 21:17:20 +0100 (BST)
Hugh Dickins <hugh@veritas.com> wrote:
> On Thu, 9 Aug 2007, Andrew Morton wrote:
> > 
> > +lib-make-percpu_counter_add-take-s64.patch
> 
> lib-make-percpu_counter_add-take-s64.patch looks sensible, but it doesn't
> actually work on 32-bit architectures: several users of percpu_counter_add
> are passing -unsignedlong as the amount, which is not promoted to s64 in
> the desired way, so "df" on extN filesystems is showing silly numbers.
> 
> The hack below (say long instead of s64 or s32) may be good as hotfix for
> 2.6.23-rc2-mm1, but is probably the worst of solutions.  Perhaps take-s64
> should be reverted, perhaps there should be a percpu_counter_sub and the
> filesystems use that instead of saying -unsignedlong, perhaps they should
> use a cast or a long or an s64.  I don't know, but here's this for now...
Thanks.  I think I'll quietly tip the whole patch series overboard and
shoot for a quick rc2-mm2 rather than trying to patch it up in-situ.
I haven't had a chance to review it all in recent months.  Vague first
impressions are that it all goes a bit rampant and changes more than it
needs to, but I'll take a closer look at that if Peter can provide us with
the next version (please).
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/