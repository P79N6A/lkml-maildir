Date: 13 Mar 2000 13:41:40 -0500
From:  nbecker@fred ...
Subject: 2.3 /proc/scsi changed broke RedHat startup?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/14/99

In RH6.1 /etc/rc.d/rc.sysinit:
# If a SCSI tape has been detected, load the st module unconditionally
# since many SCSI tapes don't deal well with st being loaded and unloaded
if [ -f /proc/scsi/scsi ] && grep -q 'Type:   Sequential-Access' /proc/scsi/scsi 2>/dev/null ; then
	if grep -qv ' 9 st' /proc/devices ; then
		if [ -n "$USEMODULES" ] ; then
			# Try to load the module.  If it fails, ignore it...
			insmod -p st >/dev/null 2>&1 && modprobe st >/dev/null 2>&1
This worked on 2.2 with aic7xxx as a scsi module.  It's not working
anymore with 2.3.51.  /proc/scsi/scsi doesn't exist until the aic7xxx
is loaded.
I *think* I've diagnosed this correctly (please don't beat me up if
I'm wrong).  I *think* that under 2.2 it was not necessary to load
aic7xxx first, but under 2.3.51 it is.  Otherwise, I can't find any
place where the startup scripts were loading the aic7xxx module.
So if my diagnosis is correct, anyone want to suggest a good fix?
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/