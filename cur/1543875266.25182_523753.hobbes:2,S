Date: Sun, 25 Mar 2007 01:07:09 -0800
From: Andrew Morton <>
Subject: Re: [PATCH] utsns: fix !CONFIG_UTS_NS behavior
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/25/41

On Fri, 23 Mar 2007 15:00:39 -0500 "Serge E. Hallyn" <serue@us.ibm.com> wrote:
> When CONFIG_UTS_NS=n, clone(CLONE_NEWUTS) quietly refuses.  So correctly does
> not unshare a new uts namespace, but also does not return -EINVAL.
> 
> Fix this to return -EINVAL so the caller knows his request was denied.
> 
> Signed-off-by: Serge E. Hallyn <serue@us.ibm.com>
> 
> ---
> 
>  include/linux/utsname.h |    2 ++
>  1 files changed, 2 insertions(+), 0 deletions(-)
> 
> bc350994ac67df8f1b917f9979c065d87757eabe
> diff --git a/include/linux/utsname.h b/include/linux/utsname.h
> index a4555fe..e10267d 100644
> --- a/include/linux/utsname.h
> +++ b/include/linux/utsname.h
> @@ -70,6 +70,8 @@ static inline int unshare_utsname(unsign
> 
>  static inline int copy_utsname(int flags, struct task_struct *tsk)
>  {
> +	if (flags & CLONE_NEWUTS)
> +		return -EINVAL;
>  	return 0;
>  }
>  static inline void put_uts_ns(struct uts_namespace *ns)
I'm assuming that this is 2.6.21 material.
Please review -mm's merge-sys_clone-sys_unshare-nsproxy-and-namespace.patch
- it probably needs to propagate this fix.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/