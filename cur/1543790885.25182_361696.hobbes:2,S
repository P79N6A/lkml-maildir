Date: Sun, 30 Oct 2005 23:39:40 -0500
From: Jeff Dike <>
Subject: [PATCH 7/10] UML - switch_mm fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/10/30/247

From: Ben Lahaise <bcrl@linux.intel.com>
Not quite, something along the lines of the patch below works correctly
(and makes aio performance not suffer from multiple second delays), as
skas0 mode correctly switches mm contexts, unlike TT (which should
probably get nuked from the kernel now that skas0 seems to be working).
                -ben
Signed-off-by: Benjamin LaHaise <bcrl@linux.intel.com>
Signed-off-by: Jeff Dike <jdike@addtoit.com>
Index: linux-2.6.13-mm1/include/asm-um/mmu_context.h
===================================================================
--- linux-2.6.13-mm1.orig/include/asm-um/mmu_context.h	2005-09-01 16:03:21.000000000 -0400
+++ linux-2.6.13-mm1/include/asm-um/mmu_context.h	2005-09-07 12:21:22.000000000 -0400
@@ -29,7 +29,8 @@
 	 * possible.
 	 */
 	if (old != new && (current->flags & PF_BORROWED_MM))
-		force_flush_all();
+		CHOOSE_MODE(force_flush_all(),
+			    switch_mm_skas(&new->context.skas.id));
 }
 
 static inline void switch_mm(struct mm_struct *prev, struct mm_struct *next, 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/