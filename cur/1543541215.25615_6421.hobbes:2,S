Date: Thu, 10 Aug 2000 00:28:47 +0200
From: "Andi Kleen" <>
Subject: Re: Definitions
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/9/191

On Wed, Aug 09, 2000 at 04:43:36PM -0400, Matthew Wilcox wrote:
> On Wed, Aug 09, 2000 at 08:28:40PM +0100, Adam Sampson wrote:
> > Please could you have another "accident" and add reiserfs, then?
> 
> as i understand it, reiserfs (just like all journalling filesystems)
> requires changes to the core kernel code which are unacceptable at
> this point.  but my understanding may be flawed.
In practice the memory pinning does not seem to be a problem with reiserfs.
Reiserfs currently always uses a 32MB log which limits the pinned memory
to 32MB per file system (all pinned buffers need to have log space
reserved). In addition it only logs metadata and you have to do a lot of 
work to quickly dirty 32MB or more of metadata. It is rather unlikely in
practice because you would need to deal with thousands of
files to create that much dirty metadata. In addition reiserfs was designed 
for compact metadata which helps here too (assuming the updates are clustered 
into near blocks)
I have seen journal related OOM with ext3 with a 60MB log on a 128MB machine.
ext3 does full data logging, which means it has much more pages pinned than
reiserfs under heavy IO. 
I have never seen it under reiserfs even under heavy load. As long
as number-of-reiserfs-mounted*32MB is significantly smaller than your
memory you are unlikely to hit the early OOM, even under extreme load.
[I'm not saying that it should not be fixed, just that it does not seem
to be a problem in practice]
-Andi
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/