Date: Tue, 12 Jun 2007 11:16:21 +0100
From: Alan Cox <>
Subject: Re: libata passthru: support PIO multi commands
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/12/108

> >> +		if (multi_count != dev->multi_count)
> >> +			ata_dev_printk(dev, KERN_WARNING,
> >> +				       "invalid multi_count %u ignored\n",
> >> +				       multi_count);
> >> +	}
> > 
> > What limits log spamming here ?
> 
> Intelligence of the user with privs?
Not ever SG_IO call requires priviledges. Not all priviledged users are
so perfect they never make a mistake.
> > Also shouldn't we error this
> > situation not proceed and hope that enough data was supplied not
> > to leave us stuck half way through a command having made a nasty
> > mess on disk ?
> 
> Is that English?  Can you be more specific and more clear?
Issue a multi count sized write. Acidentally collide with another program
which mucks up the multiwrite count (for once it probably won't be HAL
making a mess ;)) and send data. The state of the disk at the point a
short multiwrite terminates is undefined, it may have written some of the
sectors, it may have blanked them all (Optical media) etc. Far better
just to error the invalid command - especially as in some cases without
Mark's fixes for DRQ cleanup on error it may even hang in one direction.
Alan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/