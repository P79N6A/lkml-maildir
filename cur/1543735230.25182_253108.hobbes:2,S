Date: Thu, 16 Sep 2004 19:38:21 +0200
From: Andrea Arcangeli <>
Subject: Re: [PATCH] flexmmap: optimise mmap_base gap for hard limited stack
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/16/228

On Thu, Sep 16, 2004 at 06:56:13PM +0200, Utz Lehmann wrote:
> Hi
> 
> With the flexmmap memory layout there is at least a 128 MB gap between
> mmap_base and TASK_SIZE. I think this is for the case that a running process
> can expand it's stack soft rlimit.
> 
> If there is a hard limit for the stack this minium gap is just a waste of
> space. This patch reduce the gap to the hard limit + 1 MB hole. If a process
> has a 8192 KB hard limit it have additional 119 MB space available over the
> current behavior.
> 
> And the current implemention has a problem. If the stack soft limit is
> 128+ MB there is no hole between the stack and mmap_base. If there is a
> mapping at mmap_base stack overflows are not detected. The patch made a
> 1MB hole between them.
I developed a sysctl several years ago in all my 2.2 and 2.4 kernels
including all 2.2 and 2.4 SUSE kernels that major software vendors
requires for safety of their apps. IIRC I tried to merge it once but I
failed (got not applied to mainline). Now I'v just got another bugzilla
open about the lack of the sysctl and the major app is now again not
foolproof. A fixed number won't work, so I have to drop such a fixed GAP
anyways and rewrite it by forward porting my patch.
The sysctl in question is /proc/sys/vm/heap-stack-gap, so I recommend to
drop all those fixed GAP sizes and implement this instead:
	
http://www.us.kernel.org/pub/linux/kernel/people/andrea/kernels/v2.4/2.4.23aa3/00_silent-stack-overflow-20
If you reinvet the wheel and you prefer not to share the above code to
make a sysctl, at least make sure to use the name "heap-stack-gap" to
avoid any pointless incompatibility.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/