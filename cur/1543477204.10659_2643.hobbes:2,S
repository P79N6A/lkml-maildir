Date: Tue, 12 Jan 1999 11:58:06 -0600 (CST)
From: "Andre M. Hedrick" <>
Subject: Re: 2.2.0pre5/6 IDE disk geometry detection problem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/12/236

On Tue, 12 Jan 1999, Marko Siladin wrote:
> > 
> > 	From: marko@207-172-63-169.s169.tnt3.rcm.erols.com (Marko Siladin)
> > 
> > 	in 2.1.131 cat /proc/ide/hda/geometry results in:
> > 	physical     4092/16/63
> > 	logical      847/128/63
> > 
> > 	in 2.2.0 pre5/6 I get :
> > 	physical     4092/16/63
> > 	logical      511/128/63
> > 
> > 	the actual physical geometry of the disk is 6780/16/63 
> > 	so both kernels get that one wrng - but at least the 2.1.131
> > 	get the logical correctly (from the BIOS)
> > 
> > Hmm. Such things can happen. For example, I could imagine
> > that the BIOS has 847/128/63, CurCHS has 4092/16/63,
> > and RawCHS and LBAsects have certain suitable values
> > such that the end result is as you describe above.
> > Still I would be interested in the results of hdparm -i /dev/hda
> > and hdparm -I /dev/hda both for 2.1.131 and for 2.2.0 pre5/6.
> > 
> > Andries - aeb@cwi.nl
> > 
> 
> it looks like the results of te hdparm are the same. My guess is that
> 2.1.131 get the logical params from the BIOS and 2.2.0pre5/6 calculates
No, both kernels  read the BIOS values.  The question is, does your BIOS
support beyond the 2.1 GB old limits?  Since a CHS=4092/16/63 is exactly
2.1 GB drive which would call Large and not LBA translations.
What is the model of the onboard host-adapter?
By chance is there a disk-overlay flopping around on the drive?
Please send me a copy of the identify
cat /proc/ide/ide0/hda/identify > zaphod.hda
I am curious about the content.
> them from the physical ones. I'll try to set the geometry manually 
> tonight
> 
> 
> zaphod# cat /proc/version
> Linux version 2.1.131 (root@zaphod) (gcc version 2.7.2.3) #3 SMP Wed Dec 23 00:11:54 EST 1998
> 
> zaphod# hdparm -i /dev/hda
> 
> /dev/hda:
> 
>  Model=FUJITSU MPA3035ATU, FwRev=9517, SerialNo=01113969
>  Config={ HardSect NotMFM HdSw>15uSec Fixed DTR>10Mbs RotSpdTol>.5% }
>  RawCHS=4092/16/63, TrkSize=0, SectSize=0, ECCbytes=4
>  BuffType=0(?), BuffSize=0kB, MaxMultSect=32, MultSect=32
>  DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=0(slow)
>  CurCHS=4092/16/63, CurSects=4124736, LBA=yes, LBAsects=4124736
>  tDMA={min:120,rec:120}, DMA modes: mword0 mword1 *mword2 
>  IORDY=yes, tPIO={min:240,w/IORDY:120}, PIO modes: mode3 mode4 
> 
> zaphod# hdparm -I /dev/hda
> 
> /dev/hda:
> 
>  Model=UFIJST UPM3A30A5UT                      , FwRev=5971    , SerialNo=        
>  Config={ HardSect NotMFM HdSw>15uSec Fixed DTR>10Mbs RotSpdTol>.5% }
>  RawCHS=4092/16/63, TrkSize=0, SectSize=0, ECCbytes=4
>  BuffType=0(?), BuffSize=0kB, MaxMultSect=32, MultSect=32
>  DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=0(slow)
>  CurCHS=4092/16/63, CurSects=4124736, LBA=yes, LBAsects=4124736
>  tDMA={min:120,rec:120}, DMA modes: mword0 mword1 *mword2 
>  IORDY=yes, tPIO={min:240,w/IORDY:120}, PIO modes: mode3 mode4 
> 
> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
> 
> zaphod# cat /proc/version 
> Linux version 2.2.0-pre6 (root@zaphod) (gcc version 2.7.2.3) #9 SMP Sat Jan 9 23:41:54 EST 1999
> 
> zaphod#  hdparm -i /dev/hda         
> 
> /dev/hda:
> 
>  Model=FUJITSU MPA3035ATU, FwRev=9517, SerialNo=01113969
>  Config={ HardSect NotMFM HdSw>15uSec Fixed DTR>10Mbs RotSpdTol>.5% }
>  RawCHS=4092/16/63, TrkSize=0, SectSize=0, ECCbytes=4
>  BuffType=0(?), BuffSize=0kB, MaxMultSect=32, MultSect=off
>  DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=0(slow)
>  CurCHS=511/128/63, CurSects=4124736, LBA=yes, LBAsects=4124736
>  tDMA={min:120,rec:120}, DMA modes: mword0 mword1 *mword2 
>  IORDY=yes, tPIO={min:240,w/IORDY:120}, PIO modes: mode3 mode4 
> 
> zaphod#  hdparm -I /dev/hda
> 
> /dev/hda:
> 
>  Model=UFIJST UPM3A30A5UT                      , FwRev=5971    , SerialNo=        
>  Config={ HardSect NotMFM HdSw>15uSec Fixed DTR>10Mbs RotSpdTol>.5% }
>  RawCHS=4092/16/63, TrkSize=0, SectSize=0, ECCbytes=4
>  BuffType=0(?), BuffSize=0kB, MaxMultSect=32, MultSect=?0?
>  DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=0(slow)
>  CurCHS=4092/16/63, CurSects=4124736, LBA=yes, LBAsects=4124736
>  tDMA={min:120,rec:120}, DMA modes: mword0 mword1 *mword2 
>  IORDY=yes, tPIO={min:240,w/IORDY:120}, PIO modes: mode3 mode4 
> 
> 
> -- 
> ...Marko
> ------------------------///////////-\\\\\\\\\\\--------------------------
>                               (O) ^ ^ (O)    If you are going to reinvent
> Marko Siladin                    | | |  the wheel, don't make it a square
> msiladin@athos.mas.vcu.edu        \ /        - John Carmack,  id Software 
>            
http://athos.mas.vcu.edu/grad/marko/home.html
> ------------------------\\\\\\\\\\\-///////////--------------------------  
> 
> -
> To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
> the body of a message to majordomo@vger.rutgers.edu
> Please read the FAQ at 
http://www.tux.org/lkml/
> 
Cheers,
Andre Hedrick
The (NEW) Linux IDE guy
The APC UPS Specialist for Linux
http://www.dyer.vanderbilt.edu/server/udma/
http://www.dyer.vanderbilt.edu/server/apcupsd/apcupsd-3.5.2.bin.tar.gz
You just need a bigger hammer, or learn how to swing the one you have better.
(C) me.....
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/