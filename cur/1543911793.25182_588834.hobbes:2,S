Date: Mon, 27 Aug 2007 17:46:47 +0300
From: Al Boldi <>
Subject: Re: CFS review
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/27/95

Ingo Molnar wrote:
> * Al Boldi <a1426z@gawab.com> wrote:
> > > could you send the exact patch that shows what you did?
> >
> > On 2.6.22.5-v20.3 (not v20.4):
> >
> > 340-    curr->delta_exec += delta_exec;
> > 341-
> > 342-    if (unlikely(curr->delta_exec > sysctl_sched_stat_granularity))
> > { 343://          __update_curr(cfs_rq, curr);
> > 344-            curr->delta_exec = 0;
> > 345-    }
> > 346-    curr->exec_start = rq_of(cfs_rq)->clock;
>
> ouch - this produces a really broken scheduler - with this we dont do
> any run-time accounting (!).
Of course it's broken, and it's not meant as a fix, but this change allows 
you to see the amount of overhead as well as any miscalculations 
__update_curr incurs.
In terms of overhead, __update_curr incurs ~3x slowdown, and in terms of 
run-time accounting it exhibits a ~10sec task-startup miscalculation.
> Could you try the patch below instead, does this make 3x glxgears smooth
> again? (if yes, could you send me your Signed-off-by line as well.)
The task-startup stalling is still there for ~10sec.
Can you see the problem on your machine?
Thanks!
--
Al
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/