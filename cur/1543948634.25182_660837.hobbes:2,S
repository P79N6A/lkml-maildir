Date: Thu, 28 Feb 2008 05:21:56 +0100
From: Mike Galbraith <>
Subject: Re: [Regression in 2.6.25-rcX] CD/DVD writer no longer works
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/27/543

On Wed, 2008-02-27 at 19:26 -0800, zkopex mtrof wrote:
> [patch snipped]
> 
> Thank you very much! The patch you supplied fixes the regression!
You're welcome.  In the meantime, I found a better way.
diff --git a/drivers/scsi/scsi_lib.c b/drivers/scsi/scsi_lib.c
index ba21d97..7a6f784 100644
--- a/drivers/scsi/scsi_lib.c
+++ b/drivers/scsi/scsi_lib.c
@@ -871,7 +871,7 @@ void scsi_io_completion(struct scsi_cmnd *cmd, unsigned int good_bytes)
 			scsi_end_bidi_request(cmd);
 			return;
 		}
-		req->data_len = scsi_get_resid(cmd);
+		req->data_len = req->raw_data_len = scsi_get_resid(cmd);
 	}
 
 	BUG_ON(blk_bidi_rq(req)); /* bidi not support for !blk_pc_request yet */
> To be honest, I was expecting a few replies from the appropriate
> kernel developers. It looks like I have missed something in
> my regression report.
I think some of those are traveling.
	-Mike