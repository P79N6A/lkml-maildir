Date: Fri, 18 Jan 2008 19:12:02 +0100
From: Andi Kleen <>
Subject: Re: [patch 02/11] PAT x86: Map only usable memory in x86_64 identity map and kernel text
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/18/372

On Fri, Jan 18, 2008 at 08:46:02AM -0800, Jesse Barnes wrote:
> On Friday, January 18, 2008 5:12 am Andi Kleen wrote:
> > > (AMD machines apparently don't need it
> >
> > That's not true -- we had AMD systems in the past with broken MTRRs for
> > large memory configurations too,  Mostly it was pre revE though.
> 
> It should be easy enough to enable it for AMD as well, and it would also be 
> good to track down the one failure you found...  I don't *think* the 
> re-ordering of MTRR initialization should affect AMDs anymore than it does 
> Intel, but someone familiar with the boot code would have to do a quick audit 
> to be sure.
I looked back then when I had bisected it down and I admit I didn't spot the 
problem from source review. I think it came from the reordering so blacklisting 
AMD alone wouldn't have helped. Might have been some
subtle race (e.g. long ago we had such races in the MTRR code
triggered by the first HT CPUs) 
Anyways I just test booted latest git-x86 with your patches included on 
the QC system and it booted now. However it has both more RAM and newer CPUs 
(the original ones were pre-production, that is why I also didn't send you logs[1] ..) 
then when I tested originally. So this means either the problem was somewhere 
else or the different configuration hides it.
I guess you will hear about it if it's still broken on other machines.
Currently it looks good.
I think it should be enabled on AMD too though. If the reordering breaks
it then blacklisting won't help anyways.
-Andi
[1] but I checked the known errata and there was nothing related to MTRR.