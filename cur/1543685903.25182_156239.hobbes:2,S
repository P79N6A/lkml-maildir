Date: Sun, 10 Aug 2003 15:51:53 -0700 (PDT)
From: Matt C <>
Subject: [PATCH] [2.4] [Trivial] (re)add support for comtrol rocketport 4J
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/10/184

Hi Theodore, LKML:
I'm not quite sure this stopped working (worked under 2.4.19), but this 
patch adds support for the Comtrol Rocketport 4J 4-port rs232 PCI card. 
I've tested under 2.4.21, and verified that the support is still missing 
in 2.4.22-rc2.
thanks
-matt
--- linux-2.4.22-rc2/drivers/char/rocket.c	2001-09-21 10:55:22.000000000 -0700
+++ linux-2.4.21g1/drivers/char/rocket.c	2003-08-10 15:27:26.000000000 -0700
@@ -1944,6 +1944,10 @@
 		str = "8J";
 		max_num_aiops = 1;
 		break;
+	case PCI_DEVICE_ID_RP4J:
+		str = "4J";
+		max_num_aiops = 1;
+		break;
 	case PCI_DEVICE_ID_RP16INTF:
 		str = "16";
 		max_num_aiops = 2;
@@ -2006,6 +2010,10 @@
 			PCI_DEVICE_ID_RP8J, i, &bus, &device_fn)) 
 			if (register_PCI(count+boards_found, bus, device_fn))
 				count++;
+		if (!pcibios_find_device(PCI_VENDOR_ID_RP,
+			PCI_DEVICE_ID_RP4J, i, &bus, &device_fn)) 
+			if (register_PCI(count+boards_found, bus, device_fn))
+				count++;
 		if(!pcibios_find_device(PCI_VENDOR_ID_RP,
 			PCI_DEVICE_ID_RP8OCTA, i, &bus, &device_fn)) 
 			if(register_PCI(count+boards_found, bus, device_fn))
@@ -2031,6 +2039,10 @@
 			if(register_PCI(count+boards_found, bus, device_fn))
 				count++;
 		if(!pcibios_find_device(PCI_VENDOR_ID_RP,
+			PCI_DEVICE_ID_RP4J, i, &bus, &device_fn)) 
+			if(register_PCI(count+boards_found, bus, device_fn))
+				count++;
+		if(!pcibios_find_device(PCI_VENDOR_ID_RP,
 			PCI_DEVICE_ID_RPP4, i, &bus, &device_fn)) 
 			if(register_PCI(count+boards_found, bus, device_fn))
 				count++;
--- linux-2.4.22-rc2/drivers/char/rocket_int.h	2003-08-10 15:35:13.000000000 -0700
+++ linux-2.4.21g1/drivers/char/rocket_int.h	2003-08-10 15:27:31.000000000 -0700
@@ -1200,6 +1199,9 @@
 #ifndef PCI_DEVICE_ID_RP8J
 #define PCI_DEVICE_ID_RP8J		0x0006
 #endif
+#ifndef PCI_DEVICE_ID_RP4J
+#define PCI_DEVICE_ID_RP4J		0x0007
+#endif
 #ifndef PCI_DEVICE_ID_RPP4
 #define PCI_DEVICE_ID_RPP4		0x000A
 #endif