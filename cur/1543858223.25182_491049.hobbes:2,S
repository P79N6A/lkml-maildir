Date: Wed, 13 Dec 2006 11:20:04 +0000
From: Alan <>
Subject: Re: SATA DMA problem (sata_uli)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/12/13/55

> I tracked it down to one of the drives being forced into PIO4 mode
> rather than UDMA mode; dmesg bits:
> ata4.00: ATA-7, max UDMA/133, 586072368 sectors: LBA48 NCQ (depth 0/32)
> ata4.00: ata4: dev 0 multi count 16
> ata4.00: simplex DMA is claimed by other device, disabling DMA
Your ULi controller is reporting that it supports UDMA upon only one
channel at a time. The kernel is honouring this information. The older
ULi (was ALi) PATA devices report simplex but let you turn it off so see 
if the following does the trick. Test carefully as always with disk driver
changes.
(Jeff probably best to check the docs before merging this but I believe
it is sane)
Signed-off-by: Alan Cox <alan@redhat.com>
--- drivers/ata/sata_uli.c~	2006-12-13 10:53:58.848881256 +0000
+++ drivers/ata/sata_uli.c	2006-12-13 10:53:58.848881256 +0000
@@ -211,6 +211,8 @@
 	if (rc)
 		goto err_out_regions;
 
+	ata_pci_clear_simplex(pdev);
+
 	ppi[0] = ppi[1] = &uli_port_info;
 	probe_ent = ata_pci_init_native_mode(pdev, ppi, ATA_PORT_PRIMARY | ATA_PORT_SECONDARY);
 	if (!probe_ent) {
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/