Date: Fri, 3 Sep 1999 21:15:42 +0200
From: Petr Vandrovec <>
Subject: [PATCH] 2.3.16, ncpfs & new networking
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/9/3/112

Hi Linus,
   new networking code does unlock_kernel() in sock_poll() and it is not
good idea if no-one owns kernel lock... This one-linner fixes ncpfs to
directly call socket poll operation instead of file operation.
   Please, apply it for 2.3.17 to get rid of BUG() messages when using ncpfs.
					Thanks,
						Petr Vandrovec
						vandrove@vc.cvut.cz
--- linux/fs/ncpfs/sock.c	Tue Aug 31 20:30:48 1999
+++ linux/fs/ncpfs/sock.c	Fri Sep  3 21:10:22 1999
@@ -176,7 +176,7 @@
 		   instructions adding the wait_table waitqueues in the
 		   waitqueue-head before going to calculate the mask-retval. */
 		__set_current_state(TASK_INTERRUPTIBLE);
-		if (!(file->f_op->poll(file, &wait_table) & POLLIN)) {
+		if (!(sock->ops->poll(file, sock, &wait_table) & POLLIN)) {
 			int timed_out;
 			if (timeout > max_timeout) {
 				/* JEJB/JSP 2/7/94
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/