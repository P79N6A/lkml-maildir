Date: Thu, 15 Feb 2001 11:58:44 +0100 (MET)
From: ARND BERGMANN <>
Subject: Re: IRQ (routing ?) problem [was Re: epic100 in current -ac kernels]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/2/15/146

Sorry for the delay, I could not get physical access to the machine
for the last days.
I was able to do some more testing today and found this:
- The problem is not the IRQ /sharing/, after getting rid of all the
  other PCI cards, the problem was still there.
- The only thing that seems to have any effect on the symptoms is the
  presence of the USB driver, either usb-uhci or uhci. I am not using
  USB at all. As described before, the system behaves is either of those
  ways:
   * epic100 driver without DMA mapping (e.g. 2.4.0-ac9): normal operation
   * driver with DMA mapping+USB driver loaded: lots of interrupts -> slow
   * driver with DMA mapping, USB driver not loaded: hang after ~2 seconds
- I sometimes get 'spurious interrupt: IRQ7', even though no device is 
  connected there. Probably not important.
On Sat, 10 Feb 2001, Francois Romieu wrote:
> 
> The following informations may help:
> - motherboard type
Asus A7V, onboard USB hub and Promise ATA/100 chip
> - bios revision
Can't see right now, system was bought in October 2000
I think it was 1.004, but I am not sure.
> - lspci -x 
see attachment, this was when I ripped out sound, tv and scsi
> - 2.4.2pre3 + whatever recent ac epic100 = ?
Still no improvement until latest -ac (2.4.1-ac13)
Arnd <><
00:00.0 Host bridge: VIA Technologies, Inc.: Unknown device 0305 (rev 02)
	Subsystem: Asustek Computer, Inc.: Unknown device 8033
	Flags: bus master, medium devsel, latency 0
	Memory at e7000000 (32-bit, prefetchable) [size=16M]
	Capabilities: [a0] AGP version 2.0
	Capabilities: [c0] Power Management version 2
00: 06 11 05 03 06 00 10 22 02 00 00 06 00 00 00 00
10: 08 00 00 e7 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 43 10 33 80
30: 00 00 00 00 a0 00 00 00 00 00 00 00 00 00 00 00
00:01.0 PCI bridge: VIA Technologies, Inc.: Unknown device 8305 (prog-if 00 [Normal decode])
	Flags: bus master, 66Mhz, medium devsel, latency 0
	Bus: primary=00, secondary=01, subordinate=01, sec-latency=0
	Memory behind bridge: e2800000-e3dfffff
	Prefetchable memory behind bridge: e3f00000-e6ffffff
	Capabilities: [80] Power Management version 2
00: 06 11 05 83 07 00 30 22 00 00 04 06 00 00 01 00
10: 00 00 00 00 00 00 00 00 00 01 01 00 e0 d0 00 00
20: 80 e2 d0 e3 f0 e3 f0 e6 00 00 00 00 00 00 00 00
30: 00 00 00 00 80 00 00 00 00 00 00 00 00 00 08 00
00:04.0 ISA bridge: VIA Technologies, Inc. VT82C686 [Apollo Super] (rev 22)
	Subsystem: Asustek Computer, Inc.: Unknown device 8033
	Flags: bus master, stepping, medium devsel, latency 0
00: 06 11 86 06 87 00 10 02 22 00 01 06 00 00 80 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 43 10 33 80
30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00:04.1 IDE interface: VIA Technologies, Inc. VT82C586 IDE [Apollo] (rev 10) (prog-if 8a [Master SecP PriP])
	Flags: bus master, medium devsel, latency 32
	I/O ports at d800 [size=16]
	Capabilities: [c0] Power Management version 2
00: 06 11 71 05 07 00 90 02 10 8a 01 01 00 20 00 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 01 d8 00 00 00 00 00 00 00 00 00 00 00 00 00 00
30: 00 00 00 00 c0 00 00 00 00 00 00 00 ff 00 00 00
00:04.2 USB Controller: VIA Technologies, Inc. VT82C586B USB (rev 10) (prog-if 00 [UHCI])
	Subsystem: Unknown device 0925:1234
	Flags: bus master, medium devsel, latency 32, IRQ 11
	I/O ports at d400 [size=32]
	Capabilities: [80] Power Management version 2
00: 06 11 38 30 17 00 10 02 10 00 03 0c 08 20 00 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 01 d4 00 00 00 00 00 00 00 00 00 00 25 09 34 12
30: 00 00 00 00 80 00 00 00 00 00 00 00 0b 04 00 00
00:04.3 USB Controller: VIA Technologies, Inc. VT82C586B USB (rev 10) (prog-if 00 [UHCI])
	Subsystem: Unknown device 0925:1234
	Flags: bus master, medium devsel, latency 32, IRQ 11
	I/O ports at d000 [size=32]
	Capabilities: [80] Power Management version 2
00: 06 11 38 30 17 00 10 02 10 00 03 0c 08 20 00 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 01 d0 00 00 00 00 00 00 00 00 00 00 25 09 34 12
30: 00 00 00 00 80 00 00 00 00 00 00 00 0b 04 00 00
00:04.4 Host bridge: VIA Technologies, Inc. VT82C686 [Apollo Super ACPI] (rev 30)
	Flags: medium devsel, IRQ 9
	Capabilities: [68] Power Management version 2
00: 06 11 57 30 00 00 90 02 30 00 00 06 00 00 00 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
30: 00 00 00 00 68 00 00 00 00 00 00 00 00 00 00 00
00:0c.0 Ethernet controller: Standard Microsystems Corp [SMC] 83C170QF (rev 08)
	Subsystem: Standard Microsystems Corp [SMC]: Unknown device a020
	Flags: bus master, fast devsel, latency 32, IRQ 10
	I/O ports at a400 [size=256]
	Memory at e2000000 (32-bit, non-prefetchable) [size=4K]
	Expansion ROM at <unassigned> [disabled] [size=64K]
	Capabilities: [dc] Power Management version 1
00: b8 10 05 00 07 00 90 00 08 00 00 02 00 20 00 00
10: 01 a4 00 00 00 00 00 e2 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 07 01 00 00 b8 10 20 a0
30: 00 00 00 00 dc 00 00 00 00 00 00 00 0a 01 08 1c
00:11.0 Unknown mass storage controller: Promise Technology, Inc.: Unknown device 0d30 (rev 02)
	Subsystem: Promise Technology, Inc.: Unknown device 4d33
	Flags: bus master, medium devsel, latency 32, IRQ 5
	I/O ports at a000 [size=8]
	I/O ports at 9800 [size=4]
	I/O ports at 9400 [size=8]
	I/O ports at 9000 [size=4]
	I/O ports at 8800 [size=64]
	Memory at e1800000 (32-bit, non-prefetchable) [size=128K]
	Expansion ROM at <unassigned> [disabled] [size=64K]
	Capabilities: [58] Power Management version 1
00: 5a 10 30 0d 07 00 10 02 02 00 80 01 00 20 00 00
10: 01 a0 00 00 01 98 00 00 01 94 00 00 01 90 00 00
20: 01 88 00 00 00 00 80 e1 00 00 00 00 5a 10 33 4d
30: 00 00 00 00 58 00 00 00 00 00 00 00 05 01 00 00
01:00.0 VGA compatible controller: Matrox Graphics, Inc. MGA G400 AGP (rev 04) (prog-if 00 [VGA])
	Subsystem: Matrox Graphics, Inc.: Unknown device 0378
	Flags: bus master, medium devsel, latency 64, IRQ 10
	Memory at e4000000 (32-bit, prefetchable) [size=32M]
	Memory at e3000000 (32-bit, non-prefetchable) [size=16K]
	Memory at e2800000 (32-bit, non-prefetchable) [size=8M]
	Expansion ROM at e3ff0000 [disabled] [size=64K]
	Capabilities: [dc] Power Management version 2
	Capabilities: [f0] AGP version 2.0
00: 2b 10 25 05 07 00 90 02 04 00 00 03 08 40 00 00
10: 08 00 00 e4 00 00 00 e3 00 00 80 e2 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 2b 10 78 03
30: 00 00 ff e3 dc 00 00 00 00 00 00 00 0a 01 10 20