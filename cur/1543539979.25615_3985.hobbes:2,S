Date: Wed, 26 Jul 2000 20:09:19 -0400 (EDT)
From: Alexander Viro <>
Subject: Re: Strange chmod behavior on 2.2.16 with write_inode()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/26/135

On Wed, 26 Jul 2000, Jeff V. Merkey wrote:
> 
> More on this problem -- here's someting weird.  If I wait a few seconds
> after typing 'chmod 444 *' on a directory of files, then I start seeing
> write_inode() come through the vfs, however, if I do an 'ls -l' on the
> directory immediately after I issue a chmod command, then the
> write_inode() never seems to happen.  It looks like write_inode() is
> getting called by some sort of delayed process (who writes dirty inodes
> back to disk).  The changes don't show up changed right away after a
> chmod call either.
> 
> I think I'll just implement notify_change() since the vfs.txt
> information about relying on notify_change() to default to write_inode()
> is obviously incorrect -- there's a hole somewhere where the inode
> permissions can get lost.
Do you, by chance, do something with inodes in readdir()? I suspect that
it should be the right place to look. Looks like you are losing the dirty
bit on inode before it gets written...
Eh, wait. Where does your filesystem keep inode metadata? I think I know
one of the possible reasons, but I'ld like to hear the answer first...
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/