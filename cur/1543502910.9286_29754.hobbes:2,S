Date: Fri, 16 Jul 99 14:25:00 +0200
From: Erik Mouw <>
Subject: Linux NFS client problems with SGI server
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/7/16/32

Hi,
The situation: an SGI Origin 200 fileserver running IRIX 6.4, exporting
two filesystems for ~25 clients (SGI Indy/O2/Octane/Onyx, Sun Sparc IPC,
i386 Linux). The IRIX NFS server supports NFS v2 and v3; the SGI clients
use v3, the Suns v2, and I don't know how to find out what the Linux
machine uses.
The exports file on the Origin (server1) looks like:
  # The software disk plus the images. Note the "nohide" option.
  #
  /usr/it         -access=clients:friends
  /usr/it/images  -access=clients:friends,nohide
  #
  # User home directories.
  #
  /home           -access=clients:friends
The fstab file on the Linux machine:
  /dev/hda1               /               ext2    defaults,errors=remount-ro 0 1
  /dev/hda2               none            swap    sw              0 0
  proc                    /proc           proc    defaults        0 0
  /dev/hda5               /var            ext2    defaults        0 2
  /dev/hda6               /tmp            ext2    defaults        0 2
  /dev/hda7               /usr            ext2    defaults        0 2
  server1:/home           /home           nfs     defaults        0 0
  server1:/usr/it         /usr/it         nfs     defaults        0 0
  server2:/var/spool/mail /var/spool/mail nfs     defaults        0 0
Server2 is an old Sun Sparc2 running SunOS 4.1.3.
The /home and /var/spool/mail filesystems never give problems, but the
/usr/it filesystem sometimes stops to work while it is mounted: binaries
on /usr/it refuse to work, and "ls /usr/it" returns "ls: /usr/it:
Input/output error". After I unmount and remount /usr/it, it works again.
The kernel log shows:
  Jul 16 09:03:44 kalman kernel: __nfs_fhget: inode 128 still busy,i_count=2 
  Jul 16 09:03:44 kalman kernel: __nfs_fhget: killing /// filehandle 
  Jul 16 09:04:09 kalman kernel: __nfs_fhget: inode 128 still busy,i_count=2 
  Jul 16 09:04:09 kalman kernel: __nfs_fhget: killing /// filehandle 
I'm not quite sure if this is from my "ls" request, or from the "umount"
command. The error shows up in Linux 2.2.3, 2.2.8, and 2.2.10, all with
NFS compiled as a module. I tried several mount options: rsize=4096,
nolock, and nfsvers=2, but the problem still remains. The machine is
running Debian 2.0. Is this a kernel bug, or am I doing something wrong?
Erik
-- 
J.A.K. (Erik) Mouw, Information and Communication Theory Group, Department
of Electrical Engineering, Faculty of Information Technology and Systems,
Delft University of Technology, PO BOX 5031,  2600 GA Delft, The Netherlands
Phone: +31-15-2785859  Fax: +31-15-2781843  Email J.A.K.Mouw@its.tudelft.nl
WWW: 
http://www-ict.its.tudelft.nl/~erik/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/