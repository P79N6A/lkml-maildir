Date: Wed, 1 Sep 2004 15:30:34 -0700
From: Andrew Morton <>
Subject: Re: [patch 21/25]  hvc_console: replace schedule_timeout() with msleep()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/1/338

janitor@sternwelten.at wrote:
>
> -#define TIMEOUT		((HZ + 99) / 100)
> +#define TIMEOUT		10
> 
>  static struct tty_driver *hvc_driver;
>  static int hvc_offset;
> @@ -276,8 +277,7 @@ int khvcd(void *unused)
>  			for (i = 0; i < MAX_NR_HVC_CONSOLES; ++i)
>  				hvc_poll(i);
>  		}
> -		set_current_state(TASK_INTERRUPTIBLE);
> -		schedule_timeout(TIMEOUT);
> +		msleep(TIMEOUT);
This one is wrong: we need to sleep in interruptible state here, otherwise
this kernel thread will contribute to the system load average.
Several other of your msleep conversion patches actually fix bugs.  You've
found drivers which want to sleep for a fixed period, but they do that with
TASK_INTERRUPTIBLE.  If someone sends the calling process a signal, these
drivers will end up not sleeping at all and may fail.
I'll going through these patches and shall apply the ones which look right.
Please consider them all to have been handled, thanks.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/