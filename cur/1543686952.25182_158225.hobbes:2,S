Date: Sun, 17 Aug 2003 23:03:25 -0700
From: Andrew Morton <>
Subject: Re: Very bad interactivity with 2.6.0 and SCSI disks (aic7xxx)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/18/8

Stefan Foerster <stefan@stefan-foerster.de> wrote:
>
> * Andrew Morton <akpm@osdl.org> wrote:
> > Stefan Foerster <stefan@stefan-foerster.de> wrote:
> > A kernel profile would be needed to diagnose this.  You could use
> > readprofile, but as it may be an interrupt problem, the NMI-based oprofile
> > output would be better.
> 
> Is this procedure documented anywhere?
> 
Documentation/basic_profiling.txt and oprofile.sourceforge.net.
oprofile is hard to get going and they seem to keep on changing things.
A quick primer would be:
- download the userspace tools, carefully read the INSTALL and README
  files.
- You need to do ./configure --with-kernel-support (something like that).
- build and install.
From my notes, for a P4:
opcontrol --setup --vmlinux=/boot/vmlinux --ctr0-count=600000 --ctr0-unit-mask=1  --ctr0-event=GLOBAL_POWER_EVENTS 
For a PIII:
opcontrol --setup --vmlinux=/boot/vmlinux --ctr0-count=600000 --ctr0-event=CPU_CLK_UNHALTED
Then:
opcontrol --shutdown
rm -rf /var/lib/oprofile
opcontrol --start-daemon
opcontrol --start
<run test>
opcontrol --stop
oprofpp -l /boot/vmlinux
oprofpp -Lo /boot/vmlinux > /tmp/1
I use this script.
#!/bin/sh
sudo opcontrol --stop
sudo opcontrol --shutdown
sudo rm -rf /var/lib/oprofile
sudo opcontrol --start-daemon
sudo opcontrol --start
time $@
sudo opcontrol --stop
sudo opcontrol --shutdown
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/