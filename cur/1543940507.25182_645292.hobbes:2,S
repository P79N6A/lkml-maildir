Date: Tue, 29 Jan 2008 14:22:55 -0800
From: Rick Lindsley <>
Subject: Re: 2.6.23.1: oops in diskstats_show()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/29/433

    my kernel 2.6.23.1 oopsed today in diskstats_show(), leaving the
    block_subsys_lock mutex locked.  I have an Athlon 64 X2 (dual-core),
    architecture x86_64.  I have not tried with 2.6.24 yet, but it looks
    like there was no relevant change in 2.6.24.
Hmm. Yes, this should not happen. Having grabbed the block_subsys_lock
mutex should have been sufficient to keep the disk list stable.  And the
evidence you sent along suggests that yes, the gendisk structure may have
gotten cleared after you got a reference to it but before you could get
the data from it.
    Right before the crash, I was torturing cryptsetup to experiment with
    encryption - I created and deleted device mapper objects in a loop.
Creating and deleting block devices ... yeah, this is probably key to
the problem. Can you provide the command or, more likely, script you
were using to do this?
Rick