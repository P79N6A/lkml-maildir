Date: Thu, 3 Aug 2000 14:10:05 -0700 (PDT)
From: Linus Torvalds <>
Subject: Re: patch to yenta.c breaks IBM thinkpad 600E
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/3/111

On Wed, 2 Aug 2000, Anton Blanchard wrote:
> 
> I had to revert the change made to yenta.c or my thinkpad would lock up
> at boot and give nasty ide dma timeout errors.
Hey, cool.
I'd still ask you to do some more testing for me, if that's ok?
Can you boot with the broken kernel and with the DEBUG thing defined in
arch/i386/kernel/pci-i386.h? I'd love to see what it says.
Also, if it refuses to work with a IO limit > 256, maybe it will work with
_two_ IO limits that are <= 256 instead. The problem there, of course, is
that pci_claim_resource() isn't smart enough to be able to search the
second one after it fails with the first one.
Martin, any ideas? I have this suspicion that pci_claim_resource() should
be rewritten to fall back on other resources if it cannot find space in a
good one (pci_find_parent_resource() already falls back on a
non-prefetchable memory region if it cannot find a prefetchable one, but
that kind of fallback should probably happen for other failure modes too,
like PCI mapping windows that are already full..
Yenta could easily do an additional
	yenta_allocate_res(socket, 3, IORESOURCE_IO);
and it would work if just the PCI layer understood to do that allocation..
		Linus
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/