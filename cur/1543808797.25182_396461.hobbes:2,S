Date: Mon, 13 Feb 2006 11:54:21 +0100
From: Ingo Molnar <>
Subject: Re: calibrate_migration_costs takes ages on s390
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/2/13/102

* David S. Miller <davem@davemloft.net> wrote:
> Things are not as slow, but definitely slow on sparc64 too, and it's 
> also due to the migration cost calculations.
> 
> It's also really bad that it's using vmalloc(), for one thing, because 
> this thrashes the TLB (some of us have 64-entry software replaced 
> TLBs) and also because you can make no guarentees about how well the 
> backing physical pages will distribute into the L2 cache.
the TLB trashing is intended, to calculate the worst-case migration 
cost. If userspace is TLB-intensive, it will trash TLBs just as much.
> As a result, wildly different run-to-run results can be expected 
> particularly for systems with 1-way or 2-way set assosciative L2 
> caches, which are common on sparc64.  I don't know about s390.
s390 is clearly a special-base, being a virtual platform. But the 
calibration should be improved to work better on sparc64.
Do things get better if you fill out include/asm-sparc64/system.h's 
sched_cacheflush() function, to flush the L2 cache? That should at least 
make the cache state more or less reproducable across runs.
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/