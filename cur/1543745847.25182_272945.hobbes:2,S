Date: Sat, 20 Nov 2004 10:28:27 -0800 (PST)
From: Linus Torvalds <>
Subject: Re: 2.6.10-rc2 doesn't boot (if no floppy device)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/11/20/125

On Sat, 20 Nov 2004, Adrian Bunk wrote:
> 
> With your patch, the boot failure goes away.
> This was with a kernel without Linus' patch applied.
It boots for me too, but it all seems pretty accidental.
In particular, the code will disable irq12 (mouse interrupt), so the mouse
has no chance of working. Having tested it, it so happens that if I boot
with a mouse actually conntected, the BIOS will not use irq12 for PCI
devices, so that will hide the problem since ACPI won't try to disable it
when it doesn't see it.
But if I had more PCI devices, or another legacy device that doesn't have
the same kind of "test if something is connected" logic, it really looks
like it would break again. (It's entirely possible that Windows has the
exact same issue, of course, at which point it's fairly safe to say that 
manufacturers will have tested this and just not done it, but I don't feel 
all that safe making that assumption).
So I think the simpler fix is just this one-liner: we should not disable
preexisting links, because non-PCI devices may depend on the same routing
information, and thus the comments about "being activated on use" is not
actually true.
		Linus
===== drivers/acpi/pci_link.c 1.34 vs edited =====
--- 1.34/drivers/acpi/pci_link.c	2004-11-01 23:40:09 -08:00
+++ edited/drivers/acpi/pci_link.c	2004-11-20 09:43:56 -08:00
@@ -685,9 +685,6 @@
 	acpi_link.count++;
 
 end:
-	/* disable all links -- to be activated on use */
-	acpi_ut_evaluate_object(link->handle, "_DIS", 0, NULL);
-
 	if (result)
 		kfree(link);
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/