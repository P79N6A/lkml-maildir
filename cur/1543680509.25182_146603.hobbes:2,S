Date: Thu, 10 Jul 2003 03:24:56 -0300
From: Gerardo Exequiel Pozzi <>
Subject: PIIX3 timeout waiting for DMA 2.4 and MAXTOR drive.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/10/16

Hi people,
Recently I was making some tests on old motherboard with PIIX3 chipset,
copying the directory /usr (630mb) from a disc to another one (runlevel
1), in both senses (origin disk in read-only), after a few minutes of
activity (1-2 minutes), different messages from kernel about DMA timeout
appeared.
The problem only happens on disc MAXTOR, as much reading as writing on
it, when transfer data from a disc to another one connected in
different IDE channels.  But on the same disc or from a disc to another
one on same IDE channel there is no problem, also probe to invert discs
of channels IDE and the problem repeats on him same disc.
Also probe with another disc MAXTOR same model, and happens exactly the
same.
I read in a page Web on the problem of the DMA timeout with this PIIX3
chipset and discs QUANTUM, and that a possible solution is to
increase the "PCI Latency Timer", then, it fits the Latency with
setpci of all the PCI BUS of 32 to greater numbers, until 0xff and the
problem persists.
Probe both kernels the 2.4.20 and the 2.4.21 (with and without XFS
patch) and the same results.
This a PIIX3 chipset problem with some disks?
This message appears three times during the copy and finaly dma
& multicount is disabled, but reactivated with hdparm without
problems.
hdc: dma_timer_expiry: dma status == 0x20
hdc: timeout waiting for DMA
hdc: timeout waiting for DMA
hdc: (__ide_dma_test_irq) called while not waiting
hdc: status error: status=0x58 { DriveReady SeekComplete DataRequest }
hdc: drive not ready for command
hdc: status timeout: status=0xd0 { Busy }
hdc: drive not ready for command
ide1: reset: success
Attached the config, dmesg, lspci, and hdparm -i.
ciao, dj
btw: lamentably I do not have at the moment the hardware to prove
(sorry my english)
-- 
Gerardo Exequiel Pozzi ( djgera )
http://www.vmlinuz.com.ar
 
http://www.djgera.com.ar
KeyID: 0x1B8C330D
Key fingerprint = 0CAA D5D4 CD85 4434 A219  76ED 39AB 221B 1B8C 330D
[unhandled content-type:application/octet-stream]