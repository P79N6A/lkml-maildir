Date: Tue, 12 Feb 2008 11:08:25 +0100
From: Thomas Petazzoni <>
Subject: [PATCH] Configure out doublefault exception handler (Linux Tiny)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/12/129

Hi,
Enclosed patch allows to configure out the doublefault exception
handler. The original patch of Matt Mackall added the option in
init/Kconfig, but because this is a x86-specific thing, I thought
arch/x86/Kconfig would be a better place. Is that correct ?
This patch applies on top on the DMI scanning code patch I've sent
yesterday, because the DOUBLEFAULT config option is right after the DMI
config option. Is that ok, or should I propose a patch on top of a
vanilla 2.6.25-rc1 ?
Thanks for your review and comments,
Thomas
---
This patch adds the ability to disable the doublefault exception
handler, in order to save some kernel space. The doublefault exception
handler was already conditionnaly compiled using CONFIG_DOUBLEFAULT,
but there was no way to change the value of this configuration
option. The option is only visible if CONFIG_EMBEDDED is selected, in
order to not confuse other users.
The kernel space savings are as follows:
   text    data     bss     dec     hex filename
1076076  128656   98304 1303036  13e1fc vmlinux.before
1075772  119952   94208 1289932  13aecc vmlinux.after
   -304   -8704   -4096  -13104   -3330 +/-
This patch is part of the Linux Tiny project, and is based on previous
work by Matt Mackall <mpm@selenic.com>.
Signed-off-by: Thomas Petazzoni <thomas.petazzoni@free-electrons.com>
---
 arch/x86/Kconfig |    7 +++++++
 1 file changed, 7 insertions(+)
Index: linux/arch/x86/Kconfig
===================================================================
--- linux.orig/arch/x86/Kconfig
+++ linux/arch/x86/Kconfig
@@ -439,6 +439,13 @@
 	  affected by entries in the DMI blacklist. Required by PNP
 	  BIOS code.
 
+config DOUBLEFAULT
+	default y
+	bool "Enable doublefault exception handler" if EMBEDDED
+	help
+	  This option allows trapping of rare doublefault exceptions
+	  that would otherwise cause a system to silently reboot.
+
 config GART_IOMMU
 	bool "GART IOMMU support" if EMBEDDED
 	default y
-- 
Thomas Petazzoni, thomas.petazzoni@enix.org, 
http://thomas.enix.org
Jabber, thomas.petazzoni@jabber.dk
Toulibre, 
http://www.toulibre.org
 - APRIL, 
http://www.april.org
Fingerprint : 0BE1 4CF3 CEA4 AC9D CC6E  1624 F653 CB30 98D3 F7A7
[unhandled content-type:application/pgp-signature]