Date: Fri, 14 Jul 2006 14:33:47 -0700
From: David Brownell <>
Subject: Re: [linux-usb-devel] [PATCH] Properly unregister reboot notifier in case of failure in ehci hcd
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/14/256

On Friday 14 July 2006 9:46 am, Aleksey Gorelov wrote:
> David, Alan,
> 
> Do you think it is Ok to unregister reboot notifier in ehci_run before registering one to make
> sure there is no 'double registering' of notifier, or is it better to move register/unregister
> reboot notifier from ehci_run/ehci_stop completely to some other place ?
Probably the best way is to stop using the notifier, and brute force it
by making every EHCI subdriver get its own shutdown() method.  That'd be
obvious enough for PCI bus glue, and due to recent patches probably even
for the non-PCI ones ... since they all use "platform_bus" now, they can
all share the same method.  Though I could imagine some platforms might
want to do extra stuff like clk_disable() after the root hub reset.
I could see the tail end of ehci-hcd.c with a forward decl for a method
like ehci_platform_shutdown(), updating the subdrivers to reference that,
and then #ifdef PLATFORM_DRIVER provide the definition of that routine
(doing what the reboot notifier does) for use by the non-PCI subdrivers.
- Dave
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/