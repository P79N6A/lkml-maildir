Date: Sun, 26 May 2002 14:41:30 +0100
From: David Woodhouse <>
Subject: Re: ehci-hcd on CARDBUS hangs when stopping card service
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/5/26/82

torvalds@transmeta.com said:
> > Is there a clean way to detect the "card ejected before anything
> > calls pci_dev->remove()" case?  I don't really like the idea of
> > wrapping code around every PCI register access to detect such cases.
> You don't have much choice with CardBus, I'm afraid.
You get an interrupt _before_ the card goes away, because the pins are of
different lengths. 
As long as your driver API has some kind of abort() call to tell it that the
device is no longer present, and you manage to call that within the few
milliseconds between the card detect pin contact breaking and the rest of
the pins breaking, you should be fine.
If you're sharing interrupts and have high interrupt latency, there may be a
problem -- perhaps it would be better if in that case you could ensure that
the socket IRQ handler gets run _before_ the device IRQ handler. 
>  Also, it's generally a good idea to "just say no" to endless loops in
> drivers. Hardware bugs _do_ happen, and it's a lot more pleasant to
> have the driver do a
> 	printk("Device does not respond\n");
> than for the kernel to hang.
Too late. On some hardware, if you try to talk to the device once it's 
gone, you're already dead. Not all the world is a PeeCee.
--
dwmw2
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/