Date: Tue, 11 Apr 2006 23:57:06 -0400
From: Jeff Garzik <>
Subject: Re: Linux 2.6.16 -  SATA read performance drop ~50% on Intel 82801GB/GR/GH
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/11/305

Andreas Schnaiter wrote:
> Hi,
> 
> after upgrading from linux 2.6.15.7 to 2.6.16.2 I noticed an extreme slowdown 
> of the SATA disks on my system. Writing/reading a 8GB file showed that 
> reading performes with less than half the speed on 2.6.16 (strangely hdparm 
> shows almost no difference).
> The two affected disks are connected to the Intel 82801GB/GR/GH (ICH7 Family)  
> Serial ATA Controller.
> Disks on the Silicon Image/Intel IDE Controllers are not affected.
> I didn't have the chance yet to test if this problem also exists on the 
> Silicon Image SATA Controller.
hdparm usually skips the usual layers, and benchmarks the ATA command 
submission itself.  So if hdparm didn't change, that may indicate the 
problem is either in the block (scheduler?) or filesystem layers.
Tests:
1) Try with Silicon Image controller, as you mentioned.  Try in same 
machine with same device, if possible.
2) Eliminate the filesystem layer by doing dd directly to the block 
device (dd ... of=/dev/sda1) rather than dd'ing to a file on a filesystem.
3) Try decreasing the block size to 4k or 8k.
4) Finally, the thing that will help us kernel hackers the most, use 
'git bisect' to definitively discover the changeset that causes your 
problems.
	Jeff
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/