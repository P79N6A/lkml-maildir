Date: 21 Nov 2002 09:57:23 +0100
From: Nicolas Mailhot <>
Subject: [PATCH] [2.5] Via KT400 agp support (fixes 'unsupported Via chipset (device id: 3189)')
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/11/21/22

[ Re-send with magic keywords in subject, sorry about this ]
Hi,
	This is a tiny patch to support agp on Via KT400 hardware. It basically
adds the KT400 pci ID and lists it as using Via generic setup routines.
This patch has been tested with all GL xscreensaver I could find, and
been reviewed by Dave Jones (full patch history at
http://bugzilla.kernel.org/show_bug.cgi?id=14
).
	Please apply.
diff -uNr linux-2.5.47-ac6.orig/drivers/char/agp/agp.c
linux-2.5.47-ac6/drivers/char/agp/agp.c
--- linux-2.5.47-ac6.orig/drivers/char/agp/agp.c	2002-11-11 04:28:26.000000000 +0100
+++ linux-2.5.47-ac6/drivers/char/agp/agp.c	2002-11-20 22:07:32.000000000 +0100
@@ -1150,6 +1150,14 @@
 		.chipset_setup	= via_generic_setup
 	},
 	{
+		.device_id	= PCI_DEVICE_ID_VIA_8377_0,
+		.vendor_id	= PCI_VENDOR_ID_VIA,
+		.chipset	= VIA_APOLLO_KT400,
+		.vendor_name	= "Via",
+		.chipset_name	= "Apollo Pro KT400",
+		.chipset_setup	= via_generic_setup
+	},
+	{
 		.device_id	= PCI_DEVICE_ID_VIA_8653_0,
 		.vendor_id	= PCI_VENDOR_ID_VIA,
 		.chipset	= VIA_APOLLO_PRO,
diff -uNr linux-2.5.47-ac6.orig/include/linux/agp_backend.h linux-2.5.47-ac6/include/linux/agp_backend.h
--- linux-2.5.47-ac6.orig/include/linux/agp_backend.h	2002-11-11 04:28:29.000000000 +0100
+++ linux-2.5.47-ac6/include/linux/agp_backend.h	2002-11-20 22:49:35.000000000 +0100
@@ -61,6 +61,7 @@
 	VIA_APOLLO_PRO,
 	VIA_APOLLO_KX133,
 	VIA_APOLLO_KT133,
+	VIA_APOLLO_KT400,
 	SIS_GENERIC,
 	AMD_GENERIC,
 	AMD_IRONGATE,
diff -uNr linux-2.5.47-ac6.orig/include/linux/pci_ids.h linux-2.5.47-ac6/include/linux/pci_ids.h
--- linux-2.5.47-ac6.orig/include/linux/pci_ids.h	2002-11-20 21:46:32.000000000 +0100
+++ linux-2.5.47-ac6/include/linux/pci_ids.h	2002-11-20 22:28:37.000000000 +0100
@@ -1039,6 +1039,7 @@
 #define PCI_DEVICE_ID_VIA_8361		0x3112 
 #define PCI_DEVICE_ID_VIA_8233A		0x3147
 #define PCI_DEVICE_ID_VIA_8235		0x3177
+#define PCI_DEVICE_ID_VIA_8377_0	0x3189
 #define PCI_DEVICE_ID_VIA_86C100A	0x6100
 #define PCI_DEVICE_ID_VIA_8231		0x8231
 #define PCI_DEVICE_ID_VIA_8231_4	0x8235
-- 
Nicolas Mailhot <Nicolas.Mailhot@laposte.net>
[unhandled content-type:application/pgp-signature]