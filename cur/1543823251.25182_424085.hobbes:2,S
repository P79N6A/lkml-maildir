Date: Mon, 15 May 2006 23:26:56 +0200
From: Kevin Baradon <>
Subject: Re: 2.6.17-rc1: kernel only boots one CPU on HT system
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/15/354

Le Mardi 25 Avril 2006 03:53, Shaohua Li a écrit :
> On Mon, 2006-04-24 at 19:26 +0200, Kevin Baradon wrote:
> > Le Lundi 24 Avril 2006 03:57, Shaohua Li a écrit :
> > > Hi,
> >
> > Hello,
> >
> > > On Sun, 2006-04-23 at 14:15 -0700, Andrew Morton wrote:
> > > > Kevin Baradon <kevin.baradon@gmail.com> wrote:
> > > > > Hello,
> > > > >
> > > > > Starting with kernel 2.6.17-rc1 (also happens with 2.6.17-rc2),
> > > > > second logical-CPU of my Hyperthreading system no longer boots.
> > > > >
> > > > > I tracked up changes in APIC code, and it appears reverting commit
> > > > > 7c5c1e427b5e83807fd05419d1cf6991b9d87247 fixes this bug.
> > > >
> > > > That helps heaps, thanks.
> > >
> > > The commit doesn't look like the root cause to me. BIOS already assigns
> > > unique id to ioapic, and the cpu family is 15, so with/without the
> > > patch the code path hasn't any difference. Kevin, can you please make a
> > > clean build and check if the patch is the real cause?
> >
> > You were right. Reverting this commit helps sometimes, but doesn't work
> > reliably. When my computer booted this morning, I've had only one CPU
> > detected. I've tried booting several times, even with a complete power
> > down. Nothing changed.
> >
> > I've also tried with kernel 2.6.16-rc6, which booted fine and detected
> > two CPUs.
> >
> > I've applied your small patch. Debugging output is attached.
> >
> > If you want, I can apply this small patch also to kernel 2.6.16-rc6, and
> > send you debugging output.
> >
> > > If it still doesn't work, you might apply a small change below to
> > > include/asm-i386/apic.h, and attach the dmesg, so we could analyze it.
> >
> > File attached.
>
> The CPU doesn't startup. Sometime ago somebody reported a similar issue
> for 2.6.16.1. But the failure isn't reliably triggered. IIRC, there
> isn't a solution.
Hello,
I've found a workaround to this bug. 
Problem has already been reported in 
http://bugzilla.kernel.org/show_bug.cgi?id=5757.
Workaround described (disabling USB legacy emulation in BIOS) works reliably. 
>
> Thanks,
> Shaohua
-- 
Kevin Baradon
Telecom Student
-
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/