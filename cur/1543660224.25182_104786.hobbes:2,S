Date: 21 Jan 2003 02:03:42 +0100
From: Benoit Poulot-Cazajous <>
Subject: [PATCH][2.4] Speedup 'make dep'
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/1/20/200

Hi Marcelo,
During 'make dep', make spends most of its time (sometimes more
than 75%) uselessly analysing .hdepend. Delaying its production
makes 'make dep' much faster.
The following patch also builds .depend last, in order to make
the dependency information generation more resistant against
^C and other failures.
Regards,
  -- Benoit
diff -ru linux-2.4.20/Makefile linux-2.4.20-bpc/Makefile
--- linux-2.4.20/Makefile	2003-01-10 22:32:25.000000000 +0100
+++ linux-2.4.20-bpc/Makefile	2003-01-20 09:52:43.000000000 +0100
@@ -488,12 +488,13 @@
 	find . -type f -print | sort | xargs sum > .SUMS
 
 dep-files: scripts/mkdep archdep include/linux/version.h
-	scripts/mkdep -- init/*.c > .depend
-	scripts/mkdep -- `find $(FINDHPATH) \( -name SCCS -o -name .svn \) -prune -o -follow -name \*.h ! -name modversions.h -print` > .hdepend
+	rm -f .depend .hdepend
 	$(MAKE) $(patsubst %,_sfdep_%,$(SUBDIRS)) _FASTDEP_ALL_SUB_DIRS="$(SUBDIRS)"
 ifdef CONFIG_MODVERSIONS
 	$(MAKE) update-modverfile
 endif
+	scripts/mkdep -- `find $(FINDHPATH) \( -name SCCS -o -name .svn \) -prune -o -follow -name \*.h ! -name modversions.h -print` > .hdepend
+	scripts/mkdep -- init/*.c > .depend
 
 ifdef CONFIG_MODVERSIONS
 MODVERFILE := $(TOPDIR)/include/linux/modversions.h
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/