Date: Tue, 19 Feb 2008 10:37:38 +0100
From: Pavel Machek <>
Subject: Re: tsc breaks atkbd suspend
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/19/137

Hi!
This is wrong:
#ifdef CONFIG_X86_TSC
static int __init tsc_setup(char *str)
{
        printk(KERN_WARNING "notsc: Kernel compiled with
CONFIG_X86_TSC, "
                                "cannot disable TSC.\n");
        return 1;
}
#else
/*
 * disable flag for tsc. Takes effect by clearing the TSC cpu flag
 * in cpu/common.c
 */
static int __init tsc_setup(char *str)
{
        setup_clear_cpu_cap(X86_FEATURE_TSC);
        return 1;
}
#endif
...even if kernel is compiled with X86_TSC, we do disable it in case
it is unstable:
#if defined (CONFIG_GENERIC_TIME) && defined (CONFIG_X86_TSC)
                /* TSC halts in C2, so notify users */
                if (tsc_halts_in_c(ACPI_STATE_C2))
                        mark_tsc_unstable("possible TSC halt in C2");
#endif
...so the commandline option should work, too.
									Pavel
-- 
(english) 
http://www.livejournal.com/~pavelmachek
(cesky, pictures) 
http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html