Date: Wed, 9 Aug 2000 02:53:01 +0300 (IDT)
From: Dan Aloni <>
Subject: Re: [PATCH] 2.4.0-test6-pre8 - dark vga textmode console problem in RIVA TNT 2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/8/160

On Tue, 8 Aug 2000, Linus Torvalds wrote:
[..]
> > So yes, the patch will fix the problem. But I don't think it's correct.
[..]
> we didn't set the palette when we switched to it) into text mode. We
> should now set the palette on that graphics->textmode switch because it
> was inhibited before by the graphics mode.
> 
> Which this patch does. 
> 
> Does this patch work for you? 
It didn't, unfortunately, but I've seen what you have done there, so I
looked for another call fo unblack_screen(), and made the following patch,
in an addition to yours, and now it works.  
--- linux/drivers/char/vt.c	Wed Aug  9 02:47:26 2000
+++ linux-test5/drivers/char/vt.c	Wed Aug  9 02:35:14 2000
@@ -1200,9 +1200,10 @@
 	 */
 	if (old_vc_mode != vt_cons[new_console]->vc_mode)
 	{
-		if (vt_cons[new_console]->vc_mode == KD_TEXT)
+		if (vt_cons[new_console]->vc_mode == KD_TEXT) {
+			set_palette(new_console);
 			unblank_screen();
-		else
+		} else
 			do_blank_screen(1);
 	}
 
Dan Aloni (dax)
karrde@callisto.yi.org
> --- v2.4.0-test5/linux/drivers/char/vt.c	Thu Jul 27 17:38:00 2000
> +++ linux/drivers/char/vt.c	Tue Aug  8 12:34:18 2000
> @@ -520,9 +520,10 @@
>  		/*
>  		 * explicitly blank/unblank the screen if switching modes
>  		 */
> -		if (arg == KD_TEXT)
> +		if (arg == KD_TEXT) {
> +			set_palette(console);
>  			unblank_screen();
> -		else
> +		} else
>  			do_blank_screen(1);
>  		return 0;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/