Date: Mon, 14 Oct 2002 09:30:47 -0600
From: Stephen Cameron <>
Subject: [PATCH] 2.5.42 cciss partition problem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/14/137

Hmm, this patch didn't seem to make it into 2.5.42.  Without it, or 
something like it, the cciss driver is pretty badly broken.  Without it, 
only partitions on the first disk can be accessed.  If there's something 
wrong with this patch and this problem needs to be fixed in a different way, 
let me know.
-- steve
diff -urN linux-2.5.42/drivers/block/cciss.c linux-2.5.42-a/drivers/block/cciss.c
--- linux-2.5.42/drivers/block/cciss.c	Mon Oct 14 07:54:28 2002
+++ linux-2.5.42-a/drivers/block/cciss.c	Mon Oct 14 08:09:03 2002
@@ -352,7 +352,7 @@
 	 * but I'm already using way to many device nodes to claim another one
 	 * for "raw controller".
 	 */
-	if (inode->i_bdev->bd_inode->i_size == 0) {
+	if (hba[ctlr]->drv[dsk].nr_blocks == 0) {
 		if (minor(inode->i_rdev) != 0)
 			return -ENXIO;
 		if (!capable(CAP_SYS_ADMIN))
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/