Date: Fri, 9 Jul 1999 16:59:25 +0200
From: Jan Kasprzak <>
Subject: [patch] syncppp.c and skb->priority
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/7/9/68

	Alan,
	apply the following patch, please. It seems that in syncppp.c
remained the two skb->priority=1 statements from the Linux 2.0 version.
In 2.2 it causes the keepalive packet to be sent with _lower_ priority
than other packets, which is a Bad Thing(tm) - it causes that kernel
thinks the line is down when there is traffic high enough to delay
or drop MAXALIVECNT or more keepalive packets. With this patch,
keepalive packets are delivered in the normal order and it seems to
improve the syncppp.c behaviour on highly loaded lines.
	Thanks,
-Yenya
Index: syncppp.c
===================================================================
RCS file: /home/kas/home1/CVSROOT/cosa/syncppp.c,v
retrieving revision 1.6
diff -u -r1.6 syncppp.c
--- syncppp.c	1999/06/09 17:01:28	1.6
+++ syncppp.c	1999/07/09 14:54:35
@@ -770,8 +770,6 @@
 		printk (">\n");
 	}
 	sp->obytes += skb->len;
-	/* Control is high priority so it doesnt get queued behind data */
-	skb->priority=1;
 	skb->dev = dev;
 	dev_queue_xmit(skb);
 }
@@ -813,7 +811,6 @@
 			dev->name,  ntohl (ch->type), ch->par1,
 			ch->par2, ch->rel, ch->time0, ch->time1);
 	sp->obytes += skb->len;
-	skb->priority=1;
 	skb->dev = dev;
 	dev_queue_xmit(skb);
 }
-- 
\ Jan "Yenya" Kasprzak <kas at fi.muni.cz>       
http://www.fi.muni.cz/~kas/
\\ PGP: finger kas at aisa.fi.muni.cz   0D99A7FB206605D7 8B35FCDE05B18A5E //
\\\             Czech Linux Homepage:  
http://www.linux.cz/
              ///
The new code base has not stabilized enough yet for benchmarking. Be patient,
we'll be sure to delay NT5's release a bit, trust me...              (DaveM)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/