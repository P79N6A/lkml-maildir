Date: Wed, 20 Oct 1999 18:29:44 +0200 (CEST)
From: Ingo Molnar <>
Subject: [patch] highmem-2.3.23-D1 (was: Re: invalid address for sound DMA-buffer)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/10/20/53

oops, i broke PG_DMA handling. The attached patch should fix it.
-- mingo
--- linux/mm/bootmem.c.orig2	Wed Oct 20 09:20:39 1999
+++ linux/mm/bootmem.c	Wed Oct 20 09:22:40 1999
@@ -16,6 +16,7 @@
 #include <linux/interrupt.h>
 #include <linux/init.h>
 #include <linux/bootmem.h>
+#include <asm/dma.h>
 
 /*
  * Pointer to a bitmap - the bits represent all physical memory pages
@@ -194,6 +195,8 @@
 			count++;
 			ClearPageReserved(page);
 			set_page_count(page, 1);
+			if (i >= (MAX_DMA_ADDRESS >> PAGE_SHIFT))
+				clear_bit(PG_DMA, page);
 			__free_page(page);
 		}
 	}