Date: Tue, 29 Jun 1999 11:07:23 +0100
From: David Howells <>
Subject: Re: Very strange bug in VFS & modules
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/6/29/19

> How do they "say" that?  file checks the status via lstat, (i.e. the
> mode/permission bit), ls tries to do a readdir on a directory.  That
> probably fails because of the i_op zeroness too..
"file" indeed uses some variant of stat (I can't actually remember which).
"ls" gets an error on the open(...,O_DIRECTORY) according to strace. Looking
at the namei routines in the kernel, I'd agree that this is due to i_op==0.
> >   * Examining /proc/kcore shows that the root inode has a NULL i_op value.
>
> That's possibly the same problem...
I'd agree on that too.
> Is the code available?  Is this that ftl filesystem, or I confuse you
> with someone else? :)
Try the devpts filesystem built as a module.
> I'd insert a debugging printk around the routines, mostly in read_inode.
Tried the printk()'s - the only routine it ever executes under these
circumstances is read_inode(), and the printk() at the end shows that i_op is
actually set on returning.
> Do you do proper lock_super/unlock_super pairings?
> MOD_DEC/INC_USE_COUNT?
Yes. Yes. Don't forget the filesystem works perfectly fine on being compiled
into vmlinux.
David Howells
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/