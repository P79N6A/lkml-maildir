Date: Fri, 22 Feb 2008 11:06:13 -0800
From: David Brownell <>
Subject: Re: [spi-devel-general] [PATCH] atmel_spi: support zero length	 transfer
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/22/318

> > If the driver could not handle zero length transfer, then the driver
> > should reject it (just like unsupported transfer mode).  Then the
> > behavior will be 'assert chip select and wait some time' or 'rejected
> > by the driver'.
>
> This would be OK.  It would not be hard to fix pxa2xx_spi, for example,
> to reject zero-length transfers in DMA mode, as long as it is acceptable
> to reject the message in mid-message.
Such "illegal message" rejection is best done early; "fail-fast".
Mid-message rejection isn't wrong, but it's a rude policy.
It'd be best to fix pxa2xx_spi to not start zero-length DMAs.
>	If it were necessary to scan a
> whole message for zero-length transfers and refuse to queue an offending
> message, then that adds burden to all messages.
Sanity checking messages as they're submitted is easy; and it's
also the natural point for setting up DMA mappings (and making
those cachelines available for better use).
- Dave