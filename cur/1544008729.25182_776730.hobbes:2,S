Date: Thu,  4 Dec 2008 10:57:38 +0900 (JST)
From: KOSAKI Motohiro <>
Subject: Re: [PATCH] - support inheritance of mlocks across fork/exec V2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/3/601

> @@ -600,9 +603,15 @@ asmlinkage long sys_mlockall(int flags)
>  	unsigned long lock_limit;
>  	int ret = -EINVAL;
> 
> -	if (!flags || (flags & ~(MCL_CURRENT | MCL_FUTURE)))
> +	if (!(flags & (MCL_CURRENT | MCL_FUTURE)))
>  		goto out;
> 
> +	if (flags & ~(MCL_CURRENT | MCL_FUTURE | MCL_INHERIT | MCL_RECURSIVE))
> +		goto out;	/* undefined flag bits */
> +
> +	if ((flags & (MCL_INHERIT | MCL_RECURSIVE)) == MCL_RECURSIVE)
> +		goto out;	/* 'RECURSIVE undefined without 'INHERIT */
> +
>  	ret = -EPERM;
>  	if (!can_do_mlock())
>  		goto out;
looks good to me.
	Reviewed-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>