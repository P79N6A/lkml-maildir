Date: Fri, 12 May 2006 15:36:27 +0200
From: Ingo Molnar <>
Subject: Re: 3c59x vortex_timer rt hack (was: rt20 patch question)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/12/145

* Steven Rostedt <rostedt@goodmis.org> wrote:
> 
> 
> On Fri, 12 May 2006, Ingo Molnar wrote:
> 
> > --- linux-rt.q.orig/drivers/net/3c59x.c
> > +++ linux-rt.q/drivers/net/3c59x.c
> > @@ -1897,7 +1897,8 @@ vortex_timer(unsigned long data)
> >
> >  	if (vp->medialock)
> >  		goto leave_media_alone;
> > -	disable_irq(dev->irq);
> > +	/* hack! */
> > +	disable_irq_nosync(dev->irq);
> >  	old_window = ioread16(ioaddr + EL3_CMD) >> 13;
> >  	EL3WINDOW(4);
> >  	media_status = ioread16(ioaddr + Wn4_Media);
> 
> BTW, I originally thought about having Mark do this, but I'm nervious 
> about the side effects that this might have.  Basically, it's doing 
> ioreads from the device while the interrupt could be doing iowrites.
yes, that can happen - but since this is a timeout, this is rather 
unlikely in practice. Nevertheless it's possible, so i marked the code a 
hack.
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/