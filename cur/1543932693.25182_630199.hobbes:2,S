Date: Wed, 19 Dec 2007 23:04:33 -0800 (PST)
From: Christoph Lameter <>
Subject: Re: [patch 02/20] make the inode i_mmap_lock a reader/writer lock
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/20/17

> The only reason the x86 ticket locks have the 256 CPu limit is that
> if they go any bigger, we can't use the partial registers so would
> have to have a few more instructions.
x86_64 is going up to 4k or 16k cpus soon for our new hardware.
> A 32 bit spinlock would allow 64K cpus (ticket lock has 2 counters,
> each would be 16 bits). And it would actually shrink the spinlock in
> the case of preempt kernels too (because it would no longer have the
> lockbreak field).
> 
> And yes, I'll go out on a limb and say that 64k CPUs ought to be
> enough for anyone ;)
I think those things need a timeframe applied to it. Thats likely 
going to be true for the next 3 years (optimistic assessment ;-)).
Could you go to 32bit spinlock by default?
How about NUMA awareness for the spinlocks? Larger backoff periods for 
off node lock contentions please.