Date: Tue, 15 Feb 2000 16:56:52 +0300
From: Ivan Kokshaysky <>
Subject: 2.3.45 alpha modules related fixes
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/2/15/54

The most important bit here: pcibios_enable_device() shouldn't
be marked as __init, since it's used for modules.
The rest is mostly compile fixes.
Ivan.
diff -ur 2.3.45/arch/alpha/kernel/alpha_ksyms.c linux/arch/alpha/kernel/alpha_ksyms.c
--- 2.3.45/arch/alpha/kernel/alpha_ksyms.c	Thu Feb 10 07:08:09 2000
+++ linux/arch/alpha/kernel/alpha_ksyms.c	Tue Feb 15 15:39:11 2000
@@ -96,6 +96,13 @@
 EXPORT_SYMBOL(__memsetw);
 EXPORT_SYMBOL(__constant_c_memset);
 
+EXPORT_SYMBOL(pci_alloc_consistent);
+EXPORT_SYMBOL(pci_free_consistent);
+EXPORT_SYMBOL(pci_map_single);
+EXPORT_SYMBOL(pci_unmap_single);
+EXPORT_SYMBOL(pci_map_sg);
+EXPORT_SYMBOL(pci_unmap_sg);
+
 EXPORT_SYMBOL(dump_thread);
 EXPORT_SYMBOL(dump_fpu);
 EXPORT_SYMBOL(hwrpb);
diff -ur 2.3.45/arch/alpha/kernel/pci.c linux/arch/alpha/kernel/pci.c
--- 2.3.45/arch/alpha/kernel/pci.c	Tue Feb  8 07:09:05 2000
+++ linux/arch/alpha/kernel/pci.c	Tue Feb 15 16:08:36 2000
@@ -325,10 +325,9 @@
 	ranges->mem_end -= bus->resource[1]->start;
 }
 
-int __init
-pcibios_enable_device(struct pci_dev *dev)
+int pcibios_enable_device(struct pci_dev *dev)
 {
-	/* Not needed, since we enable all devices at startup.  */
+	/* Nothing to do, since we enable all devices at startup.  */
 	return 0;
 }
 
diff -ur 2.3.45/arch/alpha/kernel/pci_iommu.c linux/arch/alpha/kernel/pci_iommu.c
--- 2.3.45/arch/alpha/kernel/pci_iommu.c	Sun Feb 13 21:15:21 2000
+++ linux/arch/alpha/kernel/pci_iommu.c	Tue Feb 15 15:15:44 2000
@@ -135,7 +135,7 @@
 /* Map a single buffer of the indicate size for PCI DMA in streaming
    mode.  The 32-bit PCI bus mastering address to use is returned.
    Once the device is given the dma address, the device owns this memory
-   until either pci_unmap_single or pci_sync_single is performed.  */
+   until either pci_unmap_single or pci_dma_sync_single is performed.  */
 
 dma_addr_t
 pci_map_single(struct pci_dev *pdev, void *cpu_addr, long size)
diff -ur 2.3.45/include/asm-alpha/pci.h linux/include/asm-alpha/pci.h
--- 2.3.45/include/asm-alpha/pci.h	Tue Feb  8 07:09:05 2000
+++ linux/include/asm-alpha/pci.h	Tue Feb 15 15:14:33 2000
@@ -74,7 +74,7 @@
 /* Map a single buffer of the indicate size for PCI DMA in streaming
    mode.  The 32-bit PCI bus mastering address to use is returned.
    Once the device is given the dma address, the device owns this memory
-   until either pci_unmap_single or pci_sync_single is performed.  */
+   until either pci_unmap_single or pci_dma_sync_single is performed.  */
 
 extern dma_addr_t pci_map_single(struct pci_dev *, void *, long);
 
@@ -118,7 +118,7 @@
    again owns the buffer.  */
 
 extern inline void
-pci_sync_single(struct pci_dev *dev, dma_addr_t dma_addr, long size)
+pci_dma_sync_single(struct pci_dev *dev, dma_addr_t dma_addr, long size)
 {
 	/* Nothing to do.  */
 }
@@ -128,7 +128,7 @@
    for a scatter-gather list, same rules and usage.  */
 
 extern inline void
-pci_sync_sg(struct pci_dev *dev, struct scatterlist *sg, int size)
+pci_dma_sync_sg(struct pci_dev *dev, struct scatterlist *sg, int size)
 {
 	/* Nothing to do.  */
 }
diff -ur 2.3.45/include/asm-alpha/pgalloc.h linux/include/asm-alpha/pgalloc.h
--- 2.3.45/include/asm-alpha/pgalloc.h	Wed Feb  9 05:23:13 2000
+++ linux/include/asm-alpha/pgalloc.h	Mon Feb 14 16:52:50 2000
@@ -10,6 +10,7 @@
 #define flush_cache_page(vma, vmaddr)		do { } while (0)
 #define flush_page_to_ram(page)			do { } while (0)
 #define flush_icache_range(start, end)		do { } while (0)
+#define flush_icache_page(vma, page)		do { } while (0)
 
 /*
  * Use a few helper functions to hide the ugly broken ASN