Date: Wed, 08 Dec 2004 09:30:48 +1100
From: Benjamin Herrenschmidt <>
Subject: Re: [PATCH] PPC64 Close firmware stdin
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/12/7/173

On Tue, 2004-12-07 at 18:15 +0000, Linux Kernel Mailing List wrote:
> ChangeSet 1.2146, 2004/12/07 10:15:41-08:00, paulus@samba.org
> 
> 	[PATCH] PPC64 Close firmware stdin
	.../...
I think you merged that one twice :)
Ben.
> 
> diff -Nru a/arch/ppc64/kernel/prom_init.c b/arch/ppc64/kernel/prom_init.c
> --- a/arch/ppc64/kernel/prom_init.c	2004-12-07 11:04:26 -08:00
> +++ b/arch/ppc64/kernel/prom_init.c	2004-12-07 11:04:26 -08:00
> @@ -1118,6 +1118,16 @@
>  		call_prom("close", 1, 0, val);
>  }
>  
> +static void __init prom_close_stdin(void)
> +{
> +	unsigned long offset = reloc_offset();
> +	struct prom_t *_prom = PTRRELOC(&prom);
> +	ihandle val;
> +
> +	if (prom_getprop(_prom->chosen, "stdin", &val, sizeof(val)) > 0)
> +		call_prom("close", 1, 0, val);
> +}
> +
>  static int __init prom_find_machine_type(void)
>  {
>  	unsigned long offset = reloc_offset();
> @@ -1695,6 +1705,9 @@
>  	 */
>         	prom_printf("copying OF device tree ...\n");
>         	flatten_device_tree();
> +
> +	/* in case stdin is USB and still active on IBM machines... */
> +	prom_close_stdin();
>  
>  	/* in case stdin is USB and still active on IBM machines... */
>  	prom_close_stdin();
> -
> To unsubscribe from this list: send the line "unsubscribe bk-commits-head" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  
http://vger.kernel.org/majordomo-info.html
-- 
Benjamin Herrenschmidt <benh@kernel.crashing.org>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/