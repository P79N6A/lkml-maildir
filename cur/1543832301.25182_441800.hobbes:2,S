Date: Fri, 07 Jul 2006 20:07:51 -0400
From: 	Valdis.Kletnieks@vt ...
Subject: Re: [PATCH] PCIE: create sysfs directory on first use
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/7/396

On Fri, 07 Jul 2006 16:52:38 PDT, "Randy.Dunlap" said:
> @@ -405,11 +410,15 @@ void pcie_port_device_remove(struct pci_
>  void pcie_port_bus_register(void)
>  {
>  	bus_register(&pcie_port_bus_type);
> +	pcie_dev_registered = 1;
Shouldn't this be 'pcie_dev_registered++;'
>  }
> 
>  void pcie_port_bus_unregister(void)
>  {
> -	bus_unregister(&pcie_port_bus_type);
> +	if (pcie_dev_registered) {
> +		bus_unregister(&pcie_port_bus_type);
> +		pcie_dev_registered = 0;
and 'pciedev_registered--;'
> +	}
>  }
to keep it from blowing up if 2 bus get registered, then one de-registered,
and then re-registered again? I could see this happening in a hotplug design?
[unhandled content-type:application/pgp-signature]