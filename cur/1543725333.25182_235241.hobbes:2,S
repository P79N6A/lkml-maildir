Date: Tue, 20 Jul 2004 07:13:53 +0200
From: Vojtech Pavlik <>
Subject: Re: [PATCH][2.4 Backport] x445 usb legacy fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/7/20/5

On Mon, Jul 19, 2004 at 08:06:08PM -0700, Pete Zaitcev wrote:
> The patch looks a little dirty in small places, e.g. the double
> semicolon, the HZ/100 instead of HZ/10, space, two variables
> named "base" in two blocks. I do not believe Vojtech wrote it.
> He must have gotten it from someone else.
Actually I did, but it was a quick cut-and-paste from the USB drivers to
see if it would help with some PS/2 mouse detection problems reported to
me. I never cleaned it up, and it was actually submitted for kernel
inclusion by someone else than me (whose name I unfortunately don't
remember).
> The boot option may be useful, but in the core of the patch looks
> like like a roundabout way to do things. Why don't you trigger
> the meat of the quirk from, say, a DMI scan?
> 
> > +	{ PCI_FIXUP_FINAL,	PCI_ANY_ID,		PCI_ANY_ID,		quirk_usb_disable_smm_bios },
> 
> This looks like a bizzare place to use as a hook. The x400 and x445
> obviously have their own bridges with own IDs (their NUMA cannot
> be using Intel parts, right?). So why don't hook off that?
Actually USB Legacy SMM emulation triggers problems on many many more
systems. The quirk does exactly the same thing the USB HCI drivers do in
their init code, it only does it early in the boot process, so that
even if the USB drivers are modules, the i8042 controller and PS/2 mouse
and keyboard initialization proceeds correctly.
The other options are to compile the HCI drivers into the kernel or to
have i8042 compiled as a module.
> The routines to take ownership look sane from USB HC access
> (not sane from C programming standpoint, as I mentioned above).
> But in any case, it's not something I can decide. Marcelo has that
> power for stock kernels, and for Red Hat kernels there's a process
> which starts with Bugzilla.
-- 
Vojtech Pavlik
SuSE Labs, SuSE CR
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/