Date: Wed, 31 Jan 2007 00:38:02 +1100
From: Nick Piggin <>
Subject: Re: [PATCH] VIA IRQ quirk breakage fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/30/128

Jean Delvare wrote:
> Hi Sergey,
> 
> Le Mardi 30 Janvier 2007 12:47, Sergey Vlasov a Ã©crit :
> 
>>The VT82C686 is very different from other devices, because it is
>>a PCI chip, and its device number is determined by IDSEL wiring.
>>Google shows that several different assignments are in use:
>>
>>00:01.0:
>>
http://ozlabs.org/pipermail/linuxppc-embedded/2005-January/016642.html
>>(but that's PPC)
>>
>>00:04.0: 
http://www.cs.helsinki.fi/linux/linux-kernel/2001-36/0083.html
>>00:05.0: 
http://lkml.org/lkml/2003/12/11/78
>>00:07.0: this example and lots of other links
>>00:14.0: 
http://forum.freespire.org/showthread.php?t=2998
> 
> 
> Ah, OK. Thanks for the exhaustive search and explanation. This explains
> why Alan and Nick disagreed on the device number.
...
> Yes, this sounds like the right thing to do. So here comes the third
> (and hopefully last) iteration of the patch:
Thanks Jean, this patch works fine for me.
Is this 2.6.20 material? Might it cause more regressions than it fixes?
Andrew, can you pick up this patch in place of the old one you got
(fix-via-irq-quirk-breakage.patch). It was sent to lkml just now.
> Fix VIA quirks that were recently broken by Alan Cox in the upstream
> kernel (commit 1597cacbe39802d86656d1f2e6329895bd2ef531).
> 
> My understanding is that pci_find_present() doesn't work yet at the
> time the quirks are run. So I used a two-step quirk as is done for
> some other quirks already. First we detect the VIA south bridges
> and set the right low and high device limits, then we are ready to
> actually run the quirks on the affected devices.
> 
> Signed-off-by: Jean Delvare <jdelvare@suse.de>
> Acked-by: Alan Cox <alan@redhat.com>
> ---
>  drivers/pci/quirks.c |   80 +++++++++++++++++++++++++++-----------------------
>  1 files changed, 44 insertions(+), 36 deletions(-)
-- 
SUSE Labs, Novell Inc.
Send instant messages to your online friends 
http://au.messenger.yahoo.com
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/