Date: Sun, 19 Sep 2004 23:39:52 +0200
From: Francois Romieu <>
Subject: Re: 2.6.9-rc1-bk11+ and 2.6.9-rc1-mm3,4 r8169: freeze during boot (FIX included)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/19/109

Andy Lutomirski <luto@myrealbox.com> :
[...]
> FWIW, it looks like init_board is setting PCIDAC in tp->cp_cmd but that 
> isn't updated to the card until after the rx ring is filled in 
> r8169_open.  This seems suspicious, since DMA memory is being allocated 
> possibly in >32-bit addresses but the card hasn't been told to support 
> that.  Fixing this doesn't seem to help, though...
rtl8169_hw_start() writes the CPlusCmd register before the ring descriptor
adresses are set. Can you elaborate why it would not be enough ?
Btw the r8169 driver in 2.6.9-rcX does not advertise NETIF_F_HIGHDMA: where
would a >32 bit address come from ?
> Turning off high DMA fixes it.  Maybe it just needs to be disabled until 
> someone figures out what's going on.
I am cooking a patch for it (+ check for PCI error).
As a side note, the r8169 chipset does not like DAC to be enabled on a
32bit system. I got the usual PCI error reported while trying it.
--
Ueimor
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/