Date: Sat, 6 Jan 2007 21:32:03 +0100 (MET)
From: Mikael Pettersson <>
Subject: [PATCH libata #promise-sata-pata] sata_promise: 2037x PATAPI support
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/6/133

This patch adds ATAPI support for the PATA port on Promise 2037x chips.
It depends on the common sata_promise ATAPI support patch.
First-generation chips don't support ATAPI on their SATA ports, so
the patch removes ATA_FLAG_NO_ATAPI from the 2037x common host flags,
and adds it back via the _port_flags[] entries for the SATA ports.
Signed-off-by: Mikael Pettersson <mikpe@it.uu.se>
--- linux-2.6.20-rc3/drivers/ata/sata_promise.c.~1~	2007-01-06 17:10:56.000000000 +0100
+++ linux-2.6.20-rc3/drivers/ata/sata_promise.c	2007-01-06 17:14:23.000000000 +0100
@@ -187,7 +187,7 @@ static const struct ata_port_info pdc_po
 	/* board_2037x */
 	{
 		.sht		= &pdc_ata_sht,
-		.flags		= PDC_COMMON_FLAGS | ATA_FLAG_NO_ATAPI /* | ATA_FLAG_SATA */,
+		.flags		= PDC_COMMON_FLAGS /* | ATA_FLAG_NO_ATAPI | ATA_FLAG_SATA */,
 		.pio_mask	= 0x1f, /* pio0-4 */
 		.mwdma_mask	= 0x07, /* mwdma0-2 */
 		.udma_mask	= 0x7f, /* udma0-6 ; FIXME */
@@ -996,6 +996,10 @@ static int pdc_ata_init_one (struct pci_
        			probe_ent->n_ports = 2;
 		probe_ent->_port_flags[0] = ATA_FLAG_SATA;
 		probe_ent->_port_flags[1] = ATA_FLAG_SATA;
+		if (board_idx == board_2037x) {
+			probe_ent->_port_flags[0] |= ATA_FLAG_NO_ATAPI;
+			probe_ent->_port_flags[1] |= ATA_FLAG_NO_ATAPI;
+		}
 		break;
 	case board_20619:
 		probe_ent->n_ports = 4;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/