Date: Wed, 11 Apr 2007 14:26:43 +0200
From: Eric Dumazet <>
Subject: Re: Performance Stats: Kernel patch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/4/11/156

On Wed, 11 Apr 2007 15:59:16 +0400
Maxim Uvarov <muvarov@ru.mvista.com> wrote:
> Thanks Eric, I's really better. I have done changes. Do you have any 
> others objections now?
> All is in attached perf_stat.patch.
Hi Maxim
I know *nothing* about powerpc assembly, but I think there is a problem :
Index: linux-2.6.21-rc5/arch/powerpc/kernel/entry_64.S
===================================================================
--- linux-2.6.21-rc5.orig/arch/powerpc/kernel/entry_64.S
+++ linux-2.6.21-rc5/arch/powerpc/kernel/entry_64.S
@@ -115,6 +115,11 @@ END_FW_FTR_SECTION_IFSET(FW_FEATURE_ISER
 	addi	r9,r1,STACK_FRAME_OVERHEAD
 #endif
 	clrrdi	r11,r1,THREAD_SHIFT
+#ifdef CONFIG_THREAD_PERF_STAT_SYSC
+	lwz r10,TI_SYSC_CNT(r11)
+	addi r10,r10,1
+	stw r10,TI_SYSC_CNT(r11)
+#endif /* CONFIG_THREAD_PERF_STAT_SYSC */
 	ld	r10,TI_FLAGS(r11)
 	andi.	r11,r10,_TIF_SYSCALL_T_OR_A
 	bne-	syscall_dotrace
sysc_cnt being an 'unsigned long', its a 64 bits long integer...
So you probably need ld/std instructions instead of lwz/stw
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/