Date: Thu, 18 Nov 2004 04:02:02 +0100
From: Mathieu Segaud <>
Subject: Re: [2.6.10-rc2-mm1] OOPS on boot (hotplug related?)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/11/17/376

Mathieu Segaud <matt@minas-morgul.org> disait derniÃ¨rement que :
> V. Saveliev provided the right fix shortly after I reported this oops.
>
> I attach the patch
>
> Regards,
correcting myself, the patch I gave was to apply in fs/reiser4...
by the way, thanks go to Vladimir Saveliev.
--- a/fs/reiser4/plugin/file/file.c	2004-11-17 09:36:11 +03:00
+++ b/fs/reiser4/plugin/file/file.c	2004-11-17 09:36:11 +03:00
@@ -1961,8 +1961,10 @@
 {
 	struct page *page;
 	struct inode *inode;
-
+	reiser4_context ctx;
+	
 	inode = area->vm_file->f_dentry->d_inode;
+	init_context(&ctx, inode->i_sb);
 
 	/* block filemap_nopage if copy on capture is processing with a node of this file */
 	down_read(&reiser4_inode_data(inode)->coc_sem);
@@ -1972,6 +1974,8 @@
 
 	drop_nonexclusive_access(unix_file_inode_data(inode));
 	up_read(&reiser4_inode_data(inode)->coc_sem);
+
+	reiser4_exit_context(&ctx);
 	return page;
 }
 
-- 
"Just wait. My crystal ball is infallible."
	- Linus Torvalds