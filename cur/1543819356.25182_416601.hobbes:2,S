Date: Tue, 18 Apr 2006 09:32:18 -0700
From: "James Ausmus" <>
Subject: Re: [PATCH 1/1] ide: Allow disabling of UDMA for Compact Flash devices
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/18/157

On 4/18/06, Alan Cox <alan@lxorguk.ukuu.org.uk> wrote:
> On Maw, 2006-04-18 at 13:34 +0200, Andreas Mohr wrote:
> > However, while this is much better than a compile-time setting, it's still
> > not fully satisfying since many users won't realize that they're hitting this
> > problem and thus won't search for and find this obscure boot parameter.
> > Is there any way at all to get this condition detected automatically?
>
> Not that I can think off immediately. The controller and the drive both
> report the modes they support. If that is wrong then we either need to
> be able to identify the specific device (as libata does with the Palmax
> systems) or try it and see (which we indeed do but takes time to error
> out).
>
> For PCMCIA CF adapters we are ok because they are ISA bus so PIO 0
> cycles are all that are supported. For other controllers it will depend
> whether the CF adapter is integrated into a PCI card with unique
> subvendor/dev identifiers which can be blacklisted, or a motherboard
> with DMI entries that can be used.
>
> If it's just some poorly engineered 'shove a cable in one end and a CF
> card the other' device which is therefore not directly detectable I
> think you lose.
>
This is exactly the situation that I have with 2 separate "dumb" (just
physical interfaces, essentially - not at all detectable) IDE->CF
adapters - both the IDE controller and the CF media support several
UDMA modes, so the IDE driver throws the CF device into UDMA mode on
bootup. However, as the physical interface between the IDE cable and
the CF socket is poorly engineered, it cannot handle the higher
speeds, causing the timeout errors. For some people, this can just be
fixed with an ide=nodma boot option, but as I also have a (quite
large) rotating media device on the controller, this is not an option,
as, if a fsck is performed on a boot, the boot-up time is upwards of
30 minutes.
I would be happy to look into making this a boot option - but my
project schedule won't allow for the kind of time for me to figure out
how to do that :), so this is just a quick hack that works for my
situation.
-James
> Alan
>
>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/