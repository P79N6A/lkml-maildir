Date: Mon, 29 Nov 2004 19:47:18 +0900
From: Takao Indoh <>
Subject: [ANNOUNCE 6/7] Diskdump 1.0 Release
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/11/29/33

This is a patch for sym53c8xx driver.
diff -Nur linux-2.6.9.org/drivers/scsi/sym53c8xx_2/sym_glue.c linux-2.6.9/drivers/scsi/sym53c8xx_2/sym_glue.c
--- linux-2.6.9.org/drivers/scsi/sym53c8xx_2/sym_glue.c	2004-10-19 06:55:36.000000000 +0900
+++ linux-2.6.9/drivers/scsi/sym53c8xx_2/sym_glue.c	2004-11-24 19:24:09.903045793 +0900
@@ -956,6 +956,28 @@
 	return sym_eh_handler(SYM_EH_HOST_RESET, "HOST RESET", cmd);
 }
 
+#if defined(CONFIG_SCSI_DUMP) || defined(CONFIG_SCSI_DUMP_MODULE)
+static int sym53c8xx_sanity_check_handler(struct scsi_device *sd)
+{
+	struct sym_hcb *np = ((struct host_data *)sd->host->hostdata)->ncb;
+
+	if (np == NULL)
+		return -ENXIO;
+
+	del_timer(&np->s.timer);
+	add_timer_on(&np->s.timer, smp_processor_id());
+
+	return 0;
+}
+
+static void sym53c8xx_poll_handler(struct scsi_device *sd)
+{
+	struct sym_hcb *np = ((struct host_data *)sd->host->hostdata)->ncb;
+
+	sym_interrupt(np);
+}
+#endif
+
 /*
  *  Tune device queuing depth, according to various limits.
  */
@@ -2231,6 +2253,10 @@
 	.eh_device_reset_handler = sym53c8xx_eh_device_reset_handler,
 	.eh_bus_reset_handler	= sym53c8xx_eh_bus_reset_handler,
 	.eh_host_reset_handler	= sym53c8xx_eh_host_reset_handler,
+#if defined(CONFIG_SCSI_DUMP) || defined(CONFIG_SCSI_DUMP_MODULE)
+	.dump_sanity_check	= sym53c8xx_sanity_check_handler,
+	.dump_poll		= sym53c8xx_poll_handler,
+#endif
 	.this_id		= 7,
 	.use_clustering		= DISABLE_CLUSTERING,
 #ifdef SYM_LINUX_PROC_INFO_SUPPORT
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/