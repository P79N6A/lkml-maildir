Date: Wed, 07 Dec 2005 09:01:19 -0500
From: Peter Staubach <>
Subject: Re: another nfs puzzle
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/7/131

Kenny Simpson wrote:
>Hi again,
>  I am seeing some odd behavior with O_DIRECT.  If a file opened with O_DIRECT has a page mmap'd,
>and the file is extended via pwrite, then the mmap'd region seems to get lost - i.e. it neither
>takes up system memory, nor does it get written out.
> 
>
I don't think that I understand why or how the kernel allows a file,
which was opened with O_DIRECT, to be mmap'd.  The use of O_DIRECT
implies no caching and mmap implies the use of caching.
I do understand that the kernel can flush and invalidate pages in
the ranges of the i/o operations done, but does it really guarantee
that a pagein operation won't happen on a page within the range of
a region of the file being written to using direct i/o?  If it does
not, then any consistency guarantees are gone and data corruption
can occur.
    Thanx...
       ps
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/