Date: Fri, 05 Oct 2007 10:22:38 -0600
From: Zan Lynx <>
Subject: Re: [patch] reiser4: do not allocate struct file on stack
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/5/158

On Fri, 2007-10-05 at 03:22 +0400, Edward Shishkin wrote:
> Edward Shishkin wrote:
> 
> > Dave Hansen wrote:
> >
> ...
> 
> >>
> >> I think that stack allocation is a pretty nasty trick for a structure
> >> that's supposed to be pretty persistent and dynamically allocated, and
> >> is certainly something that needs to get fixed up in a proper way.
> >>
> >>
> >
> > agreed.
> >
> >> This works around the problem for now, but this could potentially cause
> >> more bugs any time we add some member to 'struct file' and depend on its
> >> state being sane anywhere in the VFS. If there's a list anywhere of
> >> merge-stopper reiser4 bugs around, this should probably go in there.
> >>
> >>
> >
> > will be fixed.
> >
> 
> The promised fixup is attached.
> Andrew, please apply.
> 
> Thanks,
> Edward.
There were several copies of this email, so I picked one. :)
I had the crash with 2.6.23-rc8-mm2, so I applied this patch.  Hunk #1
failed, the rest applied with fuzz.  I manually applied hunk #1 and
recompiled.
I am now running with 2.6.23-rc8-mm2 + this patch and things seem good.
(Except for some issues with ACPI battery info moving out of proc and
confusing the heck out of HAL and the GNOME power management scripts).
-- 
Zan Lynx <zlynx@acm.org>
[unhandled content-type:application/pgp-signature]