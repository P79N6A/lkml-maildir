Date: Fri, 22 Jan 1999 22:41:21 +0100
From: Gerhard Fuellgrabe <>
Subject: Re: [patch] parport problems
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/22/315

Tim Waugh wrote:
> 
> On Fri, 22 Jan 1999, Gerhard Fuellgrabe wrote:
> 
> > dogmatix:/usr/src/linux/Documentation # /sbin/init.d/lpd start
> >
> > Starting lpdPLP lpd-daemon, version 4.1.2
> 
> strace this process.  Find out why it dies.
After starting the lpd I can find with ps aux:
root      1368  0.0  0.5  1348   696  ?  S    22:18   0:00 lpd:
accepting connections
but
lp:
        queuing is enabled
        printing is enabled
        1 entry in spool area
        no daemon present
Trying to print something:
Jan 22 22:35:12 dogmatix kernel: parport0: PC-style at 0x378, irq 7
[SPP,ECP,ECPEPP,ECPPS2]
Jan 22 22:35:12 dogmatix kernel: parport0: no IEEE-1284 device present.
Jan 22 22:35:12 dogmatix kernel: lp0: using parport0 (interrupt-driven).
Jan 22 22:35:12 dogmatix lpd[1428]: local_dojob: lp: printing job 45 for
root@dogmatix.fuenet, 2818 bytes
Jan 22 22:35:12 dogmatix lpd[1428]: lp: 1 copy of /etc/hosts, 2818 bytes
Jan 22 22:35:13 dogmatix lpd[1428]: local_dojob: lp: printing job 46 for
root@dogmatix.fuenet, 2818 bytes
Jan 22 22:35:13 dogmatix lpd[1428]: lp: 1 copy of /etc/hosts, 2818 bytes
In /var/spool/lpd/lj4l-a4-auto-mono-300/log:
[Total: 1 page on 1 sheet]
%%[ Error: invalidfileaccess; OffendingCommand: .outputpage ]%%
Unexpected interpreter error -9.
Error object: (f80)op(342:.outputpage)0x80847bc
Operand stack at 0x81542a0:
0x8157a74: 0x0b int  --F------ 0x001c 0x00000001 = 1
0x8157a7c: 0x01 bool --F------ 0x0000 0x08120001 = true
Execution stack at 0x8154300:
0x81593dc: 0x0f oper --F---e-- 0x0000 0x08070664 = %interp_exit
0x81593e4: 0x12 str  --F-rxe-- 0x0000 0x00000000 =
0x81593ec: 0x03 file --L-rxe-- 0x0001 0x08188678
0x81593f4: 0x0e null --F---e-- 0x0000 0x0807b114
0x81593fc: 0x03 file --S-rxe-- 0x0001 0x0815d3a8
0x8159404: 0x0f oper --F---e-- 0x0000 0x0807b0d0 = %runexec_finish
0x815940c: 0x03 file --S-rxe-- 0x0001 0x0815d3a8
0x8159414: 0x05 mpry --G-rxe-- 0x0002 0x0817ab06
0x815941c: 0x05 mpry --G-rxe-- 0x0003 0x0817aaec
0x8159424: 0x05 mpry --G-rxe-- 0x0039 0x0817b172
Dictionary stack at 0x8154200:
0x8159c0c: 0x02 dict --Gwrx--- 0x0000 0x0816dddc
0x8159c14: 0x02 dict --Gwrx--- 0x0000 0x081c16f8
0x8159c1c: 0x02 dict --Lwrx--- 0x0000 0x081866c0
0x8159c24: 0x02 dict --Lwrx--- 0x0000 0x0818890c
> 
> > options parport        io=0x378 irq=7
> I think you meant:
> 
> options parport_pc io=0x378 irq=7
Sorry, a typo :-(
Regards,
Gerry
-- 
Gerhard Fuellgrabe            Phone: +49.5323.96788   Fax: 962044
Arnikaweg 34                  E-mail:      gerd@cacofonix.harz.de
D-38678 Clausthal-Zellerfeld  Ham-Radio: DK3NZ@DB0NHM.#NDS.DEU.EU
http://www.harz.de/home/fuellgrabe
execve("/usr/bin/lpd", ["/usr/bin/lpd"], [/* 44 vars */]) = 0
brk(0)                                  = 0x809f864
open("/etc/ld.so.preload", O_RDONLY)    = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY)      = 3
fstat(3, {st_mode=0, st_size=0, ...})   = 0
mmap(0, 29284, PROT_READ, MAP_PRIVATE, 3, 0) = 0x4000d000
close(3)                                = 0
open("/lib/libresolv.so.2", O_RDONLY)   = 3
mmap(0, 4096, PROT_READ, MAP_PRIVATE, 3, 0) = 0x40015000
munmap(0x40015000, 4096)                = 0
mmap(0, 63688, PROT_READ|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x40015000
mprotect(0x40021000, 14536, PROT_NONE)  = 0
mmap(0x40021000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 3, 0xb000) = 0x40021000
mmap(0x40023000, 6344, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x40023000
close(3)                                = 0
open("/lib/libnsl.so.1", O_RDONLY)      = 3
mmap(0, 4096, PROT_READ, MAP_PRIVATE, 3, 0) = 0x40025000
munmap(0x40025000, 4096)                = 0
mmap(0, 26788, PROT_READ|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x40025000
mprotect(0x4002b000, 2212, PROT_NONE)   = 0
mmap(0x4002b000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 3, 0x5000) = 0x4002b000
close(3)                                = 0
open("/lib/libc.so.6", O_RDONLY)        = 3
mmap(0, 4096, PROT_READ, MAP_PRIVATE, 3, 0) = 0x4002c000
munmap(0x4002c000, 4096)                = 0
mmap(0, 706992, PROT_READ|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x4002c000
mprotect(0x400c6000, 76208, PROT_NONE)  = 0
mmap(0x400c6000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 3, 0x99000) = 0x400c6000
mmap(0x400cc000, 51632, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x400cc000
close(3)                                = 0
munmap(0x4000d000, 29284)               = 0
personality(PER_LINUX)                  = 0
getpid()                                = 1380
getuid()                                = 0
geteuid()                               = 0
setreuid(0, 0)                          = 0
brk(0)                                  = 0x809f864
brk(0x809f884)                          = 0x809f884
brk(0x80a0000)                          = 0x80a0000
getrlimit(RLIMIT_NOFILE, {rlim_cur=1024, rlim_max=1024}) = 0
close(3)                                = -1 EBADF (Bad file descriptor)
getrlimit(RLIMIT_NOFILE, {rlim_cur=1024, rlim_max=1024}) = 0
close(4)                                = -1 EBADF (Bad file descriptor)
[...]
getrlimit(RLIMIT_NOFILE, {rlim_cur=1024, rlim_max=1024}) = 0
close(1023)                             = -1 EBADF (Bad file descriptor)
getrlimit(RLIMIT_NOFILE, {rlim_cur=1024, rlim_max=1024}) = 0
open("/dev/null", O_RDWR)               = 3
close(3)                                = 0
umask(077)                              = 022
sigaction(SIGCHLD, {0x8063220, [], SA_STACK|0x494b6}, {SIG_DFL}) = 0
open("/etc/plp.conf", O_RDONLY)         = 3
fstat(3, {st_mode=0, st_size=0, ...})   = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000d000
read(3, "architecture linux\nuser lp\nfil"..., 4096) = 195
read(3, "", 4096)                       = 0
close(3)                                = 0
munmap(0x4000d000, 4096)                = 0
open("/etc/nsswitch.conf", O_RDONLY)    = 3
brk(0x80a1000)                          = 0x80a1000
fstat(3, {st_mode=0, st_size=0, ...})   = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000d000
read(3, "passwd: db files nis\nshadow: db"..., 4096) = 306
read(3, "", 4096)                       = 0
close(3)                                = 0
munmap(0x4000d000, 4096)                = 0
open("/etc/ld.so.cache", O_RDONLY)      = 3
fstat(3, {st_mode=0, st_size=0, ...})   = 0
mmap(0, 29284, PROT_READ, MAP_PRIVATE, 3, 0) = 0x4000d000
close(3)                                = 0
open("/lib/libnss_db.so.1", O_RDONLY)   = 3
mmap(0, 4096, PROT_READ, MAP_PRIVATE, 3, 0) = 0x400d9000
munmap(0x400d9000, 4096)                = 0
mmap(0, 24496, PROT_READ|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x400d9000
mprotect(0x400de000, 4016, PROT_NONE)   = 0
mmap(0x400de000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 3, 0x4000) = 0x400de000
close(3)                                = 0
open("/lib/libdb.so.2", O_RDONLY)       = 3
mmap(0, 4096, PROT_READ, MAP_PRIVATE, 3, 0) = 0x400df000
munmap(0x400df000, 4096)                = 0
mmap(0, 63940, PROT_READ|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x400df000
mprotect(0x400ee000, 2500, PROT_NONE)   = 0
mmap(0x400ee000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 3, 0xe000) = 0x400ee000
close(3)                                = 0
open("/lib/libnss_files.so.1", O_RDONLY) = 3
mmap(0, 4096, PROT_READ, MAP_PRIVATE, 3, 0) = 0x400ef000
munmap(0x400ef000, 4096)                = 0
mmap(0, 37924, PROT_READ|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x400ef000
mprotect(0x400f8000, 1060, PROT_NONE)   = 0
mmap(0x400f8000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 3, 0x8000) = 0x400f8000
close(3)                                = 0
munmap(0x4000d000, 29284)               = 0
open("/var/db/passwd.db", O_RDONLY)     = -1 ENOENT (No such file or directory)
open("/etc/passwd", O_RDONLY)           = 3
fcntl(3, F_GETFD)                       = 0
fcntl(3, F_SETFD, FD_CLOEXEC)           = 0
fstat(3, {st_mode=0, st_size=0, ...})   = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000d000
read(3, "root:x:0:0:root:/root:/bin/bash\n"..., 4096) = 1600
close(3)                                = 0
munmap(0x4000d000, 4096)                = 0
brk(0x80a2000)                          = 0x80a2000
open("/var/db/group.db", O_RDONLY)      = -1 ENOENT (No such file or directory)
open("/etc/group", O_RDONLY)            = 3
fcntl(3, F_GETFD)                       = 0
fcntl(3, F_SETFD, FD_CLOEXEC)           = 0
fstat(3, {st_mode=0, st_size=0, ...})   = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000d000
read(3, "root:x:0:root\nbin:x:1:root,bin,"..., 4096) = 475
close(3)                                = 0
munmap(0x4000d000, 4096)                = 0
uname({sys="Linux", node="dogmatix", ...}) = 0
gettimeofday({917039979, 809112}, NULL) = 0
getpid()                                = 1380
open("/etc/resolv.conf", O_RDONLY)      = 3
fstat(3, {st_mode=S_ISVTX|070, st_size=0, ...}) = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000d000
read(3, "#\n# /etc/resolv.conf\n#\n# Auto"..., 4096) = 265
read(3, "", 4096)                       = 0
close(3)                                = 0
munmap(0x4000d000, 4096)                = 0
open("/etc/hosts", O_RDONLY)            = 3
fcntl(3, F_GETFD)                       = 0
fcntl(3, F_SETFD, FD_CLOEXEC)           = 0
fstat(3, {st_mode=S_ISVTX|050, st_size=0, ...}) = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000d000
read(3, "#\n# hosts\t\tThis file describe"..., 4096) = 2818
close(3)                                = 0
munmap(0x4000d000, 4096)                = 0
sigaction(SIGPIPE, {SIG_IGN}, {SIG_DFL}) = 0
sigaction(SIGHUP, {0x804f280, [], SA_STACK|0x8341c}, {SIG_DFL}) = 0
sigaction(SIGINT, {0x804edc0, [], SA_STACK|0x494b6}, {SIG_DFL}) = 0
sigaction(SIGQUIT, {0x804edc0, [], SA_NOMASK|0x4bd6}, {SIG_DFL}) = 0
sigaction(SIGTERM, {0x804edc0, [], SA_NOMASK|0x340e0}, {SIG_DFL}) = 0
fstat(1, {st_mode=S_ISVTX|0410, st_size=0, ...}) = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000d000
ioctl(1, TCGETS, {B9600 opost isig icanon echo ...}) = 0
write(1, "PLP lpd-daemon, version 4.1.2\n", 30) = 30
time(NULL)                              = 917039979
open("/var/spool/lpd/lock.dogmatix", O_RDWR|O_CREAT, 0644) = 3
fcntl(3, F_GETFL)                       = 0x2 (flags O_RDWR)
fstat(3, {st_mode=0, st_size=0, ...})   = 0
mmap(0, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4000e000
lseek(3, 0, SEEK_CUR)                   = 0
fstat(3, {st_mode=0, st_size=0, ...})   = 0
read(3, "1368\nJan 22 22:18:10\n", 4096) = 21
fcntl(3, F_SETLK, {type=F_WRLCK, whence=SEEK_SET, start=0, len=0}) = -1 EAGAIN (Resource temporarily unavailable)
close(3)                                = 0
munmap(0x4000e000, 4096)                = 0
write(1, "Active PLP lpd, pid 1368\n", 25) = 25
munmap(0x4000d000, 4096)                = 0
_exit(1)                                = ?