Date: Thu, 3 Jun 2004 22:17:04 +1000
From: Herbert Xu <>
Subject: [CPUFREQ] Make powernow-k7 work with CONFIG_ACPI_PROCESSOR == m
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/6/3/82

Hi:
The last round of updates to powernow-k7.c broke it when
CONFIG_ACPI_PROCESSOR is built as a module.  This patch
fixes that.
Cheers,
-- 
Visit Openswan at 
http://www.openswan.org/
Email:  Herbert Xu 许志壬 <herbert@gondor.apana.org.au>
Home Page: 
http://gondor.apana.org.au/herbert/
PGP Key: 
http://gondor.apana.org.au/herbert/pubkey.txt
===== arch/i386/kernel/cpu/cpufreq/powernow-k7.c 1.51 vs edited =====
--- 1.51/arch/i386/kernel/cpu/cpufreq/powernow-k7.c	2004-05-08 00:34:07 +10:00
+++ edited/arch/i386/kernel/cpu/cpufreq/powernow-k7.c	2004-06-03 22:11:08 +10:00
@@ -28,7 +28,7 @@
 #include <asm/io.h>
 #include <asm/system.h>
 
-#ifdef CONFIG_ACPI_PROCESSOR
+#if defined(CONFIG_ACPI_PROCESSOR) || defined(CONFIG_ACPI_PROCESSOR_MODULE)
 #include <linux/acpi.h>
 #include <acpi/processor.h>
 #endif
@@ -63,7 +63,7 @@
 	u8 numpstates;
 };
 
-#ifdef CONFIG_ACPI_PROCESSOR
+#if defined(CONFIG_ACPI_PROCESSOR) || defined(CONFIG_ACPI_PROCESSOR_MODULE)
 union powernow_acpi_control_t {
 	struct {
 		unsigned long fid:5,
@@ -293,7 +293,7 @@
 }
 
 
-#ifdef CONFIG_ACPI_PROCESSOR
+#if defined(CONFIG_ACPI_PROCESSOR) || defined(CONFIG_ACPI_PROCESSOR_MODULE)
 
 struct acpi_processor_performance *acpi_processor_perf;
 
@@ -642,7 +642,7 @@
 
 static void __exit powernow_exit (void)
 {
-#ifdef CONFIG_ACPI_PROCESSOR
+#if defined(CONFIG_ACPI_PROCESSOR) || defined(CONFIG_ACPI_PROCESSOR_MODULE)
 	if (acpi_processor_perf) {
 		acpi_processor_unregister_performance(acpi_processor_perf, 0);
 		kfree(acpi_processor_perf);