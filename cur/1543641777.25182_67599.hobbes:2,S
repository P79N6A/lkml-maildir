Date: Sun, 1 Sep 2002 16:10:01 +0200
From: Trond Myklebust <>
Subject: Re: [PATCH] Initial support for struct vfs_cred   [0/1]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/9/1/48

>>>>> " " == Trond Myklebust <trond.myklebust@fys.uio.no> writes:
>>>>> " " == Luca Barbieri <ldb@ldb.ods.org> writes:
    >> For example, rather than this;
     > <snip>
    >> you can just do this:
    >> - uid_t saved_fsuid = current->fsuid;
    >> + uid_t saved_fsuid = current->fscred.uid;
    >> kernel_cap_t saved_cap =
    current-> cap_effective;
 
     > But I don't want to have to do that at all. Why should I change
Just to follow up on why the above 'optimization' is just plain wrong.
You are forgetting that the fscred might simultaneously be referenced
by an open struct file. Are you saying that this file should suddenly
see its credential change?
The alternative without copy on write is to make a full copy of the
fscred every time we open a file or schedule some form of asynchronous
I/O, and hence need to cache the current VFS credentials.
The copy-on-write rule is there in order to *minimize* the need to
copy the cred. It works because changing the cred's entries is
supposed to be a *rare* occurrence, whereas taking references and
reading are common.
Cheers,
  Trond
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/