Date: Thu, 13 Jan 2000 21:55:47 +0100
From: Artur Skawina <>
Subject: [PATCH] drivers/net/tlan.c remaining HZ assumptions
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/1/14/112

while 2.3.39 has some fixes, it also introduces a new problem
("50/(1000/HZ)" isn't exactly ideal), plus a few other changes.
diff -urNp /img/linux-2.3.40pre1/drivers/net/tlan.c linux-2.3.40pre1as/drivers/net/tlan.c
--- /img/linux-2.3.40pre1/drivers/net/tlan.c	Thu Jan 13 18:11:18 2000
+++ linux-2.3.40pre1as/drivers/net/tlan.c	Thu Jan 13 18:55:09 2000
@@ -2042,7 +2042,7 @@ TLan_FinishReset( struct net_device *dev
 		outl( TLAN_HC_GO | TLAN_HC_RT, dev->base_addr + TLAN_HOST_CMD );
 	} else {
 		printk( "TLAN:  %s: Link inactive, will retry in 10 secs...\n", dev->name );
-		TLan_SetTimer( dev, 1000, TLAN_TIMER_FINISH_RESET );
+		TLan_SetTimer( dev, 10*HZ, TLAN_TIMER_FINISH_RESET );
 		return;
 	}
 
@@ -2228,7 +2228,7 @@ void TLan_PhyPowerDown( struct net_devic
 	 * This is abitrary.  It is intended to make sure the
 	 * tranceiver settles.
 	 */
-	TLan_SetTimer( dev, (50/(1000/HZ)), TLAN_TIMER_PHY_PUP );
+	TLan_SetTimer( dev, HZ/20, TLAN_TIMER_PHY_PUP );
 
 } /* TLan_PhyPowerDown */
 
@@ -2334,7 +2334,7 @@ void TLan_PhyStartLink( struct net_devic
 		priv->phyNum = 0;
 		data = TLAN_NET_CFG_1FRAG | TLAN_NET_CFG_1CHAN | TLAN_NET_CFG_PHY_EN;
 		TLan_DioWrite16( dev->base_addr, TLAN_NET_CONFIG, data );
-		TLan_SetTimer( dev, 4, TLAN_TIMER_PHY_PDOWN );
+		TLan_SetTimer( dev, 4*HZ/100, TLAN_TIMER_PHY_PDOWN );
 		return;
 	} else if ( priv->phyNum == 0 ) {
         	TLan_MiiReadReg( dev, phy, TLAN_TLPHY_CTL, &tctl );
@@ -2401,7 +2401,7 @@ void TLan_PhyFinishAutoNeg( struct net_d
 		priv->phyNum = 0;
 		data = TLAN_NET_CFG_1FRAG | TLAN_NET_CFG_1CHAN | TLAN_NET_CFG_PHY_EN;
 		TLan_DioWrite16( dev->base_addr, TLAN_NET_CONFIG, data );
-		TLan_SetTimer( dev, 40, TLAN_TIMER_PHY_PDOWN );
+		TLan_SetTimer( dev, 40*HZ/100, TLAN_TIMER_PHY_PDOWN );
 		return;
 	}
 