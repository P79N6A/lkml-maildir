Date: Wed, 3 Mar 2004 11:57:44 -0500
From: Jes Sorensen <>
Subject: [patch] 2.6.4-rc1-mm2 page_alloc on NUMA
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/3/3/140

Hi Andrew,
I need the following to compile page_alloc.c on a NUMA box. I can't say
if it's a perfect patch though as I am seeing other strange things with
.4-rc1-mm2 but this at least got it compiled and booted.
Problem is that a cpumask_t can be an array so just doing
if (cpumask_t) doesn't work.
Cheers,
Jes
--- linux-2.6.4-rc1-mm2/mm/page_alloc.c~	Wed Mar  3 06:47:37 2004
+++ linux-2.6.4-rc1-mm2/mm/page_alloc.c	Wed Mar  3 07:55:29 2004
@@ -1166,7 +1166,7 @@
 		val = node_distance(node, n);
 
 		/* Give preference to headless and unused nodes */
-		if (node_to_cpumask(n))
+		if (!cpus_empty(node_to_cpumask(n)))
 			val += PENALTY_FOR_NODE_WITH_CPUS;
 
 		/* Slight preference for less loaded node */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/