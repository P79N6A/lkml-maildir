Date: 30 Mar 2003 17:03:07 +0200
From: Felipe Alfaro Solana <>
Subject: 2.5: Can't unmount fs after using NFS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/3/30/28

Hi,
Since I started testing 2.5 on my NFS server, I'm having problems
unmounting filesystems that were exported by NFS (of course, before
trying to unmount, I stopped NFS):
glass:~# cat /etc/mtab
/dev/hda2 / ext3 rw,noatime 0 0
none /proc proc rw 0 0
usbdevfs /proc/bus/usb usbdevfs rw 0 0
/dev/hda3 /data ext3 rw,noatime 0 0
none /dev/pts devpts rw,gid=5,mode=620 0 0
none /dev/shm tmpfs rw 0 0
/dev/hdb2 /media ext3 rw,noatime 0 0
glass:~# cat /etc/exports
/data   192.168.0.100(rw,no_root_squash) 192.168.0.0/24(ro)
/media  192.168.0.100(rw,no_root_squash)
glass:~# /etc/init.d/nfs stop
glass:~# umount /media
umount: /media: device is busy
glass:~# umount /data
umount: /data: device is busy
glass:~# dmesg|tail
hdb: drive_cmd: status=0x51 { DriveReady SeekComplete Error }
hdb: drive_cmd: error=0x04 { DriveStatusError }
kjournald starting.  Commit interval 5 seconds
EXT3-fs warning: maximal mount count reached, running e2fsck is
recommended
EXT3 FS 2.4-0.9.16, 02 Dec 2001 on ide0(3,66), internal journal
EXT3-fs: mounted filesystem with ordered data mode.
nfsd: last server has exited
nfsd: unexporting all filesystems
nfsd: last server has exited
nfsd: unexporting all filesystems
glass:~# umount -f /media
umount2: Device or resource busy
umount: /media: device is busy
glass:~# fuser -vu /media
                     USER        PID ACCESS COMMAND
/media               root     kernel mount  /media
glass:~# fuser -vu /data
                     USER        PID ACCESS COMMAND
/data                root     kernel mount  /data
glass:~# cat /etc/fstab
/dev/hda3               /data                   ext3   
defaults,noatime     1 2
/dev/hda2               /                       ext3   
defaults,noatime     1 1
/dev/hda1               /boot                   ext3   
defaults,noauto      0 0
/dev/hdb2               /media                  ext3   
defaults,noauto,noatime 0 0
none                    /dev/pts                devpts 
gid=5,mode=620       0 0
none                    /proc                   proc   
defaults             0 0
none                    /dev/shm                tmpfs  
defaults             0 0
#/dev/hdb1               swap                    swap   
defaults             0 0
/dev/cdrw               /mnt/cdrw           udf,iso9660
noauto,owner,ro      0 0
/dev/hdc                /cdrom                  auto   
ro,noauto,user,exec  0 0
/dev/scd0               /cdrecorder             auto   
ro,noauto,user,exec  0 0
Is this a bug? This didn't happen with 2.4.
Thanks!
________________________________________________________________________
        Felipe Alfaro Solana
   Linux Registered User #287198
http://counter.li.org
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/