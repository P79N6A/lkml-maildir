Date: Sun, 19 Mar 2000 21:52:59 -0100
From: Folkert van Heusden <>
Subject: kernel 2.2.14 with backported 2.3.50 usb-stuff gives panic after  grabbing some images with webcam - includes full report! well, most of  it
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/19/186

1. multiple gets from philips webcams panics the kernel
2. after grabbing images from a webcam for a while, the kernel panics
in an interrupt hanging the whole system.
The cam is a philips.
I've contacted the author of the driver, but as far as he can see, it
is not a problem in his driver.
3. kernel usb
4.
marlboro:~# cat /proc/version
Linux version 2.2.14 (root@marlboro) (gcc version egcs-2.91.66
19990314/Linux (egcs-1.1.2 release)) #1 SMP Sun Mar 19 18:29:22 GMT+1
2000
5.
That's a bit of a problem. The oops scrolls off the screen so I cannot
really write down what happens. I did the kmsgdump-patch (including some
hacking - it doesn't patch cleanly) but it is not writing anything at
all to the disk.
6.
#!/usr/bin/perl
for(;;)
{
        $dummy = `vidcat -s 352x288 -f jpeg -q 100 > /dummy.jpg`;
}
vidat is from the w3cam package. it queries the cam and writes one image
to stdio
7.1
(this is almost out-of-the-box slackware 7.0 system)
-- Versions installed: (if some fields are empty or looks
-- unusual then possibly you have very old versions)
Linux marlboro 2.2.14 #1 SMP Sun Mar 19 18:29:22 GMT+1 2000 i686 unknown
Kernel modules         2.1.121
Gnu C                  egcs-2.91.66
Binutils               2.9.1.0.25
Linux C Library        ..
Dynamic Linker (ld.so) 1.9.9
Procps                 2.0.2
Mount                  2.9v
Net-tools              (1999-04-20)
Kbd                    0.99
Sh-utils               1.16
7.2
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 3
model name	: Pentium II (Klamath)
stepping	: 4
cpu MHz		: 300.688276
cache size	: 512 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
mmx
bogomips	: 299.83
processor	: 1
vendor_id	: GenuineIntel
cpu family	: 6
model		: 3
model name	: Pentium II (Klamath)
stepping	: 4
cpu MHz		: 300.688276
cache size	: 512 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
mmx
bogomips	: 299.83
7.3
pwc-4.1-smp           154408   0 (unused)
videodev                2368   1 [pwc-4.1-smp]
usb-uhci               17504   0 (unused)
usbcore                42376   0 [pwc-4.1-smp usb-uhci]
serial                 19284   1 (autoclean)
es1370                 24716   1
soundcore               2340   4 [es1370]
aha152x                29688   0 (unused)
nls_iso8859-1           2020   1 (autoclean)
nls_cp437               3548   1 (autoclean)
vfat                    9116   1 (autoclean)
fat                    30176   1 (autoclean) [vfat]
7.4
Attached devices: 
Host: scsi0 Channel: 00 Id: 00 Lun: 00
  Vendor: RICOH    Model: MP6200S          Rev: 2.20
  Type:   CD-ROM                           ANSI SCSI revision: 02
Host: scsi0 Channel: 00 Id: 06 Lun: 00
  Vendor: IBM      Model: DCAS-34330       Rev: S65A
  Type:   Direct-Access                    ANSI SCSI revision: 02
7.5/X. kernel is 2.2.14 with the usb for 2.3.50 backported to 2.2.14
patch
           CPU0       CPU1       
  0:      36232     103487    IO-APIC-edge  timer
  1:        814       2298    IO-APIC-edge  keyboard
  2:          0          0          XT-PIC  cascade
  4:          4          2    IO-APIC-edge  serial
  8:          0          1    IO-APIC-edge  rtc
 11:          7          8    IO-APIC-edge  aha152x
 12:      13305      15570    IO-APIC-edge  PS/2 Mouse
 13:          1          0          XT-PIC  fpu
 17:        489        445   IO-APIC-level  es1370
 18:       2418       2546   IO-APIC-level  eth0
 19:       7575       8029   IO-APIC-level  aic7xxx, usb-uhci
NMI:          0
ERR:          0
So the USB seems to be on the same irq as the scsi-device. I cannot
change
this in any way trough the bios. The problem still occurs if I disable
the
usb-IRQ trough in the bios.
/proc/mtrr:
marlboro:/proc# cat mtrr
reg00: base=0x00000000 (   0MB), size= 128MB: write-back, count=1
messages in log when inserting the three usbrelated modules:
Mar 19 19:52:31 marlboro kernel: usb.c: registered new driver usbdevfs
Mar 19 19:52:31 marlboro kernel: usb.c: registered new driver hub
Mar 19 19:52:31 marlboro kernel: usb-uhci.c: version v1.184 time
18:36:59 Mar 19 2000
Mar 19 19:52:31 marlboro kernel: usb.c: new USB bus registered, assigned
bus number 1
Mar 19 19:52:31 marlboro kernel: usb.c: USB new device connect, assigned
device number 1
Mar 19 19:52:31 marlboro kernel: usb.c: new device strings: Mfr=0,
Product=0, SerialNumber=0
Mar 19 19:52:31 marlboro kernel: hub.c: USB hub found
Mar 19 19:52:31 marlboro kernel: hub.c: 2 ports detected
Mar 19 19:52:31 marlboro kernel: Linux video capture interface: v1.00
Mar 19 19:52:32 marlboro kernel: Philips PCA645/646 + PCVC675/680 webcam
module version 4.1 PPro (SMP) loaded.
Mar 19 19:52:32 marlboro kernel: Also supports Askey OEM cams.
Mar 19 19:52:32 marlboro kernel: Default framerate set to 30.
Mar 19 19:52:32 marlboro kernel: Default image size set to cif
[352x288].
Mar 19 19:52:32 marlboro kernel: usb.c: registered new driver Philips
webcam
Mar 19 19:52:32 marlboro kernel: usb.c: USB new device connect, assigned
device number 2
Mar 19 19:52:33 marlboro kernel: usb.c: new device strings: Mfr=0,
Product=0, SerialNumber=1
Mar 19 19:52:34 marlboro kernel: usb.c: USB device number 2 default
language ID 0x409
when grabbing I frequently get messages like:
Mar 19 19:28:00 marlboro kernel: pwc frame buffer underflow (15439);
discarded.
Mar 19 19:28:01 marlboro kernel: pwc frame buffer overflow (flen = 773).
when I remove the modules after some grabbing, the following messages
appear:
Mar 19 20:03:53 marlboro kernel: kmem_shrink: Invalid cache addr
c7fefc20
Mar 19 20:03:53 marlboro kernel: kmem_destroy: Can't free all objects
c7fefc20
Mar 19 20:03:53 marlboro kernel: usb-uhci.c: uhci_desc_kmem remained
Mar 19 20:03:53 marlboro kernel: kmem_shrink: Invalid cache addr
c7fefc80
Mar 19 20:03:53 marlboro kernel: kmem_destroy: Can't free all objects
c7fefc80
Mar 19 20:03:53 marlboro kernel: usb-uhci.c: urb_priv_kmem remained
Mobo is a Asus P2L97-DS with 2 P-II's on 300MHz.
-- 
------------------------------------------------------------
Folkert van Heusden
http://www.vanheusden.com/
some e-mail addresses: f.v.heusden@ftr.nl, flok99@dds.nl
mobile phone: +31-6-22390057
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/