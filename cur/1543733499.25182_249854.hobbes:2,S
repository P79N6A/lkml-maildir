Date: 07 Sep 2004 12:40:50 -0400
From: James Bottomley <>
Subject: Re: clustering and 2.6
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/7/183

On Tue, 2004-09-07 at 12:12, mikem wrote:
> All,
> I'm having some issues when trying to use some clustering software when
> running any 2.6.x kernel.
> Basically, there are 2 nodes connected to 1 storage storage enclosure.
> When node 1 comes up it reserves the volume(s) in the enclosure. When
> node 2 comes up the read capacity fails as expected because of the 
> SCSI reservation. However, if node 1 fails node 2 breaks the reservation,
> but cannot register the disk. At this time we're assuming it's because the read
> capacity failed and the size of the disk is zero blocks.
> 
> The SCSI mid-layer sets a bogus size on a device when read capacity fails.
> Is this the preferred way to get around this issue? Seems like there
> should be a better way.
> 
> Any input is greatly appreciated.
The bogus size thing is a holdover from the old days.
However, I recently did a test where I forced the size to zero.  What I
see is that the partition does indeed not get registered (even for the
whole disc device).  However I can still send a BLKRRPART ioctl to it
trigger a rescan and get the correct size.
James
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/