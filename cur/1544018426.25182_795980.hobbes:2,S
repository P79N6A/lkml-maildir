Date: Thu, 22 Jan 2009 14:26:44 -0800
From: Jeremy Fitzhardinge <>
Subject: Re: lmbench lat_mmap slowdown with CONFIG_PARAVIRT
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/22/335

Ingo Molnar wrote:
> Ouch, that looks unacceptably expensive. All the major distros turn 
> CONFIG_PARAVIRT on. paravirt_ops was introduced in x86 with the express 
> promise to have no measurable runtime overhead.
>
> ( And i suspect the real life mmap cost is probably even more expensive,
>   as on a Barcelona all of lmbench fits into the cache hence we dont see
>   any real $cache overhead. )
>
> Jeremy, any ideas where this slowdown comes from and how it could be 
> fixed?
> 
I just posted a couple of patches to pick some low-hanging fruit.  It 
turns out that we don't need to do any pvops calls to do pte flag 
manipulations.  I'd be interested to see how much of a difference it 
makes (it reduces the static code size by a few k).
    J