Date: Thu, 16 Sep 1999 19:36:50 -0400
From: Justin Wienckowski <>
Subject: 2.2.12 Oops and SMBFS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/9/16/158

With some guidance from a kernel guru, I've put together some more
useful info regarding the 2.2.12 oops.
Seems to be a problem in the smfs driver.  Problems happen when running
updatedb and the find that it invokes hits an smbmount'ed filesystem.
I've gotten the oops to reproduce - log files of the trials are attached.
Attached are log files from these trials.
log.smbfs.2.2.11-ac3   Sample errors generated when find hits the smb fs
                       under 2.2.11-ac3
log.smbfs.2.2.12       Same under 2.2.12
log.oops.2.2.12        Log leading up to and including the oops
oops2.ksym             The oops generated run through ksymoops.  Seems to
                       be from a different spot than my original post.
It only seems to oops under 2.2.12.  2.2.11-ac3 just gets the errors.
The oopses are getting generated when the updated_cron script is kicked
off daily.  Kernel doesn't oops every time it runs - i had to run it twice
to get the oops in the logs which are attached.
The update script is attached as well.
Just drop a note if further testing would be useful.
-Justin Wienckowski
jwiencko@vt.edu
-- 
The Lord's Prayer is 66 words, the Gettysburg Address is 286 words, 
there are 1,322 words in the Declaration of Independence, but government
regulations on the sale of cabbage total 26,911 words.
Sep 16 17:00:18 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:00:49 portal last message repeated 62 times
Sep 16 17:01:50 portal last message repeated 123 times
Sep 16 17:02:23 portal last message repeated 83 times
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8196, size=8192
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8204, size=8192
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8200, size=8192
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8208, size=8192
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8200, size=8192
Sep 16 17:02:24 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8204, size=8192
Sep 16 17:02:24 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8216, size=8192
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8204, size=8192
Sep 16 17:02:24 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8212, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8220, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8212, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8216, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8228, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8216, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8224, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8232, size=8192
Sep 16 17:02:25 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8224, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8228, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8240, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8228, size=8192
Sep 16 17:02:25 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8236, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8244, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8236, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8240, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8252, size=8192
Sep 16 17:02:26 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8240, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8248, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8256, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8248, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8252, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8264, size=8192
Sep 16 17:02:26 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8252, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8260, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8268, size=8192
Sep 16 17:02:27 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8260, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8264, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8276, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8264, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8272, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8280, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8272, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8276, size=8192
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8288, size=8192
Sep 16 17:02:27 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:02:27 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8276, size=8192
Sep 16 17:02:27 portal kernel: kmem_alloc: Bad poison (name=size-2048)
Sep 16 17:02:28 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8284, size=8192
Sep 16 17:02:28 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=8292, size=8192
Sep 16 17:53:33 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17592, size=8192
Sep 16 17:53:33 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17584, size=8192
Sep 16 17:53:34 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17588, size=8192
Sep 16 17:53:34 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17600, size=8192
Sep 16 17:53:34 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17588, size=8192
Sep 16 17:53:34 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17596, size=8192
Sep 16 17:53:34 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17604, size=8192
Sep 16 17:53:34 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17596, size=8192
Sep 16 17:53:34 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17600, size=8192
Sep 16 17:53:35 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17612, size=8192
Sep 16 17:53:35 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17600, size=8192
Sep 16 17:53:35 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17608, size=8192
Sep 16 17:53:35 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17616, size=8192
Sep 16 17:53:35 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17608, size=8192
Sep 16 17:53:35 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17612, size=8192
Sep 16 17:53:35 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17624, size=8192
Sep 16 17:53:36 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17612, size=8192
Sep 16 17:53:36 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17620, size=8192
Sep 16 17:53:36 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17628, size=8192
Sep 16 17:53:36 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=17620, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9176, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9188, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9176, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9184, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9192, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9184, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9188, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9200, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9188, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9196, size=8192
Sep 16 18:10:21 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9204, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9196, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9200, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9212, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9200, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9208, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9216, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9208, size=8192
Sep 16 18:10:22 portal kernel: smb_setup_header: Aieee, xmit len > packet! len=9212, size=8192
Sep 16 18:10:22 portal kernel: put_cached_page: page not locked!
Sep 16 18:10:22 portal kernel: put_cached_page: page count=0
Sep 16 18:10:22 portal kernel: put_cached_page: page not locked!
Sep 16 18:10:22 portal kernel: put_cached_page: page count=0
Sep 16 18:10:22 portal kernel: put_cached_page: page not locked!
Sep 16 18:10:22 portal kernel: put_cached_page: page count=0
Sep 16 18:10:22 portal kernel: Unable to handle kernel paging request at virtual address 334d2f4f
Sep 16 18:10:22 portal kernel: current->tss.cr3 = 01751000, `r3 = 01751000
Sep 16 18:10:22 portal kernel: *pde = 00000000
Sep 16 18:10:22 portal kernel: Oops: 0000
Sep 16 18:10:22 portal kernel: CPU:    0
Sep 16 18:10:22 portal kernel: EIP:    0010:[<c010f086>]
Sep 16 18:10:22 portal kernel: EFLAGS: 00010203
Sep 16 18:10:22 portal kernel: eax: c144f164   ebx: 2f4f317e   ecx: 00000001   edx: 334d2f4f
Sep 16 18:10:22 portal kernel: esi: c144f160   edi: 00000003   ebp: c1753e54   esp: c1753e50
Sep 16 18:10:22 portal kernel: ds: 0018   es: 0018   ss: 0018
Sep 16 18:10:22 portal kernel: Process find (pid: 951, process nr: 58, stackpage=c1753000)
Sep 16 18:10:22 portal kernel: Stack: c3a44000 00000001 c011c739 c3a44024 c4032ead 334d5c4f 000023b0 00000002 
Sep 16 18:10:22 portal kernel:        c3a44000 c4032ee7 c3a44000 c3a4200c c4031b4d c3a44000 c28e3844 c3a4200c 
Sep 16 18:10:22 portal kernel:        c21aec20 c4035dec c3a44000 00000002 c3a44000 c21aec20 c403903e 00000002 
Sep 16 18:10:22 portal kernel: Call Trace: [<c011c739>] [<c4032ead>] [<c4032ee7>] [<c4031b4d>] [<c4035dec>] [<c403903e>] [<c4039042>] 
Sep 16 18:10:22 portal kernel:        [<c4031ebf>] [<c40330ff>] [<c40327e5>] [<c4032963>] [<c012c390>] [<c012c230>] [<c4032790>] [<c0107a6c>] 
Sep 16 18:10:22 portal kernel: Code: 8b 02 85 c7 74 f1 39 f3 74 0c 89 d0 e8 29 f9 ff ff eb e4 8d 
ksymoops 0.7c on i686 2.2.12.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.2.12/ (default)
     -m /usr/src/linux/System.map (default)
Warning: You did not tell me where to find symbol information.  I will
assume that the log matches the kernel and modules that are running
right now and I'll use the default options above for symbol resolution.
If the current kernel and/or modules do not match the log, you can get
more accurate output by telling me the kernel version and where to find
map, modules, ksyms etc.  ksymoops -h explains the options.
Warning (compare_ksyms_lsmod): module ip_masq_ftp is in lsmod but not in ksyms, probably no symbols exported
Warning (compare_ksyms_lsmod): module ip_masq_icq is in lsmod but not in ksyms, probably no symbols exported
Warning (compare_ksyms_lsmod): module ip_masq_irc is in lsmod but not in ksyms, probably no symbols exported
Warning (compare_ksyms_lsmod): module ip_masq_portfw is in lsmod but not in ksyms, probably no symbols exported
Warning (compare_ksyms_lsmod): module ip_masq_quake is in lsmod but not in ksyms, probably no symbols exported
Warning (compare_ksyms_lsmod): module ip_masq_raudio is in lsmod but not in ksyms, probably no symbols exported
Warning (compare_ksyms_lsmod): module smbfs is in lsmod but not in ksyms, probably no symbols exported
Unable to handle kernel paging request at virtual address 334d2f4f
current->tss.cr3 = 01751000, `r3 = 01751000
*pde = 00000000
Oops: 0000
CPU:    0
EIP:    0010:[<c010f086>]
Using defaults from ksymoops -t elf32-i386 -a i386
EFLAGS: 00010203
eax: c144f164   ebx: 2f4f317e   ecx: 00000001   edx: 334d2f4f
esi: c144f160   edi: 00000003   ebp: c1753e54   esp: c1753e50
ds: 0018   es: 0018   ss: 0018
Process find (pid: 951, process nr: 58, stackpage=c1753000)
Stack: c3a44000 00000001 c011c739 c3a44024 c4032ead 334d5c4f 000023b0 00000002 
       c3a44000 c4032ee7 c3a44000 c3a4200c c4031b4d c3a44000 c28e3844 c3a4200c 
       c21aec20 c4035dec c3a44000 00000002 c3a44000 c21aec20 c403903e 00000002 
Call Trace: [<c011c739>] [<c4032ead>] [<c4032ee7>] [<c4031b4d>] [<c4035dec>] [<c403903e>] [<c4039042>] 
       [<c4031ebf>] [<c40330ff>] [<c40327e5>] [<c4032963>] [<c012c390>] [<c012c230>] [<c4032790>] [<c0107a6c>] 
Code: 8b 02 85 c7 74 f1 39 f3 74 0c 89 d0 e8 29 f9 ff ff eb e4 8d 
>>EIP; c010f086 <__wake_up+1e/48>   <=====
Trace; c011c739 <put_cached_page+55/60>
Trace; c4032ead <crc32_tab+58a5/????>
Trace; c4032ee7 <crc32_tab+58df/????>
Trace; c4031b4d <crc32_tab+4545/????>
Trace; c4035dec <END_OF_CODE+87e4/????>
Trace; c403903e <END_OF_CODE+ba36/????>
Trace; c4039042 <END_OF_CODE+ba3a/????>
Trace; c4031ebf <crc32_tab+48b7/????>
Trace; c40330ff <crc32_tab+5af7/????>
Trace; c40327e5 <crc32_tab+51dd/????>
Trace; c4032963 <crc32_tab+535b/????>
Trace; c012c390 <sys_getdents+dc/130>
Trace; c012c230 <filldir+0/84>
Trace; c4032790 <crc32_tab+5188/????>
Trace; c0107a6c <system_call+34/38>
Code;  c010f086 <__wake_up+1e/48>
00000000 <_EIP>:
Code;  c010f086 <__wake_up+1e/48>   <=====
   0:   8b 02             movl   (%edx),%eax   <=====
Code;  c010f088 <__wake_up+20/48>
   2:   85 c7             testl  %eax,%edi
Code;  c010f08a <__wake_up+22/48>
   4:   74 f1             je     fffffff7 <_EIP+0xfffffff7> c010f07d <__wake_up+15/48>
Code;  c010f08c <__wake_up+24/48>
   6:   39 f3             cmpl   %esi,%ebx
Code;  c010f08e <__wake_up+26/48>
   8:   74 0c             je     16 <_EIP+0x16> c010f09c <__wake_up+34/48>
Code;  c010f090 <__wake_up+28/48>
   a:   89 d0             movl   %edx,%eax
Code;  c010f092 <__wake_up+2a/48>
   c:   e8 29 f9 ff ff    call   fffff93a <_EIP+0xfffff93a> c010e9c0 <wake_up_process+0/48>
Code;  c010f097 <__wake_up+2f/48>
  11:   eb e4             jmp    fffffff7 <_EIP+0xfffffff7> c010f07d <__wake_up+15/48>
Code;  c010f099 <__wake_up+31/48>
  13:   8d 00             leal   (%eax),%eax
8 warnings issued.  Results may not be reliable.