Date: Mon, 19 Jan 2009 12:05:39 +0900
From: Tejun Heo <>
Subject: Re: [PATCH 4/5] x86-64: Remove the PDA
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/18/284

Hello, Brian.
Brian Gerst wrote:
>> As discussed before, the above chunks do drop one #ifdef CONFIG_SMP
>> but it does add a obscure relocation and please note that it's
>> different from early_gdt_descr.  early_gdt_descr is needed to bring up
>> the cpu so there's no other way to do it but to relocate it in
>> assembly.  If you absolutely have to relocate irq_stack_ptr early,
>> please do it in C code in head64.c but then again irq_stack_ptr is not
>> even necessary till traps_init() which is way after per cpu area
>> setup.  So, the above two chunks are not necessary && even if they go
>> in, they don't have much to do with this patch.
> 
> I'll give you that this particular variable doesn't need early
> adjustment currently.  I'd prefer if you left the ifdef off the first
> hunk, though.  A comment will suffice to document that the initial
> value is going to be overwritten later on SMP.
Yeah, maybe.  I don't know.  If we ever get to a point where we can
fully initialize per cpu area for cpu0, things like this can probably
go away, but for now, I just thought it would be better to make it
clear that UP and SMP are taking different initialization paths &&
that was how the code looked like before this patch, so...  But no big
deal one way or another, right?
Thanks.
-- 
tejun