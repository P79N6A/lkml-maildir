Date: Mon, 05 Mar 2007 11:00:33 +0900
From: Tejun Heo <>
Subject: Re: Regression between 2.6.20 and 2.6.21-rc1: NCQ problem with ahci and Hitachi drive
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/4/225

Hello, Mathieu.
Mathieu BÃ©rard wrote:
> Hello,
> I have and laptop with an ICH6M SATA Controller and an Hitachi hard drive.
> While it worked well using the ahci module and with NCQ enabled using
> Linux 2.6.20, it does not work anymore (hang at boot) with 2.6.21-rc*
> 
> My drive is among those that were recently blacklisted (see lkml post
> "[PATCH] libata:
> add NCQ blacklist entries from Silicon Image Windowsdriver)
> (Model Number: HTS541010G9SA00 and Firmware Revision: MBZOC60D)
> This blacklisting patch is in -mm now.
> So there is probably a drive related issue here, I'm just wondering why
> it just work
> flawlessly with a 2.6.20...
> 
> Relevant part of kernel log:
> [   16.044663] ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)
> [   16.089475] ata1.00: ATA-7: HTS541010G9SA00, MBZOC60D, max UDMA/100
> [   16.089525] ata1.00: 195371568 sectors, multi 0: LBA48 NCQ (depth 31/32)
No, your drive isn't blacklisted yet.  NCQ is still being enabled.
> [   16.091804] ata1.00: configured for UDMA/100
> [   18.151756] SCSI device sda: write cache: enabled, read cache:
> enabled, doesn't support DPO or FUA
[--snip--]
> [   18.151856] SCSI device sda: 195371568 512-byte hdwr sectors (100030 MB)
> [   18.151911] sda: Write Protect is off
> [   18.151977] SCSI device sda: write cache: enabled, read cache:
> enabled, doesn't support DPO or FUA
> [....]
> [   48.143940] ata1.00: exception Emask 0x0 SAct 0x1 SErr 0x0 action 0x2
> frozen
> [   48.143999] ata1.00: cmd 60/08:00:00:00:00/00:00:00:00:00/40 tag 0
> cdb 0x0 data 4096 in
> [   48.144000]          res 40/00:00:00:00:00/00:00:00:00:00/00 Emask
> 0x4 (timeout)
It looks like IRQ isn't getting through.  Does giving "acpi=off" kernel
parameter make any difference?
-- 
tejun
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/