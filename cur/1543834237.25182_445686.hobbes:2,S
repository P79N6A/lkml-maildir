Date: Fri, 21 Jul 2006 08:54:49 +0200
From: Gerd Hoffmann <>
Subject: Re: kexec and framebuffer
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/21/12

Antonino A. Daplas wrote:
> Kalev Lember wrote:
>> Thank you, this was really helpful.
>>> +	if (0 != strcmp(fix.id, "vesafb"))
>>> +		goto out;
>> I think this check should be removed so that other framebuffer drivers
>> besides vesafb would also work.
> 
> I think having the check is correct, only vesafb relies totally on
> screen_info. If you remove the check, you can get the wrong information
> from other framebuffer drivers.
Exactly.
>> +	/* fixme: better get size from /proc/iomem */
>> +	real_mode->lfb_size       = (fix.smem_len + 65535) / 65536;
>> +	real_mode->pages          = (fix.smem_len + 4095) / 4096;
> 
> Note that fix.smem_len is the size of the remapped memory which can be
> smaller than the actual framebuffer length. But there's a fixme comment
> there so you probably know about this.
Yep, that is the reason for the fixme.  kexec-tools already parse
/proc/iomem, but keep the info private in some other source file, so I
decided to solve it this way for the first cut.  Shouln't be that hard
to fix it up though.
I've mailed it some time ago to the maintainer, no feedback.  Feel free
to polish the patch a bit and try submitting it again ...
cheers,
  Gerd
-- 
Gerd Hoffmann <kraxel@suse.de>
http://www.suse.de/~kraxel/julika-dora.jpeg
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/