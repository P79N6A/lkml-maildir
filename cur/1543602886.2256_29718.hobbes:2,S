Date: Sat, 29 Sep 2001 03:08:15 +0200
From: Roger Larsson <>
Subject: [DATAPOINT] -ac16+ and increased readahead (ksoftirqd related?)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/9/28/216

Hi,
After receiving Robert Cohens mail concerning
"[BENCH] Problems with IO throughput and fairness with 2.4.10 and 2.4.9-ac15"
I replied about the possibility to increase READAHEAD again.
But since I was running the -ac16 (with swapoff patch) I decided to try it
myself...
First my attempts were not that sucessful. Changing /proc/sys/vm/max-readahead
did not have any visible effect... (why not???)
Then I found /proc/ide/hda/settings
and changed "file_readahead:511" but got wery strange results...
The start is very good but suddenly the HD starts to sound strange. A check
with vmstat shows that there is a huge amount of context switches...
Going back to zero (global) readahead did not help.
So I rebooted the computer for more careful testing.
vmstat-3 is output from vmstat 3
file_readahead.settings is how I change the file_readahead
The test I perform, for each value of file_readahead, is a diff between
two huge, but identical, files.
/RogerL
-- 
Roger Larsson
Skellefte√•
Sweden
   procs                      memory    swap          io     system         cpu
 r  b  w   swpd   free   buff  cache  si  so    bi    bo   in    cs  us  sy  id
 1  0  0      0 211740   2284  25312   0   0   409    36  143   145   9   9  82
 0  0  0      0 211696   2284  25316   0   0     0     0  103    34   0   0 100
 0  0  0      0 211012   2288  25316   0   0     1    15  111    67   1   0  99
 0  0  0      0 211012   2288  25316   0   0     0     7  109    48   0   0 100
 0  0  0      0 211000   2296  25320   0   0     4     0  107    48   0   0 100
 0  0  0      0 210996   2296  25320   0   0     0     0  106    43   0   0 100
 0  0  0      0 210996   2296  25320   0   0     0     0  104    37   0   0 100
 0  0  0      0 210996   2296  25320   0   0     0     0  115    60   0   0 100
 0  0  0      0 210980   2300  25328   0   0     4    19  115    57   0   0 100
 0  1  0      0 210616   2308  25444   0   0    41     0  109    52   0   0 100
 0  1  0      0 181632   2348  53680   0   0  9425     0  319   193   2   3  95
 0  1  0      0 148800   2380  85680   0   0 10677     0  268   153   2   6  92
 0  1  0      0 118084   2412 115616   0   0  9988     3  258   136   2   3  96
 1  0  0      0  85768   2436 147120   0   0 10511    39  273   170   2   5  94
 1  0  0      0  53720   2468 178352   0   0 10421     0  262   145   3   3  94
 1  0  0      0  23252   2500 208048   0   0  9909     0  263   145   2   3  95
 0  1  0      0   3056   2532 228868   0   0 10421     0  283   144   3   4  93
 1  0  0      0   3056   2564 228836   0   0 10677     0  267   155   2   4  94
 1  0  0      0   3056   2588 228812   0   0 10760     1  269   150   3   5  92
 0  1  0      0   3056   2620 228780   0   0 10848     0  269   150   3   6  91
 0  1  0      0   3056   2652 228748   0   0  9824    17  277   145   1   2  97
   procs                      memory    swap          io     system         cpu
 r  b  w   swpd   free   buff  cache  si  so    bi    bo   in    cs  us  sy  id
 1  1  0      0   3056   2684 228716   0   0 11019     0  274   157   1   6  93
 0  1  0      0   3056   2716 228560   0   0 10421     0  265   152   3   7  90
 1  0  0      0   3056   2748 228528   0   0 10677     3  268   154   2   3  95
 0  1  0      0   3056   2780 228496   0   0 10763     0  268   158   3   6  92
 1  0  0      0   3056   2812 228464   0   0 11189     0  276   159   6   6  88
 0  1  0      0   3056   2844 228432   0   0 11019     0  272   157   2   4  94
 0  1  0      0   3056   2876 228400   0   0 11275     0  276   155   3   3  95
 0  1  0      0   3056   2928 228324   0   0 10208     0  266   179   5   4  91
 0  1  0      0   3056   2952 228268   0   0 10077     0  257   141   2   5  93
 0  0  0      0   3280   2976 228248   0   0  7517     0  224   133   3   2  95
 0  0  0      0   3280   2976 228248   0   0     0     0  104    37   0   0 100
 0  0  0      0   3280   2976 228248   0   0     0     1  104    33   0   0 100
 0  0  0      0   3280   2976 228248   0   0     0     0  105    39   0   0 100
- - -
 0  0  0      0   3256   2976 228280   0   0     0     0  102    28   0   0 100
 0  0  0      0   3256   2976 228280   0   0     0     4  103    32   0   0 100
   procs                      memory    swap          io     system         cpu
 r  b  w   swpd   free   buff  cache  si  so    bi    bo   in    cs  us  sy  id
 2  0  0      0   3056   2976 228252   0   0  1035     0  127    55   0   1  99
 0  1  0      0   3056   2976 230812   0   0 32960     0  373   158   7   8  85
 0  1  1      0   3056   2976 228184   0   0 29047     1  366    63  16  10  75
 0  1  0      0   3056   2976 228380   0   0 29581     0  345    40   4   8  88
 0  2  0      0   3056   2976 228420   0   0 27116     0  344    40   0   3  97
 1  0  0     24   3056   2976 228424   0   0 15897     0 1415  2300   3   9  88
 0  1  0     28   3056   2976 228448   0   0  1211     0  403   631   0   2  98
 1  0  0     28   3056   2976 228448   0   0   957     1  341   504   0   1  99
 0  1  0     28   3056   2976 228448   0   0  9155     0 2389  4600   4  11  86
 0  1  0     28   3056   2976 228448   0   0  1208     1  403   631   0   1  99
 1  0  1     36   3056   2976 228448   0   0  9765     0  490   805   1   3  96
 0  1  0     84   3056   2976 228504   0   0 29689    20  339    46   0   3  97
 0  0  0     84   3272   2976 228516   0   0  4432    12  226    34   0   1  98
 0  0  0     84   3272   2976 228516   0   0     0     0  100    24   0   0 100
 0  0  0     84   3272   2976 228516   0   0     0     0  101    27   0   0 100
 0  0  0     84   3268   2976 228520   0   0     1     0  103    35   0   0 100
 0  0  0     84   3268   2976 228520   0   0     0     0  103    32   0   0 100
 0  0  0     84   3268   2976 228520   0   0     0     0  105    36   0   0 100
- - -
   procs                      memory    swap          io     system         cpu
 r  b  w   swpd   free   buff  cache  si  so    bi    bo   in    cs  us  sy  id
 0  0  0     84   3268   2976 228520   0   0     0     0  103    32   0   0 100
 0  0  0     84   3264   2976 228524   0   0     1     0  108    44   0   0 100
 0  0  0     84   3264   2976 228524   0   0     0     0  106    39   0   0 100
 0  0  0     84   3264   2976 228524   0   0     0     0  100    27   0   0 100
 0  0  0     84   3168   2976 228620   0   0    92     0  112    56   0   0 100
 0  0  0     84   3168   2976 228620   0   0     0     0  103    28   0   0 100
 0  1  0     84   3056   2976 228504   0   0   153     0  113    53   0   0 100
 1  0  1     96   3056   2976 228516   0   0 32661     3  371   143   3   8  89
 0  1  0    400   3056   2976 228620   0   0 27697     1  355    44   1   5  94
 0  1  0    876   3056   2976 228656   0   0 29541     1  346    42   4   9  87
 0  1  0   1040   3056   2976 228636   0   0 27267     0  344    41   0   6  94
 0  1  0   1184   3056   2976 228652   0   0  9421     0  360   234   0   2  98
 0  1  0   1184   3056   2976 228652   0   0  2032     0  609  1042   0   3  97
 0  1  0   1256   3056   2976 228656   0   0  4756     0 1289  2404   2   5  93
 0  1  0   1256   3056   2976 228656   0   0  1431     9  460   742   0   2  98
 0  1  0   1256   3056   2976 228656   0   0  1105     0  377   576   0   0  99
 0  1  0   1256   3056   2976 228656   0   0   893     0  324   471   0   1  99
 1  1  0   1256   3056   2976 228656   0   0  1016     0  354   533   0   2  97
 0  1  0   1256   3056   2976 228656   0   0   955    15  344   508   0   2  98
   procs                      memory    swap          io     system         cpu
 r  b  w   swpd   free   buff  cache  si  so    bi    bo   in    cs  us  sy  id
 1  0  0   1256   3272   2976 228668   0   0   211     1  157   140   0   0 100
 0  0  0   1256   3268   2976 228672   0   0     1     0  101    28   0   0 100
 0  0  0   1256   3268   2976 228672   0   0     0     1  101    27   0   0 100
- - -
 0  0  0   1256   3268   2976 228672   0   0     0     0  104    36   0   0 100
 0  0  0   1256   3268   2976 228672   0   0     0     1  108    44   0   0 100
 0  0  0   1256   3168   2976 228772   0   0    87     0  111    50   0   1  99
 0  0  0   1256   3168   2976 228772   0   0     0     1  105    37   0   0 100
 0  0  0   1256   3168   2976 228772   0   0     0     0  100    27   0   0 100
 0  0  0   1256   3164   2976 228776   0   0     0     1  101    23   0   0 100
 0  1  0   1336   3056   2976 228668   0   0 26984     1  331   161   3   5  92
 0  1  0   1404   3056   2976 228672   0   0 27827     0  357    42   3  12  85
 0  1  0   1464   3056   2976 228688   0   0 29128     0  346    40   0   5  95
 0  1  0   1476   3056   1096 230572   0   0 27323     0  343    42   0   5  95
 1  0  0   1476   3056   1096 230572   0   0  6079     0  385   342   0   1  98
 0  1  0   1476   3056   1096 230572   0   0  1632     0  508   844   0   2  98
   procs                      memory    swap          io     system         cpu
 r  b  w   swpd   free   buff  cache  si  so    bi    bo   in    cs  us  sy  id
 1  1  0   1476   3056   1096 230572   0   0  1916     0  589  1003   0   2  98
 0  0  0   1476   3272   1096 230584   0   0  1109    11  387   595   0   1  98
 0  0  0   1476   3268   1096 230584   0   0     0     3  101    26   0   0 100
 0  0  0   1476   3268   1096 230584   0   0     0     0  101    27   0   0 100
 0  0  0   1476   3268   1096 230584   0   0     0    15  109    38   0   0 100
 0  0  0   1476   3268   1096 230584   0   0     0     0  121    77   0   0 100
 1  0  0   1476   3268   1096 230584   0   0     0     0  108    43   0   0 100
 0  0  0   1476   3268   1096 230584   0   0     0     0  106    39   0   0 100
 0  0  0   1476   3268   1096 230584   0   0     0     0  102    29   0   0 100
 0  0  0   1476   3168   1096 230684   0   0    87     0  114    60   0   0 100
 0  1  0   1476   3056   1096 230568   0   0   335     0  185   194   0   1  99
 1  0  0   1476   3056   1096 230568   0   0  1199     0  401   627   1   1  98
 0  1  0   1476   3056   1096 230568   0   0  1263     0  416   658   0   2  97
 0  1  0   1476   3056   1096 230568   0   0  1183     0  396   618   0   2  97
 0  1  0   1476   3056   1096 230568   0   0   747     1  288   400   1   0  99
 1  0  0   1476   3056   1096 230568   0   0  1792     0  549   920   0   3  97
 0  1  0   1476   3056   1096 230568   0   0  1405     1  452   729   0   1  98
 0  1  0   1476   3056   1096 230568   0   0   841     0  311   447   0   0 100
 0  1  0   1476   3056   1096 230568   0   0  1261     0  416   656   0   1  99
 1  0  0   1476   3056   1096 230568   0   0  1975    11  597  1011   0   1  98
file_readahead          0               0               2097151         rw
file_readahead          31              0               2097151         rw
file_readahead          511             0               2097151         rw
file_readahead          1023            0               2097151         rw
file_readahead          0               0               2097151         rw