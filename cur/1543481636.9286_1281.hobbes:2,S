Date: Sat, 23 Jan 1999 05:37:07 +0000
From: Tom Eastep <>
Subject: Re: mv operation doesn't work anymore in VFAT filesystem (followup)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/23/26

Alex Buell wrote:
> 
> Further from my previous email, here's an strace from mv
> 
> stat("testing", 0xbffff730) = -1 ENOENT (No such file or directory)
> lstat("autoexec.bat", {st_mode=S_IFREG|0660, st_size=111, ...}) = 0
> lstat("testing", 0x804bb28) = -1 ENOENT (No such file or directory)
> rename("autoexec.bat", "testing") = -1 ENOENT (No such file or directory)
The attached patch which fixes this problem was posted several days
ago...
-Tom
-- 
Tom Eastep
Compaq Computer Corporation
Enterprise Computing Group
Tandem Division
tom.eastep@compaq.com--- linux-old/fs/vfat/namei.c	Thu Jan 21 09:59:22 1999
+++ linux/fs/vfat/namei.c	Thu Jan 21 10:06:13 1999
@@ -1657,9 +1657,9 @@
 			drop_aliases(new_dentry);
 		}
 		res = vfat_remove_entry(new_dir,&sinfo,new_inode);
+		if (res)
+		        goto rename_done;
 	}
-	if (res)
-		goto rename_done;
 
 	/* Serious lossage here. FAT uses braindead inode numbers scheme,
 	 * so we can't simply cannibalize the entry. It means that we havebegin:vcard 
n:Eastep;Tom
x-mozilla-html:TRUE
org:Compaq Computer Corporation;Tandem Division
adr:;;;;;;
version:2.1
email;internet:tom.eastep@compaq.com
x-mozilla-cpt:;-6528
fn:Tom Eastep
end:vcard