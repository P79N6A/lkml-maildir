Date: Fri, 7 Jan 2000 16:01:33 +0100
From: Jan Kara <>
Subject: Quota fix in 2.2.14 (fwd)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/1/7/158

  Hello.
  I was announced about one bug in quota - somebody deleted select_dcache()
from get_empty_dquot() and didn't change other code properly :|.
The fix is attached.
							Honza.
--- linux/fs/dquot.c	Tue Jan  4 19:12:23 2000
+++ linux/fs/dquot.c	Fri Jan  7 15:47:26 2000
@@ -569,8 +569,9 @@
 	/*
 	 * Try pruning the dcache to free up some dquots ...
 	 */
-	printk(KERN_DEBUG "get_empty_dquot: pruning %d\n", count);
-	if (prune_dcache(0, 128))
+	count = prune_dcache(0, 128);
+	printk(KERN_DEBUG "get_empty_dquot: pruning dcache (got %d inodes)\n", count);
+	if (count)
 	{
 		free_inode_memory(count);
 		goto repeat;