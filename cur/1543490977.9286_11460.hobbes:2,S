Date: Thu, 25 Mar 1999 14:21:25 -0700
From: Cody Pisto <>
Subject: Re: kmod or ppa problem?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/3/25/129

Sorry about the confusion, I have a cron job that removes the unused
modules. and I have scsi disk support (sd) compiled into the kernel not
as a module.
output of lsmod after 'mount /zip' on a fresh reboot
~#lsmod
Module                  Size  Used by
parport_pc              4980   1  (autoclean)
ppa                     9040   0  (unused)
parport                 7028   1  [parport_pc ppa]
ppp_deflate            40548   1  (autoclean)
ppp                    18316   2  (autoclean) [ppp_deflate]
slhc                    4328   1  (autoclean) [ppp]
3c59x                  18856   1  (autoclean)
ip_masq_user            2312   0  (unused)
ip_masq_vdolive         1072   0  (unused)
ip_masq_raudio          2736   0  (unused)
ip_masq_quake           1092   0  (unused)
ip_masq_irc             1520   0  (unused)
ip_masq_ftp             2352   0
ip_masq_cuseeme          816   0  (unused)
then the cron removes the unused modules
here is proc/devices right after above
cat /proc/devices
Character devices:
  1 mem
  2 pty
  3 ttyp
  4 ttyS
  5 cua
  7 vcs
 10 misc
 21 sg
 29 fb
Block devices:
  2 fd
  3 ide0
  8 sd
 22 ide1
and here it is after unloading of the modules
cat /proc/devices
Character devices:
  1 mem
  2 pty
  3 ttyp
  4 ttyS
  5 cua
  7 vcs
 10 misc
 21 sg
 29 fb
Block devices:
  2 fd
  3 ide0
  8 sd
 22 ide1
Greg Zornetzer wrote:
> 
> On Wed, 24 Mar 1999, Cody Pisto wrote:
> 
> >     I seem to be having a problem with kmod. I compiled the ppa driver
> > as a module (parallel port zip drive) and accompanying parallel port
> > drivers as modules. I added "alias block-major-8 ppa" and "alias
> > parport_lowlevel parport_pc" to /etc/conf.modules.
> > This works as it should the first time I use the zip drive. 'mount /zip'
> > causes kmod to call modprobe and load the respective modules. When im
> Okay, good.  Can we see the output of /sbin/lsmod here, and /proc/devices?
> 
> > done using the drive I 'umount /zip', some time later, again as it
> > should, kmod unloads the modules. This is where my problem begins.
> Whoa, hold on - kmod does not get involved in module removal (since about
> 2.1.10x) - check Documentation/kmod.txt - if you're not running something
> in the background like the appropriate cron job, you're not removing
> modules.
> 
> Anyway, can we also get the output of /sbin/lsmod here, and the output of
> cat /proc/devices
> 
> > 'mount /zip' instead of causing kmod to load the modules, produces
> > "mount: /dev/sda4 is not a valid block device". 'lsmod' proves that the
> > modules have not been loaded. 'modprobe ppa' does as expected and loads
> > the correct modules, 'mount /zip' works. I can not get kmod to
> > automatically handle the ppa module and dependencies, until I reboot. It
> > works once then not again. I honestly have no clue what could cause
> > this. Any ideas would be greatly appreciated.
> 
> Looking at the setup of my machine, I think I may see the problem -
> block-major-8 is the scsi-disk device.  If you have unloaded ppa, but have
> not unloaded sd, then I could see this problem arising.
> 
> I have a couple of ideas of approaches to fixing the problem, but I'd like
> to hear what the output  requested above looks like.
> 
> Good luck,
> 
> Greg Zornetzer - gaz+@andrew.cmu.edu
> "Light shines brightest in the darkest night"
> 
http://www.contrib.andrew.cmu.edu/~gaz
>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/