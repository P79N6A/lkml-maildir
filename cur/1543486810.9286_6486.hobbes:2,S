Date: Mon, 22 Feb 1999 12:57:00 +0000
From: Martijn van Oosterhout <>
Subject: Re: Hang on boot without a keyboard
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/2/22/38

Pavel Machek wrote:
> 
> > I've seen it on two machines now so I decided to try and
> > track it down. When there is no keyboard plugged, the kernel
> > gets stuck right after the Loading linux...... from LILO.
> >
> > I tracked it down to empty_8042 in arch/i386/boot/setup.S:758
> 
> Do I see a diff -u, here?
Sorry, I figured that there was something deeper wrong with the
8042 and that maybe it was a BIOS misconfiguration.
Anyway, I don't know if it's worth it. Maybe someone who knows
something about keyboard controllers can have a look? My asm
coding isn't what it used to be.
================================================
--- setup.S.bak Sun Feb 14 18:46:55 1999
+++ setup.S     Sun Feb 14 18:55:07 1999
@@ -756,16 +756,25 @@
 ! No timeout is used - if this hangs there is something wrong with
 ! the machine, and we probably couldn't proceed anyway.
 empty_8042:
+       push    cx
+       mov     cx,#0xFFFF
+
+empty_8042_loop:
+       dec     cx
+       jz      empty_8042_end_loop
+
        call    delay
        in      al,#0x64        ! 8042 status port
        test    al,#1           ! output buffer?
        jz      no_output
        call    delay
        in      al,#0x60        ! read it
-       jmp     empty_8042
+       jmp     empty_8042_loop
 no_output:
        test    al,#2           ! is input buffer full?
-       jnz     empty_8042      ! yes - loop
+       jnz     empty_8042_loop ! yes - loop
+empty_8042_end_loop:
+       pop     cx
        ret
 
 !
================================================
Martijn van Oosterhout
Australia
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/