Date: Wed, 5 Mar 2008 01:19:45 +0000
From: Alasdair G Kergon <>
Subject: Re: [dm-devel] Re: 2.6.25-rc regression: kernel panic on boot
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/4/605

On Tue, Mar 04, 2008 at 10:43:12AM -0800, Andrew Morton wrote:
> Isn't the device-mapper kernel code capable of detecting the older userspace
> version and loudly warning about it?  That at least would prevent us from
> wasting lots of people's time like this.
It's not a device-mapper problem: It's between userspace LVM2 and kernel
sysfs.
LVM2 userspace expects a particular sysfs layout.  That layout got
changed without offering sufficient lead time (>6-9 months) for the
required userspace changes to propagate into the main versions of the
distros people use.
LVM2 userspace version 2.02.29 (released 5th December 2007) can handle
old and new layouts.  The patch was in the CVS head for a while before
that.  Earlier versions of LVM2 require CONFIG_SYSFS_DEPRECATED.  A
less-efficient workaround is to disable the use of sysfs in the LVM2
config: 'devices { sysfs_scan = 0 }'.
(I think the root cause of this mess was changing what
CONFIG_SYSFS_DEPRECATED did instead of adding a new setting that could
be enabled by default.)
Alasdair
-- 
agk@redhat.com