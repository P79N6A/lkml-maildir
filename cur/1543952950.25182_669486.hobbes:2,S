Date: Thu, 20 Mar 2008 12:41:02 +0100
From: Takashi Iwai <>
Subject: Re: [alsa-devel] 2.6.25-rc6-00074-g264e3e8: serious problem with ALSA	Intel-HDA and MSI
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/20/84

At Wed, 19 Mar 2008 21:12:51 +0100,
Prakash Punnoor wrote:
> 
> Hi,
> 
> I didn't test an earlier 2.6.25-rc kernel, as I had no working nvidia 
> driver... But the problem I am reporting happens before nvidia gets loaded.
> 
> With 2.6.24.3 the ALSA driver didn't made any troubles for me. Stock kernel 
> and enable_msi=1 made the driver to get a timeout and go back to legacy IRQ. 
> 
> With patches from 
> 
http://kerneltrap.org/mailarchive/linux-kernel/2007/11/25/443612
> 2.6.24.x even works with MSI.
> 
> Now with above 2.6.25-rc kernel regardless of using above patch, the kernel 
> _hangs_ now when trying to initialize ALSA. It is even so bad, that doing a 
> hw reset and trying to load patched 2.6.24 kernel causes ALSA to hang when 
> trying to enable MSI. I need to turn power off and then patched 2.6.24 with 
> MSI works again.
> 
> 2.6.25-rc with ALSA Intel HDA _not_ forcing enable_msi causes it to boot.
> 
> to summarize:
> 
> 2.6.24 + patch + enable_msi=1: OK (and HDA MSI)
> 2.6.24 + enable_msi=1: OK (and HDA legacy IRQ)
> 2.6.24 + patch: OK (and HDA legacy IRQ)
> 2.6.24: OK (and HDA legacy IRQ)
> 
> 2.6.25-rc + patch + enable_msi=1: hang
> 2.6.25-rc + enable_msi=1: hang
> 2.6.25-rc + patch: OK (and HDA legacy IRQ)
> 2.6.25-rc: OK (and HDA legacy IRQ)
> 
> 
> I don't know whether something in Linux MSI support was changed having effect 
> on ALSA or whether the HDA driver has a regression.
At least there is no big change regarding the IRQ handling in ALSA
HD-audio driver since 2.6.24...
Takashi