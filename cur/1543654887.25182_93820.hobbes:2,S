Date: Wed, 04 Dec 2002 13:29:55 +0100
From: Kay Diederichs <>
Subject: stock 2.4.20: loading amd76x_pm makes time jiggle on A7M266-D
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/12/4/47

the subject says it all: 
if I use the powersaving module amd76x_pm then the time is not kept. The
hardware is Asus A7M266-D with 2 MP1900 processors, BIOS is 1004 (but I
tried later BIOS versions as well).
Symptoms are:
- ping times vary and there are 'time of day goes back' messages:
64 bytes from xx (1.2.3.4): icmp_seq=4 ttl=64 time=19.549 msec
64 bytes from xx (1.2.3.4): icmp_seq=5 ttl=64 time=2.684 sec
Warning: time of day goes back, taking countermeasures.
64 bytes from xx (1.2.3.4): icmp_seq=6 ttl=64 time=9.799 msec
64 bytes from xx (1.2.3.4): icmp_seq=7 ttl=64 time=88 usec
64 bytes from xx (1.2.3.4): icmp_seq=8 ttl=64 time=20.011 msec
(addresses edited)
- ntpq -p shows a very high jitter:
     remote           refid      st t when poll reach   delay   offset 
jitter
==============================================================================
 loop8.biologie. 134.34.3.18      2 u    6   64   77    0.807  -1920.6
1804.31
 helix1.biologie 134.34.3.18      2 u   13   64   77    0.348  -1914.9
1803.99
- ntpd complains:
Dec  3 19:18:51 turn22 ntpd[730]: synchronisation lost
Dec  3 20:12:15 turn22 ntpd[730]: synchronisation lost
Dec  3 22:50:40 turn22 ntpd[730]: synchronisation lost
Dec  3 23:01:18 turn22 ntpd[730]: synchronisation lost
- the program 'check_time' (attached) which was once posted by R.
Johnson on this list shows that the internal timekeeping is
inconsistent:
Time = 3dedf443
Last = 3dedf440
Time = 3dedf440
Last = 3dedf443
Time = 3dedf443
Last = 3dedf440
Time = 3dedf440
Last = 3dedf443
Time = 3dedf443
Last = 3dedf440
Time = 3dedf440
Last = 3dedf443
Time = 3dedf443
Last = 3dedf440
Time = 3dedf440
Any ideas? Am I really the only one who has seen these problems (on 4
identical machines, BTW)?
Kay
-- 
Kay Diederichs         
http://strucbio.biologie.uni-konstanz.de/~kay
 
email: Kay.Diederichs@uni-konstanz.de  Tel +49 7531 88 4049 Fax 3183
When replying to my email, please remove the blanks before and after the
"@" !
Fakultaet fuer Biologie, Universitaet Konstanz, Box M656, D-78457
Konstanz#include <stdio.h> 
#include <time.h> 
int main() 
{ 
    time_t tim; 
    time_t last; 
    (void)time(&last); 
    (void)time(&tim); 
    for(;;) 
    { 
        (void)time(&tim); 
        if(tim != last) 
        { 
            if((last +1) != tim) 
            { 
                fprintf(stderr,"Time = %08lx\n", tim); 
                fprintf(stderr,"Last = %08lx\n", last); 
            } 
            last = tim; 
        } 
    } 
} 