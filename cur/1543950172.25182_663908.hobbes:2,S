Date: Wed, 05 Mar 2008 08:00:42 -0800
From: "H. Peter Anvin" <>
Subject: Re: Linux doesn't follow x86/x86-64 ABI wrt direction flag
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/5/231

Aurelien Jarno wrote:
> Hi all,
> 
> Since version 4.3, gcc changed its behaviour concerning the x86/x86-64 
> ABI and the direction flag, that is it now assumes that the direction 
> flag is cleared at the entry of a function and it doesn't clear once 
> more if needed.
> 
> This causes some problems with the Linux kernel which does not clear
> the direction flag when entering a signal handler. The small code below
> (for x86-64) demonstrates that. 
> 
> If the signal handler is using code that need the direction flag cleared
> (for example bzero() or memset()), the code is incorrectly executed.
> 
> I guess this has to be fixed on the kernel side, but also gcc-4.3 could
> revert back to the old behaviour, that is clearing the direction flag
> when entering a routine that touches it until most people are running a
> fixed kernel.
> 
Linux should definitely follow the ABI.  This is a bug, and a pretty 
serious such.
	-hpa