Date: Thu, 28 Jun 2007 11:38:19 -0700
From: Andrew Morton <>
Subject: Re: [patch -mm] Make check_signature() depend on CONFIG_HAS_IOMEM
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/28/227

On Thu, 28 Jun 2007 20:27:22 +0200 (CEST) Geert Uytterhoeven <geert@linux-m68k.org> wrote:
> > >  endif
> > > 
> > >  obj-$(CONFIG_GENERIC_IOMAP) += iomap.o
> > > -obj-$(CONFIG_HAS_IOMEM) += iomap_copy.o devres.o
> > > +obj-$(CONFIG_HAS_IOMEM) += iomap_copy.o devres.o check_signature.o
> > >  obj-$(CONFIG_DEBUG_LOCKING_API_SELFTESTS) += locking-selftest.o
> > >  obj-$(CONFIG_DEBUG_SPINLOCK) += spinlock_debug.o
> > >  lib-$(CONFIG_RWSEM_GENERIC_SPINLOCK) += rwsem-spinlock.o
> > 
> > We didn't think of that.
> > 
> > Alas, m68k `make allmodconfig' creates CONFIG_ISA=n, CONFIG_PCI=n,
> > CONFIG_HAS_IOMEM=y, so it will still be busted.
> > 
> > But this seems to be the correct fix.  Perhaps m68k config needs
> > attention?
> 
> Euh, I don't think this is the correct fix.
> 
> CONFIG_HAS_IOMEM is apparently used in two meanings:
>   1. The architecture has support for memory mapped I/O (s390 obviously
>      hasn't)
>   2. The architecture has ISA/PCI-style memory mapped I/O (readb() and
>      friends)
> 
> check_signature() falls under the second category.
> 
> Setting NO_IOMEM on m68k will make us loose some drivers (e.g.
> drivers/video/Kconfig depends on HAS_IOMEM).
> 
> Apart from many Kconfig dependencies on HAS_IOMEM, CONFIG_HAS_IOMEM is
> further only used to control the build of lib/iomap_copy.c, which
> doesn't use readb() and friends, but the __raw*() operations.
> 
Well this is fun.
How to fix? Should we add a new CONFIG_HAS_IO?  (IOPORTS?)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/