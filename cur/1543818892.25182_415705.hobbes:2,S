Date: Thu, 13 Apr 2006 17:54:52 +0100
From: Russell King <>
Subject: Re: 2.6.17-rc1: collie -- oopsen in pccardd?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/13/152

On Thu, Apr 13, 2006 at 06:47:06PM +0200, Pavel Machek wrote:
> Hi!
> 
> > > > > I'm getting some oopses when inserting/removing pccard (on collie,
> > > > > oopses in pccardd). It does not break boot, so it is not immediate
> > > > > problem, but I wonder if it also happens on non-collie machines?
> > > > 
> > > > No idea what so ever.  Not even any clues as to what might be going wrong
> > > > due to the lack of oops dump.  (Not that I even look after PCMCIA anymore.)
> > > 
> > > Sorry for lack of oops. I was not expecting you to debug it, I
> > > expected some voices telling me it is broken for them, too :-).
> > 
> > With a recent git kernel (907d91d708d9999bec0185d630062576ac4181a7) I
> > see the oops below when booting spitz (SL-C3000 - ARM pxa270 based). Was
> > this the same oops you saw Pavel?
> 
> I think so.
diff --git a/drivers/pcmcia/pcmcia_resource.c b/drivers/pcmcia/pcmcia_resource.c
--- a/drivers/pcmcia/pcmcia_resource.c
+++ b/drivers/pcmcia/pcmcia_resource.c
@@ -89,7 +88,7 @@ static int alloc_io_space(struct pcmcia_
        }
        if ((s->features & SS_CAP_STATIC_MAP) && s->io_offset) {
                *base = s->io_offset | (*base & 0x0fff);
-               s->io[0].Attributes = attr;
+               s->io[0].res->flags = (s->io[0].res->flags & ~IORESOURCE_BITS) | (attr & IORESOURCE_BITS);
                return 0;
        }
        /* Check for an already-allocated window that must conflict with
will probably be the culpret - which is from commit
c7d006935dfda9174187aa557e94a137ced10c30.
Static maps do not have IO resources, so s->io[].Attributes was not a
"duplicated" field in this case.  This part of this change needs
reverting.
-- 
Russell King
 Linux kernel    2.6 ARM Linux   - 
http://www.arm.linux.org.uk/
 maintainer of:  2.6 Serial core
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/