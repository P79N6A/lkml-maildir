Date: Fri, 23 Jun 2006 08:41:20 -0500
From: Paul Fulghum <>
Subject: Re: [PATCH][RFC] kill TTY_DONT_FLIP
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/6/23/184

Alan Cox wrote:
> Looks good to me on a first review.
I looked at the paths taken by n_tty_receive_buf()
for how they would effect read_chan():
* tty state (put_tty_queue,eraser,finish_erasing,etc)
* read wakeups
* start_tty/stop_tty
* put_char/opost
everything looks OK without TTY_DONT_FLIP
2.0.X relied on the BKL (and dinosaurs roamed the Earth)
2.1.X introduced TTY_DONT_FLIP to prevent read_chan and
n_tty_receive_buf from executing at the same time.
2.2.15 added tty->read_lock around the N_TTY read buffer,
which is the only thing needing protection in this context.
The usual progression to finer grained locking.
This looks like a safe removal.
The review also revealed a spot in reset_buffer_flags()
where tty->read_lock needs to be extended around
modifications of canon_head, canon_data, and read_flags.
I'll make a patch for that.
-- 
Paul Fulghum
Microgate Systems, Ltd.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/