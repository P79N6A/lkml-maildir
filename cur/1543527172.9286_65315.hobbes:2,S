Date: Wed, 23 Feb 2000 21:03:27 +0200 (EET)
From: Timo Jantunen <>
Subject: Re: UDMA Problem on VIA chipset - K7M motherboard
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/2/23/191

> From: "Robert A. Morris" <ramorris@mit.edu>
> Date: Tue, 22 Feb 2000 14:56:33 EDT
> Subject: Re: UDMA Problem on VIA chipset - K7M motherboard
> I do have the correct 80-conductor cable, counted the wires to make sure,
> and the drives definitely do support up to UDMA mode 4.
> 
> Is there any way to get this to work?  There's a drastic speed improvement
> with -X 66 (hdparm -t goes from not quite 5 mb/sec to just over 21 mb/sec)
> and I'd love to get it to work.  Thanks!
I have K7M with IBM-DJNA-351520 (15GB, UDMA/66) as hda and QUANTUM FIREBALL
ST6.4A (6GB, UDMA/33) as hdb.
With old cable, I couldn't enable DMA (I got DMA error pretty soon) and with
PIO transfers, I got the expected high CPU usage and lower performace. If I
used both drivers at the same time (like when copying files from hda to hdb)
I got sometime those "lost interrupt" errors, which prevented access to both
drivers until reboot (both on 2.2.14 and 2.3.4x).
I got fed up with this and switched the cable to the 'correct' UDMA/66 cable.
Everything seemed to work well for a time, but few days after I noticed that
there is *data corruption* happening in older drive (hdb) when both drives
are active the same time.
After iterating through several versions of kernels, kernel settings and disk
positions I found out that the only combination that worked was switching by
DVD-ROM drive (TOSHIBA DVD-ROM SD-M1212) to the same cable as the UDMA/66
drive _and_ using kernel version 2.2.14. With this combination, the DMA works
even with simultaneous access as far as I have been able to find out.
If I use 2.3 kernels, I didn't notice data corruption, but the first time I
accessed my DVD or CD-RW drives (now hdb and hdd) I couldn't access parts of
my hard drives (hda and hdc), for example "fdisk -l /dev/hda" don't return
anything since /dev/hda can't be accessed (/dev/hda1 can) and
"fdisk -l /dev/hdc" returns partition 1 correctly (which is extended
partition) but the line for first logical partition is corrupted.
As a side note, I noticed that when doing "hdparm -t /dev/hdX" for both
harddisks at the same time got me about 3MB/s when they were in the same
controller and 13MB/s and 9MB/s when they were in the different controller.
So if you copy files between harddisks it seems that nowdays it really pays
to have them in a different cable.
If someone wants to debug that wierd access problem in 2.3 I'm willing to
experiment. If you want to ask me questions, you'd better cc: to me since I
read kernel-list mails only when I have time and it might take several days
until I see the mail from the list...
> Robert A. Morris <ramorris@mit.edu>
// /
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/