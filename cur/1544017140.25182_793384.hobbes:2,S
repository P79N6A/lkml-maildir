Date: Fri, 16 Jan 2009 08:13:38 -0500 (EST)
From: Steven Rostedt <>
Subject: Re: [PATCH 1/6] ftrace: move function tracer functions out of trace.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/16/190

On Thu, 15 Jan 2009, Andrew Morton wrote:
> On Thu, 15 Jan 2009 23:53:43 -0500 Steven Rostedt <rostedt@goodmis.org> wrote:
> 
> >  static void
> > +function_trace_call_preempt_only(unsigned long ip, unsigned long parent_ip)
> > +{
> > +	struct trace_array *tr = func_trace;
> > +	struct trace_array_cpu *data;
> > +	unsigned long flags;
> > +	long disabled;
> > +	int cpu, resched;
> > +	int pc;
> > +
> > +	if (unlikely(!ftrace_function_enabled))
> > +		return;
> 
> We're optimizing for the tracing-is-enabled case.  What's the thinking
> here?
This is called only when tracing _is_ enabled :-) Either it was enabled by 
the dynamic ftrace system, or there's another variable tested before 
jumping to the functions. This function must be register, and when it is, 
tracing is expected to run.
The reason for the "ftrace_function_enabled" variable is to prevent 
tracing to start before the stop_machine finishes. It is local to this one 
tracer. Without it, you get a lot of garbage on the start up of the 
tracer.
-- Steve