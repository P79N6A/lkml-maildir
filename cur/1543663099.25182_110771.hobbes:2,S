Date: 18 Feb 2003 22:11:14 +0100
From: Nicolas Mailhot <>
Subject: Re: [2.5] EHCI HID keyboard not unloaded at reboot time ?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/2/18/203

Le dim 16/02/2003 à 22:28, Pavel Machek a écrit :
> Hi!
> 
> > 	This is a question related to :
> > 
http://bugzilla.kernel.org/show_bug.cgi?id=9
> > 
> > 	Basically I have a usb keyboard plugged on an external USB2 hub. Using
> > a monolithic ehci/hid kernel I can get it to work in 2.5. It's also used
> > in usb1 mode by the bios and the bootloader.
> > 
> > 	However when I shut down or reboot from 2.5, I loose keyboard support
> > in the bios/bootloader/linux 2.4 (used to loose it in linux 2.5 also but
> > recent ehci enhancements enable 2.5 to recover it). Nothing short of a
> > PSU stop (neither reset nor stop button works) will recover it.
> 
> Well, if reset does not work, it looks like hw bug ;-). OTOH this
> might be quite easy to workaround in sw. What happens if you unplug
> and replug the keyboard?
Hey, thanks for the reply.
Turns out I was right about the diagnostic. 2.5 *did* *not* *unload*
*ehci*. So after the reboot all usb1-aware systems (bios, linux 2.4,
etc) found usb components that expected usb2 commands. David Brownell
send me a patch that forced ehci unload at shutdown (via a reboot
notifier) and all's been well since. So it was a real 2.5 bug.
Sure the hardware could have moped up usb remains better, but since
other evil OSes cleanup their usb stack correctly, I guess they didn't
bother (plus I suspect it would have made boot times a bit longer).
Anyway, closing one of the first ten bugzilla bugs at last one feels
very good:)
-- 
Nicolas Mailhot
[unhandled content-type:application/pgp-signature]