Date: Mon, 07 May 2007 14:11:36 -0700
From: Jeremy Fitzhardinge <>
Subject: Re: [patch 25/29] xen: Add the Xen virtual network device driver.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/7/295

Christoph Hellwig wrote:
> On Fri, May 04, 2007 at 04:21:16PM -0700, Jeremy Fitzhardinge wrote:
> 
>> +/*
>> + * Mutually-exclusive module options to select receive data path:
>> + *  rx_copy : Packets are copied by network backend into local memory
>> + *  rx_flip : Page containing packet data is transferred to our ownership
>> + * For fully-virtualised guests there is no option - copying must be used.
>> + * For paravirtualised guests, flipping is the default.
>> + */
>> +static enum {
>> +	RX_COPY = 0,
>> +	RX_FLIP = 1,
>> +} rx_mode = RX_FLIP;
>> +MODULE_PARM_DESC(rx_mode, "How to get packets from card: 0->copy, 1->flip");
>> 
>
> There only seems to be a module description but no actual paramter for
> this.  I wish people would have listened to me back then and made the
> description part of the modular_param statement..
Is this correct?
---
 drivers/net/xen-netfront.c |   32 ++++++++++++++++++++++++++++----
 1 file changed, 28 insertions(+), 4 deletions(-)
===================================================================
--- a/drivers/net/xen-netfront.c
+++ b/drivers/net/xen-netfront.c
@@ -62,16 +62,40 @@ struct netfront_cb {
 
 /*
  * Mutually-exclusive module options to select receive data path:
- *  rx_copy : Packets are copied by network backend into local memory
- *  rx_flip : Page containing packet data is transferred to our ownership
+ *  copy : Packets are copied by network backend into local memory
+ *  flip : Page containing packet data is transferred to our ownership
  * For fully-virtualised guests there is no option - copying must be used.
  * For paravirtualised guests, flipping is the default.
  */
-static enum {
+static enum rx_mode {
 	RX_COPY = 0,
 	RX_FLIP = 1,
 } rx_mode = RX_FLIP;
-MODULE_PARM_DESC(rx_mode, "How to get packets from card: 0->copy, 1->flip");
+MODULE_PARM_DESC(rx_mode, "How to get packets from card: \"copy\" or \"flip\"");
+
+static int set_rx_mode(const char *val, struct kernel_param *kp)
+{
+	enum rx_mode *rxmp = kp->arg;
+	int ret = 0;
+
+	if (strcmp(val, "copy") == 0)
+		*rxmp = RX_COPY;
+	else if (strcmp(val, "flip") == 0)
+		*rxmp = RX_FLIP;
+	else
+		ret = -EINVAL;
+
+	return ret;
+}
+
+static int get_rx_mode(char *buffer, struct kernel_param *kp)
+{
+	enum rx_mode *rxmp = kp->arg;
+
+	return sprintf(buffer, "%s", *rxmp == RX_COPY ? "copy" : "flip");
+}
+
+module_param_call(rx_mode, set_rx_mode, get_rx_mode, &rx_mode, 0400);
 
 #define RX_COPY_THRESHOLD 256
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/