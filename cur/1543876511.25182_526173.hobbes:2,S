Date: Mon, 02 Apr 2007 04:17:25 -0400
From: Dave Sperry <>
Subject: Re: Poor UDP performance using 2.6.21-rc5-rt5
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/4/2/105

Ingo Molnar wrote:
> * Dave Sperry <dave_sperry@ieee.org> wrote:
>
>> I have a dual core Opteron machine that exhibits poor UDP performance 
>> (RT consumes more than 2X cpu) with the 2.6.21-rc5-rt5 as compared to 
>> 2.6.21-rc5. Top shows the IRQ handler consuming a lot of CPU.
>
> update: even with acpi_pm clocksource on vanilla i can reproduce similar 
> overhead using netperf.
>
> 	Ingo
>
Hi Ingo
I checked the clock source and in both the vanilla and rt cases and they 
were both acpi_pm
Here's the oprofile for my vanilla case:
 CPU: AMD64 processors, speed 2211.37 MHz (estimated)
Counted CPU_CLK_UNHALTED events (Cycles outside of halt state) with a 
unit mask of 0x00 (No unit mask) count 100000
samples  %        image name               app name                 
symbol name
36264    18.2763  forcedeth.ko             forcedeth                
nv_nic_irq_optimized
25602    12.9029  vmlinux                  vmlinux                  
spurious_interrupt
10067     5.0736  forcedeth.ko             forcedeth                
nv_start_xmit_optimized
8671      4.3700  vmlinux                  vmlinux                  
unregister_kprobe
8270      4.1679  vmlinux                  vmlinux                  
ctrl_dumpfamily
8042      4.0530  vmlinux                  vmlinux                  
expand_files
5064      2.5521  vmlinux                  vmlinux                  kfree
4365      2.1999  libc-2.5.so              libc-2.5.so              
__sendto_nocancel
4067      2.0497  vmlinux                  vmlinux                  
unix_bind
4010      2.0210  vmlinux                  vmlinux                  bad_gs
3929      1.9801  vmlinux                  vmlinux                  
__alloc_skb
3859      1.9449  vmlinux                  vmlinux                  
stack_segment
3107      1.5659  vmlinux                  vmlinux                  
__find_get_block
2816      1.4192  vmlinux                  vmlinux                  
vfs_create
2611      1.3159  vmlinux                  vmlinux                  
ide_end_drive_cmd
2604      1.3124  vmlinux                  vmlinux                  
ide_end_request
2560      1.2902  vmlinux                  vmlinux                  
find_get_page
2458      1.2388  vmlinux                  vmlinux                  
hrtimer_run_queues
2456      1.2378  vmlinux                  vmlinux                  
get_wchan
2403      1.2111  forcedeth.ko             forcedeth                
nv_tx_done_optimized
2231      1.1244  vmlinux                  vmlinux                  
do_sys_poll
Any thoughts?
Thanks
Dave
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/