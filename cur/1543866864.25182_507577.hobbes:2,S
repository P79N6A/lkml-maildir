Date: Sun, 11 Feb 2007 17:04:55 -0600
From: Robert Hancock <>
Subject: Re: sata_nv - ADMA issues with 2.6.20
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/11/193

BjÃ¶rn Steinbrink wrote:
> If the look like this, you might want to try a few patches that are in
> -mm.
> 
> ata1.00: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x2 frozen
> ata1.00: cmd e7/00:00:00:00:00/00:00:00:00:00/a0 tag 0 cdb 0x0 data 0 out
>          res 40/00:00:00:00:00/00:00:00:00:00/00 Emask 0x4 (timeout)
> ata1: soft resetting port
> 
> We thought that Robert had fixed these with some changes that went into
> -rc6. But they reappeared a few days later, the -mm patches seem to have
>  finally cured it.
> 
> The original patches are here:
> 
> 
http://www2.kernel.org/pub/linux/kernel/people/akpm/patches/2.6/2.6.20-rc6/2.6.20-rc6-mm3/broken-out/sata_nv-cleanup-adma-error-handling-v2.patch
> 
http://www2.kernel.org/pub/linux/kernel/people/akpm/patches/2.6/2.6.20-rc6/2.6.20-rc6-mm3/broken-out/sata_nv-cleanup-adma-error-handling-v2-cleanup.patch
> 
http://www2.kernel.org/pub/linux/kernel/people/akpm/patches/2.6/2.6.20-rc6/2.6.20-rc6-mm3/broken-out/sata_nv-use-adma-for-nodata-commands.patch
> 
> As they had a few rejects against 2.6.20-rc7, I'm attaching my fixed all-in-one version of these patches, I guess it should apply to 2.6.20 just fine.
This isn't quite the same as that problem we were seeing, these are an 
actual NCQ read/write that is timing out and not a cache flush command. 
Nevertheless it wouldn't hurt for people having this problem to test out 
the latest and greatest sata_nv patches. In particular there was one 
that I resurrected from the debugging of that problem, "sata_nv: wait 
for response on entering/leaving ADMA mode" which though it didn't end 
up fixing it, seemed like a good thing to be doing anyway, and which 
potentially might have some effect on this problem here.
All the patches I have for sata_nv are in Linus' git tree, that is 
probably a simpler way to test them than -mm right now - applying the 
2.6.20-git6 patch on top of 2.6.20 should do it.
-- 
Robert Hancock      Saskatoon, SK, Canada
To email, remove "nospam" from hancockr@nospamshaw.ca
Home Page: 
http://www.roberthancock.com/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/