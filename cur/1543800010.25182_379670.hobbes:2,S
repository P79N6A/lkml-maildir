Date: Wed, 28 Dec 2005 18:23:23 +0100
From: Paolo Ornati <>
Subject: Re: [SCHED] Totally WRONG prority calculation with specific test-case (since 2.6.10-bk12)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/28/110

On Wed, 28 Dec 2005 12:35:47 +0100
Paolo Ornati <ornati@fastwebnet.it> wrote:
> > This latter thing sounds more like your transcode job pushed everything out to 
> > swap... You need to instrument this case better.
> > 
> 
> I don't know. The combination Swapped Out Programs + "normal" priority
> strangeness can potentially result in a total disaster... but why
> renicing transcode to "0" gets the system usable again?
> 
> Next time I'll grab "/proc/meminfo"... and what other info can help to
> understand?
I'm doing some tests with "ingosched" and a bit longer trancoding
session and I've found a strange thing.
DD running time can change a LOT between one run and another (always
while transcode is running):
----------------------------------------------------------------------
paolo@tux /mnt $ mount space/; sync; sleep 1; time dd if=space/bigfile
of=/dev/null bs=1M count=256; umount space/ 256+0 records in
256+0 records out
real    0m15.754s
user    0m0.000s
sys     0m0.500s
paolo@tux /mnt $ mount space/; sync; sleep 1; time dd if=space/bigfile
of=/dev/null bs=1M count=256; umount space/ 256+0 records in
256+0 records out
real    0m52.966s
user    0m0.000s
sys     0m0.504s
paolo@tux /mnt $ mount space/; sync; sleep 1; time dd if=space/bigfile
of=/dev/null bs=1M count=256; umount space/ 256+0 records in
256+0 records out
real    0m48.928s
user    0m0.004s
sys     0m0.524s
---------------------------------------------------------------------
Looking at top while running these I've seen that this is related to
how transcode's (the one that eats a lot of CPU) priority changes.
When only transcoding his priority is 16, but when also DD test is
running then that value fluctuate between 16 and 18.
DD priority is always 18 instead.
Usually transcode's prio go to 17/18 and DD runs in 15/20s, but
sometimes it doesn't fluctuate staying stuck to 16 and DD runs in ~50s.
PS:
I'm not yet able to reproduce the "totally unusable system" I was
talking about.
-- 
	Paolo Ornati
	Linux 2.6.15-rc7-plugsched on x86_64
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/