Date: Wed, 11 Feb 2004 20:26:30 +0100
From: Takashi Iwai <>
Subject: Re: 2.6.3-rc1: snd_intel8x0 still too fast
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/11/157

At Wed, 11 Feb 2004 18:49:36 +0200 (EET),
Meelis Roos wrote:
> 
> > hmm, please show /proc/asound/card0/codec97#0/ac97#0-0 and
> > ac97#0-0+regs files again?
oops, the patch was wrong.  could you try this one (and remove
/etc/asound.state before starting ALSA?)
also, if it still doesn't work, try to change the ADC VRA.
for example, run "arecord -fS16_LE -r44100 foo.wav" once before
playing 44100 samples.
also, to make sure that it's a hardware problem, please avoid mono
samples but use 16bit stereo samples only.
Takashi
--- linux/sound/pci/ac97/ac97_patch.c	9 Feb 2004 11:38:03 -0000	1.35
+++ linux/sound/pci/ac97/ac97_patch.c	11 Feb 2004 12:08:20 -0000	1.36
@@ -652,7 +652,7 @@
 
 static const snd_kcontrol_new_t snd_ac97_controls_ad1885[] = {
 	AC97_SINGLE("Digital Mono Direct", AC97_AD_MISC, 11, 1, 0),
-	AC97_SINGLE("Digital Audio Mode", AC97_AD_MISC, 12, 1, 0),
+	/* AC97_SINGLE("Digital Audio Mode", AC97_AD_MISC, 12, 1, 0), */ /* seems problematic */
 	AC97_SINGLE("Low Power Mixer", AC97_AD_MISC, 14, 1, 0),
 	AC97_SINGLE("Zero Fill DAC", AC97_AD_MISC, 15, 1, 0),
 };
@@ -682,6 +682,9 @@
 	jack = snd_ac97_read(ac97, AC97_AD_JACK_SPDIF);
 	snd_ac97_write_cache(ac97, AC97_AD_JACK_SPDIF, jack | 0x0300);
 
+	/* set default */
+	snd_ac97_write_cache(ac97, AC97_AD_MISC, 0x0404);
+
 	ac97->build_ops = &patch_ad1885_build_ops;
 	return 0;
 }