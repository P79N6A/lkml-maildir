Date: Mon, 17 Dec 2007 14:27:23 +0100
From: "Michael Kerrisk" <>
Subject: Re: Tesing of / bugs in new timerfd API
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/17/104

Hi Davide,
On 12/16/07, Davide Libenzi <davidel@xmailserver.org> wrote:
> On Fri, 14 Dec 2007, Michael Kerrisk wrote:
>
> > You snipped my example that demonstrated the problem.  Both of the
> > following runs create a timer that expires 10 seconds from "now", but
> > observe the difference in the value returned by timerfd_gettime():
> >
> > $ ./timerfd_test 10         # does not use TFD_TIMER_ABSTIME
> > Initial setting for settime:   value=10.000, interval=0.000
> > ./timerfd_test> g
> > (elapsed time=  1)
> > Current value:                 value=346.448, interval=0.000
> >
> > $ ./timerfd_test -a 10      # uses TFD_TIMER_ABSTIME
> > Initial setting for settime:   value=1197630855.254, interval=0.000
> > ./timerfd_test> g
> > (elapsed time=  1)
> > Current value:                 value=1197630855.254, interval=0.000
> >
> > Either there's an inconsistency here depending on the use of
> > TFD_TIMER_ABSTIME, or there is a bug in my understanding or my test
> program
> > (but so far I haven't spotted that bug ;-).).
>
> Can you try the two patches below? I tried them on my 32 bit box (one of
> the rare beasts still lingering around here) and it seems to be working
> fine (those go on top of the previous ones).
Against 2.6.24-rc5, I applied first your earlier patches ("v3") and
then the newest patch.  My tests confirm that:
> This fixed the 32 bit tick-count truncation, and makes the time returned
> to be the remaining time till the next expiration.
Are you going to resubmit a new patch set that includes these latest changes?
Michael