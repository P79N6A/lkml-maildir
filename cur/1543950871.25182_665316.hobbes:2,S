Date: Sat, 8 Mar 2008 23:19:09 +0300
From: Oleg Nesterov <>
Subject: Re: [PATCH] waitid si_code regression
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/8/102

On 03/08, Roland McGrath wrote:
> 
> In commit ee7c82da830ea860b1f9274f1f0cdf99f206e7c2, the magic (short)
> cast when storing si_code was lost in wait_task_stopped.  This leaks
> the in-kernel CLD_* values that do not match what userland expects.
> 
> diff --git a/kernel/exit.c b/kernel/exit.c
> index cd20bf0..53872bf 100644
> --- a/kernel/exit.c
> +++ b/kernel/exit.c
> @@ -1378,7 +1378,7 @@ unlock_sig:
>  	if (!retval && infop)
>  		retval = put_user(0, &infop->si_errno);
>  	if (!retval && infop)
> -		retval = put_user(why, &infop->si_code);
> +		retval = put_user((short)why, &infop->si_code);
Ugh, thanks.
Oleg.