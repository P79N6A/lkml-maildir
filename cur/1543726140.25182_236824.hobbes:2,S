Date: Wed, 28 Jul 2004 09:03:39 -0400
From: Chris Mason <>
Subject: Re: writepages drops bh on not uptodate page
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/7/28/96

On Wed, 2004-07-28 at 00:51, Andrea Arcangeli wrote:
> Hi Andrew,
> 
> I think I understood why some ext2 fs corruption still happens even
> after the last i_size fix.
> 
> what happened I believe is that the writepages layer got a not a fully
> uptodate page (in turn with bh mapped on top of it), and then right
> before unlocking the page and entering the writeback mode, it freed all
> the bh. 
Ahhhh, this really explains it, thanks andrea.  I agree your fix should
solve things, but I'm wondering if we shouldn't make readpage[s] do a
wait_on_page_writeback().  That might do a better job of protecting us
from future variations of this problem.
-chris
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/