Date: Mon, 14 Aug 2006 11:00:38 +0200
From: "Rafael J. Wysocki" <>
Subject: Re: [PATCH -mm 5/5] swsusp: Use memory bitmaps during resume
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/8/14/59

On Monday 14 August 2006 00:04, Andrew Morton wrote:
> On Thu, 10 Aug 2006 15:23:41 +0200
> "Rafael J. Wysocki" <rjw@sisk.pl> wrote:
> 
> > Make swsusp use memory bitmaps to store its internal information during the
> > resume phase of the suspend-resume cycle.
> 
> This patch makes the resume-time disk IO go all slow again.
> 
> Time to read 80k pages:
> 
> 2.6.18-rc4:				24 seconds
> 2.6.18-rc4+akpm-speedups:		10 seconds
> 2.6.18-rc4+akpm-speedups+this-patch:	24 seconds
Well, I removed one line too many, sorry.
 kernel/power/snapshot.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletion(-)
Index: linux-2.6.18-rc4-mm1/kernel/power/snapshot.c
===================================================================
--- linux-2.6.18-rc4-mm1.orig/kernel/power/snapshot.c
+++ linux-2.6.18-rc4-mm1/kernel/power/snapshot.c
@@ -1278,13 +1278,14 @@ int snapshot_write_next(struct snapshot_
 				chain_init(&ca, GFP_ATOMIC, PG_SAFE);
 				memory_bm_position_reset(&orig_bm);
 				restore_pblist = NULL;
-				handle->sync_read = 0;
 				handle->buffer = get_buffer(&orig_bm, &ca);
+				handle->sync_read = 0;
 				if (!handle->buffer)
 					return -ENOMEM;
 			}
 		} else {
 			handle->buffer = get_buffer(&orig_bm, &ca);
+			handle->sync_read = 0;
 		}
 		handle->prev = handle->cur;
 	}
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/