Date: Wed, 7 Jan 2004 20:49:22 +0100
From: Paolo Ornati <>
Subject: Re: HiSax freezes 2.6.0-test11
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/1/7/222

On Tuesday 06 January 2004 14:05, Valentijn Sessink wrote:
> Hello list,
>
> My 2.6.0-test11 "hisax" module freezes my PC, but seems to handle
> interrupts, as ICMP and keyboard leds keep functioning. I sent mail to
> kkeil and kai.germaschewski and to the ISDN mailing list, but no reply.
> I'm willing to test and/or hunt for the bug, but don't know where to
> look. As this interrupt behaviour seems rather specific, maybe someone
> could help me out where to look?
It also freezes on my PC... it seems very broken!
When I wrote to LKML asking for help Simon Cahuk <simon.cahuk@uni-mb.si> 
suggested me to try mISDN ( ftp.isdn4linux.de )
... and it seems to work (for me).
MORE INFO (quoted from Simon Cahuk)
_____________________________________________________________________
What you need:
- 2.6.0-test9-bk22 (or later) or 2.4.20 kernel? (or later)
- I4L patch for 2.6.0-test9-bk22 (patches cleanly test10 and test11)
- mISDN (mISDN-CVS tarball or mISDN direct from CVS server)
- supported ISDN card.
Download and extract the mISDN-CVS tarball from ftp.isdn4linux.de/snapshots.
Unpack it. 
Then make a symbolic link to your kernel source:
cd /usr/src
ln -sf your_kernel_source linux
Go to your mISDN source and run from there:
./std2kern
Patch your kernel (I4L patch):
cd /usr/src/linux
zcat path_to_the_I4L_patch.gz | patch -p1
This will copy the mISDN stuff to your kernel source. Please check that
your /usr/src/linux link exists before you run std2kern.
Configure your kernel as usually and enable the following:
CONFIG_ISDN_BOOL=y
CONFIG_ISDN_CAPI=m
CONFIG_ISDN_DRV_AVMB1_VERBOSE_REASON=y
CONFIG_ISDN_CAPI_MIDDLEWARE=y
CONFIG_ISDN_CAPI_CAPI20=m
CONFIG_ISDN_CAPI_CAPIFS_BOOL=y
CONFIG_ISDN_CAPI_CAPIFS=m
CONFIG_MISDN_DRV=m
CONFIG_MISDN_MEMDEBUG=y
CONFIG_MISDN_AVM_FRITZ=y # if you have an AVM Fritz card
CONFIG_MISDN_HFCPCI=y # if you have a HFPCI card
CONFIG_MISDN_SPEEDFAX=y # if you have a SPEEDFAX card
CONFIG_MISDN_W6692=y # if you have a  W6692 card
CONFIG_MISDN_DSP=y
Reboot your machine and boot the new kernel. 
Here is a script (from Karsten) to load the modules:
#!/bin/sh
if [ $# -ge 1 ]; then
        DEBUG=$1
else
        DEBUG=0
fi
#INSMOD_PARA=-m
MEXT=.ko
cd /lib/modules/`uname -r`/kernel/drivers/isdn/hardware/mISDN
#modprobe capidrv
modprobe capi
insmod ${INSMOD_PARA} mISDN_core${MEXT} debug=${DEBUG} >/tmp/m_core.mod
insmod ${INSMOD_PARA} mISDN_l1${MEXT} debug=${DEBUG} >/tmp/m_l1.mod
insmod ${INSMOD_PARA} mISDN_l2${MEXT} debug=${DEBUG} >/tmp/m_l2.mod
insmod ${INSMOD_PARA} l3udss1${MEXT} debug=${DEBUG} >/tmp/m_l3u.mod
insmod ${INSMOD_PARA} mISDN_capi${MEXT} debug=${DEBUG} >/tmp/m_capi.mod
insmod ${INSMOD_PARA} mISDN_isac${MEXT} >/tmp/m_isac.mod
insmod ${INSMOD_PARA} avmfritz${MEXT} debug=${DEBUG} protocol=2 > /tmp/
avmfritz
.mod
Then mount capifs:
mkdir /dev/capi
mount -t capifs capifs /dev/capi
or add to fstab: 
capifs              /dev/capi       capifs          defaults                
0 
0
Now run pppd:
pppd call isdn/arcor.
If ps ax shows
<PID> ?        S      0:00 pppd call isdn/arcor
then kill pppd with kill -9 <PID> and run pppd again. Then should ps ax 
show:
<PID> capi/0   S      0:00 pppd call isdn/arcor. 
_____________________________________________________________________
Example of isdn/arcor file:
_____________________________________________________________________
With CAPI you use pppd. Edit your /etc/ppp/peers/isdn/arcor file and start:
pppd call isdn/arcor. You disconnect with killing the pppd pid.
My arcor:
sync
noauth
user USERNAME
plugin userpass.so
password PASSWORD
defaultroute
plugin capiplugin.so
number 088932331
protocol hdlc
ipcp-accept-local
ipcp-accept-remote
/dev/null
Capiplugin comes with capi4k-utils.
Simon
_____________________________________________________________________
BYE
-- 
	Paolo Ornati
	Linux v2.4.23
[unhandled content-type:application/x-gzip]