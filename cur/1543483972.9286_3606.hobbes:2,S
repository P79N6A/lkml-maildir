Date: Tue, 02 Feb 1999 17:29:34 -0800
From: "G. Allen Morris III" <>
Subject: Re: 2.2.1: another knfsd trouble
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/2/2/227

Eugene,
>>>Eugene Crosser said:
 > Directory from a Linux running pure 2.2.1 on a UP Pentium is exported
 > to SUNs running Solaris 2.5.1.  After a few days of normal work,
 > `ld' run on Solaris in exported directory started segfaulting.  At
 > the same time, there are messages on Linux:
 > 
 > Feb  1 18:59:47 ariel kernel: nfsd: RC_REPLSTAT/reply len 33!
 > Feb  1 18:59:48 ariel kernel: nfsd: RC_REPLSTAT/reply len 40!
 > Feb  1 18:59:51 ariel kernel: nfsd Security: export/home bad export.
 > Feb  1 19:00:08 ariel kernel: nfsd: RC_REPLSTAT/reply len 59!
 > Feb  1 19:00:09 ariel kernel: nfsd Security: export/home bad export.
The patch below should fix the RC_REPLSTAT/reply len problem.  The
`export/home bad export' is generated when you use an export of
one filesystem to access another filesystem.  `mountd' should
catch this, so I am not sure what is going on.  Is `/home' on the
same partition as `/'?  What is the output from `/proc/fs/nfsd/exports'?
`ld' should be getting an ESTALE error, Sun must not catch that.
diff -u linux-2.2.1/fs/nfsd/nfsproc.c linux/fs/nfsd/nfsproc.c
--- linux-2.2.1/fs/nfsd/nfsproc.c	Wed Jul 22 14:37:36 1998
+++ linux/fs/nfsd/nfsproc.c	Mon Feb  1 15:14:33 1999
@@ -515,7 +515,7 @@
   PROC(symlink,	 symlinkargs,	void,		none,		RC_REPLSTAT),
   PROC(mkdir,	 createargs,	diropres,	fhandle,	RC_REPLBUFF),
   PROC(rmdir,	 diropargs,	void,		none,		RC_REPLSTAT),
-  PROC(readdir,	 readdirargs,	readdirres,	none,		RC_REPLSTAT),
+  PROC(readdir,	 readdirargs,	readdirres,	none,		RC_REPLBUFF),
   PROC(statfs,	 fhandle,	statfsres,	none,		RC_NOCACHE),
 };
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/