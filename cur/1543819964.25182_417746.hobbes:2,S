Date: Sat, 22 Apr 2006 01:06:23 +0900
From: OGAWA Hirofumi <>
Subject: [PATCH] X86_NUMAQ build fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/21/207

Hi,
This patch fixes the build breakage of X86_NUMAQ. And this declares
xquad_portio on only X86_NUMAQ.
Please apply.
-- 
OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>
Signed-off-by: OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>
---
 arch/i386/boot/compressed/misc.c |    4 +++-
 arch/i386/kernel/smpboot.c       |    2 +-
 arch/i386/pci/Makefile           |    3 ++-
 3 files changed, 6 insertions(+), 3 deletions(-)
diff -puN arch/i386/pci/Makefile~numaq-build-fix arch/i386/pci/Makefile
--- linux-2.6/arch/i386/pci/Makefile~numaq-build-fix	2006-04-22 00:54:29.000000000 +0900
+++ linux-2.6-hirofumi/arch/i386/pci/Makefile	2006-04-22 00:55:27.000000000 +0900
@@ -5,10 +5,11 @@ obj-$(CONFIG_PCI_MMCONFIG)	+= mmconfig.o
 obj-$(CONFIG_PCI_DIRECT)	+= direct.o
 
 pci-y				:= fixup.o
-pci-$(CONFIG_ACPI)		+= acpi.o
 pci-y				+= legacy.o irq.o
 
 pci-$(CONFIG_X86_VISWS)		:= visws.o fixup.o
 pci-$(CONFIG_X86_NUMAQ)		:= numa.o irq.o
 
+pci-$(CONFIG_ACPI)		+= acpi.o
+
 obj-y				+= $(pci-y) common.o
diff -puN arch/i386/boot/compressed/misc.c~numaq-build-fix arch/i386/boot/compressed/misc.c
--- linux-2.6/arch/i386/boot/compressed/misc.c~numaq-build-fix	2006-04-22 00:54:29.000000000 +0900
+++ linux-2.6-hirofumi/arch/i386/boot/compressed/misc.c	2006-04-22 00:54:29.000000000 +0900
@@ -122,7 +122,9 @@ static int vidport;
 static int lines, cols;
 
 #ifdef CONFIG_X86_NUMAQ
-static void * xquad_portio = NULL;
+/* hack to avoid using xquad_portio=NULL */
+#undef outb_p
+#define outb_p		outb_local_p
 #endif
 
 #include "../../../../lib/inflate.c"
diff -puN arch/i386/kernel/smpboot.c~numaq-build-fix arch/i386/kernel/smpboot.c
--- linux-2.6/arch/i386/kernel/smpboot.c~numaq-build-fix	2006-04-22 00:54:29.000000000 +0900
+++ linux-2.6-hirofumi/arch/i386/kernel/smpboot.c	2006-04-22 00:54:29.000000000 +0900
@@ -1116,9 +1116,9 @@ static void smp_tune_scheduling (void)
  */
 
 static int boot_cpu_logical_apicid;
+#ifdef CONFIG_X86_NUMAQ
 /* Where the IO area was mapped on multiquad, always 0 otherwise */
 void *xquad_portio;
-#ifdef CONFIG_X86_NUMAQ
 EXPORT_SYMBOL(xquad_portio);
 #endif
 
_
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/