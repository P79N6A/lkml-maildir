Date: Sun, 26 Jun 2005 05:53:53 +0200
From: Christian Trefzer <>
Subject: Re: 2.6.12 initrd module loading seems parallel on bootup
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/6/25/132

Well, although I cannot comment on your exact situation, I guess I see 
the same problem here. When checking out 2.6.12 for the first time, my 
little early-userspace environment had some serious trouble configuring 
the scsi|md|lvm setup which worked flawlessly before. The plan was to 
load required modules for disks, then md, bring up the arrays and 
activate the LVs. But it takes several seconds (!) until device nodes 
appear after modprobe has terminated correctly. For me, the quick ugly 
fix was to introduce a delay loop in the bash scripts which waits for 
important device nodes before proceeding, similar to that:
function wait_for_node{} (
	echo -en "Waiting for ${1} to appear..."
	while [ ! -e ${1} ]
	do
		echo -en "."
		sleep 1s
	done
	echo " done."
)
This one can be called with any node important for the next 
initialization step. In my case, I wait for disk partitions to appear 
before RAID initialization:
	wait_for_node /dev/sda1
You could wait for your root partition to come up, instead of running 
into the vfs panic while trying to mount it. But that won't solve the 
original problem, I fear...
Yours,
Chris
[unhandled content-type:application/pgp-signature]