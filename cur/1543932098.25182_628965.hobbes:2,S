Date: Mon, 17 Dec 2007 13:41:06 +0000
From: "Jan Beulich" <>
Subject: Re: [PATCH] x86: fix ref-counting bug in change_page_attr()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/17/117

>>> Ingo Molnar <mingo@elte.hu> 17.12.07 14:28 >>>
>
>* Jan Beulich <jbeulich@novell.com> wrote:
>
>> When either calling change_page_attr() with the default attributes 
>> pages in the direct mapping have and a page's attributes already were 
>> set to the default or when changing the attributes from one 
>> non-default value to another, the reference counting broke, leading to 
>> either premature restoration of a large page or missing the 
>> opportunity to do so.
>> 
>> At the same time, make __PHYSICAL_MASK_SHIFT on 64-bits the value it 
>> architecturally ought to have.
>
>hm, does this patch fix any real bug seen live? (if yes then do you have 
>links to it, etc?) It would be a v2.6.24 fix in theory but it looks too 
>dangerous for that. So i've queued it up for v2.6.25, for the time 
>being.
I had run into the issue with experimental code of mine quite a while back
(i.e. I don't even recall what exactly I was doing back then). After that I
just continued to keep the fix (which I had submitted before, but which
collided with something in Andi's tree back then iirc).
Jan