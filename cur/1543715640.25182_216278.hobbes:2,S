Date: Mon, 26 Apr 2004 22:23:14 +1000
From: Herbert Xu <>
Subject: Re: Bug#241107: Acknowledgement (kernel-image-2.4.24-1-686: 8139too ethernet driver's iomem resource not freed up on rmmod.)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/4/26/62

On Sat, Apr 24, 2004 at 09:10:04PM +0000, Luke Kenneth Casson Leighton wrote:
>
> Apr 24 21:01:33 localhost kernel: acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.4
> Apr 24 21:02:00 localhost kernel: cpqphp: Compaq Hot Plug PCI Controller Driver version: 0.9.7
> Apr 24 21:02:08 localhost kernel: shpchp: acpi_shpchprm:get_device PCI ROOT HID fail=0x1001
> Apr 24 21:02:13 localhost kernel: acpi: Unknown symbol acpi_processor_unregister_performance
> Apr 24 21:02:13 localhost kernel: acpi: Unknown symbol acpi_processor_register_performance
> Apr 24 21:02:44 localhost kernel: acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.4
> Apr 24 21:02:44 localhost kernel: Unable to handle kernel paging request at virtual address d0a95cf8
> Apr 24 21:02:44 localhost kernel:  printing eip:
> Apr 24 21:02:44 localhost kernel: c01c8d35
> Apr 24 21:02:44 localhost kernel: *pde = 0fa26067
> Apr 24 21:02:44 localhost kernel: *pte = 00000000
> Apr 24 21:02:44 localhost kernel: Oops: 0000 [#1]
> Apr 24 21:02:44 localhost kernel: PREEMPT 
> Apr 24 21:02:44 localhost kernel: CPU:    0
> Apr 24 21:02:44 localhost kernel: EIP:    0060:[acpi_pci_register_driver+25/92]    Not tainted
Thanks.
The first load of acpiphp didn't clean up properly.  This patch should
fix it.
You can get the updated acpiphp module for that kernel at
http://gondor.apana.org.au/debian/kernel/binary/2.6.5/686/
Cheers,
-- 
Debian GNU/Linux 3.0 is out! ( 
http://www.debian.org/
 )
Email:  Herbert Xu 许志壬 <herbert@gondor.apana.org.au>
Home Page: 
http://gondor.apana.org.au/herbert/
PGP Key: 
http://gondor.apana.org.au/herbert/pubkey.txt
Index: drivers/pci/hotplug/acpiphp_glue.c
===================================================================
RCS file: /home/gondolin/herbert/src/CVS/debian/kernel-source-2.5/drivers/pci/hotplug/acpiphp_glue.c,v
retrieving revision 1.1.1.8
diff -u -r1.1.1.8 acpiphp_glue.c
--- a/drivers/pci/hotplug/acpiphp_glue.c	5 Apr 2004 09:49:33 -0000	1.1.1.8
+++ b/drivers/pci/hotplug/acpiphp_glue.c	26 Apr 2004 12:18:46 -0000
@@ -1113,6 +1113,8 @@
 
 		kfree(bridge);
 	}
+
+	acpi_pci_unregister_driver(&acpi_pci_hp_driver);
 }
 
 