Date: Fri, 1 Sep 2000 18:31:45 -0400
From: Rick <>
Subject: Re: Press release - here we go again!
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/1/101

On Fri, Sep 01, 2000 at 02:00:25PM -0600, TimO wrote:
> Daniel Stone wrote:
> >    -> Multimedia
> >       * Faster multimedia with specially designed video acceleration drivers. In combination with the new release of the X Windows System, Linux includes drivers to take full advantage of your accelerated video card (nVidia and 3Dfx cards among those supported) to get maximum video performance for gaming, graphics, etc.
> 
> Actually it seems that hardware acceleration for nVidia cards has
> momentarily
> died with the loss of MAP_NR in page[cache].h.  NVidia only claims to 
> support 2.2.x kernels.  If updated drivers do exist, I would definitely
> love to hear about them.
Works perfectly for me with 2.4.0test7; the patch is fairly simple (as
noted by the fact that I have no clue what the stuff I changed does).
I'll attach it.
-- 
Rick (rick@kuroyi.net)
http://www.kuroyi.net
What the hell is content? Nobody buys content. Real people pay money
for music because it means something to them. A great song is not just
something to take up space on a Web site next to stock market quotes
and baseball scores.
	-- Courtney Love
--- NVIDIA_kernel-0.9-4/nv.c	Mon Jul 10 18:32:13 2000
+++ NVIDIA_kernel-2.4/nv.c	Wed Aug  9 15:22:13 2000
@@ -549,5 +549,5 @@
         unsigned long page = get_phys_address( (unsigned long) 
             (address + (i * PAGE_SIZE)));
-        unsigned long map_nr = MAP_NR(__va(page));
+        struct page* map_nr = virt_to_page(__va(page));
         if (map_nr)
         {
@@ -573,9 +573,9 @@
     {
         unsigned long page = get_phys_address(address + (i * PAGE_SIZE));
-        unsigned long map_nr = MAP_NR(__va(page));
+        struct page* map_nr = virt_to_page(__va(page));
         if (map_nr)
         {
             mem_map_dec_count(map_nr);
-            if (atomic_read(&mem_map[map_nr].count) == 1)
+            if (atomic_read(&(map_nr->count)) == 1)
                 mem_map_unreserve(map_nr);
             else
--- NVIDIA_kernel-0.9-4/os-interface.c	Mon Jul 10 18:32:13 2000
+++ NVIDIA_kernel-2.4/os-interface.c	Wed Aug  9 15:14:05 2000
@@ -1226,5 +1226,5 @@
     while (num_pages--)
     {
-        mem_map_reserve(MAP_NR(tmp_paddr)); 
+        mem_map_reserve(virt_to_page(tmp_paddr)); 
         tmp_paddr += PAGE_SIZE;
     }
@@ -1241,5 +1241,5 @@
     while (num_pages--)
     {
-        mem_map_unreserve(MAP_NR(tmp_paddr));
+        mem_map_unreserve(virt_to_page(tmp_paddr));
         tmp_paddr += PAGE_SIZE;
     }