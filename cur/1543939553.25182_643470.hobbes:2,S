Date: Fri, 25 Jan 2008 11:39:33 -0800
From: Jeremy Fitzhardinge <>
Subject: Re: [PATCH] x86: trim ram need to check if mtrr is there v3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/25/476

Yinghai Lu wrote:
> On Jan 25, 2008 11:27 AM, Jeremy Fitzhardinge <jeremy@goop.org> wrote:
> 
>> Ingo Molnar wrote:
>> 
>>> * Jeremy Fitzhardinge <jeremy@goop.org> wrote:
>>>
>>>
>>> 
>>>> I was referring to:
>>>>
>>>> commit 6a4544a9c8b54b82893044cb53695502cc386f00
>>>> Author: Yinghai Lu <Yinghai.Lu@Sun.COM>
>>>> Date:   Fri Jan 25 00:15:29 2008 +0100
>>>>
>>>>    x86_32: trim memory by updating e820 v3
>>>>
>>>> but you've answered the question...
>>>>
>>>> 
>>> yeah, i guess what i've pushed out just now is v3++. Does it work for
>>> you?
>>>
>>> 
>> Yes, it does.  And for the record:
>>
>> [root@qemu ~]# cat /proc/mtrr
>> [root@qemu ~]#
>> 
>
> so the boot msg say:
> WARNING: strange, CPU MTRRs all blank?
> 
Yes.
WARNING: strange, CPU MTRRs all blank?
------------[ cut here ]------------
WARNING: at /home/jeremy/hg/xen/paravirt/linux/arch/x86/kernel/cpu/mtrr/main.c:710 mtrr_trim_uncached_memory+0xf8/0x17b()
Modules linked in:
Pid: 0, comm: swapper Not tainted 2.6.24 #1938
 [<c012804c>] warn_on_slowpath+0x41/0x51
 [<c01285d4>] ? __call_console_drivers+0x4e/0x5a
 [<c03c3e85>] ? _spin_unlock_irqrestore+0xf/0x2f
 [<c03c3e91>] ? _spin_unlock_irqrestore+0x1b/0x2f
 [<c012880c>] ? release_console_sem+0x1a0/0x1a8
 [<c0128c1f>] ? vprintk+0x294/0x2ee
 [<c0128c2b>] ? vprintk+0x2a0/0x2ee
 [<c04e811b>] ? __alloc_bootmem_core+0x100/0x27a
 [<c0128c8e>] ? printk+0x15/0x17
 [<c0128c8e>] ? printk+0x15/0x17
 [<c04de51e>] mtrr_trim_uncached_memory+0xf8/0x17b
 [<c04de7ae>] ? mtrr_bp_init+0x20d/0x215
 [<c04dc79b>] setup_arch+0x283/0x3c2
 [<c0128c8e>] ? printk+0x15/0x17
 [<c04d6689>] start_kernel+0x60/0x311
 =======================
	J