Date: Thu, 04 Sep 2003 20:52:56 -0500
From: watermodem <>
Subject: Re: 2.6.0-test4  on to mpegs and DVB
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/4/414

Andrew Morton wrote:
> watermodem <aquamodem@ameritech.net> wrote:
> 
>>The DVD looked and sounded great, but, it was using 
>> 98% of the CPU!  2.4 never used that much.
> 
> 
> A kernel profile will be needed to diagnose this further.  Please see
> Documentation/basic_profiling.txt
> 
> Also check that you have selected the correct IDE chipsets in
> configuration.  And post your dmesg output, especially the IDE bits.
Full mesg attached with IDE stuff included.
Will try to do the profiling this weekend.
DVD app was XINE.  I can provide the config files for it if it would be 
useful.
Also, included: lspci -v, cat /proc/ide/via, and cat settings (DVD)
*** it is interesting that it is identifying the wrong cable type for 
the secondary IDE (DVD/CD) as it most definitely is an 80 wire one.
lspci -v
00:00.0 Host bridge: VIA Technologies, Inc. VT82C693A/694x [Apollo 
PRO133x] (rev 44)
         Subsystem: Giga-byte Technology VT82C691 Apollo Pro System 
Controller
         Flags: bus master, medium devsel, latency 16
         Memory at e2000000 (32-bit, prefetchable) [size=32M]
         Capabilities: [a0] AGP version 1.0
00:01.0 PCI bridge: VIA Technologies, Inc. VT82C598/694x [Apollo 
MVP3/Pro133x AGP] (prog-if 00 [Normal decode])
         Flags: bus master, 66Mhz, medium devsel, latency 0
         Bus: primary=00, secondary=01, subordinate=01, sec-latency=0
         Memory behind bridge: e0000000-e1ffffff
         Prefetchable memory behind bridge: d8000000-dfffffff
         Capabilities: [80] Power Management version 2
00:07.0 ISA bridge: VIA Technologies, Inc. VT82C596 ISA [Mobile South] 
(rev 23)
         Subsystem: Giga-byte Technology VT82C596/A/B PCI to ISA Bridge
         Flags: bus master, stepping, medium devsel, latency 0
00:07.1 IDE interface: VIA Technologies, Inc. 
VT82C586A/B/VT82C686/A/B/VT8233/A/C/VT8235 PIPC Bus Master IDE (rev 10) 
(prog-if 8a [Master SecP PriP])
         Flags: bus master, medium devsel, latency 64
         I/O ports at d000 [size=16]
         Capabilities: [c0] Power Management version 2
00:07.2 USB Controller: VIA Technologies, Inc. USB (rev 11) (prog-if 00 
[UHCI])
         Subsystem: VIA Technologies, Inc. (Wrong ID) USB Controller
         Flags: bus master, medium devsel, latency 64, IRQ 10
         I/O ports at d400 [size=32]
         Capabilities: [80] Power Management version 2
00:07.3 Host bridge: VIA Technologies, Inc. VT82C596 Power Management 
(rev 30)
         Flags: medium devsel
00:09.0 Ethernet controller: Intel Corp. 82557/8/9 [Ethernet Pro 100] 
(rev 02)
         Subsystem: Intel Corp. EtherExpress PRO/100B (TX)
         Flags: bus master, medium devsel, latency 64, IRQ 11
         Memory at e5100000 (32-bit, prefetchable) [size=4K]
         I/O ports at d800 [size=32]
         Memory at e5000000 (32-bit, non-prefetchable) [size=1M]
         Expansion ROM at e4000000 [disabled] [size=1M]
00:0a.0 Multimedia audio controller: Creative Labs SB Live! EMU10k1 (rev 0a)
         Subsystem: Creative Labs CT4780 SBLive! Value
         Flags: bus master, medium devsel, latency 64, IRQ 5
         I/O ports at dc00 [size=32]
         Capabilities: [dc] Power Management version 1
00:0a.1 Input device controller: Creative Labs SB Live! MIDI/Game Port 
(rev 0a)
         Subsystem: Creative Labs Gameport Joystick
         Flags: bus master, medium devsel, latency 64
         I/O ports at e000 [size=8]
         Capabilities: [dc] Power Management version 1
00:0b.0 Multimedia video controller: Brooktree Corporation Bt878 Video 
Capture (rev 11)
         Subsystem: Pinnacle Systems Inc. PCTV pro (TV + FM stereo receiver)
         Flags: bus master, medium devsel, latency 64, IRQ 10
         Memory at e5101000 (32-bit, prefetchable) [size=4K]
         Capabilities: [44] Vital Product Data
         Capabilities: [4c] Power Management version 2
00:0b.1 Multimedia controller: Brooktree Corporation Bt878 Audio Capture 
(rev 11)
         Subsystem: Pinnacle Systems Inc. PCTV pro (TV + FM stereo 
receiver, audio section)
         Flags: bus master, medium devsel, latency 64, IRQ 10
         Memory at e5102000 (32-bit, prefetchable) [size=4K]
         Capabilities: [44] Vital Product Data
         Capabilities: [4c] Power Management version 2
01:00.0 VGA compatible controller: nVidia Corporation NV11 [GeForce2 
MX/MX 400] (rev a1) (prog-if 00 [VGA])
         Subsystem: ABIT Computer Corp.: Unknown device 6105
         Flags: bus master, 66Mhz, medium devsel, latency 64, IRQ 11
         Memory at e0000000 (32-bit, non-prefetchable) [size=16M]
         Memory at d8000000 (32-bit, prefetchable) [size=128M]
         Expansion ROM at <unassigned> [disabled] [size=64K]
         Capabilities: [60] Power Management version 2
         Capabilities: [44] AGP version 2.0
cat /proc/ide/via
----------VIA BusMastering IDE Configuration----------------
Driver Version:                     3.37
South Bridge:                       VIA vt82c596b
Revision:                           ISA 0x23 IDE 0x10
Highest DMA rate:                   UDMA66
BM-DMA base:                        0xd000
PCI clock:                          33.3MHz
Master Read  Cycle IRDY:            1ws
Master Write Cycle IRDY:            1ws
BM IDE Status Register Read Retry:  yes
Max DRDY Pulse Width:               No limit
-----------------------Primary IDE-------Secondary IDE------
Read DMA FIFO flush:          yes                 yes
End Sector FIFO flush:         no                  no
Prefetch Buffer:               no                  no
Post Write Buffer:             no                  no
Enabled:                      yes                 yes
Simplex only:                  no                  no
Cable Type:                   80w                 40w
-------------------drive0----drive1----drive2----drive3-----
Transfer Mode:       UDMA      UDMA       DMA      UDMA
Address Setup:       30ns      30ns      30ns      30ns
Cmd Active:          90ns      90ns      90ns      90ns
Cmd Recovery:        30ns      30ns      30ns      30ns
Data Active:         90ns      90ns      90ns      90ns
Data Recovery:       30ns      30ns      30ns      30ns
Cycle Time:          30ns      30ns     120ns      60ns
Transfer Rate:   66.6MB/s  66.6MB/s  16.6MB/s  33.3MB/s
IDE drive3 is the DVD:
cat settings
name                value           min             max             mode
----                -----           ---             ---             ----
current_speed       66              0               70              rw
dsc_overlap         1               0               1               rw
ide-scsi            0               0               1               rw
init_speed          12              0               70              rw
io_32bit            1               0               3               rw
keepsettings        0               0               1               rw
nice1               1               0               1               rw
number              3               0               3               rw
pio_mode            write-only      0               255             w
slow                0               0               1               rw
unmaskirq           1               0               1               rw
using_dma           1               0               1               rw