Date: Fri, 06 Aug 1999 09:57:23 +0000
From: Thierry Vignaud <>
Subject: [PATCH] fix for APM compilationn ix86
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/8/6/83

Here is a patch that fix apm compilation on ix86 in 2.3.13-pre7
-- 
MandrakeSoft          
http://www.mandrakesoft.com/
	somewhere between the playstation and the super cray
			         	 --Thierrydiff -ru old/arch/i386/kernel/apm.c linux/arch/i386/kernel/apm.c
--- old/arch/i386/kernel/apm.c	Wed Aug  4 09:53:22 1999
+++ linux/arch/i386/kernel/apm.c	Fri Aug  6 09:59:48 1999
@@ -284,6 +284,7 @@
 
 extern int	apm_register_callback(int (*)(apm_event_t));
 extern void	apm_unregister_callback(int (*)(apm_event_t));
+static int hlt_counter;
 
 /*
  * Local variables
@@ -548,6 +549,11 @@
  */
 #define HARD_IDLE_TIMEOUT (HZ/3)
 
+/* This should wake up kapmd and ask it to slow the CPU */
+#define powermanagement_idle()  do { } while (0)
+
+extern int hlt_counter;
+
 /*
  * This is the idle thing.
  */
@@ -1227,7 +1233,6 @@
 	unsigned short	bx;
 	unsigned short	cx;
 	unsigned short	dx;
-	unsigned short	nbat;
 	unsigned short	error;
 	unsigned short  ac_line_status = 0xff;
 	unsigned short  battery_status = 0xff;
@@ -1428,7 +1433,7 @@
  * In short, if something bad happens, at least we have a choice
  * of just killing the apm thread..
  */
-static int __init apm_init(void)
+static void __init apm_init(void)
 {
 	static struct proc_dir_entry *ent;
 