Date: Wed, 19 Sep 2007 15:25:15 +0100
From: Paulo Marques <>
Subject: Re: [PATCH] Reduce __print_symbol/sprint_symbol stack usage.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/9/19/131

Satyam Sharma wrote:
> On Sat, 15 Sep 2007, Gilboa Davara wrote:
>>  	printk(fmt, buffer);
>> +
>> +	spin_unlock_irqrestore(&symbol_lock, flags);
> 
> But I still don't much like this :-(
I must say I agree with Satyam here.
Locking in the panic path might leave us without some critical debug 
information, which is much more important than all this.
Maybe it would be better to change the print_symbol interface to avoid 
having a "char buffer[KSYM_SYMBOL_LEN];" at all.
Most print_symbol callers use something like "yada yada %s" as the 
format string, with an optional "\n" in the end.
if we change the interface from "print_symbol(fmt, addr)" to 
"print_symbol(prefix, addr, int newline)" we can simply do:
printk(prefix);
printk_symbol(addr);
if (newline)
	printk("\n");
where "printk_symbol" is a new function that does the same as 
sprint_symbol, but does "printk" instead of "sprintf".
This should reduce immensely the stack usage of print_symbol without the 
need for locking.
Of course this requires changing _all_ callers of print_symbol to use 
the new interface, but these are less than 100 ;)
Comments?
-- 
Paulo Marques - www.grupopie.com
"You're just jealous because the voices only talk to me."
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/