Date: Tue, 21 Aug 2001 00:14:18 +0200 (CEST)
From: Andrzej Krzysztofowicz <>
Subject: Re: [PATCH] allow hdX=scsi when ide-scsi is a module
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/8/20/240

> The current IDE code doesn't allow the user to reserve a drive to be used 
> only with ide-scsi emulation, if the ide-scsi layer is compiled as a 
> module. The following trivial patch fixes the problem, I've been using it 
> for the last 6 months or so.
> 
> The patch removes the explicit dependency on CONFIG_SCSI because ide-scsi 
> itself requires the SCSI subsystem.
Even worse.
As the following legal steps:
CONFIG_BLK_DEV_IDESCSI=y
CONFIG_SCSI=y
    |
    V
make config
    |
    V
  SCSI emulation support (CONFIG_BLK_DEV_IDESCSI) [Y/m/n/?] y
  ...
  SCSI support (CONFIG_SCSI) [Y/m/n/?] m
    |
    V
CONFIG_BLK_DEV_IDESCSI=y
CONFIG_SCSI=m
result in an invalid configuration.
So I suggest also the following change:
**********************************************************
--- drivers/ide/ide.c.old	Mon Aug 20 23:03:11 2001
+++ drivers/ide/ide.c	Mon Aug 20 23:03:39 2001
@@ -3452,7 +3452,7 @@
  #ifdef CONFIG_SCSI
 	(void) idescsi_init();
  #else
-    #warning ide scsi-emulation selected but no SCSI-subsystem in kernel
+    #error ide scsi-emulation selected but no SCSI-subsystem in kernel
  #endif
 #endif /* CONFIG_BLK_DEV_IDESCSI */
 }
BTW, IDE config is broken in much more places :(
Andrzej
-- 
=======================================================================
  Andrzej M. Krzysztofowicz               ankry@mif.pg.gda.pl
  phone (48)(58) 347 14 61
Faculty of Applied Phys. & Math.,   Technical University of Gdansk
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/