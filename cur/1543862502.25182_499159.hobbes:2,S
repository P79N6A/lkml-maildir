Date: Mon, 15 Jan 2007 20:23:30 +0530
From: Vaidyanathan Srinivasan <>
Subject: Re: prioritize PCI traffic ?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/15/75

Soeren Sonnenburg wrote:
> On Mon, 2007-01-15 at 19:23 +0530, Vaidyanathan Srinivasan wrote:
>> Soeren Sonnenburg wrote:
>>> Dear all,
>>>
>>> is it possible to explicitly tell the kernel to prioritize PCI traffic
>>> for a number of cards in pci slots x,y,z ?
>>>
>>> I am asking as severe ide traffic causes lost frames when watching TV
>>> using 2 DVB cards + vdr... This is simply due to the fact that the PCI
>>> bus is saturated...
>> How do you know that the bus is saturated?
> 
> I simply dd if=/dev/sd? of=/dev/null from four brand new sata-harddisks.
> 
>> Are you streaming data to/from the ide hard disks/CDROM?
> 
> yes.
>
>> Do you have DMAs 'ON' for the hard disks?
> 
> yes.
Good.
>> Is everything just fine if there are no IDE traffic?
> 
> yes.
Good.
>> Are you running 2.6 kernel with preempt 'ON'?
> 
> no: CONFIG_PREEMPT_NONE=y
> 
Try CONFIG_PREEMPT=y it may help. It made the system more responsive
for me.
>> Are all hardware on the same IRQ line? (shared interrupts)
> 
> no: libata devices are on IRQ 16 and DVB devices on IRQ 20
Watch the interrupt count (/proc/interrupts) and interrupt rate,
that may give some clue on what is happening on the PCI bus.
> 
>>> So, is any prioritizing of the PCI bus possible ?
>> The drivers + application indirectly can control priority on the
>> bus.  Just reduce the priority of the application that uses IDE and
>> see if adjusting nice values of applications can change the scenario.
> 
> That unfortunately did not help... no change...
33Mhz 32-bit PCI bus on typical PC can do around 100MB/sec... watch
your individual disk transfer rates and data rate to each DVB.
dd from 4 new SATA drive will probably fillup the bus.  However,
depending on your motherboard, the integrated SATA controllers may
be on a different PCI bus than the one for the slots.
You can watch the lspci output to determine which bus the devices
are located.
--Vaidy
> 
> Soeren
> --
> Sometimes, there's a moment as you're waking, when you become aware of
> the real world around you, but you're still dreaming.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/