Date: Fri, 18 Jan 2008 00:04:54 -0500
From: "H. Peter Anvin" <>
Subject: Re: [PATCH] x86: make clflush a required feature on x86_64
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/18/8

Kyle McMartin wrote:
> Hopefully nobody will be stupid enough to implement a cpu without
> it. Frankly, it seems safe enough given we already require SSE2.
> 
> This means the compiler can optimise away "if (!cpu_has_clflush)"
> blocks.
> 
> Signed-off-by: Kyle McMartin <kyle@mcmartin.ca>
> ---
>  include/asm-x86/cpufeature_64.h     |    3 +++
>  include/asm-x86/required-features.h |    4 +++-
>  2 files changed, 6 insertions(+), 1 deletions(-)
> 
> diff --git a/include/asm-x86/cpufeature_64.h b/include/asm-x86/cpufeature_64.h
> index e18496b..ef11d27 100644
> --- a/include/asm-x86/cpufeature_64.h
> +++ b/include/asm-x86/cpufeature_64.h
> @@ -18,6 +18,9 @@
>  #undef  cpu_has_mp
>  #define cpu_has_mp             1 /* XXX */
> 
> +#undef	cpu_has_clflush
> +#define	cpu_has_clflush        1
> +
>  #undef  cpu_has_k6_mtrr
>  #define cpu_has_k6_mtrr        0
Unnecessary.  These overrides are only needed for the anticases (known 
to be zero) or for some special hacks.
Stuff that have proper CPUID bits get these defined as constants via the 
  REQUIRED_MASK macros.
	-hpa