Date: Wed, 11 Apr 2001 20:11:31 +0200
From: Petr Vandrovec <>
Subject: [PATCH] matroxfb and mga XF4 driver coexistence...
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/4/11/118

Hi,
   Alan, Linus, please apply this patch to matroxfb. It fixes complaints
from people that screen is black after they exit from X back to console.
Matrox driver does not know that it should return hardware state back to
initial state after switch, but matroxfb relies on that (XF3 did that...).
So now it reprograms hardware always from scratch...
					Thanks,
						Petr Vandrovec
						vandrove@vc.cvut.cz
diff -urdN linux/drivers/video/matrox/matroxfb_DAC1064.c linux/drivers/video/matrox/matroxfb_DAC1064.c
--- linux/drivers/video/matrox/matroxfb_DAC1064.c	Tue Apr 10 22:56:19 2001
+++ linux/drivers/video/matrox/matroxfb_DAC1064.c	Wed Apr 11 11:45:50 2001
@@ -418,7 +418,12 @@
 	outDAC1064(PMINFO DAC1064_XSYSPLLM, hw->DACclk[3]);
 	outDAC1064(PMINFO DAC1064_XSYSPLLN, hw->DACclk[4]);
 	outDAC1064(PMINFO DAC1064_XSYSPLLP, hw->DACclk[5]);
-	if (!oldhw || memcmp(hw->DACreg, oldhw->DACreg, sizeof(MGA1064_DAC_regs))) {
+	/*
+	 * We must ALWAYS reprogram hardware due to broken XF4 matrox drivers...
+	 *
+	 * if (!oldhw || memcmp(hw->DACreg, oldhw->DACreg, sizeof(MGA1064_DAC_regs))) 
+	 */
+	{
 		unsigned int i;
 
 		for (i = 0; i < sizeof(MGA1064_DAC_regs); i++) {
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/