Date: Wed, 14 Apr 1999 20:00:07 -0600
From: Highbit <>
Subject: Re: PROBLEM: 2.2.5 smp kernel locks up when transferring large files  over LAN
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/4/15/47

> From: "Brimhall, GeoffreyX L" <geoffreyx.l.brimhall@intel.com>
> Date: Wed, 14 Apr 1999 11:19:49 -0700
> Subject: PROBLEM: 2.2.5 smp kernel locks up when transferring large files  over LAN
> 
> I'm consistently running into a bug with the 2.2.5 smp kernel where the
> system locks up when transferring large files (~10 Megs or larger) via ftp
> on a local lan. I can boot my system with a 2.1.125 smp kernel and can't
> reproduce the bug at all. Also, I've used a couple different ftp client
> programs (regular ftp, and lftp) and still get the same results. There is a
> strange quirckiness in the hardware setup needed to reproduce the bug that
> I'll detail below.
> 
> When the system locks up, after a few minutes of waiting the following
> appears on the main system terminal (the system is still locked up though
> after this):
> 
> irq:   2 [0 2]
> bh:   1 [1 0]
> 
> <[c010a8e9]> <[c010a82a]> <[c010aafb]> <[c0154e19]> <[c0150275]>
> <[c015da85]> <[c015dd9a]>
> 
> Here's the hardware setup:
> 1. Dual P-Pro 180's (256k cache), with 128 Megs EDO memory.
> 2. Super Micro motherboard, model P6DNF.
> 3. Adaptec 2940UW pci card, with a  4gig scsi UW harddrive, scsi cdrom.
> 4. 3com 3c509b ISA PnP ethernet card (though the PnP has been disabled).
> 5. Soundblaster Awe32 (isa)
> 6. Matrox Millinium II video card.
Dual P-Pro 180's with 2 sticks of 32 meg buffered edo
Micronics W6Li motherboard
onboard aic7880 UW scsi
ncr 825 differential wide scsi
netgear fa510tx 10/100 (using tulip driver)
3com 3c509b ISA PnP ethernet card (pnp disabled too)
onboard vibra16
et6000 something video.
not sure whether to blame the 3com 509b.   i've ran 2.2.2 with
an uptime of about 25 days, (then i got the brainiac idea that i needed
to yank one of the tulips out for another machine.  within 24 hours it
locked up, few more lockups later i tried out the 2.2.5, tho i've remembered
the lockups lately to be of the variety of
"wait_on_irq cpu0"
> 7.1)
> Linux Waterfall 2.2.5 #1 SMP Tue Apr 13 21:14:30 PDT 1999 i686 unknown
> Kernel modules         2.2.5
> Gnu C                  2.7.2.3
> Binutils               2.9.1.0.19
> Linux C Library        2.0.7
> Dynamic linker         ldd: version 1.9.10
> Procps                 1.2.9
> Mount                  2.9g
> Net-tools              (1998-03-02)
> Kbd                    0.96
> Sh-utils               1.16
> Modules Loaded         parport_probe lp parport vfat fat sg 3c509
Linux spooge 2.2.5 #6 SMP Sun Apr 4 15:05:37 CST 1999 i686 unknown
Kernel modules         2.1.121
Gnu C                  egcs-2.91.60
Binutils               2.9.1.0.19
Linux C Library        5.4.44
Dynamic linker         ldd (GNU libc) 2.0.7
Linux C++ Library      27.2.8
Linux C++ Library      27.2.8
Procps                 1.2.7
Mount                  2.9i
Net-tools              (1999-01-01)
Kbd                    0.89
Sh-utils               1.16
Modules Loaded         isofs loop sg st nfs lockd sunrpc tulip 3c509 rarp ip_masq_vdolive ip_masq_user ip_masq_raudio ip_masq_quake ip_masq_portfw ip_masq_mfw ip_masq_irc ip_masq_ftp ip_masq_cuseeme ip_masq_autofw
> 
> 7.2)
> processor	: 0
> vendor_id	: GenuineIntel
> cpu family	: 6
> model		: 1
> model name	: Pentium Pro
> stepping	: 7
> cpu MHz		: 179.633252
> cache size	: 256 KB
> fdiv_bug	: no
> hlt_bug		: no
> sep_bug		: no
> f00f_bug	: no
> fpu		: yes
> fpu_exception	: yes
> cpuid level	: 2
> wp		: yes
> flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
> cmov
> bogomips	: 179.00
> 
> processor	: 1
> vendor_id	: GenuineIntel
> cpu family	: 6
> model		: 1
> model name	: Pentium Pro
> stepping	: 7
> cpu MHz		: 179.633252
> cache size	: 256 KB
> fdiv_bug	: no
> hlt_bug		: no
> sep_bug		: no
> f00f_bug	: no
> fpu		: yes
> fpu_exception	: yes
> cpuid level	: 2
> wp		: yes
> flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
> cmov
> bogomips	: 179.40
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 1
model name	: Pentium Pro
stepping	: 9
cpu MHz		: 199.310676   (sorry bout the o/c'ing alan...but its worked before)
cache size	: 256 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
bogomips	: 199.07
processor	: 1
vendor_id	: GenuineIntel
cpu family	: 6
model		: 1
model name	: Pentium Pro
stepping	: 9
cpu MHz		: 199.310676
cache size	: 256 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
bogomips	: 198.66
> 
> 7.3)
> parport_probe           2848   0 (autoclean) (unused)
> lp                      4800   0 (autoclean) (unused)
> parport                 7088   0 (autoclean) [parport_probe lp]
> vfat                   11456   1
> fat                    24424   1 [vfat]
> sg                      3752   0 (unused)
> 3c509                   5600   1
isofs                  16440   0 (autoclean)
loop                    7584   0 (autoclean)
sg                      3856   0 (autoclean)
st                     24992   0 (autoclean)
nfs                    30136   1 (autoclean)
lockd                  31336   1 (autoclean) [nfs]
sunrpc                 53540   1 (autoclean) [nfs lockd]
tulip                  25284   1 (autoclean)
3c509                   5972   1 (autoclean)
rarp                    2640   0 (unused)
ip_masq_vdolive         1072   0 (unused)
ip_masq_user            2408   0 (unused)
ip_masq_raudio          2736   0 (unused)
ip_masq_quake           1124   0 (unused)
ip_masq_portfw          2672   0 (unused)
ip_masq_mfw             3712   0 (unused)
ip_masq_irc             1520   0 (unused)
ip_masq_ftp             2352   0 (unused)
ip_masq_cuseeme          848   0 (unused)
ip_masq_autofw          2240   0 (unused)
> 
> 7.4)
> Attached devices: 
> Host: scsi0 Channel: 00 Id: 00 Lun: 00
>   Vendor: QUANTUM  Model: XP34550W         Rev: LXY4
>   Type:   Direct-Access                    ANSI SCSI revision: 02
> Host: scsi0 Channel: 00 Id: 04 Lun: 00
>   Vendor: iomega   Model: jaz 1GB          Rev: J^77
>   Type:   Direct-Access                    ANSI SCSI revision: 02
> Host: scsi0 Channel: 00 Id: 06 Lun: 00
>   Vendor: TEAC     Model: CD-ROM CD-516S   Rev: 1.0D
>   Type:   CD-ROM                           ANSI SCSI revision: 02
Attached devices: 
Host: scsi0 Channel: 00 Id: 00 Lun: 00
  Vendor: FUJITSU  Model: M1603S-512       Rev: 6236
  Type:   Direct-Access                    ANSI SCSI revision: 02
Host: scsi0 Channel: 00 Id: 05 Lun: 00
  Vendor: MICROP   Model: 1991-27   1128RV Rev: 28RV
  Type:   Direct-Access                    ANSI SCSI revision: 02
Host: scsi0 Channel: 00 Id: 06 Lun: 00
  Vendor: CONNER   Model: CTT8000-S        Rev: 1.17
  Type:   Sequential-Access                ANSI SCSI revision: 02
Host: scsi1 Channel: 00 Id: 01 Lun: 00
  Vendor: QUANTUM  Model: XP39100WD        Rev: LXY4
  Type:   Direct-Access                    ANSI SCSI revision: 02
Host: scsi1 Channel: 00 Id: 02 Lun: 00
  Vendor: QUANTUM  Model: XP39100WD        Rev: LXY4
  Type:   Direct-Access                    ANSI SCSI revision: 02
> 
> 7.5) 
> /proc/interrupts:
>            CPU0       CPU1       
>   0:      43794          0          XT-PIC  timer
>   1:          0          2    IO-APIC-edge  keyboard
>   2:          0          0          XT-PIC  cascade
>   3:         22          6    IO-APIC-edge  serial
>   8:          1          1    IO-APIC-edge  rtc
>   9:       3990       4465    IO-APIC-edge  eth0
>  13:          1          0          XT-PIC  fpu
>  14:          3          4    IO-APIC-edge  ide0
>  18:       1511       1507   IO-APIC-level  aic7xxx
> NMI:          0
> ERR:          0
> 
           CPU0       CPU1       
  0:   12998510   13077443    IO-APIC-edge  timer
  1:      45263      44583    IO-APIC-edge  keyboard
  2:          0          0          XT-PIC  cascade
  3:    2441117    2442252    IO-APIC-edge  eth0
  4:        175        189    IO-APIC-edge  serial
  8:          0          0    IO-APIC-edge  rtc
 13:          1          0          XT-PIC  fpu
 14:    2624268    2622789   IO-APIC-level  ide0
 15:    1678323    1682811   IO-APIC-level  ide1
 17:    6398688    6397594   IO-APIC-level  eth1
 18:     135170     134738   IO-APIC-level  aic7xxx
 19:    1121675    1122287   IO-APIC-level  ncr53c8xx
NMI:          0
ERR:          0
> /proc/locks:
> : FLOCK  ADVISORY  WRITE 0 08:03:370703 0 2147483647 c0009da0 00000000
> c0009e00 00000000 00000000
> 2: POSIX  ADVISORY  WRITE 255 08:03:370702 0 2147483647 c0009e00 c0009da0
> c0009f20 00000000 00000000
> 3: POSIX  ADVISORY  WRITE 228 08:03:180435 0 2147483647 c0009f20 c0009e00
> 00000000 00000000 00000000
1: POSIX  ADVISORY  WRITE 143 08:35:180461 0 0 c3d533e0 00000000 c2ae1600 00000000 00000000
2: POSIX  ADVISORY  WRITE 141 08:35:180281 0 0 c2ae1600 c3d533e0 c2ae14e0 00000000 00000000
3: FLOCK  ADVISORY  WRITE 0 03:02:60488 0 2147483647 c2ae14e0 c2ae1600 00000000 00000000 00000000
--
Mark Duguid           Saskatoon, Saskatchewan        highbit@home.com
Timesharing: An access method whereby one computer abuses many people
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/