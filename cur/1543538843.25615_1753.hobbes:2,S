Date: Thu, 13 Jul 2000 21:33:55 +0200 (CEST)
From: Daniel Kobras <>
Subject: DECLARE_MUTEX+wq debug+module?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/13/136

Hi!
2.4.0-test3 + reiserfs patch 3.6.11 (reiserfs built as a module) just spew
out this strange message when I tried to access a reiserfs partition:
bad magic d1005900 (should be cff03e78), wq bug, forcing oops
Kernel BUG at /usr/src/linux/include/asm/semaphore.h:111!
invalid operand: 0000
CPU:    1
EIP:    %4x:[<%8lx>]
EFLAGS: %8lx
eax:    %8lx    edx:    %8lx    ecx: %8lx       edx: %8lx
[The machine locked up afterwards so the message is copied by hand but
yes, it indeed printed out the format tags. Is BUG() buggy??]
modutils logged the following module addresses:
d0853000 __insmod_reiserfs_O/lib/modules/2.4.0-test3/fs/reiserfs.o_M396DE341_V132096 [reiserfs]
d0853060 __insmod_reiserfs_S.text_L116620       [reiserfs]
d086f960 __insmod_reiserfs_S.rodata_L32758      [reiserfs]
d0877960 __insmod_reiserfs_S.data_L764  [reiserfs]
d0877d40 __insmod_reiserfs_S.bss_L6624  [reiserfs]
d084b850 __insmod_de4x5_S.data_L304     [de4x5]
d0842060 de4x5_probe    [de4x5]
d084a9a0 __insmod_de4x5_S.rodata_L3702  [de4x5]
d0842060 __insmod_de4x5_S.text_L34941   [de4x5]
d0842000 __insmod_de4x5_O/lib/modules/2.4.0-test3/net/de4x5.o_M396DE341_V132096 [de4x5]
d084ba60 __insmod_de4x5_S.bss_L161      [de4x5]
No further modules were loaded on top, so 0xd1005900 looks
reiserfs-related. Checking the down() calls in reiserfs, only inode->i_sem
and reiserfs_end_io_sem are accessed. reiserfs_end_io_sem looks like the
culprit. However the related code in fs/reiserfs/journal.c looks perfectly
sane, DECLARE_MUTEX() in the global section, only up() and down() calls
otherwise. Module loading is a black box to me, but from the magics given
I assume that some relocation of global data after initialization is going
on here. Which would mean that DECLARE_MUTEX()+wq debugging is broken in a
module's global data. Maybe someone more knowledgeable than me could
confirm this (or explain what's wrong otherwise)?
Regards,
Daniel.
-- 
	GNU/Linux Audio Mechanics - 
http://www.glame.de
	      GPG Key ID 89BF7E2B - 
http://www.keyserver.net
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/