Date: Tue, 30 Oct 2007 10:25:18 -0700
From: "H.J. Lu" <>
Subject: Re: PATCH: PR Input Devives/2082: PS/2 mouse out of sync after switching with KVM switch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/30/296

On Tue, Oct 30, 2007 at 12:53:17PM -0400, Dmitry Torokhov wrote:
> Hi,
> 
> On 10/30/07, H.J. Lu <hjl@lucon.org> wrote:
> > The bug report is at
> >
> > 
http://bugzilla.kernel.org/show_bug.cgi?id=2082
> >
> > Problem Description: When switching to another machine with a KVM
> > switch and back, the mouse is out of control, with X.Org.  To recover,
> >  I have to unplug the mouse cable and plug it back.
> >
> > Steps to reproduce: Have a wheel mouse connected and X.Org.  Keyboard,
> > Mouse and Video are connected to a KVM switch. Switch to another
> > machine and back.  You have lost the usage of wheel on mouse.
> >
> > This patch for 2.6.23 tries to reconnect the mouse after KVM switch.
> > It doesn't completely solve the problem. Mouse still got a few random
> > bytes after KVM switch.
> 
> Have you tried psmouse.resync_time=5 option?
My psmouse is kernel builtin. I tried "psmouse.proto=imps" and
it worked. But I don't want to change kernel boot option for each
kernel on each machine behind KVM.
> 
> Any change you coudl do
> 
> echo 1 > /sys/module/i8042/parameters/debug
> 
> before switrching KVM back and forth and send me dmesg?
I will try it when I get home.
> 
> > But it recovers with kernel message:
> >
> > psmouse.c: Wheel Mouse at isa0060/serio1/input0 lost synchronization, issuing reconnect request.
> >
> > instead of
> >
> > psmouse.c: Wheel Mouse at isa0060/serio1/input0 lost synchronization, throwing 3 bytes away.
> >
> > and never recovering from it.
> >
> 
> I am hesitant queuing reconnect immediately - if the byte was delayed
> because embedded controller was busy doing something else and we start
> querying mouse at the wrong time we might lose mouse altogether.
> 
As it stands now, my Microsoft wheel mouse isn't usable at all after
KVM switch without my patch. I had to reset mouse cable to get it back.
H.J.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/