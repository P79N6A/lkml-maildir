Date: Thu, 13 Mar 2008 10:36:08 +0100
From: Martin Schwidefsky <>
Subject: Re: [patch 6/6] Guest page hinting: s390 support.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/13/84

On Wed, 2008-03-12 at 13:45 -0700, Jeremy Fitzhardinge wrote:
> Vp should never happen, since you'd never preserve a V page.  And surely 
> it would be Pr -> Sr, since the hypervisor wouldn't push the page to 
> backing store when you change the client state.
Vp does not happen in the current implementation. But it actually may be
useful. z/VM has multiple layers of paging, the first goes to expanded
storage which is very fast. If you make the page Vz and the guests needs
it you have to do a standard Linux I/O to get retrieve the page. This
can be slower than a read and a write to expanded storage.
> > Do the host states even really need visibility to the guest at all?  It 
> > may be useful for the guest to be able to distinguish between Ur and Uz 
> > but it doesn't seem necessary.
> 
> Well, you implicitly see the hypervisor state.  If you touch a [UV]z 
> page then you get a fault telling you that the page has been taken away 
> from you (I think).  And it would definitely help with debugging (seems 
> likely there's lots of scope for race conditions if you prematurely tell 
> the hypervisor you don't need the page any more...).
You get an addressing exception if you touch a Uz page. This indicates a
BUG in the Linux code because this is a use after free. If the guests
touches a Vz page you get a discard fault.
-- 
blue skies,
  Martin.
"Reality continues to ruin my life." - Calvin.