Date: Wed, 1 Sep 1999 11:35:15 +0200
From: Jens Axboe <>
Subject: Re: Problems with CD-ROM in 2.3.16?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/9/1/34

On Tue, Aug 31 1999, Byron Stanoszek wrote:
> I try to run my usual cd player and get this message under 2.3.16:
> 
> root:~> cdplay 2
> hdc: packet command error: status=0x51 { DriveReady SeekComplete Error }
> hdc: packet command error: error=0x50
> ATAPI device hdc:
>   Error: Illegal request -- (Sense key=0x05)
>   Invalid command operation code -- (asc=0x20, ascq=0x00)
>   The failed "Read Disc Info" packet command was:
>   "51 00 00 00 00 00 00 00 24 00 00 00 "
> cdplay: can't open cdrom (/dev/cdrom)
> cdplay:  CD status is no_disc
> root:~> cdplay 2
> cdplay: can't open cdrom (/dev/cdrom)
> cdplay:  CD status is no_disc
> root:~>
> 
> Same thing happens when I try to mount a cd.
For now, just apply this patch.
-- 
*  Jens Axboe <axboe@image.dk>
*  Linux CD-ROM Maintainer
*  
http://www.kernel.dk
--- /tmp/linux-2.3.16/drivers/block/ide-cd.c	Wed Sep  1 11:29:53 1999
+++ drivers/block/ide-cd.c	Wed Sep  1 11:30:56 1999
@@ -1794,10 +1794,13 @@
 	toc->xa_flag = (ms_tmp.hdr.first_track != ms_tmp.hdr.last_track);
 
 	/* Now try to get the total cdrom capacity. */
+#if 0
 	stat = cdrom_get_last_written(MKDEV(HWIF(drive)->major,
 				      drive->select.b.unit << PARTN_BITS),
 				     (long *)&toc->capacity);
-	if (stat) stat = cdrom_read_capacity (drive, &toc->capacity, reqbuf);
+	if (stat)
+#endif
+	stat = cdrom_read_capacity (drive, &toc->capacity, reqbuf);
 	if (stat) toc->capacity = 0x1fffff;
 
 	HWIF(drive)->gd->sizes[drive->select.b.unit << PARTN_BITS]
@@ -2048,7 +2051,6 @@
 	return cgc->stat;
 }
 
-
 static
 int ide_cdrom_dev_ioctl (struct cdrom_device_info *cdi,
 			 unsigned int cmd, unsigned long arg)
@@ -2977,11 +2979,3 @@
 	MOD_DEC_USE_COUNT;
 	return 0;
 }
-
-
-/*==========================================================================*/
-/*
- * Local variables:
- * c-basic-offset: 8
- * End:
- */