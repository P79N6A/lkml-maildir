Date: Sat, 12 Jan 2008 12:13:45 +0100
From: Stefan Richter <>
Subject: Re: [PATCH 2/7] ieee1394 : use class iteration api
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/12/58

> Dave Young wrote:
>> +++ linux.new/drivers/ieee1394/nodemgr.c	2008-01-12 15:20:27.000000000 +0800
> ...
>>  static void nodemgr_remove_uds(struct node_entry *ne)
>>  {
>>  	struct device *dev;
>> -	struct unit_directory *tmp, *ud;
>> +	struct unit_directory *ud;
>> 
>> -	/* Iteration over nodemgr_ud_class.devices has to be protected by
>> -	 * nodemgr_ud_class.sem, but device_unregister() will eventually
>> -	 * take nodemgr_ud_class.sem too. Therefore pick out one ud at a time,
>> -	 * release the semaphore, and then unregister the ud. Since this code
>> -	 * may be called from other contexts besides the knodemgrds, protect the
>> -	 * gap after release of the semaphore by nodemgr_serialize_remove_uds.
>> +	/* Use class_find device to iterate the devices. Since this code
>> +	 * may be called from other contexts besides the knodemgrds,
>> +	 * protect it by nodemgr_serialize_remove_uds.
>>  	 */
>>  	mutex_lock(&nodemgr_serialize_remove_uds);
Hmm, maybe we actually don't need that special mutex after all.  I shall
check that sometime later, independently of your patch series.
-- 
Stefan Richter
-=====-==--- ---= -==--
http://arcgraph.de/sr/