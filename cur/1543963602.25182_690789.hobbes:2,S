Date: Fri, 9 May 2008 16:26:26 +0200
From: Eric Sesterhenn <>
Subject: Re: [Patch] hfsplus oops on image without extends
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/5/9/189

* Andy Whitcroft (apw@shadowen.org) wrote:
> On Wed, May 07, 2008 at 12:42:44PM +0200, Eric Sesterhenn wrote:
> > hi,
> > 
> > the following patch fixes an oops with a corrupted hfs+ image.
> > see 
http://bugzilla.kernel.org/show_bug.cgi?id=10548
 for details.
> > 
> > Problem is that we call hfs_btree_open() from hfsplus_fill_super() to set
> > HFSPLUS_SB(sb).[ext_tree|cat_tree]
> > Both trees are still NULL at this moment. If hfs_btree_open() fails for
> > any reason it calls iput() on the page, which
> > gets to hfsplus_releasepage() which tries to access HFSPLUS_SB(sb).*
> > which is still NULL and oopses while dereferencing it.
> 
> Erm, I presume this is meant to be 'if', checkpatch whined about the
> space as it thought it was a function.  I guess this hasn't been compile
> tested?
sorry, i messed this up, didnt have the original patch anymore and
quickly recreated it. Andrew already put a fix in -mm
Greetings, Eric