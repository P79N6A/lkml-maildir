Date: Wed, 25 Oct 2000 23:55:14 +0200
From: Andrea Arcangeli <>
Subject: Re: nfsv3d wrong truncates over 4G
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/10/25/145

On Wed, Oct 25, 2000 at 11:25:14PM +0300, Matti Aarnio wrote:
> 	The NFSv3 SERVER (for which Andrea made his patch)
> 	actually MUST open local files with O_LARGEFILE
> 	flag set.  (Otherwise e.g. EXT2 may reject the open.)
Exactly, that is the code-sharing implementation detail I was mentioning.  That
must be true not only for ext2 of course but for every other fs that nfsd is
sitting upon.  That was just fine in 2.4.0-test10-pre4. Andi spotted and fixed
that some week ago.
> 	The NFSv3 CLIENT code must do post-open verification,
> 	that if the opened file has size exceeding 2G-1, and
> 	O_LARGEFILE flag is not set, the opened file must be
> 	closed, and caller must be informed of the rejection
> 	with  -EFBIG  status.
> 	(If possible, do that size verification before open.)
2.2.18pre17aa1 lfs is completly complaint in this sense.
> 	Am I making any sense ?
You're completly right.
Andrea
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/