Date: Fri, 28 Mar 2003 14:01:08 -0800
From: jjs <>
Subject: Re: very poor performance in 2.5.66[-mm1]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/3/28/147

Just out of curiosity, does it help to say:
export LANG=en_US
?
David Mansfield wrote:
>On Fri, 28 Mar 2003, Andrew Morton wrote:
> 
>
>>>After all of the rave reviews about the interactivity fixes (both regular 
>>>and I/O scheduler related), I decided to give the 2.5.latest a try on my 
>>>desktop machine (system described below)
>>>
>>>I started X, everything seemed fine, maybe a bit faster.  I opened a 
>>>'gnome-terminal' and typed 'ls -ltr'.  Wow, it was 20x slower.
>>>
>>>Here are the timings for 'ls -ltr':
>>>
>>>2.5.66-mm1:      'ls -ltr'         31 seconds
>>>2.5.66-mm1:      'ls -ltr | cat'   2 seconds
>>>2.4.18-rhlatest: 'ls -ltr'         1.14 seconds
>>> 
>>>
>>How many files were there?
>> 
>>
>
>1337 files.
>
> 
>
>>My /usr/bin contains 3168 files.  An `ls -ltr' in gnome-terminal takes 9.6
>>seconds.  In rxvt it takes 0.5 seconds.  That's an 850MHz P3.
>>
>>So gnome-terminal appears to be a pretty slow application.  My guess would be
>>that something in the 2.5 kernel has exposed a marginality or an outright
>>bug in it.
>> 
>>
>
>Yes. gnome-terminal is godawful slow on RHAT 8.0 (it does Xrender
>alpha-channel crap for every character to get the anti-aliasing).  But I
>think the problem has to do with the pipe/pty wakeups.  After 'ls' writes
>a line to the pty, it seems as though the gnome-terminal is being woken up
>(even though 'ls' has more to write), it's generating the Xrender 
>X-command and sending it to X.  X is waking up and rendering it (which 
>forces a complete update of the screen).
>
>Under 2.4.18-whatever, it would seem as though 'ls' is generating a large
>number of lines of output before the gnome-terminal is waking up, causing
>a dramatically fewer number of redraws.
>
> 
>
>>It would be interesting to edit include/asm-i386/param.h and set HZ to 100.
>>
>> 
>>
>
>I'll try to check this out over the weekend.
>
>David
>
> 
>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/