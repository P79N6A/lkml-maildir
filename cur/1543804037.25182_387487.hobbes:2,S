Date: Wed, 18 Jan 2006 12:03:04 +0100
From: Olaf Hering <>
Subject: Re: [patch 6/6] serial8250: convert to the new platform device interface
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/18/127

 On Tue, Jan 17, Olaf Hering wrote:
>  On Mon, Jan 16, Kumar Gala wrote:
> 
> > > Mea Culpa - should've spotted that - that patch is actually rather
> > > broken.  platform_driver_register() can't be moved from where it
> > > initially was.
> > 
> > This seems to fix my issue on arch/powerpc and arch/ppc, please push to 
> > Linus ASAP.
older pSeries systems with serial ports dont get any console output
after recent changes. CONFIG_ISA does not make sense for CONFIG_PPC_PSERIES
because it enables lots of old drivers.
Instead, remove the dependency on CONFIG_ISA from the serial port
discovery code.
Signed-off-by: Olaf Hering <olh@suse.de>
 arch/powerpc/kernel/legacy_serial.c |    4 ----
 1 files changed, 4 deletions(-)
Index: linux-2.6.16-rc1-olh/arch/powerpc/kernel/legacy_serial.c
===================================================================
--- linux-2.6.16-rc1-olh.orig/arch/powerpc/kernel/legacy_serial.c
+++ linux-2.6.16-rc1-olh/arch/powerpc/kernel/legacy_serial.c
@@ -134,7 +134,6 @@ static int __init add_legacy_soc_port(st
 	return add_legacy_port(np, -1, UPIO_MEM, addr, addr, NO_IRQ, flags);
 }
 
-#ifdef CONFIG_ISA
 static int __init add_legacy_isa_port(struct device_node *np,
 				      struct device_node *isa_brg)
 {
@@ -168,7 +167,6 @@ static int __init add_legacy_isa_port(st
 	return add_legacy_port(np, index, UPIO_PORT, reg[1], taddr, NO_IRQ, UPF_BOOT_AUTOCONF);
 
 }
-#endif
 
 #ifdef CONFIG_PCI
 static int __init add_legacy_pci_port(struct device_node *np,
@@ -276,7 +274,6 @@ void __init find_legacy_serial_ports(voi
 		of_node_put(soc);
 	}
 
-#ifdef CONFIG_ISA
 	/* First fill our array with ISA ports */
 	for (np = NULL; (np = of_find_node_by_type(np, "serial"));) {
 		struct device_node *isa = of_get_parent(np);
@@ -287,7 +284,6 @@ void __init find_legacy_serial_ports(voi
 		}
 		of_node_put(isa);
 	}
-#endif
 
 #ifdef CONFIG_PCI
 	/* Next, try to locate PCI ports */
-- 
short story of a lazy sysadmin:
 alias appserv=wotan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/