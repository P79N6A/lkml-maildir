Date: Tue, 18 Dec 2007 17:10:39 +0000
From: Christoph Hellwig <>
Subject: Re: [PATCH 3/7] SUNRPC: make new svc_create_kthread function
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/18/187

> +int
> +svc_create_kthread(svc_thread_fn func, struct svc_rqst *rqstp)
> +{
> +	struct svc_serv *serv = rqstp->rq_server;
> +	struct task_struct *task;
> +
> +	task = kthread_create((int (*)(void *)) func, rqstp, serv->sv_name);
> +	if (IS_ERR(task))
> +		return PTR_ERR(task);
> +
> +	if (serv->sv_nrpools > 1)
> +		svc_pool_map_set_cpumask(task, rqstp->rq_pool->sp_id, NULL);
> +
> +	svc_sock_update_bufs(serv);
> +	wake_up_process(task);
> +	return 0;
I don't think we'll need this helper at all.  For the normal case of
not using a pool the caller can just call svc_sock_update_bufs even
before creating the thread, and the just use kthread_run.  That'll also
get rid of all this horrible casting things around for the thread entry
point function pointer.