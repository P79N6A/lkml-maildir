Date: Thu, 09 Aug 2007 18:20:37 -0400
From: Dan Zwell <>
Subject: Re: 2.6.23-rc1: USB hard disk broken
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/9/496

Alan Stern wrote:
> On Thu, 9 Aug 2007, Dan Zwell wrote:
> 
>> Oliver Neukum wrote:
>>> Am Sonntag 05 August 2007 schrieb Tino Keitel:
>>>> On Thu, Jul 26, 2007 at 10:06:40 +0200, Oliver Neukum wrote:
>>>>> Am Mittwoch 25 Juli 2007 schrieb Tino Keitel:
>>>>>> On Wed, Jul 25, 2007 at 10:24:36 +0200, Oliver Neukum wrote:
>>>>>>> Am Mittwoch 25 Juli 2007 schrieb Tino Keitel:
>>>>>>>> Hi,
>>>>>>>>
>>>>>>>> I just tried 2.6.23-rc1 and shortly after the boot my external USB hard
>>>>>>>> disk went mad.
>>>>>> [...]
>>>>>>
>>>>>>> Please recompile with CONFIG_USB_DEBUG set.
>>>>>>>
>>>> I tried again -rc1 without USB_DEBUG, and was able to reproduce the
>>>> bug 2 times. At the second time, the kernel log shows this:
>>>>
>>>> 2007-08-05_10:30:27.75572 kern.err: ehci_hcd 0000:00:1d.7: dev 6 ep1in scatterli
>>>> st error 0/-121
>>>> 2007-08-05_10:30:27.86576 kern.info: usb 1-6: reset high speed USB device using ehci_hcd and address 5
>>>> 2007-08-05_10:30:55.95293 kern.info: usb 1-6: USB disconnect, address 5
>>>> 2007-08-05_10:30:55.95300 kern.err: ehci_hcd 0000:00:1d.7: dev 6 ep1in scatterlist error -108/-108
>>> David, does this error say anything to you?
>>>
>>> 	Regards
>>> 		Oliver
>> Hi,
>>
>> I just completed a git bisect, and commit 
>> 8dfe4b14869fd185ca25ee88b02ada58a3005eaf was the commit that introduced 
>> this problem. This is "usb-storage: implement autosuspend". I don't 
>> think there have been many changes in drivers/usb since I last verified 
>> this problem, so I'm pretty sure this is still happening in the latest 
>> kernel.
>>
> What makes you think the problem you see is the same as the one 
> described by Tino?  Do you get the "scatterlist error 0/-121" line in 
> your log?
> 
> Please provide a dmesg log showing your problem with CONFIG_USB_DEBUG 
> enabled.
> 
> Alan Stern
> 
> 
You're right, it probably isn't the same error, unfortunately. I jumped 
to conclusions when I read Tino's description of the problem, "my 
external USB hard disk went mad", which is a very good description of 
what is happening to me. When any attempt is made to access the USB 
disk, it (logically) disconnects and reconnects. When using hald's 
automounting facilities, this leads to (endlessly repeated) madness.
I have attached my dmesg output (and a sanitized version that should 
contain all the important information, but is easier to read). It looks 
like the drive is auto suspended, but the resume process fails. Then the 
process is repeated.
[  126.512815] usb 1-1: usb auto-resume
[  126.543447] uhci_hcd 0000:00:1f.2: port 1 portsc 00a5,01
[  126.559426] usb 1-1: finish resume
[  126.561435] usb 1-1: gone after usb resume? status -19
[  126.561445] usb 1-1: can't resume, status -19
[  126.561451] hub 1-0:1.0: logical disconnect on port 1
[  126.562486] sd 5:0:0:0: [sdb] Result: hostbyte=DID_ERROR 
driverbyte=DRIVER_OK,SUGGEST_OK
Relevant info:
-obviously, I'm using uhci
-the drive is SATA, connected to USB with a SATA/IDE to USB adapter
-this problem does not occur with a USB flash drive
-reverting the commit that introduced auto-suspend prevents this error.
Thanks,
Dan
[unhandled content-type:application/x-bzip][unhandled content-type:application/x-bzip]