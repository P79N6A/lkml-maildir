Date: Mon, 27 Aug 2007 23:59:01 +0100
From: Alasdair G Kergon <>
Subject: Re: [RFC] block_device_operations prototype changes
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/27/425

On Mon, Aug 27, 2007 at 11:30:53AM +0100, Al Viro wrote:
> 3) ->ioctl().  What a mess...  
Yup.
See also:
  Subject: [PATCH] dm: support ioctls on mapped devices: fix with fake file
  
http://uwsg.indiana.edu/hypermail/linux/kernel/0606.2/2979.html
and related threads.
> First of all, we have 3 methods with different
> calling conventions:
> 	->ioctl(inode, file, cmd, arg)
> 	->unlocked_ioctl(inode, file, cmd, arg)
When I last looked it was:
  long (*unlocked_ioctl) (struct file *, unsigned int, unsigned long);
with the lack of inode forcing dm to use ->ioctl (because file can be NULL when
only the block device is known) and immediately drop the pointless-for-us
lock!
Alasdair
-- 
agk@redhat.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/