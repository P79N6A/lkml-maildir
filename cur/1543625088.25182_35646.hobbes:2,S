Date: Mon, 18 Mar 2002 12:43:12 +0100
From: Kurt Garloff <>
Subject: Re: SCSI-Problem with AM53C974
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/3/18/91

Hi,
On Mon, Mar 18, 2002 at 12:30:38PM +0100, Kurt Garloff wrote:
> Can you try the attached patch please? Patch is against 2.4.18.
Grmpff! Second try.
Regards,
-- 
Kurt Garloff  <garloff@suse.de>                          Eindhoven, NL
GPG key: See mail header, key servers         Linux kernel development
SuSE Linux AG, Nuernberg, DE                            SCSI, Security
--- linux-2.4.18.ipt_fixes2.ix86/drivers/scsi/AM53C974.c.orig	Sun Sep 30 21:26:07 2001
+++ linux-2.4.18.ipt_fixes2.ix86/drivers/scsi/AM53C974.c	Mon Mar 18 11:59:31 2002
@@ -732,6 +732,12 @@
 	hostdata->disconnecting = 0;
 	hostdata->dma_busy = 0;
 
+	if (request_region (instance->io_port, 128, "AM53C974")) {
+		printk ("AM53C974 (scsi%d): Could not get IO region %04lx. Detaching ...\n",
+			instance->host_no, instance->io_port);
+		scsi_unregister(instance);
+		return 0;
+	}
 /* Set up an interrupt handler if we aren't already sharing an IRQ with another board */
 	for (search = first_host;
 	     search && (((the_template != NULL) && (search->hostt != the_template)) ||
@@ -2441,6 +2447,7 @@
 static int AM53C974_release(struct Scsi_Host *shp)
 {
 	free_irq(shp->irq, shp);
+	release_region(shp->io_port, 128);
 	scsi_unregister(shp);
 	return 0;
 }[unhandled content-type:application/pgp-signature]