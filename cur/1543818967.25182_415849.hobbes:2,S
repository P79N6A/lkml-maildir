Date: Thu, 13 Apr 2006 16:35:18 -0700
From: Greg KH <>
Subject: modprobe bug for aliases with regular expressions
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/13/297

Recently it's been pointed out to me that the modprobe functionality
with aliases doesn't quite work properly for some USB modules.
Specifically, the usb-storage driver has a lot of aliases with regular
expressions for the bcd ranges.  Here's an example of it failing with a
real device:
$ modprobe -n -v --first-time usb:v054Cp0010d0410dc00dsc00dp00ic08iscFFip01
FATAL: Module usb:v054Cp0010d0410dc00dsc00dp00ic08iscFFip01 not found.
yet if we change the bcd range by replacing the first 0 with a 1 it
somehow works:
$ modprobe -n -v --first-time usb:v054Cp0010d0400dc00dsc00dp00ic08iscFFip01
insmod /lib/modules/2.6.17-rc1-gkh/kernel/drivers/usb/storage/libusual.ko
(yet this isn't a solution as the device does not have a 1 in that
position...)
If you look at the aliases for this driver, it looks like it should all
work properly:
$ modinfo libusual | grep v054Cp0010
alias:          usb:v054Cp0010d010[6-9]dc*dsc*dp*ic*isc*ip*
alias:          usb:v054Cp0010d0450dc*dsc*dp*ic*isc*ip*
alias:          usb:v054Cp0010d01[1-9]*dc*dsc*dp*ic*isc*ip*
alias:          usb:v054Cp0010d04[0-4]*dc*dsc*dp*ic*isc*ip*
alias:          usb:v054Cp0010d0[2-3]*dc*dsc*dp*ic*isc*ip*
alias:          usb:v054Cp0010d0600dc*dsc*dp*ic*isc*ip*
alias:          usb:v054Cp0010d05*dc*dsc*dp*ic*isc*ip*
I tried a simple fnmatch() call with the string and pattern, and it
works just fine:
#include <fnmatch.h>
#include <stdio.h>
int main (void)
{
	char *pattern = "usb:v054Cp0010d010[6-9]dc*dsc*dp*ic*isc*ip*";
	char *string = "usb:v054Cp0010d0410dc00dsc00dp00ic08iscFFip01";
	int result;
	result = fnmatch(pattern, string, 0);
	printf("result = %d\n", result);
	return 0;
}
$ gcc test.c -o test
$ ./test
result = 0
I tried to dig through the module-init-tools code (am using version
3.2.2 here) and try to track it down, but failed badly.  Any thoughts as
to what would be wrong here?
thanks,
greg k-h
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/