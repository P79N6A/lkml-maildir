Date: Mon, 14 Aug 2000 22:22:09 +0200
From: Vojtech Pavlik <>
Subject: Re: via82cxxx.c and ata66
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/14/153

On Mon, Aug 14, 2000 at 03:55:17PM -0400, Shane Shrybman wrote:
> 
> Hi,
> 
> I have been trying to get my two new ide drives to work at ata66
> without much luck. I am currently trying with Vojtech Pavlik's
> via82cxxx.c v1.7 with kernel 2.4.0-t7-p3. What am I doing wrong?
> 
> Here is the setup:
> 
> Abit KA7 motherboard with latest stable bios version TY
> The bios bootup screen lists the drives as ATA66
> I am using two 80 ribbon cables
> lilo append="idebus=33 ide0=ata66 ide1=ata66"
> mars:~# hdparm -i /dev/hdb
> 
> /dev/hdb:
> 
>  Model=IBM-DJNA-352030, FwRev=J58OA30K, SerialNo=GQ0GQ0D8601
>  Config={ HardSect NotMFM HdSw>15uSec Fixed DTR>10Mbs }
>  RawCHS=16383/16/63, TrkSize=0, SectSize=0, ECCbytes=34
>  BuffType=3(DualPortCache), BuffSize=1966kB, MaxMultSect=16, MultSect=off
>  DblWordIO=no, OldPIO=2, DMA=yes, OldDMA=2
>  CurCHS=16383/16/63, CurSects=-66060037, LBA=yes, LBAsects=39876480
>  tDMA={min:120,rec:120}, DMA modes: mword0 mword1 mword2 
>  IORDY=on/off, tPIO={min:240,w/IORDY:120}, PIO modes: mode3 mode4 
>  UDMA modes: mode0 mode1 mode2 mode3 *mode4 
> 
> mars:~# cat /proc/ide/via
> ----------VIA BusMastering IDE Configuration----------------
> South Bridge:                       VIA vt82c686a rev 0x21
> Command register:                   0x7
> Latency timer:                      32
> Master Read  Cycle IRDY:            0ws
> Master Write Cycle IRDY:            0ws
> FIFO Output Data 1/2 Clock Advance: off
> BM IDE Status Register Read Retry:  on
> Max DRDY Pulse Width:               No limit
> -----------------------Primary IDE-------Secondary IDE------
> Read DMA FIFO flush:           on                  on
> End Sect. FIFO flush:          on                  on
> Prefetch Buffer:               on                  on
> Post Write Buffer:             on                  on
> FIFO size:                      8                   8
> Threshold Prim.:              1/2                 1/2
> Bytes Per Sector:             512                 512
> Both channels togth:          yes                 yes
> -------------------drive0----drive1----drive2----drive3-----
> BMDMA enabled:        yes       yes       yes       yes
> Transfer Mode:       UDMA      UDMA   DMA/PIO      UDMA
> Cycle (T):           15ns      15ns      30ns      15ns
> Address Setup:        ---       ---        4T       ---
> Active Pulse:         ---       ---        4T       ---
> Recovery Time:        ---       ---        2T       ---
> Cycle Time:            4T        2T       10T        4T
> Transfer Rate:   33.0MB/s  66.0MB/s   6.6MB/s  33.0MB/s
> 
> As you can see all signs are the the drive should be working
> at ata66 but the transfer speed is not show any improvement
> from ata33.
> 
> I have tried with many combinations of kernels and patches
> all with similar results. The only thing I can think of to
> note is the with 2.2.17pre4 + andre's ide patches the dmesg
> output shows these drives as UDMA(66) but hdparm out is the
> same as above. 
> 
> I am a little frustrated, can someone help me out?
It definitely runs at UDMA66 speed. It's quite likely that the harddrive
can't deliver more than 14 megs per second. I have a IBM-DPTA-372050,
which is about the same, but 7200 rpm. It does 20 megs per second. If
you recompute that to 5400, which is your drive, you get the speed you
get. It doesn't help if you run the interface faster here.
Why the UDMA66 speed isn't autoselected is beyond me, though.
-- 
Vojtech Pavlik
SuSE Labs
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/