Date: Wed, 23 Jan 2008 16:37:23 +0100
From: Jiri Slaby <>
Subject: Re: [PATCH] drivers/char/moxa.c, kernel 2.6.23.14
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/23/161

On 01/22/2008 11:23 AM, Oyvind Aabling wrote:
> On Mon, 21 Jan 2008, Jiri Slaby wrote:
>> Would you be willing to test such a patch for point no. 3?
> 
> Yes, I could do that.
> 
> I can see your point about the non-portability of it, but
> how about this scenario, to provide backwards compatibility:
> 
> * We keep the (ugly and non-compatible) MOXA_GET_CONF
>   ioctl, to avoid breaking the old moxaload.
>   Let's rename it to MOXA_GET_CONF_OLD or MOXA_GET_CONF_BAD in the driver.
> * Create a new MOXA_GET_CONF ioctl (with a new
>   number, of course), that does it "the right way".
>   If you don't like renaming ioctl's, we need a new name for this one.
> * Rewrite moxaload to either do a kernel version check
>   and use the new ioctl if available or the old if not.
>   Or skip that and let it call the new ioctl first.
>   If it succeeds (system running a newer kernel): fine, and
>   if not (system running an older kernel), use the old ioctl.
> 
> The MOXA Intellio driver and moxaload have been "broken" ever since they
> were written in 1999, and this way, we don't break anything - you can
> use old or new kernel, and old or new moxaload in any combination.
> 
> Whaddaya think ?
We won't need anything from that. I'm almost done with firmware support. The 
only thing you'll need to do is to copy the .cod file(s) into /lib/firmware or 
wherever your firmware loader (probably udev nowadays) finds such files.
Could you post me lspci -vvxxx output of your moxa card?
thanks,
--js