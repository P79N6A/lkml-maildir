Date: Wed, 30 Aug 2006 12:02:59 +0200
From: "Rafael J. Wysocki" <>
Subject: Re: [PATCH -mm] PM: Add pm_trace switch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/8/30/60

On Tuesday 29 August 2006 22:46, Andrew Morton wrote:
> On Tue, 29 Aug 2006 13:09:57 +0200
> "Rafael J. Wysocki" <rjw@sisk.pl> wrote:
> 
> > +int pm_trace_enabled;
> > +
> > +static ssize_t pm_trace_show(struct subsystem * subsys, char * buf)
> > +{
> > +	return sprintf(buf, "%d\n", pm_trace_enabled);
> > +}
> > +
> > +static ssize_t
> > +pm_trace_store(struct subsystem * subsys, const char * buf, size_t n)
> > +{
> > +	int val;
> > +
> > +	if (sscanf(buf, "%d", &val) == 1) {
> > +		pm_trace_enabled = !!val;
> > +		return n;
> > +	}
> > +	return -EINVAL;
> > +}
> > +
> > +power_attr(pm_trace);
> 
> <grumbles about documentation>
Well, this is the most difficult part. ;-)
Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
---
 Documentation/power/interface.txt |   15 +++++++++++++++
 1 file changed, 15 insertions(+)
Index: linux-2.6.18-rc4-mm3/Documentation/power/interface.txt
===================================================================
--- linux-2.6.18-rc4-mm3.orig/Documentation/power/interface.txt	2006-06-18 03:49:35.000000000 +0200
+++ linux-2.6.18-rc4-mm3/Documentation/power/interface.txt	2006-08-30 11:59:31.000000000 +0200
@@ -52,3 +52,18 @@ suspend image will be as small as possib
 
 Reading from this file will display the current image size limit, which
 is set to 500 MB by default.
+
+/sys/power/pm_trace controls the code which saves the last PM event point in
+the RTC across reboots, so that you can debug a machine that just hangs
+during suspend (or more commonly, during resume).  Namely, the RTC is only
+used to save the last PM event point if this file contains '1'.  Initially it
+contains '0' which may be changed to '1' by writing a string representing a
+nonzero integer into it.
+
+To use this debugging feature you should attempt to suspend the machine, then
+reboot it and run
+
+	dmesg -s 1000000 | grep 'hash matches'
+
+CAUTION: Using it will cause your machine's real-time (CMOS) clock to be
+set to a random invalid time after a resume.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/