Date: Wed, 25 Jul 2007 20:10:16 -0700
From: Andrew Morton <>
Subject: Re: [PATCH] config_zone_movable [1/2] clean up zone config by renumbering
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/25/518

On Thu, 26 Jul 2007 11:50:20 +0900 KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com> wrote:
> I refreshed config_zone_movable patch set against 2.6.23-rc1.
> Reflected comments on previous version.
> Tested on ia64/NUMA system and my small i386 desktop.
> 
> Andrew, I like this patch but know that there are many types of memory layout. 
> Could you test this set in -mm ?
> I'll refresh this against rc1-mm1 if necessary.
Right now I want to concentrate on getting the present -mm queue vaguely
stabilised, so I'd prefer to not be adding features or nontrivial cleanups
for a few days at the minimum.
This process would be greatly aided by developers testing it out and
sending fixes (or at least, reports) for anything they encounter.
> -Kame
> 
> ==
> zone_ifdef_cleanup_by_renumbering.patch
> 
> Now, this patch defines zone_idx for not-configured-zones.
> like 
> 	enum_zone_type {
> 		(ZONE_DMA configured)
> 		(ZONE_DMA32 configured)
> 		ZONE_NORMAL
> 		(ZONE_HIGHMEM configured)
> 		ZONE_MOVABLE
> 		MAX_NR_ZONES,
> 		(ZONE_DMA not-configured)
> 		(ZONE_DMA32 not-configured)
> 		(ZONE_HIGHMEM not-configured)
> 	};
> 
> By this, we can determine zone is configured or not by
> 
> 	zone_idx < MAX_NR_ZONES.
> 
> We can avoid #ifdef for CONFIG_ZONE_xxx to some extent.
> 
> This patch also replaces CONFIG_ZONE_DMA_FLAG by is_configured_zone(ZONE_DMA).
> 
> Changelog: v1 -> v2
> 	- rebased to 2.6.23-rc1
> 	- Removed MAX_POSSIBLE_ZONES
> 	- Added comments
Is this patch a bugfix?
box:/home/akpm> grep ifdef ~/x
zone_ifdef_cleanup_by_renumbering.patch
We can avoid #ifdef for CONFIG_ZONE_xxx to some extent.
+ * You can use this functio for avoiding #ifdef.
+ * #ifdef OCNFIG_ZONE_DMA
-#ifdef CONFIG_HIGHMEM
-#ifdef CONFIG_HIGHMEM
-#ifdef CONFIG_ZONE_DMA32
-#ifdef CONFIG_ZONE_DMA
-#ifdef CONFIG_ZONE_DMA
-#ifdef CONFIG_ZONE_DMA32
-#ifdef CONFIG_HIGHMEM
-#ifdef CONFIG_ZONE_DMA
-#ifdef CONFIG_ZONE_DMA32
-#ifdef CONFIG_HIGHMEM
-#ifdef CONFIG_ZONE_DMA
-#ifdef CONFIG_ZONE_DMA32
-#ifdef CONFIG_HIGHMEM
-#ifdef CONFIG_HIGHMEM
-#ifdef CONFIG_HIGHMEM
ooh, me like.
>  /*
> + * Test zone type is configured or not.
> + * You can use this functio for avoiding #ifdef.
> + *
> + * #ifdef OCNFIG_ZONE_DMA
typo there.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/