Date: Tue, 31 Jul 2007 17:05:01 -0600
From: Bjorn Helgaas <>
Subject: Re: 2.6.23-rc1-mm1 - seems OK on Dell Latitude D820, except for tpm_tis
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/31/586

On Tuesday 31 July 2007 03:31:43 pm Valdis.Kletnieks@vt.edu wrote:
> On Tue, 31 Jul 2007 14:01:21 MDT, Bjorn Helgaas said:
> > So, the BIOS is telling us that at least as currently configured, the
> > TPM can't use interrupts.  /sys/devices/pnp0/00:0f/options should have
> > all the *possible* TPM configurations.  I would guess that none of them
> > shows an IRQ either.
> 
> Hmm.. Oddness. Looks empty:
> 
> # cat /sys/devices/pnp0/00\:0f/options | wc
>       0       0       0
> 
> Or is that expected if the chipset has one cast-in-stone/ROM config?
"options" is populated using the ACPI _PRS method.  The spec says that
method is optional and non-configurable devices will not provide it.
So I guess that's what you have -- a device with a fixed configuration.
> Patch tested, and seems to decide to initialize in polled mode on my
> machine, without having to do any /etc/modprobe.conf 'interrupts=0'.
> I'm able to run the tpm_demo program from libtpm-2.0, so /dev/tpm0 does
> seem to be operational.
> 
> You can stick this on the patch and pass it along:
> 
> Tested-By: <valdis.kletnieks@vt.edu>
> 
> but I'd suggest running a regression test against a chipset that *does*
> do IRQs before sending it upstream (if you haven't already)...
Yes.  I don't think I have a box with a TIS TPM on it, but I hope
Kylene does and will comment on this approach.
I notice Andrew put it in -mm already.  I'll be on vacation for the
next couple weeks, so I won't be able to poke at this for a while.
Here's the changelog I would insert (for tpm_tis-fix-interrupt-probing.patch):
[patch] tpm: pay attention to IRQ info from PNP
If we discover the TIS TPM device via PNP, use the PNP IRQ information
rather than probing for an IRQ.  If PNP shows no IRQ, run the TPM in
polling mode.
Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/