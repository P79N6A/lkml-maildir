Date: Wed, 19 Dec 2007 19:35:14 +0100
From: Marcin Slusarz <>
Subject: Re: [PATCH 6/6] udf: fix sparse warnings (shadowing & mismatch between declaration and definition)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/19/182

On Mon, Dec 17, 2007 at 05:50:17PM +0100, Jan Kara wrote:
> > fix warnings:
> > fs/udf/super.c:1320:24: warning: symbol 'bh' shadows an earlier one
> > fs/udf/super.c:1240:21: originally declared here
> > fs/udf/super.c:1583:4: warning: symbol 'i' shadows an earlier one
> > fs/udf/super.c:1418:6: originally declared here
> > fs/udf/super.c:1585:4: warning: symbol 'i' shadows an earlier one
> > fs/udf/super.c:1418:6: originally declared here
> > fs/udf/super.c:1658:4: warning: symbol 'i' shadows an earlier one
> > fs/udf/super.c:1648:6: originally declared here
> > fs/udf/super.c:1660:4: warning: symbol 'i' shadows an earlier one
> > fs/udf/super.c:1648:6: originally declared here
> > fs/udf/super.c:450:6: warning: symbol 'udf_write_super' was not declared. Should it be static?
> >
> > Signed-off-by: Marcin Slusarz <marcin.slusarz@gmail.com>
> > CC: Ben Fennema <bfennema@falcon.csc.calpoly.edu>
>   Thanks for the patch.  The 'bh' change is fine. The problems with 'i'
> should be solved differently I think. Those functions UDF_SB_FREE,
> UDF_SB_ALLOC_PARTMAPS should be functions and not macros. Please convert
> those to either inline functions if they are small or to regular
> functions if they are larger.  It won't be completely trivial because of
> the hackery e.g. in UDF_SB_ALLOC_BITMAP. It gets an argument meaning on
> which struct member something should be performed. But for example in
> the UDF_SB_ALLOC_BITMAP case you can simply make the function return the
> pointer to allocated and initialized space and the caller would assign
> it to a proper element of the superblock.
Ok, I'll try to do it.
> This would help the overall
> code quality of UDF (which is sadly quite poor).
If you have other suggestions how to clean up this code, let me know.
I'll see what I can do with them ;)
Marcin