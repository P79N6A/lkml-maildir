Date: Sat, 16 Sep 2000 01:02:10 +0200
From: Dag B <>
Subject: PROBLEM: ds.o fails to properly enable CardBus card (2.4.0t8)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/15/84

Hi
I have a Xircom RealPort card which currently is useless under Linux on
my laptop. I have tried the kernel pcmcia code and David's standalone
package.
After insmod'ing ds.o, I get:
cs: cb_alloc(bus 4): vendor 0x115d, device 0x0003
PCI: Failed to allocate resource 1 for PCI device 115d:0003
PCI: Failed to allocate resource 2 for PCI device 115d:0003
PCI: Failed to allocate resource 6 for PCI device 115d:0003
PCI: Enabling device 04:00.0 (0000 -> 0003)
PCI: Failed to allocate resource 1 for PCI device 115d:0103
PCI: Failed to allocate resource 2 for PCI device 115d:0103
PCI: Failed to allocate resource 6 for PCI device 115d:0103
PCI: Enabling device 04:00.1 (0000 -> 0003)
I also note the following output from the kernel:
PCI: PCI BIOS revision 2.10 entry at 0xfc0ee, last bus=1
So: the PCI code says that the last bus is '1', but my CardBus bus #4.
Is this expected?
I also notice that if I insmod/rmmod ds.o multiple times, I will get
multiple entries for the devices on the card in the 'lspci' output:
04:00.0 Ethernet controller: Xircom Cardbus Ethernet 10/100 (rev 03)
04:00.0 Ethernet controller: Xircom Cardbus Ethernet 10/100 (rev 03)
04:00.1 VGA compatible controller: Xircom Cardbus Ethernet + 56k Modem
(rev 03)
04:00.1 VGA compatible controller: Xircom Cardbus Ethernet + 56k Modem
(rev 03)
Hardware: Dell CPiA366 (tested bios rev. A01/A05/A09), Xircom RealPort
RBEM56G-100.
Software: plain 2.4.0-test8, gcc 2.95.2.
The following should illustrate the problem in full.
dagblap:~# lsmod
Module                  Size  Used by
dagblap:~# lspci
00:00.0 Host bridge: Intel Corporation 440BX/ZX - 82443BX/ZX Host bridge
(rev 03)
00:01.0 PCI bridge: Intel Corporation 440BX/ZX - 82443BX/ZX AGP bridge
(rev 03)
00:03.0 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:03.1 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:07.0 Bridge: Intel Corporation 82371AB PIIX4 ISA (rev 02)
00:07.1 IDE interface: Intel Corporation 82371AB PIIX4 IDE (rev 01)
00:07.2 USB Controller: Intel Corporation 82371AB PIIX4 USB (rev 01)
00:07.3 Bridge: Intel Corporation 82371AB PIIX4 ACPI (rev 02)
00:0d.0 Ethernet controller: 3Com Corporation 3c905 100BaseTX
[Boomerang]
01:00.0 VGA compatible controller: Neomagic Corporation [MagicMedia
256AV] (rev 20)
01:00.1 Multimedia audio controller: Neomagic Corporation [MagicMedia
256AV Audio] (rev 20)
dagblap:~# insmod pcmcia_core
Using /lib/modules/2.4.0-test8/kernel/drivers/pcmcia/pcmcia_core.o
dagblap:~# insmod yenta_socket
Using /lib/modules/2.4.0-test8/kernel/drivers/pcmcia/yenta_socket.o
dagblap:~# insmod ds
Using /lib/modules/2.4.0-test8/kernel/drivers/pcmcia/ds.o
dagblap:~# dmesg 
Linux version 2.4.0-test8 (root@dagblap) (gcc version 2.95.2 19991024
(release)) #4 Fri Sep 15 17:05:
21 CEST 2000
BIOS-provided physical RAM map:
 BIOS-e820: 000000000009fc00 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
 BIOS-e820: 000000000000c000 @ 00000000000c0000 (reserved)
 BIOS-e820: 0000000005ef0000 @ 0000000000100000 (usable)
 BIOS-e820: 0000000000010000 @ 0000000005ff0000 (ACPI data)
 BIOS-e820: 0000000000060000 @ 00000000100a0000 (reserved)
 BIOS-e820: 0000000000200000 @ 00000000ffe00000 (reserved)
On node 0 totalpages: 24560
zone(0): 4096 pages.
zone(1): 20464 pages.
zone(2): 0 pages.
Kernel command line: auto BOOT_IMAGE=test8d ro
root=/dev/discs/disc0/part5
Initializing CPU#0
Detected 363963654 Hz processor.
Console: colour dummy device 80x25
Calibrating delay loop... 725.81 BogoMIPS
Memory: 94284k/98240k available (1487k kernel code, 3568k reserved, 104k
data, 196k init, 0k highmem)
Dentry-cache hash table entries: 16384 (order: 5, 131072 bytes)
Buffer-cache hash table entries: 4096 (order: 2, 16384 bytes)
Page-cache hash table entries: 32768 (order: 5, 131072 bytes)
Inode-cache hash table entries: 8192 (order: 4, 65536 bytes)
CPU: Intel Mobile Pentium II stepping 0a
Checking 'hlt' instruction... OK.
POSIX conformance testing by UNIFIX
mtrr: v1.36 (20000221) Richard Gooch (rgooch@atnf.csiro.au)
PCI: PCI BIOS revision 2.10 entry at 0xfc0ee, last bus=1
PCI: Using configuration type 1
PCI: Probing PCI hardware
PCI: Using IRQ router default [8086/1234] at 00:07.0
Limiting direct PCI/PCI transfers.
Linux NET4.0 for Linux 2.4
Based upon Swansea University Computer Society NET3.039
NET4: Unix domain sockets 1.0/SMP for Linux NET4.0.
NET4: Linux TCP/IP 1.0 for NET4.0
IP Protocols: ICMP, UDP, TCP
IP: routing cache hash table of 512 buckets, 4Kbytes
TCP: Hash tables configured (established 8192 bind 8192)
Starting kswapd v1.7
i2c-core.o: i2c core module
i2c-dev.o: i2c /dev entries driver module
i2c-core.o: driver i2c-dev dummy driver registered.
i2c-algo-bit.o: i2c bit algorithm module
vesafb: framebuffer at 0xfb000000, mapped to 0xc6800000, size 2432k
vesafb: mode is 1024x768x8, linelength=1024, pages=2
vesafb: protected mode interface info at c000:aea0
vesafb: scrolling: redraw
Console: switching to colour frame buffer device 128x48
fb0: VESA VGA frame buffer device
pty: 256 Unix98 ptys configured
RAMDISK driver initialized: 16 RAM disks of 4096K size 1024 blocksize
loop: registered device at major 7
loop: enabling 8 loop devices
Uniform Multi-Platform E-IDE driver Revision: 6.31
ide: Assuming 33MHz system bus speed for PIO modes; override with
idebus=xx
PIIX4: IDE controller on PCI bus 00 dev 39
PIIX4: chipset revision 1
PIIX4: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0x0860-0x0867, BIOS settings: hda:DMA, hdb:pio
    ide1: BM-DMA at 0x0868-0x086f, BIOS settings: hdc:pio, hdd:pio
hda: IBM-DKLA-24320, ATA DISK drive
hdc: SAMSUNG CD-ROM SCR-2438, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
ide1 at 0x170-0x177,0x376 on irq 15
hda: 8452080 sectors (4327 MB) w/460KiB Cache, CHS=526/255/63, UDMA(33)
hdc: ATAPI 24X CD-ROM drive, 128kB Cache, DMA
Uniform CD-ROM driver Revision: 3.11
Partition check:
 /dev/ide/host0/bus0/target0/lun0: p1 p2 p3 < p5 p6 > p4
Floppy drive(s): fd0 is 1.44M
FDC 0 is a post-1991 82077
Serial driver version 5.02 (2000-08-09) with MANY_PORTS SHARE_IRQ
SERIAL_PCI enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
ttyS03 at 0x02e8 (irq = 3) is a 16550A
PPP generic driver version 2.4.1
3c59x.c:LK1.1.8  13 Aug 2000  Donald Becker and others.
http://www.scyld.com/network/vortex.html
 $Rev
ision: 1.102.2.25 $
See Documentation/networking/vortex.txt
eth0: 3Com PCI 3c905 Boomerang 100baseTx at 0xec80,  00:c0:4f:3f:c9:11,
IRQ 10
  8K word-wide RAM 3:5 Rx:Tx split, autoselect/MII interface.
  MII transceiver found at address 24, status 786f.
  Enabling bus-master transmits and whole-frame receives.
PPP Deflate Compression module registered
PPP BSD Compression module registered
devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
devfs: boot_options: 0x2
kmem_create: Forcing size word alignment - nfs_fh
ACPI: support found
ACPI: PBLK 1 @ 0x0810:6
ACPI: C2 supported
ACPI: S1 supported
ACPI: S5 supported
ACPI C2 works
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 196k freed
Warning: unable to open an initial console.
eth0: first available media type: MII
Linux PCMCIA Card Services 3.1.20
  options:  [pci] [cardbus] [pm]
Yenta IRQ list 0098, PCI irq11
Socket status: 30000006
Yenta IRQ list 0098, PCI irq11
Socket status: 30000020
cs: cb_alloc(bus 4): vendor 0x115d, device 0x0003
PCI: Failed to allocate resource 1 for PCI device 115d:0003
PCI: Failed to allocate resource 2 for PCI device 115d:0003
PCI: Failed to allocate resource 6 for PCI device 115d:0003
PCI: Enabling device 04:00.0 (0000 -> 0003)
PCI: Failed to allocate resource 1 for PCI device 115d:0103
PCI: Failed to allocate resource 2 for PCI device 115d:0103
PCI: Failed to allocate resource 6 for PCI device 115d:0103
PCI: Enabling device 04:00.1 (0000 -> 0003)
dagblap:~# lspci
00:00.0 Host bridge: Intel Corporation 440BX/ZX - 82443BX/ZX Host bridge
(rev 03)
00:01.0 PCI bridge: Intel Corporation 440BX/ZX - 82443BX/ZX AGP bridge
(rev 03)
00:03.0 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:03.1 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:07.0 Bridge: Intel Corporation 82371AB PIIX4 ISA (rev 02)
00:07.1 IDE interface: Intel Corporation 82371AB PIIX4 IDE (rev 01)
00:07.2 USB Controller: Intel Corporation 82371AB PIIX4 USB (rev 01)
00:07.3 Bridge: Intel Corporation 82371AB PIIX4 ACPI (rev 02)
00:0d.0 Ethernet controller: 3Com Corporation 3c905 100BaseTX
[Boomerang]
01:00.0 VGA compatible controller: Neomagic Corporation [MagicMedia
256AV] (rev 20)
01:00.1 Multimedia audio controller: Neomagic Corporation [MagicMedia
256AV Audio] (rev 20)
04:00.0 Ethernet controller: Xircom Cardbus Ethernet 10/100 (rev 03)
04:00.1 VGA compatible controller: Xircom Cardbus Ethernet + 56k Modem
(rev 03)
dagblap:~# rmmod ds
dagblap:~# lspci
00:00.0 Host bridge: Intel Corporation 440BX/ZX - 82443BX/ZX Host bridge
(rev 03)
00:01.0 PCI bridge: Intel Corporation 440BX/ZX - 82443BX/ZX AGP bridge
(rev 03)
00:03.0 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:03.1 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:07.0 Bridge: Intel Corporation 82371AB PIIX4 ISA (rev 02)
00:07.1 IDE interface: Intel Corporation 82371AB PIIX4 IDE (rev 01)
00:07.2 USB Controller: Intel Corporation 82371AB PIIX4 USB (rev 01)
00:07.3 Bridge: Intel Corporation 82371AB PIIX4 ACPI (rev 02)
00:0d.0 Ethernet controller: 3Com Corporation 3c905 100BaseTX
[Boomerang]
01:00.0 VGA compatible controller: Neomagic Corporation [MagicMedia
256AV] (rev 20)
01:00.1 Multimedia audio controller: Neomagic Corporation [MagicMedia
256AV Audio] (rev 20)
04:00.0 Ethernet controller: Xircom Cardbus Ethernet 10/100 (rev 03)
04:00.1 VGA compatible controller: Xircom Cardbus Ethernet + 56k Modem
(rev 03)
dagblap:~# insmod ds
Using /lib/modules/2.4.0-test8/kernel/drivers/pcmcia/ds.o
dagblap:~# lspci
00:00.0 Host bridge: Intel Corporation 440BX/ZX - 82443BX/ZX Host bridge
(rev 03)
00:01.0 PCI bridge: Intel Corporation 440BX/ZX - 82443BX/ZX AGP bridge
(rev 03)
00:03.0 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:03.1 CardBus bridge: Texas Instruments PCI1225 (rev 01)
00:07.0 Bridge: Intel Corporation 82371AB PIIX4 ISA (rev 02)
00:07.1 IDE interface: Intel Corporation 82371AB PIIX4 IDE (rev 01)
00:07.2 USB Controller: Intel Corporation 82371AB PIIX4 USB (rev 01)
00:07.3 Bridge: Intel Corporation 82371AB PIIX4 ACPI (rev 02)
00:0d.0 Ethernet controller: 3Com Corporation 3c905 100BaseTX
[Boomerang]
01:00.0 VGA compatible controller: Neomagic Corporation [MagicMedia
256AV] (rev 20)
01:00.1 Multimedia audio controller: Neomagic Corporation [MagicMedia
256AV Audio] (rev 20)
04:00.0 Ethernet controller: Xircom Cardbus Ethernet 10/100 (rev 03)
04:00.0 Ethernet controller: Xircom Cardbus Ethernet 10/100 (rev 03)
04:00.1 VGA compatible controller: Xircom Cardbus Ethernet + 56k Modem
(rev 03)
04:00.1 VGA compatible controller: Xircom Cardbus Ethernet + 56k Modem
(rev 03)
Repeating the rmmod/insmod cycle adds more duplicate entries.
Is this a CardBus problem, a PCI problem, or hardware? (I don't think
the BIOS can be made responsible for removable hardware, but..)
I'd like to note that the hardware is known good. 
Any takers?
Dag B
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/