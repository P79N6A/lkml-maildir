Date: Thu, 31 Jan 2008 16:40:45 +0900
From: Paul Mundt <>
Subject: Re: Purpose of numa_node?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/31/44

On Wed, Jan 30, 2008 at 07:48:13PM -0500, Chris Snook wrote:
> While pondering ways to optimize I/O and swapping on large NUMA machines, I 
> noticed that the numa_node field in struct device isn't actually used 
> anywhere. We just have a couple dozen lines of code to conditionally 
>  create a sysfs file that will always return -1.  Is anyone even working on 
> code to actually use this field?  I think it's a good piece of information 
> to keep track of, so I'm not suggesting we remove it, but I want to make 
> sure I'm not stepping on toes or duplicating effort if I try to make it 
> useful.
> 
It's manipulated with accessors. If you look at the users of
dev_to_node()/set_dev_node() you can see where it's being used. It's
primarily used in allocation paths for node locality, and the existing
set_dev_node() callsites are places where node locality information
already exists (ie, which node a given controller sits on). You can see
this in places like PCI (pcibus_to_node()) and USB, with node allocation
hints used in places like the dmapool and skb alloc paths.
The in-kernel use looks perfectly sane in that regard, though I'm not
sure what the point of exporting this as a RO attribute to userspace is.
Presumably someone has a tool somewhere that cares about this.