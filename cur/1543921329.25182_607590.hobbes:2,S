Date: Sat, 20 Oct 2007 02:52:30 +0200
From: Paolo Giarrusso <>
Subject: Re: [uml-devel] User Mode Linux still doesn't build in 2.6.23-final.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/19/396

On venerdì 12 ottobre 2007, Rob Landley wrote:
> [Second try, without clicking "compress" on the file attachment because
> then sourceforge's spam filter bounces it.]
>
> ---
>
> The User Mode Linux build still breaks for me:
> > In file included from include/asm/arch/tlb.h:18,
> >                  from include/asm/tlb.h:4,
> >                  from arch/um/kernel/smp.c:8:
> > include/asm-generic/tlb.h: In function ‘tlb_flush_mmu’:
> > include/asm-generic/tlb.h:76: error: implicit declaration of function
> > ‘release_pages’ include/asm-generic/tlb.h: In function ‘tlb_remove_page’:
> > include/asm-generic/tlb.h:105: error: implicit declaration of function
> > ‘page_cache_release’ make[1]: *** [arch/um/kernel/smp.o] Error 1
> > make: *** [arch/um/kernel] Error 2
>
> I submitted the following patch to fix it to the UML list after 2.6.23-rc3:
> 
http://sourceforge.net/mailarchive/forum.php?thread_name=200708212148.05392
>.rob%40landley.net&forum_name=user-mode-linux-devel
>
> On september 4, I confirmed that I still needed it to build -rc5:
> 
http://sourceforge.net/mailarchive/message.php?msg_name=200709040737.54516.
>rob%40landley.net
>
> Guess what?  I still need this patch to build the final 2.6.23, months
> later.
>
> I know it may not be the right fix, but the build breaks for me without
> this patch. The .config that breaks is attached.  ARCH=um.
Guess most people are not using SMP right now, and that the error disappears 
without that setting - I'm being away for a long while, has SKAS+SMP support 
been merged?
However, a quick look at my sources tells otherwise, and git-describe says 
that's a v2.6.23-rc6-239-gc2f8289 tree.
So I've no idea...
> ----------  Forwarded Message  ----------
>
> Subject: [uml-devel] UML doesn't build in 2.6.23-rc3.
> Date: Tuesday 21 August 2007
> From: Rob Landley <rob@landley.net>
> To: uml-devel <user-mode-linux-devel@lists.sourceforge.net>
>
> I fixed it for me with the following patch, just in case anybody else had
> this problem:
>
> --- linux-2.6.23-rc3/arch/um/kernel/smp.c	2007-08-12 23:25:24.000000000
> -0500 +++ linux-2.6.23-new/arch/um/kernel/smp.c	2007-08-21
> 21:39:00.000000000 -0500 @@ -5,6 +5,7 @@
>
>  #include "linux/percpu.h"
>  #include "asm/pgalloc.h"
> +#include "linux/pagemap.h"
>  #include "asm/tlb.h"
>
>  /* For some reason, mmu_gathers are referenced when CONFIG_SMP is off. */
-- 
"Doh!" (cit.), I've made another mistake!
Paolo Giarrusso, aka Blaisorblade
[unhandled content-type:application/pgp-signature]