Date: Thu, 01 Feb 2007 16:13:11 -0500
From: Jeff Moyer <>
Subject: Re: [patch] aio: fix buggy put_ioctx call in aio_complete - v2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/1/279

==> On Fri, 29 Dec 2006 17:34:26 -0800, "Chen, Kenneth W" <kenneth.w.chen@intel.com> said:
Kenneth> An AIO bug was reported that sleeping function is being called in softirq
Kenneth> context:
Kenneth> The real problem is that the condition check of ctx->reqs_active in
Kenneth> wait_for_all_aios() is incorrect that access to reqs_active is not
Kenneth> being properly protected by spin lock.
Kenneth> This patch adds that protective spin lock, and at the same time removes
Kenneth> all duplicate ref counting for each kiocb as reqs_active is already used
Kenneth> as a ref count for each active ioctx.  This also ensures that buggy call
Kenneth> to flush_workqueue() in softirq context is eliminated.
I was finally able to wrap my head around this, and testing has
confirmed that this patch fixes the problem.  So,
Acked-by: Jeff Moyer <jmoyer@redhat.com>
Better late than never.
-Jeff
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/