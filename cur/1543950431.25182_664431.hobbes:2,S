Date: Thu, 6 Mar 2008 13:52:15 +0100
From: Ingo Molnar <>
Subject: Re: preempt bug in set_pmd_pfn?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/6/160

* Jeremy Fitzhardinge <jeremy@goop.org> wrote:
> It seems to me that the correct fix is to just make __set_fixmap 
> disable preemption for its duration; it probably doesn't make much 
> difference for the native case, and it makes Xen happy.
actually, i think the correct approach is to remove the TLB flushing and 
perhaps to check that the old pte is not present. Do we ever _change_ 
mappings via __set_fixmap()? I think we only ever install them.
but if we ever change them somewhere then the correct approach is to do 
a flush_tlb_all(). It's not just about preemption but about the fact 
that we modified the kernel address space and we must propagate that to 
all CPUs.
the vmalloc() backtrace you sent - how did set_pte_pfn() get into that 
codepath - vmalloc shouldnt be using __set_fixmap().
	Ingo