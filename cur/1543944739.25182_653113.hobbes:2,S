Date: Wed, 13 Feb 2008 19:36:49 +0100
From: Marcin Slusarz <>
Subject: Re: [PATCH] crypto: be*_add_cpu conversion
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/13/431

On Wed, Feb 13, 2008 at 09:25:47AM +0100, Roel Kluin wrote:
> marcin.slusarz@gmail.com wrote:
> > From: Marcin Slusarz <marcin.slusarz@gmail.com>
> > 
> > replace all:
> > big_endian_variable = cpu_to_beX(beX_to_cpu(big_endian_variable) +
> > 					expression_in_cpu_byteorder);
> > with:
> > 	beX_add_cpu(&big_endian_variable, expression_in_cpu_byteorder);
> > generated with semantic patch
> > 
> > Signed-off-by: Marcin Slusarz <marcin.slusarz@gmail.com>
> > Cc: Herbert Xu <herbert@gondor.apana.org.au>
> > Cc: David S. Miller <davem@davemloft.net>
> > ---
> >  crypto/lrw.c |    2 +-
> >  1 files changed, 1 insertions(+), 1 deletions(-)
> > 
> > diff --git a/crypto/lrw.c b/crypto/lrw.c
> > index 9d52e58..4d93928 100644
> > --- a/crypto/lrw.c
> > +++ b/crypto/lrw.c
> > @@ -92,7 +92,7 @@ struct sinfo {
> >  static inline void inc(be128 *iv)
> >  {
> >  	if (!(iv->b = cpu_to_be64(be64_to_cpu(iv->b) + 1)))
> 
> maybe you also want instead of the line above:
> 
> 	be64_add_cpu(&iv->b, 1);
> 	if (!iv->b)
> 
> > -		iv->a = cpu_to_be64(be64_to_cpu(iv->a) + 1);
> > +		be64_add_cpu(&iv->a, 1);
> >  }
> > 
> >  static inline void lrw_round(struct sinfo *s, void *dst, const void *src)
> 
I'm a bit ashamed... but here is updated patch:
---
crypto: replace all adds to big endians variables with be*_add_cpu
replace all:
big_endian_variable = cpu_to_beX(beX_to_cpu(big_endian_variable) +
					expression_in_cpu_byteorder);
with:
	beX_add_cpu(&big_endian_variable, expression_in_cpu_byteorder);
Signed-off-by: Marcin Slusarz <marcin.slusarz@gmail.com>
Cc: Herbert Xu <herbert@gondor.apana.org.au>
Cc: David S. Miller <davem@davemloft.net>
Cc: Roel Kluin <12o3l@tiscali.nl>
---
 crypto/lrw.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)
diff --git a/crypto/lrw.c b/crypto/lrw.c
index 9d52e58..8ef664e 100644
--- a/crypto/lrw.c
+++ b/crypto/lrw.c
@@ -91,8 +91,9 @@ struct sinfo {
 
 static inline void inc(be128 *iv)
 {
-	if (!(iv->b = cpu_to_be64(be64_to_cpu(iv->b) + 1)))
-		iv->a = cpu_to_be64(be64_to_cpu(iv->a) + 1);
+	be64_add_cpu(&iv->b, 1);
+	if (!iv->b)
+		be64_add_cpu(&iv->a, 1);
 }
 
 static inline void lrw_round(struct sinfo *s, void *dst, const void *src)
-- 
1.5.3.7