Date: Fri, 4 Aug 2000 10:39:14 +0100 (BST)
From: Mark Hemment <>
Subject: [PATCH] small inode.c performance
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/4/29

Hi,
  Attached is a small patch, against 2.4.0-test5, for 
fs/inode.c/find_inode().
  Previous, find_inode() first checked against i_sb, and then
i_ino.  This patch reverses the test order.
  Reasoning;
	o i_sb is more likely to give "false positives" than i_ino, so
	  best to test i_ino first.
	o i_sb is on a different L1 cache line than the inode hash linkage
	  (while i_ino is on the same L1 line as the linkage), so avoid
	  accessing it when not necessary.
  OK, the i-node cache is a slave to the dcache, so this isn't a real
hot-spot, but the patch is valid.
Mark
--- linux-2.4.0-test5/fs/inode.c	Thu Jul 13 00:24:41 2000
+++ markhe-2.4.0-test5/fs/inode.c	Tue Aug  1 16:13:38 2000
@@ -489,9 +489,9 @@
 		if (tmp == head)
 			break;
 		inode = list_entry(tmp, struct inode, i_hash);
-		if (inode->i_sb != sb)
-			continue;
 		if (inode->i_ino != ino)
+			continue;
+		if (inode->i_sb != sb)
 			continue;
 		if (find_actor && !find_actor(inode, ino, opaque))
 			continue;