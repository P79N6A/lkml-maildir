Date: Mon, 16 May 2005 16:07:33 -0700 (PDT)
From: Christoph Lameter <>
Subject: Re: 2.6.12-rc4-mm2 build failure
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/5/16/284

On Mon, 16 May 2005, Martin J. Bligh wrote:
> ppc64 box
> 
> drivers/ide/ide-probe.c: In function `ide_init_queue':
> drivers/ide/ide-probe.c:982: warning: implicit declaration of function `pcibus_to_node'
> drivers/ide/ide-disk.c: In function `ide_disk_probe':
> drivers/ide/ide-disk.c:1225: warning: implicit declaration of function `pcibus_to_node'
> drivers/built-in.o(.text+0xaee4c): In function `.init_irq':
> : undefined reference to `.pcibus_to_node'
> drivers/built-in.o(.text+0xaf01c): In function `.init_irq':
> : undefined reference to `.pcibus_to_node'
> drivers/built-in.o(.text+0xb7808): In function `.ide_disk_probe':
> : undefined reference to `.pcibus_to_node'
> make: *** [.tmp_vmlinux1] Error 1
> 05/16/05-07:36:03 Build the kernel. Failed rc = 2
> 05/16/05-07:36:03 build: kernel build Failed rc = 1
There was a prior discussion with the ppc64 folks about the way that 
asm-generic/topology.h was included only for CONFIG_NUMA. I thought that 
was fixed?
asm-generic/topology.h must also be included if CONFIG_NUMA is not set 
inorder to provide the fall back pcibus_to_node function.
patch follows. Cannot test since I do not have a ppc64.
Index: linux-2.6.12-rc4/include/asm-ppc64/topology.h
===================================================================
--- linux-2.6.12-rc4.orig/include/asm-ppc64/topology.h	2005-03-01 23:38:32.000000000 -0800
+++ linux-2.6.12-rc4/include/asm-ppc64/topology.h	2005-05-16 16:06:24.000000000 -0700
@@ -59,10 +59,8 @@
 	.nr_balance_failed	= 0,			\
 }
 
-#else /* !CONFIG_NUMA */
+#endif /* CONFIG_NUMA */
 
 #include <asm-generic/topology.h>
 
-#endif /* CONFIG_NUMA */
-
 #endif /* _ASM_PPC64_TOPOLOGY_H */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/