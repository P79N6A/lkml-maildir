Date: Mon, 25 Feb 2008 18:01:13 -0300
From: Henrique de Moraes Holschuh <>
Subject: Re: 2.6.25-rc2 Regression Thinkpad acpi
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/25/336

On Mon, 25 Feb 2008, Lukas Hejtmanek wrote:
> On Mon, Feb 25, 2008 at 05:03:54PM -0300, Henrique de Moraes Holschuh wrote:
> > This commit is indeed broken, and I have a tentative fix for it.  But I'd
> > like to have a better description of just "how" the thinkpad keys do not
> > work anymore, to make sure I fix the entire breakage in one go.  I will
> > stare at the code and the fix a bit more before sending in any patches,
> > though.
> 
> Well, keys generate ACPI interrupt but acpid never receives any event.
Not even over the new netlink socket?  Or the thinkpad-acpi input device?
Please send me the debug output of thinkpad-acpi loading, just in case.
> I would be happy to test fixes to see whether things go well.
Sure, try this one:
diff --git a/drivers/misc/thinkpad_acpi.c b/drivers/misc/thinkpad_acpi.c
index 7500c44..0f74351 100644
--- a/drivers/misc/thinkpad_acpi.c
+++ b/drivers/misc/thinkpad_acpi.c
@@ -1078,7 +1078,8 @@ static int hotkey_get_tablet_mode(int *status)
 	if (!acpi_evalf(hkey_handle, &s, "MHKG", "d"))
 		return -EIO;
 
-	return ((s & TP_HOTKEY_TABLET_MASK) != 0);
+	*status = ((s & TP_HOTKEY_TABLET_MASK) != 0);
+	return 0;
 }
 
 /*
-- 
  "One disk to rule them all, One disk to find them. One disk to bring
  them all and in the darkness grind them. In the Land of Redmond
  where the shadows lie." -- The Silicon Valley Tarot
  Henrique Holschuh