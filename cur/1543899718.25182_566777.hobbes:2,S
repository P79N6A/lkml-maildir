Date: Mon, 9 Jul 2007 13:53:24 -0500 (CDT)
From: (Bob Tracy)
Subject: Re: 2.6.22-rc6 bad page error
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/9/345

Hugh Dickins wrote:
> (...) I'm expecting this to be a regression we introduced in
> 2.6.15, rather than recently in 2.6.22 (now, that's better isn't it ;-?)
> (...)
> I think sound/isa/es18xx.c's
> 	snd_pcm_lib_preallocate_pages_for_all(pcm, SNDRV_DMA_TYPE_DEV,
> will take it to sound/core/memalloc.c's
> 	res = dma_alloc_coherent(dev, PAGE_SIZE << pg, dma, gfp_flags);
> where we've carefully included __GFP_COMP in gfp_flags to avoid this
> kind of problem (replacing the pre-2.6.15 use of PageReserved).
> (...)
> Blame me or Nick for removing the
> special PageReserved usage, or Alpha for ignoring our gfp_flags:
> 
>   #define dma_alloc_coherent(dev, size, addr, gfp)	\
> 		pci_alloc_consistent(alpha_gendev_to_pci(dev), size, addr)
> 
> When you get a chance, please would you try patch below?
> 
> --- 2.6.22-rc7/arch/alpha/kernel/pci_iommu.c	2007-06-05 06:19:19.000000000 +0100
> +++ linux/arch/alpha/kernel/pci_iommu.c	2007-07-07 15:00:04.000000000 +0100
That seems to have done the trick.  Normally, I get the "bad page"
errors on the second NX session, but I'm on the third session of the
day (thus far), and everything seems to be ok as far as I can tell.
-- 
-----------------------------------------------------------------------
Bob Tracy               | "Eagles may soar, but weasels don't get
rct@frus.com            |  sucked into jet engines."       --Anon
-----------------------------------------------------------------------
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/