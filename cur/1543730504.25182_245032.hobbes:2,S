Date: Tue, 24 Aug 2004 14:36:42 -0700
From: Brannon Klopfer <>
Subject: Unpluging PC Card while apm -s'd
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/8/24/257

Linux littleblue 2.6.8.1 #81 Wed Aug 18 17:13:39 PDT 2004 i686 unknown 
unknown GNU/Linux
Gnu C                  3.3.4
Gnu make               3.80
binutils               2.15.90.0.3
util-linux             2.12a
mount                  2.12a
module-init-tools      3.0
e2fsprogs              1.35
jfsutils               1.1.6
xfsprogs               2.6.13
pcmcia-cs              3.2.7
quota-tools            3.12.
PPP                    2.4.2
nfs-utils              1.0.6
Linux C Library        2.3.2
Dynamic linker (ldd)   2.3.2
Linux C++ Library      5.0.6
Procps                 3.2.1
Net-tools              1.60
Kbd                    1.12
Sh-utils               5.2.1
Modules Loaded         snd_cs4236 snd_opl3_lib snd_hwdep snd_cs4236_lib 
snd_mpu401_uart snd_rawmidi snd_cs4231_lib nfsd exportfs intel_agp 
uhci_hcd serial_cs 3c574_cs ds yenta_socket pcmcia_core agpgart
-----------------------------
Hello,
    I have a Realtek-based 32-bit PC card (uses 8139too). It works 
flawlessly under normal circumstances - very fast, can unplug, etc. 
while the machine is hot. However, if I unplug when the machine is 
suspended (apm -s), upon resume, the machine locks up - capslock works, 
but that's about it. Since this card has a built-in connector (i.e., 
it's bigger than a normal PCMCIA card), I can see wanting to put it to 
sleep, then remembering that I ought to take out the card (which I _can_ 
do, so long as I plug it back in before it wakes up). A bit annoying. 
Oh, I have tried, before suspending, modprobe -r'ing the proper module 
(8139too), same thing (grrr...).
For what it's worth, this card is _not_ recognized at all by cardmgr - I 
plug it in, and then it shows up via "lspci". "cat /var/lib/pcmcia/stab" 
returns both slots as empty. I'll send my kernel config if you want. I 
assume I don't need any PCI hotplug support in the kernel, as everything 
works fine unless I suspend, remove, wake up (eve though the PCMCIA card 
shows up as a PCI device). My PCMCIA slots work fine, as I have another 
"true" PCMCIA card.
I'm sure this must be a little confusing to the poor kernel - going to 
sleep and awaking only to find your NIC is missing. Traumatic.
-Brannon Klopfer
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/