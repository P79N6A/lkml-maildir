Date: 10 Jul 1999 11:52:14 +0000
From: Graham Murray <>
Subject: TCP connection failure in 2.3.x
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/7/10/21

When running recent 2.3.x kernels (certainly 2.3.8 - 2.3.10) I am
seeing a problem with the initial incoming SMTP connections from my
ISP if the link is already busy when these connections arrive. I did
not see the problem in kernels 2.0.x or 2.2.x (I have tried 2.2.10,
and do not see the problem.)
I am running pppd 2.3.8 and the ppp drivers supplied in the kernel
tree (ie I have not installed the kernel driver supplied with ppp
2.3.8). The computer is "standalone" and the only networking is
dial-up ppp over a 56k modem link.
The sequence of events which consistently shows this problem is to
bring up the ppp link using diald by initiating five parallel calls to
nntpget to download news. The ISP attempts to initiate SMTP
connections from 2 mailers about 30s after the link is established. By
this time, the link is busy passing data from the nntp servers. The
tcpdump output shows that the initial SYN packets are ACKd very
quickly, then after about 500ms, the SYN ACK is resent multiple times
in very quick sucession. About 4.5s later the ISP sends an ACK in
response to my SYN ACK packets (thus completing the 3-way handshake),
but instead of continuing the connection, my system Resets it. 
[output of tcpdump]
07:04:29.241264 158.152.23.247.1026 > 158.152.254.76.nntp: . ack 7931 win 30660 (DF) (ttl 64, id 1238)
07:04:29.241085 193.112.150.21.nntp > 158.152.23.247.1027: . ack 219 win 8542 (DF) (ttl 122, id 5376)
07:04:29.601164 158.152.254.79.nntp > 158.152.23.247.1030: . 1608:3068(1460) ack 447 win 8760 (DF) (ttl 251, id 40929)
07:04:29.601354 158.152.23.247.1030 > 158.152.254.79.nntp: . ack 3109 win 30660 (DF) (ttl 64, id 1239)
07:04:29.611047 194.217.242.34.42404 > 158.152.23.247.smtp: S 3932677649:3932677649(0) win 8760 <mss 1460> (DF) (ttl 252, id 19101)
07:04:29.611377 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1240)
07:04:29.611103 194.217.242.6.49825 > 158.152.23.247.smtp: S 671321486:671321486(0) win 8760 <mss 1460> (DF) (ttl 251, id 16699)
07:04:29.611644 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1241)
07:04:29.697322 158.152.23.247.1024 > 158.152.1.43.domain: 25136+ (45) (ttl 64, id 1243)
07:04:29.871090 158.152.254.77.nntp > 158.152.23.247.1028: . 1600:3060(1460) ack 497 win 64240 (DF) (ttl 251, id 38686)
07:04:29.871283 158.152.23.247.1028 > 158.152.254.77.nntp: . ack 4460 win 32120 (DF) (ttl 64, id 1244)
07:04:30.111057 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1245)
07:04:30.111255 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1246)
07:04:30.111335 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1247)
07:04:30.111415 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1248)
07:04:30.111554 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1249)
07:04:30.111649 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1250)
07:04:30.111734 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1251)
07:04:30.111815 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1252)
07:04:30.111936 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1253)
07:04:30.112015 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1254)
07:04:30.112094 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1255)
07:04:30.112172 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1256)
07:04:30.112253 158.152.23.247.smtp > 194.217.242.34.42404: S 3611596100:3611596100(0) ack 3932677650 win 30660 <mss 1460> (DF) (ttl 64, id 1257)
07:04:30.112333 158.152.23.247.smtp > 194.217.242.6.49825: S 3620653786:3620653786(0) ack 671321487 win 30660 <mss 1460> (DF) (ttl 64, id 1258)
07:04:30.151084 158.152.254.78.nntp > 158.152.23.247.1029: . 3080:4540(1460) ack 495 win 8760 (DF) (ttl 251, id 52124)
07:04:30.151279 158.152.23.247.1029 > 158.152.254.78.nntp: . ack 7421 win 30660 (DF) (ttl 64, id 1259)
07:04:30.351024 158.152.254.76.nntp > 158.152.23.247.1026: . 3616:5076(1460) ack 385 win 8760 (DF) (ttl 251, id 22376)
07:04:30.351201 158.152.23.247.1026 > 158.152.254.76.nntp: . ack 7931 win 30660 (DF) (ttl 64, id 1260)
07:04:30.461023 193.112.150.21.nntp > 158.152.23.247.1027: P 2870:3607(737) ack 219 win 8542 (DF) (ttl 122, id 12288)
07:04:30.461196 158.152.23.247.1027 > 193.112.150.21.nntp: . ack 3607 win 32120 (DF) (ttl 64, id 1261)
07:04:30.691004 158.152.254.79.nntp > 158.152.23.247.1030: . 1608:3068(1460) ack 447 win 8760 (DF) (ttl 251, id 40930)
07:04:30.691185 158.152.23.247.1030 > 158.152.254.79.nntp: . ack 3109 win 30660 (DF) (ttl 64, id 1262)
07:04:30.931104 158.152.254.79.nntp > 158.152.23.247.1030: . 3109:4564(1455) ack 447 win 8760 (DF) (ttl 251, id 40931)
07:04:31.141118 158.152.254.65.nntp > 158.152.23.247.1031: . 3083:4530(1447) ack 239 win 8760 (DF) (ttl 251, id 24472)
07:04:31.331092 158.152.254.79.nntp > 158.152.23.247.1030: . 4564:6017(1453) ack 447 win 8760 (DF) (ttl 251, id 40932)
07:04:31.431030 158.152.23.247.1030 > 158.152.254.79.nntp: . ack 6017 win 32120 (DF) (ttl 64, id 1263)
07:04:31.541068 158.152.254.65.nntp > 158.152.23.247.1031: . 4530:5978(1448) ack 239 win 8760 (DF) (ttl 251, id 24473)
07:04:31.641030 158.152.23.247.1031 > 158.152.254.65.nntp: . ack 5978 win 32120 (DF) (ttl 64, id 1264)
07:04:31.811041 158.152.254.65.nntp > 158.152.23.247.1031: . 5978:7417(1439) ack 239 win 8760 (DF) (ttl 251, id 24474)
07:04:31.811069 193.112.150.21.nntp > 158.152.23.247.1027: . ack 219 win 8542 (DF) (ttl 122, id 14336)
07:04:32.091039 158.152.254.79.nntp > 158.152.23.247.1030: . 3109:4569(1460) ack 447 win 8760 (DF) (ttl 251, id 40933)
07:04:32.091213 158.152.23.247.1030 > 158.152.254.79.nntp: . ack 6017 win 32120 (DF) (ttl 64, id 1265)
07:04:32.311027 158.152.23.247.1031 > 158.152.254.65.nntp: . ack 7417 win 32120 (DF) (ttl 64, id 1266)
07:04:32.371054 158.152.254.76.nntp > 158.152.23.247.1026: . 3616:5076(1460) ack 385 win 8760 (DF) (ttl 251, id 22377)
07:04:32.371233 158.152.23.247.1026 > 158.152.254.76.nntp: . ack 7931 win 30660 (DF) (ttl 64, id 1267)
07:04:32.561061 158.152.254.65.nntp > 158.152.23.247.1031: . 3083:4543(1460) ack 239 win 8760 (DF) (ttl 251, id 24475)
07:04:32.561278 158.152.23.247.1031 > 158.152.254.65.nntp: . ack 7417 win 32120 (DF) (ttl 64, id 1268)
07:04:32.571054 193.112.150.21.nntp > 158.152.23.247.1027: P 3607:3687(80) ack 256 win 8505 (DF) (ttl 122, id 14592)
07:04:32.591016 158.152.23.247.1027 > 193.112.150.21.nntp: . ack 3687 win 32120 (DF) (ttl 64, id 1269)
07:04:32.661020 193.112.150.21.nntp > 158.152.23.247.1027: P 3687:4275(588) ack 256 win 8505 (DF) (ttl 122, id 14848)
07:04:32.661047 193.112.150.21.nntp > 158.152.23.247.1027: P 4275:4277(2) ack 256 win 8505 (DF) (ttl 122, id 15104)
07:04:32.681039 158.152.23.247.1027 > 193.112.150.21.nntp: . ack 4277 win 32120 (DF) (ttl 64, id 1270)
07:04:32.691068 193.112.150.21.nntp > 158.152.23.247.1027: P 4277:4498(221) ack 256 win 8505 (DF) (ttl 122, id 15360)
07:04:32.695741 158.152.23.247.1027 > 193.112.150.21.nntp: P 256:296(40) ack 4498 win 32120 (DF) (ttl 64, id 1271)
07:04:33.061077 158.152.254.77.nntp > 158.152.23.247.1028: . 1600:3060(1460) ack 497 win 64240 (DF) (ttl 251, id 38687)
07:04:33.061268 158.152.23.247.1028 > 158.152.254.77.nntp: . ack 4460 win 32120 (DF) (ttl 64, id 1272)
07:04:33.331036 158.152.254.76.nntp > 158.152.23.247.1026: . 3616:5076(1460) ack 385 win 8760 (DF) (ttl 251, id 22378)
07:04:33.331212 158.152.23.247.1026 > 158.152.254.76.nntp: . ack 7931 win 30660 (DF) (ttl 64, id 1273)
07:04:33.521063 158.152.254.77.nntp > 158.152.23.247.1028: . 4460:5879(1419) ack 497 win 64240 (DF) (ttl 251, id 38688)
07:04:33.711025 158.152.254.77.nntp > 158.152.23.247.1028: . 5879:7335(1456) ack 497 win 64240 (DF) (ttl 251, id 38689)
07:04:33.991041 158.152.254.78.nntp > 158.152.23.247.1029: . 7421:8867(1446) ack 495 win 8760 (DF) (ttl 251, id 52126)
07:04:34.021027 158.152.23.247.1028 > 158.152.254.77.nntp: . ack 7335 win 32120 (DF) (ttl 64, id 1274)
07:04:34.201083 158.152.254.78.nntp > 158.152.23.247.1029: . 8867:10320(1453) ack 495 win 8760 (DF) (ttl 251, id 52127)
07:04:34.201142 158.152.254.78.nntp > 158.152.23.247.1029: P 10320:10361(41) ack 495 win 8760 (DF) (ttl 251, id 52128)
07:04:34.201396 158.152.23.247.1029 > 158.152.254.78.nntp: . ack 10361 win 30660 (DF) (ttl 64, id 1275)
07:04:34.214413 158.152.23.247.1029 > 158.152.254.78.nntp: P 495:534(39) ack 10361 win 32120 (DF) (ttl 64, id 1276)
07:04:34.461083 158.152.254.76.nntp > 158.152.23.247.1026: . 7931:9357(1426) ack 385 win 8760 (DF) (ttl 251, id 22379)
07:04:34.531109 158.152.254.76.nntp > 158.152.23.247.1026: P 9357:10073(716) ack 385 win 8760 (DF) (ttl 251, id 22380)
07:04:34.541054 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19102)
07:04:34.541276 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1277)
07:04:34.541119 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16700)
07:04:34.541549 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1278)
07:04:34.551022 158.152.23.247.1026 > 158.152.254.76.nntp: . ack 10073 win 30660 (DF) (ttl 64, id 1279)
07:04:34.864052 158.152.23.247.1026 > 158.152.254.76.nntp: P 385:424(39) ack 10073 win 32120 (DF) (ttl 64, id 1281)
07:04:34.871045 158.152.254.79.nntp > 158.152.23.247.1030: . 3109:4569(1460) ack 447 win 8760 (DF) (ttl 251, id 40934)
07:04:34.871340 158.152.23.247.1030 > 158.152.254.79.nntp: . ack 6017 win 32120 (DF) (ttl 64, id 1282)
07:04:34.891045 158.152.1.43.domain > 158.152.23.247.1024: 25136 q: 34.242.217.194.in-addr.arpa 1/3/3  (218) (ttl 61, id 53544)
07:04:34.915849 158.152.23.247.1024 > 158.152.1.43.domain: 60941+ (44) (ttl 64, id 1285)
07:04:35.131055 158.152.254.77.nntp > 158.152.23.247.1028: . 4460:5920(1460) ack 497 win 64240 (DF) (ttl 251, id 38690)
07:04:35.131269 158.152.23.247.1028 > 158.152.254.77.nntp: . ack 7335 win 32120 (DF) (ttl 64, id 1286)
07:04:35.401071 158.152.254.78.nntp > 158.152.23.247.1029: P 7421:8881(1460) ack 495 win 8760 (DF) (ttl 251, id 52129)
07:04:35.401308 158.152.23.247.1029 > 158.152.254.78.nntp: . ack 10361 win 32120 (DF) (ttl 64, id 1287)
07:04:35.411018 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19103)
07:04:35.411272 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1288)
07:04:35.411072 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19104)
07:04:35.411487 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1289)
07:04:35.411121 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16701)
07:04:35.411640 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1290)
07:04:35.421114 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16702)
07:04:35.421297 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1291)
07:04:35.431030 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19105)
07:04:35.431179 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1292)
07:04:35.451081 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19106)
07:04:35.451246 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1293)
07:04:35.461010 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16703)
07:04:35.461136 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1294)
07:04:35.521011 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16704)
07:04:35.521145 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1295)
07:04:35.891060 158.152.254.65.nntp > 158.152.23.247.1031: . 3083:4543(1460) ack 239 win 8760 (DF) (ttl 251, id 24476)
07:04:35.891284 158.152.23.247.1031 > 158.152.254.65.nntp: . ack 7417 win 32120 (DF) (ttl 64, id 1296)
07:04:35.901021 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19107)
07:04:35.901262 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1297)
07:04:35.901075 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19108)
07:04:35.901461 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1298)
07:04:35.901124 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16705)
07:04:35.901610 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1299)
07:04:35.921077 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16706)
07:04:35.921274 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1300)
07:04:35.921127 194.217.242.34.42404 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 252, id 19109)
07:04:35.921478 158.152.23.247.smtp > 194.217.242.34.42404: R 3611596101:3611596101(0) win 0 (ttl 255, id 1301)
07:04:35.991026 194.217.242.6.49825 > 158.152.23.247.smtp: . ack 1 win 8760 (DF) (ttl 251, id 16707)
07:04:35.991161 158.152.23.247.smtp > 194.217.242.6.49825: R 3620653787:3620653787(0) win 0 (ttl 255, id 1302)
[After this there is no further activity on port 25]
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/