Date: Mon, 01 Oct 2007 12:37:14 -0400
From: Mark Lord <>
Subject: Re: 32-bit Athlon X2 won't poweroff
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/1/229

Santiago Garcia Mantinan wrote:
>> So for this to work, I believe that either ACPI or APM has to have been
>> configured into the kernel (and the modules loaded).  Your kernel .config
>> from earlier shows ACPI built-in to the kernel core, so it should be 
>> present.
> 
> Yes, and it is indeed, the acpid is running and it detects my power button
> and starts the poweroff when I hit it.
> 
>> Unless you booted with noacpi or some such parameter..
>> So let's have a look at the kernel boot logs,
> 
> I believe this is normal, I have done a grep -i acpi on the dmesg, here is
> the result, if you want the full dmesg tell me:
..
> ACPI: Interpreter enabled
> ACPI: Using IOAPIC for interrupt routing
..
The output is missing a line like this, which should have been between the two above:
   ACPI: (supports S0 S3 S4 S5)
The ACPI power-off function only gets bound into pm_power_off()
when that line shows S5 on it.
The only way that line can be missing, is if something disabled ACPI
after boot.
This patch (below) should find the culprit for you:
---
--- old/include/asm-i386/acpi.h	2007-09-28 18:09:14.000000000 -0400
+++ linux/include/asm-i386/acpi.h	2007-10-01 12:35:23.000000000 -0400
@@ -97,6 +97,7 @@
 extern int acpi_pci_disabled;
 static inline void disable_acpi(void)
 {
+	WARN_ON(1);
 	acpi_disabled = 1;
 	acpi_ht = 0;
 	acpi_pci_disabled = 1;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/