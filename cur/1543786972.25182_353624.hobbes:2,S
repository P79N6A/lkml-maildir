Date: Tue, 27 Sep 2005 01:31:20 +0200
From: Stefan Smietanowski <>
Subject: Re: [PATCH] x86-64: Fix bad assumption that dualcore cpus have	synced TSCs (resend)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/26/261

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
john stultz wrote:
> On Tue, 2005-09-27 at 00:15 +0200, Stefan Smietanowski wrote:
> 
> 
>>Wouldn't it be a good idea to change the comment following
>>the code you removed as well?
>>
>>Why have a comment saying "multi socket systems" if there is no
>>distinction anymore?
>>
> Yea, good point, that should probably be "SMP systems". 
> 
> Do you want to send the patch to Andrew? :)
Sure. Something like this should suffice.
Signed-off-by: Stefan Smietanowski <stesmi@stesmi.com>
diff --git old/arch/x86_64/kernel/time.c new/arch/x86_64/kernel/time.c
- --- old/arch/x86_64/kernel/time.c
+++ new/arch/x86_64/kernel/time.c
@@ -959,11 +959,8 @@ static __init int unsynchronized_tsc(voi
  	   are handled in the OEM check above. */
  	if (boot_cpu_data.x86_vendor == X86_VENDOR_INTEL)
  		return 0;
- - 	/* All in a single socket - should be synchronized */
- - 	if (cpus_weight(cpu_core_map[0]) == num_online_cpus())
- - 		return 0;
 #endif
- - 	/* Assume multi socket systems are not synchronized */
+ 	/* Assume SMP systems are not synchronized */
  	return num_online_cpus() > 1;
 }
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (MingW32)
iD8DBQFDOITIBrn2kJu9P78RAopLAJ0anLvWElwgW+vmxJ7jPWehWF0F3gCfUXv8
2ORxa8Jfj9o4LE3P0A+dSTE=
=AGkR
-----END PGP SIGNATURE-----
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/