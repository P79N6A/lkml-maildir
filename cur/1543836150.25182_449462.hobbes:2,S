Date: Wed, 2 Aug 2006 19:36:40 +0200
From: Daniel Ritz <>
Subject: [PATCH] PCI: use PCI_BIOS as last fallback
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/8/2/171

[PATCH] PCI: use PCI_BIOS as last fallback
there was a change in 2.6.17 which affected the order in which the PCI access
methods are probed. this gives regressions on some machines with broken BIOS.
the problem is that PCI_BIOS sometimes reports the last bus wrong, leaving cardbus
non-funcational. previously those system worked fine with direct access.
fix it by chaning the order of the probing, having PCI_BIOS as the last fallback.
Signed-off-by: Daniel Ritz <daniel.ritz@gmx.ch>
diff --git a/arch/i386/pci/init.c b/arch/i386/pci/init.c
index c7650a7..caeefd4 100644
--- a/arch/i386/pci/init.c
+++ b/arch/i386/pci/init.c
@@ -11,13 +11,13 @@ #ifdef CONFIG_PCI_MMCONFIG
 #endif
 	if (raw_pci_ops)
 		return 0;
-#ifdef CONFIG_PCI_BIOS
-	pci_pcbios_init();
-#endif
-	if (raw_pci_ops)
-		return 0;
 #ifdef CONFIG_PCI_DIRECT
 	pci_direct_init();
+	if (raw_pci_ops)
+		return 0;
+#endif
+#ifdef CONFIG_PCI_BIOS
+	pci_pcbios_init();
 #endif
 	return 0;
 }
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/