Date: Tue, 26 Feb 2008 13:17:55 -0800 (PST)
From: David Rientjes <>
Subject: Re: [patch 5/6] mempolicy: add MPOL_F_RELATIVE_NODES flag
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/26/387

On Tue, 26 Feb 2008, Paul Jackson wrote:
> Perhaps I missed it, but could you elaborate on what sort of testing
> these patches for MPOL_F_RELATIVE_NODES and MPOL_F_STATIC_NODES have
> received?
> 
Both MPOL_F_STATIC_NODES and MPOL_F_RELATIVE_NODES only really change the 
implementation when a new mempolicy is created and on rebind.
So it's possible to test both of these areas by booting with numa=fake=8, 
setting up a cpuset, hacking numactl to allow |static or |relative options 
to be passed, changing the cpuset's mems, and checking the result.  Then 
you can repeat that process with a different set of initial cpuset mems 
and a different syscall nodemask.
	# mount -t cpuset none /dev/cpuset
	# mkdir /dev/cpuset/test
	# cd /dev/cpuset/test
	# echo 0-3 > cpus
	# echo 1-3 > mems
	# echo $$ > tasks
	# numactl --interleave|static=2-4 bash
	# numactl --show
	[should be interleave over 2-3]
	# echo 4-6 > mems
	[should be "interleave" over 4]
	# numactl --show
> In particular, do we know that Oracle works with this?  At least in
> years past, when Andi was the primary developer here, he had some
> good and detailed awareness of what it took to keep Oracle happy
> with this NUMA memory policy apparatus.  I don't know if we still
> have that awareness.
> 
I don't understand what Oracle has to do with anything here, it is up to 
the programmer to determine whether he wants to use MPOL_F_STATIC_NODES or 
MPOL_F_RELATIVE_NODES for the benefit of his or her application.  There's 
now a method for doing that, specifically with optional mempolicy mode 
flags.
If you have any examples of unexpected behavior after applying my 
patchset, please post it and I'll fix it rather quickly.
		David