Date: Sat, 22 Oct 2005 21:59:23 +0200
From: Vladimir Lazarenko <>
Subject: Re: sata_nv + SMP = broken?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/10/22/87

>>>>>Yesterday I've tried launching various kernels on Ahtlon64 Dual-core 
>>>>>X2 3800+ with MSI Neo4 Platinum SLI motherboard.
>>>>>
>>>>>The results were a total catastrophica failure. As soon as I enable 
>>>>>SMP in the kernel, the sata driver would randomly hang after a bit of 
>>>>>disk activity.
>>>>>
>>>>>Whenever apic is enabled, the system won't even be able to boot up 
>>>>>completely, and will hang VERY soon. Whenever I disable apic, the 
>>>>>system is able to bootup, but when the software mirror that I use will 
>>>>>try to resync for 2-3-10 mins, it will throw up a message and freeze 
>>>>>again.
>>>>>
>>>>>Whenever I disable apic AND lapic, the system is able to bootup AND 
>>>>>work, however after same 5-10 minutes it start spitting messages, 
>>>>>which are somewhat different thou and don't hang the system completely 
>>>>>but render it rather unusable anyway.
>>>>>
>>>>>As soon as I disable SMP - everything works like a charm.
>>>>>
>>>>
>>>>I too am running an Athlon X2 using sata_nv. I have an ASUS motherboard. 
>>>>But what I noticed was that the problem went away if I used 2 gigs of 
>>>>ram instead of 4 gigs. When you use the whole 4 gigs there is some 
>>>>memory mapping going on and I thought perhaps the problem was related to 
>>>>the sata_nv not liking the memory mapped over the 4gig barrier.
>>>
>>>That's possible.  Unfortunately I cannot verify this, since there are 2GB of
>>>RAM in my box.
>>>
>>>I remeber someone having a problem with sata_nv DMAing over 2GB of RAM,
>>>so there may be something wrong with it.
>>
>>On a second thought. Why would that only occur in SMP mode? Since now 
>>the box is with 3G ram, no SMP and it works like a charm. If I enable 
>>SMP - the hell breaks loose.
> 
> 
> It looks like an obscure issue.  Apparently, to trigger it you need _both_
> more that 2GB of RAM and SMP.
Looks like it. I played around today as well, and it seems to not to 
occur with 2Gb.
> OTOH, today I played with Tyan Thunder K8WE, based on the Nvidia
> CK8-04 chipset (not that much different to the regular Nforce4) in
> a 2-processor configuration and 8GB of RAM, and it had no issues at all
> (I installed SuSE 9.3 with the distro kernel on it).  Anyway its SATA
> controller is handled by the sata_nv driver, so the problem you describe
> does not seem to be software-related.
Hehe, as if reading your mind I ordered Tyan K8E today, and in case that 
won't work, i'll just put a pci raiser there and stuck an external SATA 
from silicon image or promise there :)
I've heard from another person (thou have not seen it myself) that there 
was kind of the same problem (hanging sata) on an opteron-based machine. 
I was too late to ask the mb model thou, so this info is kind of 
useless, but just for statistical purposes I mention it here.
> [Jeff, could you please say if this is a known problem?]
[unhandled content-type:application/x-pkcs7-signature]