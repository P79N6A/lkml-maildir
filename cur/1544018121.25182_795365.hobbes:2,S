Date: Wed, 21 Jan 2009 11:56:31 +0100
From: Ingo Molnar <>
Subject: Re: [PATCH] workqueue: not allow recursion run_workqueue
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/21/122

* Lai Jiangshan <laijs@cn.fujitsu.com> wrote:
> 1) lockdep will complain when recursion run_workqueue
> 2) works is not run orderly when recursion run_workqueue
> 
> 3) BUG!
>    We use recursion run_workqueue to hidden deadlock when
>    keventd trying to flush its own queue.
> 
>    It's bug. When flush_workqueue()(nested in a work callback)returns,
>    the workqueue is not really flushed, the sequence statement of
>    this work callback will do some thing bad.
> 
>    So we should not allow workqueue trying to flush its own queue.
That's a nice change. I'm wondering what the existing users are though and 
how difficult they are to fix.
	Ingo