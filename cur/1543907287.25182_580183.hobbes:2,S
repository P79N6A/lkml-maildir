Date: Tue, 7 Aug 2007 09:41:02 +0200
From: "Kay Sievers" <>
Subject: Re: [PATCH/RFC] allow mapping from block-device-file to sysfs entry.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/7/57

On 8/7/07, Neil Brown <neilb@suse.de> wrote:
> On Monday August 6, arjan@infradead.org wrote:
> > On Tue, 2007-08-07 at 16:07 +1000, Neil Brown wrote:
> > > Suppose that in a program I have an open file descriptor for a device,
> > > and I want to find the /sys/block information for this device.
> > > There is currently no direct way to do this.  I need to read
> > >    /sys/block/*/dev, /sys/block/*/*/dev
> > > and match major/minor numbers with the result from fstat.
> > >
> > > I would like a more direct mechanism.
  $ udevinfo --query=path --name=sda
  /block/sda
> > > The following patch is a proposal for such a mechanism.
> > >
> > > It provides an 'ioctl' which returns then 'name' of the device, as
> > > generated by bdevname.  This is the same name that is used to create
> > > entries in sysfs.
> > > For a partition of a device, it returns 'device/partition'.
> >
> >
> > how about returning the entire path relative to the start of sysfs? That
> > way, if things move or something you're tolerant against that....
>
> That makes a lot of sense.
> So it would return "block/sda/sda1" now,
Every devpath always starts with a '/' in the kernel, its kind of
weird, but we should not introduce a new variation of it. :)
> but one day that might change
> to "class/block/sda/sda1" or some-such.
It will start with /devices/..., like:
  /sys/devices/pci0000:00/0000:00:1f.2/host0/target0:0:0/0:0:0:0/sda/sda1
> > (I'd not be against making this a generic IOCTL for every device, a
> > SYSFSLOCATION kind of ioctl... it's by no means block specific...)
> >
>
> That too seems very sensible.  Only it's harder to choose a 'generic'
> ioctl request number than to choose a block-specific one :-)
>
> We would also need a somewhat longer buffer.  The longest
> /sys/**/dev
> path on my test machine is
> /sys/devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1:1.1/usb_endpoint/usbdev2.2_ep82/dev
>
> So at least 80 chars.  Probably 256 would do....
They can be definitely longer than than 256, probably not longer than
512 today, but you can't be sure about that.
Thanks,
Kay
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/