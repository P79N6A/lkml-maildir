Date: Wed, 16 Apr 2003 11:33:02 +0200
From: Stephan von Krawczynski <>
Subject: Re: PROBLEM: Kernel 2.4.20 crashes when a second isdn channel is opened by ibod
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/4/16/40

This bug is known and fixed by Patrick McHardy <kaber@trash.net>.
Please use patch attached and confirm it works. Thank you.
See Changelog
On Wed, 16 Apr 2003 10:54:05 +0200
Arno Wilhelm <a.wilhelm@phion.com> wrote:
> Hello,
> 
> I guess we have detected a kernel bug in the isdn subsystem ( isdn_ppp.c ).
> I have enclosed the bug report in this mail in the format that is asked by
> the file "REPORTING-BUGS" in the kernel source directory.
> If you need further assistance please mail to: a.wilhelm@phion.com
> 
> 
> 
> Regards,
> 
> 			Arno Wilhelm
-- 
Regards,
Stephan
diff -Nru a/drivers/isdn/isdn_net.c b/drivers/isdn/isdn_net.c
--- a/drivers/isdn/isdn_net.c   Thu Mar 27 02:00:21 2003
+++ b/drivers/isdn/isdn_net.c   Thu Mar 27 02:00:21 2003
@@ -2831,6 +2831,7 @@
 
                        /* If binding is exclusive, try to grab the channel */
                        save_flags(flags);
+                       cli();
                        if ((i = isdn_get_free_channel(ISDN_USAGE_NET,
                                lp->l2_proto, lp->l3_proto, drvidx,
                                chidx, lp->msn)) < 0) {
diff -Nru a/drivers/isdn/isdn_ppp.c b/drivers/isdn/isdn_ppp.c
--- a/drivers/isdn/isdn_ppp.c   Thu Mar 27 02:00:21 2003
+++ b/drivers/isdn/isdn_ppp.c   Thu Mar 27 02:00:21 2003
@@ -1176,7 +1176,7 @@
        if (!lp) {
                printk(KERN_WARNING "%s: all channels busy - requeuing!\n", netdev->name);
                retval = 1;
-               goto unlock;
+               goto out;
        }
        /* we have our lp locked from now on */
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/