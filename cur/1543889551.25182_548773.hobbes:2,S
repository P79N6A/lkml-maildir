Date: Thu, 24 May 2007 19:57:10 +0200
From: Adrian Bunk <>
Subject: Re: Status of CONFIG_FORCED_INLINING?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/24/259

On Thu, May 24, 2007 at 10:14:41AM -0700, Roland Dreier wrote:
>  > A function only belongs into a header file if we always want it inlined, 
>  > otherwise it belongs into a C file.
> 
> Again, why?  Why don't we trust the compiler to decide if a function
> should be inlined or not, even if the definition happens to be in a .h
> file?
> 
> It seems like a perfectly valid optimization for the compiler to only
> emit code once for a function and then call it where it is used, even
> if that function happens to be defined in a .h file.
The compiler will always inline it when it's called once from a C file, 
and it might not inline it there when it's called more than once from 
another C file. So in the end, we have it not only out-of-line but also 
inlined in several places.
Functions in header files should either be extremely short so that 
inlining them makes sense, or always optimize to something extremely 
short after being inlined.
If it's an optimization to emit the code only once, then it's a bug that 
it's in a header file.
>  - R.
cu
Adrian
-- 
       "Is there not promise of rain?" Ling Tan asked suddenly out
        of the darkness. There had been need of rain for many days.
       "Only a promise," Lao Er said.
                                       Pearl S. Buck - Dragon Seed
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/