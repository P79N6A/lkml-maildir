Date: Fri, 21 Dec 2007 10:15:08 +0530
From: Dhaval Giani <>
Subject: Re: 2.6.22-stable causes oomkiller to be invoked
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/20/695

> > It was just
> > 
> > 	while echo ; do cat /sys/kernel/<some file> ; done
> > 
> > it's all in the email threads somewhere..
> 
> The patch that was posted in the thread that I mentioned earlier is here. 
> I ran the test for 15 minutes and things are still fine.
> 
> 
> 
> quicklist: Set tlb->need_flush if pages are remaining in quicklist 0
> 
> This ensures that the quicklists are drained. Otherwise draining may only 
> occur when the processor reaches an idle state.
> 
Hi Christoph,
No, it does not stop the oom I am seeing here.
Thanks,
> Signed-off-by: Christoph Lameter <clameter@sgi.com>
> 
> Index: linux-2.6/include/asm-generic/tlb.h
> ===================================================================
> --- linux-2.6.orig/include/asm-generic/tlb.h	2007-12-13 14:45:38.000000000 -0800
> +++ linux-2.6/include/asm-generic/tlb.h	2007-12-13 14:51:07.000000000 -0800
> @@ -14,6 +14,7 @@
>  #define _ASM_GENERIC__TLB_H
> 
>  #include <linux/swap.h>
> +#include <linux/quicklist.h>
>  #include <asm/pgalloc.h>
>  #include <asm/tlbflush.h>
> 
> @@ -85,6 +86,9 @@ tlb_flush_mmu(struct mmu_gather *tlb, un
>  static inline void
>  tlb_finish_mmu(struct mmu_gather *tlb, unsigned long start, unsigned long end)
>  {
> +#ifdef CONFIG_QUICKLIST
> +	tlb->need_flush += &__get_cpu_var(quicklist)[0].nr_pages != 0;
> +#endif
>  	tlb_flush_mmu(tlb, start, end);
> 
>  	/* keep the page table cache within bounds */
-- 
regards,
Dhaval