Date: Mon, 12 Jan 2004 16:31:54 +0100
From: Takashi Iwai <>
Subject: Re: ALSA in 2.6 failing to find the OPL chip of the sb cards
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/1/12/105

At Sat, 10 Jan 2004 08:24:51 +0100,
Rene Herman wrote:
> 
> That is, the driver doesn't complain anymore. Still didn't see the OPL 
> appear in /proc/ioports though (loading with fm_port=0x388 doesn't 
> change that). Haven't investigated further yet, will do.
it's a bug.  the attached patch should fix it.
--
Takashi Iwai <tiwai@suse.de>		ALSA Developer - www.alsa-project.org
--- linux/sound/isa/sb/sb16.c	30 Oct 2003 14:19:30 -0000	1.31
+++ linux/sound/isa/sb/sb16.c	12 Jan 2004 15:30:04 -0000
@@ -483,7 +483,7 @@
 	if (fm_port[dev] > 0 && fm_port[dev] != SNDRV_AUTO_PORT) {
 		if (snd_opl3_create(card, fm_port[dev], fm_port[dev] + 2,
 				    OPL3_HW_OPL3,
-				    fm_port[dev] == port[dev] || fm_port[dev] == 0x388,
+				    acard->fm_res != NULL,
 				    &opl3) < 0) {
 			snd_printk(KERN_ERR PFX "no OPL device at 0x%lx-0x%lx\n",
 				   fm_port[dev], fm_port[dev] + 2);