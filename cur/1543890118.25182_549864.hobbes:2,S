Date: Mon, 28 May 2007 10:54:43 +0900
From: Satoru Takeuchi <>
Subject: CPU hotplug: system hang on CPU hot remove during `pfmon --system-wide'
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/27/183

Hi,
I found a bug on CPU hotplug. If `pfmon --system-wide' is running,
CPU hot remove causes system hang. On the other hand, CPU hot add
during that command seems to work fine.
I detected this problem on my ia64 box, and I don't know that this
problem is also occur on any arch or freezer based CPU hotplug.
Since I'm investigating this problem now, I'm glad if someone
reports the test result on other arch or freezer.
Currently I don't know anything about the cause of this problem.
How To Reproduce
================
Assuming you have two terminal, named term A and term B.
1) execute pfmon from term A
$ pfmon --system-wide
<press ENTER to stop session>
2) issue CPU hot remove from term B
# echo 0 >/sys/devices/system/cpu/cpu1/online
3) Press enter from term B
Expected Result
===============
Succeed to offline CPU
Actual Result
=============
System hang occurs and there are the following messages on serial console.
-------------------------------------------------------------------------------
CPU0                       1925600 CPU_CYCLES
CPU1 could not stop monitoring, CPU may be offline, check results
pfm_write_old_pmds error [3] Device or resource busy
pfmon_read_pmds error Device or resource busy
CPU1 read_results error
-------------------------------------------------------------------------------
Thanks,
Satoru
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/