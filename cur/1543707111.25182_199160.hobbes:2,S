Date: Tue, 17 Feb 2004 11:16:45 +1100
From: Benjamin Herrenschmidt <>
Subject: [PATCH] Fix building both old & new radeonfb's
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/16/256

This fix build of "allyesconfig", old and new radeonfb's would
collide on some symbols.
Ben.
===== drivers/video/fbmem.c 1.88 vs edited =====
--- 1.88/drivers/video/fbmem.c	Tue Feb 17 04:58:08 2004
+++ edited/drivers/video/fbmem.c	Tue Feb 17 10:58:14 2004
@@ -138,6 +138,8 @@
 extern int tx3912fb_setup(char*);
 extern int radeonfb_init(void);
 extern int radeonfb_setup(char*);
+extern int radeonfb_old_init(void);
+extern int radeonfb_old_setup(char*);
 extern int e1355fb_init(void);
 extern int e1355fb_setup(char*);
 extern int pvr2fb_init(void);
@@ -226,7 +228,7 @@
 	{ "radeonfb", radeonfb_init, radeonfb_setup },
 #endif
 #ifdef CONFIG_FB_RADEON_OLD
-	{ "radeonfb_old", radeonfb_init, radeonfb_setup },
+	{ "radeonfb_old", radeonfb_old_init, radeonfb_old_setup },
 #endif
 #ifdef CONFIG_FB_CONTROL
 	{ "controlfb", control_init, control_setup },
===== drivers/video/radeonfb.c 1.37 vs edited =====
--- 1.37/drivers/video/radeonfb.c	Fri Feb 13 04:14:53 2004
+++ edited/drivers/video/radeonfb.c	Tue Feb 17 10:57:34 2004
@@ -234,7 +234,7 @@
 /* these common regs are cleared before mode setting so they do not
  * interfere with anything
  */
-reg_val common_regs[] = {
+static reg_val common_regs[] = {
 	{ OVR_CLR, 0 },	
 	{ OVR_WID_LEFT_RIGHT, 0 },
 	{ OVR_WID_TOP_BOTTOM, 0 },
@@ -246,7 +246,7 @@
 	{ CAP0_TRIG_CNTL, 0 },
 };
 
-reg_val common_regs_m6[] = {
+static reg_val common_regs_m6[] = {
 	{ OVR_CLR,      0 },
 	{ OVR_WID_LEFT_RIGHT,   0 },
 	{ OVR_WID_TOP_BOTTOM,   0 },
@@ -3134,19 +3134,19 @@
 };
 
 
-int __init radeonfb_init (void)
+int __init radeonfb_old_init (void)
 {
 	return pci_module_init (&radeonfb_driver);
 }
 
 
-void __exit radeonfb_exit (void)
+void __exit radeonfb_old_exit (void)
 {
 	pci_unregister_driver (&radeonfb_driver);
 }
 
 
-int __init radeonfb_setup (char *options)
+int __init radeonfb_old_setup (char *options)
 {
         char *this_opt;
 
@@ -3174,8 +3174,8 @@
 }
 
 #ifdef MODULE
-module_init(radeonfb_init);
-module_exit(radeonfb_exit);
+module_init(radeonfb_old_init);
+module_exit(radeonfb_old_exit);
 #endif
 
 
===== drivers/video/aty/radeon_base.c 1.7 vs edited =====
--- 1.7/drivers/video/aty/radeon_base.c	Mon Feb 16 14:56:24 2004
+++ edited/drivers/video/aty/radeon_base.c	Tue Feb 17 10:37:53 2004
@@ -212,7 +212,7 @@
 /* these common regs are cleared before mode setting so they do not
  * interfere with anything
  */
-reg_val common_regs[] = {
+static reg_val common_regs[] = {
 	{ OVR_CLR, 0 },	
 	{ OVR_WID_LEFT_RIGHT, 0 },
 	{ OVR_WID_TOP_BOTTOM, 0 },
@@ -224,7 +224,7 @@
 	{ CAP0_TRIG_CNTL, 0 },
 };
 
-reg_val common_regs_m6[] = {
+static reg_val common_regs_m6[] = {
 	{ OVR_CLR,      0 },
 	{ OVR_WID_LEFT_RIGHT,   0 },
 	{ OVR_WID_TOP_BOTTOM,   0 },
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/