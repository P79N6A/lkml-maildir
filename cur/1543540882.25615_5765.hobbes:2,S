Date: Sun, 6 Aug 2000 14:14:47 +0200
From: Frank van Maarseveen <>
Subject: Re: [: Re: 2.4.0-test6-pre5: fork: Resource temporarily unavailable]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/6/19

On Sat, Aug 05, 2000 at 10:58:26PM -0700, Linus Torvalds wrote:
> And no, it's not tested, I'd love to hear whether it fixes the problem
> people have.. (I have that atomic_inc in my kernel already, but it would
> be good to have it verified from somebody who actually _uses_ kmod ;)
> 
> 		Linus
It works for me: reboot problems with fork() are gone.
--- linux/kernel/kmod.c.orig	Sun Aug  6 13:20:10 2000
+++ linux/kernel/kmod.c	Sun Aug  6 13:39:04 2000
@@ -112,6 +112,7 @@
 		struct user_struct *user = current->user;
 		current->user = INIT_USER;
 		atomic_inc(&current->user->__count);
+		atomic_inc(&current->user->processes);
 		atomic_dec(&user->processes);
 		free_uid(user);
 	}
-- 
Frank
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/