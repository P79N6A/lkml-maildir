Date: Fri, 26 Jan 2007 11:39:06 +0100
From: Sébastien Dugué <>
Subject: Re: + make-good_sigevent-non-static.patch added to -mm tree
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/26/59

On Fri, 26 Jan 2007 13:08:01 +0300 Oleg Nesterov <oleg@tv-sign.ru> wrote:
> On 01/26, S?bastien Dugu? wrote:
> >
> > On Thu, 25 Jan 2007 18:43:24 +0300 Oleg Nesterov <oleg@tv-sign.ru> wrote:
> > 
> > > SИbastien DuguИ wrote:
> > > >
> > > > +struct task_struct *good_sigevent(sigevent_t *event)
> > > > +{
> > > > +	struct task_struct *task = current->group_leader;
> > > > +
> > > > +	if ((event->sigev_notify & SIGEV_THREAD_ID) == SIGEV_THREAD_ID) {
> > > > +		task = find_task_by_pid(event->sigev_notify_thread_id);
> > > > +
> > > > +		if (!task || task->tgid != current->tgid)
> > > > +			return NULL;
> > > > +	} else if (event->sigev_notify == SIGEV_SIGNAL) {
> > > 
> > > No, no, we can't use "else" here,
> > > 
> > > > +		if (event->sigev_signo <= 0 || event->sigev_signo > SIGRTMAX)
> > > 
> > > because we skip the check above in SIGEV_THREAD_ID case.
> > 
> >   Right, will fix this.
> > 
> > > 
> > > This way any user can crash the kernel with a minimal effort.
> > 
> >   Well I tried, no crash, just the signal failing to be delivered.
> 
> 	sigaddset:
> 
> 		set->sig[sig / _NSIG_BPW] |= 1UL << (sig % _NSIG_BPW);
> 
> This writes to ->sig[event->sigev_signo / _NSIG_BPW] location, so we can
> corrupt the memory if ->sigev_signo > _NSIG.
  Gawd, right.
> 
> Btw, since you are exporting this function, may I suggest to rename it?
> No, I can't suggest a better name :) But "good_sigevent" is a bit confusing
> imho.
  I agree, there was a discussion concerning this a while back but nothing came
out of it and I left it as is.
  I will try to find something more suggestive.
  Thanks,
  Sébastien.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/