Date: Fri, 18 May 2007 14:00:12 +0200
From: Andi Kleen <>
Subject: Re: [patch] x86_64, irq: check remote IRR bit before migrating level triggered irq
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/18/153

On Friday 18 May 2007 01:03, Siddha, Suresh B wrote:
> Normally, the EOI generated by local APIC for level trigger interrupt
> contains vector number. The IOAPIC will take this vector number and
> search the IOAPIC RTE entries for an entry with matching vector number and
> clear the remote IRR bit (indicate EOI). However, if the vector number is
> changed (as in step 3) the IOAPIC will not find the RTE entry when the EOI
> is received later. This will cause the remote IRR to get stuck causing the
> interrupt hang (no more interrupt from this RTE).
Does this happen often or did you only see it in some extreme or obscure
case?
> +	/*
> +	 * If the EOI still didn't reach the RTE corresponding to the
> +	 * level triggered irq, postpone the irq migration to the next
> +	 * irq arrival event.
> +	 */
> +	if (pending_eoi(irq)) {
> +		irq_desc[irq].status |= IRQ_MOVE_PENDING;
> +		return;
Other code seems to have similar problems, but we don't have any lock
protecting that bitmap against parallel updates outside the irq itself, don't 
we? Perhaps it needs to be all set_bit()
-Andi
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/