Date: Tue, 9 Jan 2001 23:46:50 +0000 (GMT)
From: Chris Rankin <>
Subject: Set ownership correctly for MPU401 synth operations
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/1/9/283

Hi,
This patch makes the mpu401_synth_operations structure respect
attach_mpu401()'s "owner" parameter. This should prevent more sound
module from being accidentally unloaded.
Cheers,
Chris
--- linux-vanilla/drivers/sound/mpu401.c	Fri Jan  5 23:14:08 2001
+++ linux-2.4.0-ac3/drivers/sound/mpu401.c	Tue Jan  9 23:41:43 2001
@@ -1030,6 +1030,8 @@
 			(char *) &mpu401_synth_proto,
 			 sizeof(struct synth_operations));
 	}
+	if (owner)
+		mpu401_synth_operations[m]->owner = owner;
 
 	memcpy((char *) &mpu401_midi_operations[m],
 	       (char *) &mpu401_midi_proto,