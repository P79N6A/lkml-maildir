Date: Sun, 28 Oct 2001 23:18:13 +0100
From: Jan Kara <>
Subject: Quota fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/10/28/98

  Hello,
  I'm sending you a small fix (thanks to Chris Mason for the patch)
which fixes possible list corruption when dquots are invalidated.
Please apply.
								Honza
PS to Chris: I simplified an condition a bit. Your was right too but
  I like being more careful and tell we block even if we don't.
Index: 0.43/fs/dquot.c
--- 0.43/fs/dquot.c Mon, 15 Oct 2001 03:51:05 -0400 root (linux/i/40_dquot.c 1.1.2.1.3.1.1.1 644)
+++ 0.43(w)/fs/dquot.c Mon, 15 Oct 2001 14:12:57 -0400 root (linux/i/40_dquot.c 1.1.2.1.3.1.1.1 644)
@@ -1246,6 +1246,8 @@
 {
 	if (dquot->dq_dup_ref && dquot->dq_count - dquot->dq_dup_ref <= 1)
 		return 1;
+	if (dquot->dq_count <= 1) 
+		return 1; 
 	return 0;
 }
 