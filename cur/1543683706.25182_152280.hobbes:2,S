Date: Mon, 28 Jul 2003 21:22:32 +0200
From: Francois Romieu <>
Subject: [PATCH] 2.6.0-test2 - HDLC hook update for drivers/net/wan/pc300_drv.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/28/215

Layout of struct hdlc_device has changed.
 drivers/net/wan/pc300_drv.c |   22 ++++++++++------------
 1 files changed, 10 insertions(+), 12 deletions(-)
diff -puN drivers/net/wan/pc300_drv.c~drivers-hooks-changed-pc300 drivers/net/wan/pc300_drv.c
--- linux-2.6.0-test2/drivers/net/wan/pc300_drv.c~drivers-hooks-changed-pc300	Mon Jul 28 21:05:52 2003
+++ linux-2.6.0-test2-fr/drivers/net/wan/pc300_drv.c	Mon Jul 28 21:10:11 2003
@@ -2553,11 +2553,10 @@ int cpc_ioctl(struct net_device *dev, st
 	switch (cmd) {
 		case SIOCGPC300CONF:
 #ifdef CONFIG_PC300_MLPPP
-			if (conf->proto != PC300_PROTO_MLPPP) {
-				conf->proto = hdlc->proto;
-			}
+			if (conf->proto != PC300_PROTO_MLPPP)
+				conf->proto = hdlc->proto.id;
 #else
-			conf->proto = hdlc->proto;
+			conf->proto = hdlc->proto.id;
 #endif
 			memcpy(&conf_aux.conf, conf, sizeof(pc300chconf_t));
 			memcpy(&conf_aux.hw, &card->hw, sizeof(pc300hw_t));
@@ -2590,12 +2589,12 @@ int cpc_ioctl(struct net_device *dev, st
 					}
 				} else {
 					memcpy(conf, &conf_aux.conf, sizeof(pc300chconf_t));
-					hdlc->proto = conf->proto;
+					hdlc->proto.id = conf->proto;
 				}
 			}
 #else
 			memcpy(conf, &conf_aux.conf, sizeof(pc300chconf_t));
-			hdlc->proto = conf->proto;
+			hdlc->proto.id = conf->proto;
 #endif
 			return 0;
 		case SIOCGPC300STATUS:
@@ -3153,14 +3152,13 @@ int cpc_open(struct net_device *dev)
 	printk("pc300: cpc_open");
 #endif
 
-	if (hdlc->proto == IF_PROTO_PPP) {
+	if (hdlc->proto.id == IF_PROTO_PPP)
 		d->if_ptr = &hdlc->state.ppp.pppdev;
-	}
 
 	result = hdlc_open(hdlc);
-	if (hdlc->proto == IF_PROTO_PPP) {
+	if (hdlc->proto.id == IF_PROTO_PPP)
 		dev->priv = d;
-	}
+
 	if (result) {
 		return result;
 	}
@@ -3191,9 +3189,9 @@ int cpc_close(struct net_device *dev)
 	CPC_UNLOCK(card, flags);
 
 	hdlc_close(hdlc);
-	if (hdlc->proto == IF_PROTO_PPP) {
+	if (hdlc->proto.id == IF_PROTO_PPP)
 		d->if_ptr = NULL;
-	}
+
 #ifdef CONFIG_PC300_MLPPP
 	if (chan->conf.proto == PC300_PROTO_MLPPP) {
 		cpc_tty_unregister_service(d);
_
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/