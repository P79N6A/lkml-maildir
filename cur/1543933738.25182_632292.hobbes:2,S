Date: Fri, 28 Dec 2007 15:42:57 -0500
From: Erez Zadok <>
Subject: [PATCH 23/30] Unionfs: set our superblock a/m/ctime granularity
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/28/122

Set it to 1 ns, because we could be stacked on top of file systems with such
granularity.
Signed-off-by: Erez Zadok <ezk@cs.sunysb.edu>
---
 fs/unionfs/main.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)
diff --git a/fs/unionfs/main.c b/fs/unionfs/main.c
index 92f0e9d..23c18f7 100644
--- a/fs/unionfs/main.c
+++ b/fs/unionfs/main.c
@@ -642,6 +642,13 @@ static int unionfs_read_super(struct super_block *sb, void *raw_data,
 	/* max Bytes is the maximum bytes from highest priority branch */
 	sb->s_maxbytes = unionfs_lower_super_idx(sb, 0)->s_maxbytes;
 
+	/*
+	 * Our c/m/atime granularity is 1 ns because we may stack on file
+	 * systems whose granularity is as good.  This is important for our
+	 * time-based cache coherency.
+	 */
+	sb->s_time_gran = 1;
+
 	sb->s_op = &unionfs_sops;
 
 	/* See comment next to the definition of unionfs_d_alloc_root */
-- 
1.5.2.2