Date: Tue, 20 Mar 2007 23:50:47 -0700
From: "Wink Saville" <>
Subject: [PATCH 6/7] Added trec_snapshot and trec_print_snapshot to do_page_fault() when the kernel itself faults
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/21/24

Signed-off-by: Wink Saville <wink@saville.com>
---
 arch/x86_64/mm/fault.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)
diff --git a/arch/x86_64/mm/fault.c b/arch/x86_64/mm/fault.c
index 6ada723..9857ade 100644
--- a/arch/x86_64/mm/fault.c
+++ b/arch/x86_64/mm/fault.c
@@ -25,6 +25,10 @@
 #include <linux/kprobes.h>
 #include <linux/uaccess.h>
+#ifdef CONFIG_TREC
+#include <linux/trec.h>
+#endif
+
 #include <asm/system.h>
 #include <asm/pgalloc.h>
 #include <asm/smp.h>
@@ -534,6 +538,9 @@ no_context:
  */
 	flags = oops_begin();
+#ifdef CONFIG_TREC
+	trec_snapshot();
+#endif
 	if (address < PAGE_SIZE)
 		printk(KERN_ALERT "Unable to handle kernel NULL pointer dereference");
@@ -548,6 +555,9 @@ no_context:
 	__die("Oops", regs, error_code);
 	/* Executive summary in case the body of the oops scrolled away */
 	printk(KERN_EMERG "CR2: %016lx\n", address);
+#ifdef CONFIG_TREC
+	trec_print_snapshot();
+#endif
 	oops_end(flags);
 	do_exit(SIGKILL);
-- 
1.5.0.rc2
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/