Date: Fri, 10 Aug 2007 22:00:10 +0200
From: "Rafael J. Wysocki" <>
Subject: Re: resume from ram much slower
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/10/338

On Friday, 10 August 2007 18:48, Arkadiusz Miskiewicz wrote:
> Hi,
> 
> Starting 1-2 weeks ago I have very long resume from
> ram times. It takes more than 1 min to resume. Does anyone see such behaviour?
> 
> Kernel from yesterday git, thinkpad z60m, suspend.sf.net tools 20070801
> 
> "ACPI handle has no context!" are interesting btw.
Let's try to find out something.
Please apply the patch below and see if anything changes.
Greetings,
Rafael
---
 drivers/pnp/pnpacpi/core.c |   20 +++++++++++++++-----
 1 file changed, 15 insertions(+), 5 deletions(-)
Index: linux-2.6.23-rc2/drivers/pnp/pnpacpi/core.c
===================================================================
--- linux-2.6.23-rc2.orig/drivers/pnp/pnpacpi/core.c
+++ linux-2.6.23-rc2/drivers/pnp/pnpacpi/core.c
@@ -130,11 +130,21 @@ static int pnpacpi_disable_resources(str
 #ifdef CONFIG_ACPI_SLEEP
 static int pnpacpi_suspend(struct pnp_dev *dev, pm_message_t state)
 {
-	return acpi_bus_set_power((acpi_handle) dev->data,
-				  acpi_pm_device_sleep_state(&dev->dev,
-							     device_may_wakeup
-							     (&dev->dev),
-							     NULL));
+	int power_state;
+
+	power_state = acpi_pm_device_sleep_state(&dev->dev,
+						device_may_wakeup(&dev->dev),
+						NULL);
+
+	if (power_state < 0) {
+		printk(KERN_ERR
+			"%s: Could not choose power state for device!\n",
+			dev->name);
+		power_state = (state.event == PM_EVENT_ON) ?
+				ACPI_STATE_D0 : ACPI_STATE_D3;
+	}
+
+	return acpi_bus_set_power((acpi_handle) dev->data, power_state);
 }
 
 static int pnpacpi_resume(struct pnp_dev *dev)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/