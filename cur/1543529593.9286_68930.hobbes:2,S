Date: Sun, 12 Mar 2000 16:53:32 -0700 (MST)
From: Andreas Dilger <>
Subject: Re: patch: reiserfs for 2.3.49
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/12/188

Chris writes:
> memory pressure hooks would be very useful.  We have a hard to reproduce
> deadlock under very high swap load, where kswapd ends up waiting on the
> log while trying to flush inodes to disk.  I have a work around planned
> (all in the journal code), it won't take long to code, but it will take a
> few days to test right.
Yes, it would be good to have some sort of callback to the filesystem to
force a page flush.  We have similar problems with our filesystem when
running a benchmark (iozone) which creates files larger than available
RAM within a few seconds.  All of the pages are referenced, and our daemon
can't even get a chance to flush them before the system locks.
One possible solution we have thought about is to block the process that
is adding to the cache until more pages are free, but this suffers because
the function nr_free_cache_pages() is not exported from the kernel, so we
don't even know how much memory is available...  A callback would be much
better.  I think a patch to do this was even posted on l-k within the last
month or so...
Cheers, Andreas
-- 
Andreas Dilger  \ "If a man ate a pound of pasta and a pound of antipasto,
                 \  would they cancel out, leaving him still hungry?"
http://www-mddsp.enel.ucalgary.ca/People/adilger/
               -- Dogbert
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/