Date: Thu, 11 Dec 2003 09:28:38 -0500
From: Gene Heskett <>
Subject: Re: floppy.c problems?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/12/11/126

On Thursday 11 December 2003 00:36, dan carpenter wrote:
>On Wednesday 10 December 2003 02:58 pm, Gene Heskett wrote:
>> I've added 4 more lines to the floppy definition array in
>> floppy.c, and increased the array count at the top to match, but I
>> don't seem to be able to get any output, its working as usual. 
>> Stuck in 512 bytes per sector modes, 9 to the track that is.
>
>Can you show us your code.
>
>regards,
>dan carpenter
sure, from the top of the array in floppy.c:
--------------
static struct floppy_struct floppy_type[36] = { /* it was [32] */
--------------
Then at the bottom, including 2 lines of the old code for reference:
--------------
        { 1600,10,2,80,0,0x25,0x02,0xDF,0x2E,"D800"  }, /* 30 800KB 3.5"    */
        { 3200,20,2,80,0,0x1C,0x00,0xCF,0x2C,"H1600" }, /* 31 1.6MB 3.5"    */
        {  720,18,1,35,0,0x2A,0x02,0xDF,0x00,"OS935s"}, /* 32 160k 5.25" ss os9 */
        {  720,18,1,40,0,0x2A,0x02,0xDF,0x00,"OS940s"}, /* 33 180k 5.25" ss os9 */
        {  720,18,2,40,0,0x2A,0x02,0xDF,0x00,"OS940d"}, /* 34 360k 5.25" dd os9 */
        {  720,18,2,80,0,0x2A,0x02,0xDF,0x00,"OS980d"}, /* 35 720k 5.25" hd os9 */
};
---------------
With those changes, and some additional defines in 
/usr/local/etc/mediaprm:
---------------
# TRS-80 Color Computer OS9 formats(to be confirmed)
"COCO360":
 DS DD sect=18 cyl=40 ssize=256 tpi=48
"COCO720":
 DS DD sect=18 cyl=80 ssize=256 tpi=96
# Now we know this one works!
"COCO3.5DD":
 DS DD sect=18 cyl=40 ssize=256 tpi=135
"COCO3.5HD":
 DS DD sect=18 cyl=80 ssize=256 tpi=135
---------------
And using "setfdprm /dev/fd0 coco3.5dd"
before each fdformat invocation,
I was finally able to make useable disks.  Note
that the COCO3.5HD is still on a "DD" diskette,
the coco's controllers cannot do 500 kilobaud
data rates.  So those last 2 should make 360k
and 720k disks.
But fdformat still lies like a fsking rug when
its formatting the disk, and outputs are odd
during the verify, skipping tracks, sometimes
several, at random.  Now if I could find the
srcs for fdformat, I'd make it tell the truth,
even if i have to give it a shot of pentathol.
 :-)  <--happy camper
-- 
Cheers, Gene
AMD K6-III@500mhz 320M
Athlon1600XP@1400mhz  512M
99.22% setiathome rank, not too shabby for a WV hillbilly
Yahoo.com attornies please note, additions to this message
by Gene Heskett are:
Copyright 2003 by Maurice Eugene Heskett, all rights reserved.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/