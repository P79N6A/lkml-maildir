Date: Fri, 25 Jun 1999 12:44:42 -0400 (EDT)
From: Andrew Schretter <>
Subject: Re: nfsv3 client/solaris server troubles
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/6/25/117

Trond,
   I too had noticed the fall off in performance but was unable to
pinpoint where it began.  I recently tried 2.2.10 with 0.9.9.2 NFSv3
patches.  The first time I tried running Bonnie on it, it locked the
machine up hard.  The second time, I got a kernel panic out of it ...
Unable to handle kernel NULL pointer dereference at virtual address
00000023
current->tss.cr3 = 00101000, %cr3 = 00101000
*pde = 00000000
Oops: 0000
CPU:    0
EIP:    0010:[<c014c615>]
EFLAGS: 00010202
eax: 00000000   ebx: 00000023   ecx: ffffffea   edx: cbcd3f60
esi: cbcd3f60   edi: cbcd3ec8   ebp: cbcd3f60   esp: cbcd3e94
ds: 0018   es: 0018   ss: 0018
Process rpciod (pid: 221, process nr: 13, stackpage=cbcd3000)
Stack: 000000dd cee9719c 00001e17 c0148ebd cee9719c cbcd3f60 cbcd3ec8 c0000000
       cbcd3f10 cf1de000 cdcb9ac0 47464544 cbcd2000 000000dd 00000000 00000000
       00000000 00000000 d0840375 cee9719c cbcd3f60 00000000 cdcb9ac0 cf1de000
Call Trace: [<c0148ebd>] [<d0840375>] [<c014b548>] [<c014b500>]
[<c014b574>]
Code: 8b 13 83 fa 0b 0f 86 58 01 00 00 89 d8 2b 45 10 01 d0 39 45
This happened while writing to a mount from a solaris 2.6 machine
with no options.  It was mounted nfsv3 with 32768 rsize and wsize.
> Todd Chauvin <chauvin@cauchy.ee.washington.edu> writes:
> 
> > Hi,
> > 
> > I was wondering if anyone is successfully using the nfsv3 client patches with
> > solaris 2.6/7 servers.  Up until revision 0.9.4.3, performance (for my
> <snip>
> > 
> > As best as I can tell, the problem is related to the file net/sunrpc/xprt.c
> > If I apply patch 0.9.9.1 to linux-2.2.10 and then clobber only xprt.c
> > with the version from patch 0.9.4.3, the performance is restored.  Using 
> > 'snoop' on solaris, it seems as though the linux client is flooding the 
> > network with UDP packets.  In fact, to write 1 megabyte, snoop captures 10 
> > times as many packets with recent versions of the nfsv3 patches as compared 
> > to version 0.9.4.3. 
> 
> Could you try patch 0.9.9.2? That should reduce the number of retries.
> This is also the first version where the TCP stuff seems to work for
> me (albeit slowly) without crashing under iozone.
> 
> Cheers,
>   Trond
> 
> -
> To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
> the body of a message to majordomo@vger.rutgers.edu
> Please read the FAQ at 
http://www.tux.org/lkml/
> 
Andrew Schretter
Systems Programmer, Duke University
Dept. of Mathematics (919) 660-2866
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/