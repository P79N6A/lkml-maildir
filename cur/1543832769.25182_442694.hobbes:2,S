Date: Mon, 10 Jul 2006 15:52:41 -0400
From: Brian Walsh <>
Subject: [PATCH 2.6.18-rc1 1/1] drivers/base: Platform notify needs to occur before drivers attach to the device
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/10/317

The platform_notify call for Arm and PPC architectures needs to be
called before the driver attaches to the device.  The problem only
presents itself when hotplugging certain devices while the driver is
already loaded.
Signed-off-by: Brian Walsh <brian@walsh.ws>
---
diff -ur a/drivers/base/core.c b/drivers/base/core.c
--- a/drivers/base/core.c       2006-07-10 13:26:00.000000000 -0400
+++ b/drivers/base/core.c       2006-07-10 13:32:58.000000000 -0400
@@ -307,6 +307,10 @@
        if ((error = kobject_add(&dev->kobj)))
                goto Error;
+       /* notify platform of device entry */
+       if (platform_notify)
+               platform_notify(dev);
+
        dev->uevent_attr.attr.name = "uevent";
        dev->uevent_attr.attr.mode = S_IWUSR;
        if (dev->driver)
@@ -361,10 +365,6 @@
                list_add_tail(&dev->node, &dev->class->devices);
                up(&dev->class->sem);
        }
-
-       /* notify platform of device entry */
-       if (platform_notify)
-               platform_notify(dev);
  Done:
        kfree(class_name);
        put_device(dev);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/