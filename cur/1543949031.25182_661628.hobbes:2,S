Date: Fri, 29 Feb 2008 10:49:52 -0600
From: Steve Wise <>
Subject: Re: [PATCH] update max_inline_data when creating a qp
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/29/197

Acked-by: Steve Wise <swise@opengridcomputing.com>
Jon Mason wrote:
> mthca modifies the attributes passed in when creating the qp to have
> (amongst other things) the max_inline_data.  While cxgb3 does modify
> the attributes of some of the parameters, it does not modify the
> max_inline_data to be what the adapter supports.  cxgb should conform
> to the same behavior as mthca (as some user space programs are
> expecting this) and return the max_inline_data.
> 
> Signed-off-by: Jon Mason <jon@opengridcomputing.com>
> ---
>  drivers/infiniband/hw/cxgb3/iwch_provider.c |    3 +++
>  1 files changed, 3 insertions(+), 0 deletions(-)
> 
> diff --git a/drivers/infiniband/hw/cxgb3/iwch_provider.c b/drivers/infiniband/hw/cxgb3/iwch_provider.c
> index 800ef6d..5f0c9d3 100644
> --- a/drivers/infiniband/hw/cxgb3/iwch_provider.c
> +++ b/drivers/infiniband/hw/cxgb3/iwch_provider.c
> @@ -818,8 +818,11 @@ static struct ib_qp *iwch_create_qp(struct ib_pd *pd,
>  		kfree(qhp);
>  		return ERR_PTR(-ENOMEM);
>  	}
> +
>  	attrs->cap.max_recv_wr = rqsize - 1;
>  	attrs->cap.max_send_wr = sqsize;
> +	attrs->cap.max_inline_data = T3_MAX_INLINE;
> +
>  	qhp->rhp = rhp;
>  	qhp->attr.pd = php->pdid;
>  	qhp->attr.scq = ((struct iwch_cq *) attrs->send_cq)->cq.cqid;