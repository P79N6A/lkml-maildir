Date: Thu, 25 Dec 2008 14:25:56 +0100
From: Ingo Molnar <>
Subject: Re: [git pull] core kernel updates for v2.6.29
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/25/63

* Ingo Molnar <mingo@elte.hu> wrote:
> [ Note, this tree will generate conflicts if pulled after the x86,
>   tracing and scheduler trees - i'll follow up with this mail with
>   a conflict resolution commit. ]
the conflict resolutions i have cached for this are attached below - all 
the conflicts are contextual.
( Have not found a Git way to export this resolution in plain patch format
  that could be applied in a raw form when the conflicts come up after the
  pull - git-show uses the git-diff-tree --cc interdiff format. )
	Ingo
------------->
commit 75c8fc6a491d5bbf20be8ce3fb140d0daa2b32dc
Merge: 65890e7... 6638101...
Author: Ingo Molnar <mingo@elte.hu>
Date:   Thu Dec 25 14:11:46 2008 +0100
    Merge branch 'core-for-linus' into tmp.tmp
    
    Conflicts:
    	arch/x86/kernel/Makefile
    	arch/x86/mm/init_32.c
    	include/linux/hardirq.h
diff --cc arch/x86/kernel/Makefile
index 88dd768,a9c656f..e9a6bc0
--- a/arch/x86/kernel/Makefile
+++ b/arch/x86/kernel/Makefile
@@@ -107,8 -105,8 +107,10 @@@ microcode-$(CONFIG_MICROCODE_INTEL)	+= 
  microcode-$(CONFIG_MICROCODE_AMD)	+= microcode_amd.o
  obj-$(CONFIG_MICROCODE)			+= microcode.o
  
+ obj-$(CONFIG_SWIOTLB)			+= pci-swiotlb_64.o # NB rename without _64
+ 
 +obj-$(CONFIG_X86_CHECK_BIOS_CORRUPTION) += check.o
 +
  ###
  # 64 bit specific files
  ifeq ($(CONFIG_X86_64),y)
diff --cc arch/x86/mm/init_32.c
index 800e1d9,2b4b14f..8655b5b
--- a/arch/x86/mm/init_32.c
+++ b/arch/x86/mm/init_32.c
@@@ -967,6 -970,10 +968,8 @@@ void __init mem_init(void
  	int codesize, reservedpages, datasize, initsize;
  	int tmp;
  
 -	start_periodic_check_for_corruption();
 -
+ 	pci_iommu_alloc();
+ 
  #ifdef CONFIG_FLATMEM
  	BUG_ON(!mem_map);
  #endif
diff --cc include/linux/hardirq.h
index 89a56d7,9b70b92..f832883
--- a/include/linux/hardirq.h
+++ b/include/linux/hardirq.h
@@@ -162,17 -163,7 +164,20 @@@ extern void irq_enter(void)
   */
  extern void irq_exit(void);
  
 -#define nmi_enter()		do { lockdep_off(); rcu_nmi_enter(); __irq_enter(); } while (0)
 -#define nmi_exit()		do { __irq_exit(); rcu_nmi_exit(); lockdep_on(); } while (0)
 +#define nmi_enter()				\
 +	do {					\
 +		ftrace_nmi_enter();		\
 +		lockdep_off();			\
++		rcu_nmi_enter();		\
 +		__irq_enter();			\
 +	} while (0)
++
 +#define nmi_exit()				\
 +	do {					\
 +		__irq_exit();			\
++		rcu_nmi_exit();			\
 +		lockdep_on();			\
 +		ftrace_nmi_exit();		\
 +	} while (0)
  
  #endif /* LINUX_HARDIRQ_H */