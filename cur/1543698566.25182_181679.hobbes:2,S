Date: Fri, 5 Dec 2003 01:08:15 +1100
From: Con Kolivas <>
Subject: Re: 2.4.23-ck1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/12/4/67

On Fri, 5 Dec 2003 00:36, Tvrtko A. UrÅ¡ulin wrote:
> On Thursday 04 December 2003 14:31, Tim Schmielau wrote:
> > Warning: totally untested. Pretty much obvious, however.
>
> oxygene:/usr/src/linux-2.4.23-ck1 # patch --dry-run
> <../patches/2.4.23-ck1-stat-fix.patch -p1 --global-reject=bla
> patching file fs/proc/proc_misc.c
> Hunk #1 FAILED at 422.
> Hunk #2 FAILED at 460.
> 2 out of 2 hunks FAILED -- saving rejects to file fs/proc/proc_misc.c.rej
Probably just a whitespace problem. Try this one. Please tell me if it works; 
I just made this based on what Tim sent (thanks muchly by the way Tim!)
Con
diff -Naurp linux-2.4.23-ck1/fs/proc/proc_misc.c linux-2.4.23-ck1-fix1/fs/proc/proc_misc.c
--- linux-2.4.23-ck1/fs/proc/proc_misc.c	2003-12-02 23:17:28.000000000 +1100
+++ linux-2.4.23-ck1-fix1/fs/proc/proc_misc.c	2003-12-05 01:06:11.585672996 +1100
@@ -422,7 +422,7 @@ static int kstat_read_proc(char *page, c
 			(unsigned long long) jiffies_64_to_clock_t(user),
 			(unsigned long long) jiffies_64_to_clock_t(nice),
 			(unsigned long long) jiffies_64_to_clock_t(system),
-			(unsigned long long) jiffies_64_to_clock_t(jif - user - nice - system));
+			(unsigned long long) jif - jiffies_64_to_clock_t(user + nice + system));
 	}
 	proc_sprintf(page, &off, &len,
 		"page %u %u\n"
@@ -460,7 +460,7 @@ static int kstat_read_proc(char *page, c
 		}
 	}
 
-	do_div(jif, HZ);
+	do_div(jif, USER_HZ);
 	proc_sprintf(page, &off, &len,
 		"\nctxt %lu\n"
 		"btime %lu\n"