Date: Thu, 12 Oct 2000 23:21:30 -0700
From: Greg KH <>
Subject: [PATCH] USB mdc800 driver fix for test10-pre2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/10/13/23

On Thu, Oct 12, 2000 at 08:06:46AM -0400, tytso@mit.edu wrote:
> 
>      * USB: fix setting urb->dev in plusb, wacom, mdc800) (Greg KH)
>        {CRITICAL}
Attached is a patch against 2.4.0-test10-pre2 for the mdc800.c driver to
fix this problem.
Could anyone who has this device, verify that this patch works properly
and enables the device to work again?
thanks,
greg k-h
-- 
greg@(kroah|wirex).com
diff -Naur -X dontdiff linux-2.4.0-test10-pre2/drivers/usb/mdc800.c linux-2.4.0-test10-pre2-greg/drivers/usb/mdc800.c
--- linux-2.4.0-test10-pre2/drivers/usb/mdc800.c	Wed Jul 12 21:58:43 2000
+++ linux-2.4.0-test10-pre2-greg/drivers/usb/mdc800.c	Fri Oct 13 00:17:57 2000
@@ -562,6 +562,7 @@
 	mdc800->camera_request_ready=0;
 
 	retval=0;
+	mdc800->irq_urb->dev = mdc800->dev;
 	if (usb_submit_urb (mdc800->irq_urb))
 	{
 		err ("request USB irq fails (submit_retval=%i urb_status=%i).",retval, mdc800->irq_urb->status);
@@ -640,6 +641,7 @@
 				mdc800->out_ptr=0;
 
 				/* Download -> Request new bytes */
+				mdc800->download_urb->dev = mdc800->dev;
 				if (usb_submit_urb (mdc800->download_urb))
 				{
 					err ("Can't submit download urb (status=%i)",mdc800->download_urb->status);
@@ -738,6 +740,7 @@
 
 			mdc800->state=WORKING;
 			memcpy (mdc800->write_urb->transfer_buffer, mdc800->in,8);
+			mdc800->write_urb->dev = mdc800->dev;
 			if (usb_submit_urb (mdc800->write_urb))
 			{
 				err ("submitting write urb fails (status=%i)", mdc800->write_urb->status);[unhandled content-type:application/pgp-signature]