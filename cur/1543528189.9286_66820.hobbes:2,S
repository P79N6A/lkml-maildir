Date: Wed, 1 Mar 2000 16:20:41 -0500
From: Ian Peters <>
Subject: Re: 2.3.47 kernel panic with serial.o
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/1/165

On Wed, Mar 01, 2000 at 01:42:35PM -0500, Theodore Y. Ts'o wrote:
>    More information on how exactly to reproduce the problem is available
>    in a variety of mail messages, and is of course also available on
>    request from me.  I'm also happy to try anything that would help in
>    debugging the problem, if people tell me what to do.
> 
> Can you give me a rundown of the hardware you have in your system, and a
> print out of the kernel messages printed by the serial module when you
> load and unload it?  (Run dmesgs and send me the output).
Sure thing.  My computer is a 2xPII at 300 MHz, the motherboard is a
Tyan Thunder 100.  SCSI/IDE hybrid (root is on a SCSI disk).
When I first insmod the driver, I get
root@geodesic:~# insmod serial
Using /lib/modules/2.3.48/misc/serial.o
root@geodesic:~# lsmod
Module                  Size  Used by
serial                 41764   0  (unused)
ide-cd                 24332   0  (autoclean)
cdrom                  26396   0  (autoclean) [ide-cd]
eepro100               15292   1  (autoclean)
dmesg reports
Serial driver version 4.92 (2000-1-27) with MANY_PORTS SHARE_IRQ SERIAL_PCI enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
ttyS01 at 0x02f8 (irq = 3) is a 16550A
Now, I try to remove the driver,
root@geodesic:~# rmmod serial
root@geodesic:~# lsmod
Module                  Size  Used by
ide-cd                 24332   0  (autoclean)
cdrom                  26396   0  (autoclean) [ide-cd]
eepro100               15292   1  (autoclean)
Everything's looking good.  Insert again,
root@geodesic:~# insmod serial
Using /lib/modules/2.3.48/misc/serial.o
root@geodesic:~# lsmod
Module                  Size  Used by
serial                 41764   0  (unused)
ide-cd                 24332   0  (autoclean)
cdrom                  26396   0  (autoclean) [ide-cd]
eepro100               15292   1  (autoclean)
Identical dmesg output,
Serial driver version 4.92 (2000-1-27) with MANY_PORTS SHARE_IRQ SERIAL_PCI enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
ttyS01 at 0x02f8 (irq = 3) is a 16550A
But now when I try to remove serial, I get
root@geodesic:~# rmmod serial
And rmmod never returns.  ps reports for the rmmod process
itp@geodesic:~$ stalk rmmod
USER       PID %CPU %MEM   VSZ  RSS  TTY     STAT START   TIME COMMAND
root     32533 99.7  0.2  1036  320 tty1     R    15:54   4:28 rmmod serial
No form of kill is able to stop this process.  lsmod now reports
itp@geodesic:~$ lsmod
Module                  Size  Used by
serial                 41764   0 (deleted)
eepro100               15292   1 (autoclean)
Although sometimes the string "(deleted)" is instead "(unitialized)".
No further output is generated by dmesg.
At this point, if I try to access /dev/ttyS0 or /dev/ttyS1, I get an
instant reboot or Oops.  So, I unmounted everything but root, and
tried.  The machine goes down hard, the oops doesn't get into the
logs, and the only useable thing I copied out was the "Code:" line (as
the rest scrolled away), which I ran through ksymoops (I have no idea
if this is enough or not, so if not, I apologize), and got
ksymoops 2.3.3 on i686 2.3.48.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.3.48/ (default)
     -m /boot/System.map-2.3.48 (default)
Warning: You did not tell me where to find symbol information.  I will
assume that the log matches the kernel and modules that are running
right now and I'll use the default options above for symbol resolution.
If the current kernel and/or modules do not match the log, you can get
more accurate output by telling me the kernel version and where to find
map, modules, ksyms etc.  ksymoops -h explains the options.
Code: 8b 82 24 33 2d c0 f7 d8 39 82 20 33 2d c0 0f 85 83 02 00 00
Using defaults from ksymoops -t elf32-i386 -a i386
Code;  00000000 Before first symbol
00000000 <_EIP>:
Code;  00000000 Before first symbol
   0:   8b 82 24 33 2d c0         mov    0xc02d3324(%edx),%eax
Code;  00000006 Before first symbol
   6:   f7 d8                     neg    %eax
Code;  00000008 Before first symbol
   8:   39 82 20 33 2d c0         cmp    %eax,0xc02d3320(%edx)
Code;  0000000e Before first symbol
   e:   0f 85 83 02 00 00         jne    297 <_EIP+0x297> 00000297 Before first symbol
1 warning issued.  Results may not be reliable.
So that's my story.  If there's any useful information I've left out,
or anything more I can do to help track it down, just let me know.
-- 
Ian Peters  | GnuPG Key ID 5C23D20C    | Those who know what's best
itp@gnu.org | E584 2558 FAC3 BEAB EFAC | for us must rise and save
itp@cmu.edu | FC74 CFED 7E24 5C23 D20C | us from ourselves...
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/