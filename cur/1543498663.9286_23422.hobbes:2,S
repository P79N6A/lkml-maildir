Date: Fri, 11 Jun 1999 00:57:35 -0400 (EDT)
From: phazer <>
Subject: Slow UDMA transfer rates (was Re: OOps with kernel 2.2.9 while mounting (joliet) cd-r
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/6/10/264

On Thu, 10 Jun 1999, Andre M. Hedrick wrote:
>> 
>> I disabled Ultra-DMA in the BIOS. with UDMA enabled i got a max 
>> transfer rate of 1.2 MB/s, with UDMA turned off, i get 
>> between 12 and 17 MB/s  (about the same as my UDMA WD-disk)
>
>Intel PIIXn chipsets support (EXPERIMENTAL)
>CONFIG_BLK_DEV_PIIX
>
>Enable this option..........
>
>I had that "Abit BX6-r2" board in my head during the design of this
>chipset code.
>
>I would like a copy of your current pci-config space and with the latest
>"kilo" patch.
>
>hexdump /proc/bus/pci/00/07.1 > piix4.hotel
>hexdump /proc/bus/pci/00/07.1 > piix4.kilo
>
>You may get a "set_geometry_intr" error/hiccup but that is okay.
>I suspect that you will not since the BIOS needs to be educated during
>the init process.
>
>Andre Hedrick
>The Linux IDE guy
OK i turned Ultra-DMA for the primary-master back on..
[root@phobos linux]# grep CONFIG_BLK_DEV_PIIX .config
CONFIG_BLK_DEV_PIIX=y
#######################################################################
with 2.2.9-hotel:
Uniform Multi-Platform E-IDE driver Revision: 6.19
PIIX4: IDE controller on PCI bus 00 dev 39
PIIX4: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:DMA, hdb:DMA
    ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:DMA, hdd:DMA
hda: Maxtor 90720D5, ATA DISK drive
hdb: WDC AC310100B, ATA DISK drive
hdc: WDC AC21200H, ATA DISK drive
hdd: ATAPI CDROM, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
ide1 at 0x170-0x177,0x376 on irq 15
hda: Maxtor 90720D5, 6869MB w/256kB Cache, CHS=875/255/63, UDMA(33)
hdb: WDC AC310100B, 9671MB w/512kB Cache, CHS=1232/255/63, UDMA(33)
hdc: WDC AC21200H, 1222MB w/128kB Cache, CHS=2484/16/63, DMA
hdd: ATAPI 24X CD-ROM drive, 120kB Cache, DMA
Uniform CDROM driver Revision: 2.55
Floppy drive(s): fd0 is 1.44M
FDC 0 is a post-1991 82077
Partition check:
 hda: hda1! hda2 hda3 hda4 < hda5 hda6 > < hda7 hda8 hda9
hda10???????????? >
 hdb: hdb1 hdb2 hdb3 hdb4 < hdb5 hdb6 >
 hdc: [PTBL] [621/64/63] hdc1 hdc2 < hdc5 >
VFS: Mounted root (ext2 filesystem) readonly.
[root@phobos /root]# uname -a
Linux phobos.0060978d849.ne.mediaone.net 2.2.9 #1 Fri Jun 11 00:11:42 EDT
1999 i686 unknown
[root@phobos /root]# hdparm -ITt /dev/hda
/dev/hda:
 Model=aMtxro9 70025D                          , FwRev=AW8S7293,
SerialNo=5K40SNAZ
 Config={ Fixed }
 RawCHS=13957/16/63, TrkSize=0, SectSize=0, ECCbytes=29
 BuffType=3(DualPortCache), BuffSize=256kB, MaxMultSect=16, MultSect=off
 DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=2(fast)
 CurCHS=13957/16/63, CurSects=14068656, LBA=yes, LBAsects=14068656
 tDMA={min:120,rec:120}, DMA modes: mword0 mword1 mword2
 IORDY=on/off, tPIO={min:120,w/IORDY:120}, PIO modes: mode3 mode4
 Timing buffer-cache reads:   64 MB in  0.90 seconds =71.11 MB/sec
 Timing buffered disk reads:  32 MB in 23.13 seconds = 1.38 MB/sec
[root@phobos /root]# hexdump /proc/bus/pci/00/07.1
0000000 8086 7111 0005 0280 8001 0101 4000 0000
0000010 0000 0000 0000 0000 0000 0000 0000 0000
0000020 f001 0000 0000 0000 0000 0000 0000 0000
0000030 0000 0000 0000 0000 0000 0000 0000 0000
0000040 e377 e337 00bb 0000 0003 0022 0000 0000
0000050 0000 0000 0000 0000 0000 0000 0000 0000
*
00000f0 0000 0000 0000 0000 0f30 0000 0000 0000
0000100
#######################################################################
and now the same with 2.2.9-kilo
Uniform Multi-Platform E-IDE driver Revision: 6.19
PIIX4: IDE controller on PCI bus 00 dev 39
PIIX4: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:DMA, hdb:DMA
    ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:DMA, hdd:DMA
hda: Maxtor 90720D5, ATA DISK drive
hdb: WDC AC310100B, ATA DISK drive
hdc: WDC AC21200H, ATA DISK drive
hdd: ATAPI CDROM, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
ide1 at 0x170-0x177,0x376 on irq 15
hda: Maxtor 90720D5, 6869MB w/256kB Cache, CHS=875/255/63, UDMA(33)
hdb: WDC AC310100B, 9671MB w/512kB Cache, CHS=1232/255/63, UDMA(33)
hdc: set_geometry_intr: status=0x51 { DriveReady SeekComplete Error }
hdc: set_geometry_intr: error=0x04 { DriveStatusError }
hdc: WDC AC21200H, 1222MB w/128kB Cache, CHS=2484/16/63, DMA
hdd: ATAPI 24X CD-ROM drive, 120kB Cache, DMA
Uniform CDROM driver Revision: 2.55
Floppy drive(s): fd0 is 1.44M
FDC 0 is a post-1991 82077
Partition check:
 hda: hda1! hda2 hda3 hda4 < hda5 hda6 > < hda7 hda8 hda9
hda10???????????? >
 hdb: hdb1 hdb2 hdb3 hdb4 < hdb5 hdb6 >
 hdc: [PTBL] [621/64/63] hdc1 hdc2 < hdc5 >
VFS: Mounted root (ext2 filesystem) readonly.
[root@phobos /root]# uname -a
Linux phobos.0060978d849.ne.mediaone.net 2.2.9 #1 Fri Jun 11 00:20:13 EDT
1999 i686 unknown
[root@phobos /root]# hdparm -ITt /dev/hda
/dev/hda:
 Model=aMtxro9 70025D                          , FwRev=AW8S7293,
SerialNo=5K40SNAZ
 Config={ Fixed }
 RawCHS=13957/16/63, TrkSize=0, SectSize=0, ECCbytes=29
 BuffType=3(DualPortCache), BuffSize=256kB, MaxMultSect=16, MultSect=off
 DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=2(fast)
 CurCHS=13957/16/63, CurSects=14068656, LBA=yes, LBAsects=14068656
 tDMA={min:120,rec:120}, DMA modes: mword0 mword1 mword2
 IORDY=on/off, tPIO={min:120,w/IORDY:120}, PIO modes: mode3 mode4
 Timing buffer-cache reads:   64 MB in  0.93 seconds =68.82 MB/sec
 Timing buffered disk reads:  32 MB in 23.69 seconds = 1.35 MB/sec
[root@phobos /root]# hexdump /proc/bus/pci/00/07.1
0000000 8086 7111 0005 0280 8001 0101 4000 0000
0000010 0000 0000 0000 0000 0000 0000 0000 0000
0000020 f001 0000 0000 0000 0000 0000 0000 0000
0000030 0000 0000 0000 0000 0000 0000 0000 0000
0000040 e377 e377 001b 0000 0003 0022 0000 0000
0000050 0000 0000 0000 0000 0000 0000 0000 0000
*
00000f0 0000 0000 0000 0000 0f30 0000 0000 0000
0000100
#######################################################################
And here's my old kernel, 2.2.9 + hotel and UDMA DISABLED (for pri.
master)
[root@phobos battlemech]# hdparm -ITt /dev/hda
/dev/hda:
 Model=aMtxro9 70025D                          , FwRev=AW8S7293,
SerialNo=5K40SNAZ
 Config={ Fixed }
 RawCHS=13957/16/63, TrkSize=0, SectSize=0, ECCbytes=29
 BuffType=3(DualPortCache), BuffSize=256kB, MaxMultSect=16, MultSect=off
 DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=2(fast)
 CurCHS=13957/16/63, CurSects=14068656, LBA=yes, LBAsects=14068656
 tDMA={min:120,rec:120}, DMA modes: mword0 mword1 *mword2 
 IORDY=on/off, tPIO={min:120,w/IORDY:120}, PIO modes: mode3 mode4 
 Timing buffer-cache reads:   64 MB in  0.96 seconds =66.67 MB/sec
 Timing buffered disk reads:  32 MB in  3.05 seconds =10.49 MB/sec
-phazer
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/