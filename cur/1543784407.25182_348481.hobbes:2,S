Date: Fri, 09 Sep 2005 14:33:49 +0900
From: KAMEZAWA Hiroyuki <>
Subject: [2.6.13-mm2] i386-sparsemem-compile-with-DMA32
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/9/8

Because 2.6.13-mm2  adds new zone DMA32, ZONES_SHIFT becomes 3.
So, flags bits reserved for (SECTION | NODE | ZONE) should be increase.
-- Kame
==
ZONE_SHIFT is increased, FLAGS_RESERVED should be.
Signed-off-by Kamezawa Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com>
Index: linux-2.6.13-mm2/include/linux/mmzone.h
===================================================================
--- linux-2.6.13-mm2.orig/include/linux/mmzone.h
+++ linux-2.6.13-mm2/include/linux/mmzone.h
@@ -458,10 +458,11 @@ extern struct pglist_data contig_page_da
  #if BITS_PER_LONG == 32 || defined(ARCH_HAS_ATOMIC_UNSIGNED)
  /*
   * with 32 bit page->flags field, we reserve 8 bits for node/zone info.
- * there are 3 zones (2 bits) and this leaves 8-2=6 bits for nodes.
+ * there are 4 zones (3 bits) and this leaves 8-2=6 bits for nodes.
+ * +6bits for sections if CONFIG_SPARSEMEM
   */
-#define FLAGS_RESERVED		8
+#define FLAGS_RESERVED		9
  #elif BITS_PER_LONG == 64
  /*
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/