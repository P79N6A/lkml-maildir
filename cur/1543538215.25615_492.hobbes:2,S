Date: Tue, 4 Jul 2000 15:57:11 -0700 (PDT)
From: Ani Joshi <>
Subject: Re: [PATCH] rivafb bugfixes
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/4/100

On Tue, 4 Jul 2000, Harold Oga wrote:
> Notice how the rgba lines are different between the two.  Vesafb appears
> with correct colors, and rivafb does not.  I guess I'll have to study the
> 2 drivers and see if I see some obvious error somewhere.
I fixed this last week sometime and sent the fix to Linus, it should be
in test3-3.  If you don't feel like waiting, i've also attatched it.
Sorry, this was a blunder I made very long time go in the early days of
rivafb and forgot all about it.
ani
--- linux.orig/drivers/video/riva/fbdev.c	Fri Jun 30 01:15:35 2000
+++ linux/drivers/video/riva/fbdev.c	Fri Jun 30 01:17:01 2000
@@ -857,7 +857,7 @@
 		v.blue.offset = 0;
 #endif
 		v.red.length = 5;
-		v.green.length = 5;
+		v.green.length = 6;
 		v.blue.length = 5;
 		break;
 #endif
@@ -1390,8 +1390,8 @@
 		    ((green & 0xf800) << 2) | ((blue & 0xf800) >> 3);
 #else
 		rivainfo->con_cmap.cfb16[regno] =
-		    ((red & 0xf800) >> 1) |
-		    ((green & 0xf800) >> 6) | ((blue & 0xf800) >> 11);
+		    ((red & 0xf800) >> 0) |
+		    ((green & 0xf800) >> 5) | ((blue & 0xf800) >> 11);
 #endif
 		break;
 #endif				/* FBCON_HAS_CFB16 */