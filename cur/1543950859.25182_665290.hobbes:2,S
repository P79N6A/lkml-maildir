Date: Sat, 08 Mar 2008 19:16:12 +0100
From: Kay Sievers <>
Subject: Re: [patch] revert "dcdbas: add DMI-based module autloading"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/8/76

On Sat, 2008-03-08 at 09:22 +0100, Ingo Molnar wrote:
> * Frank Sorenson <frank@tuxrocks.com> wrote:
> 
> > -----BEGIN PGP SIGNED MESSAGE-----
> > Hash: SHA1
> > 
> > Frank Sorenson wrote:
> > > I did some additional debugging, and I believe you're correct about it
> > > being specific to my system.  The system seems to run fine until some
> > > time during the boot.  I booted with "init=/bin/sh" (that's how the
> > > system stayed up for 9 minutes), then it died when I tried starting
> > > things up.  I've further narrowed the OOM down to udev (though it's not
> > > entirely udev's fault, since 2.6.24 runs fine).
> > > 
> > > I ran your debug info tool before killing the box by running
> > > /sbin/start_udev.  The output of the tool is at
> > > 
http://tuxrocks.com/tmp/cfs-debug-info-2008.03.06-14.11.24
> > > 
> > > Something is apparently happening between 2.6.24 and 2.6.25-rc[34] which
> > > causes udev (or something it calls) to behave very badly.
> > 
> > Found it.  The culprit is 8f47f0b688bba7642dac4e979896e4692177670b
> >     dcdbas: add DMI-based module autloading
> > 
> >     DMI autoload dcdbas on all Dell systems.
> > 
> >     This looks for BIOS Vendor or System Vendor == Dell, so this should
> >     work for systems both Dell-branded and those Dell builds but brands
> >     for others.  It causes udev to load the dcdbas module at startup,
> >     which is used by tools called by HAL for wireless control and
> >     backlight control, among other uses.
> > 
> > What actually happens is that when udev loads the dcdbas module at 
> > startup, modprobe apparently calls "modprobe dcdbas" itself, repeating 
> > until the system runs out of resources (in this case, it OOMs).
> 
> nice work! I've attached the revert below against latest -git - just in 
> case no-one can think of an obvious fix to this bug.
Frank, can you grep for 'dcdbas' in the modprobe config files:
  modprobe -c | grep dcdbas
?
I wonder what's going on here, that modprobe calls itself.
Thanks,
Kay