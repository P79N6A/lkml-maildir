Date: Thu, 15 May 2008 09:44:37 +0200
From: "Francis Moreau" <>
Subject: Re: How to avoid data copies in a driver ?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/5/15/46

On Wed, May 14, 2008 at 10:02 PM, Lennart Sorensen
<lsorense@csclub.uwaterloo.ca> wrote:
> On Wed, May 14, 2008 at 09:54:03PM +0200, Francis Moreau wrote:
>> Hello,
>>
>> I'd like to optimize my driver, which receives data through a fifo and gives
>> them to a user space application. In turns this application moves this data
>> into a file.
>>
>> To avoid several useless copies, I'd like the application to pass to the driver
>> a  file descriptor (?) to  the driver and then the driver can directly move the
>> received data to that file.
>>
>> Could anybody give me some example of such scheme ?
>
> If the application memory mapped the file, would it be able to simply
> pass a pointer to that mapped file as part of the call to the driver and
> the driver would place the data directly at the requested location which
> would then be directly to the file?
>
So I would need to map this pointer into the kernel space, then fill it, take
care of cache coherency, unmap the kernel pointer.
Do you have any example of that in the kernel tree ?
BTW, data are received in interrupt context. Is it safe to put them in mapped
memory  (can I have page fault ?) in this context ?
Thanks
-- 
Francis