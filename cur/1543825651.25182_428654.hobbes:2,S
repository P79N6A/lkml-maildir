Date: Wed, 31 May 2006 15:41:25 +0200
From: Jens Axboe <>
Subject: Re: [rfc][patch] remove racy sync_page?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/31/103

On Wed, May 31 2006, Nick Piggin wrote:
> Now having a mechanism for a task to batch up requests might be a
> good idea. Eg.
> 
> plug();
> submit reads
> unplug();
> wait for page
How's this different from what we have now? The plugging will happen
implicitly, if we need to. If the queue is already running, chances are
that there are requests there so you won't get to your first read first
anyways.
The unplug(); wait_for_page(); is already required unless you want to
wait for the plugging to time out (unlikely, since you are now waiting
for io completion on one of them).
> I'd think this would give us the benefits of corse grained (per-queue)
> plugging and more (e.g. it works when the request queue isn't empty).
> And it would be simpler because the unplug point is explicit and doesn't
> need to be kicked by lock_page or wait_on_page
I kind of like having the implicit unplug, for several reasons. One is
that people forget to unplug. We had all sorts of hangs there in 2.4 and
earlier because of that. Making the plugging implicit should help that
though. The other is that I don't see what the explicit unplug gains
you. Once you start waiting for one of the pages submitted, that is
exactly the point where you want to unplug in the first place.
-- 
Jens Axboe
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/