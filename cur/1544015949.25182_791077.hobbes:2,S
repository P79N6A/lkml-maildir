Date: Tue, 13 Jan 2009 02:29:37 +0100
From: Ingo Molnar <>
Subject: Re: [PATCH] ring_buffer: NUMA aware page allocations
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/12/646

* Eric Dumazet <dada1@cosmosbay.com> wrote:
> Hi Robert & Steven
> 
> While browsing oprofile code in current tree, I discovered 
> drivers/oprofile/cpu_buffer.c was using new ring_buffer code.
> 
> Apparently we lost in the conversion NUMA allocations, unless
> I am mistaken, since rb_allocate_pages() uses plain
> __get_free_page(GFP_KERNEL) calls to allocate pages.
> 
> All "buffer_page" structs are allocated with kzalloc_node(),
> but not the pages themselves.
> 
> Thank you
> 
> [PATCH] ring_buffer: NUMA aware page allocations
> 
> rb_allocate_pages() & ring_buffer_resize() should use alloc_pages_node()
> instead of __get_free_page() to allocate pages.
nice improvement!
	Ingo