Date: Tue, 7 Dec 2004 10:14:27 +0100
From: Per Jessen <>
Subject: Re: 2.4.28 - kswapd excessive cpu usage under heavy IO
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/12/7/28

Marcelo Tosatti wrote:
> What is your workload? Except the massive amount of inode's/dentries in your
> system do you have anonymous memory hungry applications running?
Nope, workload is typically 6-7, with probably named being the most memory-hungry. 
> If you do have a significant amount of anonymous pages on your system you
> might want to try 2.4.29-pre1 which contains a VM change which should decrease
> their impact on the VM page freeing efforts (including kswapd CPU usage).
> 
> Since you have massive amount of inodes/dentries you might want to tweak
> /proc/sys/vm/vm_vfs_scan_ratio (increase from 6 to 10 and so on...)
OK, will try that.
>>A find in a directory containing perhaps 6-700,000 files makes the box almost
>> grind to a halt.  In 12days uptime, kswap has used 590:43.82, and during the
>> find-exercise usually runs with 90-100% util.
> 
> Can you boot with profile=2 and use readprofile tool to read the functions
> which are using most CPU time with
> 
> readprofile | sort -nr +2 | head -20
> Do that on a 2.4.28 and 2.4.29-pre1 kernels.
Will be difficult - I'll keep this in mind, but a reboot is not possible at the moment.
Many thanks for getting back to me - much appreciated!  
-- 
Per Jessen, Zurich
http://www.spamcek.com
 - let your spam stop here.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/