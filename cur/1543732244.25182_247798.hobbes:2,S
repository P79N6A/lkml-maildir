Date: Wed, 1 Sep 2004 22:51:00 +1000
From: Anton Blanchard <>
Subject: [PATCH] [ppc64] Print backtrace in EEH code
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/1/121

Hi,
We should print a stack backtrace when we get EEH errors, it makes
debugging the cause of the fail easier.
Anton
Signed-off-by: Anton Blanchard <anton@samba.org>
===== eeh.c 1.29 vs edited =====
--- 1.29/arch/ppc64/kernel/eeh.c	Mon Aug 23 18:14:40 2004
+++ edited/eeh.c	Mon Aug 30 09:02:41 2004
@@ -447,6 +447,10 @@
 
 		spin_unlock_irqrestore(&slot_errbuf_lock, flags);
 
+		printk(KERN_ERR "EEH: MMIO failure (%d) on device:%s %s\n",
+		       rets[0], pci_name(dev), pci_pretty_name(dev));
+		WARN_ON(1);
+
 		/*
 		 * XXX We should create a separate sysctl for this.
 		 *
@@ -454,14 +458,11 @@
 		 * the system in light of potential corruption, we
 		 * can use it here.
 		 */
-		if (panic_on_oops) {
+		if (panic_on_oops)
 			panic("EEH: MMIO failure (%d) on device:%s %s\n",
 			      rets[0], pci_name(dev), pci_pretty_name(dev));
-		} else {
+		else
 			__get_cpu_var(ignored_failures)++;
-			printk(KERN_INFO "EEH: MMIO failure (%d) on device:%s %s\n",
-			       rets[0], pci_name(dev), pci_pretty_name(dev));
-		}
 	} else {
 		__get_cpu_var(false_positives)++;
 	}
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/