Date: Tue, 11 May 1999 15:45:58 -0700 (PDT)
From: root <>
Subject: Problems with knfsd-1.[23] and NFSv3-0.9.3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/5/12/3

Hi,
I running kernel 2.2.7 (upgraded RH5.2) with the patches provided by Trond 
Myklebust (
http://www.fys.uio.no/~trondmy/src/
) with very good results for 
client-side nfs.
My problems are with kernel NFS server.  Is it correct that the nsfd-2.2.7-1 
patch from knfsd-1.3 is required for the kernel nfs server to function 
correctly?  It turns out that both H. J. Lu's patch and Trond's patch fiddle 
with the file fs/nfs/dir.c.  In particular, the exact diff in 
nfsd-2.2.7-1.patch:
diff -upr --new-file ../../../import/kernel/linux/fs/nfs/dir.c linux/fs/nfs/dir.c
 	if (old_dentry->d_count > 1) {
 		nfs_wb_all(old_inode);
-		shrink_dcache_parent(old_dentry);
+/*		shrink_dcache_parent(old_dentry); FIXME */
 	}
+	goto do_rename;
 
Since the label 'do_rename' is removed by Trond's patches, the kernel won't
compile with both sets of patches installed.  
So my questions are:
1)  is the nfsd-2.2.7-1 patch required for a linux-2.2.7 system that is
    expected to serve NFS volumes to a cluster of computers running 
    a mixture of solaris/sunos/linux-2.0/linux-2.2?
2)  if (1) is required, has anyone managed to get the patch applied 
    (and working) simultaneously with the NFSv3 client patches?  (0.9.3)?
3)  Are there other critical patches that I'm missing?  
I've actually been running for a few weeks with just Trond's NFSv3 patch
and knfsd-1.2.2.  Client NFS is working beautifully.  I'm seeing problems, 
however, with kernel NFS server.   Many messages are of the form
    kernel: nfsd_create: dentry chauvin/projects not negative!
including an occasional oops in nfsd complaining about dereferencing a 
NULL pointer.  The oops tends to happen with a Solaris2.6 client.  In 
particular, I was copying a large file and interrupted the copy on the
solaris machine by cntrl-C.  (this is with knfsd-1.2.2, NFSv30.9.3,  
but _without_ the nfsd-2.2.7-1 patch).  Sometimes trouble is triggered
by 'rm -rf' on the solaris client.  
Thanks!
Todd Chauvin
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/