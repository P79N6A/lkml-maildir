Date: Sat, 13 Sep 2003 03:02:09 +0200 (CEST)
From: Bernhard Rosenkraenzer <>
Subject: [FIX] Re: 2.4.23-pre3-pac2 broke PIIX ata-scsi
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/12/297

On Fri, 12 Sep 2003, Samuel Flory wrote:
>    So it looks like ATA_PIIX is broken:
> In file included from ata_piix.c:31:
> /stuff/src/linux-2.4.23-pac2/include/linux/ata.h:636: redefinition of 
> `irqreturn_t'
> /stuff/src/linux-2.4.23-pac2/include/linux/interrupt.h:16: `irqreturn_t' 
> previously declared here
Thanks for pointing out two bugs ;)
Since I compiled a fully modular kernel w/ everything enabled to 
verify everything builds, the report indicated another bug -- there was 
no way to build ATA_PIIX with modular SCSI.
The attached patch fixes both.
Since this is probably the first version of ATA_PIIX that does compile 
with modular SCSI, I'd like some feedback on whether or not it actually 
works w/ modular SCSI (I don't have any test hardware).
The patch will be in pre4-pac1, which I'm expecting to release tomorrow or 
Sunday.
LLaP
bero
-- 
Ark Linux - Linux for the masses
http://www.arklinux.org/
Redistribution and processing of this message is subject to
http://www.arklinux.org/terms.php
diff -urN linux-2.4.23-pre3-pac2/drivers/scsi/Config.in linux-2.4.23-pre3-pac3/drivers/scsi/Config.in
--- linux-2.4.23-pre3-pac2/drivers/scsi/Config.in	2003-09-13 02:35:08.000000000 +0200
+++ linux-2.4.23-pre3-pac3/drivers/scsi/Config.in	2003-09-13 02:41:35.000000000 +0200
@@ -71,7 +71,7 @@
    dep_tristate 'AMI MegaRAID support (new driver)' CONFIG_SCSI_MEGARAID2 $CONFIG_SCSI
 fi
 
-dep_bool 'SATA support' CONFIG_SCSI_ATA $CONFIG_SCSI
+dep_tristate 'SATA support' CONFIG_SCSI_ATA $CONFIG_SCSI
 #dep_bool '  Parallel ATA support' CONFIG_SCSI_ATA_PATA $CONFIG_SCSI_ATA
 dep_tristate '  Intel PIIX/ICH support' CONFIG_SCSI_ATA_PIIX $CONFIG_SCSI_ATA $CONFIG_PCI
 dep_tristate '  VIA SATA support' CONFIG_SCSI_SATA_VIA $CONFIG_SCSI_ATA $CONFIG_PCI
diff -urN linux-2.4.23-pre3-pac2/include/linux/ata.h linux-2.4.23-pre3-pac3/include/linux/ata.h
--- linux-2.4.23-pre3-pac2/include/linux/ata.h	2003-09-13 02:35:11.000000000 +0200
+++ linux-2.4.23-pre3-pac3/include/linux/ata.h	2003-09-13 02:41:51.000000000 +0200
@@ -629,13 +629,6 @@
 	return status;
 }
 
-/*
- * 2.5 compat.
- */
-
-typedef void irqreturn_t;
-#define IRQ_RETVAL(x)	/* nothing */
-
 #define REPORT_LUNS		0xa0
 #define READ_16			0x88
 #define WRITE_16		0x8a