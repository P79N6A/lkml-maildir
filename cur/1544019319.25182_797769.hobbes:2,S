Date: Wed, 28 Jan 2009 12:05:21 +0100
From: Zdenek Kabelac <>
Subject: Re: 2.6.29-rc1 does not resume on Lenove T61
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/28/95

2009/1/22 Rafael J. Wysocki <rjw@sisk.pl>:
> On Thursday 22 January 2009, Zdenek Kabelac wrote:
>> 2009/1/20 Ingo Molnar <mingo@elte.hu>:
>> >
>> > (Cc:-ed Johannes Berg)
>> >
>> > * Zdenek Kabelac <zdenek.kabelac@gmail.com> wrote:
>> >
>> >> With network enabled - the error is back - thus it might be a bug in
>> >> ieee80211 stack ??
>> >
>> > yes, the crash implicates the ieee80211 stack [ieee80211_stop() in
>> > net/mac80211/iface.c]:
>> >
>> Btw - I've tried your branch   tip-latest
>> (52a4061e1d88ad242c8022f68df3686c3bc05159)
>>  - and this branch now resets my machine during resume. (it suspends -
>> auto-wake-up and reboots)
>>  - so it this branch actually suggested to be used/tested ?
>
> Apparently, it's missing the patch from
> 
http://bugzilla.kernel.org/show_bug.cgi?id=12399
Ok - I could confirm that  kernel commit
e4a7ca29039e615ce13a61b9c6abfb2aa394e9a1 does work properly with
suspend/resume sequence - i.e. no auto-wakeup and no ugly  gpf Ooops
could be seen - at least not for now :)
Here is just one warning I could see in my dmesg  now:
pci 0000:15:00.0: suspend
pci 0000:15:00.0: PCI INT A disabled
iwl3945 0000:03:00.0: suspend
------------[ cut here ]------------
WARNING: at drivers/pci/pci-driver.c:368 pci_legacy_suspend+0xdd/0xf0()
Hardware name: 6464CTO
Modules linked in: ipt_MASQUERADE iptable_nat nf_nat nf_conntrack_ipv4
nf_defrag_ipv4 xt_state nf_conntrack ipt_RE
JECT xt_tcpudp iptable_filter ip_tables x_tables bridge stp llc sco
l2cap bluetooth autofs4 sunrpc ipv6 binfmt_misc loop dm_mirro
r dm_region_hash dm_log dm_mod kvm_intel kvm i915 drm i2c_algo_bit
uinput snd_hda_codec_analog snd_hda_intel snd_hda_codec arc4 e
cb snd_seq_oss snd_seq_midi_event cryptomgr snd_seq aead
snd_seq_device snd_pcm_oss snd_mixer_oss snd_pcm usbhid evdev
crypto_blk
cipher sdhci_pci snd_timer crypto_hash rtc_cmos sdhci mmc_core hid snd
crypto_algapi iwl3945 mac80211 psmouse rtc_core button sou
ndcore thinkpad_acpi rfkill backlight nvram led_class sr_mod rtc_lib
i2c_i801 i2c_core snd_page_alloc iTCO_wdt iTCO_vendor_suppor
t lib80211 serio_raw e1000e cfg80211 intel_agp battery ac cdrom
uhci_hcd ohci_hcd ehci_hcd usbcore [last unloaded: microcode]
Pid: 2754, comm: pm-suspend Not tainted 2.6.29-rc2 #23
Call Trace:
 [<ffffffff802472ef>] warn_slowpath+0xaf/0x110
 [<ffffffff80252e60>] ? process_timeout+0x0/0x10
 [<ffffffff80553227>] ? schedule_timeout+0x77/0xf0
 [<ffffffff803bed65>] ? pci_bus_write_config_word+0x75/0x90
 [<ffffffff805532be>] ? schedule_timeout_uninterruptible+0x1e/0x20
 [<ffffffff803c2d7e>] ? pci_raw_set_power_state+0x15e/0x240
 [<ffffffff803c2f07>] ? pci_set_power_state+0xa7/0x180
 [<ffffffff803c5f1d>] pci_legacy_suspend+0xdd/0xf0
 [<ffffffff803c60d5>] pci_pm_suspend+0xa5/0xb0
 [<ffffffff804531c2>] pm_op+0x162/0x1b0
 [<ffffffff80453acf>] device_suspend+0x47f/0x630
 [<ffffffff802820d7>] suspend_devices_and_enter+0x47/0x1c0
 [<ffffffff802823e6>] enter_state+0x166/0x1e0
 [<ffffffff8028251a>] state_store+0xba/0x100
 [<ffffffff803b0077>] kobj_attr_store+0x17/0x20
 [<ffffffff803414cf>] sysfs_write_file+0xcf/0x140
 [<ffffffff802e4e1b>] vfs_write+0xcb/0x190
 [<ffffffff802e4fe5>] sys_write+0x55/0x90
 [<ffffffff8020c70b>] system_call_fastpath+0x16/0x1b
---[ end trace 5626061031e81c26 ]---
i801_smbus 0000:00:1f.3: suspend
ahci 0000:00:1f.2: suspend
Zdenek