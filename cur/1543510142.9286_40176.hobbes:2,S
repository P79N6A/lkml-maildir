Date: Tue, 21 Sep 1999 20:27:05 +0200
From: Andreas Tobler <>
Subject: Re: strange mounting problem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/9/21/152

Guest section DW wrote:
....
> In your case this fails.
> You may check, just to be sure, that the kernel indeed sees
> the disk as removable. (It will say so in the boot messages.)
> Next, you may check in check_scsidisk_media_change() what
> the return status is of this SCSI_IOCTL_START_UNIT command.
> Just curiosity.
> 
Ha, you're right, the kernel doesn't see the HP as removable, only the
sony is detected as a removable. (/var/log/dmesg)
 
> I seem to recall that you mentioned that this disk was SCSI-1
> and that things are fine for SCSI-2 compliant drives.
> 
Yes.
> Now that this fails in your case, apparently because it expects
> SCSI-2 behaviour, one may try to force things.
> The ioctl BLKRRPART will do revalidate_scsidisk() which does
> the required invalidate_*().
> 
> So, you might try the (of course untested) eject program below.
This is somewhat Alan suggested to me. So I inserted the ioctl(fd,
BLKFLSBUF) directly into the eject code from Jeff Tranter. This works so
far. I have to test it and also your piece of code.
Also I got a feeling on how to send SCSI- commands to a device. (During
this investigations)
I feel now more able to try out things in this direction.
Thanks a lot for all your hints
Andreas
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/