Date: Thu, 15 Mar 2001 20:58:19 +0100
From: Manfred Spraul <>
Subject: Re: Performance is weird (fwd)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/3/15/77

I've attached a patch.
I tried to trigger the problem with my 10 MBit ne2k-pci connection, but
without success.
Could you try it?
I've tested it with -ac17, and it applies to 2.4.2 cleanly.
--
	Manfred--- 2.4/arch/i386/kernel/process.c	Thu Feb 22 22:28:52 2001
+++ build-2.4/arch/i386/kernel/process.c	Thu Mar 15 20:35:12 2001
@@ -81,6 +81,11 @@
 {
 	if (current_cpu_data.hlt_works_ok && !hlt_counter) {
 		__cli();
+		if (softirq_active(smp_processor_id()) & softirq_mask(smp_processor_id())) {
+			__sti();
+			do_softirq();
+			return;
+		}
 		if (!current->need_resched)
 			safe_halt();
 		else