Date: Wed, 30 Jan 2008 16:25:36 +0100
From: michael <>
Subject: Re: [PATCH -mm v4 6/9] atmel_serial: Split the interrupt handler
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/30/276

Hi,
> A few questions arise here to me:
> * What serial port is used here? (DBGU, or something else)
> * No DMA was used, was flow-control enabled? (cannot with DBGU)
> * If some other UART, why not using DMA?
>
> 
DBGU, so no flow control
> Notice that the DBGU has no flow control, and just a 1 byte FIFO (thus
> no fifo at all).
> At high speeds (e.g. >=115200) it is _likely_ that you will miss
> characters, nothing can prevent that. DBGU should only be used at
> lower speeds, or just as text console. 115200 is running fine here as
> text-console.
> 
Overrun are admitted using DBGU and UART1..n without flow control,
but with the old version of the driver I can send a file using lrz
and with the new and full preemption is impossible.
> I would not expect that the behaviour is worse than without the
> patchset, because without it it does not work at all on Preempt-RT,
> but also: there was done much more in interrupt context previously, so
> the chance of buffer overruns was much more likely in the old
> situation.
> The real interrupt handler (doing the reading from the fifo) must be
> as short as possible, to be able to keep up with the data flow.
>
> A simple calculation: 115200bps results in approx. 11520 bytes per second.
> This means that the interrupt handler must be capable of handling each
> byte on DBGU within 87us. With a worst case interrupt latency of about
> 85us, and average between 2us and 54us (on Preempt-RT and AT91RM9200),
> you can simply understand that this will not match, how good/fast the
> interrupt handling will ever be.
>
> So, I suggest to either use flow-control, or DMA for bulkdata... (thus not DBGU)
>
> Kind Regards,
>
> Remy
>
> 