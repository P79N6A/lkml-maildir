Date: Wed, 15 Mar 2000 11:02:57 -0500 (EST)
From: Tim Waugh <>
Subject: Re: parport_pc in linux-2.3.99-pre1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/16/25

On Thu, 16 Mar 2000, Keith Owens wrote:
> As it should be until the parport_pc cleanup routine returns.  You
> need to find out why the cleanup routine is not existing correctly.  
> It is almost certainly a parport problem.
Ah, found it.  Linus, please apply this.
Tim.
*/
Index: linux/drivers/parport/ChangeLog
diff -u linux/drivers/parport/ChangeLog:1.1.1.2 linux/drivers/parport/ChangeLog:1.5
--- linux/drivers/parport/ChangeLog:1.1.1.2	Wed Mar 15 08:56:11 2000
+++ linux/drivers/parport/ChangeLog	Wed Mar 15 16:00:24 2000
@@ -1,3 +1,8 @@
+2000-03-15  Tim Waugh  <twaugh@redhat.com>
+
+	* parport_pc.c (cleanup_module): Don't call pci_unregister_driver
+	if we didn't call pci_register_driver first.
+
 2000-03-13    <twaugh@redhat.com>
 
 	* parport_pc.c (parport_pc_init): Moved from asm/parport.h.
Index: linux/drivers/parport/parport_pc.c
diff -u linux/drivers/parport/parport_pc.c:1.1.1.24 linux/drivers/parport/parport_pc.c:1.41
--- linux/drivers/parport/parport_pc.c:1.1.1.24	Wed Mar 15 08:56:11 2000
+++ linux/drivers/parport/parport_pc.c	Wed Mar 15 15:51:32 2000
@@ -2487,7 +2487,10 @@
 void cleanup_module(void)
 {
 	struct parport *p = parport_enumerate(), *tmp;
-	pci_unregister_driver (&parport_pc_pci_driver);
+
+	if (!user_specified)
+		pci_unregister_driver (&parport_pc_pci_driver);
+
 	while (p) {
 		tmp = p->next;
 		if (p->modes & PARPORT_MODE_PCSPP) { 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/