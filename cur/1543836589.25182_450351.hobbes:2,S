Date: Fri, 04 Aug 2006 14:47:08 -0700
From: Dave Hansen <>
Subject: Re: [PATCH 06/28] reintroduce list of vfsmounts over superblock
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/8/4/321

On Thu, 2006-08-03 at 15:39 +0100, Christoph Hellwig wrote:
> On Tue, Aug 01, 2006 at 04:52:44PM -0700, Dave Hansen wrote:
> > 
> > We're moving a big chunk of the burden of keeping people from
> > writing to r/o filesystems from the superblock into the
> > vfsmount.  This requires that we consult the superblock's
> > vfsmounts when things like remounts occur.
> > 
> > So, introduce a list of vfsmounts hanging off the superblock.
> > We'll use this in a bit.
> 
> I don't think we'll need it.  We really need to keep is someone writing
> to this vfsmount counters in addition to is someone writing to this sb.
This one was a direct request from Al:
http://article.gmane.org/gmane.linux.kernel/421029
> BTW, it might be worth doing the following:
> 	* reintroduce the list of vfsmounts over given superblock (protected
> by vfsmount_lock)
...
So, I assume that there are some evil plans in the future for this as
well.
> In fact there are cases were we want a superblock to be writeable to
> without any view into it being writeable, e.g. for journal recovery.
Note that, as it stands now, the vfsmount has a flag which duplicates
the superblock r/o flag.  It is perfectly fine to do that journal
recovery by making the superblock r/w, but without telling any of the
mounts about it.  All of the write requests will get blocked by the
mount flag, and no one will ever see that the superblock changed state.
-- Dave
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/