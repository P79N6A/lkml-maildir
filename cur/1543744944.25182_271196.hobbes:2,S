Date: Mon, 15 Nov 2004 14:51:39 -0600
From: Robin Holt <>
Subject: Re: 21 million inodes is causing severe pauses.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/11/15/154

On Mon, Nov 15, 2004 at 09:35:35PM +0100, Norbert van Nobelen wrote:
> It would help a lot if you provided logins to everybody on this list to this 
> desktop system of you (-:
That would not be possible.  The setup is not that uniq. It is basically
a SLES9 system with 4 300GB filesystem locally mounted and a large number
of autofs mounted home directories etc.  I can provide diagnostic counters
if they will be helpful.
> 
> Anyway: There is temporary solution, which will help a little in this case: 
> Increase the blocksize so that your total number of inodes decreases. Since 
> XFS is your own filesystem, you could calculate the results of this pretty 
> quick.
The problem is not isolated to XFS.  Even with smaller blocksizes, we
still have a large number of files being referenced which will result
in many inodes.  We saw the same behavior with ext2/3 and NFS.  I don't
think it has anything to do with XFS.
> 
> Using another filesystem could help too, but I don't have any comparison bases 
> for this since the largest system we have here at this moment only has 1 TB 
> of diskspace.
You should have enough disk space.  You will need a lot of memory as
well.  You will also need a workload which puts some memory pressure on
periodically, but not that much pressure and not that often.  This appears
to make the vm favor buffer cache to slab cache and allow the inode
cache to grow really large.
Thanks,
Robin Holt
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/