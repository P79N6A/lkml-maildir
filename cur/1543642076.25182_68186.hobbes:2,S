Date: Wed, 4 Sep 2002 11:23:47 +0300 (EEST)
From: Panu Matilainen <>
Subject: 32bit UID wraps around with smbfs
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/9/4/27

Hi,
Smbfs has problems with 32bit UID/GID's: when you do
'smbmount //some/share /mnt/samba -o uid=100000' the mountpoint UID (and 
GID) wrap around at 65535.
The attached patch, along with samba recompile against fixed headers
apparently fixes it. This problem is present at least in all 2.4 kernels,
I haven't looked at 2.5.
	- Panu -
--- linux/include/linux/smb_mount.h.uid32	Thu Aug 29 17:37:40 2002
+++ linux/include/linux/smb_mount.h	Thu Aug 29 17:39:34 2002
@@ -15,9 +15,9 @@
 
 struct smb_mount_data {
 	int version;
-	__kernel_uid_t mounted_uid; /* Who may umount() this filesystem? */
-	__kernel_uid_t uid;
-	__kernel_gid_t gid;
+	__kernel_uid32_t mounted_uid; /* Who may umount() this filesystem? */
+	__kernel_uid32_t uid;
+	__kernel_gid32_t gid;
 	__kernel_mode_t file_mode;
 	__kernel_mode_t dir_mode;
 };
@@ -42,9 +42,9 @@
 struct smb_mount_data_kernel {
 	int version;
 
-	__kernel_uid_t mounted_uid;	/* Who may umount() this filesystem? */
-	__kernel_uid_t uid;
-	__kernel_gid_t gid;
+	__kernel_uid32_t mounted_uid;	/* Who may umount() this filesystem? */
+	__kernel_uid32_t uid;
+	__kernel_gid32_t gid;
 	__kernel_mode_t file_mode;
 	__kernel_mode_t dir_mode;
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/