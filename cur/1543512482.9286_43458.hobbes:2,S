Date: Mon, 11 Oct 1999 09:50:59 +0300 (EEST)
From: Vladimir Chernyshov <>
Subject: [PATCH] _isofs_bmap warning and readahead cache in 2.3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/10/11/10

Hi
The readahead cache in development kernels often tries to get
additional blocks from block device without checking for the next block
to be inside file boundary. This cause annoying messages when reading
file from filesystem, that make additional checking itself.
Like this:
Oct  7 17:04:05 greengrass kernel: _isofs_bmap: block >= EOF (4, 5542) 
Oct  7 17:04:05 greengrass kernel: _isofs_bmap: block >= EOF (5, 5542) 
Oct  7 17:04:05 greengrass kernel: _isofs_bmap: block >= EOF (6, 5542) 
Oct  7 17:04:05 greengrass kernel: _isofs_bmap: block >= EOF (7, 5542) 
Seems, the check has been removed from mm/filemap.c some time ago.
Is it a bug or a feature?
If it's a bug, here's a patch...
Vladimir
P.S. Please CC replies to me.
--- linux/mm/filemap.c.orig	Mon Sep 27 18:42:24 1999
+++ linux/mm/filemap.c	Fri Oct  8 00:10:34 1999
@@ -534,8 +534,13 @@
 {
 	unsigned long new_page;
 	struct inode *inode = file->f_dentry->d_inode;
-	struct page ** hash = page_hash(inode, offset);
-	struct page * page; 
+	struct page ** hash;
+	struct page * page;
+
+	if (offset >= inode->i_size)
+		return;
+
+	hash = page_hash(inode, offset);
 
 	spin_lock(&pagecache_lock);
 	page = __find_page_nolock(inode, offset, *hash); 