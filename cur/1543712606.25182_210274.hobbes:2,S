Date: Mon, 29 Mar 2004 15:31:17 -0800
From: Andrew Morton <>
Subject: Re: Unregistering interfaces
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/3/29/273

Greg KH <greg@kroah.com> wrote:
>
> > The module should remain in memory, "unhashed", until the final kobject
> > reference falls to zero.  Destruction of that kobject causes the refcount
> > on the module to fall to zero which causes the entire module to be
> > released.
> > 
> > (hmm, the existence of a kobject doesn't appear to contribute to its
> > module's refcount.  Why not?)
> 
> It does, if a file for that kobject is opened.  In this case, there was
> no file opened, so the module refcount isn't incremented.
hm, surprised.  Shouldn't the existence of a kobject contribute to its
module's refcount?
> > Maybe a shrink_dcache_parent(dentry) on entry to simple_rmdir() would
> > suffice?
> 
> Will that get rid of the references properly nwhen we remove the
> kobject?
That's one the dcache guys could address better, but I was mainly proposing
it as a way of removing any negative dentries.  But it appears that we have
problems beyond negative dentries?
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/