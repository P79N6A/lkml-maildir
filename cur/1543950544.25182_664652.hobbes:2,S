Date: Thu, 6 Mar 2008 12:51:53 -0800
From: Andrew Morton <>
Subject: Re: 2.6.25-rc3-git3: Reported regressions from 2.6.24
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/6/381

On Thu, 6 Mar 2008 12:11:27 -0800
Andrew Morton <akpm@linux-foundation.org> wrote:
> Reminder: what _does_ fix it is:
> 
> a) CONFIG_DETECT_SOFTLOCKUP=n or
> 
> b) This:
> 
> --- a/kernel/softlockup.c~softlockup-workaround
> +++ a/kernel/softlockup.c
> @@ -289,6 +289,7 @@ cpu_callback(struct notifier_block *nfb,
>  	case CPU_DEAD_FROZEN:
>  		p = per_cpu(watchdog_task, hotcpu);
>  		per_cpu(watchdog_task, hotcpu) = NULL;
> +		msleep(1);
>  		kthread_stop(p);
>  		break;
>  #endif /* CONFIG_HOTPLUG_CPU */
sysrq-t works: 
http://userweb.kernel.org/~akpm/x.txt
It shows that `halt' is stuck in kthread_stop(), waiting for `watchdog' to
go away.  But all the watchdog tasks are dreamily asleep, as if the wakeup
didn't work.
I'd love to poke around in kgdb (what does kthread_stop_info.k point at?)
but it seems that -mm's copy of kgdb got taken away when I wasn't looking. 
Can I have it back please?
(btw, it isn't compulsory that every cpu callback function be literally
called "cpu_callback").