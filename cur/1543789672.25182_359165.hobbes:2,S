Date: Wed, 19 Oct 2005 19:20:43 +0200
From: "Jiri Slaby" <>
Subject: Re: [PATCH] ppc32: ppc_sys fixes for 8xx and 82xx
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/10/19/160

>This patch fixes a numbers of issues regarding to that both 8xx and 82xx
>began to use ppc_sys model:
>	- Platform is now identified by default deviceless SOC, if no
>BOARD_CHIP_NAME is specified in the bard-specific header. For the list
>of supported names refer to (arch/ppc/syslib/) mpc8xx_sys.c and
>mpc82xx_sys.c for 8xx and 82xx respectively.
>	- Fixed a bug in identification by name - if the name was not found, it
>returned -1 instead of default deviceless ppc_spec.
>	- fixed devices amount in the 8xx platform system descriptions
>
>
>Signed-off-by: Vitaly Bordug <vbordug@ru.mvista.com>
>Signed-off-by: Marcelo Tosatti <marcelo.tosatti@cyclades.com>
>Signed-off-by: Kumar Gala <kumar.gala@freescale.com>
>-- 
>Sincerely,
>Vitaly
>
>
>diff --git a/arch/ppc/platforms/fads.h b/arch/ppc/platforms/fads.h
>--- a/arch/ppc/platforms/fads.h
>+++ b/arch/ppc/platforms/fads.h
>@@ -25,6 +25,8 @@
> 
> #if defined(CONFIG_MPC86XADS)
> 
>+#define BOARD_CHIP_NAME "MPC86X"
>+
> /* U-Boot maps BCSR to 0xff080000 */
> #define BCSR_ADDR		((uint)0xff080000)
> 
>diff --git a/arch/ppc/platforms/mpc885ads.h b/arch/ppc/platforms/mpc885ads.h
>--- a/arch/ppc/platforms/mpc885ads.h
>+++ b/arch/ppc/platforms/mpc885ads.h
>@@ -88,5 +88,7 @@
> #define SICR_ENET_MASK	((uint)0x00ff0000)
> #define SICR_ENET_CLKRT	((uint)0x002c0000)
> 
>+#define BOARD_CHIP_NAME "MPC885"
>+
> #endif /* __ASM_MPC885ADS_H__ */
> #endif /* __KERNEL__ */
>diff --git a/arch/ppc/syslib/m8260_setup.c b/arch/ppc/syslib/m8260_setup.c
>--- a/arch/ppc/syslib/m8260_setup.c
>+++ b/arch/ppc/syslib/m8260_setup.c
>@@ -62,6 +62,9 @@ m8260_setup_arch(void)
> 	if (initrd_start)
> 		ROOT_DEV = Root_RAM0;
> #endif
>+	
>+	identify_ppc_sys_by_name_and_id(BOARD_CHIP_NAME, in_be32(CPM_MAP_ADDR + CPM_IMMR_OFFSET));
80 columns at most on a line, please.
>+	
Whitespace weevils.
> 	m82xx_board_setup();
> }
> 
>diff --git a/arch/ppc/syslib/m8xx_setup.c b/arch/ppc/syslib/m8xx_setup.c
>--- a/arch/ppc/syslib/m8xx_setup.c
>+++ b/arch/ppc/syslib/m8xx_setup.c
>@@ -403,7 +403,9 @@ platform_init(unsigned long r3, unsigned
> 		*(char *)(r7+KERNELBASE) = 0;
> 		strcpy(cmd_line, (char *)(r6+KERNELBASE));
> 	}
>-
>+	
>+	identify_ppc_sys_by_name(BOARD_CHIP_NAME);
>+	
Whitespace.
regards,
--
Jiri Slaby         www.fi.muni.cz/~xslaby
~\-/~      jirislaby@gmail.com      ~\-/~
B67499670407CE62ACC8 22A032CC55C339D47A7E
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/