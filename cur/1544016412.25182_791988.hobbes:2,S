Date: Wed, 14 Jan 2009 15:08:04 +0100
From: Jens Axboe <>
Subject: Re: ext2 + -osync: not as easy as it seems
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/14/229

On Wed, Jan 14 2009, Jan Kara wrote:
> > I'm not sure what you mean; if the barrier operation isn't flushing
> > all of the caches all the way out to the iron oxide, it's not going to
> > be working properly no matter where it is being called, whether it's
> > in ext4_sync_file() or in jbd2's journal_submit_commit_record().
>   Well, I thought that a barrier, as an abstraction, only guarantees that
> any IO which happened before the barrier hits the iron before any IO which
> has been submitted after a barrier. This is actually enough for a
> journalling to work correctly but it's not enough for fsync() guarantees.
> But I might be wrong...
It also guarentees that when you get a completion for that barrier
write, it's on safe storage. Think of it as a flush-write-flush
operation, in the presence of write back caching.
-- 
Jens Axboe