Date: Fri, 25 Jan 2008 12:38:08 -0800 (PST)
From: Roland McGrath <>
Subject: Re: [PATCH x86/mm] x86: i387 fpregs_set convert_to_fxsr
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/25/498

> On Thu, Jan 24, 2008 at 05:59:33PM -0800, Roland McGrath wrote:
> > +	if (pos > 0 || count < sizeof(env))
> > +		convert_from_fxsr(&env, target);
> 
> Well, is the generic regset code enforce the need for this now? Can we
> disallow the usage cases where the user passes smaller target buffer
> size or requests data from in between. We were disallowing such usage
> scenarios before, isn't it?
It's true that there was before no way to touch only part of the FPU state
via ptrace.  The user_regset interface genericizes access to every regset
to permit partial access, subject to the size and align fields.  Access to
some part of the data is certainly of use for some regsets, like the
general registers and TLS, which always have exposed means to touch just
one chunk (e.g. PTRACE_POKEUSR, PTRACE_SET_THREAD_AREA).  It's a very
worthwhile thing that we have a uniform interface for all the regsets,
so I certainly would not change that.  
It could fit into the user_regset interface as now defined, to set .n = 1,
.size = whole for the FPU regset, so that all partial access is officially
invalid.  But it is easy enough to support partial access in fact, and for
the common case (xfpregs) there is no overhead or complexity to it at all.
Some new user of the user_regset interfaces very well might have a use for
fetching or touching just one FP register, so why rule it out a priori?
Thanks,
Roland