Date: Tue, 27 Jan 2009 19:48:00 +0100
From: "Henrik Rydberg" <>
Subject: [PATCH] include/linux/mod_devicetable.h: fix compilation problem induced by MODULE_DEVICE_TABLE(dmi, ...)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/27/271

From: Alexey Dobriyan <adobriyan@gmail.com>
Bugzilla 12483:
Kernel build fails with gcc3 (not gcc4), because
MODULE_DEVICE_TABLE(dmi, ...) expands to extern const struct
dmi_device_id __mod_dmi_device_table, and struct dmi_device_id doesn't
exist.
Steps to reproduce:
Build kernel 2.6.28 or 2.6.29-rc2 on x86 with gcc 3.
This patch remedies the problem.
Signed-off-by: Henrik Rydberg <rydberg@euromail.se>
---
 include/linux/mod_devicetable.h |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)
diff --git a/include/linux/mod_devicetable.h b/include/linux/mod_devicetable.h
index 97b91d1..aec76e6 100644
--- a/include/linux/mod_devicetable.h
+++ b/include/linux/mod_devicetable.h
@@ -443,6 +443,7 @@ struct dmi_system_id {
 	struct dmi_strmatch matches[4];
 	void *driver_data;
 };
+#define dmi_device_id dmi_system_id
 #endif
 
 #define DMI_MATCH(a, b)	{ a, b }
-- 
1.5.6.3