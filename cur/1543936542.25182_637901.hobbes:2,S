Date: Sun, 13 Jan 2008 19:24:24 -0700
From: Matthew Wilcox <>
Subject: [PATCH] Fix kprobes on ia64
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/13/175

If CONFIG_KPROBES is set, we get the error during build:
kernel/kprobes.c:1057: error: __ksymtab_jprobe_return causes a section
type conflict
This is because ia64 defines a static inline jprobe_return which kprobes
attempts to EXPORT_SYMBOL.
Signed-off-by: Matthew Wilcox <matthew@wil.cx>
diff --git a/kernel/kprobes.c b/kernel/kprobes.c
index e3a5d81..ecc25b3 100644
--- a/kernel/kprobes.c
+++ b/kernel/kprobes.c
@@ -1053,11 +1053,11 @@ EXPORT_SYMBOL_GPL(register_kprobe);
 EXPORT_SYMBOL_GPL(unregister_kprobe);
 EXPORT_SYMBOL_GPL(register_jprobe);
 EXPORT_SYMBOL_GPL(unregister_jprobe);
+
 #ifdef CONFIG_KPROBES
+#ifndef __ia64__ /* It's static inline */
 EXPORT_SYMBOL_GPL(jprobe_return);
 #endif
-
-#ifdef CONFIG_KPROBES
 EXPORT_SYMBOL_GPL(register_kretprobe);
 EXPORT_SYMBOL_GPL(unregister_kretprobe);
 #endif
-- 
Intel are signing my paycheques ... these opinions are still mine
"Bill, look, we understand that you're interested in selling us this
operating system, but compare it to ours.  We can't possibly take such
a retrograde step."