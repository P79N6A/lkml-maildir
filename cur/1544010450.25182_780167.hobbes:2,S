Date: Sat, 13 Dec 2008 20:25:05 +1030
From: Rusty Russell <>
Subject: Re: [PATCH 1/1] cpumask: force nr_cpumask_bit to NR_CPUS for CPUMASK_OFFSTACK=n
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/13/36

On Friday 12 December 2008 07:14:09 Mike Travis wrote:
> Re: cpumask conversions, or not?
> 
> Rusty Russell wrote:
> > On Tuesday 09 December 2008 21:26:36 Mike Travis wrote:
> >> Rusty Russell wrote:
> >>> Hi all,
> >>>
> >>>    The new cpumask conversions are going well, but unfortunately Stephen
> >>> uncovered a nasty bug via linux-next: the new cpumask operators only go to
> >>> nr_cpumask_bits which can be less than NR_CPUS if NR_CPUS > BITS_PER_LONG.
> >>> The undefined bits confuse the old cpumask operators.  We fixed one case,
> >>> but I am concerned that we will break archs as we convert more core code.
> >> Hi Rusty,
> >>
> >> I think we can avoid this problem if we make cpumask_bits == NR_CPUS iff
> >> CONFIG_CPUMASK_OFFSTACK=n.  This complies with the current cpumask_t
> >> approach and should cause all cpumask operators to always operate on
> >> all cpumask bits.
> > 
> > A very good point.  And it's no worse than the old method.
> > 
> > OK, forget about this for now, no urgent conversions needed :)
> > Rusty.
> 
> This probably should be submitted through linux-next for wider test coverage?
Identical patch already in series.
Thanks,
Rusty.