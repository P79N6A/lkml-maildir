Date: Tue, 25 Mar 2008 09:06:43 +0100 (CET)
From: Thomas Gleixner <>
Subject: Re: 2.6.25-rc5-git6: Reported regressions from 2.6.24
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/25/37

On Mon, 24 Mar 2008, Gabriel C wrote:
> > Hmm. Can you please apply the patch below. It add some more info and
> > triggers the sysrq-q timer list printout when the watchdog
> > triggers. That might us give some insight into this.
> 
> Sorry for the lag , I was out the whole day.
> 
> Here is what I've found in dmesg ( the box was idling at that time , as said I was not around ):
> 
> ...
> 
> [34528.893366] Clocksource tsc unstable (delta = 4686697613 ns) E:34204592 J:34210723
Ok. The timer got delayed. It got delayed because it is initialized as
a deferrable timer, which is obviously wrong. Sigh, I signed off on
that commit myself without thinking about the consequences.
Can you please apply the patch below on top of the others?
> ...
> 
> And that made irqbalance go mad which got killed by OOM , very strange.
Ouch.
revert: 1077f5a917b7c630231037826b344b2f7f5b903f
---
 kernel/time/clocksource.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
Index: linux-2.6/kernel/time/clocksource.c
===================================================================
--- linux-2.6.orig/kernel/time/clocksource.c
+++ linux-2.6/kernel/time/clocksource.c
@@ -176,7 +176,7 @@ static void clocksource_check_watchdog(s
 			if (watchdog)
 				del_timer(&watchdog_timer);
 			watchdog = cs;
-			init_timer_deferrable(&watchdog_timer);
+			init_timer(&watchdog_timer);
 			watchdog_timer.function = clocksource_watchdog;
 
 			/* Reset watchdog cycles */