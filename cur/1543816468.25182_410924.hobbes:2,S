Date: Sat, 25 Mar 2006 19:51:58 -0500
From: Dave Jones <>
Subject: Re: [PATCH] x86_64: Force broadcast timer on AMD systems with C3 too.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/3/25/170

On Sat, Mar 25, 2006 at 06:13:00PM +0000, Linux Kernel wrote:
 > commit bd6633476922b7b51227f7f704c2546e763ae5ed
 > tree 4e9844781419fe600c3e9f3e9dab8207f8dd12dd
 > parent 7682968b7d4d42bb076051b962c3926b4c98539a
 > author Andi Kleen <ak@suse.de> Sat, 25 Mar 2006 16:31:07 +0100
 > committer Linus Torvalds <torvalds@g5.osdl.org> Sun, 26 Mar 2006 01:10:56 -0800
 > 
 > [PATCH] x86_64: Force broadcast timer on AMD systems with C3 too.
this breaks ia64.
drivers/acpi/processor_idle.c: In function 'acpi_processor_power_verify':
drivers/acpi/processor_idle.c:919: error: 'switch_APIC_timer_to_ipi' undeclared (first use in this function)
drivers/acpi/processor_idle.c:919: error: (Each undeclared identifier is reported only once
drivers/acpi/processor_idle.c:919: error: for each function it appears in.)
 >  #ifdef ARCH_APICTIMER_STOPS_ON_C3
 > -			if (cx->valid && c->x86_vendor == X86_VENDOR_INTEL) {
 > -				on_each_cpu(switch_APIC_timer_to_ipi,
 > -						&mask, 1, 1);
 > -			}
 > +			if (cx->valid)
 > +				timer_broadcast++;
 >  #endif
 >  			break;
 >  		}
 > @@ -913,6 +915,9 @@ static int acpi_processor_power_verify(s
 >  			working++;
 >  	}
 >  
 > +	if (timer_broadcast)
 > +		on_each_cpu(switch_APIC_timer_to_ipi, &mask, 1, 1);
 > +
Looks like it needs wrapping in that ifdef ?
		Dave
-- 
http://www.codemonkey.org.uk
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/