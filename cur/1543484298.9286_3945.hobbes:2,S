Date: Thu, 4 Feb 1999 11:46:25 +0100 (MET)
From: (Thierry Danis)
Subject: Re: NFS in 2.2.1-ac3 - cache not synched ?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/2/4/41

>
> > It writes a 1,8 Gb file, rereads it, then unlinks it and exits (iozone
> > test program).
> 
> Ok
> 
> > Once the file has been unlinked, I verify that it has disappeared on
> > both ends (serveur and client). But a 'df' indicates that the space
> > is still used (ie, there is still 1,8 Gb used on the serveur partition).
> 
> That sounds like the handle is being cached. Unfsd also has this feature
> but releases a handle in 30 seconds. Im not sure what knfsd does with 
> timeouts.
> 
> How long did you leave it ?
> 
	A long time !
> Alan
> 
	In fact, as long as I do not create any new file (or umount/mount
	the NFS partition), the handle seems to be cached.
	If I create a file from another NFS client, it takes a long
	time for the creation to happen (the server is freeing the
	space before doing some creation).
	On the other hand, issuing a 'rm' on the client is almost
	instantaneous, even for the 1,8G file (since the blocks
	are actually not freed). But it takes a long time for
	the next access to begin. And since some tools tests
	for the available space before creating files, I am not
	sure it is advisable to delay the actual freeing up to
	the next operation.
A+
-- 
	Thierry Danis
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/