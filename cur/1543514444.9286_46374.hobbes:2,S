Date: Fri, 29 Oct 1999 02:44:02 +0200
From: Luca Montecchiani <>
Subject: [2.3.24] ide.c, ali15x3, and more
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/10/28/161

Testing 2.3.24 show me some bad things :
1) Using hda after an "hdparm -d1 /dev/hda" generate those warnings:
   home kernel: hda: timeout waiting for DMA
   home kernel: hda: irq timeout: status=0x58 { DriveReady SeekComplete DataRequest }
   home kernel: hda: DMA disabled
   home kernel: ide0: reset: success
   (*) more info later
2) Trying to change the "idebus speed" I've also noticed that ide.c isn't "__setup()" 
   compliant so all command line parameter are ignored.
   Here I see some other problems because ide_setup() accept a really wide area of 
   parameters and maybe it's better to split in tree specialized function, see:
   __setup("hd",...
   __setup("splitfifo=",...
   __setup("ide",...
3) Anyway after hacking ide.c to accept command line I've put a "mem=62M" in my
   lilo forgetting that my machine has only 32mbytes of ram...
   This crash my machine after the messages "Freeing unused kernel memory: 88k freed"
   It's a feature or a bug ?
   Yes it's a stupid human mistake but what will appen when some ram will be remove from
   a "lilo:mem=" machine ?
   I know that mem= is used in some case where the reported memory is lower than the 
   installed one, but we can do some check to avoid the GPF ?
4) Memory: 30120k/32768k available (0k kernel code, 0k reserved, 0k data, 0k init, 0k highmem)
--
Follow my UP P233MMX environment (Long ):
At boot Bios report UDMA for hda hdc and hdd.
Uniform Multi-Platform E-IDE driver Revision: 6.20
ALI15X3: IDE controller on PCI bus 00 dev 78
ALI15X3: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:DMA, hdb:pio
    ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:DMA, hdd:DMA
hda: Maxtor 84320D4, ATA DISK drive
ide: Assuming 40MHz system bus speed for PIO modes; override with idebus=xx
hdc: WDC AC24300L, ATA DISK drive
hdd: ASUS CD-S340, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
ide1 at 0x170-0x177,0x376 on irq 15
hda: Maxtor 84320D4, 4028MB w/256kB Cache, CHS=1023/128/63
hdc: WDC AC24300L, 4112MB w/256kB Cache, CHS=8912/15/63
hdd: ATAPI 34X CD-ROM drive, 128kB Cache
# Block devices
CONFIG_BLK_DEV_FD=y
CONFIG_BLK_DEV_IDE=y
CONFIG_BLK_DEV_IDEDISK=y
CONFIG_BLK_DEV_IDECD=y
CONFIG_BLK_DEV_IDEPCI=y
CONFIG_BLK_DEV_IDEDMA_PCI=y
CONFIG_IDEDMA_PCI_AUTO=y
CONFIG_IDEDMA_PCI_EXPERIMENTAL=y
CONFIG_BLK_DEV_ALI15X3=y
CONFIG_BLK_DEV_IDEDMA=y
CONFIG_IDEDMA_AUTO=y
CONFIG_BLK_DEV_LOOP=y
CONFIG_PARIDE_PARPORT=y
CONFIG_BLK_DEV_IDE_MODES=y
Hd config:
[root@home /root]# hdparm -Ii /dev/hda
/dev/hda:
 Model=Maxtor 84320D4, FwRev=NAVXAA21, SerialNo=L415PYKA
 Config={ Fixed }
 RawCHS=8184/16/63, TrkSize=0, SectSize=0, ECCbytes=20
 BuffType=3(DualPortCache), BuffSize=256kB, MaxMultSect=16, MultSect=off
 DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=2(fast)
 CurCHS=8184/16/63, CurSects=8249472, LBA=yes
 LBA CHS=1023/128/63 Remapping, LBA=yes, LBAsects=8249472
 tDMA={min:120,rec:120}, DMA modes: mword0 mword1 *mword2 
 IORDY=on/off, tPIO={min:120,w/IORDY:120}, PIO modes: mode3 mode4 
 UDMA modes: mode0 mode1 mode2
 Model=aMtxro8 34024D                          , FwRev=ANXVAA12, SerialNo=4L51YPAK            
 Config={ Fixed }
 RawCHS=8184/16/63, TrkSize=0, SectSize=0, ECCbytes=20
 BuffType=3(DualPortCache), BuffSize=256kB, MaxMultSect=16, MultSect=?0?
 DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=2(fast)
 CurCHS=8184/16/63, CurSects=8249472, LBA=yes
 LBA CHS=1023/128/63 Remapping, LBA=yes, LBAsects=8249472
 tDMA={min:120,rec:120}, DMA modes: mword0 mword1 *mword2 
 IORDY=on/off, tPIO={min:120,w/IORDY:120}, PIO modes: mode3 mode4 
 UDMA modes: mode0 mode1 mode2
[root@home /root]# hdparm  /dev/hda
/dev/hda:
 multcount    =  0 (off)
 I/O support  =  0 (default 16-bit)
 unmaskirq    =  0 (off)
 using_dma    =  0 (off)
 keepsettings =  0 (off)
 nowerr       =  0 (off)
 readonly     =  0 (off)
 readahead    =  8 (on)
 geometry     = 1023/128/63, sectors = 8249472, start = 0
[root@home /root]# cat /proc/ide/ali 
                                Ali M15x3 Chipset.
                                ------------------
PCI Clock: 33.
CD_ROM FIFO:No , CD_ROM DMA:No 
FIFO Status: contains 0 Words, runs.
-------------------primary channel-------------------secondary channel---------
channel status:       On                                On 
both channels togth:  Yes                               Yes
Channel state:        DRQ                               OK            
Add. Setup Timing:    1T                                1T
Command Act. Count:   3T                                3T
Command Rec. Count:   3T                               3T
----------------drive0-----------drive1------------drive0-----------drive1------
DMA enabled:      Yes              No                Yes              Yes
FIFO threshold:    8 Words          8 Words           8 Words          8 Words
FIFO mode:        FIFO On          FIFO On           FIFO On          FIFO Off
Dt RW act. Cnt     3T               8T                3T               3T
Dt RW rec. Cnt     1T              16T                1T               1T
-----------------------------------UDMA Timings--------------------------------
UDMA:             OK               No                OK               OK
UDMA timings:     2.5T             1.5T              2.5T             2.5T
thanks,
luca
-- 
------------------------------------------------------------------
E-mail......: Luca Montecchiani <m.luca@iname.com>
W.W.W.......: 
http://i.am/m.luca
 - 
http://luca.myip.org
Speakfreely.: sflwl -hlwl.fourmilab.ch luca@
I.C.Q.......: 17655604
-----------------------=(Linux since 1995)=-----------------------
Non esiste vento favorevole per il marinaio che non sa dove andare
                                                          Seneca
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/