Date: Fri, 16 Jan 2009 12:53:57 +1100
From: Herbert Xu <>
Subject: Re: [PATCH crypto -v4 2/2] AES-NI: Add support to Intel AES-NI instructions for x86_64 platform
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/15/755

On Fri, Jan 16, 2009 at 09:20:58AM +0800, Huang Ying wrote:
> On Thu, 2009-01-15 at 17:47 +0800, roel kluin wrote:
>
> > > +       kernel_fpu_begin();
> > > +       while ((nbytes = walk.nbytes)) {
> > > +               aesni_ecb_enc(ctx, walk.dst.virt.addr, walk.src.virt.addr,
> > > +                             nbytes & AES_BLOCK_MASK);
> > > +               nbytes &= AES_BLOCK_SIZE - 1;
> > > +               err = blkcipher_walk_done(desc, &walk, nbytes);
> > > +       }
> > > +       kernel_fpu_end();
> > > +
> > > +       return err;
> > > +}
> > 
> > if blkcipher_walk_{virt,done} returns an error, don't we have to break
> > out of the loop?
> > i.e.
> > 
> > while (!err && (nbytes = walk.nbytes))
> > 
> > (if that's erroneous, it occurs in other places as well)
That's not necessary because blkcipher_walk_done will ensure
that walk.nbytes == 0 if there is an error.
Cheers,
-- 
Visit Openswan at 
http://www.openswan.org/
Email: Herbert Xu 许志壬 <herbert@gondor.apana.org.au>
Home Page: 
http://gondor.apana.org.au/herbert/
PGP Key: 
http://gondor.apana.org.au/herbert/pubkey.txt