Date: Mon, 25 Sep 2006 13:19:31 +0100
From: Alan Cox <>
Subject: Re: [PATCH] restore libata build on frv
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/9/25/93

Ar Llu, 2006-09-25 am 12:27 +0100, ysgrifennodd David Howells:
> Alan Cox <alan@lxorguk.ukuu.org.uk> wrote:
> These are all legacy ISA settings, and not applicable to FRV:
> 
> 	#define ATA_PRIMARY_CMD		0x1F0
> 	#define ATA_PRIMARY_CTL		0x3F6
> 	#define ATA_PRIMARY_IRQ		14
> 
> 	#define ATA_SECONDARY_CMD	0x170
> 	#define ATA_SECONDARY_CTL	0x376
> 	#define ATA_SECONDARY_IRQ	15
Wrong these are PCI settings. Please read the PCI specifications. In
particular the handling of non-native mode IDE storage class devices on
a PCI bus. For the IRQ mapping of the non-native ports consult your
bridge documentation.
> Note that the ata_pci_init_legacy_port() explicitly states the IRQ numbers as
> 14 and 15 without reference to the macros and so is bad, eg:
> 
> 		probe_ent->irq = 14;
That is indeed a bug
> Make FRV build with libata enabled.  This is done by making the legacy ISA
> interface support conditional on the definition of the legacy ISA port
> settings.  If there's no ISA bus, we shouldn't even attempt to pretend that
> there is.
> 
> Signed-Off-By: David Howells <dhowells@redhat.com>
Nacked-by: Alan Cox <alan@redhat.com>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/