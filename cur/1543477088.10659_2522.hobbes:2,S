Date: Tue, 12 Jan 1999 02:18:33 -0500
From:  kernel@whitesta ...
Subject: Found it!! (Was: Re: Mixer on ESS0968 messed up since 2.2.0-pre5)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/12/115

Spent a little while tonight trying to figure out the sound drivers to
help pin things down, and I've managed to come up with a patch to fix my
problem..
Now, I'm not positive this is the right fix, but I'm not even going to
try and mess with the auto-detection code without having the specs for a
few of the ESS cards in front of me..
The card is detected as a 'ESS0968' by isapnp, however 2.2.0p4 (which
works fine) identifies it as
isapnp detects the card as
--START--
# Card 2: (serial identifier 35 00 00 00 01 68 09 73 16)
# Vendor Id ESS0968, Serial Number 1, checksum 0x35.
#     Version 1.0, Vendor version 1.0
#     ANSI string -->ESS Plug and Play AudioDrive<--
--END--
2.2.0p4 (which works fine) detects it as
--START--
Audio devices:
0: ESS ES1688 AudioDrive (rev 11) (3.1)
--END--
But, for added fun, 2.2.0p6ac2 sees it as
--START--
Audio devices:
0: ESS ES1788 AudioDrive (rev 11) (3.1)
--END--
I'm not sure which to believe, but I'm leaning towards isapnp's guess..
The mixer seems to be that of a ES1688 driver wise, including the
reclev setting..
As such I finally made the change (patch attached), sadly I'm pretty
sure that this is not %100 correct, and may break the mixer of the newly
support ESS cards with a submodel of 10 which, without this patch, would
get the 'es1688later_mix' mixer struct..
Hopefully I've managed to pin down enough for you to track down the
proper fix.. :/
If there is any more I can do to help please ask..
Zephaniah E, Hull.
On Mon, Jan 11, 1999 at 01:08:55AM -0500, kernel@whitestar.soark.net wrote:
> Everything was working fine up until 2.2.0p5, with and without AC
> patches, 2.2.0p4 without any patches works fine, can try with the AC
> patches once I can get to them again..
> 
> What happens is that I get a new mixer setting (Rec), and the main
> volume control stops working, I have not tried recording with the newer
> kernels, but I could if needed..
> 
> My .config is attached..
> 
> Zephaniah E, Hull.
<snip>
--- linux-2.2.0p6ac2/drivers/sound/sb_mixer.c	Tue Jan 12 01:54:26 1999
+++ linux-2.2.0p6ac2-zh/drivers/sound/sb_mixer.c	Tue Jan 12 01:49:51 1999
@@ -1022,7 +1022,7 @@
 						= ES1688_MIXER_DEVICES;
 					devc->supported_rec_devices
 						= ES1688_RECORDING_DEVICES;
-					if (devc->submodel < 0x10) {
+					if (devc->submodel <= 0x10) {
 						devc->iomap = &es1688_mix;
 					} else {
 						devc->iomap = &es1688later_mix;