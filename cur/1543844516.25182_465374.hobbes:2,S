Date: Fri, 22 Sep 2006 11:24:27 +0900
From: KAMEZAWA Hiroyuki <>
Subject: Re: [BUG] i386 2.6.18 cpu_up: attempt to bring up CPU 4 failed : kernel BUG at mm/slab.c:2698!
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/9/21/321

On Thu, 21 Sep 2006 18:34:03 -0700
keith mannthey <kmannth@us.ibm.com> wrote:
> That unhappy caller in the chain is cpuup_callback in mm/slab.c.  I am
> still working out as to why, there is a lot going on if this function. 
> 
> > b) pageset_cpuup_callback()'s CPU_UP_CANCELED path possibly hasn't been
> >    tested before.  I'd be guessing that we're not zeroing out the
> >    zone.pageset[] array when the `struct zone' is first allocated, but I
> >    don't immediately recall where that code lives.
> 
How about here ?
== at boot time in mm/page_alloc.c ==
free_area_init_core()
	->zone_pcp_init(zone);
        for (cpu = 0; cpu < NR_CPUS; cpu++) {
#ifdef CONFIG_NUMA
                /* Early boot. Slab allocator not functional yet */
                zone_pcp(zone, cpu) = &boot_pageset[cpu];
                setup_pageset(&boot_pageset[cpu],0);
#else
                setup_pageset(zone_pcp(zone,cpu), batch);
#endif
        }
==================
Not zero-cleared.
-Kame
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/