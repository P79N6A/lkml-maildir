Date: Thu, 15 Dec 2005 12:14:22 +0100
From: Gerd Knorr <>
Subject: Re: [patch 2/2] uml: Framebuffer driver for UML
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/15/114

>> drivers/built-in.o(.text+0x18b): In function `vgacon_deinit':
>> /home/jdike/linux/2.6/linux-2.6.15/drivers/video/console/vgacon.c:151: 
>> undefined reference to `outw'
> Should be trivially fixable with some Kconfig tweaks, I'll have a look.
Here we go, this patch disables vga console and the mouse/kbd hardware 
drivers on UML.  Running a "allmodconfig" testbuild right now, but I 
hope that everything else is catched by PCI + ISA dependencies ...
cheers,
   Gerd
Index: linux-2.6.14/drivers/input/keyboard/Kconfig
===================================================================
--- linux-2.6.14.orig/drivers/input/keyboard/Kconfig	2005-12-12 18:24:51.000000000 +0100
+++ linux-2.6.14/drivers/input/keyboard/Kconfig	2005-12-15 12:07:26.000000000 +0100
@@ -10,7 +10,7 @@ menuconfig INPUT_KEYBOARD
 
 	  If unsure, say Y.
 
-if INPUT_KEYBOARD
+if INPUT_KEYBOARD && !UML
 
 config KEYBOARD_ATKBD
 	tristate "AT keyboard" if !X86_PC
Index: linux-2.6.14/drivers/input/mouse/Kconfig
===================================================================
--- linux-2.6.14.orig/drivers/input/mouse/Kconfig	2005-12-12 18:24:51.000000000 +0100
+++ linux-2.6.14/drivers/input/mouse/Kconfig	2005-12-15 12:06:59.000000000 +0100
@@ -10,7 +10,7 @@ menuconfig INPUT_MOUSE
 
 	  If unsure, say Y.
 
-if INPUT_MOUSE
+if INPUT_MOUSE && !UML
 
 config MOUSE_PS2
 	tristate "PS/2 mouse"
Index: linux-2.6.14/drivers/input/serio/Kconfig
===================================================================
--- linux-2.6.14.orig/drivers/input/serio/Kconfig	2005-10-28 02:02:08.000000000 +0200
+++ linux-2.6.14/drivers/input/serio/Kconfig	2005-12-15 12:06:11.000000000 +0100
@@ -21,7 +21,7 @@ if SERIO
 config SERIO_I8042
 	tristate "i8042 PC Keyboard controller" if EMBEDDED || !X86
 	default y
-	depends on !PARISC && (!ARM || ARCH_SHARK || FOOTBRIDGE_HOST) && !M68K
+	depends on !PARISC && (!ARM || ARCH_SHARK || FOOTBRIDGE_HOST) && !M68K && !UML
 	---help---
 	  i8042 is the chip over which the standard AT keyboard and PS/2
 	  mouse are connected to the computer. If you use these devices,
Index: linux-2.6.14/drivers/video/console/Kconfig
===================================================================
--- linux-2.6.14.orig/drivers/video/console/Kconfig	2005-12-12 18:25:03.000000000 +0100
+++ linux-2.6.14/drivers/video/console/Kconfig	2005-12-15 12:01:31.000000000 +0100
@@ -6,7 +6,7 @@ menu "Console display driver support"
 
 config VGA_CONSOLE
 	bool "VGA text console" if EMBEDDED || !X86
-	depends on !ARCH_ACORN && !ARCH_EBSA110 && !4xx && !8xx && !SPARC32 && !SPARC64 && !M68K && !PARISC && !ARCH_VERSATILE
+	depends on !ARCH_ACORN && !ARCH_EBSA110 && !4xx && !8xx && !SPARC32 && !SPARC64 && !M68K && !PARISC && !ARCH_VERSATILE && !UML
 	default y
 	help
 	  Saying Y here will allow you to use Linux in text mode through a