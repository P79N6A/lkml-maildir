Date: Tue, 6 Dec 2005 21:17:30 +0000
From: Mark Brown <>
Subject: Re: [PATCH] natsemi: NAPI support
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/6/343

On Tue, Dec 06, 2005 at 01:19:34AM +0100, Francois Romieu wrote:
> Mark Brown <broonie@sirena.org.uk> :
> > I had been under the impression that the stack was supposed to make sure
> > that no poll() is running before the driver close() gets called?
> Not exactly. dev_close() waits a bit but it can not be sure that the
> device driver will not schedule ->poll() from its irq handler later.
Prior to waiting dev_close() clears __LINK_STATE_START which will cause
netif_rx_schedule_prep() to return false.  As far as I can see that
should prevent the interrupt handler scheduling any further poll() calls?
-- 
"You grabbed my hand and we fell into it, like a daydream - or a fever."
[unhandled content-type:application/pgp-signature]