Date: Sun, 09 Mar 2008 21:03:35 +0900
From: KOSAKI Motohiro <>
Subject: Re: quicklists confuse meminfo
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/9/46

Hi
> hm. I think we should not let this much RAM hang around in a 
> special-purpose allocator like quicklists. Shouldnt the quicklists be 
> temporary in nature, and be trimmed much more agressively?
> 
> in fact, we have a check_pgt_cache() call in cpu_idle(), which does:
> 
>         quicklist_trim(0, pgd_dtor, 25, 16);
> 
> but it appears we dont do quicklist trimming anywhere else! So if a 
> system has no idle time, the quicklist can grow unbounded, and that's a 
> real memory leak IMO.
I test following method.
1. $ hackbench 100 process 1000
2. $ cat /proc/meminfo
quicklist consume 1GB memory of 8GB total memory system.
it seems too large cache ;)
IMHO we need shrink pgtable cache mecanism.
---------------------------------------
MemTotal:      7683328 kB
MemFree:       4940672 kB
Buffers:          2816 kB
Cached:          23232 kB
SwapCached:      72192 kB
Active:          56832 kB
Inactive:        77440 kB
SwapTotal:     2031488 kB
SwapFree:      1907776 kB
Dirty:             704 kB
Writeback:           0 kB
AnonPages:       48384 kB
Mapped:          20864 kB
Slab:          1325824 kB
SReclaimable:    11968 kB
SUnreclaim:    1313856 kB
PageTables:      13632 kB
NFS_Unstable:        0 kB
Bounce:              0 kB
CommitLimit:   5873152 kB
Committed_AS:   531008 kB
VmallocTotal: 17592177655808 kB
VmallocUsed:     28864 kB
VmallocChunk: 17592177623104 kB
Quicklists:    1194304 kB
HugePages_Total:     0
HugePages_Free:      0
HugePages_Rsvd:      0
HugePages_Surp:      0
Hugepagesize:    262144 kB