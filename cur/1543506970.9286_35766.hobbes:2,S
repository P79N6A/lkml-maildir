Date: Wed, 25 Aug 1999 17:10:22 -0500 (CDT)
From: "Joseph W. Breu" <>
Subject: [PATCH]: 3Com CMI Internal Docsis Cable Modem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/8/25/111

Hello all,
Attached are the patches for kernels 2.2.x and 2.3.x (used 2.2.11 and
2.3.14).  The 3Com CMI Internal Docsis Cable Modem is basicly a 3Com
Vortex (with no RJ-45 jack on the back, just a coax connection).
These modems are not yet on the market yet, but hey, I have one sitting
around and wanted to play with it.
Our rep from 3Com is supposed to be forwarding me some additional
information about grabbing certain information from the Cable part of the
card (like TX/RX freq's, UCD's, Baseline privacy paramters, etc...)  I
will update the driver then, but for now, all is good!
-- 
	Thanks,
	-Joseph W. Breu
---------------------------------------------------------------------
Joseph W. Breu       Linux/UNIX Administrator / Cedar Falls Utilities
phone: (319) 268-5228        Utility Parkway, Cedar Falls, Iowa 50613 
pager: (319) 235-4209  NIC: jwb96   breu@cfu.net   breu.pager@cfu.net
--------------- Where do you want to go tomorrow? -------------------
diff --unified -r linux-2.2.11-virgin/Documentation/Configure.help linux/Documentation/Configure.help
--- linux-2.2.11-virgin/Documentation/Configure.help	Mon Aug  9 14:04:57 1999
+++ linux/Documentation/Configure.help	Wed Aug 25 15:27:57 1999
@@ -5894,11 +5894,12 @@
   Documentation/networking/net-modules.txt. The module will be called
   3c509.o. 
 
-3c590 series (592/595/597) "Vortex" support
+3c590 series (592/595/597/CMI) "Vortex" support
 CONFIG_VORTEX
   If you have a 3Com "Vortex" (Fast EtherLink 3c590/3c592/3c595/3c597)
   or "Boomerang" series (EtherLink XL 3c900 or 3c905) network
-  (Ethernet) card, say Y and read the Ethernet-HOWTO, available via
+  (Ethernet) card or a 3Com CMI Internal DOCSIS Cable Modem (code named
+  Tobasco), say Y and read the Ethernet-HOWTO, available via
   FTP (user: anonymous) in 
ftp://metalab.unc.edu/pub/Linux/docs/HOWTO.
   More specific information is in Documentation/networking/vortex.txt
   and in the comments at the beginning of drivers/net/3c59x.c.
diff --unified -r linux-2.2.11-virgin/drivers/net/3c59x.c linux/drivers/net/3c59x.c
--- linux-2.2.11-virgin/drivers/net/3c59x.c	Tue Jan 19 16:47:15 1999
+++ linux/drivers/net/3c59x.c	Wed Aug 25 15:06:04 1999
@@ -12,6 +12,31 @@
 	The author may be reached as becker@CESDIS.gsfc.nasa.gov, or C/O
 	Center of Excellence in Space Data and Information Sciences
 	   Code 930.5, Goddard Space Flight Center, Greenbelt MD 20771
+
+
+	Added support for the 3Com CMI Internal DOCSIS Cable Modem.  This
+	card is based on the Vortex.  I am still looking for ways to
+	pull RF and Docsis specific data from the card.
+
+		Usefull information from the Reference Guide:
+		---------------------------------------------
+
+		The card has 3 lights on the back of it.
+			FCN: determined by the cable operator
+			ACT: Cable modem Activity light
+			STS: Cable modem status.
+		STS LED State	Repeating Pattern	Description
+		-------------	-----------------	-----------
+		OFF		NONE			Startup and Channel
+							hunting.
+		ON/BLINKING	Long off, short on	Acquisition in process
+		ON/BLINKING	Short off, short on	Offline or not
+							authorized
+		ON		NONE			On-line and fully
+							functional.
+
+		9-25-1999 Joseph W. Breu (breu@cfu.net)
+			  David J. Weis  (djweis@plconline.com)
 */
 
 static char *version =
@@ -239,6 +264,8 @@
 									struct device *dev, long ioaddr,
 									int irq, int dev_id, int card_idx);
 static struct pci_id_info pci_tbl[] = {
+	{"CMI Docsis Cable Modem (Tobasco)",	0x10B7, 0x2900, 0xffff,
+	 PCI_USES_IO|PCI_USES_MASTER, IS_VORTEX, 32, vortex_probe1},
 	{"3c590 Vortex 10Mbps",			0x10B7, 0x5900, 0xffff,
 	 PCI_USES_IO|PCI_USES_MASTER, IS_VORTEX, 32, vortex_probe1},
 	{"3c595 Vortex 100baseTx",		0x10B7, 0x5950, 0xffff,
Only in linux/drivers/net: comp
diff --unified -r linux-2.2.11-virgin/drivers/pci/oldproc.c linux/drivers/pci/oldproc.c
--- linux-2.2.11-virgin/drivers/pci/oldproc.c	Mon Aug  9 14:04:39 1999
+++ linux/drivers/pci/oldproc.c	Tue Aug 24 19:56:42 1999
@@ -275,6 +275,7 @@
 	DEVICE( PLX,		PLX_9080,	"PCI9080 I2O"),
 	DEVICE( MADGE,		MADGE_MK2,	"Smart 16/4 BM Mk2 Ringnode"),
 	DEVICE( MADGE,		MADGE_C155S,	"Collage 155 Server"),
+	DEVICE( 3COM,		3COM_CMI_DOCSIS,"CMI Docsis Cable Modem"),
 	DEVICE( 3COM,		3COM_3C339,	"3C339 TokenRing"),
 	DEVICE( 3COM,		3COM_3C590,	"3C590 10bT"),
 	DEVICE( 3COM,		3COM_3C595TX,	"3C595 100bTX"),
diff --unified -r linux-2.2.11-virgin/include/linux/pci.h linux/include/linux/pci.h
--- linux-2.2.11-virgin/include/linux/pci.h	Mon Aug  9 14:04:41 1999
+++ linux/include/linux/pci.h	Tue Aug 24 18:39:12 1999
@@ -650,6 +650,7 @@
 
 #define PCI_VENDOR_ID_3COM		0x10b7
 #define PCI_DEVICE_ID_3COM_3C985	0x0001
+#define PCI_DEVICE_ID_3COM_CMI_DOCSIS	0x2900		/* breu */
 #define PCI_DEVICE_ID_3COM_3C339	0x3390
 #define PCI_DEVICE_ID_3COM_3C590	0x5900
 #define PCI_DEVICE_ID_3COM_3C595TX	0x5950diff --unified -r linux-2.3.14-virgin/Documentation/Configure.help linux/Documentation/Configure.help
--- linux-2.3.14-virgin/Documentation/Configure.help	Wed Aug 18 12:10:06 1999
+++ linux/Documentation/Configure.help	Wed Aug 25 15:27:55 1999
@@ -6225,11 +6225,12 @@
   Documentation/networking/net-modules.txt. The module will be called
   3c509.o. 
 
-3c590 series (592/595/597) "Vortex" support
+3c590 series (592/595/597/CMI) "Vortex" support
 CONFIG_VORTEX
-  If you have a 3Com "Vortex" (Fast EtherLink 3c590/3c592/3c595/3c597)
-  or "Boomerang" series (EtherLink XL 3c900 or 3c905) network
-  (Ethernet) card, say Y and read the Ethernet-HOWTO, available via
+  If you have a 3Com "Vortex" (Fast EtherLink 3c590/3c592/3c595/3c597) or
+  "Boomerang" series (EtherLink XL 3c900 or 3c905) network
+  (Ethernet) card or a 3Com CMI Internal DOCSIS Cable Modem (code named
+  Tobasco), say Y and read the Ethernet-HOWTO, available via
   FTP (user: anonymous) in 
ftp://metalab.unc.edu/pub/Linux/docs/HOWTO.
   More specific information is in Documentation/networking/vortex.txt
   and in the comments at the beginning of drivers/net/3c59x.c.
diff --unified -r linux-2.3.14-virgin/drivers/net/3c59x.c linux/drivers/net/3c59x.c
--- linux-2.3.14-virgin/drivers/net/3c59x.c	Wed Aug 18 13:36:41 1999
+++ linux/drivers/net/3c59x.c	Wed Aug 25 15:06:26 1999
@@ -12,6 +12,32 @@
 	The author may be reached as becker@CESDIS.gsfc.nasa.gov, or C/O
 	Center of Excellence in Space Data and Information Sciences
 	   Code 930.5, Goddard Space Flight Center, Greenbelt MD 20771
+
+
+        Added support for the 3Com CMI Internal DOCSIS Cable Modem (nicknamed
+	Tobasco).  This card is based on the Vortex.  I am still looking for
+	ways to pull RF and Docsis specific data from the card.
+
+                Usefull information from the Reference Guide:
+                ---------------------------------------------
+
+                The card has 3 lights on the back of it.
+                        FCN: determined by the cable operator
+                        ACT: Cable modem Activity light
+                        STS: Cable modem status.
+                STS LED State   Repeating Pattern       Description
+                -------------   -----------------       -----------
+                OFF             NONE                    Startup and Channel
+                                                        hunting.
+                ON/BLINKING     Long off, short on      Acquisition in process
+                ON/BLINKING     Short off, short on     Offline or not
+                                                        authorized
+                ON              NONE                    On-line and fully
+                                                        functional.
+
+                9-25-1999 Joseph W. Breu (breu@cfu.net)
+                          David J. Weis  (djweis@plconline.com)
+
 */
 
 static char *version =
@@ -239,6 +265,8 @@
 									struct net_device *dev, long ioaddr,
 									int irq, int dev_id, int card_idx);
 static struct pci_id_info pci_tbl[] = {
+	{"CMI Docsis Cable Modem (Tobasco)",    0x10B7, 0x2900, 0xffff,
+	 PCI_USES_IO|PCI_USES_MASTER, IS_VORTEX, 32, vortex_probe1},
 	{"3c590 Vortex 10Mbps",			0x10B7, 0x5900, 0xffff,
 	 PCI_USES_IO|PCI_USES_MASTER, IS_VORTEX, 32, vortex_probe1},
 	{"3c595 Vortex 100baseTx",		0x10B7, 0x5950, 0xffff,
diff --unified -r linux-2.3.14-virgin/drivers/pci/devlist.h linux/drivers/pci/devlist.h
--- linux-2.3.14-virgin/drivers/pci/devlist.h	Thu Aug  5 20:44:28 1999
+++ linux/drivers/pci/devlist.h	Wed Aug 25 11:58:12 1999
@@ -402,6 +402,7 @@
 ENDVENDOR()
 
 VENDOR( 3COM, "3Com" )
+	DEVICE( 3COM,		3COM_CMI_DOCSIS, "CMI Docsis Cable Modem")
 	DEVICE( 3COM,		3COM_3C339,	"3C339 TokenRing")
 	DEVICE( 3COM,		3COM_3C590,	"3C590 10bT")
 	DEVICE( 3COM,		3COM_3C595TX,	"3C595 100bTX")
diff --unified -r linux-2.3.14-virgin/include/linux/pci.h linux/include/linux/pci.h
--- linux-2.3.14-virgin/include/linux/pci.h	Wed Aug 18 18:43:30 1999
+++ linux/include/linux/pci.h	Wed Aug 25 12:01:53 1999
@@ -653,6 +653,7 @@
 
 #define PCI_VENDOR_ID_3COM		0x10b7
 #define PCI_DEVICE_ID_3COM_3C985	0x0001
+#define PCI_DEVICE_ID_3COM_CMI_DOCSIS   0x2900
 #define PCI_DEVICE_ID_3COM_3C339	0x3390
 #define PCI_DEVICE_ID_3COM_3C590	0x5900
 #define PCI_DEVICE_ID_3COM_3C595TX	0x5950