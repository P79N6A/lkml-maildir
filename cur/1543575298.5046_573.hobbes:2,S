Date: Fri, 8 Dec 2000 16:45:04 -0800
From: "Eddy" <>
Subject: 2.2.16 and 2.2.17 nfsroot boot problem with D-Link DE-220PCT
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/12/8/209

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<META content="MSHTML 5.50.4207.2601" name=GENERATOR>
<STYLE></STYLE>
</HEAD>
<BODY bgColor=#ffffff>
<DIV><FONT face=Arial size=2>This is a second posting, I just got back onto the 
kernel mailing list. The first was sent via dejanews. So If this looks 
familiar... It is. Ignore It.</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>Hi all, I seem to be having some problems 
configuring kernels 2.2.16 and 2.2.17 to nfsroot boot. I have two machines at a 
friends house I am trying to link up. The server is an A-Bit BP6 433 celeron 
with a rtl-8139 10/100-tx pci board which is working fine. I am trying to hook 
up a 486-66 with an unknown motherboard type using interface chips DX6900A-1 and 
DX6900A-2 to the ISA bus trying to talk to a brand new D-link DE-220-PCT. 
</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>What I have done is comiled kernels 2.2.16-patched 
with USB and NTP-PPS and K-NSF and a newer 2.2.17 vanilla kernel. The 
2.2.16-patched has been running fine for many months now. Windows-95 on the 486 
runs the D-Link card ok. I can talk to the BP6 running samba great. I can take 
the D-Link card out of the 486 stuff it into the BP6 ISA bus. I can modprobe 
eth1 with the ne.o module and up comes the link to the 486. Windows can talk to 
samba great.</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>I think that I have just about every networking 
option compiled into the 2.2.16 kernel except the experimental rarp module??? 
I've got kernel NFS patch from a while back for the 2.2.16 kernel.</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>I compile the kernel for 486. Strip down most of 
the stuff I wont need on the 486 and leave in the arp/rarp/bootp/dhcp nfs and 
root on nfs.</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>I do mknod /dev/nfs b 0 255 ...<BR>I do rdev 
bzImage.216 /dev/nfs<BR>I do mkdir /tftpboot/192.168.50.2<BR>I do cd 
/tftpboot/192.168.50.2<BR>I do tar -C /boot -cpsf - | tar -xpsf -&nbsp; ... to 
... tar -C /var -cpsf - | tar -xpsf -<BR>I do mkdir /usr /lib /mp3 ... 
structures to come in shared via nfs<BR>I do cd etc<BR>vi 
fstab<BR>//celeron:/tftpboot/192.168.50.2 /&nbsp;&nbsp;&nbsp;&nbsp; nfs 
rsize=8192,wsize=8192 0 
0<BR>//celeron:/lib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
/lib&nbsp; nfs rsize=8192,wsize=8192 0 
0<BR>//celeron:/usr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
/usr&nbsp; nfs rsize=8192,wsize=8192 0 
0<BR>//celeron:/mp3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
/mp3&nbsp; nfs rsize=8192,wsize=8192 0 
0<BR>/dev/hda1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
/cdrive vfat defaults 0 
0<BR>/cdrive/swapfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
swap&nbsp;&nbsp; swap&nbsp; defaults 0 
0<BR>none&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
/proc&nbsp; proc&nbsp; defaults 0 
0<BR>none&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
/dev/pts pts defaults 0 0<BR>...<BR>wq</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>I cd /etc<BR>vi exports<BR>/tftpboot/192.168.50.2 
486(rw,no_root_squash,no_all_squash)<BR>/lib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
486(rw,no_root_squash,no_all_squash)<BR>/usr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
486(rw,no_root_squash,no)all_squash)<BR>...<BR>a bunch of other 
stuff<BR>wq<BR>vi dhcpd.conf<BR>shared-network 192.168.50.0;<BR>&nbsp; { allow 
bootp;<BR>&nbsp;&nbsp;&nbsp; server-name "celeron";<BR>&nbsp;&nbsp;&nbsp; 
server-identifier 192.168.50.1;<BR>&nbsp;&nbsp;&nbsp; subnet 192.168.50.0 
netmask 255.255.255.0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { range 192.168.50.15 
192.168.50.99;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default-lease-time 
600; max-lease-time 7200;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; option 
subnet-mask 255.255.255.0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; option 
domain-name Sophie;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; 
group<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { host 
486<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { hardware 
00:50:ba:05:7b:fb;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
fixed-address 
192.168.50.2;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }<BR>:wq<BR>vi 
/etc/rc.d/init.d/rarp<BR>... a bunch of junk<BR>start = /sbin/rarp -s 
192.168.50.2 00:50:ba:05:7b:fb<BR>stop&nbsp; = /sbin/rarp -d 
192.168.50.2<BR>status = /sbin/rarp -a<BR>... a bunch more juck<BR>:wq<BR>vi 
/etc/rc.d/init.d/dhcpd<BR>I add "eth0" to the "daemon dhcpd" start 
line.<BR>:wq<BR>cd /etc/rc.d<BR>ln -s ../init.d/rarp rc5.d/S15rarp<BR>ln -s 
../init.d/rarp rc4.d/S15rarp<BR>ln -s ../init.d/rarp rc3.d/s15rarp<BR>ln -s 
../init.d/dhcpd rc5.d/S65dhcpd<BR>ln -s ../init.d/dhcpd rc4.d/S65dhcpd<BR>ln -s 
../init.d/dhcpd rc3.d/S65dhcpd</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>rarp -a reports 192.168.50.2 
00:50:ba:05:7b:fb</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>tail /var/log/messages reports<BR>"dhcpd sending 
and recieving on eth0 191.168.50.0... ready and waiting"</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>so know we do</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>cd /usr/src/linux/arch/i386/boot<BR>ln -f 
bzImage-486.216 /tmp/<BR>ln -f bzImage-486.217 /tmp/ ... after the rdev 
thingy</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>boot up windows on the 486.<BR>open up the tmp 
samba share<BR>copy bzImage* c:\</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>try<BR>c:\loadlin.exe c:\bzImage-486.216 
root=/dev/nfs ether=0,0,eth0<BR>c:\loadlin.exe c:\bzImage-486.216 root=0:255 
ether=0,0,eth0<BR>c:\loadlin.exe c:\bzImage-486.216 root=/dev/nfs ip=autoconf 
ether=0,0,eth0<BR>c:\loadlin.exe c:\bzImage-486.216 root=/dev/nfs ip=both 
nfsroot=192.168.50.1:/tftpboot/192.168.50.2,rsize=8192,wsize=8192 
ether=0,0,eth0<BR>c:\loadlin.exe c:\bzImage-486.216 root=/dev/nfs nfsaddrs=auto 
ether=0,0,eth0 ... "for compatibility reasons only"<BR>c:\loadlin.exe 
c:\bzImage-486.216 root=/dev/nfs 
nfsaddrs=192.168.50.2:192.168.50.1::255.255.255.0:eth0:both ... "again only for 
compatibility reasons"<BR>c:\loadlin.exe c:\bzImage-486.216 root=/dev/nfs 
ip=something:something:something:something:something:something:Idon'tknowhatelse 
nfsroot=192.168.50.1%s,rsize=8192,wsize=8192 
nfsaddrs=myip:serv-ip:nogw:netmask:eth0 ether=9,0x280,eth0 lp=7,0x378 mem=8192k 
init=1<BR>...<BR>and every other combinations that I could possible try to think 
of after 3 days of continuous awakining.<BR>...<BR>Ditto for 
bzImage.217<BR>...<BR>OK<BR>The result is always the same on the 486. Both 
kernels.<BR>First.. the kernel would boot up until it got to "hda". It would 
then hang after reporting some stuff about ide-something assuming 50Mhz and I 
you have to do is add another kernel parameter=xx. So I tried 10,15,20,25 all 
with the same results... Hang.<BR>So recompiled the kernels and put back the old 
mfm/rll/ide disc suppot. The help said something about the old 486's having 
problems sometimes with the newer fancy module. And W-A-A-L-A-A-H-H I now see 
Donald Becker. ne.c:v1.10 9/23/94 Donald Becker (<A 
href="mailto:becker@cesdis.gsfc.nasa.gov">becker@cesdis.gsfc.nasa.gov</A>)<BR>NE*000 
ethercard probe at 0x280: 00:40:05:3f:20:d6 ... yes I know... It's just a backup 
card. I'll put the other one back when it starts working.<BR>eth0: NE2000 found 
at 0x280, using IRQ 9.<BR>_</FONT></DIV>
<DIV>&nbsp;</DIV><FONT face=Arial size=2>
<DIV><BR>and thats as far as I've gotten. So far.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Do any of the the kernel hacker type folks got any ideas what I can do 
next?</DIV>
<DIV>&nbsp;</DIV>
<DIV>I Think I'll try the doing the debug thing but I've never done it yet and 
really don't know where to start. But I'm getting a little sleeply know so I 
think I'm going to just rest my head for a while.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Thanks in Advance<BR>Eddy Cornu </FONT></DIV></BODY></HTML>