Date: Tue, 4 Mar 2008 10:58:41 +0100
From: Pierre Ossman <>
Subject: Re: Bugs in MMC [was: [Bug 10030] Suspend doesn't work when SD card is inserted]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/4/123

On Tue, 4 Mar 2008 01:44:09 -0800
David Brownell <david-b@pacbell.net> wrote:
> On Monday 03 March 2008, Pierre Ossman wrote:
> > On Mon, 3 Mar 2008 13:59:37 -0800
> > David Brownell <david-b@pacbell.net> wrote:
> > 
> > > 
> > > Card insert/remove events can be system wake events though.  Which
> > > makes that restriction impractical.
> 
> This part seems to be ignored by your comment ... wake events.
>
How so? How is a wake caused by the MMC controller different than any other source?
> 
> That is, the MMC core doesn't understand wakeup events.
> 
> Or, as pointed out elsewhere, well-behaved MMC hosts ... which don't
> need either such reprobing or the associated remove-on-suspend.
> 
You need well behaved _systems_, not just hosts to achieve that guarantee. SDHCI controllers have the ability to wake up the system on card removal, but there is zero guarantee that the platform actually wired the controller up in a way that actually allows it to do this. Throw suspend to disk, where the system might completely lose power, into the mix and you're completely screwed.
So for the default behaviour to change, we need one of two things:
- Certainty that removals cannot go unnoticed. (even then, you also need wakeup latency guarantees)
- Ability to detect a removal after the fact.
For the general case, the first one is impossible given todays hardware. The second might be solvable, but noone has done the work.
(If your complete system can satisfy the first option, feel free to add the "unsafe" option to you defconfig, but that is hardly adequate reason to have it on by default.)
Rgds
-- 
     -- Pierre Ossman
  Linux kernel, MMC maintainer        
http://www.kernel.org
  PulseAudio, core developer          
http://pulseaudio.org
  rdesktop, core developer          
http://www.rdesktop.org