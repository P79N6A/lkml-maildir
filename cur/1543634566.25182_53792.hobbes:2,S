Date: Fri, 21 Jun 2002 13:07:47 +0200
From: Kurt Garloff <>
Subject: New SCSI exc handlers: Returning cmnds?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/6/21/65

Hi,
converting the dc395x_trm (Tekram DC3x5 / TRM-S1040) to new exception
handling, I wonder what needs to be done with queued commands when
eh_abort_handler() or eh_bus_reset_handler() are called.
In the old abort handler, I was feeding the command back with DID_ABORT
and call scsi_done() on it, if successful.
In the old reset handler, I was feeding all commands (including the one that
was passed when _reset was called) that were sitting in the host adapter
driver's queue  with DID_RESET back to midlayer by calling scsi_done() on
them. 
How should this handled in the new EH code?
Is the new EH code implicitly aborting the commands, so I don't have to
do it? 
Is the ML prepared to have scsi_done() called when doing EH?
Or do I have to use some bottom half/tasklet ... type of mechanism?
Do I have to give the cmnds in queueing order, or does the ML take care
of the correct ordering?
http://www.andante.org/scsi_error.html
is scarily ignorant on that subject.
Thanks for advice!
-- 
Kurt Garloff  <garloff@suse.de>                          Eindhoven, NL
GPG key: See mail header, key servers         Linux kernel development
SuSE Linux AG, Nuernberg, DE                            SCSI, Security
[unhandled content-type:application/pgp-signature]