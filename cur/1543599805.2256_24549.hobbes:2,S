Date: Thu, 30 Aug 2001 18:27:51 +0400
From: Nikita Danilov <>
Subject: [PATCH]: reiserfs: E-pathrelse.patch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/8/30/250

Hello, Linus,
   This patch adds missing call to pathrelse() to error path in 
   reiserfs_do_truncate(). Without pathrelse(), buffers involved
   into balancing by some process remain locked and can deadlock 
   another process.
This patch is against 2.4.10-pre2.
Please apply.
Nikita.
diff -rup linux/fs/reiserfs/stree.c linux.patched/fs/reiserfs/stree.c
--- linux/fs/reiserfs/stree.c	Sat Jul 21 21:05:18 2001
+++ linux.patched/fs/reiserfs/stree.c	Tue Aug  7 19:52:32 2001
@@ -1857,6 +1857,7 @@ void reiserfs_do_truncate (struct reiser
 	return;
     }
     if (retval == POSITION_FOUND || retval == FILE_NOT_FOUND) {
+	pathrelse (&s_search_path);
 	reiserfs_warning ("PAP-5660: reiserfs_do_truncate: "
 			  "wrong result %d of search for %K\n", retval, &s_item_key);
 	return;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/