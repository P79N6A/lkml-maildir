Date: Fri, 05 Mar 2004 18:00:08 +0100
From: François Chenais <>
Subject: kernel 2.6.3 hdparm : HDIO_SET_DMA failed: Operation not permitted
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/3/5/115

Hello, 
Since I use kernel 2.6.3, my disk has very low performance 
If I do nothing during about 30 sec, the system takes about 3 sec before
reaction because the disk seems awakened.
So I asked around me how to tune it using hdparm but 
i have the following errors when setting on dma (logs bellow). 
Some persons around me have the same feeling of lowest performances.
Perhaps my kernel .config has some bad values because I have no
experience in disk tuning (see attached file).
I use 
   - debian sid on a NEC VERSA L320 laptop with a 'home built' kernel. 
   - preemptive mode 
   - ACPI
	Thanks a lot in Advance if you can help me
	Hope that can help linux development.
	Sorry if I've done a mistake in my kernel conf 
        or if I've chosen the bad mailing list. 
		François
-----------------------------------------------------------------------
hdparm -d1 /dev/hda
-----------------------------------------------------------------------
/dev/hda:
 setting using_dma to 1 (on)
 HDIO_SET_DMA failed: Operation not permitted
 using_dma    =  0 (off)
-----------------------------------------------------------------------
   My Disk's informations
-----------------------------------------------------------------------
/dev/hda:
ATA device, with non-removable media
        Model Number:       TOSHIBA MK3017GAP                       
        Serial Number:      224A3455T           
        Firmware Revision:  A0.04 A 
Standards:
        Supported: 5 4 3 2 
        Likely used: 6
Configuration:
        Logical         max     current
        cylinders       16383   16383
        heads           16      16
        sectors/track   63      63
        --
        CHS current addressable sectors:   16514064
        LBA    user addressable sectors:   58605120
        device size with M = 1024*1024:       28615 MBytes
        device size with M = 1000*1000:       30005 MBytes (30 GB)
Capabilities:
        LBA, IORDY(can be disabled)
        bytes avail on r/w long: 46     Queue depth: 1
        Standby timer values: spec'd by Vendor, no device specific
minimum
        R/W multiple sector transfer: Max = 16  Current = 16
        Advanced power management level: unknown setting (0x0080)
        DMA: sdma0 sdma1 sdma2 mdma0 mdma1 mdma2 udma0 udma1 udma2 udma3
*udma4 
             Cycle time: min=120ns recommended=120ns
        PIO: pio0 pio1 pio2 pio3 pio4 
             Cycle time: no flow control=120ns  IORDY flow control=120ns
Commands/features:
        Enabled Supported:
           *    NOP cmd
           *    READ BUFFER cmd
           *    WRITE BUFFER cmd
           *    Host Protected Area feature set
           *    Look-ahead
                Write cache
           *    Power Management feature set
                Security Mode feature set
           *    SMART feature set
                SET MAX security extension
           *    Advanced Power Management feature set
Security: 
        Master password revision code = 65534
                supported
        not     enabled
        not     locked
        not     frozen
        not     expired: security count
        not     supported: enhanced erase
        36min for SECURITY ERASE UNIT. 
HW reset results:
        CBLID- above Vih
        Device num = 0 determined by the jumper
Checksum: correct
-----------------------------------------------------------------------
-- 
Debian SID
Linux tanna 2.6.3 #1 Tue Feb 24 03:06:51 CET 2004 i686 GNU/Linux
Linux Counter #59413
PGP fingerprint : 9AFA 15EC 96C9 F607 EBC1  DD41 70C5 F0E0 25A5 105B
[unhandled content-type:application/x-gzip]