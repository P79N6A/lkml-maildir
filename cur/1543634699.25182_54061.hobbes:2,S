Date: Mon, 24 Jun 2002 08:55:26 +0300
From: Muli Ben-Yehuda <>
Subject: PATCH: drivers/sound/trident.c [2/2] missing unlock on error path
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/6/24/17

Hello, 
Here's the second trident.c patch, to 
* add a missing unlock on an error path
* remove a superflous lock() - nothing - unlock() pair. 
Patch was sent to maintainer who replied that he no longer maintains
the driver. 
Patch against 2.4.19pre9. 
--- linux-2.4.19-pre9/drivers/sound/trident.c	Sun Jun 23 07:34:35 2002
+++ linux-2.4.19-pre9-mx/drivers/sound/trident.c	Sun Jun 23 07:44:57 2002
@@ -36,6 +36,10 @@
  *	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
  *
  *  History
+ *  v0.14.9.f
+ *      June 23 2002 Muli Ben-Yehuda <mulix@actcom.co.il>
+ *      add a missing unlock_set_fmt, remove a superflous lock/unlock pair 
+ *      with nothing in between. 
  *  v0.14.9e
  *      June 21 2002 Muli Ben-Yehuda <mulix@actcom.co.il> 
  *      use a debug macro instead of #ifdef CONFIG_DEBUG, trim to 80 columns 
@@ -180,7 +184,7 @@
 
 #include <linux/pm.h>
 
-#define DRIVER_VERSION "0.14.9e"
+#define DRIVER_VERSION "0.14.9f"
 
 /* magic numbers to protect our data structures */
 #define TRIDENT_CARD_MAGIC	0x5072696E /* "Prin" */
@@ -2263,6 +2267,7 @@
 						{
 							printk(KERN_ERR "trident: Record is working on the card!\n");
 							ret = -EBUSY;
+							unlock_set_fmt(state); 
 							break;
 						}
 
@@ -2697,9 +2702,6 @@
 
 	if (file->f_mode & FMODE_WRITE) {
 		stop_dac(state);
-		lock_set_fmt(state);
-
-		unlock_set_fmt(state);
 		dealloc_dmabuf(state);
 		state->card->free_pcm_channel(state->card, dmabuf->channel->num);
 [unhandled content-type:application/pgp-signature]