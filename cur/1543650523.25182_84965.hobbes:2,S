Date: Wed, 30 Oct 2002 16:20:03 -0500 (EST)
From: Bill Davidsen <>
Subject: Re: [PATCH] IPC SMP race: msgrcv may not return before msgsnd is done
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/30/213

On Wed, 30 Oct 2002, Bernhard Kaindl wrote:
> this is targeted to System V message queue Experts and people who
> use System V message queues quite extensively in SMP environments.
> 
> It contains descriptions of a SMP race in sys_msgrcv, a fix for
> it and some questions about the code in question(maybe there is
> a better fix, but I think the proposed one is ok)
> 
> I've already a short feedback from Andi Kleen, he told me that
> the Description and patch seem to be correct as far as he can see.
I'll try it, I have a program which gets a lockup rather than an oops, but
it may be related.
> Neale Ferguson from Software AG debugged a SMP race in the message
> queue implementation of the 2.4 Kernel.
> 
> The race was triggered in a time frame of 20 minutes to 14 hours after
> starting a complex application stress test which uses message queues
> quite extensively.
One of the test loads in the responsiveness test creates a ring of Ncpu+1
process which pass tokens in a ring using message queues, passing Ncpu
tokens at a time. I guess that might resemble "quite extensively" ;-) I
also note the tokens/sec going through a single process, that would show
any performance impact of the patch.
However, if this prevents the occasional lockup it will probably go in my
working kernel, unfortunately this is "occasional" so I won't know right
away.
-- 
bill davidsen <davidsen@tmr.com>
  CTO, TMR Associates, Inc
Doing interesting things with little computers since 1979.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/