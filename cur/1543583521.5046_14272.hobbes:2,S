Date: Thu, 1 Mar 2001 21:56:23 +0100 (MET)
From: Roman Zippel <>
Subject: Re: [CFT][PATCH] Re: fat problem in 2.4.2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/3/1/185

Hi,
On Thu, 1 Mar 2001, Alexander Viro wrote:
> +static int generic_vm_expand(struct address_space *mapping, loff_t size)
> +{
> +	struct page *page;
> +	unsigned long index, offset;
> +	int err;
> +
> +	if (!mapping->a_ops->prepare_write || !mapping->a_ops->commit_write)
> +		return -ENOSYS;
> +
> +	offset = (size & (PAGE_CACHE_SIZE-1)); /* Within page */
> +	index = size >> PAGE_CACHE_SHIFT;
For affs I did basically the same with a small difference:
	offset = ((size-1) & (PAGE_CACHE_SIZE-1)) + 1;
	index = (size-1) >> PAGE_CACHE_SHIFT;
That works fine here and allocates a page in the cache more likely to be
used.
bye, Roman
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/