Date: Tue, 26 Feb 2008 17:31:05 -0800 (PST)
From: David Rientjes <>
Subject: Re: [patch 5/6] mempolicy: add MPOL_F_RELATIVE_NODES flag
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/26/542

On Tue, 26 Feb 2008, David Rientjes wrote:
> 			MPOL_PREFERRED | MPOL_F_RELATIVE_NODES
> 			--------------------------------------
> 	mems	nodemask	result		rebind		result[***]
> 	1-3	0		1		0		1
> 	1-3	2		3		4-7		3
> 	1-3	5		3		0-7		3
> 
I'll fold the following patch into my next posting that corrects this 
error as follows:
			MPOL_PREFERRED | MPOL_F_RELATIVE_NODES
			--------------------------------------
	mems	nodemask	result		rebind		result
	1-3	0		1		0		0
	1-3	2		3		4-7		6
	1-3	5		3		0-7		5
---
 mm/mempolicy.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)
diff --git a/mm/mempolicy.c b/mm/mempolicy.c
--- a/mm/mempolicy.c
+++ b/mm/mempolicy.c
@@ -1809,8 +1809,7 @@ static void mpol_rebind_policy(struct mempolicy *pol,
 		} else if (relative_nodes) {
 			mpol_relative_nodemask(&tmp, &pol->w.user_nodemask,
 					       newmask);
-			pol->v.preferred_node = node_remap(pol->v.preferred_node,
-					pol->w.cpuset_mems_allowed, tmp);
+			pol->v.preferred_node = first_node(tmp);
 		} else {
 			pol->v.preferred_node = node_remap(pol->v.preferred_node,
 					pol->w.cpuset_mems_allowed, *newmask);