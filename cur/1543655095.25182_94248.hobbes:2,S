Date: Fri, 06 Dec 2002 14:26:30 +1100
From: Rusty Trivial Russell <>
Subject: [TRIVIAL] Re: setrlimit incorrectly allows hard limits to exceed soft limits
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/12/5/195

From:  Kingsley Cheung <kingsley@aurema.com>
  Oops, should be after the copy :-(
> In 2.4.19 (also 2.5.46) setrlimit code only ever makes a comparison to
> check the old soft limit with the new soft limit and the new hard
> limit with the old hard limit.  There is never a check to ensure the
> new soft limit never exceeds the new hard limit. 
> 
> Just try "ulimit -H -m 10000" for memory limits that were not
> previously set.  You end up with (hard limit = 10000) < (soft limit =
> unlimited).
> 
> Fix is trivial.
--- trivial-2.5-bk/kernel/sys.c.orig	2002-12-06 13:56:43.000000000 +1100
+++ trivial-2.5-bk/kernel/sys.c	2002-12-06 13:56:43.000000000 +1100
@@ -1233,6 +1233,8 @@
 		return -EINVAL;
 	if(copy_from_user(&new_rlim, rlim, sizeof(*rlim)))
 		return -EFAULT;
+       if (new_rlim.rlim_cur > new_rlim.rlim_max)
+               return -EINVAL;
 	old_rlim = current->rlim + resource;
 	if (((new_rlim.rlim_cur > old_rlim->rlim_max) ||
 	     (new_rlim.rlim_max > old_rlim->rlim_max)) &&
-- 
  Don't blame me: the Monkey is driving
  File: Kingsley Cheung <kingsley@aurema.com>: Re: [PATCH] setrlimit incorrectly allows hard limits to exceed soft limits
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/