Date: Sat, 03 Apr 2004 07:51:44 -0500
From: Bill Davidsen <>
Subject: Re: 2.6.4 : 100% CPU use on EIDE disk operarion, VIA chipset
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/4/3/27

Andreas Hartmann wrote:
> Mikhail Ramendik wrote:
> 
>> Hello,
>>
>> I have an computer with an AMD Duron, and the motehrboard chipset is VIA
>> KT133. The hard drive is a Seagate Barracuda 7200.7 ; no other EIDE
>> devices are attached.
>>
>> I run an RH9-based distro, and added a 2.6.4 kernel to it. The following
>> problem was tested with two kernel variants: 2.6.4+wolk2/0 with
>> preeemption enabled, and 2.6.4 plain from kernel.org with preemption
>> disabled. No difference.
>>
>> I noticed performance problems with 2.6.4, and tracked them to strange
>> HDD behavior.
>>
>> It turned out that on disk-intensive operation, the "system" CPU usage
>> skyrockets. With a mere "cp" of a large file to the same direstory
>> (tested with ext3fs and FAT32 file systems), it is 100% practically all
>> of the time !
> 
> 
> Which tool do you use for measure? xosview?
> 
> I'm having here the same problem. But it depends on the tool which is 
> used for measuring. If I use top from procps 3.2, I can't see this high 
> system load. "time" can't see it, too.
> 
> This is what top says during cp of 512MB-file:
> Cpu(s):  2.0% us,  8.3% sy,  0.0% ni,  0.0% id, 89.0% wa,  0.7% hi,  
> 0.0% si
> 
> New is "wa", what probably means "wait". This value is very high as long 
> as the HD is writing or reading datas:
> 
> cp dummy /dev/null
> produces this top-line:
> Cpu(s):  3.0% us,  5.3% sy,  0.0% ni,  0.0% id, 91.0% wa,  0.7% hi,  
> 0.0% si
Yes "wa" is not intuitive, some other operating systems use "wio" for 
"wait i/o" time. As noted in the other thread, you can try the deadline 
elevator or increased readahead for your load.
> 
> and time says:
> real    0m53.195s
> user    0m0.013s
> sys     0m2.124s
> 
> 
> But you're right, 2.6.4 is slower than 2.4.25. See the thread "Very poor 
> performance with 2.6.4" here in the list.
Much discussed, not overly fixed :-(
-- 
bill davidsen <davidsen@tmr.com>
   CTO TMR Associates, Inc
   Doing interesting things with small computers since 1979
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/