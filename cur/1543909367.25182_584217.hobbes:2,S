Date: Tue, 14 Aug 2007 14:51:09 +0800
From: WU Fengguang <>
Subject: Re: [PATCH] PSS(proportional set size) accounting in smaps
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/14/69

On Tue, Aug 14, 2007 at 10:57:31AM +0530, Balbir Singh wrote:
> I keep forgetting to check that you are on the cc. My email client
> loves dropping you from the to/cc list.
hehe, sorry for my crappy smtp server ;)
> Fengguang Wu wrote:
> > The "proportional set size" (PSS) of a process is the count of pages it has in
> > memory, where each page is divided by the number of processes sharing it. So if
> > a process has 1000 pages all to itself, and 1000 shared with one other process,
> > its PSS will be 1500.
> >                - lwn.net: "ELC: How much memory are applications really using?"
> > 
> > The PSS proposed by Matt Mackall is a very nice metic for measuring an process's
> > memory footprint. So collect and export it via /proc/<pid>/smaps.
> > 
> > Matt Mackall's pagemap/kpagemap and John Berthels's exmap can also do the job,
> > providing pretty much details.  But for PSS, let's do it in a simple way. 
> > 
> > Cc: Matt Mackall <mpm@selenic.com>
> > Cc: John Berthels <jjberthels@gmail.com>
> > Signed-off-by: Fengguang Wu <wfg@mail.ustc.edu.cn>
> 
> I like the idea of moving towards PSS. I had sent some patches back in December
> last year
> 
> 
http://marc.info/?l=linux-mm&m=116738715329816&w=4
Thank you. That's a pretty comprehensive work.
> > -		if (page_mapcount(page) >= 2) {
> > +		mapcount = page_mapcount(page);
> > +		if (mapcount >= 2) {
> 
> This accounting is of-course racy. Mapcount can change any moment.
Sure it is: I never expect to provide accurate numbers.
The mapcount here is to prevent divide-by-zero errors.
> If we are reasonably sure that mapping will not change at the time
> of page_rmap_xxxxx() operations, we could handle shared accounting
> at those points and implement accurate shared accounting.
That would be desirable, if only we can keep the cost low ;)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/