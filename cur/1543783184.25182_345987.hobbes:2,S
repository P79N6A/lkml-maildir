Date: Wed, 31 Aug 2005 21:00:23 +0200
From: Wim Van Sebroeck <>
Subject: Re: Fw: suspicious behaviour in pcwd driver.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/8/31/207

Hi Dave,
> drivers/char/watchdog/pcwd.c does this if it detects
> a temperature out of range..
> 
>             if (temp_panic) {
>                 printk (KERN_INFO PFX "Temperature overheat trip!\n");
>                 machine_power_off();
>             }
> 
> Two problems here are..
> 
> 1. machine_power_off() isn't exported on ppc64. (patch below)
> 2. that printk will never hit the logs, so the admin will just find
> a powered off box with no idea what happened.
> Should we at least sync block devices before doing the power off ?
First you need to enable the "temp_panic" by setting the WDIOS_TEMPPANIC 
option flag. (I'm curious who actually uses this and when they use this, but 
that is something totally different). And then you need to read the card's
status before this piece of code will be triggered.
So in my opinion this isn't used a lott and is simply an option to protect 
your hardware. But your comment is valid: chances that the warning is written 
to the log files is very small.
So I think that it might indeed be better to sync most devices if that can be 
done in a few seconds...
Greetings,
Wim.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/