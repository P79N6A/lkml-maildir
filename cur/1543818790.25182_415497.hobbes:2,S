Date: Wed, 12 Apr 2006 16:48:06 -0500
From: Kylene Jo Hall <>
Subject: [PATCH] tpm: check mem start and len
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/4/12/180

The memory start and length values obtained from the ACPI entry need to
be checked and filled in with the default values from the specification
if they don't exist.  This patch fills in the default values and uses
them appropriately.
Signed-off-by: Kylie Hall <kjhall@us.ibm.com>
---
 drivers/char/tpm/tpm_tis.c |    7 +++++++
 1 files changed, 7 insertions(+)
--- linux-2.6.17-rc1-mm2/drivers/char/tpm/tpm_tis.c	2006-04-12 16:39:40.191345000 -0500
+++ linux-2.6.17-rc1/drivers/char/tpm/tpm_tis.c	2006-04-12 14:49:13.033173500 -0500
@@ -52,6 +52,8 @@ enum tis_int_flags {
 };
 
 enum tis_defaults {
+	TIS_MEM_BASE = 0xFED4000,
+	TIS_MEM_LEN = 0x5000,
 	TIS_SHORT_TIMEOUT = 750, /* ms */
 	TIS_LONG_TIMEOUT = 2000, /* 2 sec */
 };
@@ -437,6 +439,11 @@ static int __devinit tpm_tis_pnp_init(st
 	start = pnp_mem_start(pnp_dev, 0);
 	len = pnp_mem_len(pnp_dev, 0);
 
+	if (!start)
+		start = TIS_MEM_BASE; 
+	if (!len)
+		len = TIS_MEM_LEN;
+
 	if (!(chip = tpm_register_hardware(&pnp_dev->dev, &tpm_tis)))
 		return -ENODEV;
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/