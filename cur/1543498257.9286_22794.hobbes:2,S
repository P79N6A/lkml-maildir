Date: Tue, 08 Jun 1999 18:19:41 MET DST
From: "Giuliano Pochini" <>
Subject: Re: Removable media bug
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/6/8/144

>Try the attached code. Run it after inserting new media, before trying
>any
>mounts, etc.  It will force a reread of the partition table, that also
>will flush all the cached info about the disk. (I think -- worked for
>me a while back.)
It does not work. Well... sometimes it re-reads the partition table,
but I can do the same by attempting to mount the device without a disk
in the drive. Anyway when I try to mount a partition it tells the the
ext2 fs is corrupted etc. etc...
I can't understand why. When the kernel detects a diskchange it should
invalidate all buffers, isn't it ??  I looked at the sources and it
actually does it. So why it doesn't works ?!?!  GRRRR!!!
And another little thing: why it never prints disk change events in
the logs ?  I added some printk's in sd.c to trace the problem, and I
forgot to add a "\n" somewhere. well... magically appeared messages
like "MyDebugStuff<7>VFS: Disk change detected [...]". Why ?  Perhaps
is there a trick to enable some debug messages ?
Bye.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/