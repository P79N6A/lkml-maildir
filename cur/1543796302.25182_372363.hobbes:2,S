Date: Fri, 02 Dec 2005 15:04:10 -0600
From: Thomas Gall <>
Subject: MTD: fix possible starvation in cfi_cmdset_0001.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/2/129

The patch below fixes a potential starvation issue that can arise when
there is contention on a chip during a period when a process is
currently writing to it.  The starvation is avoided by conditionally
rescheduling when the chip is left in a state usable by other processes.
Please CC Josh and myself and replies.  Thanks!
Signed-off-by: Josh Boyer <jdub@us.ibm.com>
Signed-off-by: Tom Gall <tom_gall@vnet.ibm.com>
 drivers/mtd/chips/cfi_cmdset_0001.c |    5 +++++
 1 files changed, 5 insertions(+)
Index: mtd/drivers/mtd/chips/cfi_cmdset_0001.c
===================================================================
--- mtd.orig/drivers/mtd/chips/cfi_cmdset_0001.c	2005-11-07 15:04:33.000000000 -0600
+++ mtd/drivers/mtd/chips/cfi_cmdset_0001.c	2005-11-08 08:54:54.000000000 -0600
@@ -1695,6 +1695,11 @@ static int cfi_intelext_writev (struct m
 			if (chipnum == cfi->numchips)
 				return 0;
 		}
+
+		/* Be nice and reschedule with the chip in a usable state for other
+		   processes. */
+		cond_resched();
+
 	} while (len);
 	return 0;
-- 
Linux Technology Center
Senior Software Engineer, - Embedded Linux                                              
w) tom_gall@vnet.ibm.com    553-4558
h) tgall@uberh4x0r.org
"We want great men who, when fortune frowns, will not be discouraged." 
-- Colonel Henry Knox
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/