Date: Thu, 15 May 2003 23:49:10 +0100
From: Adam Mercer <>
Subject: [PATCH] Fix vesafb with large memory, this time properly
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/5/15/261

Marcelo
Thanks for apply my previous patch, but Geert Uytterhoeven noticed the
following problem with it
> video_size must be in bytes, hence it must be
> 
> video_size = screen_info.lfb_width*screen_info.lfb_height*video_bpp/8;
The attached patch, against 2.4.21-rc2, fixes this
Cheers
Adam
diff -urN linux-2.4.21-rc2/drivers/video/vesafb.c linux-2.4.21-rc2-patched/drivers/video/vesafb.c
--- linux-2.4.21-rc2/drivers/video/vesafb.c	2003-05-15 07:42:55.000000000 +0100
+++ linux-2.4.21-rc2-patched/drivers/video/vesafb.c	2003-05-15 07:39:53.000000000 +0100
@@ -520,7 +520,7 @@
 	video_width         = screen_info.lfb_width;
 	video_height        = screen_info.lfb_height;
 	video_linelength    = screen_info.lfb_linelength;
-	video_size          = screen_info.lfb_width *	screen_info.lfb_height * video_bpp;
+	video_size          = screen_info.lfb_width *	screen_info.lfb_height * video_bpp / 8;
 	video_visual = (video_bpp == 8) ?
 		FB_VISUAL_PSEUDOCOLOR : FB_VISUAL_TRUECOLOR;
 