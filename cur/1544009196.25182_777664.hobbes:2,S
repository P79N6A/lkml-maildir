Date: Sat, 6 Dec 2008 16:09:04 +0530
From: Balbir Singh <>
Subject: Re: [PATCH] introduce get_mm_hiwater_xxx(), fix taskstats->hiwater_xxx accounting
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/6/48

* Hugh Dickins <hugh@veritas.com> [2008-12-06 09:56:19]:
> On Sat, 6 Dec 2008, Balbir Singh wrote:
> > 
> > Yes, true and getdelays can display all the exported information.
> > 
> > The race does seem concerning, I would vote for keeping the update in
> > there and disabling preemption around the update, so that hiwater
> > cannot swing back and forth.
> 
> ??  Oleg is _fixing_ a race by removing the update from do_exit();
> and he is fixing the way the hiwater info was collected in tsacct.c.
I see that change and the reasoning seems accurate that we can query
the task at anytime, but I worry that if taskstats is not enabled, we'll
never call update_hiwater.* on the exiting task. 
I wonder if a thread came in and like Oleg said, did (without taskstats
enabled)
free(malloc(some size)), followed by exit()
whether task_mem() would show the correct results for hiwater.*. I
should try it out and look more closely at the code as well.
-- 
	Balbir