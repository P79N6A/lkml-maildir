Date: Mon, 29 Jan 2007 14:58:59 -0500
From: Mike Frysinger <>
Subject: [patch] translate dashes in filenames for headers install
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/29/215

--nextPart10179547.8WxpbZO3dJ
Content-Type: text/plain;
  charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
the current filename->define translation does not scrub dashes so when=20
creating stub defines for like asm-x86_64/ptrace-abi.h, we get:
#define __ASM_STUB_PTRACE-ABI_H
gcc just hates that sort of thing :)
trivial attached patch adds - to the tr list to scrub it to _
=2Dmike
--nextPart10179547.8WxpbZO3dJ
Content-Type: application/pgp-signature
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.1 (GNU/Linux)
iQIVAwUARb5SBEFjO5/oN/WBAQL+aw/+Kk6qBfgeeLYmW9kJqBD9e2jfD2RORiga
W+MuOr/kEaUXJ1KT45jWaZ3kl2WOBRNCfrmMfRYR7wMRquyKYxcrd5kB62oX17nD
E0QtM0LRxR+8UNQtLiRbRddoJjlL/THBhlGTxWt46LUDfYys3mcER5VwX5dZWolm
bUlWtcbqe4KTEDY87Mea1sF+pmInwc3SnOm/vm9SZM/UXax95HlkVABBYXLXuiYr
ivUZ6Wqbu3HhOFbaEFyNG11wt462sQM6e6Hioy2Fr4bnQ7hLfH4r0AT35Y3QTHXH
Ol/jkjm8RWf5agw/SoevttN7put4Pd3MDLH8n+OHe5/vbxrIhErtYHF/j7/8oqKL
OHFRUWPcuyzAjhADsK9Cwsl4HOEVeMudJ3duUkVs9KIOIyHxQLgPvVfgSqNHdxr0
/0pZPsFkeGYi3XdOwoB+fn7zwNTBGBj8qEq5FOcWHnIHxU5hwavWIqLmFTRcW11r
tvSblxZRUIEBnS3dL4jd9Nr0g2Hx3+eyTvWNsjbuVHc9tkEduN4sCXRqr5U0MTL2
gbB2o58FDx1iEiaUJ+xSR9n/2r6yYTUHwV6Lu3fod9EBhotKD/qdwKK1i2NqNd/G
0gRCJMp2knEK5v7Kwk198wTXc7juGHP4WxJvcDW+wFQY0qO8HMKyx5JopnwOVrOX
8+/AOpPdi78=
=htxo
-----END PGP SIGNATURE-----
--nextPart10179547.8WxpbZO3dJ--
Make sure we translate dashes in file names to underscores for use as defines.
Signed-off-by: Mike Frysinger <vapier@gentoo.org>
--- a/scripts/Makefile.headersinst
+++ b/scripts/Makefile.headersinst
@@ -109,7 +109,7 @@ quiet_cmd_mkdir		  = MKDIR   $(patsubst $(INSTALL_HDR_PATH)/%,%,$@)
 quiet_cmd_gen		  = GEN     $(patsubst $(INSTALL_HDR_PATH)/%,%,$@)
       cmd_gen		  = \
 FNAME=$(patsubst $(INSTALL_HDR_PATH)/$(_dst)/%,%,$@)			\
-STUBDEF=__ASM_STUB_`echo $$FNAME | tr a-z. A-Z_`;			\
+STUBDEF=__ASM_STUB_`echo $$FNAME | tr a-z.- A-Z__`;			\
 (echo "/* File autogenerated by 'make headers_install' */" ;		\
 echo "\#ifndef $$STUBDEF" ;						\
 echo "\#define $$STUBDEF" ;						\