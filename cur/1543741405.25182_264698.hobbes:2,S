Date: Mon, 25 Oct 2004 22:50:19 -0400
From: Mark Lord <>
Subject: [PATCH 2.6.9-ac4] delkin_cb: one-liner fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/10/25/454

Alan,
Here's a one-liner for delkin_cb in your latest 2.6.9-ac stream.
This ensures that pci_disable_device() is invoked when the
driver exits on failure to load.
Signed-off-by: Mark Lord <mlord@pobox.com>
-- 
Mark Lord
(hdparm keeper & the original "Linux IDE Guy")
--- linux-2.6.9-ac3-delkin/drivers/ide/pci/delkin_cb.c.orig	2004-10-21 21:44:45.000000000 -0400
+++ linux/drivers/ide/pci/delkin_cb.c	2004-10-25 22:45:32.000000000 -0400
@@ -83,6 +83,7 @@
 	rc = ide_register_hw(&hw, &hwif);
 	if (rc < 0) {
 		printk(KERN_ERR "delkin_cb: ide_register_hw failed (%d)\n", rc);
+		pci_disable_device(dev);
 		return -ENODEV;
 	}
 	pci_set_drvdata(dev, hwif);