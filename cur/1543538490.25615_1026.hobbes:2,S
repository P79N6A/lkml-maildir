Date: Sun, 9 Jul 2000 01:22:42 +0200
From: Jens Axboe <>
Subject: Re: oops in 2.4.0-test3-pre6
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/8/73

On Sat, Jul 08 2000, Jean-Luc Coulon wrote:
> Hi,
> 
> I got a Oops while doing 'rmmod -a'. I done rmmod -a twice and I got
> this oops
> (non fatal) while sending the second command.
Patch attached, I missed this case when sending the last batch of
blk_init_queue/blk_cleanup_queue to Linus. sd does not need to worry
about it, it is handled by the mid level SCSI layer.
-- 
* Jens Axboe <axboe@suse.de>
* SuSE Labs
--- /opt/kernel/linux-2.4.0-test3-pre6/drivers/scsi/sd.c	Mon Jun 19 22:42:41 2000
+++ drivers/scsi/sd.c	Sun Jul  9 01:05:44 2000
@@ -1332,7 +1332,6 @@
 
 	}
 	for (i = 0; i <= (sd_template.dev_max - 1) / SCSI_DISKS_PER_MAJOR; i++) {
-		blk_cleanup_queue(BLK_DEFAULT_QUEUE(SD_MAJOR(i)));
 		blk_size[SD_MAJOR(i)] = NULL;
 		hardsect_size[SD_MAJOR(i)] = NULL;
 		read_ahead[SD_MAJOR(i)] = 0;