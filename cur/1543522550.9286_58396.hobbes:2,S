Date: Tue, 18 Jan 2000 15:47:44 +0000 (GMT)
From: Alan Cox <>
Subject: Re: [patch] 2.3.39: Don't use bounce buffer when not needed (parport)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/1/18/186

> +	size_t maxlen = 0x10000;            /* max 64k per DMA transfer */
> 
> +	/* above 16 MB we use a bounce buffer as ISA-DMA is not possible */
> +	if (buf+length <= MAX_DMA_ADDRESS)
> +		dma_addr = virt_to_bus(buf);
> +	else {
> +		dma_addr = virt_to_bus(priv->dma_buf);
> +		maxlen   = PAGE_SIZE;          /* sizeof(priv->dma_buf) */
> +	}
You are missing a test here. You also have to check if the start and end
of the block are in the same 64K range (the PC DMA controller doesnt increment
the top byte on a wrap)
Alan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/