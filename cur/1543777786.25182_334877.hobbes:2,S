Date: Mon, 18 Jul 2005 20:22:48 +0200
From: Pierre Ossman <>
Subject: Re: [PATCH] MMC host class
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/7/18/91

Russell King wrote:
>On Fri, Jul 15, 2005 at 10:21:43PM +0200, Pierre Ossman wrote:
> 
>
>>Russell King wrote:
>> 
>>
>>>Also note that since we have a class_dev, the mmc_host 'dev' field can
>>>be removed.  However, we'll probably have to update the host drivers
>>>to do this, so it should be a separate patch.
>>> 
>>>
>>I believe there's a bit of abstraction to be gained from not poking
>>around inside the class_dev struct in too many places. It's not like
>>we're wasting any large amounts of memory.
>> 
>>
>
>I still don't like the needless duplication.  How about doing it this
>way (see the attached patch.)
> 
>
The mmc_hostname macro seems like a good solution. It'll keep the
abstraction even if stuff needs to be moved around.
I see a problem with waiting until mmc_add_host() until initialising the
kobject though. If a driver calls mmc_alloc_host() and then
mmc_free_host(), perhaps because of some error, then the structure won't
be freed since we rely on release getting called. That's why I tried to
get the kobject stuff set up with the allocation.
Perhaps it is possible to test if a kobject is initialised and if not
free the structure directly?
Rgds
Pierre
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/