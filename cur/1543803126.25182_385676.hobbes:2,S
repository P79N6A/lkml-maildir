Date: Fri, 13 Jan 2006 14:24:25 +0000
From: Alan Cox <>
Subject: Re: Fwd: ide-cd turning off DMA when verifying DVD-R
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/13/141

On Gwe, 2006-01-13 at 14:33 +0100, Bartlomiej Zolnierkiewicz wrote:
> The patch was NACK-ed by Alan Cox and I agree with him (this should be
> done differently).  This __ide_dma_off() chunk looks sensible but does it fix
> the issue?  I was under impression that after a reset drive looses its DMA
> xfer mode and needs to be reprogrammed (ATA spec has the answer).
Yes and the behaviour is determined by hdparm -k/-K. Its all a bit
random after a CRC error however as the recovery code does a polling
speed change and the locking versus timers/irq's is totally broken.
I did some minimal fixes in the older -ac patches but even with all the
other locking cleanup I did back then this one remained. Essentially the
old IDE layer needs to switch from polled speed changes in task context
to issuing speed changes as state machine sequences.
Thats non trivial
Alan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/