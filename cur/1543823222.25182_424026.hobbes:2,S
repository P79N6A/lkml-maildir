Date: Mon, 15 May 2006 21:52:10 +0200
From: "Rafael J. Wysocki" <>
Subject: Re: [PATCH -mm] swsusp: support creating bigger images (rev. 2)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/15/295

Hi,
On Monday 15 May 2006 11:48, Con Kolivas wrote:
> On Sunday 14 May 2006 08:33, Rafael J. Wysocki wrote:
> > On Friday 12 May 2006 12:30, Pavel Machek wrote:
> > > > Please also remember that you are introducing complexity in other ways,
> > > > with that swap prefetching code and so on. Any comparison in speed
> > > > should include the time to fault back in pages that have been
> > > > discarded.
> > >
> > > Well, swap prefetching is useful for other workloads, too; so it gets
> > > developed/tested outside swsusp.
> >
> > Still my experience indicates that it doesn't play very nice with swsusp
> > and unfortunately it hogs the I/O.
> 
> There is no swap prefetching code linked in any way to swsusp suspend or 
> resume on mainline or -mm. It was a preliminary experiment and Rafael lost 
> interest in it so I never bothered pursuing it.
I'm referring to the code currently in -mm, where kprefetchd sometimes starts
prefetching like mad after resume which hurts the disk I/O really badly (unless
I set /proc/sys/vm/swap_prefetch to 0, that is).
I think the problem is related to the fact that swsusp tends to leave quite a lot
of pages in the swap, if they had to be swapped out before suspend, and that
makes kprefetchd believe it should get these pages back into RAM, which
usually is not the greatest idea.
The above is only a speculation, however, and I'd have to investigate it a bit
more to say something more certain.  Anyway, my experience indicates
that it usually is better to set /proc/sys/vm/swap_prefetch to 0 after resume,
but YMMV.
Greetings,
Rafael
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/