Date: Wed, 05 Mar 2008 08:35:14 +0000
From: "Jan Beulich" <>
Subject: [PATCH] i386: fix merge mistake in i387.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/5/72

convert_fxsr_to_user() in 2.6.24's i387_32.c did this, and
convert_to_fxsr() also does the inverse, so I assume it's an oversight
that it is no longer being done.
Signed-off-by: Jan Beulich <jbeulich@novell.com>
---
 arch/x86/kernel/i387.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
--- linux-2.6.25-rc4/arch/x86/kernel/i387.c	2008-03-05 09:26:15.000000000 +0100
+++ 2.6.25-rc4-i386-fpu-fop/arch/x86/kernel/i387.c	2008-03-04 09:03:19.000000000 +0100
@@ -261,7 +261,7 @@ static void convert_from_fxsr(struct use
 	}
 #else
 	env->fip = fxsave->fip;
-	env->fcs = fxsave->fcs;
+	env->fcs = (u16) fxsave->fcs | ((u32) fxsave->fop << 16);
 	env->foo = fxsave->foo;
 	env->fos = fxsave->fos;
 #endif