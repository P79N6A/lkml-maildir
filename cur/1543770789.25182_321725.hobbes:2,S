Date: Mon, 30 May 2005 13:17:20 -0500
From: James Bottomley <>
Subject: Re: What breaks aic7xxx in post 2.6.12-rc2 ?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/5/30/152

On Mon, 2005-05-30 at 18:01 +0200, GrÃ©goire Favre wrote:
>  target1:0:1: Beginning Domain Validation
>  target1:0:1: Domain Validation skipping write tests
> (scsi1:A:1): 10.000MB/s transfers (10.000MHz, offset 15)
>  target1:0:1: Ending Domain Validation
Well that's good ... it proves the theory that if the DV were correctly
limited initially, everything would work.
However ... lets see if we can get it to work properly even with the
initial mismatch.  Reverse the previous patch, apply this one and try
rebooting ...
Thanks,
James
--- a/drivers/scsi/scsi_error.c
+++ b/drivers/scsi/scsi_error.c
@@ -1230,6 +1230,9 @@ static void scsi_eh_offline_sdevs(struct
 				scmd->device->channel,
 				scmd->device->id,
 				scmd->device->lun);
+		/* try to reset the bus and the card to a sane state */
+		scsi_try_bus_reset(scmd);
+		scsi_try_host_reset(scmd);
 		scsi_device_set_state(scmd->device, SDEV_OFFLINE);
 		if (scsi_eh_eflags_chk(scmd, SCSI_EH_CANCEL_CMD)) {
 			/*
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/