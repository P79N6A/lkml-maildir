Date: Mon, 24 Mar 2003 20:34:54 -0800
From: Greg KH <>
Subject: Re: Linux 2.5.66
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/3/24/365

On Tue, Mar 25, 2003 at 03:18:03PM +1100, CaT wrote:
> On Mon, Mar 24, 2003 at 04:30:48PM -0800, Greg KH wrote:
> > Yes, I sent out some patches a few evenings ago to lkml that should fix
> > this problem.  I'm resyncing them with 2.5.66 right now and will send
> > them to Linus in a bit.
> 
> I have an oops of my very own to report, and this one is with the afore
> mentioned patches applied:
> 
> mice: PS/2 mouse device common for all mice
> logimb.c: Didn't find Logitech busmouse at 0x23c
> input: PC Speaker
> input: PS/2 Synaptics Touchpad on isa0060/serio1
> serio: i8042 AUX port at 0x60,0x64 irq 12
> input: AT Set 2 keyboard on isa0060/serio0
> serio: i8042 KBD port at 0x60,0x64 irq 1
> i2c-dev.o: i2c /dev entries driver module version 2.7.0 (20021208)
> i2c-proc.o version 2.7.0 (20021208)
> i2c-pixx4 version 2.7.0 (20021208)
> piix4 smbus 00.07.3: Found Intel Corp. 82371AB/EM/MB PIIX4  device
> Unable to handle kernel NULL pointer dereference at vertual address 00000000
Do you have the patches I just sent out a few hours ago?
You will need the last one, I've attached it here.  Let me know if it
fixes this or not.
thanks,
greg k-h
ChangeSet 1.985.1.4, 2003/03/24 15:16:12-08:00, greg@kroah.com
[PATCH] i2c: set up a "generic" i2c driver to prevent oopses when devices are registering.
This is needed as we are still not using the driver core model for
matching up devices to drivers, but doing it by hand.  Once that is
changed, this will not be needed.
 drivers/i2c/i2c-core.c |    9 +++++++++
 1 files changed, 9 insertions(+)
diff -Nru a/drivers/i2c/i2c-core.c b/drivers/i2c/i2c-core.c
--- a/drivers/i2c/i2c-core.c	Mon Mar 24 17:26:51 2003
+++ b/drivers/i2c/i2c-core.c	Mon Mar 24 17:26:51 2003
@@ -65,6 +65,14 @@
 	return 0;
 }
 
+static struct device_driver i2c_generic_driver = {
+	.name =	"i2c",
+	.bus = &i2c_bus_type,
+	.probe = i2c_device_probe,
+	.remove = i2c_device_remove,
+};
+
+
 /* ---------------------------------------------------
  * registering functions 
  * --------------------------------------------------- 
@@ -106,6 +114,7 @@
 	if (adap->dev.parent == NULL)
 		adap->dev.parent = &legacy_bus;
 	sprintf(adap->dev.bus_id, "i2c-%d", i);
+	adap->dev.driver = &i2c_generic_driver;
 	device_register(&adap->dev);
 
 	/* inform drivers of new adapters */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/