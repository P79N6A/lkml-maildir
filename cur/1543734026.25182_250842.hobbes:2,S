Date: Fri, 10 Sep 2004 13:28:57 +0800
From: "Antonino A. Daplas" <>
Subject: Re: [Linux-fbdev-devel] fbdev broken in current bk for PPC
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/10/12

On Friday 10 September 2004 10:23, Benjamin Herrenschmidt wrote:
> Recent changes upstream are breaking fbdev on pmacs.
>
> I haven't had time to go deep into that (but I suspect Linus sees it
> too on his own g5 unless he removed offb from his .config).
>
> From what I see, it seems that offb is kicking in by default, reserves
> the mmio regions, and then whatever chip driver loads can't access them.
>
> offb is supposed to be a "fallback" driver in case no fbdev is taking
> over, it should also be "forced" in with video=ofonly kernel command
> line. This logic has been broken.
>
Hi Ben,
Actually, I was thinking about this problem with offb.  I was planning on
adding video=offb:off support for offb, and then place offb at the very top
drivers Makefile (the reason why I placed it there, but forgot to add the
setup support for offb).  So, without the 'off' option, offb becomes the
first driver that gets initialized by reason that it's at the top, and with
the 'off' option, it just exits initialization immediately, giving the other
drivers a chance to get through.
This first method is easy to add.
The second method is not harder but will involve, again, changes to all 
drivers.  The only sane method I can think of is to change fb_get_options so
it returns an error if:
a. "off" option is enabled
b. "ofonly" is enabled but only if name != "offb"
If fb_get_options returns an error, drivers will not proceed with their
initialization. The second method is more compatible with the
previous setup semantics.
I told Geert that if the changes did bite us, then I have no choice
but to add support for the second method.
So, if you think that the first method is not enough, then I will add the
second method. Let me know.
Tony
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/