Date: Sun, 25 Nov 2007 21:25:57 +0100
From: Pavel Machek <>
Subject: [patch] Re: nohz and strange sleep latencies
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/11/25/62

Hi!
Okay, so the problem seems to be we are using unreliable lapic
timer... which is stopped in C3 (and in C2 on broken machines).
I do not see any mechanism to disable lapic; there seems to be some
mechanism to work around stopped lapic timer is used (in
acpi/processor_idle.c) but it does not seem to work. So what about
this?
							Pavel
Signed-off-by: Pavel Machek <pavel@suse.cz>
diff --git a/arch/x86/kernel/apic_32.c b/arch/x86/kernel/apic_32.c
index 08b07c1..b9bf79c 100644
--- a/arch/x86/kernel/apic_32.c
+++ b/arch/x86/kernel/apic_32.c
@@ -63,8 +63,8 @@ static int enable_local_apic __initdata 
 static int local_apic_timer_verify_ok;
 /* Disable local APIC timer from the kernel commandline or via dmi quirk
    or using CPU MSR check */
-int local_apic_timer_disabled;
-/* Local APIC timer works in C2 */
+int local_apic_timer_disabled = 1;
+/* Local APIC timer works in C2: used in processor_idle.c  */
 int local_apic_timer_c2_ok;
 EXPORT_SYMBOL_GPL(local_apic_timer_c2_ok);
 
-- 
(english) 
http://www.livejournal.com/~pavelmachek
(cesky, pictures) 
http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/