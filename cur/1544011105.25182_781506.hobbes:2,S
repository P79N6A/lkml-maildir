Date: Wed, 17 Dec 2008 08:03:15 +0000
From: Al Viro <>
Subject: Re: [PATCH 7/15] sanitize AUDIT_MQ_SENDRECV
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/17/81

On Tue, Dec 16, 2008 at 11:56:56PM -0800, Andrew Morton wrote:
> > +		if (copy_from_user(&ts, u_abs_timeout, 
> > +					sizeof(struct timespec)))
> 
> Well that's odd.  afacit timespec has different sizes on 32-bit and
> 64-bit userspace.
> 
> But the old audit code did this copy too, and it presumably worked.
compat_mq_timedsend() et.al. essentially do copy_in_user() converting to
64bit and theh call sys_mq_...().  So you get kernel-native layout in
the log.
Similar for notification in compat_mq_notify(), etc.