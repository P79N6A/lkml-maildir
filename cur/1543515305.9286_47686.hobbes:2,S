Date: 08 Nov 1999 10:59:50 +0100
From: Andreas Jaeger <>
Subject: Re: devfs v136, ZIP disks and glibc-2.1.2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/8/20

>>>>> Stefan Monnier writes:
>>>>> "Andreas" == Andreas Jaeger <aj@suse.de> writes:
>> We have to check for the magic because you can have a directory
>> /dev/pts but not devpts compiled into your kernel.  Therefore we need
>> a way to know exactly if devpts is available.
Stefan> Isn't it possible to use a more direct approach where you
Stefan> use the devpts code and if the kernel burps or if the file does not
Stefan> appear under /dev/pts, you revert to the other case ?
I've digged a bit at the glibc part.  The problematic case [1] is a
kernel that has devpts support compiled in but /dev/pts is not
mounted.  
In this case
  fd = open ("/dev/ptmx", O_RDWR);
succeeds - and the return value is just an fd.  Checking if that fd
really exists and is the one that has been created by the open call
isn't going to work.
Something I don't understand from looking at the current devfs patch
is why the statfs call doesn't work.  /dev/pts is still it's own
filesystem which has its own, well known magic value since devpts is
used - or is devfs not passing the calls through to devpts?  Could
somebody enlighten me?
Andreas
Footnotes: 
[1]  This might be a bug in devpts/ptmxs handling - I haven't looked
     closely enough at that code.
-- 
 Andreas Jaeger   
  SuSE Labs aj@suse.de	
   private aj@arthur.rhein-neckar.de
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/