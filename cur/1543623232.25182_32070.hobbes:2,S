Date: Sun, 3 Mar 2002 22:32:37 -0800
From: Kittur Sameer <>
Subject: Re: interrupt - spin lock question
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/3/4/1

On Sunday 03 March 2002 09:18 pm, sridharv@ufl.edu wrote:
> I have a question related to spin locking on UP systems.Before that I would
> like to point out my understanding of the background stuff
> 1. spinlocks shud be used in intr handlers
It should be used in the interrupt handler, if you need to prevent any  race 
conditions with other interrupt/non-interrupt  context code that may be 
executing on some other CPU on an SMP system. Thus spinlocks need to be held 
for as short a duration as possible. You would need to use the 
spin_lock_irqsave/spin_unlock_irqrestore variant pair to prevent your 
interrupt handler from running on the same processor while holding the lock. 
This may be  needed if the interrupt handler may try to acquire the same lock 
thus causing a deadlock.
> 2. interrupts can preempt kernel code
> 3. spinlocks are turned to empty when kernel is compiled without SMP
> support.
>
> If a particular driver is running( not the intr handler part) and at this
> time an interrupt occurs. The handler has to be invoked now. Won't the
> preemption cause race conditions/inconsistencies? Is any other mechanism
> used? Pl correct me if I have not understood any part of this correctly
On a UP kernel the spin_lock_irqsave/spin_unlock_irqrestore pair expand to 
save_flags(flag); cli()/restore_flags(flag).
The masking of interrupts on the processor between spin_lock_irqsave and 
spin_unlock_irqrestore  pair prevent the user context code from being 
preempted by the interrupt handler.
Sameer.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/