Date: Mon, 1 Sep 2003 20:36:31 +0200
From: Andrea Arcangeli <>
Subject: Re: Andrea VM changes
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/1/182

On Mon, Sep 01, 2003 at 03:26:02PM -0300, Marcelo Tosatti wrote:
> 
> 
> On Sat, 30 Aug 2003, Andrea Arcangeli wrote:
> 
> > On Sat, Aug 30, 2003 at 12:13:57PM -0300, Marcelo Tosatti wrote:
> > > 
> > > > You need to integrate with -aa on the VM.  It has been hard enough for
> > > > Andrea to get his stuff in, I doubt you will fair any better.
> > > 
> > > Thats because I never received separate patches which make sense one by
> > > one.  Most of Andreas changes are all grouped into few big patches that
> > > only he knows the mess. That is not the way to merge things.
> > > 
> > > I want to work out with him after I merge other stuff to address that.
> > 
> > that's true for only one patch, the others are pretty orthogonal after
> > Andrew helped splitting them:
> > 
> > 
> > 05_vm_03_vm_tunables-4
> > 05_vm_05_zone_accounting-2
> > 05_vm_06_swap_out-3
> > 05_vm_07_local_pages-4
> 
> Two things: I will leave this local pages change to be applied later. I
> want to see what it does by itself (apply swap_out() changes & friends now
> and on another -pre local pages).
fine thanks!
> 
> > 05_vm_08_try_to_free_pages_nozone-4
> 
> @@ -737,7 +737,6 @@ static void free_more_memory(void)
>         balance_dirty();
>         wakeup_bdflush();
>         try_to_free_pages(GFP_NOIO);
> -       run_task_queue(&tq_disk);
>         yield();
>  }
> 
> 
> Whats the reason behind this? 
the reason is that added or removed won't make any significant
difference. Sure, there may be a few dirty buffers queued, but we
already did balance_dirty() and wakeup_bdflush, so if there was
significant amount of dirty data to write, bdflush would trigger the
unplug by itself. And if there wasn't we can wait for more data to
become dirty.
In general, I don't like sparse tq_disk unplug, I like to have them only
where strictly needed, that looks cleaner, and it doesn't risk to
generate short commands.
Andrea
/*
 * If you also refuse to depend on closed software for a critical
 * part of your business, these links may be useful:
 *
 * rsync.kernel.org::pub/scm/linux/kernel/bkcvs/linux-2.5/
 * rsync.kernel.org::pub/scm/linux/kernel/bkcvs/linux-2.4/
 * 
http://www.cobite.com/cvsps/
 *
 * svn://svn.kernel.org/linux-2.6/trunk
 * svn://svn.kernel.org/linux-2.4/trunk
 */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/