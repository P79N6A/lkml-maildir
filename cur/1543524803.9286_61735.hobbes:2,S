Date: Mon, 7 Feb 2000 16:21:20 +0000 (GMT)
From: Jeremy Sanders <>
Subject: Problems with Athlon and UDMA 33
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/2/7/64

Hi,
We've got a new Athlon machine (700MHz), running RH6.1 and 2.2.14 (nfs3
client patches) with a Microstar MSI 6167 motherboard. The UDMA on the IBM
hard drives appears not to work. The kernel seems to find DMA capability
on booting, but does not enable it. Enabling it with hdparm hangs the
machine when you start using it.
We have two identical drives as master and slave on ide0, and a cdrom on
ide1.
syslog on booting:
Feb  7 15:17:11 xpc14 kernel: hda: IBM-DPTA-353750, ATA DISK drive 
Feb  7 15:17:11 xpc14 kernel: hdb: IBM-DPTA-353750, ATA DISK drive 
Feb  7 15:17:11 xpc14 kernel: hdc: CRD-8400C(MAS), ATAPI CDROM drive 
Feb  7 15:17:11 xpc14 kernel: ide0 at 0x1f0-0x1f7,0x3f6 on irq 14 
Feb  7 15:17:11 xpc14 kernel: ide1 at 0x170-0x177,0x376 on irq 15 
Feb  7 15:17:11 xpc14 kernel: hda: IBM-DPTA-353750, 35772MB w/1961kB Cache, CHS=4560/255/63 
Feb  7 15:17:11 xpc14 kernel: hdb: IBM-DPTA-353750, 35772MB w/1961kB Cache, CHS=4560/255/63 
# scanpci -v
PCI says configuration type 1
PCI probing configuration type 1
Probing for devices on PCI bus 0:
pci bus 0x0 cardnum 0x00 function 0x0000: vendor 0x1022 device 0x7006
 AMD  Device unknown
  STATUS    0x2210  COMMAND 0x0006
  CLASS     0x06 0x00 0x00  REVISION 0x23
  BIST      0x00  HEADER 0x80  LATENCY 0x20  CACHE 0x00
  BASE0     0xdc000008  addr 0xdc000000  MEM
  BASE1     0xe1101008  addr 0xe1101000  MEM
  BASE2     0x0000e001  addr 0x0000e000  I/O
  BYTE_0    0x0f  BYTE_1  0x00  BYTE_2  0x0f  BYTE_3  0x04
pci bus 0x0 cardnum 0x01 function 0x0000: vendor 0x1022 device 0x7007
 AMD  Device unknown
  STATUS    0x0220  COMMAND 0x0107
  CLASS     0x06 0x04 0x00  REVISION 0x01
  BIST      0x00  HEADER 0x81  LATENCY 0x20  CACHE 0x00
  BASE2     0x20010100  addr 0x20010100  MEM
  BASE3     0x222001f1  addr 0x222001f0  I/O
  BASE4     0xdbf0d800  addr 0xdbf0d800  MEM
  BASE5     0xdff0de00  addr 0xdff0de00  MEM
  MAX_LAT   0x00  MIN_GNT 0x0e  INT_PIN 0x00  INT_LINE 0x00
pci bus 0x0 cardnum 0x07 function 0x0000: vendor 0x1022 device 0x7408
 AMD  Device unknown
  STATUS    0x0200  COMMAND 0x000f
  CLASS     0x06 0x01 0x00  REVISION 0x01
  BIST      0x00  HEADER 0x80  LATENCY 0x00  CACHE 0x00
  BYTE_0    0x00  BYTE_1  0x21  BYTE_2  0x00  BYTE_3  0x00
pci bus 0x0 cardnum 0x07 function 0x0001: vendor 0x1022 device 0x7409
 AMD  Device unknown
  STATUS    0x0200  COMMAND 0x0005
  CLASS     0x01 0x01 0x8a  REVISION 0x03
  BIST      0x00  HEADER 0x00  LATENCY 0x20  CACHE 0x00
  BASE4     0x0000f001  addr 0x0000f000  I/O
  BYTE_0    0x03  BYTE_1  0x00  BYTE_2  0x00  BYTE_3  0x00
pci bus 0x0 cardnum 0x09 function 0x0000: vendor 0x1274 device 0x1371
 Ensoniq  Device unknown
  STATUS    0x0410  COMMAND 0x0105
  CLASS     0x04 0x01 0x00  REVISION 0x06
  BIST      0x00  HEADER 0x00  LATENCY 0x20  CACHE 0x00
  BASE0     0x0000e401  addr 0x0000e400  I/O
  MAX_LAT   0x80  MIN_GNT 0x0c  INT_PIN 0x01  INT_LINE 0x0a
pci bus 0x0 cardnum 0x0a function 0x0000: vendor 0x8086 device 0x1229
 Intel 82557/8 10/100MBit network controller
  STATUS    0x0290  COMMAND 0x0007
  CLASS     0x02 0x00 0x00  REVISION 0x08
  BIST      0x00  HEADER 0x00  LATENCY 0x20  CACHE 0x08
  BASE0     0xe1100000  addr 0xe1100000  MEM
  BASE1     0x0000e801  addr 0x0000e800  I/O
  BASE2     0xe1000000  addr 0xe1000000  MEM
  BASEROM   0xe0000000  addr 0xe0000000  not-decode-enabled
  MAX_LAT   0x38  MIN_GNT 0x08  INT_PIN 0x01  INT_LINE 0x0b
pci bus 0x0 cardnum 0x25 function 0x0000: vendor 0x102b device 0x0525
 Matrox  Device unknown
  STATUS    0x0290  COMMAND 0x0007
  CLASS     0x03 0x00 0x00  REVISION 0x04
  BIST      0x00  HEADER 0x00  LATENCY 0x20  CACHE 0x08
  BASE0     0xde000008  addr 0xde000000  MEM
  BASE1     0xd8000000  addr 0xd8000000  MEM
  BASE2     0xd9000000  addr 0xd9000000  MEM
  MAX_LAT   0x20  MIN_GNT 0x10  INT_PIN 0x01  INT_LINE 0x0a
  BYTE_0    0x20  BYTE_1  0xc1  BYTE_2  0x07  BYTE_3  0x60
Probing for devices on PCI bus 1:
pci bus 0x1 cardnum 0x05 function 0x0000: vendor 0x102b device 0x0525
 Matrox  Device unknown
  STATUS    0x0290  COMMAND 0x0007
  CLASS     0x03 0x00 0x00  REVISION 0x04
  BIST      0x00  HEADER 0x00  LATENCY 0x20  CACHE 0x08
  BASE0     0xde000008  addr 0xde000000  MEM
  BASE1     0xd8000000  addr 0xd8000000  MEM
  BASE2     0xd9000000  addr 0xd9000000  MEM
  MAX_LAT   0x20  MIN_GNT 0x10  INT_PIN 0x01  INT_LINE 0x0a
  BYTE_0    0x20  BYTE_1  0xc1  BYTE_2  0x07  BYTE_3  0x60
pci bus 0x1 cardnum 0x25 function 0x0000: vendor 0x102b device 0x0525
 Matrox  Device unknown
  STATUS    0x0290  COMMAND 0x0007
  CLASS     0x03 0x00 0x00  REVISION 0x04
  BIST      0x00  HEADER 0x00  LATENCY 0x20  CACHE 0x08
  BASE0     0xde000008  addr 0xde000000  MEM
  BASE1     0xd8000000  addr 0xd8000000  MEM
  BASE2     0xd9000000  addr 0xd9000000  MEM
  MAX_LAT   0x20  MIN_GNT 0x10  INT_PIN 0x01  INT_LINE 0x0a
  BYTE_0    0x20  BYTE_1  0xc1  BYTE_2  0x07  BYTE_3  0x60
[root@xpc14 /root]# hdparm -i /dev/hda
/dev/hda:
 Model=IBM-DPTA-353750, FwRev=P51OA30A, SerialNo=JWYJWF47785
 Config={ HardSect NotMFM HdSw>15uSec Fixed DTR>10Mbs }
 RawCHS=16383/16/63, TrkSize=0, SectSize=0, ECCbytes=34
 BuffType=3(DualPortCache), BuffSize=1961kB, MaxMultSect=16, MultSect=16
 DblWordIO=no, maxPIO=2(fast), DMA=yes, maxDMA=2(fast)
 CurCHS=4047/16/255, CurSects=-217054981, LBA=yes, LBA=yes, LBAsects=73261440
 tDMA={min:120,rec:120}, DMA modes: mword0 mword1 mword2 
 IORDY=on/off, tPIO={min:240,w/IORDY:120}, PIO modes: mode3 mode4 
 UDMA modes: mode0 mode1 mode2
(same for /dev/hdb)
---
Any advice would be appreciated, with suggestions for more diagnostics
which may help.
Could you cc replies to jss@ast.cam.ac.uk, as I'm not on the mailing list.
Thanks,
Jeremy.
-- 
Jeremy Sanders  jss@ast.cam.ac.uk     Pembroke College, Cambridge. CB2 1RF
(01223) 337511  Institute of Astronomy, Madingley Road, Cambridge. CB3 0HA
- I could have gone for charm or beauty, but instead I went for strange  -
-------------------------------------- 
http://www-xray.ast.cam.ac.uk/~jss/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/