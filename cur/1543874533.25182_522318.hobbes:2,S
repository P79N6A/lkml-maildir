Date: Wed, 21 Mar 2007 00:26:22 +0200
From: Ismail DÃ¶nmez <>
Subject: Re: [PATCH 2.6.21-rc4] ieee1394: fix oops on "modprobe -r ohci1394" after network class_device conversion
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/20/363

On Tuesday 20 March 2007 23:43:22 Stefan Richter wrote:
> The networking subsystem has been converted from class_device to device
> but ieee1394 hasn't.  This results in a 100% reproducible NULL pointer
> dereference if the ohci1394 driver module is unloaded while the eth1394
> module is still loaded.
> 
http://lkml.org/lkml/2006/11/16/147
> 
http://lkml.org/lkml/2007/3/14/4
>
> This is a regression in 2.6.21-rc1.
>
> Signed-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>
> ---
>
> Works for me.  I still can connect to an OS X box via eth1394 after that
> and modprobe -r ohci1394 before modprobe -r eth1394 works again.
>
> Index: linux-2.6.21-rc4/drivers/ieee1394/eth1394.c
> ===================================================================
> --- linux-2.6.21-rc4.orig/drivers/ieee1394/eth1394.c	2007-03-16
> 19:24:44.000000000 +0100 +++
> linux-2.6.21-rc4/drivers/ieee1394/eth1394.c	2007-03-20 22:28:49.000000000
> +0100 @@ -586,7 +586,10 @@ static void ether1394_add_host (struct h
>          }
>
>  	SET_MODULE_OWNER(dev);
> +#if 0
> +	/* FIXME - Is this the correct parent device anyway? */
>  	SET_NETDEV_DEV(dev, &host->device);
> +#endif
>
>  	priv = netdev_priv(dev);
This also fixes the issue for me, thanks for tracking this down Stefan.
Regards.
-- 
Happiness in intelligent people is the rarest thing I know. (Ernest Hemingway)
Ismail Donmez ismail (at) pardus.org.tr
GPG Fingerprint: 7ACD 5836 7827 5598 D721 DF0D 1A9D 257A 5B88 F54C
Pardus Linux / KDE developer
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/