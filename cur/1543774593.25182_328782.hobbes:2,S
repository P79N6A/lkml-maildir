Date: Sun, 26 Jun 2005 14:30:49 -0400
From: Jeff Sipek <>
Subject: [PATCH][TRIVIAL] Allocate kprobe_table at runtime
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/6/26/87

Allocates kprobe_table at runtime.
Signed-off-by: Josef "Jeff" Sipek <jeffpc@optonline.net>
diff --git a/kernel/kprobes.c b/kernel/kprobes.c
--- a/kernel/kprobes.c
+++ b/kernel/kprobes.c
@@ -40,7 +40,7 @@
 #define KPROBE_HASH_BITS 6
 #define KPROBE_TABLE_SIZE (1 << KPROBE_HASH_BITS)
 
-static struct hlist_head kprobe_table[KPROBE_TABLE_SIZE];
+static struct hlist_head *kprobe_table;
 
 unsigned int kprobe_cpu = NR_CPUS;
 static DEFINE_SPINLOCK(kprobe_lock);
@@ -261,7 +261,10 @@ static int __init init_kprobes(void)
 {
 	int i, err = 0;
 
-	/* FIXME allocate the probe table, currently defined statically */
+	kprobe_table = kmalloc(sizeof(struct hlist_head)*KPROBE_TABLE_SIZE, GFP_ATOMIC);
+	if (!kprobe_table)
+		return -ENOMEM;
+
 	/* initialize all list heads */
 	for (i = 0; i < KPROBE_TABLE_SIZE; i++)
 		INIT_HLIST_HEAD(&kprobe_table[i]);[unhandled content-type:application/pgp-signature]