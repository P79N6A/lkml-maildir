Date: Wed, 6 Jun 2007 16:29:13 -0700 (PDT)
From: Davide Libenzi <>
Subject: Re: [patch 7/8] fdmap v2 - implement sys_socket2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/6/476

On Thu, 7 Jun 2007, Alan Cox wrote:
> > > 	prctl(PR_SPARSEFD, 1);
> > > 
> > > to turn on sparse fd allocation for a process ?
> > 
> > There was a little discussion where I tried to whisper something similar, 
> > but Linus and Uli shot me :) - with good reasons IMO.
> > You may link to runtimes that are not non-sequentialfd aware, and will 
> > break them.
> 
> Linking to the correct version of a libary and getting the library
> versioning right is not rocket science and isn't a sane excuse. Its no
> different to the stdio to large fd migration issues with many Unixen and
> they all coped just fine.
I don't think it's a matter of versioning. Many userspace libraries 
expects their fds to be compact (for many reasons - they use select, they 
use them to index 0-based arrays, etc...), and if the kernel suddendly 
starts returning values in the 1<<28 up arena, they sure won't be happy.
So I believe that the correct way is that the caller specifically selects 
the feature, leaving the legacy fd allocation as default.
- Davide
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/