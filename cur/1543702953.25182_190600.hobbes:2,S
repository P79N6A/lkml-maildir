Date: 12 Jan 2004 19:45:50 -0500
From: James Bottomley <>
Subject: Re: [PATCH] Intel Alder IOAPIC fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/1/12/256

OK, with the patch below (to insert_resource) I know get the IO APIC
successfully inserted under the reserved fixmap resources:
/proc/iomem still looks very odd:
fec00000-fec08fff : reserved
  fec01000-fec013ff : 0000:00:0f.0
fffffc00-ffffffff : 0000:00:0f.0
  fffffc00-ffffffff : 0000:00:0f.0
    fffffc00-ffffffff : 0000:00:0f.0
      fffffc00-ffffffff : 0000:00:0f.0
        fffffc00-ffffffff : 0000:00:0f.0
          ffe80000-ffffffff : reserved
unfortunately, because BARs 1-5 cover the same region.
I also think insert_resource needs to be fixed to insert these resources
*under* the reserved resource, since it's larger than they are.
I can make these changes and send them to you, if you think this is the
correct thing to do?
James
===== kernel/resource.c 1.18 vs edited =====
--- 1.18/kernel/resource.c	Wed Nov 19 01:40:49 2003
+++ edited/kernel/resource.c	Mon Jan 12 18:34:00 2004
@@ -318,6 +318,7 @@
 	struct resource *first, *next;
 
 	write_lock(&resource_lock);
+ begin:
 	first = __request_resource(parent, new);
 	if (!first)
 		goto out;
@@ -331,8 +332,10 @@
 			break;
 
 	/* existing resource overlaps end of new resource */
-	if (next->end > new->end)
-		goto out;
+	if (next->end > new->end) {
+		parent = next;
+		goto begin;
+	}
 
 	result = 0;
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/