Date: Tue, 30 Nov 1999 01:42:31 +0100
From: Daniel Roesen <>
Subject: [PATCH] Fix for get_empty_dquot() in 2.2.14pre9
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/29/108

> Well, if you care about this printk - don't, otherwise count is bitbucket
> fodder. As for the goal (in free_inode_memory) - depends on the future
> plans. Andrea, your comments?
OK, as Andrea thinks about backporting the prune_* stuff back to 2.2.x, I
decided to leave free_inodes_memory() untouched. This one would go anyway,
but this keeps the patch smaller ;)
Best regards,
Daniel
New patch against vanilla 2.2.14pre9:
--- linux-2.2.14pre9.vanilla/fs/dquot.c	Tue Nov 30 00:16:27 1999
+++ linux-2.2.14pre9/fs/dquot.c	Tue Nov 30 01:27:53 1999
@@ -569,9 +569,14 @@
 	/*
 	 * Try pruning the dcache to free up some dquots ...
 	 */
-	printk(KERN_DEBUG "get_empty_dquot: pruning %d\n", count);
-	if (prune_dcache(0, 128))
+
+	printk(KERN_DEBUG "get_empty_dquot: trying to prune dcache\n");
+
+	count = prune_dcache(0, 128);
+	if (count)
 	{
+		printk(KERN_DEBUG "get_empty_dquot: pruning %d\n", count);
+
 		free_inode_memory(count);
 		goto repeat;
 	}
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/