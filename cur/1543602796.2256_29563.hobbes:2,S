Date: Fri, 28 Sep 2001 15:50:01 +0200
From: Martin RÃ¶der <>
Subject: ACPI processor throttling problem in 2.4.10
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/9/28/57

Hi,
with the 2.4.10 kernel my processor doesn't enter the C2 power state any 
more. I found the reason to be the state promotion part of pr_power_idle() 
which actually does no state promotion if bm_control is 0.
As far as I understand, the bm_control flag should only disable the C3 state 
on machines where busmastering can't be controlled and not disable state 
changing completely.
The attached patch should correct this problem.
  Martin--- linux/drivers/acpi/ospm/processor/prpower.c.orig	Sun Sep 23 18:42:32 2001
+++ linux/drivers/acpi/ospm/processor/prpower.c	Fri Sep 28 13:01:45 2001
@@ -274,7 +274,7 @@
 			 * by this state's promotion policy, prevents
 			 * promotions from occuring.
 			 */
-			if (bm_control && !(processor->power.bm_activity &
+			if (!bm_control || !(processor->power.bm_activity &
 				c_state->promotion.bm_threshold)) {
 				next_state = c_state->promotion.target_state;
 			}