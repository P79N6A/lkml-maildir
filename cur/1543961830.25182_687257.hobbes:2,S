Date: Wed, 30 Apr 2008 18:20:14 +0200
From: Elias Oltmanns <>
Subject: [PATCH] block: Reenforce consistent queue_flags handling
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/4/30/270

Just make the tree comply with the rules introduced in
commit 75ad23bc0fcb4f992a5d06982bf0857ab1738e9e.
Signed-off-by: Elias Oltmanns <eo@nebensachen.de>
---
 block/blk-core.c  |    2 +-
 block/blk-sysfs.c |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)
diff --git a/block/blk-core.c b/block/blk-core.c
index 5d09f8c..17ba427 100644
--- a/block/blk-core.c
+++ b/block/blk-core.c
@@ -201,7 +201,7 @@ void blk_plug_device(struct request_queue *q)
 		return;
 
 	if (!test_bit(QUEUE_FLAG_PLUGGED, &q->queue_flags)) {
-		__set_bit(QUEUE_FLAG_PLUGGED, &q->queue_flags);
+		queue_flag_set(QUEUE_FLAG_PLUGGED, q);
 		mod_timer(&q->unplug_timer, jiffies + q->unplug_delay);
 		blk_add_trace_generic(q, NULL, 0, BLK_TA_PLUG);
 	}
diff --git a/block/blk-sysfs.c b/block/blk-sysfs.c
index e85c401..775e736 100644
--- a/block/blk-sysfs.c
+++ b/block/blk-sysfs.c
@@ -147,9 +147,9 @@ static ssize_t queue_nomerges_store(struct request_queue *q, const char *page,
 	ssize_t ret = queue_var_store(&nm, page, count);
 
 	if (nm)
-	       set_bit(QUEUE_FLAG_NOMERGES, &q->queue_flags);
+		queue_flag_set_unlocked(QUEUE_FLAG_NOMERGES, q);
 	else
-	       clear_bit(QUEUE_FLAG_NOMERGES, &q->queue_flags);
+		queue_flag_clear_unlocked(QUEUE_FLAG_NOMERGES, q);
 
 	return ret;
 }