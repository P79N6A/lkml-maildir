Date: Fri, 06 Sep 2002 09:52:24 +0100
From: David Woodhouse <>
Subject: Re: [reiserfs-dev] Re: [PATCH] sparc32: wrong type of nlink_t
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/9/6/42

davem@redhat.com said:
> >    The patch will probably cause reiserfs problems as well, we've
> >    already got people with > 32767 links on disk, going to a lower
> >    number will confuse things.
> And that means you already have reiserfs partitions that cannot be
> used on other Linux platforms.  That's pretty bad. 
Surely a file system with > 32Ki links can be _used_ on sparc, you just 
can't return a correct value in st_nlink. For directories, you could 
perhaps set st_nlink to '1', which many things will interpret as
"don't know". For files, I'm not sure -- but even just setting it to 
min(32767, real_nlink) would suffice, surely? It's inaccurate but it's 
better than the idea that the file system just cannot be mounted.
Is there a requirement to stop allowing hard links (or subdirectories) 
to be made when nlink reaches the maximum representable to user space? 
Obviously you have to do it if you're keeping an nlink count on the 
medium and you'd overflow _that_, but should we return -EMLINK even if we 
could represent the new hard link on the file system?
--
dwmw2
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/