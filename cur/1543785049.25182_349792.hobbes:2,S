Date: Mon, 12 Sep 2005 22:55:33 -0700
From: Greg KH <>
Subject: Re: [udev/vcs] tons of creating/removing /dev/vcs* during boot
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/13/22

On Mon, Sep 12, 2005 at 05:06:18PM +0200, Edgar Toernig wrote:
> Hi,
> 
> switching from SuSE's 2.6.11.4 to vanilla 2.6.13 I noticed
> that I get tons of these lines in the log during boot:
> 
> udev[2124]: configured rule in '/etc/udev/rules.d/50-udev.rules[98]' ...
> udev[2121]: creating device node '/dev/vcs5'
> udev[2124]: creating device node '/dev/vcsa3'
> udev[2140]: configured rule in '/etc/udev/rules.d/50-udev.rules[98]' ...
> udev[2144]: configured rule in '/etc/udev/rules.d/50-udev.rules[98]' ...
> udev[2140]: creating device node '/dev/vcs3'
> udev[2144]: creating device node '/dev/vcsa6'
> udev[2147]: removing device node '/dev/vcs6'
> udev[2149]: configured rule in '/etc/udev/rules.d/50-udev.rules[98]' ...
> udev[2158]: removing device node '/dev/vcs4'
> udev[2157]: removing device node '/dev/vcsa3'
> udev[2149]: creating device node '/dev/vcsa5'
> udev[2172]: configured rule in '/etc/udev/rules.d/50-udev.rules[98]' ....
> udev[2171]: removing device node '/dev/vcsa2'
> udev[2172]: creating device node '/dev/vcs5'
> 
> It's caused by various loadkeys, setleds, etc performed early in an
> init script.  It seems, that every open/close of a tty generates
> a hotplug event for the appropriate vcs/vcsa device.  It stops at
> the moment gettys are spawned.
> 
> Looking at the 2.6.11.4 source of drivers/char/vc_screen.c I see
> that hotplug events are explicitly disabled for the vcs and vcsa
> devices (not sure whether this was done by SuSE).
Yes, this was a SUSE change, that's never been in mainline.
> In 2.6.13 all of that code is gone, including the class_simple that
> was used to disable hotplug events.
Well, consider it "never present" instead of gone :)
> How can I avoid all of these hotplug events?
Why do you want to?  You need them in order to create the proper device
node for the virtual terminal, right?
And, if you use the latest versions of udev, no hotplug events need
cause a program execute, udev can watch the hotplug netlink socket and
just act on it, _very_ quickly.  So quickly you will not even care I
bet...
> Best would be of course to generate only a single event at the same
> time the tty device is create.
That's what you are seeing.  And then watching as it's being destroyed.
And then created.  And then destroyed.  And so on (virtual ttys are
nasty at times..)
> But I could also live with no hotplug events for vcs* at all.
You would not be able to use them if you use udev then :(
Seriously, try the latest udev, with the netlink socket, and see if it
still matters anymore.
thanks,
greg k-h
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/