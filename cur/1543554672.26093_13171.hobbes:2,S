Date: Wed, 15 Nov 2000 12:26:54 +0100 (CET)
From: Paweł Kot <>
Subject: Re: [prepatch] removal of oops->printk deadlocks
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/11/15/34

On Wed, 15 Nov 2000, Andrew Morton wrote:
> "Paweł Kot" wrote:
> >
> > Hi,
> >
> > The whole oops produced by the 2.4.0-test11pre4 with this patch is in the
> > attachment. Other system info is tehere as well.
> >
> > Oops is produced when runnning big-tables test from mysql sql-bench.
> > It's reproducable. The machine is running only mysqld.
>
> Thank you.  Quad 700 meg Xeons?  Nice machine, that.
Yes. 54 seconds for compiling kernel is quite good result :-)
> The NMI oops changes are working well. We can see three CPUs are
> stuck in different places spinning on the same lock with interrupts
> disabled, but unfortunately something went wrong with your `ksymoops'
> run.
>
> Could you please rerun ksymoops, and make sure that you use the
> correct symbol file?  Take the `System.map' from the directory
> where you built the kernel and run
>
> 	ksymoops -m System.map < log_file
In attachment. But don't beat me. I think I found the oops reason.
/dev/shm was not mounted. After mounting it I couldn't get an oops yet.
Could this be a reason?
regards and thanks for help
pkot
-- 
mailto:pkot@linuxnews.pl
http://urtica.linuxnews.pl/~pkot/
http://newsreader.linuxnews.pl/
ksymoops 2.3.4 on i686 2.4.0-test11.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.4.0-test11/ (default)
     -m /usr/src/linux/System.map (specified)
Error (regular_file): read_ksyms stat /proc/ksyms failed
No modules in ksyms, skipping objects
No ksyms, skipping lsmod
CPU:    0
EIP:    0010:[<c010b5ee>]
Using defaults from ksymoops -t elf32-i386 -a i386
EFLAGS: 00000097
eax: c0285420   ebx: f6f08000   ecx: 00000000   edx: bf1fff2c
esi: bf1fff2c   edi: f6f09fa8   ebp: f6f09fa8   esp: f6f09f90
ds: 0018   es: 0018   ss: 0018
Process mysqld (pid: 2386, stackpage=f6f09000)
Stack: c02026f7 f6f08000 00000000 bf1fff24 fffffff2 00000000 f6f09fbc c0120404 
       00000952 00000000 bf1fff28 bf1ffe34 c010c66b 00000952 00000000 bf1fff28 
       00000000 bf1fff24 bf1ffe34 0000009c 0000002b 0000002b 0000009c 081313e4 
Call Trace: [<c02026f7>] [<c0120404>] [<c010c66b>] 
Code: 78 fb f0 ff 08 78 f3 c3 90 90 90 90 90 90 90 90 90 90 55 57 
>>EIP; c010b5ee <__read_lock_failed+6/18>   <=====
Trace; c02026f7 <stext_lock+86b/8c14>
Trace; c0120404 <sys_sched_setscheduler+14/18>
Trace; c010c66b <system_call+33/38>
Code;  c010b5ee <__read_lock_failed+6/18>
00000000 <_EIP>:
Code;  c010b5ee <__read_lock_failed+6/18>   <=====
   0:   78 fb                     js     fffffffd <_EIP+0xfffffffd> c010b5eb <__read_lock_failed+3/18>   <=====
Code;  c010b5f0 <__read_lock_failed+8/18>
   2:   f0 ff 08                  lock decl (%eax)
Code;  c010b5f3 <__read_lock_failed+b/18>
   5:   78 f3                     js     fffffffa <_EIP+0xfffffffa> c010b5e8 <__read_lock_failed+0/18>
Code;  c010b5f5 <__read_lock_failed+d/18>
   7:   c3                        ret    
Code;  c010b5f6 <__read_lock_failed+e/18>
   8:   90                        nop    
Code;  c010b5f7 <__read_lock_failed+f/18>
   9:   90                        nop    
Code;  c010b5f8 <__read_lock_failed+10/18>
   a:   90                        nop    
Code;  c010b5f9 <__read_lock_failed+11/18>
   b:   90                        nop    
Code;  c010b5fa <__read_lock_failed+12/18>
   c:   90                        nop    
Code;  c010b5fb <__read_lock_failed+13/18>
   d:   90                        nop    
Code;  c010b5fc <__read_lock_failed+14/18>
   e:   90                        nop    
Code;  c010b5fd <__read_lock_failed+15/18>
   f:   90                        nop    
Code;  c010b5fe <__read_lock_failed+16/18>
  10:   90                        nop    
Code;  c010b5ff <__read_lock_failed+17/18>
  11:   90                        nop    
Code;  c010b600 <copy_siginfo_to_user+0/a8>
  12:   55                        push   %ebp
Code;  c010b601 <copy_siginfo_to_user+1/a8>
  13:   57                        push   %edi
NMI Watchdog detected LOCKUP on CPU1, registers:
CPU:    1
EIP:    0010:[<c0202590>]
EFLAGS: 00000082
eax: c028e7ec   ebx: 00000282   ecx: c4df0000   edx: c028e7ec
esi: c011f550   edi: 00000000   ebp: c4d59ef4   esp: c4d59ef0
ds: 0018   es: 0018   ss: 0018
Process swapper (pid: 0, stackpage=c4d59000)
Stack: c4df0000 c0285c40 c0128592 c4df0000 00000000 00000020 00000000 c0285c40 
       f70082a0 f7c06800 00000086 c0124de5 c02a1220 00000020 c0124cc7 00000000 
       00000001 c0286040 00000020 0000000e c0124b6c c0286040 c02a1580 c0283800 
Call Trace: [<c0128592>] [<c0124de5>] [<c0124cc7>] [<c0124b6c>] [<c010e225>] [<c010a810>] [<c010a810>] 
       [<c010c72c>] [<c010a810>] [<c010a810>] [<c0100018>] [<c010a83d>] [<c010a8a2>] [<c0116c84>] [<c0124b6c>] 
       [<c010e225>] 
Code: 80 3d 00 54 28 c0 00 f3 90 7e f5 e9 ba cf f1 ff 80 bb 74 06 
>>EIP; c0202590 <stext_lock+704/8c14>   <=====
Trace; c0128592 <timer_bh+256/2b0>
Trace; c0124de5 <bh_action+4d/b0>
Trace; c0124cc7 <tasklet_hi_action+4f/7c>
Trace; c0124b6c <do_softirq+5c/8c>
Trace; c010e225 <do_IRQ+e5/f4>
Trace; c010a810 <default_idle+0/34>
Trace; c010a810 <default_idle+0/34>
Trace; c010c72c <ret_from_intr+0/20>
Trace; c010a810 <default_idle+0/34>
Trace; c010a810 <default_idle+0/34>
Trace; c0100018 <startup_32+18/cc>
Trace; c010a83d <default_idle+2d/34>
Trace; c010a8a2 <cpu_idle+3e/54>
Trace; c0116c84 <start_secondary+20/24>
Trace; c0124b6c <do_softirq+5c/8c>
Trace; c010e225 <do_IRQ+e5/f4>
Code;  c0202590 <stext_lock+704/8c14>
00000000 <_EIP>:
Code;  c0202590 <stext_lock+704/8c14>   <=====
   0:   80 3d 00 54 28 c0 00      cmpb   $0x0,0xc0285400   <=====
Code;  c0202597 <stext_lock+70b/8c14>
   7:   f3 90                     repz nop 
Code;  c0202599 <stext_lock+70d/8c14>
   9:   7e f5                     jle    0 <_EIP>
Code;  c020259b <stext_lock+70f/8c14>
   b:   e9 ba cf f1 ff            jmp    fff1cfca <_EIP+0xfff1cfca> c011f55a <process_timeout+a/60>
Code;  c02025a0 <stext_lock+714/8c14>
  10:   80 bb 74 06 00 00 00      cmpb   $0x0,0x674(%ebx)
NMI Watchdog detected LOCKUP on CPU2, registers:
CPU:    2
EIP:    0010:[<c02025c0>]
EFLAGS: 00000082
eax: 00000000   ebx: c0285480   ecx: 00000040   edx: 00000002
esi: c4d7a000   edi: c010a810   ebp: c4d7bfac   esp: c4d7bf78
ds: 0018   es: 0018   ss: 0018
Process swapper (pid: 0, stackpage=c4d7b000)
Stack: c010a810 c4d7a000 c010a810 c4d7a000 c4d7a000 c010a810 00000000 00000000 
       c4d70018 c0100018 00000002 c4d7a000 c0285480 00000000 c010a8ae 00000003 
       00000000 00000000 c0116c84 c0289373 c012293f 00000003 00000602 00000000 
Call Trace: [<c010a810>] [<c010a810>] [<c010a810>] [<c0100018>] [<c010a8ae>] [<c0116c84>] [<c012293f>] 
       [<c0117204>] [<c020de7d>] 
Code: 80 3d 00 54 28 c0 00 f3 90 7e f5 e9 b9 d1 f1 ff 80 bb 74 06 
>>EIP; c02025c0 <stext_lock+734/8c14>   <=====
Trace; c010a810 <default_idle+0/34>
Trace; c010a810 <default_idle+0/34>
Trace; c010a810 <default_idle+0/34>
Trace; c0100018 <startup_32+18/cc>
Trace; c010a8ae <cpu_idle+4a/54>
Trace; c0116c84 <start_secondary+20/24>
Trace; c012293f <printk+18f/19c>
Trace; c0117204 <do_boot_cpu+544/6b0>
Trace; c020de7d <call_spurious_interrupt+2a1d/77c8>
Code;  c02025c0 <stext_lock+734/8c14>
00000000 <_EIP>:
Code;  c02025c0 <stext_lock+734/8c14>   <=====
   0:   80 3d 00 54 28 c0 00      cmpb   $0x0,0xc0285400   <=====
Code;  c02025c7 <stext_lock+73b/8c14>
   7:   f3 90                     repz nop 
Code;  c02025c9 <stext_lock+73d/8c14>
   9:   7e f5                     jle    0 <_EIP>
Code;  c02025cb <stext_lock+73f/8c14>
   b:   e9 b9 d1 f1 ff            jmp    fff1d1c9 <_EIP+0xfff1d1c9> c011f789 <schedule+b1/648>
Code;  c02025d0 <stext_lock+744/8c14>
  10:   80 bb 74 06 00 00 00      cmpb   $0x0,0x674(%ebx)
NMI Watchdog detected LOCKUP on CPU3, registers:
CPU:    3
EIP:    0010:[<c0202724>]
EFLAGS: 00000082
eax: f71d4000   ebx: 00000002   ecx: f71d4000   edx: c4d66400
esi: 00000021   edi: 00000000   ebp: f6f15eb0   esp: f6f15eac
ds: 0018   es: 0018   ss: 0018
Process mysqld (pid: 2385, stackpage=f6f15000)
Stack: f71d4000 00000000 c011c3fa f71d4000 00000021 00000082 c011c4bd 00000021 
       f6f15f04 f71d4000 00040001 00000000 f6f14000 00000021 c011c941 00000021 
       f6f15f04 f71d4000 f6f14000 f71d4000 f6f14000 c0285420 00000021 00000000 
Call Trace: [<c011c3fa>] [<c011c4bd>] [<c011c941>] [<c01f2401>] [<c014d6c9>] [<c013b101>] [<c01237bb>] 
       [<c0123b28>] [<c0123b7e>] [<c010c66b>] 
Code: 80 3d 00 54 28 c0 00 f3 90 7e f5 e9 d5 e3 f1 ff 80 3b 00 f3 
>>EIP; c0202724 <stext_lock+898/8c14>   <=====
Trace; c011c3fa <deliver_signal+4a/88>
Trace; c011c4bd <send_sig_info+85/b0>
Trace; c011c941 <do_notify_parent+c9/e0>
Trace; c01f2401 <unix_release_sock+279/294>
Trace; c014d6c9 <dput+19/154>
Trace; c013b101 <fput+79/dc>
Trace; c01237bb <exit_notify+16b/2ac>
Trace; c0123b28 <do_exit+22c/274>
Trace; c0123b7e <sys_exit+e/10>
Trace; c010c66b <system_call+33/38>
Code;  c0202724 <stext_lock+898/8c14>
00000000 <_EIP>:
Code;  c0202724 <stext_lock+898/8c14>   <=====
   0:   80 3d 00 54 28 c0 00      cmpb   $0x0,0xc0285400   <=====
Code;  c020272b <stext_lock+89f/8c14>
   7:   f3 90                     repz nop 
Code;  c020272d <stext_lock+8a1/8c14>
   9:   7e f5                     jle    0 <_EIP>
Code;  c020272f <stext_lock+8a3/8c14>
   b:   e9 d5 e3 f1 ff            jmp    fff1e3e5 <_EIP+0xfff1e3e5> c0120b09 <wake_up_process+9/60>
Code;  c0202734 <stext_lock+8a8/8c14>
  10:   80 3b 00                  cmpb   $0x0,(%ebx)
Code;  c0202737 <stext_lock+8ab/8c14>
  13:   f3 00 00                  repz add %al,(%eax)
1 error issued.  Results may not be reliable.