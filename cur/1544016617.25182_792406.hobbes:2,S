Date: Wed, 14 Jan 2009 21:58:10 -0800
From: Andrew Morton <>
Subject: Re: [4/7] dst: thread pool.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/15/14

On Wed, 14 Jan 2009 02:05:30 +0300 Evgeniy Polyakov <zbr@ioremap.net> wrote:
> Kernel currently does not allow to queue work into some entity which
> will perform it in the process context and have simple way to extend
> number of worker and work with them not as separate objects, but with
> pool as a whole. So thread pool model was implemented in the DST.
> 
> Thread pool abstraction allows to schedule a work to be performed
> on behalf of kernel thread. One does not operate with threads itself,
> instead user provides setup and cleanup callbacks for thread pool itself,
> and action and cleanup callbacks for each submitted work.
> 
> Each worker has private data initialized at creation time and data,
> provided by user at scheduling time.
> 
> When action is being performed, thread can not be used by other users,
> instead they will sleep until there is free thread to pick their work.
> 
> Thread pool is used for crypto processing of incoming and outgoing IO
> requests to reduce the overall overhead.
This is at least our fourth thread pool implementation, not counting
kernel/workqueue.c:
1: pdflush
2: David Howells' "slow work" infrastructure
3: Arjan van de Ven's kernel/async.c
4: Your "dst thread pool"
Guys, please.  Let's get our act together here.