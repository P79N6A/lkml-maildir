Date: 07 Mar 2000 20:32:17 +0100
From: Christoph Rohland <>
Subject: longstanding bug in sem.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/7/132

Hi Alan and Linus,
We have a longstanding bug in the semaphore handling. This leads to
lost wakeups of sleeping processes and under certain circumstances to
deadlocks.
The appended patches should fix this.
Greetings
		Christoph
--- linux/ipc/sem.c.orig	Tue Mar  7 16:19:26 2000
+++ linux/ipc/sem.c	Tue Mar  7 20:22:27 2000
@@ -291,7 +291,7 @@
         for (q = sma->sem_pending; q; q = q->next) {
                         
                 if (q->status == 1)
-                        return; /* wait for other process */
+			continue; /* this one was woken up before */
 
                 error = try_atomic_semop(sma, q->sops, q->nsops,
                                          q->undo, q->pid, q->alter);--- make50/ipc/sem.c.orig	Tue Mar  7 20:24:48 2000
+++ make50/ipc/sem.c	Tue Mar  7 20:29:10 2000
@@ -309,7 +309,7 @@
 	for (q = sma->sem_pending; q; q = q->next) {
 			
 		if (q->status == 1)
-			return; /* wait for other process */
+			continue; /* this one was woken up before */
 
 		error = try_atomic_semop(sma, q->sops, q->nsops,
 					 q->undo, q->pid, q->alter);