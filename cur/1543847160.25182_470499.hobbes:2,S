Date: Fri, 6 Oct 2006 22:13:14 +0200
From: Henrik Carlqvist <>
Subject: Re: ocfs2 problem with nfs v2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/6/285

Henrik Carlqvist <hc8@uthyres.com> wrote:
> Using NFS v3 in Slackware 9.1 the server works fine, but with NFS v2 I
> was able to repeat the bug.
> 
> This is what it looks like on the NFS client:
> # mount -o nfsvers=2 ekorrapa:/san/old /mnt/hd/ 
> # ls -al /mnt/hd/ 
> ls:/mnt/hd/lost+found: Input/output error 
> ls: /mnt/hd/1: Input/output error
> ls: /mnt/hd/2: Input/output error
> However, on the NFS server things look exactly the same as before:
> Sep 14 10:53:23 kattapa kernel: (5380,0):ocfs2_encode_fh:155 ERROR: fh
> buffer is too small for encoding 
This message is posted only to make this thread useful by others which
encounter the same problem. The problem got into bugzilla at
http://oss.oracle.com/bugzilla/show_bug.cgi?id=777
 but unfortunately
because of limitations in NFS v2 it would be very hard to make ocfs2 to
work with the default settings of an NFS v2 server.
One solution to the problem is to export with the no_subtree_check
option. This solution has some mild security implications so reading
and understanding the manpage of exportfs should be done before trying
this. With the no_subtree_check option NFS v2 clients are able to use
mounts directly from the NFS server with ocfs2.
Another workaround is to configure an "NFS proxy" which does NFS v3 mounts
from the server with ocfs2 and then reexports those mounts with NFS v2. To
be able to reexport an NFS mounted directory a user space NFS server is
needed. I have tried the old and obsolete server from
http://sourceforge.net/projects/unfs
 which was able to do NFS v2 reexports
of NFS v3 mounted directories from the NFS v3 server with ocfs2.
regards Henrik
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/