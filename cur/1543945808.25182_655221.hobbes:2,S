Date: Sun, 17 Feb 2008 20:40:13 +0100
From: Sam Ravnborg <>
Subject: Re: 2.6.25-rc2, Problem running 'make install' as root with different gcc
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/17/276

On Sun, Feb 17, 2008 at 05:36:37PM +0200, Avi Kivity wrote:
> Trying to install a built 2.5.25-rc2 on a machine with a different gcc 
> installed fails with
> 
>  LDS     arch/x86/vdso/vdso.lds
> cc1: fatal error: opening output file arch/x86/vdso/vdso.lds: Permission 
> denied
> compilation terminated.
> make[1]: *** [arch/x86/vdso/vdso.lds] Error 1
> make: *** [vdso_install] Error 2
> 
> I believe this is due to arch/x86/vdso/.vdso.lds.cmd containing
> 
> cmd_arch/x86/vdso/vdso.lds := gcc -E -Wp,-MD,arch/x86/vdso/.vdso.lds.d  
> -nostdinc -isystem /usr/lib/gcc/x86_64-redhat-linux/4.1.1/include 
> -D__KERNEL__ -Iinclude  -include include/linux/autoconf.h   -P -C 
> -D__ASSEMBLY__ -o arch/x86/vdso/vdso.lds arch/x86/vdso/vdso.lds.S
> 
> '-isystem /usr/lib/gcc/x86_64-redhat-linux/4.1.1/include' changes with 
> the gcc version, triggering the recompilation attempt, which fails since 
> my home directory is nfs mounted.
> 
> This didn't trigger with previous versions, and I have no idea how to 
> fix it.
We had a related issue and I have suggested Rolan to just drop
the implicit installation of vdso when we do a "make install".
It would still trigger if you did a make vdso_install but this is
very rare so here it would not matter.
The patch we discuss just drop the cdso_install dependency
in arch/x86/Makefile (likewise for powerpc).
	Sam