Date: Wed, 27 Sep 2006 11:29:56 -0500
From: Michael Halcrow <>
Subject: [PATCH] eCryptfs: Grab lock on lower_page in ecryptfs_sync_page
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/9/27/176

The recent swap of grab_cache_page() with find_get_page() in
ecryptfs_sync_page() missed the fact that we need a lock on the lower
page. This patch replaces find_get_page() with find_lock_page() in
order to make sure that this lock is obtained.
Signed-off-by: Michael Halcrow <mhalcrow@us.ibm.com>
---
 fs/ecryptfs/mmap.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)
ef0b82f22907486bd87f8c37508a9f7d1dcd5601
diff --git a/fs/ecryptfs/mmap.c b/fs/ecryptfs/mmap.c
index 8a4040d..924dd90 100644
--- a/fs/ecryptfs/mmap.c
+++ b/fs/ecryptfs/mmap.c
@@ -766,9 +766,9 @@ static void ecryptfs_sync_page(struct pa
 	lower_inode = ecryptfs_inode_to_lower(inode);
 	/* NOTE: Recently swapped with grab_cache_page(), since
 	 * sync_page() just makes sure that pending I/O gets done. */
-	lower_page = find_get_page(lower_inode->i_mapping, page->index);
+	lower_page = find_lock_page(lower_inode->i_mapping, page->index);
 	if (!lower_page) {
-		ecryptfs_printk(KERN_DEBUG, "find_get_page failed\n");
+		ecryptfs_printk(KERN_DEBUG, "find_lock_page failed\n");
 		return;
 	}
 	lower_page->mapping->a_ops->sync_page(lower_page);
-- 
1.3.3
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/