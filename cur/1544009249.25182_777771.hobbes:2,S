Date: Sun, 7 Dec 2008 13:31:00 +1100
From: Paul Mackerras <>
Subject: Re: [PATCH linux-next] powerpc/powermac: Add missing of_node_put
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/6/155

Andrew Morton writes:
> This still misses a path - if that `return 0' is taken, we still leak
> the reference.
> 
> This is reason #345 why sprinkling return statements all over your code
> is bad.
> 
> I fixed it up thusly.  Please check.
I'm really in two minds about applying any of the of_node_put patches
that only affect powermacs.  The reference counts only matter on
platforms where we update the OF device tree at runtime, which is
currently only IBM pSeries machines.  Since we don't have any hotplug
on powermacs, and never will have, the OF device tree is completely
static and we don't actually need refcounts on the nodes at all, so
who cares if they're a bit higher than they might be?
In particular, the VIA whose node we're looking for here is built-in
on the motherboard, and there can never be more than one, and it can
never be removed.
Paul.