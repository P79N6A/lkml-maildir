Date: Fri, 26 Dec 2008 19:35:12 +0100
From: Sam Ravnborg <>
Subject: Re: [PATCH -tip] Switch arm defconfig files from CONFIG_CLASSIC_RCU to CONFIG_TREE_RCU.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/26/156

On Thu, Dec 25, 2008 at 11:23:32AM -0800, Paul E. McKenney wrote:
> On Thu, Dec 25, 2008 at 10:33:01AM +0100, Sam Ravnborg wrote:
> > On Thu, Dec 25, 2008 at 09:36:11AM +0100, Ingo Molnar wrote:
> > > 
> > > below is the fix for another small buglet that hits architectures that do 
> > > not include kernel/Kconfig.preempt.
> > 
> > What is needed to let all architectures include Kconfig.preempt?
> > We should not advertise preemption if not supported,
> > but we could do this by a simple Kconfig symbol:
> > 
> > config HAVE_PREEMPT
> > 	bool
> > 
> > And let all architectures that supports preemption do:
> > 
> > config "ARCH"
> > 	select HAVE_PREEMPT
> > 
> > But maybe there is a simpler solution
> 
> The idea being to make things like PREEMPT then depend on HAVE_PREEMPT?
Yes - exactly.
So an arch can say that is includes support for preemption
using the following Kconfig snippet:
config X86
	select HAVE_PREEMPT
And then in the spot where we have a prompt we do:
config PREEMPT
	bool "Do you want preemption?"
	depends on HAVE_PREEMPT
Thne we will only present this option to the user
for the architectures where it has indicated preemption
support by selecting HAVE_PREEMPT.
It is on purpose that HAVE_PREEMPT is a single boolean
with no prompt or anything so we do not hit
any of the pitfalls of using select.
We use a similar pattern in many places today.
	Sam