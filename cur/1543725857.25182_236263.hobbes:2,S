Date: Mon, 26 Jul 2004 13:10:28 +0200
From: Ingo Molnar <>
Subject: Re: [patch] voluntary-preempt-2.6.8-rc2-I3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/7/26/48

* Thomas Charbonnel <thomas@undata.org> wrote:
> Hi,
> 
> I'm experiencing hard freezes in the early stage of the latency test
> suite (X11 test, latencytest-0.5.4) with 2.6.8-rc2-I4, both with the
> default vp:2 kp:0 and with vp:0 kp:0 (nvidia card, xfree drivers). I
> was also experiencing hard freezes before with 2.6.7-mm7-H4 while
> doing intensive disk I/O on reiserfs (e.g. tar big_file.tar.gz)
weird. Do you get these freezes with CONFIG_VOLUNTARY and CONFIG_PREEMPT
turned off in the .config as well? Do you get them with the patch
unapplied altogether?
hm ... arent you using the SMP kernel by any chance? The latencytest
module has an SMP locking bug, fixed by the patch below.
	Ingo
--- latencytest/kernel/latencytest.c.orig
+++ latencytest/kernel/latencytest.c
@@ -41,7 +41,7 @@ static void my_interrupt(void *private_d
 	spin_lock(&my_lock);
 	count++;
 	if (count < irq_count)
-		return;
+		goto out_unlock;
 	count = 0;
 	if (irq_info.processed < MAX_PROC_CNTS) {
 		int i;
@@ -69,6 +69,7 @@ static void my_interrupt(void *private_d
 	}
 	irq_info.processed++;
 	wake_up(&my_sleep);
+out_unlock:
 	spin_unlock(&my_lock);
 }
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/