Date: Sun, 17 Aug 2003 14:38:48 -0400
From: Jeff Garzik <>
Subject: [bk patches] add ethtool_ops to net drivers
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/17/114

Linus,
In order to maintain backwards compatibility and minimize impact,
netdev_ops mentioned at KS was scaled back to ethtool_ops.  This allows
driver-at-a-time replacement often-duplicated ioctl handling code with a
Linux-style foo_ops set of function pointers.
Also, I've been waiting on this patch to begin attacking the stack
usage problems that often occur in ethtool ioctl handlers.  Since gcc
sums instead of unions disjoint stack scopes (gcc bug #9997), huge
functions that handle a bunch of ioctls wind up eating way more stack
space than the programmer (rightfully) intended.  ethtool_ops not
only makes a driver smaller, but it also neatly eliminates the stack
usage problem.
I much prefer this scaled back approach, which doesn't break anything,
and DaveM is ok with it as well.  Please apply.
BitKeeper repo:
	bk pull 
http://gkernel.bkbits.net/ethtool-2.6
Patch is also available from
ftp://ftp.kernel.org/pub/linux/kernel/people/jgarzik/patchkits/2.6/2.6.0-test3-bk5-ethtool1.patch.bz2
This will update the following files:
 drivers/net/tg3.c         |  664 +++++++++++++++++++--------------------------
 include/linux/ethtool.h   |   99 ++++++
 include/linux/netdevice.h |    9 
 net/core/Makefile         |    4 
 net/core/dev.c            |   16 -
 net/core/ethtool.c        |  672 ++++++++++++++++++++++++++++++++++++++++++++++
 6 files changed, 1076 insertions(+), 388 deletions(-)
through these ChangeSets:
<jgarzik@redhat.com> (03/08/07 1.1119.10.3)
   [netdrvr] add SET_ETHTOOL_OPS back-compat hook
<jgarzik@redhat.com> (03/08/07 1.1119.10.2)
   [netdrvr tg3] convert to using ethtool_ops
<jgarzik@redhat.com> (03/08/07 1.1119.10.1)
   [netdrvr] add ethtool_ops to struct net_device, and associated infrastructure
   
   Contributed by Matthew Wilcox.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/