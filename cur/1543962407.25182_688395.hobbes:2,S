Date: Fri, 2 May 2008 08:56:30 -0500
From: Matt Domsch <>
Subject: Re: [PATCH] fix x86 DMI checks for PCI quirks
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/5/2/205

On Fri, May 02, 2008 at 02:19:34AM -0700, Yinghai Lu wrote:
> On Fri, May 2, 2008 at 12:44 AM, Ingo Molnar <mingo@elte.hu> wrote:
> >  * Matt Domsch <Matt_Domsch@dell.com> wrote:
> >
> >  > fix x86 DMI checks for PCI quirks
> >  >
> >  > 
http://bugzilla.kernel.org/show_bug.cgi?id=10583
> >  > 
https://bugzilla.redhat.com/show_bug.cgi?id=444791
> >  >
> >  > Since git commit 08f1c192c3c32797068bfe97738babb3295bbf42 (between
> >  > kernels 2.6.22 and 2.6.23), arch/x86/pci/acpi.c has not called
> >  > pcibios_scan_root(), which would have called
> >  > arch/x86/pci/common.c:dmi_check_system().  This has prevented the
> >  > quirks listed in pciprobe_dmi_table[] from being checked and
> >  > appropriate action taken.
> >
> >  ugh ...
> >
> >
> >  > This manifests itself in several Dell and HP servers not automatically
> >  > having the pci=bfsort option be applied, as well as Samsung X20 and
> >  > Compaq EVO N800c systems needing pci=assign-all-busses was no longer
> >  > automatically applied.
> >
> >  Jesse Barnes (new PCI maintainer) Cc:-ed.
> 
> please check the patch in x86.git, it should do the same thing, but
> put the call in pci_access_init...
> 
> commit 9817aa147000086bc11b571620ecc1c73a4a614b
> Author: Yinghai Lu <yhlu.kernel@gmail.com>
> Date:   Mon Apr 14 15:40:37 2008 -0700
Indeed it does (boot tested on one of the affected systems), and is a
simpler patch.  I'd be quite happy with this.  Bonus that it's already
in the x86.git tree. :-)
Ingo, is this ready to go to Linus?
Now to get it backported to -stable...
Adding the folks from HP who have lots of systems listed.
Thanks,
Matt
-- 
Matt Domsch
Linux Technology Strategist, Dell Office of the CTO
linux.dell.com & www.dell.com/linux