Date: Wed, 14 Nov 2001 18:32:30 -0500
From: Jeff Garzik <>
Subject: Re: [PATCH] fb_mmap() holding BKL
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/11/14/222

Paul Mundt wrote:
> Just a minor cleanup.. in the event of some sanity checking in fb_mmap(), the
> BKL is accidentally held on a return.. this trivial patch fixes this issue.
No idea why your patch didn't apply here, but it didn't.
Attached is the same fix patch, rediff'd against 2.4.15-pre4.
	Jeff
-- 
Jeff Garzik      | Only so many songs can be sung
Building 1024    | with two lips, two lungs, and one tongue.
MandrakeSoft     |         - nomeansnoIndex: drivers/video/fbmem.c
===================================================================
RCS file: /cvsroot/gkernel/linux_2_4/drivers/video/fbmem.c,v
retrieving revision 1.4
diff -u -r1.4 fbmem.c
--- drivers/video/fbmem.c	2001/10/11 09:39:14	1.4
+++ drivers/video/fbmem.c	2001/11/14 23:31:44
@@ -563,8 +563,10 @@
 		/* memory mapped io */
 		off -= len;
 		fb->fb_get_var(&var, PROC_CONSOLE(info), info);
-		if (var.accel_flags)
+		if (var.accel_flags) {
+			unlock_kernel();
 			return -EINVAL;
+		}
 		start = fix.mmio_start;
 		len = PAGE_ALIGN((start & ~PAGE_MASK)+fix.mmio_len);
 	}