Date: Mon, 26 Nov 2007 09:43:21 -0800
From: Randy Dunlap <>
Subject: [PATCH] hexdump: don't print bytes with bit 7 set
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/11/26/164

From: Randy Dunlap <randy.dunlap@oracle.com>
As Herbert Xu pointed out, bytes (chars) with bit 7 (0x80) set are
true with isprint() but they may not be isascii() but be Unicode
instead, so don't try to print them in hex dumps.
Signed-off-by: Randy Dunlap <randy.dunlap@oracle.com>
---
 lib/hexdump.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)
--- linux-2.6.24-rc3.orig/lib/hexdump.c
+++ linux-2.6.24-rc3/lib/hexdump.c
@@ -106,7 +106,8 @@ void hex_dump_to_buffer(const void *buf,
 	while (lx < (linebuflen - 1) && lx < (ascii_column - 1))
 		linebuf[lx++] = ' ';
 	for (j = 0; (j < rowsize) && (j < len) && (lx + 2) < linebuflen; j++)
-		linebuf[lx++] = isprint(ptr[j]) ? ptr[j] : '.';
+		linebuf[lx++] = (isascii(ptr[j]) && isprint(ptr[j])) ? ptr[j]
+				: '.';
 nil:
 	linebuf[lx++] = '\0';
 }
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/