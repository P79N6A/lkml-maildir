Date: Wed, 15 Nov 2006 06:15:09 +0900
From: Akinobu Mita <>
Subject: [PATCH -mm] failslab: remove __GFP_HIGHMEM filtering
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/11/14/241

Filtering __GFP_HIGHMEM flag for slab allocations is useless.
Because no one sets __GFP_HIGHMEM for slab allocator, unlike
for page allocator.
Signed-off-by: Akinobu Mita <akinobu.mita@gmail.com>
 Documentation/fault-injection/fault-injection.txt |    2 --
 mm/slab.c                                         |   17 ++---------------
 2 files changed, 2 insertions(+), 17 deletions(-)
Index: work-fault-inject/mm/slab.c
===================================================================
--- work-fault-inject.orig/mm/slab.c
+++ work-fault-inject/mm/slab.c
@@ -3105,15 +3105,10 @@ static struct failslab_attr {
 
 	struct fault_attr attr;
 
-	u32 ignore_gfp_highmem;
 	u32 ignore_gfp_wait;
-
 #ifdef CONFIG_FAULT_INJECTION_DEBUG_FS
-
-	struct dentry *ignore_gfp_highmem_file;
 	struct dentry *ignore_gfp_wait_file;
-
-#endif /* CONFIG_FAULT_INJECTION_DEBUG_FS */
+#endif
 
 } failslab = {
 	.attr = FAULT_ATTR_INITIALIZER,
@@ -3131,8 +3126,6 @@ static int should_failslab(struct kmem_c
 		return 0;
 	if (flags & __GFP_NOFAIL)
 		return 0;
-	if (failslab.ignore_gfp_highmem && (flags & __GFP_HIGHMEM))
-		return 0;
 	if (failslab.ignore_gfp_wait && (flags & __GFP_WAIT))
 		return 0;
 
@@ -3156,15 +3149,9 @@ static int __init failslab_debugfs(void)
 		debugfs_create_bool("ignore-gfp-wait", mode, dir,
 				      &failslab.ignore_gfp_wait);
 
-	failslab.ignore_gfp_highmem_file =
-		debugfs_create_bool("ignore-gfp-highmem", mode, dir,
-				      &failslab.ignore_gfp_highmem);
-
-	if (!failslab.ignore_gfp_wait_file ||
-			!failslab.ignore_gfp_highmem_file) {
+	if (!failslab.ignore_gfp_wait_file) {
 		err = -ENOMEM;
 		debugfs_remove(failslab.ignore_gfp_wait_file);
-		debugfs_remove(failslab.ignore_gfp_highmem_file);
 		cleanup_fault_attr_dentries(&failslab.attr);
 	}
 
Index: work-fault-inject/Documentation/fault-injection/fault-injection.txt
===================================================================
--- work-fault-inject.orig/Documentation/fault-injection/fault-injection.txt
+++ work-fault-inject/Documentation/fault-injection/fault-injection.txt
@@ -86,7 +86,6 @@ configuration of fault-injection capabil
 	specifies the maximum stacktrace depth walked during search
 	for a caller within [address-start,address-end).
 
-- /debug/failslab/ignore-gfp-highmem:
 - /debug/fail_page_alloc/ignore-gfp-highmem:
 
 	Format: { 0 | 1 }
@@ -167,7 +166,6 @@ echo 10 > /debug/$FAILNAME/probability
 echo 100 > /debug/$FAILNAME/interval
 echo -1 > /debug/$FAILNAME/times
 echo 2 > /debug/$FAILNAME/verbose
-echo 1 > /debug/$FAILNAME/ignore-gfp-highmem
 echo 1 > /debug/$FAILNAME/ignore-gfp-wait
 
 blacklist()
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/