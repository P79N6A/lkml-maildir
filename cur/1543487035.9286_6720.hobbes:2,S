Date: Tue, 23 Feb 1999 16:13:26 +0100
From: Romano Giannetti <>
Subject: bug with pipes with newest kernels (2.2.2)?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/2/23/99

Hi all, I have some strange problem with pipes with the last kernels
(I really could not trace back when it all began). With 2.2.2 I
noticed that sometime a local mail would delay some minute in
delivering. Now I could verify that asking for a big compressed file
with info (jed -info) will lead to a (ps -lw):
0  1153   524   523  19   0   1092   388 pipe_write  S   p2  0:00 zcat
-f /usr/info/egcs.info.gz
process that is practically stuck. Sendmail too when it is so slow is
waiting in pipe_write or pipe_read. I am sure it is not a problem with
the file because a zcat -f /usr/info/egcs.info.gz | cat > /dev/null is
almost immediate. 523 is the ppid, jed in this case, reading from the
pipe.
pern:% strace -p 524                                   
write(1, "it the argument count word.  Thi"..., 28680
pern:~% ls -l /proc/524/fd
total 0
lrwx------   1 romano   romano         64 Feb 23 16:06 0 -> /dev/ttyp2
l-wx------   1 romano   romano         64 Feb 23 16:06 1 -> pipe:[762]
lrwx------   1 romano   romano         64 Feb 23 16:06 2 -> /dev/tty
lrwx------   1 romano   romano         64 Feb 23 16:06 3 -> /dev/tty
lr-x------   1 romano   romano         64 Feb 23 16:06 4 ->
/usr/info/egcs.info.gz
The calling process: 
pern:~% strace -p 523
read(4, 0x80a72f8, 0)                   = -1 EAGAIN (Resource
temporarily unavailable)
nanosleep(0xbffff67c, 0xbffff67c, 0x401146cc, 0x80972f8, 0x4) = 0
read(4, 0x80a72f8, 0)                   = -1 EAGAIN (Resource
temporarily unavailable)
nanosleep(0xbffff67c, 0xbffff67c, 0x401146cc, 0x80972f8, 0x4) = 0
read(4, 0x80a72f8, 0)                   = -1 EAGAIN (Resource
temporarily unavailable)
... and repeating
ls -l /proc/523/fd 
total 0
lrwx------   1 romano   romano         64 Feb 23 16:09 0 -> /dev/ttyp2
lrwx------   1 romano   romano         64 Feb 23 16:09 1 -> /dev/ttyp2
lrwx------   1 romano   romano         64 Feb 23 16:09 2 -> /dev/tty
lrwx------   1 romano   romano         64 Feb 23 16:09 3 -> /dev/tty
lr-x------   1 romano   romano         64 Feb 23 16:09 4 -> pipe:[762]
Linux pern 2.2.2 #5 Tue Feb 23 10:45:28 CET 1999 i686 unknown
pern:~% ls -l /usr/info/egcs.info.gz
-rw-r--r--   1 root     root       368592 Oct 14 13:23 /usr/info/egcs.info.gz
sendmail ends with a timeout and recovering. Jed is still waiting (5
minutes and counting). I am sure that in the past it worked.
Any idea on what's happening here? 
Romano 
-- 
Romano Giannetti, Professor  -  Univ. Pontificia Comillas (Madrid, Spain)
Electronic Engineer - phone +34 915 422 800 ext 2410  fax +34 915 596 569
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/