Date: Wed, 9 Jan 2008 01:03:58 +0100
From: Andi Kleen <>
Subject: Re: [JANITOR PROPOSAL] Switch ioctl functions to ->unlocked_ioctl II
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/8/512

> paolo@paolo-desktop:~/linux-2.6/mm$ grep "struct file_operations" *
> shmem.c:static const struct file_operations shmem_file_operations;
> shmem.c:static const struct file_operations shmem_file_operations = {
> swapfile.c:static const struct file_operations proc_swaps_operations = {
> 
> Am I right in saying that both the files don't need to be modified?
If they don't have an ioctl handler they don't need to be modified, correct.
> 
> There is nothing like:
> struct file_operations xyz_ops = {
>        ...
>        .ioctl = xyz_ioctl
> };
> 
> in there.
> 
> So I guess I need a smarter trick to find out which files need to be modified
> as you previously suggested.
grep -P '\.ioctl.*=' $(grep -rl 'struct file_operations' * )
should work. There are also special multiline greps iirc that might also be able
to do this better (like sgrep)
-Andi