Date: Wed, 31 May 2006 04:49:30 +0900
From: OGAWA Hirofumi <>
Subject: Re: .17rc5 cfq slab corruption.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/30/292

Jens Axboe <axboe@suse.de> writes:
> Yep, looks like that is missing as well. Care to send a proper patch and
> I'll shove it in, too.
Sorry.
-- 
OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>
[PATCH] Fix missing list_del(&__cic->queue_list)
We should kill cic from cfqd->cic_list before freeing it.
Signed-off-by: OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>
---
 block/cfq-iosched.c |    1 +
 1 file changed, 1 insertion(+)
diff -puN block/cfq-iosched.c~cfq-missing-list_del block/cfq-iosched.c
--- linux-2.6/block/cfq-iosched.c~cfq-missing-list_del	2006-05-31 04:42:36.000000000 +0900
+++ linux-2.6-hirofumi/block/cfq-iosched.c	2006-05-31 04:42:55.000000000 +0900
@@ -1225,6 +1225,7 @@ static void cfq_free_io_context(struct i
 	while ((n = rb_first(&ioc->cic_root)) != NULL) {
 		__cic = rb_entry(n, struct cfq_io_context, rb_node);
 		rb_erase(&__cic->rb_node, &ioc->cic_root);
+		list_del(&__cic->queue_list);
 		kmem_cache_free(cfq_ioc_pool, __cic);
 		freed++;
 	}
_
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/