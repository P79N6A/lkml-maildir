Date: Sat, 24 Dec 2005 00:32:26 -0800 (PST)
From: Linus Torvalds <>
Subject: Re: More info for DSM w/r/t sunffb on 2.6.15-rc6
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/12/24/8

On Fri, 23 Dec 2005, David S. Miller wrote:
>
> Something like this patch below.
> 
> Signed-off-by: David S. Miller <davem@davemloft.net>
> 
> diff --git a/drivers/video/sbuslib.c b/drivers/video/sbuslib.c
> index 646c43f..ac937da 100644
> --- a/drivers/video/sbuslib.c
> +++ b/drivers/video/sbuslib.c
> @@ -46,6 +46,9 @@ int sbusfb_mmap_helper(struct sbus_mmap_
>  	unsigned long off;
>  	int i;
> 
> +	if (!(vma->vm_flags & VM_SHARED))
> +		return -EINVAL;
> +
Side note - as I explained to Nick the other week, VM_SHARED really means 
"shared _writable_" mapping, so you're now disallowing a shared read-only 
open too.
Which may be fine, of course. Especially if sbusfb always ends up giving a 
writable pfn-mapping. But I wanted to check that that was what you meant 
to do.
To test for MAP_SHARED, either do the is_cow_mapping() thing, or check 
the VM_MAYSHARE bit.
		Linus
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/