Date: Tue, 27 Sep 2005 16:27:54 +0200
From: Stian Jordet <>
Subject: Re: bogus VIA IRQ fixup in drivers/pci/quirks.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/27/109

Sitat Linus Torvalds <torvalds@osdl.org>:
>
>
> On Mon, 26 Sep 2005, Olaf Hering wrote:
> >
> > Why is the irq changed from 24 to 0, and why does uhci use irq 24
> > anyway? I dont have the /proc/interrupts output from this box, maybe no
> > interrupt is handled for the controller? None of the attached usb
> > devices is recognized with 2.6.13.
>
> Did that USB controller use to work in older kernels?
>
> > <6>USB Universal Host Controller Interface driver v2.3
> > <4>PCI: Enabling device 0000:00:0e.0 (0094 ->0095)
> > <6>PCI:Via IRQ fixup for 0000:00:0e.0, from 24 to 0
>
> That does seem to be seriously broken.
>
> The old code wouldn't do that IRQ fixup for IO-APIC users, and I think
> that's correct.
>
> The commit (93cffffa19960464a52f9c78d9a6150270d23785) says:
>
>     [PATCH] PCI: do VIA IRQ fixup always, not just in PIC mode
>
>     At least some VIA chipsets require the fixup even in IO-APIC mode.
>
>     This was found and debugged with the patient assistance of Stian
>     Jordet <liste@jordet.nu> on an Asus CUV266-DLS motherboard.
>
> and I've cc'd the guilty parties.
First, I've no idea of the reasons behind Bjorn's patch. I've had a
longstanding bug which makes network traffic generate interrupts on irq
11 (which is for usb), after 100 000 interrupts, irq 11 is disabled.
Which is boring. So after seeing Bjorn using some time fixing
VIA-related bugs on LKML, I thought I'd mail him and ask for help.
He wanted me to test 2.6.12-rc2-mm3, which actually disabled irq9 as
well at boottime. After some debugging, he made this patch, which made
irq 9 work as normal again for me. Please don't back this patch out,
without at least re-looking at my system.
That other bug, noone have been able to fix, yet.
Attached is dmesg of 2.6.14-rc2-git3.
Best regards,
Stian
[unhandled content-type:application/octet-stream]