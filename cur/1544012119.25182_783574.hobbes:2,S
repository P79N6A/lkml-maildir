Date: Tue, 23 Dec 2008 08:36:17 -0500 (EST)
From: Justin Piszcz <>
Subject: 2.6.27.10: cannot mount xfs filesystem partition (12TiB) after reboot
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/23/66

Kernel = 2.6.27.10
Parted = 1.8.8.git.2008.03.24-11.1
Can anyone help explain the problem here?
After a reboot:
p34:~# mount /dev/sda1 /r1
mount: you must specify the filesystem type
(from dmesg)
[   75.325551] XFS: bad magic number
[   75.325557] XFS: SB validate failed
p34:~# xfs_repair -n /dev/sda1
Phase 1 - find and verify superblock...
bad primary superblock - bad magic number !!!
attempting to find secondary superblock...
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................< no go >
So I re-did what I did before the reboot, this time though I removed the 
old partition and created a new one just as I did before.
p34:~# parted /dev/sda
GNU Parted 1.8.8
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) p 
Model: AMCC 9650SE-16M DISK (scsi)
Disk /dev/sda: 13.0TB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Number  Start   End     Size    File system  Name  Flags
  1      17.4kB  13.0TB  13.0TB  xfs
(parted) rm 1
(parted) print 
Model: AMCC 9650SE-16M DISK (scsi)
Disk /dev/sda: 13.0TB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Number  Start  End  Size  File system  Name  Flags
(parted) q 
Information: You may need to update /etc/fstab.
p34:~# od -c -N 2000 /dev/sda
0000000  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0000700 001  \0   î   þ   ÿ   ÿ 001  \0  \0  \0   ÿ   ÿ   ÿ   ÿ  \0  \0
0000720  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0000760  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0   U   ª
0001000   E   F   I       P   A   R   T  \0  \0 001  \0   \  \0  \0  \0
0001020   ; 213   #   Ë  \0  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0001040   ÿ   ÿ   a   é 005  \0  \0  \0   "  \0  \0  \0  \0  \0  \0  \0
0001060   Þ   ÿ   a   é 005  \0  \0  \0   ï   *   w   p   ê   £  \a   @
0001100   ©   ²   Þ 212 225   #   ½ 206 002  \0  \0  \0  \0  \0  \0  \0
0001120 200  \0  \0  \0 200  \0  \0  \0 206   Ò   T   «  \0  \0  \0  \0
0001140  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0003720
p34:~# parted /dev/sda
GNU Parted 1.8.8
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) p 
Model: AMCC 9650SE-16M DISK (scsi)
Disk /dev/sda: 13.0TB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Number  Start  End  Size  File system  Name  Flags
(parted) mklabel gpt 
Warning: The existing disk label on /dev/sda will be destroyed and all data on
this disk will be lost. Do you want to continue?
parted: invalid token: gpt
Yes/No? yes 
New disk label type?  [gpt]? 
(parted) p 
Model: AMCC 9650SE-16M DISK (scsi)
Disk /dev/sda: 13.0TB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Number  Start  End  Size  File system  Name  Flags
(parted) mkpart 
Partition name?  []? 
File system type?  [ext2]? xfs 
Start? 0 
End? 13T 
(parted) p 
Model: AMCC 9650SE-16M DISK (scsi)
Disk /dev/sda: 13.0TB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Number  Start   End     Size    File system  Name  Flags
  1      17.4kB  13.0TB  13.0TB  xfs
(parted) quit 
Information: You may need to update /etc/fstab.
p34:~# mount /dev/sda1 /r1
p34:~# df -h
/dev/sda1              12T  2.2T  9.8T  18% /r1
Is this normal?  Now everything is fine etc, how come this information is 
not kept across reboots?  Are partitions broken > 10T?
p34:~# od -c -N 200000 /dev/sda| grep -E '^.*X*F*S.*$'
0042000   X   F   S   B  \0  \0 020  \0  \0  \0  \0  \0   ½   ,   ?   ÷
p34:~# od -c -N 200000 /dev/sda| nl | grep -E '^.*X*F*S.*$'
     20  0042000   X   F   S   B  \0  \0 020  \0  \0  \0  \0  \0   ½   ,   ?   ÷
How come the information is 'lost' after a reboot?
I have done this same process with ext3 and no issues when the partition is
less than 6TiB, am I hitting some kind of bug here with parted or XFS?
Justin.