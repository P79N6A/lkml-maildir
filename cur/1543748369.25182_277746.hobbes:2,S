Date: Thu, 9 Dec 2004 08:32:33 +0100
From: Martin Waitz <>
Subject: Re: [RFC] new timeofday core subsystem (v.A1)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/12/9/10

hoi :)
On Wed, Dec 08, 2004 at 05:32:13PM -0800, john stultz wrote:
> Ah, actually, you missed something. The remainder you propose above is
> in units of cycles multiplied by mult. Thus to get it back to just
> cycles, we have to divide. So:
> 
> 	ret *= ts->mult;
> 	if (rem)
> 		*rem = (ret & (1 << ts->shift -1))/mult;
> 	ret >>= ts->shift;
you are of course right
> Agreed?
well, divisions are always slow and we would loose precision again.
I have another suggestion: just keep the remainder in units of
cycles*mult.
	ret *= ts->mult
	if (rem) {
		ret += *rem;
		*rem = ret & (1 << ts->shift -1);
	}
	ret >>= ts->shift
and remove the offset_base adjustion below.
-- 
Martin Waitz
[unhandled content-type:application/pgp-signature]