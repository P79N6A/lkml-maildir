Date: Thu, 7 Aug 2003 20:40:58 +0200
From: Bernd Schubert <>
Subject: Re: [2.4.21]: nbd ksymoops-report
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/7/254

Hello!
Yes we are using the nbd-client from sf.net (due to other problems we replaced 
the debian (non-standard) sf.net binary with our own compiled binary).
On Thursday 07 August 2003 19:34, you wrote:
> Paul Clements wrote:
> > On Thu, 7 Aug 2003, Bernd Schubert wrote:
> > > every time when nbd-client disconnects a nbd-device the decoded oops
> > > from below will happen.
> > > This only happens after we upgraded from 2.4.20 to 2.4.21,
> > > so I guess the backported update from 2.5.50 causes this.
>
> [snip]
>
> > This corresponds to the following source:
> >
> > lo->sock->ops->shutdown(lo->sock, SEND_SHUTDOWN|RCV_SHUTDOWN);
> >
> > Somehow, lo->sock is NULL here. The only way I see that this could
>
> Alright, looking back over the nbd-client source I now see what's going
> on. You're calling "nbd-client -d" to manually disconnect?
The debian /etc/init.d/nbd-client script calls this on stopping stopping nbd. 
To make nbd working again after this oops we always need to reboot now (found 
this out after my first mail), so I'm really looking for an alternative way 
of stopping nbd. Would 'killall nbd-client' work?
>
> > Would you be willing to test a patch against 2.4.21?
>
> If you're willing to test the attached patch, I'd be grateful. Otherwise
> I'll test it in the next few days and forward on to Marcelo...
I will first test it at home. Unfortunality my laptop is in repair at IBM, so 
I only can use nbd via localhost.
If there is a way to prevent the reboot of the client, I can test it on monday 
on our cluster at work. 
Thanks a lot for your very fast help. Since we are using nbd to have a 
fallback server of our main server, we really need a working solution.
Thanks again and best regards,
	Bernd
-- 
Bernd Schubert
Physikalisch Chemisches Institut / Theoretische Chemie
Universit√§t Heidelberg
INF 229
69120 Heidelberg
e-mail: bernd.schubert@pci.uni-heidelberg.de
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/