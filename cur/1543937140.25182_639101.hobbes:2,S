Date: Wed, 16 Jan 2008 14:44:35 +0100
From: Hoang-Nam Nguyen <>
Subject: [PATCH] IB/ipoib: Fix undefined symbol (priv->cm) if ipoib_cm disabled
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/16/122

Signed-off-by: Hoang-Nam Nguyen <hnguyen@de.ibm.com>
---
 drivers/infiniband/ulp/ipoib/ipoib_main.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)
diff --git a/drivers/infiniband/ulp/ipoib/ipoib_main.c b/drivers/infiniband/ulp/ipoib/ipoib_main.c
index e499626..0a58ac4 100644
--- a/drivers/infiniband/ulp/ipoib/ipoib_main.c
+++ b/drivers/infiniband/ulp/ipoib/ipoib_main.c
@@ -181,6 +181,7 @@ static int ipoib_change_mtu(struct net_device *dev, int new_mtu)
 {
 	struct ipoib_dev_priv *priv = netdev_priv(dev);
 
+#ifdef CONFIG_INFINIBAND_IPOIB_CM
 	/* dev->mtu > 2K ==> connected mode */
 	if (ipoib_cm_admin_enabled(dev)) {
 		if (new_mtu > priv->cm.max_cm_mtu)
@@ -193,6 +194,7 @@ static int ipoib_change_mtu(struct net_device *dev, int new_mtu)
 		dev->mtu = new_mtu;
 		return 0;
 	}
+#endif
 
 	if (new_mtu > IPOIB_PACKET_SIZE - IPOIB_ENCAP_LEN)
 		return -EINVAL;
-- 
1.5.2