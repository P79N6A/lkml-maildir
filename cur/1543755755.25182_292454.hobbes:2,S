Date: Thu, 03 Feb 2005 11:48:52 -0800
From: Roland Dreier <>
Subject: [PATCH] InfiniBand: remove unbalance refcnt decrement
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/2/3/211

From: Michael S. Tsirkin <mst@mellanox.co.il>
Fix unbalanced QP reference count decrement (introduced with QP lock
optimization patch)
Signed-off-by: Michael S. Tsirkin <mst@mellanox.co.il>
Signed-off-by: Roland Dreier <roland@topspin.com>
--- linux-bk.orig/drivers/infiniband/hw/mthca/mthca_cq.c	2005-01-28 11:11:03.000000000 -0800
+++ linux-bk/drivers/infiniband/hw/mthca/mthca_cq.c	2005-02-03 11:47:39.300426349 -0800
@@ -422,8 +422,6 @@
 				*freed = 0;
 			}
 			spin_unlock(&(*cur_qp)->lock);
-			if (atomic_dec_and_test(&(*cur_qp)->refcount))
-				wake_up(&(*cur_qp)->wait);
 		}
 
 		spin_lock(&dev->qp_table.lock);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/