Date: Tue, 23 May 2006 19:59:49 +0200
From: Andreas Mohr <>
Subject: [PATCH] -mm: cyrix code CONFIG_PCI fix / add __initdata
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/23/151

Hello all,
PCI code was outside of CONFIG_PCI, add __initdata at cyrix_55x0
(since accessed within __init function only).
i386 run-tested on 2.6.17-rc4-mm3. However since this is no Cyrix here,
not ultimately sure whether it really works.
Signed-off-by: Andreas Mohr <andi@lisas.de>
diff -urN linux-2.6.17-rc4-mm3.orig/arch/i386/kernel/cpu/cyrix.c linux-2.6.17-rc4-mm3.my/arch/i386/kernel/cpu/cyrix.c
--- linux-2.6.17-rc4-mm3.orig/arch/i386/kernel/cpu/cyrix.c	2006-05-23 17:50:00.000000000 +0200
+++ linux-2.6.17-rc4-mm3.my/arch/i386/kernel/cpu/cyrix.c	2006-05-23 17:26:25.000000000 +0200
@@ -184,7 +184,7 @@
 
 
 #ifdef CONFIG_PCI
-static struct pci_device_id cyrix_55x0[] = {
+static struct pci_device_id __initdata cyrix_55x0[] = {
 	{ PCI_DEVICE(PCI_VENDOR_ID_CYRIX, PCI_DEVICE_ID_CYRIX_5510) },
 	{ PCI_DEVICE(PCI_VENDOR_ID_CYRIX, PCI_DEVICE_ID_CYRIX_5520) },
 	{ },
@@ -272,15 +272,16 @@
 
 		printk(KERN_INFO "Working around Cyrix MediaGX virtual DMA bugs.\n");
 		isa_dma_bridge_buggy = 2;
-#endif		
-		c->x86_cache_size=16;	/* Yep 16K integrated cache thats it */
- 
+
+
 		/*
 		 *  The 5510/5520 companion chips have a funky PIT.
 		 */  
 		if (pci_dev_present(cyrix_55x0))
 			pit_latch_buggy = 1;
-
+#endif		
+		c->x86_cache_size=16;	/* Yep 16K integrated cache thats it */
+ 
 		/* GXm supports extended cpuid levels 'ala' AMD */
 		if (c->cpuid_level == 2) {
 			/* Enable cxMMX extensions (GX1 Datasheet 54) */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/