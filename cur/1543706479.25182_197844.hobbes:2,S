Date: Wed, 11 Feb 2004 12:58:39 +0100
From: Takashi Iwai <>
Subject: Re: 2.6.3-rc1: snd_intel8x0 still too fast
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/11/49

At Tue, 10 Feb 2004 14:03:40 +0200 (EET),
Meelis Roos wrote:
> 
> > > mplayer /usr/share/sounds/KDE_Startup.wav
> > > gives the same very fast sound since it's a 22 KHz mono sample.
> > >
> > > mplayer -srate 48000 /usr/share/sounds/KDE_Startup.wav
> > > works fine. Same applies to all files.
> >
> > then VRA of ac97 seems not working correctly.
> > check /proc/asound/card0/codec97#0/* files for each case whether the
> > DAC rate is set correctly.  (it must be tuned with the detected ac97
> > clock, i.e. rate * clock / 48000).
> 
> PCM front DAC    : 41133Hz
> PCM ADC          : 48000Hz
> 
> This is with "intel8x0: clocking to 41133" and playing with mplayer
> -srate 48000 ...
> 
> PCM front DAC    : 18895Hz
> PCM ADC          : 48000Hz
does the attached patch improve?
if it still doesn't help, try the following:
- stop ALSA once
- remove /etc/asound.state
- restart ALSA and tune up mixer again
Takashi
--- linux/sound/pci/ac97/ac97_patch.c	9 Feb 2004 11:38:03 -0000	1.35
+++ linux/sound/pci/ac97/ac97_patch.c	11 Feb 2004 11:56:19 -0000
@@ -682,6 +682,9 @@
 	jack = snd_ac97_read(ac97, AC97_AD_JACK_SPDIF);
 	snd_ac97_write_cache(ac97, AC97_AD_JACK_SPDIF, jack | 0x0300);
 
+	/* set default */
+	snd_ac97_write_cache(ac97, AC97_AD_MISC, 0);
+
 	ac97->build_ops = &patch_ad1885_build_ops;
 	return 0;
 }