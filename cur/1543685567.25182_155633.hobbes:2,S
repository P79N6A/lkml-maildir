Date: Fri, 8 Aug 2003 15:10:55 +0200
From: Adrian Bunk <>
Subject: [2.4 patch] fix cmd640 with modular IDE
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/8/75

Hi Alan,
2.4.22-rc1 with CONFIG_BLK_DEV_IDE=m and CONFIG_BLK_DEV_CMD640=y results 
in an unresolved reference to init_cmd640_vlb when depmod runs.
The patch below fixes this.
I've only tested the compilation, if it's not possible to use the 
CMD640 support modular, I'll send another patch that only adds the 
dependency on CONFIG_BLK_DEV_IDE (and therefore CMD640 will be 
unusable with modular IDE).
--- linux-2.4.22-rc1-modular/drivers/ide/Config.in.old	2003-08-08 01:27:27.000000000 +0200
+++ linux-2.4.22-rc1-modular/drivers/ide/Config.in	2003-08-08 01:30:35.000000000 +0200
@@ -27,8 +27,10 @@
 
    comment 'IDE chipset support/bugfixes'
    if [ "$CONFIG_BLK_DEV_IDE" != "n" ]; then
-      dep_bool '  CMD640 chipset bugfix/support' CONFIG_BLK_DEV_CMD640 $CONFIG_X86
-      dep_bool '    CMD640 enhanced support' CONFIG_BLK_DEV_CMD640_ENHANCED $CONFIG_BLK_DEV_CMD640
+      dep_tristate '  CMD640 chipset bugfix/support' CONFIG_BLK_DEV_CMD640 $CONFIG_X86 $CONFIG_BLK_DEV_IDE
+      if [ "$CONFIG_BLK_DEV_CMD640" != "n" ]; then
+         bool '    CMD640 enhanced support' CONFIG_BLK_DEV_CMD640_ENHANCED
+      fi
       dep_bool '  ISA-PNP EIDE support' CONFIG_BLK_DEV_ISAPNP $CONFIG_ISAPNP
       if [ "$CONFIG_PCI" = "y" ]; then
 	 bool '  PCI IDE chipset support' CONFIG_BLK_DEV_IDEPCI
cu
Adrian
-- 
       "Is there not promise of rain?" Ling Tan asked suddenly out
        of the darkness. There had been need of rain for many days.
       "Only a promise," Lao Er said.
                                       Pearl S. Buck - Dragon Seed
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/