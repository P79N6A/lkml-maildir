Date: Thu, 27 Oct 2005 08:26:37 -0700
From: Andrew Vasquez <>
Subject: Re: 2.6.14-rc5-mm1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/10/27/72

On Mon, 24 Oct 2005, Andrew Morton wrote:
> Badari Pulavarty <pbadari@gmail.com> wrote:
> >
> > On Mon, 2005-10-24 at 01:48 -0700, Andrew Morton wrote:
> > > 
ftp://ftp.kernel.org/pub/linux/kernel/people/akpm/patches/2.6/2.6.14-rc5/2.6.14-rc5-mm1/
> > > 
> > 
> > I can't seem to keep my AMD64 machine up with 2.6.14-rc5-mm1.
> > Keep running into following. qlogic driver problem ?
> 
> I don't know why the qlogic driver has suddenly started doing this - were
> there any earlier messages which might tell us?  Is it possible to increase
> the debugging level?
> 
> I can spot one bug in there, but the lockup is just a symptom.
> 
> There are no qlogic changes in 2.6.14-rc5-mm1.
> 
> > Thanks,
> > Badari
> > 
> > NMI Watchdog detected LOCKUP on CPU 0
> > CPU 0
> > Modules linked in: qlogicfc qla2300 qla2200 qla2xxx firmware_class
qlogicfc attaches to both 2100 and 2200 ISPs.  It seems you're then
trying to load qla2xxx driver along with the 2300 and 2200 firmware
loader modules.  The pci_request_regions() call during 2200 probing
fails.
> > <ffffffff8010dd2e>{system_call+12 6}
> 
> qla2x00_probe_one() has called qla2x00_free_device() and
> qla2x00_free_device() has locked up in
> wait_for_completion(&ha->dpc_exited);
> 
> Presumably, ha->dpc_exited is not initialised yet.
> 
Causing this cleanup badness.
> The first `goto probe_failed' in qla2x00_probe_one() will cause
> qla2x00_free_device() to run wait_for_completion() against an uninitialised
> completion struct.  Because ha->dpc_pid will be >= 0.
> 
> This patch might fix the lockup, but if so, qla2x00_iospace_config()
> failed.  Please debug that a bit for us?
Badari, is there some reason you are using qlogicfc?  THe qla2xxx
driver supports all QLogic ISP parts.
> Andrew, this driver should be converted to use the kthread API - using
> kill_proc() from within a driver to terminate a kernel thread is kinda
> gross.
I'll look into this as well
Thanks,
Andrew Vasquez
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/