Date: 22 Nov 1999 18:29:34 +0100
From: Trond Myklebust <>
Subject: Re: klogd & syslogd slow to shutdown (related to RPC)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/22/70

>>>>> " " == Thierry Danis <danis@sagem.fr> writes:
     > Hello,
     > 	We have since kernels 2.2.x (in fact I observed it under RH
     > 	6.0 and RH 6.1) very long time for klogd and syslogd to
     > 	shutdown whenever a NFS partition was busy and hence could not
     > 	be unmounted during the shutdown process.  They both end up
     > 	with a bunch of RPC errmsg 101 (or something like that), and
     > 	it takes a really long time before the shutdown process
     > 	continues (sometimes 10+ minutes when 3 or 4 NFS partitions
     > 	are busy).
     > 	Is there a way to avoid that ?
This is caused by the lock manager, which looks for the portmapper
when shutting down the lockd daemon in order to unregister itself. If
the portmapper is not running then you will have to wait for the
timeout to kick in.
If this is a bother, you can try using the knfsd patches. They disable
the code which automatically starts (stops) lockd upon mount (unmount)
of the partition. Instead, you control whether lockd is running or not
using the rpc.lockd utility. (Note that this is the standard method of
control used in the RH6.1 kernels.)
Cheers,
  Trond
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/