Date: Tue, 19 Sep 2000 22:17:59 +0200
From: Floris Kraak <>
Subject: [OOPS] 2.2.18pre9 Oops on rmmod of mousedev.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/19/164

( This has been resend, linux-usb@suse.de already got a copy as well as the usb-uhci maintainer as listed in MAINTAINERS )
DISCLAIMER: This oops may very well be categorized in the 'user
shoots himself' department but I still thought it interesting enough
to post a bugreport and see if anything can be done against it.
So here goes.
Using kernel version 2.2.18pre9, use the following steps to get a
repeatable kernel oops:
1) Compile kernel with usb support: hid.c, mousedev.c, input.c et al.
2) Install kernel, insmod USB drivers.
3) Configure gpm to use /dev/input/mice and the attached M$ USB mouse.
(all is fine at this point, no problems whatsoever, the mouse works
like a charm)
4) rmmod mousedev.c (okay, stupid but heck I was playing around ;)
5) restart gpm
6) watch the nice oops message and laugh :)
So here it is.
----
Oops: 0000
CPU:    0
EIP:    0010:[do_select+256/512]
EFLAGS: 00010282
eax: d00a1c40   ebx: 00000000   ecx: 00000145   edx: c71fe180
esi: 00000000   edi: 00000001   ebp: 00000000   esp: c7367f1c
ds: 0018   es: 0018   ss: 0018
Process gpm (pid: 1652, process nr: 41, stackpage=c7367000)
Stack: cf174ef8 00000000 c7e99b34 00000001 00000011 c7366000 c7366000 0083c733 
       00000000 c6cd4000 0000000e 080580e0 00000002 c012ffdd 00000003 c7367f9c 
       c7367f98 00000000 c7366000 00000000 bffff898 bffffacc 00000002 00000001 
Call Trace: [sys_select+881/1176] [system_call+52/56] 
Code: 8b 40 10 85 c0 74 10 83 c4 f8 8b 4c 24 30 51 52 ff d0 89 c1 
----
After running it through ksymoops:
----
ksymoops 2.3.4 on i686 2.2.18pre9.  Options used
     -V (specified)
     -k /proc/ksyms (specified)
     -l /proc/modules (specified)
     -o /lib/modules/2.2.18pre9/ (specified)
     -m /boot/System.map-2.2.18pre9 (specified)
Warning (compare_maps): ksyms_base symbol module_list_R__ver_module_list not found in System.map.  Ignoring ksyms_base entry
Oops: 0000
CPU:    0
EIP:    0010:[do_select+256/512]
EFLAGS: 00010282
eax: d00a1c40   ebx: 00000000   ecx: 00000145   edx: c71fe180
esi: 00000000   edi: 00000001   ebp: 00000000   esp: c7367f1c
ds: 0018   es: 0018   ss: 0018
Process gpm (pid: 1652, process nr: 41, stackpage=c7367000)
Stack: cf174ef8 00000000 c7e99b34 00000001 00000011 c7366000 c7366000 0083c733 
       00000000 c6cd4000 0000000e 080580e0 00000002 c012ffdd 00000003 c7367f9c 
       c7367f98 00000000 c7366000 00000000 bffff898 bffffacc 00000002 00000001 
Call Trace: [sys_select+881/1176] [system_call+52/56] 
Code: 8b 40 10 85 c0 74 10 83 c4 f8 8b 4c 24 30 51 52 ff d0 89 c1 
Using defaults from ksymoops -t elf32-i386 -a i386
Code;  00000000 Before first symbol
00000000 <_EIP>:
Code;  00000000 Before first symbol
   0:   8b 40 10                  mov    0x10(%eax),%eax
Code;  00000003 Before first symbol
   3:   85 c0                     test   %eax,%eax
Code;  00000005 Before first symbol
   5:   74 10                     je     17 <_EIP+0x17> 00000017 Before first symbol
Code;  00000007 Before first symbol
   7:   83 c4 f8                  add    $0xfffffff8,%esp
Code;  0000000a Before first symbol
   a:   8b 4c 24 30               mov    0x30(%esp,1),%ecx
Code;  0000000e Before first symbol
   e:   51                        push   %ecx
Code;  0000000f Before first symbol
   f:   52                        push   %edx
Code;  00000010 Before first symbol
  10:   ff d0                     call   *%eax
Code;  00000012 Before first symbol
  12:   89 c1                     mov    %eax,%ecx
1 warning issued.  Results may not be reliable.
----
How do I get rid of the warning anyway? I've never used ksymoops
before so I probably am doing something wrong here :)
And finally, for those who care to know every gory detail, here's the
syslog, including boot messages & oops. (Edited for brevity, and
probably not needed but I like to be on the safe side)
----
Sep 19 19:59:20 tobefree syslogd 1.3-3#33: restart.
Sep 19 19:59:20 tobefree kernel: klogd 1.3-3#33, log source = /proc/kmsg started.
Sep 19 19:59:20 tobefree kernel: Inspecting /boot/System.map-2.2.18pre9
Sep 19 19:59:20 tobefree kernel: Loaded 6269 symbols from /boot/System.map-2.2.18pre9.
Sep 19 19:59:20 tobefree kernel: Symbols match kernel version 2.2.18.
Sep 19 19:59:20 tobefree kernel: Loaded 482 symbols from 26 modules.
Sep 19 19:59:20 tobefree kernel: Linux version 2.2.18pre9 (root@tobefree) (gcc version 2.95.2 20000220 (Debian GNU/Linux)) #1 Mon Sep 18 23:53:00 CEST 2000
Sep 19 19:59:20 tobefree kernel: Detected 434326 kHz processor.
Sep 19 19:59:20 tobefree kernel: Calibrating delay loop... 865.08 BogoMIPS
Sep 19 19:59:20 tobefree kernel: Memory: 257920k/262080k available (864k kernel code, 416k reserved, 2824k data, 56k init)
Sep 19 19:59:20 tobefree kernel: Dentry hash table entries: 32768 (order 6, 256k)
Sep 19 19:59:20 tobefree kernel: Buffer cache hash table entries: 262144 (order 8, 1024k)
Sep 19 19:59:20 tobefree kernel: Page cache hash table entries: 65536 (order 6, 256k)
Sep 19 19:59:20 tobefree kernel: Intel machine check architecture supported.
Sep 19 19:59:20 tobefree kernel: Intel machine check reporting enabled on CPU#0.
Sep 19 19:59:20 tobefree kernel: CPU: Intel Celeron (Mendocino) stepping 05
Sep 19 19:59:20 tobefree kernel: mtrr: v1.35a (19990819) Richard Gooch (rgooch@atnf.csiro.au)
Sep 19 19:59:20 tobefree kernel: PCI: PCI BIOS revision 2.10 entry at 0xf0720
Sep 19 19:59:20 tobefree kernel: PCI: Using configuration type 1
Sep 19 19:59:20 tobefree kernel: PCI: Probing PCI hardware
Sep 19 19:59:20 tobefree kernel: Detected PS/2 Mouse Port.
Sep 19 19:59:20 tobefree kernel: Serial driver version 4.27 with no serial options enabled
Sep 19 19:59:20 tobefree kernel: ttyS00 at 0x03f8 (irq = 4) is a 16550A
Sep 19 19:59:20 tobefree kernel: ttyS01 at 0x02f8 (irq = 3) is a 16550A
Sep 19 19:59:20 tobefree kernel: pty: 256 Unix98 ptys configured
Sep 19 19:59:20 tobefree kernel: PIIX4: IDE controller on PCI bus 00 dev 21
Sep 19 19:59:20 tobefree kernel: PIIX4: not 100% native mode: will probe irqs later
Sep 19 19:59:20 tobefree kernel: apm: BIOS version 1.2 Flags 0x03 (Driver version 1.13)
Sep 19 19:59:20 tobefree kernel: mice: PS/2 mouse device common for all mice
Sep 19 19:59:20 tobefree kernel: usb.c: registered new driver usbdevfs
Sep 19 19:59:20 tobefree kernel: usb.c: registered new driver hub
Sep 19 19:59:22 tobefree ipppd[334]: Found 1 device: /dev/ippp0
Sep 19 19:59:22 tobefree ipppd[339]: ipppd i2.2.10 (isdn4linux version of pppd by MH) started
Sep 19 19:59:22 tobefree ipppd[339]: init_unit: 0 
Sep 19 19:59:22 tobefree ipppd[339]: Connect[0]: /dev/ippp0, fd: 8
Sep 19 19:59:28 tobefree kernel: mtrr: 0xce000000,0x2000000 overlaps existing 0xcf000000,0x1000000
Sep 19 20:09:49 tobefree kernel: usb.c: registered new driver hid
Sep 19 20:10:09 tobefree kernel: usb-uhci.c: $Revision: 1.232 $ time 23:59:09 Sep 18 2000
Sep 19 20:10:09 tobefree kernel: usb-uhci.c: High bandwidth mode enabled
Sep 19 20:10:09 tobefree kernel: usb-uhci.c: Intel USB controller: setting latency timer to 0
Sep 19 20:10:09 tobefree kernel: usb-uhci.c: USB UHCI at I/O 0xd400, IRQ 9
Sep 19 20:10:09 tobefree kernel: usb-uhci.c: Detected 2 ports
Sep 19 20:10:09 tobefree kernel: usb.c: new USB bus registered, assigned bus number 1
Sep 19 20:10:09 tobefree kernel: usb.c: USB new device connect, assigned device number 1
Sep 19 20:10:09 tobefree kernel: Product: USB UHCI Root Hub
Sep 19 20:10:09 tobefree kernel: SerialNumber: d400
Sep 19 20:10:09 tobefree kernel: hub.c: USB hub found
Sep 19 20:10:09 tobefree kernel: hub.c: 2 ports detected
Sep 19 20:10:10 tobefree kernel: usb.c: USB new device connect, assigned device number 2
Sep 19 20:10:10 tobefree kernel: Manufacturer: Microsoft
Sep 19 20:10:10 tobefree kernel: Product: Microsoft IntelliMouse® Explorer
Sep 19 20:10:10 tobefree kernel: mouse0: PS/2 mouse device for input0
Sep 19 20:10:10 tobefree kernel: input0: USB HID v1.00 Mouse [Microsoft Microsoft IntelliMouse® Explorer] on usb1:2.0
Sep 19 20:18:56 tobefree kernel: Linux agpgart interface v0.99 (c) Jeff Hartmann
Sep 19 20:18:56 tobefree kernel: agpgart: Maximum main memory to use for agp memory: 203M
Sep 19 20:18:56 tobefree kernel: agpgart: Detected Intel 440BX chipset
Sep 19 20:18:56 tobefree kernel: agpgart: AGP aperture is 256M @ 0xd0000000
Sep 19 20:19:47 tobefree kernel: Oops: 0000
Sep 19 20:19:47 tobefree kernel: CPU:    0
Sep 19 20:19:47 tobefree kernel: EIP:    0010:[do_select+256/512]
Sep 19 20:19:47 tobefree kernel: EFLAGS: 00010282
Sep 19 20:19:47 tobefree kernel: eax: d00a1c40   ebx: 00000000   ecx: 00000145   edx: c71fe180
Sep 19 20:19:47 tobefree kernel: esi: 00000000   edi: 00000001   ebp: 00000000   esp: c7367f1c
Sep 19 20:19:47 tobefree kernel: ds: 0018   es: 0018   ss: 0018
Sep 19 20:19:47 tobefree kernel: Process gpm (pid: 1652, process nr: 41, stackpage=c7367000)
Sep 19 20:19:47 tobefree kernel: Stack: cf174ef8 00000000 c7e99b34 00000001 00000011 c7366000 c7366000 0083c733 
Sep 19 20:19:47 tobefree kernel:        00000000 c6cd4000 0000000e 080580e0 00000002 c012ffdd 00000003 c7367f9c 
Sep 19 20:19:47 tobefree kernel:        c7367f98 00000000 c7366000 00000000 bffff898 bffffacc 00000002 00000001 
Sep 19 20:19:47 tobefree kernel: Call Trace: [sys_select+881/1176] [system_call+52/56] 
Sep 19 20:19:47 tobefree kernel: Code: 8b 40 10 85 c0 74 10 83 c4 f8 8b 4c 24 30 51 52 ff d0 89 c1 
Sep 19 20:19:47 tobefree kernel: Oops: 0000
Sep 19 20:19:47 tobefree kernel: CPU:    0
Sep 19 20:19:47 tobefree kernel: EIP:    0010:[filp_close+45/108]
Sep 19 20:19:47 tobefree kernel: EFLAGS: 00010282
Sep 19 20:19:47 tobefree kernel: eax: d00a1c40   ebx: c71fe180   ecx: c71ce9bc   edx: c71fe180
Sep 19 20:19:47 tobefree kernel: esi: c77e7920   edi: 00000000   ebp: 00000001   esp: c7367e10
Sep 19 20:19:47 tobefree kernel: ds: 0018   es: 0018   ss: 0018
Sep 19 20:19:47 tobefree kernel: Process gpm (pid: 1652, process nr: 41, stackpage=c7367000)
Sep 19 20:19:47 tobefree kernel: Stack: 00000000 c0113610 cfcf3e60 c7367ee0 c7366000 c0118104 c71fe180 c71ce8a0 
Sep 19 20:19:47 tobefree kernel:        cfcf3e78 c011808d c7367ee0 000000a1 cfcf3e78 c7366000 00000096 00000001 
Sep 19 20:19:47 tobefree kernel:        c71ce9bc c7366000 c7367ee0 c0200d56 c0200d56 c010a5f7 0000000b c01b980e 
Sep 19 20:19:47 tobefree kernel: Call Trace: [mm_release+16/52] [do_exit+336/688] [do_exit+217/688] [die+71/72] [error_table+9230/9504] [error_table+9152/9504] [do_page_fault+729/992] 
Sep 19 20:19:47 tobefree kernel:        [error_table+9230/9504] [schedule+326/636] [schedule_timeout+120/148] [schedule_timeout+111/148] [error_code+45/56] [nls_cp850:__insmod_nls_cp850_O/lib/modules/2.2.18pre9/fs/nls_cp850.o_+-123840/96] [do_select+256/512] [sys_select+881/1176] 
Sep 19 20:19:47 tobefree kernel:        [system_call+52/56] 
Sep 19 20:19:47 tobefree kernel: Code: 8b 40 20 85 c0 74 0b 83 c4 f4 53 ff d0 89 c7 83 c4 10 83 7e 
----
That's it. Have fun with it (or just ignore it at your leisure, your
call ;)
Regards,
Floris
-- 
           Intel: where Quality is job number 0.9998782345!
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/