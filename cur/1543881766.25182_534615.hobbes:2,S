Date: Wed, 25 Apr 2007 11:21:46 +0100
From: Alan Cox <>
Subject: Re: 2.6.21-rc7-mm1 BUG at kernel/sched-clock.c:175 init_sched_clock()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/4/25/106

>  static void ahci_freeze(struct ata_port *ap)
>  {
> +	void __iomem *mmio = ap->host->iomap[AHCI_PCI_BAR];
>  	void __iomem *port_mmio = ahci_port_base(ap);
> 
>  	/* turn IRQ off */
>  	writel(0, port_mmio + PORT_IRQ_MASK);
> +
> +	/* clear IRQ pending bit */
> +	writel(1 << ap->port_no, mmio + HOST_IRQ_STAT);
Neither of those two are going to help in all cases. They are PCI writes
to mmio so they are posted. You don't know they hit the device until a
read cycle coming back has completed, so you need to read something after
doing this to be sure.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/