Date: Tue, 20 Jan 2009 14:47:19 -0800 (PST)
From: David Miller <>
Subject: Re: [PATCH] usb/mcs7830: Don't use buffers from stack for USB transfers
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/20/334

From: Arnd Bergmann <arnd@arndb.de>
Date: Tue, 20 Jan 2009 23:45:47 +0100
> On Tuesday 20 January 2009, you wrote:
> > From: Christian Eggers <christian.eggers@kathrein.de>
> > 
> > mcs7830_set_reg() and mcs7830_get_reg() are called with buffers
> > from stack which must not be used directly for USB transfers.
> > This causes corruption of the stack particulary on non x86
> > architectures because DMA may be used for these transfers.
> > 
> > Signed-off-by: Christian Eggers <christian.eggers@kathrein.de>
> 
> Have you observed problems with this, or just suspected trouble?
Yes, this is in response to SH platform failures.
You cannot DMA from/to the kernel stack, because it might not be in
the aliased linear mapping of physical memory.  It could even be
vmalloc()'d memory on some platforms.