Date: Tue, 24 Jun 2003 00:19:53 +0200
From: Jan-Benedict Glaw <>
Subject: Re: Testing IDE-TCQ and Taskfile - doesn't work nicely:)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/6/23/229

On Mon, 2003-06-23 23:18:00 +0200, Bartlomiej Zolnierkiewicz <B.Zolnierkiewicz@elka.pw.edu.pl>
wrote in message <Pine.SOL.4.30.0306232315480.8078-200000@mion.elka.pw.edu.pl>:
> On Mon, 23 Jun 2003, Jan-Benedict Glaw wrote:
> > I've played a bit with my "mirror" machine
> >
> > - 200MHz Pentium-MMX
> > - 64MB RAM
> > - jbglaw@mirror:~$ cat /proc/ide/hd*/model
> >   WDC AC2850F		# System drive
> >   IC35L040AVER07-0	# \
> >   IC35L120AVV207-0	#   > Storage (with DM/LVM)
> >   Maxtor 4W100H6	# /
> > - jbglaw@mirror:~$ lspci |grep IDE
> >   00:07.1 IDE interface: Intel Corp. 82371AB/EB/MB PIIX4 IDE (rev 01)
> > - Linux v2.5.73
> > - <*> Intel PIIXn chipsets support
> >
> > Basically, if I enable Taskfile I/O, the box refuses to boot (basically,
> > the first drive sounds really broken like "clack   clack   clack" and no
> > data comes off the drive so there's no partition table, no root FS, but
> > a panic:) Is anybody interested in nailing this bug down?
> 
> YES
What can I do about this one? I'll try to capture the lines... Taskfile
I/O seems to hit my drive(s) really hard:)
> > Disabling Taskfile lets me boot the box, but hdc doesn't like TCQ and
> > gives errors:
> >
> > ide_tcq_intr_timeout: timeout waiting for service interrupt
> > ide_tcq_intr_timeout: missing isr!
> > hdc: invalidating tag queue (0 commands)
> > hdc: drive_cmd: status=0x51 { DriveReady SeekComplete Error }
> > hdc: drive_cmd: error=0x04 { DriveStatusError }
> > [above messages repeat...]
> 
> TCQ shouldn't be enabled on hdc, you have two drives on second ide
> channel and current TCQ driver design allows only one drive per channel,
> so proper fix is to not enable TCQ :-).
> 
> Can you try attached patch?
I'll rebuild with your patch and give it a try (TCQ enabled, Taskfile
disabled...).
MfG, JBG
-- 
   Jan-Benedict Glaw       jbglaw@lug-owl.de    . +49-172-7608481
   "Eine Freie Meinung in  einem Freien Kopf    | Gegen Zensur | Gegen Krieg
    fuer einen Freien Staat voll Freier BÃ¼rger" | im Internet! |   im Irak!
      ret = do_actions((curr | FREE_SPEECH) & ~(IRAQ_WAR_2 | DRM | TCPA));
[unhandled content-type:application/pgp-signature]