Date: Wed, 15 Mar 2000 05:49:29 -0800
From: "David S. Miller" <>
Subject: Re: [patch] small fixes for 2.3.51
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/16/34

   Date:   Tue, 14 Mar 2000 22:35:58 +0100
   From: Q <Q@ping.be>
   I made a little patch.
   Most of it should explain itself.
A lot of it is wrong, here are comments on just a few
pieces as to why:
   --- include/linux/vt_kern.h.bak	Tue Mar 14 18:31:15 2000
   +++ include/linux/vt_kern.h	Tue Mar 14 18:31:27 2000
   @@ -30,7 +30,7 @@
	   wait_queue_head_t paste_wait;
    } *vt_cons[MAX_NR_CONSOLES];
   -void (*kd_mksound)(unsigned int hz, unsigned int ticks);
   +void kd_mksound(unsigned int hz, unsigned int ticks);
    /* console.c */
This needs to be a "function pointer", it is used by various
architectures to override the PC-centric "Keyboard BEEP" function
with whatever is appropriate for that machine.
See drivers/sbus/char/pcikbd.c and drivers/sbus/char/sunkbd.c
for two examples of this.
   --- net/ipv4/tcp_ipv4.c.bak	Tue Mar 14 18:21:08 2000
   +++ net/ipv4/tcp_ipv4.c	Tue Mar 14 18:22:06 2000
   @@ -883,6 +883,7 @@
	   struct sock *sk;
	   __u32 seq;
	   int err;
   +	struct open_request *req, **prev;
	   if (len < (iph->ihl << 2) + ICMP_MIN_LENGTH) { 
		   ICMP_INC_STATS_BH(IcmpInErrors); 
   @@ -953,7 +954,6 @@
	   }
	   switch (sk->state) {
   -		struct open_request *req, **prev;
	   case TCP_LISTEN:
		   if (sk->lock.users != 0)
			   goto out;
Do not do this.  We almost always put variables into the innermost
possible basic block because GCC does horrible register allocation
otherwise.
Later,
David S. Miller
davem@redhat.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/