Date: Wed, 16 Oct 2002 19:26:55 -0200 (BRST)
From: Marcelo Tosatti <>
Subject: Re: 2.4.20pre11aa1 Compile Error
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/16/327

On Wed, 16 Oct 2002, Johannes Ruscheinski wrote:
> make[1]: Entering directory `/usr/src/kernel/linux-2.4.20pre11aa1/arch/i386/kernel'
> gcc -D__KERNEL__ -I/usr/src/kernel/linux-2.4.20pre11aa1/include -Wall -Wstrict-prototypes -Wno-trigraphs -O2 -fno-strict-aliasing -fno-common -fomit-frame-pointer -pipe -mpreferred-stack-boundary=2 -march=i686 -malign-functions=4    -nostdinc -iwithprefix include -DKBUILD_BASENAME=mpparse  -c -o mpparse.o mpparse.c
> mpparse.c:70: `dest_LowestPrio' undeclared here (not in a function)
> make[1]: *** [mpparse.o] Error 1
> make[1]: Leaving directory `/usr/src/kernel/linux-2.4.20pre11aa1/arch/i386/kernel'
>
> .config upon request.
This was caused by a mistake in a patch in 2.4.20-pre11.
The following patch should fix your problem.
diff -Nru a/arch/i386/kernel/io_apic.c b/arch/i386/kernel/io_apic.c
--- a/arch/i386/kernel/io_apic.c	Wed Oct 16 19:26:36 2002
+++ b/arch/i386/kernel/io_apic.c	Wed Oct 16 19:26:36 2002
@@ -40,6 +40,10 @@
 static spinlock_t ioapic_lock = SPIN_LOCK_UNLOCKED;
+unsigned int int_dest_addr_mode = APIC_DEST_LOGICAL;
+unsigned char int_delivery_mode = dest_LowestPrio;
+
+
 /*
  * # of IRQ routing registers
  */
diff -Nru a/arch/i386/kernel/mpparse.c b/arch/i386/kernel/mpparse.c
--- a/arch/i386/kernel/mpparse.c	Wed Oct 16 19:26:36 2002
+++ b/arch/i386/kernel/mpparse.c	Wed Oct 16 19:26:36 2002
@@ -66,8 +66,6 @@
 /* Bitmask of physically existing CPUs */
 unsigned long phys_cpu_present_map;
-unsigned int int_dest_addr_mode = APIC_DEST_LOGICAL;
-unsigned char int_delivery_mode = dest_LowestPrio;
 unsigned char esr_disable = 0;
 /*
diff -Nru a/include/asm-i386/smpboot.h b/include/asm-i386/smpboot.h
--- a/include/asm-i386/smpboot.h	Wed Oct 16 19:26:36 2002
+++ b/include/asm-i386/smpboot.h	Wed Oct 16 19:26:36 2002
@@ -26,16 +26,20 @@
 	}
 	return cpu_online_map;
 }
+#ifdef CONFIG_X86_IO_APIC
 extern unsigned char int_delivery_mode;
 extern unsigned int int_dest_addr_mode;
 #define	INT_DEST_ADDR_MODE (int_dest_addr_mode)
 #define	INT_DELIVERY_MODE (int_delivery_mode)
-#else
+#endif /* CONFIG_X86_IO_APIC */
+#else /* CONFIG_X86_LOCAL_APIC */
 #define esr_disable (0)
 #define target_cpus() (0x01)
+#ifdef CONFIG_X86_IO_APIC
 #define INT_DEST_ADDR_MODE (APIC_DEST_LOGICAL)	/* logical delivery */
 #define INT_DELIVERY_MODE (dest_LowestPrio)
-#endif
+#endif /* CONFIG_X86_IO_APIC */
+#endif /* CONFIG_X86_LOCAL_APIC */
 #define TRAMPOLINE_LOW phys_to_virt((clustered_apic_mode == CLUSTERED_APIC_NUMAQ)?0x8:0x467)
 #define TRAMPOLINE_HIGH phys_to_virt((clustered_apic_mode == CLUSTERED_APIC_NUMAQ)?0xa:0x469)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/