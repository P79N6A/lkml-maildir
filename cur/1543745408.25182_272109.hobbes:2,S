Date: Thu, 18 Nov 2004 13:35:21 +0100
From: Ingo Molnar <>
Subject: [patch] Real-Time Preemption, -RT-2.6.10-rc2-mm1-V0.7.28-1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/11/18/75

i have released the -V0.7.28-1 Real-Time Preemption patch, which can be
downloaded from the usual place:
	
http://redhat.com/~mingo/realtime-preempt/
this should fix the lockup bug reported by Florian Schmidt.
there's a generic PREEMPT bug in the upstream kernel: there exists a
single-instruction race window in __flush_tlb(), if the kernel preempted
exactly there in a lazy-TLB thread and certain other, rare scheduling
and MM properties were true as well (a certain constellation of threads
and lazy-TLB kernel threads occured), and the lazy-TLB task then got
another user TLB to inherit, and switched to a task from which it
inherited that new TLB, thus the wrong cr3 was loaded and inherited by
this next, non-lazy-TLB next task; then (and only then) this scenario
would typically manifest itself in the form of an infinite pagefault
lockup occuring much after the fact, upon the next userspace access (to
the joy of a totally baffled kernel developer). I suspect from the
description you can guess how much fun it was to debug it =B-)
the bug is even more rare in the generic kernel, because there most (but
not all) TLB flush points are in a critical section.
this fix could resolve some of the other 'my box just locked up'
reports.
Changes since a -V0.7.28-0:
 - reverted the UP-ioapic change - it was unrelated to the lockup and it
   is known to cause problems on certain IDE/soundcard combinations.
 - fixed and improved the trace_print_on_crash tracing feature - it was
   highly needed to find the TLB bug ...
to create a -V0.7.28-1 tree from scratch, the patching order is:
  
http://kernel.org/pub/linux/kernel/v2.6/linux-2.6.9.tar.bz2
  
http://kernel.org/pub/linux/kernel/v2.6/testing/patch-2.6.10-rc2.bz2
  
http://kernel.org/pub/linux/kernel/people/akpm/patches/2.6/2.6.10-rc2/2.6.10-rc2-mm1/2.6.10-rc2-mm1.bz2
  
http://redhat.com/~mingo/realtime-preempt/realtime-preempt-2.6.10-rc2-mm1-V0.7.28-1
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/