Date: Wed, 18 Jul 2007 00:45:03 +0200
From: Bartlomiej Zolnierkiewicz <>
Subject: Re: regression: disk error loop (panic?) ide_do_rw_disk-bad:
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/17/580

On Tuesday 17 July 2007, Linus Torvalds wrote:
> 
> On Tue, 17 Jul 2007, Bartlomiej Zolnierkiewicz wrote:
> > 
> > ide-disk driver and type 2 (REQ_TYPE_BLOCK_PC) requests don't mix well
> > 
> > Probably some dumb application is sending packet commands without
> > checking the device type...
My original mail contained link to mail explaining the source of the issue
and also commit number introducing the problem...  Both have been stripped
from the reply thus valuable context is lost.
> Ok, we should definitely try to just translate the things, and instead of 
> having user apps that have to know about the (generally not very 
> interesting) differences between IDE and SCSI command set, and when the 
> IDE driver gets a SCSI request (whether from the new generic SG layer or 
The new generic SG layer is CONFIG_SCSI=y "generic" in the current tree.
James has a patch to fix it but IDE subsystem (and probably not only it)
still requires addition of struct class devices to be able to use bsg.
> obviously the older SCSI-ioctl layer) it should "just work".
Agreed but IDE driver has never claimed to have full SAT layer and
full SCSI-ioctl layer support has been provided only for ide-cd.
Full SAT could be done though, possibly by reusing libata-scsi.c.
> So I object to that "dumb application" statement. It's the kernel that has 
> traditionally been dumb in not smoothing over the differences between 
> devices well enough.
> 
> We shouldn't _need_ to have applications care. They should be able to just 
> use regular SCSI commands, and if the device cannot handle a 10-byte read 
> command, the kernel should have translated that into a 6-byte one (for 
> example) rather than the application having to know about idiotic small 
> differences like that.
> 
> That said, I dunno how to fix this particular one, and the IDE driver is 
For now it should be sufficient to revert ide.c chunks of
commit 3d6392cfbd7dc11f23058e3493683afab4ac13a3
Author: Jens Axboe <jens.axboe@oracle.com>
Date:   Mon Jul 9 12:38:05 2007 +0200
    bsg: support for full generic block layer SG v3
    Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
which are completely unrelated to bsg and which never got posted for review.
> singularly unhelpful in actually talking about *what* the command tried to 
> be.
Agreed, debugging info needs some love, being worked on.
Thanks,
Bart
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/