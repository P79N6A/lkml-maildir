Date: Sat, 12 May 2007 23:47:43 -0700
From: Andrew Morton <>
Subject: Re: [PATCH] Workaround for a PCI restoring bug
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/13/23

On Sat, 12 May 2007 22:12:37 +0200 Lukas Hejtmanek <xhejtman@ics.muni.cz> wrote:
> as of 2.6.21-git16, the bugs related to restoring PCI are still present. The
> save pci function reads only -1 from the PCI config space and when restoring,
> it messes up totaly most PCI devices. The attached patch is workaround only
> until proper fix is found and included. Could it be included into the mainline
> for now?
> 
> -- 
> Lukáš Hejtmánek
> 
> 
> [pci.patch  text/x-diff (489B)]
> --- drivers/pci/pci.c.orig	2006-07-15 23:53:08.000000000 +0200
> +++ drivers/pci/pci.c	2006-07-21 00:51:07.000000000 +0200
> @@ -477,7 +477,7 @@
>  	 */
>  	for (i = 15; i >= 0; i--) {
>  		pci_read_config_dword(dev, i * 4, &val);
> -		if (val != dev->saved_config_space[i]) {
> +		if (val != dev->saved_config_space[i] && dev->saved_config_space[i] != 0xffffffff) {
>  			printk(KERN_DEBUG "PM: Writing back config space on "
>  				"device %s at offset %x (was %x, writing %x)\n",
>  				pci_name(dev), i,
This change might indeed be a suitable workaround for some busted hardware,
but we'd need to know quite a bit about the problem before we could merge
anything like this
So, again, please send a full bug report.  An emailed one would be OK in
this case.
Thanks.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/