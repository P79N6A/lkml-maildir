Date: Sun, 10 Jan 1999 23:58:28 -0600 (CST)
From: Sameer Sundresh <>
Subject: ftape writing problems in Linux 2.2.0pre5(&6?)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/11/231

Hello,
I am having problems writing to my tape drive using Linux kernel version
2.2.0pre5.  It does not appear that the diff for pre6 contains any changes
to the ftape module, which is used in my case.
A couple of days ago, I installed the Linux kernel, version 2.2.0pre5. 
Yesterday, I intended to back-up my system, with a brand new 3M/Imation
Travan-3 (3020) minicartridge, in my Exabyte Eagle TR-3 floppy tape drive,
which is connected to the floppy disk controller on my Asus TXP4 Pentium
motherboard.  However, it did not work, having many problems trying to write
to the tape, in general, failing.
From browsing the list archive on LinuxHQ, it appears David Feuer
<dfeuer@his.com> is having a very similar problem.
I was able to read old tapes which I had backed up to under 2.0.x
flawlessly, however, I could not create a new backup.  I am running
GNU mt version 2.4.2, which came with SuSE Linux 5.3.
This command properly backs up my system under 2.0.35, however, it fails in
writing to the tape under 2.2.0pre5:
cat ~/descr.txt > /dev/nrft0 ; mt -f /dev/nrft0 eof 1 ;
	tar -c -b 128 -f /dev/nrft0 / ; mt -f /dev/nrft0 eof 1
Here is an excerpt from my /var/log/messages file.  In the first section of
read errors, I was reading from an older tape.  In the section of write
errors, I was attempting to write to or format the new tape:
Jan 10 03:17:27 par1136 kernel: klogd 1.3-0, log source = /proc/kmsg started.
Jan 10 03:17:40 par1136 login[136]: ROOT LOGIN on `tty1' 
Jan 10 03:22:32 par1136 kernel: [010]     fdc-io.c (fdc_config) - fdc base: 0x3f0, irq: 6, dma: 2.
Jan 10 03:22:32 par1136 kernel: [011]     fdc-io.c (fdc_probe) - Type 82077AA FDC found.
Jan 10 03:22:33 par1136 kernel: [012]    ftape-ctl.c (ftape_log_vendor_id) - tape drive type: Exabyte Eagle TR-3.
Jan 10 03:22:34 par1136 kernel: [013]     ftape-io.c (ftape_report_configuration) - TR-3 tape detected.
Jan 10 03:22:34 par1136 kernel: [014]    ftape-ctl.c (ftape_init_drive) - post QIC-117B drive @ 1000 Kbps.
Jan 10 03:22:34 par1136 kernel: [015]     ftape-ctl.c (ftape_calibrate_data_rate) - Highest FDC supported data rate: 1000 Kbps.
Jan 10 03:22:35 par1136 kernel: [016]       ftape-io.c (ftape_report_configuration) - TR-3 tape detected.
Jan 10 03:22:35 par1136 kernel: [017]    ftape-ctl.c (ftape_init_drive) - unknown length QIC-3020 tape.
Jan 10 03:22:41 par1136 kernel: [018]       ftape-read.c (ftape_decode_header_segment) - calculated tape length is 781 ft.
Jan 10 03:22:41 par1136 kernel: [019]         ftape-bsm.c (print_bad_sector_map) - 1615290 Kb usable on this tape.
Jan 10 03:22:41 par1136 kernel: [020]         ftape-bsm.c (print_bad_sector_map) - 2852 bad sectors.
Jan 10 03:22:41 par1136 kernel: [021]     zftape-read.c (zft_read_header_segments) - Segments written since first format: 55804.
Jan 10 03:22:41 par1136 kernel: [022]     zftape-read.c (zft_read_header_segments) - ft_first_data_segment: 2, ft_last_data_segment: 55799.
Jan 10 03:22:41 par1136 kernel: [023]     zftape-read.c (zft_read_header_segments) - Found old ftaped tape, emulating eof marks, entering read-only mode.
Jan 10 03:22:51 par1136 kernel: [024]   ftape-ctl.c (ftape_disable) - == Non-fatal errors this run: ==.
Jan 10 03:22:51 par1136 kernel: [025]   ftape-ctl.c (ftape_disable) - fdc isr statistics:
Jan 10 03:22:51 par1136 kernel:  id_am_errors     :   0
Jan 10 03:22:51 par1136 kernel:  id_crc_errors    :   0
Jan 10 03:22:51 par1136 kernel:  data_am_errors   :   0
Jan 10 03:22:51 par1136 kernel:  data_crc_errors  :   0
Jan 10 03:22:51 par1136 kernel:  overrun_errors   :   0
Jan 10 03:22:51 par1136 kernel:  no_data_errors   :   0
Jan 10 03:22:51 par1136 kernel:  retries          :   0.
Jan 10 03:22:51 par1136 kernel: [026]   ftape-ctl.c (ftape_disable) - ecc statistics:
Jan 10 03:22:51 par1136 kernel:  crc_errors       :   0
Jan 10 03:22:51 par1136 kernel:  crc_failures     :   0
Jan 10 03:22:51 par1136 kernel:  ecc_failures     :   0
Jan 10 03:22:51 par1136 kernel:  sectors corrected:   0.
Jan 10 03:22:51 par1136 kernel: [027]   ftape-ctl.c (ftape_disable) - tape motion statistics:
Jan 10 03:22:51 par1136 kernel: repositions       :   1.
Jan 10 03:23:42 par1136 login[137]: ROOT LOGIN on `tty2' 
Jan 10 03:24:24 par1136 kernel: [028]   ftape-ctl.c (ftape_disable) - == Non-fatal errors this run: ==.
Jan 10 03:24:24 par1136 kernel: [029]   ftape-ctl.c (ftape_disable) - fdc isr statistics:
Jan 10 03:24:24 par1136 kernel:  id_am_errors     :   0
Jan 10 03:24:24 par1136 kernel:  id_crc_errors    :   0
Jan 10 03:24:24 par1136 kernel:  data_am_errors   :   0
Jan 10 03:24:24 par1136 kernel:  data_crc_errors  :   0
Jan 10 03:24:24 par1136 kernel:  overrun_errors   :   0
Jan 10 03:24:24 par1136 kernel:  no_data_errors   :   0
Jan 10 03:24:24 par1136 kernel:  retries          :   0.
Jan 10 03:24:24 par1136 kernel: [030]   ftape-ctl.c (ftape_disable) - ecc statistics:
Jan 10 03:24:24 par1136 kernel:  crc_errors       :   0
Jan 10 03:24:24 par1136 kernel:  crc_failures     :   0
Jan 10 03:24:24 par1136 kernel:  ecc_failures     :   0
Jan 10 03:24:24 par1136 kernel:  sectors corrected:   0.
Jan 10 03:25:12 par1136 kernel: [031]   ftape-ctl.c (ftape_disable) - == Non-fatal errors this run: ==.
Jan 10 03:25:12 par1136 kernel: [032]   ftape-ctl.c (ftape_disable) - fdc isr statistics:
Jan 10 03:25:12 par1136 kernel:  id_am_errors     :   0
Jan 10 03:25:12 par1136 kernel:  id_crc_errors    :   0
Jan 10 03:25:12 par1136 kernel:  data_am_errors   :   0
Jan 10 03:25:12 par1136 kernel:  data_crc_errors  :   0
Jan 10 03:25:12 par1136 kernel:  overrun_errors   :   0
Jan 10 03:25:12 par1136 kernel:  no_data_errors   :   0
Jan 10 03:25:12 par1136 kernel:  retries          :   0.
Jan 10 03:25:12 par1136 kernel: [033]   ftape-ctl.c (ftape_disable) - ecc statistics:
Jan 10 03:25:12 par1136 kernel:  crc_errors       :   0
Jan 10 03:25:12 par1136 kernel:  crc_failures     :   0
Jan 10 03:25:12 par1136 kernel:  ecc_failures     :   0
Jan 10 03:25:12 par1136 kernel:  sectors corrected:   0.
Jan 10 03:25:38 par1136 kernel: [034]   ftape-ctl.c (ftape_disable) - == Non-fatal errors this run: ==.
Jan 10 03:25:38 par1136 kernel: [035]   ftape-ctl.c (ftape_disable) - fdc isr statistics:
Jan 10 03:25:38 par1136 kernel:  id_am_errors     :   0
Jan 10 03:25:38 par1136 kernel:  id_crc_errors    :   0
Jan 10 03:25:38 par1136 kernel:  data_am_errors   :   0
Jan 10 03:25:38 par1136 kernel:  data_crc_errors  :   0
Jan 10 03:25:38 par1136 kernel:  overrun_errors   :   0
Jan 10 03:25:38 par1136 kernel:  no_data_errors   :   0
Jan 10 03:25:38 par1136 kernel:  retries          :   0.
Jan 10 03:25:38 par1136 kernel: [036]   ftape-ctl.c (ftape_disable) - ecc statistics:
Jan 10 03:25:38 par1136 kernel:  crc_errors       :   0
Jan 10 03:25:38 par1136 kernel:  crc_failures     :   0
Jan 10 03:25:38 par1136 kernel:  ecc_failures     :   0
Jan 10 03:25:38 par1136 kernel:  sectors corrected:   0.
Jan 10 03:26:35 par1136 kernel: [037]   zftape-write.c (check_write_access) - write-count 65536 must be multiple of block-size 10240.
Jan 10 03:26:35 par1136 kernel: [038]  zftape-write.c (_zft_write) - check_write_access(req_len, &volume,&zft_pos,zft_blk_sz) failed: -22.
Jan 10 03:26:35 par1136 kernel: [039]    zftape-ctl.c (zft_check_write_access) - Cannot write to cartridges written by old ftape when not at BOT.
Jan 10 03:26:35 par1136 kernel: [040]   zftape-ctl.c (mtioctop) - zft_check_write_access(&zft_pos) failed: -13.
Jan 10 03:27:20 par1136 kernel: [041]   zftape-write.c (check_write_access) - write-count 4096 must be multiple of block-size 10240.
Jan 10 03:27:20 par1136 kernel: [042]  zftape-write.c (_zft_write) - check_write_access(req_len, &volume,&zft_pos,zft_blk_sz) failed: -22.
Jan 10 03:27:20 par1136 kernel: [043]      zftape-eof.c (zft_clear_ftape_file_marks) - Clearing old ftape's eof map.
Jan 10 03:27:20 par1136 kernel: [044]       zftape-rw.c (zft_update_label) - updating label from "Linux raw format V2" to "Ftape - The Linux Floppy Tape Project!".
Jan 10 03:27:21 par1136 kernel: [045]   zftape-write.c (check_write_access) - write-count 65536 must be multiple of block-size 10240.
Jan 10 03:27:21 par1136 kernel: [046]  zftape-write.c (_zft_write) - check_write_access(req_len, &volume,&zft_pos,zft_blk_sz) failed: -22.
Jan 10 03:27:40 par1136 kernel: [047]           ftape-rw.c (seek_forward) - interrupted by non-blockable signal.
Jan 10 03:27:40 par1136 kernel: [048]          ftape-rw.c (ftape_start_tape) - failed to reposition.
Jan 10 03:27:40 par1136 kernel: [049]         ftape-write.c (ftape_start_writing) - ftape_start_tape(segment_id,head->sector_offset) failed: -4.
Jan 10 03:27:40 par1136 kernel: [050]        ftape-write.c (write_segment) - ftape_start_writing(write_mode) failed: -4.
Jan 10 03:27:40 par1136 kernel: [051]       ftape-write.c (ftape_write_segment) - write_segment failed, error: -4.
Jan 10 03:27:40 par1136 kernel: [052]      zftape-rw.c (zft_verify_write_segments) - Error: Couldn't write segment 1.
Jan 10 03:27:40 par1136 kernel: [053]     zftape-write.c (zft_write_header_segments) - Warning: update of second header segment failed.
Jan 10 03:27:40 par1136 kernel: [054]      ftape-read.c (ftape_read_segment_fraction) - interrupted by non-blockable signal.
Jan 10 03:27:40 par1136 kernel: [055]     zftape-vtbl.c (zft_update_volume_table) - result = ftape_read_segment_fraction(ftape_status.fti_first_data_segment, zft_deblock_buf, FT_RD_SINGLE, 0, ((32 - 3) * 1024)) failed: -4.
Jan 10 03:27:40 par1136 kernel: [056]    zftape-write.c (zft_update_header_segments) - zft_update_volume_table(ftape_status.fti_first_data_segment) failed: -4.
Jan 10 03:27:40 par1136 kernel: [057]   zftape-ctl.c (mtioctop) - zft_update_header_segments() failed: -4.
Jan 10 03:29:31 par1136 kernel: [058]         ftape-rw.c (ftape_start_tape) - failed to reposition.
Jan 10 03:29:31 par1136 kernel: [059]        ftape-write.c (ftape_start_writing) - ftape_start_tape(segment_id,head->sector_offset) failed: -5.
Jan 10 03:29:31 par1136 kernel: [060]       ftape-write.c (write_segment) - ftape_start_writing(write_mode) failed: -5.
Jan 10 03:29:31 par1136 kernel: [061]      ftape-write.c (ftape_write_segment) - write_segment failed, error: -5.
Jan 10 03:29:31 par1136 kernel: [062]     zftape-rw.c (zft_verify_write_segments) - Error: Couldn't write segment 0.
Jan 10 03:29:36 par1136 kernel: [063]      ftape-write.c (ftape_loop_until_writes_done) - fdc_interrupt_wait(5 * 1000) failed: -62.
Jan 10 03:29:36 par1136 kernel: [064]     zftape-rw.c (zft_verify_write_segments) - ftape_loop_until_writes_done() failed: -62.
Jan 10 03:29:36 par1136 kernel: [065]    zftape-write.c (zft_write_header_segments) - Warning: update of first header segment failed.
Jan 10 03:29:36 par1136 kernel: [066]    zftape-write.c (zft_write_header_segments) - Warning: update of second header segment failed.
Jan 10 03:29:36 par1136 kernel: [067]    zftape-write.c (zft_write_header_segments) - Error: update of both header segments failed..
Jan 10 03:29:36 par1136 kernel: [068]   zftape-write.c (zft_update_header_segments) - zft_write_header_segments(zft_hseg_buf) failed: -5.
Jan 10 03:29:36 par1136 kernel: [069]   ftape-ctl.c (ftape_disable) - == Non-fatal errors this run: ==.
Jan 10 03:29:36 par1136 kernel: [070]   ftape-ctl.c (ftape_disable) - fdc isr statistics:
Jan 10 03:29:36 par1136 kernel:  id_am_errors     :   0
Jan 10 03:29:36 par1136 kernel:  id_crc_errors    :   0
Jan 10 03:29:36 par1136 kernel:  data_am_errors   :   0
Jan 10 03:29:36 par1136 kernel:  data_crc_errors  :   0
Jan 10 03:29:36 par1136 kernel:  overrun_errors   :   0
Jan 10 03:29:36 par1136 kernel:  no_data_errors   :   0
Jan 10 03:29:36 par1136 kernel:  retries          :   0.
Jan 10 03:29:36 par1136 kernel: [071]   ftape-ctl.c (ftape_disable) - ecc statistics:
Jan 10 03:29:36 par1136 kernel:  crc_errors       :   0
Jan 10 03:29:36 par1136 kernel:  crc_failures     :   0
Jan 10 03:29:36 par1136 kernel:  ecc_failures     :   0
Jan 10 03:29:36 par1136 kernel:  sectors corrected:   0.
Jan 10 03:29:36 par1136 kernel: [072]   ftape-ctl.c (ftape_disable) - tape motion statistics:
Jan 10 03:29:36 par1136 kernel: repositions       :   2.
Jan 10 03:29:36 par1136 kernel: [073] zftape-init.c (zft_close) - _zft_close failed.
Jan 10 03:30:00 par1136 kernel: Kernel logging (proc) stopped.
Jan 10 03:30:00 par1136 kernel: Kernel log daemon terminating.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/