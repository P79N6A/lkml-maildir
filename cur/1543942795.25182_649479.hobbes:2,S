Date: Wed, 6 Feb 2008 22:04:10 -0500
From: Amy Griffis <>
Subject: Re: inotify_add_watch() returning ENOSPC in 2.6.24 [watch descriptor leak?]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/6/532

Clem Taylor wrote:  [Wed Feb 06 2008, 02:40:58PM EST]
> > Good bug report, thanks.  That code was significantly altered in June 2006
> > and perhaps something broke.
> 
> I also tested on a 2.6.20 x86 desktop machine. It took ~8k iterations
> to fail, which matched max_user_watches. Once the program fails, it
> will fail right away if it is re-run.
> 
> > It's a bit hard to find people who work on inotify, I'm afraid.  If you had
> > the time to come up with a script or program which demonstrates the bug,
> > that would be super-helpful?
> 
> Attached is a simple example that shows off the problem. On a system
> with a problem, it will only run for about
> fs.inotify.max_user_watches iterations. If everything is working, it
> should run forever.
I'll take a look at this. Thanks for providing a reproducer.
Amy