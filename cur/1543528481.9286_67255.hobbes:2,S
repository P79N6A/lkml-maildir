Date: Fri, 3 Mar 2000 19:32:12 +0100
From:  almesber@lrc ...
Subject: [SOLVED] Re: bzImage limitation question
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/3/148

I wrote:
> So yes, something is wrong. It could of course be that the kernel dies an
> early death because of some internal conflicts which aren't related to
> size. Investigating ...
Well, found it. It was size, indeed, just not exactly in the most
obvious way ...
With the attached patch (for 2.3.48), kernels using up to 7 MB should
be okay. This should correspond roughly to a compressed size of 2.5 MB.
Tried with bootimg (vmlinux) and LILO (bzImage). Both get the kernel
running (*). Kernel statistics:
# size vmlinux
   text    data     bss     dec     hex filename
4235019  752417  560816 5548252  54a8dc vmlinux
# objcopy -O binary vmlinux bin; ls -l bin
-rwxr-xr-x   1 root     root      4994368 Mar  3 18:59 bin*
# ls -l arch/i386/boot/bzImage
-rw-r--r--   1 root     root      2221497 Mar  3 18:59 arch/i386/boot/bzImage
(* In order to reach this size, I had to include tons of drivers for
   which I don't have hardware anyway, so at one point it hangs in a
   detection loop (probably TCIC-2), from which it only proceeds if I
   quickly "power-cycle" the machine (this is a Sony-Vaio-ism, don't
   try this at home ;-), and then it eventually dies because I forgot
   devfs=nomount, oh well :-)
- Werner
-- 
  _________________________________________________________________________
 / Werner Almesberger, ICA, EPFL, CH       werner.almesberger@ica.epfl.ch /
/_IN_N_032__Tel_+41_21_693_6621__Fax_+41_21_693_6610_____________________/
--- linux/arch/i386/kernel/head.S.orig	Fri Mar  3 19:07:48 2000
+++ linux/arch/i386/kernel/head.S	Fri Mar  3 19:08:05 2000
@@ -502,134 +502,134 @@
 	.long 0x3f8007,0x3f9007,0x3fa007,0x3fb007,0x3fc007,0x3fd007,0x3fe007,0x3ff007
 
 ENTRY(pg1)
-	.long 0x400007,0x001007,0x002007,0x003007,0x004007,0x005007,0x006007,0x007007
-	.long 0x408007,0x009007,0x00a007,0x00b007,0x00c007,0x00d007,0x00e007,0x00f007
-	.long 0x410007,0x011007,0x012007,0x013007,0x014007,0x015007,0x016007,0x017007
-	.long 0x418007,0x019007,0x01a007,0x01b007,0x01c007,0x01d007,0x01e007,0x01f007
-	.long 0x420007,0x021007,0x022007,0x023007,0x024007,0x025007,0x026007,0x027007
-	.long 0x428007,0x029007,0x02a007,0x02b007,0x02c007,0x02d007,0x02e007,0x02f007
-	.long 0x430007,0x031007,0x032007,0x033007,0x034007,0x035007,0x036007,0x037007
-	.long 0x438007,0x039007,0x03a007,0x03b007,0x03c007,0x03d007,0x03e007,0x03f007
-	.long 0x440007,0x041007,0x042007,0x043007,0x044007,0x045007,0x046007,0x047007
-	.long 0x448007,0x049007,0x04a007,0x04b007,0x04c007,0x04d007,0x04e007,0x04f007
-	.long 0x450007,0x051007,0x052007,0x053007,0x054007,0x055007,0x056007,0x057007
-	.long 0x458007,0x059007,0x05a007,0x05b007,0x05c007,0x05d007,0x05e007,0x05f007
-	.long 0x460007,0x061007,0x062007,0x063007,0x064007,0x065007,0x066007,0x067007
-	.long 0x468007,0x069007,0x06a007,0x06b007,0x06c007,0x06d007,0x06e007,0x06f007
-	.long 0x470007,0x071007,0x072007,0x073007,0x074007,0x075007,0x076007,0x077007
-	.long 0x478007,0x079007,0x07a007,0x07b007,0x07c007,0x07d007,0x07e007,0x07f007
-	.long 0x480007,0x081007,0x082007,0x083007,0x084007,0x085007,0x086007,0x087007
-	.long 0x488007,0x089007,0x08a007,0x08b007,0x08c007,0x08d007,0x08e007,0x08f007
-	.long 0x490007,0x091007,0x092007,0x093007,0x094007,0x095007,0x096007,0x097007
-	.long 0x498007,0x099007,0x09a007,0x09b007,0x09c007,0x09d007,0x09e007,0x09f007
-	.long 0x4a0007,0x0a1007,0x0a2007,0x0a3007,0x0a4007,0x0a5007,0x0a6007,0x0a7007
-	.long 0x4a8007,0x0a9007,0x0aa007,0x0ab007,0x0ac007,0x0ad007,0x0ae007,0x0af007
-	.long 0x4b0007,0x0b1007,0x0b2007,0x0b3007,0x0b4007,0x0b5007,0x0b6007,0x0b7007
-	.long 0x4b8007,0x0b9007,0x0ba007,0x0bb007,0x0bc007,0x0bd007,0x0be007,0x0bf007
-	.long 0x4c0007,0x0c1007,0x0c2007,0x0c3007,0x0c4007,0x0c5007,0x0c6007,0x0c7007
-	.long 0x4c8007,0x0c9007,0x0ca007,0x0cb007,0x0cc007,0x0cd007,0x0ce007,0x0cf007
-	.long 0x4d0007,0x0d1007,0x0d2007,0x0d3007,0x0d4007,0x0d5007,0x0d6007,0x0d7007
-	.long 0x4d8007,0x0d9007,0x0da007,0x0db007,0x0dc007,0x0dd007,0x0de007,0x0df007
-	.long 0x4e0007,0x0e1007,0x0e2007,0x0e3007,0x0e4007,0x0e5007,0x0e6007,0x0e7007
-	.long 0x4e8007,0x0e9007,0x0ea007,0x0eb007,0x0ec007,0x0ed007,0x0ee007,0x0ef007
-	.long 0x4f0007,0x0f1007,0x0f2007,0x0f3007,0x0f4007,0x0f5007,0x0f6007,0x0f7007
-	.long 0x4f8007,0x0f9007,0x0fa007,0x0fb007,0x0fc007,0x0fd007,0x0fe007,0x0ff007
-	.long 0x500007,0x001007,0x002007,0x003007,0x004007,0x005007,0x006007,0x007007
-	.long 0x508007,0x009007,0x00a007,0x00b007,0x00c007,0x00d007,0x00e007,0x00f007
-	.long 0x510007,0x011007,0x012007,0x013007,0x014007,0x015007,0x016007,0x017007
-	.long 0x518007,0x019007,0x01a007,0x01b007,0x01c007,0x01d007,0x01e007,0x01f007
-	.long 0x520007,0x021007,0x022007,0x023007,0x024007,0x025007,0x026007,0x027007
-	.long 0x528007,0x029007,0x02a007,0x02b007,0x02c007,0x02d007,0x02e007,0x02f007
-	.long 0x530007,0x031007,0x032007,0x033007,0x034007,0x035007,0x036007,0x037007
-	.long 0x538007,0x039007,0x03a007,0x03b007,0x03c007,0x03d007,0x03e007,0x03f007
-	.long 0x540007,0x041007,0x042007,0x043007,0x044007,0x045007,0x046007,0x047007
-	.long 0x548007,0x049007,0x04a007,0x04b007,0x04c007,0x04d007,0x04e007,0x04f007
-	.long 0x550007,0x051007,0x052007,0x053007,0x054007,0x055007,0x056007,0x057007
-	.long 0x558007,0x059007,0x05a007,0x05b007,0x05c007,0x05d007,0x05e007,0x05f007
-	.long 0x560007,0x061007,0x062007,0x063007,0x064007,0x065007,0x066007,0x067007
-	.long 0x568007,0x069007,0x06a007,0x06b007,0x06c007,0x06d007,0x06e007,0x06f007
-	.long 0x570007,0x071007,0x072007,0x073007,0x074007,0x075007,0x076007,0x077007
-	.long 0x578007,0x079007,0x07a007,0x07b007,0x07c007,0x07d007,0x07e007,0x07f007
-	.long 0x580007,0x081007,0x082007,0x083007,0x084007,0x085007,0x086007,0x087007
-	.long 0x588007,0x089007,0x08a007,0x08b007,0x08c007,0x08d007,0x08e007,0x08f007
-	.long 0x590007,0x091007,0x092007,0x093007,0x094007,0x095007,0x096007,0x097007
-	.long 0x598007,0x099007,0x09a007,0x09b007,0x09c007,0x09d007,0x09e007,0x09f007
-	.long 0x5a0007,0x0a1007,0x0a2007,0x0a3007,0x0a4007,0x0a5007,0x0a6007,0x0a7007
-	.long 0x5a8007,0x0a9007,0x0aa007,0x0ab007,0x0ac007,0x0ad007,0x0ae007,0x0af007
-	.long 0x5b0007,0x0b1007,0x0b2007,0x0b3007,0x0b4007,0x0b5007,0x0b6007,0x0b7007
-	.long 0x5b8007,0x0b9007,0x0ba007,0x0bb007,0x0bc007,0x0bd007,0x0be007,0x0bf007
-	.long 0x5c0007,0x0c1007,0x0c2007,0x0c3007,0x0c4007,0x0c5007,0x0c6007,0x0c7007
-	.long 0x5c8007,0x0c9007,0x0ca007,0x0cb007,0x0cc007,0x0cd007,0x0ce007,0x0cf007
-	.long 0x5d0007,0x0d1007,0x0d2007,0x0d3007,0x0d4007,0x0d5007,0x0d6007,0x0d7007
-	.long 0x5d8007,0x0d9007,0x0da007,0x0db007,0x0dc007,0x0dd007,0x0de007,0x0df007
-	.long 0x5e0007,0x0e1007,0x0e2007,0x0e3007,0x0e4007,0x0e5007,0x0e6007,0x0e7007
-	.long 0x5e8007,0x0e9007,0x0ea007,0x0eb007,0x0ec007,0x0ed007,0x0ee007,0x0ef007
-	.long 0x5f0007,0x0f1007,0x0f2007,0x0f3007,0x0f4007,0x0f5007,0x0f6007,0x0f7007
-	.long 0x5f8007,0x0f9007,0x0fa007,0x0fb007,0x0fc007,0x0fd007,0x0fe007,0x0ff007
-	.long 0x600007,0x001007,0x002007,0x003007,0x004007,0x005007,0x006007,0x007007
-	.long 0x608007,0x009007,0x00a007,0x00b007,0x00c007,0x00d007,0x00e007,0x00f007
-	.long 0x610007,0x011007,0x012007,0x013007,0x014007,0x015007,0x016007,0x017007
-	.long 0x618007,0x019007,0x01a007,0x01b007,0x01c007,0x01d007,0x01e007,0x01f007
-	.long 0x620007,0x021007,0x022007,0x023007,0x024007,0x025007,0x026007,0x027007
-	.long 0x628007,0x029007,0x02a007,0x02b007,0x02c007,0x02d007,0x02e007,0x02f007
-	.long 0x630007,0x031007,0x032007,0x033007,0x034007,0x035007,0x036007,0x037007
-	.long 0x638007,0x039007,0x03a007,0x03b007,0x03c007,0x03d007,0x03e007,0x03f007
-	.long 0x640007,0x041007,0x042007,0x043007,0x044007,0x045007,0x046007,0x047007
-	.long 0x648007,0x049007,0x04a007,0x04b007,0x04c007,0x04d007,0x04e007,0x04f007
-	.long 0x650007,0x051007,0x052007,0x053007,0x054007,0x055007,0x056007,0x057007
-	.long 0x658007,0x059007,0x05a007,0x05b007,0x05c007,0x05d007,0x05e007,0x05f007
-	.long 0x660007,0x061007,0x062007,0x063007,0x064007,0x065007,0x066007,0x067007
-	.long 0x668007,0x069007,0x06a007,0x06b007,0x06c007,0x06d007,0x06e007,0x06f007
-	.long 0x670007,0x071007,0x072007,0x073007,0x074007,0x075007,0x076007,0x077007
-	.long 0x678007,0x079007,0x07a007,0x07b007,0x07c007,0x07d007,0x07e007,0x07f007
-	.long 0x680007,0x081007,0x082007,0x083007,0x084007,0x085007,0x086007,0x087007
-	.long 0x688007,0x089007,0x08a007,0x08b007,0x08c007,0x08d007,0x08e007,0x08f007
-	.long 0x690007,0x091007,0x092007,0x093007,0x094007,0x095007,0x096007,0x097007
-	.long 0x698007,0x099007,0x09a007,0x09b007,0x09c007,0x09d007,0x09e007,0x09f007
-	.long 0x6a0007,0x0a1007,0x0a2007,0x0a3007,0x0a4007,0x0a5007,0x0a6007,0x0a7007
-	.long 0x6a8007,0x0a9007,0x0aa007,0x0ab007,0x0ac007,0x0ad007,0x0ae007,0x0af007
-	.long 0x6b0007,0x0b1007,0x0b2007,0x0b3007,0x0b4007,0x0b5007,0x0b6007,0x0b7007
-	.long 0x6b8007,0x0b9007,0x0ba007,0x0bb007,0x0bc007,0x0bd007,0x0be007,0x0bf007
-	.long 0x6c0007,0x0c1007,0x0c2007,0x0c3007,0x0c4007,0x0c5007,0x0c6007,0x0c7007
-	.long 0x6c8007,0x0c9007,0x0ca007,0x0cb007,0x0cc007,0x0cd007,0x0ce007,0x0cf007
-	.long 0x6d0007,0x0d1007,0x0d2007,0x0d3007,0x0d4007,0x0d5007,0x0d6007,0x0d7007
-	.long 0x6d8007,0x0d9007,0x0da007,0x0db007,0x0dc007,0x0dd007,0x0de007,0x0df007
-	.long 0x6e0007,0x0e1007,0x0e2007,0x0e3007,0x0e4007,0x0e5007,0x0e6007,0x0e7007
-	.long 0x6e8007,0x0e9007,0x0ea007,0x0eb007,0x0ec007,0x0ed007,0x0ee007,0x0ef007
-	.long 0x6f0007,0x0f1007,0x0f2007,0x0f3007,0x0f4007,0x0f5007,0x0f6007,0x0f7007
-	.long 0x6f8007,0x0f9007,0x0fa007,0x0fb007,0x0fc007,0x0fd007,0x0fe007,0x0ff007
-	.long 0x700007,0x001007,0x002007,0x003007,0x004007,0x005007,0x006007,0x007007
-	.long 0x708007,0x009007,0x00a007,0x00b007,0x00c007,0x00d007,0x00e007,0x00f007
-	.long 0x710007,0x011007,0x012007,0x013007,0x014007,0x015007,0x016007,0x017007
-	.long 0x718007,0x019007,0x01a007,0x01b007,0x01c007,0x01d007,0x01e007,0x01f007
-	.long 0x720007,0x021007,0x022007,0x023007,0x024007,0x025007,0x026007,0x027007
-	.long 0x728007,0x029007,0x02a007,0x02b007,0x02c007,0x02d007,0x02e007,0x02f007
-	.long 0x730007,0x031007,0x032007,0x033007,0x034007,0x035007,0x036007,0x037007
-	.long 0x738007,0x039007,0x03a007,0x03b007,0x03c007,0x03d007,0x03e007,0x03f007
-	.long 0x740007,0x041007,0x042007,0x043007,0x044007,0x045007,0x046007,0x047007
-	.long 0x748007,0x049007,0x04a007,0x04b007,0x04c007,0x04d007,0x04e007,0x04f007
-	.long 0x750007,0x051007,0x052007,0x053007,0x054007,0x055007,0x056007,0x057007
-	.long 0x758007,0x059007,0x05a007,0x05b007,0x05c007,0x05d007,0x05e007,0x05f007
-	.long 0x760007,0x061007,0x062007,0x063007,0x064007,0x065007,0x066007,0x067007
-	.long 0x768007,0x069007,0x06a007,0x06b007,0x06c007,0x06d007,0x06e007,0x06f007
-	.long 0x770007,0x071007,0x072007,0x073007,0x074007,0x075007,0x076007,0x077007
-	.long 0x778007,0x079007,0x07a007,0x07b007,0x07c007,0x07d007,0x07e007,0x07f007
-	.long 0x780007,0x081007,0x082007,0x083007,0x084007,0x085007,0x086007,0x087007
-	.long 0x788007,0x089007,0x08a007,0x08b007,0x08c007,0x08d007,0x08e007,0x08f007
-	.long 0x790007,0x091007,0x092007,0x093007,0x094007,0x095007,0x096007,0x097007
-	.long 0x798007,0x099007,0x09a007,0x09b007,0x09c007,0x09d007,0x09e007,0x09f007
-	.long 0x7a0007,0x0a1007,0x0a2007,0x0a3007,0x0a4007,0x0a5007,0x0a6007,0x0a7007
-	.long 0x7a8007,0x0a9007,0x0aa007,0x0ab007,0x0ac007,0x0ad007,0x0ae007,0x0af007
-	.long 0x7b0007,0x0b1007,0x0b2007,0x0b3007,0x0b4007,0x0b5007,0x0b6007,0x0b7007
-	.long 0x7b8007,0x0b9007,0x0ba007,0x0bb007,0x0bc007,0x0bd007,0x0be007,0x0bf007
-	.long 0x7c0007,0x0c1007,0x0c2007,0x0c3007,0x0c4007,0x0c5007,0x0c6007,0x0c7007
-	.long 0x7c8007,0x0c9007,0x0ca007,0x0cb007,0x0cc007,0x0cd007,0x0ce007,0x0cf007
-	.long 0x7d0007,0x0d1007,0x0d2007,0x0d3007,0x0d4007,0x0d5007,0x0d6007,0x0d7007
-	.long 0x7d8007,0x0d9007,0x0da007,0x0db007,0x0dc007,0x0dd007,0x0de007,0x0df007
-	.long 0x7e0007,0x0e1007,0x0e2007,0x0e3007,0x0e4007,0x0e5007,0x0e6007,0x0e7007
-	.long 0x7e8007,0x0e9007,0x0ea007,0x0eb007,0x0ec007,0x0ed007,0x0ee007,0x0ef007
-	.long 0x7f0007,0x0f1007,0x0f2007,0x0f3007,0x0f4007,0x0f5007,0x0f6007,0x0f7007
-	.long 0x7f8007,0x0f9007,0x0fa007,0x0fb007,0x0fc007,0x0fd007,0x0fe007,0x0ff007
+	.long 0x400007,0x401007,0x402007,0x403007,0x404007,0x405007,0x406007,0x407007
+	.long 0x408007,0x409007,0x40a007,0x40b007,0x40c007,0x40d007,0x40e007,0x40f007
+	.long 0x410007,0x411007,0x412007,0x413007,0x414007,0x415007,0x416007,0x417007
+	.long 0x418007,0x419007,0x41a007,0x41b007,0x41c007,0x41d007,0x41e007,0x41f007
+	.long 0x420007,0x421007,0x422007,0x423007,0x424007,0x425007,0x426007,0x427007
+	.long 0x428007,0x429007,0x42a007,0x42b007,0x42c007,0x42d007,0x42e007,0x42f007
+	.long 0x430007,0x431007,0x432007,0x433007,0x434007,0x435007,0x436007,0x437007
+	.long 0x438007,0x439007,0x43a007,0x43b007,0x43c007,0x43d007,0x43e007,0x43f007
+	.long 0x440007,0x441007,0x442007,0x443007,0x444007,0x445007,0x446007,0x447007
+	.long 0x448007,0x449007,0x44a007,0x44b007,0x44c007,0x44d007,0x44e007,0x44f007
+	.long 0x450007,0x451007,0x452007,0x453007,0x454007,0x455007,0x456007,0x457007
+	.long 0x458007,0x459007,0x45a007,0x45b007,0x45c007,0x45d007,0x45e007,0x45f007
+	.long 0x460007,0x461007,0x462007,0x463007,0x464007,0x465007,0x466007,0x467007
+	.long 0x468007,0x469007,0x46a007,0x46b007,0x46c007,0x46d007,0x46e007,0x46f007
+	.long 0x470007,0x471007,0x472007,0x473007,0x474007,0x475007,0x476007,0x477007
+	.long 0x478007,0x479007,0x47a007,0x47b007,0x47c007,0x47d007,0x47e007,0x47f007
+	.long 0x480007,0x481007,0x482007,0x483007,0x484007,0x485007,0x486007,0x487007
+	.long 0x488007,0x489007,0x48a007,0x48b007,0x48c007,0x48d007,0x48e007,0x48f007
+	.long 0x490007,0x491007,0x492007,0x493007,0x494007,0x495007,0x496007,0x497007
+	.long 0x498007,0x499007,0x49a007,0x49b007,0x49c007,0x49d007,0x49e007,0x49f007
+	.long 0x4a0007,0x4a1007,0x4a2007,0x4a3007,0x4a4007,0x4a5007,0x4a6007,0x4a7007
+	.long 0x4a8007,0x4a9007,0x4aa007,0x4ab007,0x4ac007,0x4ad007,0x4ae007,0x4af007
+	.long 0x4b0007,0x4b1007,0x4b2007,0x4b3007,0x4b4007,0x4b5007,0x4b6007,0x4b7007
+	.long 0x4b8007,0x4b9007,0x4ba007,0x4bb007,0x4bc007,0x4bd007,0x4be007,0x4bf007
+	.long 0x4c0007,0x4c1007,0x4c2007,0x4c3007,0x4c4007,0x4c5007,0x4c6007,0x4c7007
+	.long 0x4c8007,0x4c9007,0x4ca007,0x4cb007,0x4cc007,0x4cd007,0x4ce007,0x4cf007
+	.long 0x4d0007,0x4d1007,0x4d2007,0x4d3007,0x4d4007,0x4d5007,0x4d6007,0x4d7007
+	.long 0x4d8007,0x4d9007,0x4da007,0x4db007,0x4dc007,0x4dd007,0x4de007,0x4df007
+	.long 0x4e0007,0x4e1007,0x4e2007,0x4e3007,0x4e4007,0x4e5007,0x4e6007,0x4e7007
+	.long 0x4e8007,0x4e9007,0x4ea007,0x4eb007,0x4ec007,0x4ed007,0x4ee007,0x4ef007
+	.long 0x4f0007,0x4f1007,0x4f2007,0x4f3007,0x4f4007,0x4f5007,0x4f6007,0x4f7007
+	.long 0x4f8007,0x4f9007,0x4fa007,0x4fb007,0x4fc007,0x4fd007,0x4fe007,0x4ff007
+	.long 0x500007,0x501007,0x502007,0x503007,0x504007,0x505007,0x506007,0x507007
+	.long 0x508007,0x509007,0x50a007,0x50b007,0x50c007,0x50d007,0x50e007,0x50f007
+	.long 0x510007,0x511007,0x512007,0x513007,0x514007,0x515007,0x516007,0x517007
+	.long 0x518007,0x519007,0x51a007,0x51b007,0x51c007,0x51d007,0x51e007,0x51f007
+	.long 0x520007,0x521007,0x522007,0x523007,0x524007,0x525007,0x526007,0x527007
+	.long 0x528007,0x529007,0x52a007,0x52b007,0x52c007,0x52d007,0x52e007,0x52f007
+	.long 0x530007,0x531007,0x532007,0x533007,0x534007,0x535007,0x536007,0x537007
+	.long 0x538007,0x539007,0x53a007,0x53b007,0x53c007,0x53d007,0x53e007,0x53f007
+	.long 0x540007,0x541007,0x542007,0x543007,0x544007,0x545007,0x546007,0x547007
+	.long 0x548007,0x549007,0x54a007,0x54b007,0x54c007,0x54d007,0x54e007,0x54f007
+	.long 0x550007,0x551007,0x552007,0x553007,0x554007,0x555007,0x556007,0x557007
+	.long 0x558007,0x559007,0x55a007,0x55b007,0x55c007,0x55d007,0x55e007,0x55f007
+	.long 0x560007,0x561007,0x562007,0x563007,0x564007,0x565007,0x566007,0x567007
+	.long 0x568007,0x569007,0x56a007,0x56b007,0x56c007,0x56d007,0x56e007,0x56f007
+	.long 0x570007,0x571007,0x572007,0x573007,0x574007,0x575007,0x576007,0x577007
+	.long 0x578007,0x579007,0x57a007,0x57b007,0x57c007,0x57d007,0x57e007,0x57f007
+	.long 0x580007,0x581007,0x582007,0x583007,0x584007,0x585007,0x586007,0x587007
+	.long 0x588007,0x589007,0x58a007,0x58b007,0x58c007,0x58d007,0x58e007,0x58f007
+	.long 0x590007,0x591007,0x592007,0x593007,0x594007,0x595007,0x596007,0x597007
+	.long 0x598007,0x599007,0x59a007,0x59b007,0x59c007,0x59d007,0x59e007,0x59f007
+	.long 0x5a0007,0x5a1007,0x5a2007,0x5a3007,0x5a4007,0x5a5007,0x5a6007,0x5a7007
+	.long 0x5a8007,0x5a9007,0x5aa007,0x5ab007,0x5ac007,0x5ad007,0x5ae007,0x5af007
+	.long 0x5b0007,0x5b1007,0x5b2007,0x5b3007,0x5b4007,0x5b5007,0x5b6007,0x5b7007
+	.long 0x5b8007,0x5b9007,0x5ba007,0x5bb007,0x5bc007,0x5bd007,0x5be007,0x5bf007
+	.long 0x5c0007,0x5c1007,0x5c2007,0x5c3007,0x5c4007,0x5c5007,0x5c6007,0x5c7007
+	.long 0x5c8007,0x5c9007,0x5ca007,0x5cb007,0x5cc007,0x5cd007,0x5ce007,0x5cf007
+	.long 0x5d0007,0x5d1007,0x5d2007,0x5d3007,0x5d4007,0x5d5007,0x5d6007,0x5d7007
+	.long 0x5d8007,0x5d9007,0x5da007,0x5db007,0x5dc007,0x5dd007,0x5de007,0x5df007
+	.long 0x5e0007,0x5e1007,0x5e2007,0x5e3007,0x5e4007,0x5e5007,0x5e6007,0x5e7007
+	.long 0x5e8007,0x5e9007,0x5ea007,0x5eb007,0x5ec007,0x5ed007,0x5ee007,0x5ef007
+	.long 0x5f0007,0x5f1007,0x5f2007,0x5f3007,0x5f4007,0x5f5007,0x5f6007,0x5f7007
+	.long 0x5f8007,0x5f9007,0x5fa007,0x5fb007,0x5fc007,0x5fd007,0x5fe007,0x5ff007
+	.long 0x600007,0x601007,0x602007,0x603007,0x604007,0x605007,0x606007,0x607007
+	.long 0x608007,0x609007,0x60a007,0x60b007,0x60c007,0x60d007,0x60e007,0x60f007
+	.long 0x610007,0x611007,0x612007,0x613007,0x614007,0x615007,0x616007,0x617007
+	.long 0x618007,0x619007,0x61a007,0x61b007,0x61c007,0x61d007,0x61e007,0x61f007
+	.long 0x620007,0x621007,0x622007,0x623007,0x624007,0x625007,0x626007,0x627007
+	.long 0x628007,0x629007,0x62a007,0x62b007,0x62c007,0x62d007,0x62e007,0x62f007
+	.long 0x630007,0x631007,0x632007,0x633007,0x634007,0x635007,0x636007,0x637007
+	.long 0x638007,0x639007,0x63a007,0x63b007,0x63c007,0x63d007,0x63e007,0x63f007
+	.long 0x640007,0x641007,0x642007,0x643007,0x644007,0x645007,0x646007,0x647007
+	.long 0x648007,0x649007,0x64a007,0x64b007,0x64c007,0x64d007,0x64e007,0x64f007
+	.long 0x650007,0x651007,0x652007,0x653007,0x654007,0x655007,0x656007,0x657007
+	.long 0x658007,0x659007,0x65a007,0x65b007,0x65c007,0x65d007,0x65e007,0x65f007
+	.long 0x660007,0x661007,0x662007,0x663007,0x664007,0x665007,0x666007,0x667007
+	.long 0x668007,0x669007,0x66a007,0x66b007,0x66c007,0x66d007,0x66e007,0x66f007
+	.long 0x670007,0x671007,0x672007,0x673007,0x674007,0x675007,0x676007,0x677007
+	.long 0x678007,0x679007,0x67a007,0x67b007,0x67c007,0x67d007,0x67e007,0x67f007
+	.long 0x680007,0x681007,0x682007,0x683007,0x684007,0x685007,0x686007,0x687007
+	.long 0x688007,0x689007,0x68a007,0x68b007,0x68c007,0x68d007,0x68e007,0x68f007
+	.long 0x690007,0x691007,0x692007,0x693007,0x694007,0x695007,0x696007,0x697007
+	.long 0x698007,0x699007,0x69a007,0x69b007,0x69c007,0x69d007,0x69e007,0x69f007
+	.long 0x6a0007,0x6a1007,0x6a2007,0x6a3007,0x6a4007,0x6a5007,0x6a6007,0x6a7007
+	.long 0x6a8007,0x6a9007,0x6aa007,0x6ab007,0x6ac007,0x6ad007,0x6ae007,0x6af007
+	.long 0x6b0007,0x6b1007,0x6b2007,0x6b3007,0x6b4007,0x6b5007,0x6b6007,0x6b7007
+	.long 0x6b8007,0x6b9007,0x6ba007,0x6bb007,0x6bc007,0x6bd007,0x6be007,0x6bf007
+	.long 0x6c0007,0x6c1007,0x6c2007,0x6c3007,0x6c4007,0x6c5007,0x6c6007,0x6c7007
+	.long 0x6c8007,0x6c9007,0x6ca007,0x6cb007,0x6cc007,0x6cd007,0x6ce007,0x6cf007
+	.long 0x6d0007,0x6d1007,0x6d2007,0x6d3007,0x6d4007,0x6d5007,0x6d6007,0x6d7007
+	.long 0x6d8007,0x6d9007,0x6da007,0x6db007,0x6dc007,0x6dd007,0x6de007,0x6df007
+	.long 0x6e0007,0x6e1007,0x6e2007,0x6e3007,0x6e4007,0x6e5007,0x6e6007,0x6e7007
+	.long 0x6e8007,0x6e9007,0x6ea007,0x6eb007,0x6ec007,0x6ed007,0x6ee007,0x6ef007
+	.long 0x6f0007,0x6f1007,0x6f2007,0x6f3007,0x6f4007,0x6f5007,0x6f6007,0x6f7007
+	.long 0x6f8007,0x6f9007,0x6fa007,0x6fb007,0x6fc007,0x6fd007,0x6fe007,0x6ff007
+	.long 0x700007,0x701007,0x702007,0x703007,0x704007,0x705007,0x706007,0x707007
+	.long 0x708007,0x709007,0x70a007,0x70b007,0x70c007,0x70d007,0x70e007,0x70f007
+	.long 0x710007,0x711007,0x712007,0x713007,0x714007,0x715007,0x716007,0x717007
+	.long 0x718007,0x719007,0x71a007,0x71b007,0x71c007,0x71d007,0x71e007,0x71f007
+	.long 0x720007,0x721007,0x722007,0x723007,0x724007,0x725007,0x726007,0x727007
+	.long 0x728007,0x729007,0x72a007,0x72b007,0x72c007,0x72d007,0x72e007,0x72f007
+	.long 0x730007,0x731007,0x732007,0x733007,0x734007,0x735007,0x736007,0x737007
+	.long 0x738007,0x739007,0x73a007,0x73b007,0x73c007,0x73d007,0x73e007,0x73f007
+	.long 0x740007,0x741007,0x742007,0x743007,0x744007,0x745007,0x746007,0x747007
+	.long 0x748007,0x749007,0x74a007,0x74b007,0x74c007,0x74d007,0x74e007,0x74f007
+	.long 0x750007,0x751007,0x752007,0x753007,0x754007,0x755007,0x756007,0x757007
+	.long 0x758007,0x759007,0x75a007,0x75b007,0x75c007,0x75d007,0x75e007,0x75f007
+	.long 0x760007,0x761007,0x762007,0x763007,0x764007,0x765007,0x766007,0x767007
+	.long 0x768007,0x769007,0x76a007,0x76b007,0x76c007,0x76d007,0x76e007,0x76f007
+	.long 0x770007,0x771007,0x772007,0x773007,0x774007,0x775007,0x776007,0x777007
+	.long 0x778007,0x779007,0x77a007,0x77b007,0x77c007,0x77d007,0x77e007,0x77f007
+	.long 0x780007,0x781007,0x782007,0x783007,0x784007,0x785007,0x786007,0x787007
+	.long 0x788007,0x789007,0x78a007,0x78b007,0x78c007,0x78d007,0x78e007,0x78f007
+	.long 0x790007,0x791007,0x792007,0x793007,0x794007,0x795007,0x796007,0x797007
+	.long 0x798007,0x799007,0x79a007,0x79b007,0x79c007,0x79d007,0x79e007,0x79f007
+	.long 0x7a0007,0x7a1007,0x7a2007,0x7a3007,0x7a4007,0x7a5007,0x7a6007,0x7a7007
+	.long 0x7a8007,0x7a9007,0x7aa007,0x7ab007,0x7ac007,0x7ad007,0x7ae007,0x7af007
+	.long 0x7b0007,0x7b1007,0x7b2007,0x7b3007,0x7b4007,0x7b5007,0x7b6007,0x7b7007
+	.long 0x7b8007,0x7b9007,0x7ba007,0x7bb007,0x7bc007,0x7bd007,0x7be007,0x7bf007
+	.long 0x7c0007,0x7c1007,0x7c2007,0x7c3007,0x7c4007,0x7c5007,0x7c6007,0x7c7007
+	.long 0x7c8007,0x7c9007,0x7ca007,0x7cb007,0x7cc007,0x7cd007,0x7ce007,0x7cf007
+	.long 0x7d0007,0x7d1007,0x7d2007,0x7d3007,0x7d4007,0x7d5007,0x7d6007,0x7d7007
+	.long 0x7d8007,0x7d9007,0x7da007,0x7db007,0x7dc007,0x7dd007,0x7de007,0x7df007
+	.long 0x7e0007,0x7e1007,0x7e2007,0x7e3007,0x7e4007,0x7e5007,0x7e6007,0x7e7007
+	.long 0x7e8007,0x7e9007,0x7ea007,0x7eb007,0x7ec007,0x7ed007,0x7ee007,0x7ef007
+	.long 0x7f0007,0x7f1007,0x7f2007,0x7f3007,0x7f4007,0x7f5007,0x7f6007,0x7f7007
+	.long 0x7f8007,0x7f9007,0x7fa007,0x7fb007,0x7fc007,0x7fd007,0x7fe007,0x7ff007
 .org 0x4000
 ENTRY(empty_zero_page)
 
--- linux/arch/i386/boot/tools/build.c.orig	Fri Mar  3 18:40:02 2000
+++ linux/arch/i386/boot/tools/build.c	Fri Mar  3 19:09:11 2000
@@ -150,9 +150,13 @@
 	sz = sb.st_size;
 	fprintf (stderr, "System is %d kB\n", sz/1024);
 	sys_size = (sz + 15) / 16;
-	if (sys_size > (is_big_kernel ? 0xffff : DEF_SYSSIZE))
+	/* 0x28000*16 = 2.5 MB, conservative estimate for the current maximum */
+	if (sys_size > (is_big_kernel ? 0x28000 : DEF_SYSSIZE))
 		die("System is too big. Try using %smodules.",
 			is_big_kernel ? "" : "bzImage or ");
+	if (sys_size > 0xffff)
+		fprintf(stderr,"warning: kernel is too big for standalone boot"
+		    "from floppy\n");
 	while (sz > 0) {
 		int l, n;
 