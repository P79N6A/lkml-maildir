Date: Thu, 10 Feb 2000 23:54:44 +0100 (CET)
From: Andrea Arcangeli <>
Subject: 2.3.43 alpha broken with >2g of ram
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/2/10/178

Richard, I assume you know you removed the alpha 2g limit of ram on 2.3.43
and that you only removed the limit without being able to support more
than 2giga of ram so you broken all drivers that does some kind of PCI-DMA
in the kernel without fixing them (except some network driver that is
completly not interesting for using the bigmem anyway).
Could you explain me how can 2.3.43 work? How do you do PCI-DMA over 2giga
of ram on the page cache or on the buffer cache or in whatever else DMA
with pci driver that is not yet using the new pci mmu code like some
network driver is just doing?
After you did this change:
@@ -225,15 +232,8 @@
 			max_low_pfn = end;
 	}
 
-	/* Enforce maximum of 2GB even if there is more.  Blah.  */
-	if (max_low_pfn > PFN_MAX)
-		max_low_pfn = PFN_MAX;
-	printk("max_low_pfn %ld\n", max_low_pfn);
-
 	/* Find the end of the kernel memory.  */
 	start_pfn = PFN_UP(virt_to_phys(_end));
-	printk("_end %p, start_pfn %ld\n", _end, start_pfn);
-
 	bootmap_start = -1;
 
  try_again:
did you then tried at once to run it a machine with more than 2giga of ram
to verify if it survives more than some minute of uptime? Can somebody
with >2giga try to run 2.3.43 and confirm that it crashes at the first
load?
If you have more than 2giga of ram you'd better back out the above change
before running 2.3.43.
I'll port the _real_ 2T support I did in 2.2.x to the latest 2.3.x ASAP
(it was just in my TODO list).
Andrea
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/