Date: Thu, 25 May 2006 13:34:01 +0400
From: Michael Tokarev <>
Subject: drivers/char/rocket.c: somewhat broken since 2.6.16
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/25/65

We've an old 8-port ISA rocketport card, which worked for several
years now.  And with 2.6.16, it behaves.. strangely.
After some [random] amount of work, some random port of the card
starts to show delayed receiving of incoming characters.  Ie, I
turn off/on the modem, connect to the port, hit AT<cr> - nothing
happens.  I hit one more <cr> and see first 'A' from the modem.  I
hit another <cr>, and see the 'T' from the modem... After hitting
some key several more times, I finally see the whole modem response
(echoing of the command - AT<cr>, followed by OK<cr>).  Ie, incoming
(from the modem) chars are displayed only when something goes TO the
modem.
Once the port is turned into this "mode", it just stays here.  I tried
to re-load rocket.ko module - it helps.  But some more time and it
switches into this strange mode again.  Some more time/work, and
another port switches to this mode.. etc.
2.6.15 behaves correctly, at least I'm unable to reproduce the problem
on this kernel.  2.6.16 shows it on a regular basis.
The only real changes to rocket.c during 2.6.16 development cycle was
the following two patches:
http://www.kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=33f0f88f1c51ae5c2d593d26960c760ea154c2e2
from Alan Cox, titled "[PATCH] TTY layer buffering revamp", and
http://www.kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=1989e20cc1e7491232795f9dac9b745e4329dfd8
from Michal Ostrowski, titled "[PATCH] Fix RocketPort driver",
with (as it seems to be from the diff) is a fix for the first
patch.
I'm trying to use rocket.c from 2.6.15 on a 2.6.16 kernel now,
let's see what will happen...  But the thing is, the problem
is difficult to reproduce (sometimes it switches to this crazy
mode very soon, sometimes it works for a week or so - I can't
so far see what can be used to trigger the switch) so.. ugh... ;)
Thanks.
/mjt
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/