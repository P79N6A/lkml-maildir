Date: Thu, 1 Feb 2007 20:04:31 +0100
From: Ingo Molnar <>
Subject: Re: 2.6.20-rc6-mm3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/1/243

* Mattia Dongili <malattia@linux.it> wrote:
> > Full dmesg and config:
> > 
http://oioio.altervista.org/linux/nohz_soft-lockup.dmesg
> > 
http://oioio.altervista.org/linux/config-2.6.20-rc6-mm3-1
> > 
> > As a side note the process becomes slower and slower as it proceeds, 
> > it's definitely noticeable during my iptables rules setup (nothing 
> > that complex, just default policies and subnet/lan accept rules). 
> > Building with NO_HZ=n right now.
> 
> yes, slowness is gone. Any useful information I can provide?
thanks for reporting this - i'll try your config. There's one fix ontop 
of -mm3 - see below - but i'm not sure it's related, it addresses resume 
problems.
	Ingo
---
 kernel/timer.c |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)
Index: linux/kernel/timer.c
===================================================================
--- linux.orig/kernel/timer.c
+++ linux/kernel/timer.c
@@ -1120,8 +1120,9 @@ static int timekeeping_resume(struct sys
 
 	if (now && (now > timekeeping_suspend_time)) {
 		unsigned long sleep_length = now - timekeeping_suspend_time;
+
 		xtime.tv_sec += sleep_length;
-		jiffies_64 += (u64)sleep_length * HZ;
+		wall_to_monotonic.tv_sec -= sleep_length;
 	}
 	/* re-base the last cycle value */
 	clock->cycle_last = clocksource_read(clock);
@@ -1130,7 +1131,7 @@ static int timekeeping_resume(struct sys
 	warp_check_clock_was_changed();
 	write_sequnlock_irqrestore(&xtime_lock, flags);
 
-	clockevents_notify(CLOCK_EVT_NOTIFY_RESUME, NULL);
+	touch_softlockup_watchdog();
 	/* Resume hrtimers */
 	clock_was_set();
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/