Date: Mon, 6 Nov 2006 10:38:15 +0100
From: Ingo Molnar <>
Subject: Re: realtime-preempt patch-2.6.18-rt7 oops
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/11/6/39

* Mike Galbraith <efault@gmx.de> wrote:
> I just reproduced it running glibc make check.  I had just enabled 
> kprobes and recompiled with the stock SuSE-10.1 compiler while waiting 
> for you to send me your .config (nevermind that request) so I could 
> try to reproduce it here.
hm, so kprobe_flush_task() is likely PREEMPT_RT-unsafe.
could you try the patch below, does it help? (a quick review seems to 
suggest that all codepaths protected by kretprobe_lock are atomic)
	Ingo
Index: linux/kernel/kprobes.c
===================================================================
--- linux.orig/kernel/kprobes.c
+++ linux/kernel/kprobes.c
@@ -50,7 +50,7 @@ static struct hlist_head kretprobe_inst_
 static atomic_t kprobe_count;
 
 DEFINE_MUTEX(kprobe_mutex);		/* Protects kprobe_table */
-DEFINE_SPINLOCK(kretprobe_lock);	/* Protects kretprobe_inst_table */
+DEFINE_RAW_SPINLOCK(kretprobe_lock);	/* Protects kretprobe_inst_table */
 static DEFINE_PER_CPU(struct kprobe *, kprobe_instance) = NULL;
 
 static struct notifier_block kprobe_page_fault_nb = {
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/