Date: Tue, 30 Oct 2001 13:14:31 +0100
From: Jan Kara <>
Subject: Re: Oops: Quota race in 2.4.12?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/10/30/91

  Hello,
> On Sunday October 28, sim@netnation.com wrote:
> > Some of our dual CPU web servers with 2.4.12 are Oopsing while running
> > quotacheck.  They don't seem to die immediately, but oops many times and
> > eventually break.  The old tools didn't warn about quotachecking on a
> > live file system, so some of our servers were set up to run quotacheck
> > nightly.  The new tools still allow you to do it, but warn that it may
> > not be consistent.  We didn't have any problems with 2.2 kernels.
> 
> quotacheck cannot be reliable on a live system as it scans through the
> filesystem counting the usage for each user and then updates the
> quotas file.  If usage changes between scanning a file and updating
> the quota record, you get an error.   This is particularly a problem
> if quotacheck takes a long time, and on one of my servers (heavily
> loaded NFS server) quotacheck takes a *long* time if the server is
> live (it isn't exactly quick if it isn't live either).
> 
> I wrote a little program which uses libext2fs to scan the block device
> for inodes and add up usage that way (as opposed to walking the
> filetree as I believe quotacheck does).  It runs *much* faster
> (minutes instead of hours).
  Note that quotacheck(8) uses e2fslib too if compiled properly...
								Honza
> 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/