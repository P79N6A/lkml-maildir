Date: Sat, 19 Jun 1999 23:49:23 -0700
From: Jay Thorne <>
Subject: Tracking down what looks like a memory leak in 2.3.x
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/6/20/5

This is very tentative, but it appears on extended run times, ie: 4 or 5
days with various X applications, I lose a substantial amount of RAM.   
The symptom is this: 
After 4 days of running,  switching windows in GNOME starts the disk going
like its going into swap.   No problem says I, I'll just kill the X server
and start it again, that should free up a ton of RAM.  Back into GNOME (I
use gdm), and it looks fine. Start up Netscape again and it starts up very
slowly with lots of disk activity..  So I alt tab back to gmc. Thats got the
disk going like a mad thing again. So I completely kill gdm, X, and
everything, start X again, and get thesame symptom. So I reboot.
Then its fine. (System is Cyrix 166/64M/IDE/RH5.2w/updates Kernel 2.3.6)
I get home and now my home box (P200MMX/64M/IDE/RH5.2w/updates Kernel 2.3.4)
is doing the same thing. SO I investigate further. I kill X and gdm and
everything down to a nearly bare system. THen I run 
# perl -e 'open (FILE ,"/dev/hda"); while (<FILE>){ $mem.= $_;}'
Just to fill up some memory and cause the swapper and kswapd to do their
thing.
It takes a couple minutes to do its thing, and runs up to my memory+swap
size, but never gets more than 42 Mbytes (on a 64M system) resident set. 
Ok. I'm confused.  It dies like I wanted it to, but the _used_ memory is
still at 20 megs. I'm looking thru the process list and _all_ 20 of the
remaining processes are at 0 to 48 kbytes resident. About 300 kybtes, total
in the process list, 20megs used, 40 megs free, 1800 buff, 2000 cached.
So I reboot, and re-do the test. Then the process goes to 55 megs, and when
it dies from out of memory, the used memory goes down to 4 megs. with 300
kbytes on the process list, and 56 megs free, and similar numbers for buffer
and cache. 
So. It looks like slow leak. But at the kernel level, since killing the
processes doesnt seem to free the memory again.  How can I look for the
memory?  Might it be shared memory areas left around by a bug in the gnome
libraries??  How do you list shm areas?
-- 
Jay Thorne  The Net Result System Services jay@result.com   
Http://net.result.com
Zoom 505 Effect page 
http://net.result.com/~jay
 
Zoom 5xx series Patch Database: 
http://net.result.com/~jay/db.html
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/