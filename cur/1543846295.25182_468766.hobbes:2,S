Date: Mon, 2 Oct 2006 13:38:06 -0700
From: Andrew Morton <>
Subject: Re: [patch 2.6.18-git] SPI -- Freescale iMX SPI controller driver
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/2/258

On Mon, 2 Oct 2006 13:10:14 -0700
David Brownell <david-b@pacbell.net> wrote:
> > > +/* Message state */
> > > +#define START_STATE                    ((void*)0)
> > > +#define RUNNING_STATE                  ((void*)1)
> > > +#define DONE_STATE                     ((void*)2)
> > > +#define ERROR_STATE                    ((void*)-1)
> > 
> > !?!??!?!
> 
> Now that you mention it ... let me second that comment!
These are "better enums".  The problem with C's enums is that it's possible
to mix them with integers and the compiler just swallows it.  With the
above, you'll get a warning if you make that mistake.
But otoh, it's possible to accidentally mix the above with, say, char*. 
And it's not convenient to declare this type.  So something like this would
be better:
struct not_a_struct {};
typedef struct not_a_struct *better_enum;
#define RUNNING_STATE		((better_enum)1)
better_enum my_function(better_enum b)
{
	...
	return RUNNING_STATE;
}
would work.
Next would be
#define DECLARE_BETTER_ENUM(name)				\
	struct not_a_struct_##name {};				\
	typedef struct not_a_struct##name better_enum_##name;
so we can declare types like better_enum_spi_state,
better_enum_notifier_return_, etc.
Anyway, back to work...  any patch which actually attempts to implement
this sort of thing will be cheerily ignored ;)   Do the enum-mismatch checking
in sparse.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/