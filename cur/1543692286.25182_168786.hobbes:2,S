Date: Sun, 28 Sep 2003 13:51:46 +0200 (MEST)
From:  Andries.Brouwer@cwi ...
Subject: [PATCH] small dev_t fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/28/31

See that we finally got a larger dev_t. Very good!
Will check over time what form my patches got in the current tree.
The first one I checked was broken a little. Below a fix.
[ext2 used a 32-bit field for dev_t, with possibly undefined
storage following; thus, no action was required to go to
32-bit dev_t, but going to 64-bit dev_t required some subtlety:
0 was written in the first word and the 64 bits in the following two.
Al truncated my 64-bit stuff to 32 bits but did not understand why
there was this split, and wrote 0 followed by a single word.
We should at least zero the word following to have well-defined
storage later.]
Andries
This is for fs/ext2/inode.c.
--- inode.c~	Sun Sep 28 12:42:15 2003
+++ inode.c	Sun Sep 28 13:25:03 2003
@@ -1228,6 +1228,7 @@
 			raw_inode->i_block[0] = 0;
 			raw_inode->i_block[1] =
 				cpu_to_le32(new_encode_dev(inode->i_rdev));
+			raw_inode->i_block[2] = 0;
 		}
 	} else for (n = 0; n < EXT2_N_BLOCKS; n++)
 		raw_inode->i_block[n] = ei->i_data[n];
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/