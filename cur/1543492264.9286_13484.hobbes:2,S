Date: Thu, 08 Apr 1999 14:34:34 +0300
From: Mikko Hyvarinen <>
Subject: Re: Bug? ISDN stops working with 2.2.5ac2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/4/8/27

Paul Slootman wrote:
> 
> >Something between 2.2.5 and 2.2.5ac2 stops ISDN syncPPP connections from
> >working correctly.
>
> FWIW, I have no problems with 2.2.5ac3 whatsoever. Then again, I always
> plug in the CVS version of isdn4linux as the 2.2 stuff is still old.
Why is the 2.2 stuff old?
> >reasons) where everything works as expected:
> 
> [snippage]
> 
> >Apr  6 08:33:32 morphy ipppd[193]: MPPP negotiation, He: No We: No
> >Apr  6 08:33:32 morphy ipppd[193]: local  IP address XXX.XXX.XXX.XXX
> >Apr  6 08:33:32 morphy ipppd[193]: remote IP address XXX.XXX.XXX.XXX
> >Apr  6 08:33:32 morphy ipppd[193]: Unsupported protocol 'Compression
> >Control Protocol' (0x80fd) received
> 
> >And here's a transcript of a failed session with 2.2.5ac2 and the same
> >settings:
> >
> >Apr  4 18:13:44 morphy ipppd[2727]: MPPP negotiation, He: No We: No
> >Apr  4 18:13:44 morphy ipppd[2727]: CCP enabled! Trying CCP.
> >Apr  4 18:13:44 morphy ipppd[2727]: CCP: got ccp-unit 0 for link 0
> >(protocol: 0x80fd)
> >Apr  4 18:13:44 morphy ipppd[2727]: ccp_resetci!
> >Apr  4 18:13:44 morphy ipppd[2727]: Kernel check for LZS failed
> >Apr  4 18:13:44 morphy ipppd[2727]: local  IP address XXX.XXX.XXX.XXX
> >Apr  4 18:13:44 morphy ipppd[2727]: remote IP address XXX.XXX.XXX.XXX
> 
> Are you sure you're using the same ipppd in both cases? They look
> different...
A second look reveals that I pasted the wrong log entry here. I turned
CCP on again to see if it helped but turned it off after that one and
tried again. My apologies :-(
> >Even if I run "ifconfig ippp0 up" and set up the routes manually, no
> 
> Also after the connection is made? Having 'defaultroute' as ipppd option
> can do strange and wonderful things to your routing...
I have 'defaultroute' in the options because a) my provider assigns me a
dynamic IP  b) the provider-end IP is dynamic too and c) this machine is
a home workstation with no other network connections.
> >noccp
> 
> You also show 'noccp' as option, but ipppd said "CCP enabled!" ...
(see above)
> >The only thing changing between the tests is the kernel version. The
> 
> Very sure?
Thank you for pointing out my mistake. I tested this thing again, with
freshly compiled 2.2.5 vanilla and ac1 versions. Here are the log
entries:
Apr  6 19:13:36 morphy kernel: Linux version 2.2.5-ac1 (root@localhost)
(gcc version 2.7.2.3) #1 Tue Apr 6 17:35:55 EEST 1999
[clip, the machine was compiling the kernel and I was busy doing other
things]
Apr  7 09:27:14 morphy kernel: ippp0: dialing 0 XXXXXXX...
Apr  7 09:27:15 morphy kernel: isdn_net: ippp0 connected
Apr  7 09:27:15 morphy ipppd[199]: Local number: XXXXXXX, Remote number:
XXXXXXX, Type: outgoing
Apr  7 09:27:15 morphy ipppd[199]: PHASE_WAIT -> PHASE_ESTABLISHED,
ifunit: 0, linkunit: 0, fd: 6
Apr  7 09:27:15 morphy ipppd[199]: Remote message: 
Apr  7 09:27:15 morphy ipppd[199]: MPPP negotiation, He: No We: No
Apr  7 09:27:16 morphy ipppd[199]: local  IP address XXX.XXX.XXX.XXX
Apr  7 09:27:16 morphy ipppd[199]: remote IP address XXX.XXX.XXX.XXX
Apr  7 09:27:16 morphy ipppd[199]: ioctl(SIOCADDRT) device route
(ippp0/XXX.0.0.0/ff000000): Network is down
Apr  7 09:27:16 morphy ipppd[199]: Unsupported protocol 'Compression
Control Protocol' (0x80fd) received
[clip]
Apr  7 09:28:01 morphy ipppd[199]: Modem hangup
Apr  7 09:28:01 morphy ipppd[199]: Connection terminated.
Apr  7 09:28:01 morphy ipppd[199]: taking down PHASE_DEAD link 0,
linkunit: 0
Apr  7 09:28:01 morphy ipppd[199]: LCP is down
Apr  7 09:28:01 morphy ipppd[199]: closing fd 6 from unit 0
Apr  7 09:28:01 morphy ipppd[199]: link 0 closed , linkunit: 0
Apr  7 09:28:01 morphy ipppd[199]: reinit_unit: 0 
Apr  7 09:28:01 morphy ipppd[199]: Connect[0]: /dev/ippp0, fd: 6
Apr  7 09:28:01 morphy kernel: isdn_net: local hangup ippp0
Apr  7 09:28:01 morphy kernel: ippp0: Chargesum is 0
And the other one:
Apr  7 09:29:46 morphy kernel: Linux version 2.2.5 (root@localhost) (gcc
version 2.7.2.3) #1 Tue Apr 6 20:50:56 EEST 1999
[clip]
Apr  7 09:34:01 morphy kernel: ippp0: dialing 0 XXXXXXX...
Apr  7 09:34:02 morphy kernel: lltrans_handler unknown primitive 57
Apr  7 09:34:02 morphy ipppd[197]: Local number: XXXXXXX, Remote number:
XXXXXXX, Type: outgoing
Apr  7 09:34:02 morphy ipppd[197]: PHASE_WAIT -> PHASE_ESTABLISHED,
ifunit: 0, linkunit: 0, fd: 6
Apr  7 09:34:02 morphy kernel: isdn_net: ippp0 connected
Apr  7 09:34:03 morphy ipppd[197]: Remote message: 
Apr  7 09:34:03 morphy ipppd[197]: MPPP negotiation, He: No We: No
Apr  7 09:34:03 morphy ipppd[197]: local  IP address XXX.XXX.XXX.XXX
Apr  7 09:34:03 morphy ipppd[197]: remote IP address XXX.XXX.XXX.XXX
Apr  7 09:34:03 morphy ipppd[197]: Unsupported protocol 'Compression
Control Protocol' (0x80fd) received
[clip]
Apr  7 09:39:19 morphy ipppd[197]: Modem hangup
Apr  7 09:39:19 morphy ipppd[197]: Connection terminated.
Apr  7 09:39:19 morphy ipppd[197]: taking down PHASE_DEAD link 0,
linkunit: 0
Apr  7 09:39:19 morphy ipppd[197]: LCP is down
Apr  7 09:39:19 morphy ipppd[197]: closing fd 6 from unit 0
Apr  7 09:39:19 morphy ipppd[197]: link 0 closed , linkunit: 0
Apr  7 09:39:19 morphy ipppd[197]: reinit_unit: 0 
Apr  7 09:39:19 morphy ipppd[197]: Connect[0]: /dev/ippp0, fd: 6
Apr  7 09:39:19 morphy kernel: isdn_net: local hangup ippp0
Apr  7 09:39:19 morphy kernel: ippp0: Chargesum is 0
Ok, now I'm 100% certain that nothing except the kernel version has
changed. Vanilla 2.2.5 vs. 2.2.5-ac1.
-- 
Legalese: My opinions are mine and I speak only for myself.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/