Date: Tue, 16 Dec 2008 13:20:52 +0100 (CET)
From: Stefan Richter <>
Subject: [git pull] ieee1394 update
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/16/124

Linus, please pull from the for-linus branch at
    git://git.kernel.org/pub/scm/linux/kernel/git/ieee1394/linux1394-2.6.git for-linus
to receive the following update.
Stefan Richter (1):
      ieee1394: add quirk fix for Freecom HDD
 drivers/ieee1394/nodemgr.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)
commit 25a41b280083259d05d68f61633194344a1f8a9f
Author: Stefan Richter <stefanr@s5r6.in-berlin.de>
Date:   Sat Dec 13 01:43:59 2008 +0100
    ieee1394: add quirk fix for Freecom HDD
    
    According to 
http://bugzilla.kernel.org/show_bug.cgi?id=12206,
 Freecom
    FireWire Hard Drive 1TB reports max_rom=2 but returns garbage if block
    read requests are used to read the config ROM.  Force max_rom=0 to limit
    them to quadlet read requests.
    
    Reported-by: Christian Mueller <cm1@mumac.de>
    Signed-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>
diff --git a/drivers/ieee1394/nodemgr.c b/drivers/ieee1394/nodemgr.c
index d333ae2..79ef5fd 100644
--- a/drivers/ieee1394/nodemgr.c
+++ b/drivers/ieee1394/nodemgr.c
@@ -115,8 +115,14 @@ static int nodemgr_bus_read(struct csr1212_csr *csr, u64 addr, u16 length,
 	return error;
 }
 
+#define OUI_FREECOM_TECHNOLOGIES_GMBH 0x0001db
+
 static int nodemgr_get_max_rom(quadlet_t *bus_info_data, void *__ci)
 {
+	/* Freecom FireWire Hard Drive firmware bug */
+	if (be32_to_cpu(bus_info_data[3]) >> 8 == OUI_FREECOM_TECHNOLOGIES_GMBH)
+		return 0;
+
 	return (be32_to_cpu(bus_info_data[2]) >> 8) & 0x3;
 }
 
Thanks,
-- 
Stefan Richter
-=====-==--- ==-- =----
http://arcgraph.de/sr/