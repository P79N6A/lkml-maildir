Date: Wed, 18 May 2005 14:04:40 -0700
From: Andrew Morton <>
Subject: Re: "loop device recursion avoidance" patch causes difficulties
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/5/18/271

Lubo_ Dole_el <lubosd@gmail.com> wrote:
>
> I've created a bugreport at 
http://bugme.osdl.org/show_bug.cgi?id=4472
> and I was advised to write to this list.
> 
> A patch called "loop device recursion avoidance" which appeared in
> 2.6.11 kernel has complicated ISO image mounting from another mounted
> media.
Does this help?
diff -puN drivers/block/loop.c~loop-recusrion-avoidance-fix drivers/block/loop.c
--- 25/drivers/block/loop.c~loop-recusrion-avoidance-fix	Wed May 18 14:03:14 2005
+++ 25-akpm/drivers/block/loop.c	Wed May 18 14:03:14 2005
@@ -765,10 +765,8 @@ static int loop_set_fd(struct loop_devic
 			goto out_putf;
 
 		l = f->f_mapping->host->i_bdev->bd_disk->private_data;
-		if (l->lo_state == Lo_unbound) {
-			error = -EINVAL;
-			goto out_putf;
-		}
+		if (l->lo_state == Lo_unbound)
+			break;
 		f = l->lo_backing_file;
 	}
 
_
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/