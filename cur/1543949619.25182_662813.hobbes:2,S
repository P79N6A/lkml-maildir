Date: Mon, 3 Mar 2008 15:28:05 -0500
From: Jarod Wilson <>
Subject: Re: [PATCH] firewire: reread config ROM when device reset the bus
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/3/451

On Sunday 02 March 2008 07:48:30 pm Stefan Richter wrote:
> When a device changes its configuration ROM, it announces this with a
> bus reset.  firewire-core has to check which node initiated a bus reset
> and whether any unit directories went away or were added on this node.
>
> Tested with an IOI FWB-IDE01AB which has its link-on bit set if bus
> power is available but does not respond to ROM read requests if self
> power is off.  This implements
>   - recognition of the units if self power is switched on after fw-core
>     gave up the initial attempt to read the config ROM,
>   - shutdown of the units when self power is switched off.
>
> Also tested with a second PC running Linux/ieee1394.  When the eth1394
> driver is inserted and removed on that node, fw-core now notices the
> addition and removal of the IPv4 unit on the ieee1394 node.
>
> Signed-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>
> ---
>
> Applies after "firewire: replace static ROM cache by allocated cache".
I've also tested and verified proper disk suspend (and resume) functionality 
with a FW800 Western Digital My Book Pro and a FW400 Western Digital My Book, 
both of which were previously unable to power down their disks.
Signed-off-by: Jarod Wilson <jwilson@redhat.com>
-- 
Jarod Wilson
jwilson@redhat.com