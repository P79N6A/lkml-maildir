Date: Sat, 07 Oct 2006 05:35:32 -0600
From: Matthew Wilcox <>
Subject: [PATCH] Distinguish between errors and warnings in modpost
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/7/63

Some of modpost's warnings are fatal, and some are not.  Adopt the
compiler distinction between errors and warnings by calling error()
for fatal diagnostics and warn() for non-fatal ones.
Signed-off-by: Matthew Wilcox <matthew@wil.cx>
diff --git a/scripts/mod/modpost.c b/scripts/mod/modpost.c
index 4127796..5530294 100644
--- a/scripts/mod/modpost.c
+++ b/scripts/mod/modpost.c
@@ -55,6 +55,17 @@ void warn(const char *fmt, ...)
 	va_end(arglist);
 }
 
+void error(const char *fmt, ...)
+{
+	va_list arglist;
+
+	fprintf(stderr, "ERROR: ");
+
+	va_start(arglist, fmt);
+	vfprintf(stderr, fmt, arglist);
+	va_end(arglist);
+}
+
 static int is_vmlinux(const char *modname)
 {
 	const char *myname;
@@ -1207,9 +1218,14 @@ static int add_versions(struct buffer *b
 		exp = find_symbol(s->name);
 		if (!exp || exp->module == mod) {
 			if (have_vmlinux && !s->weak) {
-				warn("\"%s\" [%s.ko] undefined!\n",
-				     s->name, mod->name);
-				err = warn_unresolved ? 0 : 1;
+				if (warn_unresolved) {
+					warn("\"%s\" [%s.ko] undefined!\n",
+					     s->name, mod->name);
+				} else {
+					error("\"%s\" [%s.ko] undefined!\n",
+					      s->name, mod->name);
+					err = 1;
+				}
 			}
 			continue;
 		}
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/