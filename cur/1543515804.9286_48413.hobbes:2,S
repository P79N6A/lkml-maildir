Date: Thu, 11 Nov 1999 17:34:22 +0100 (MET)
From: (Gerhard Wichert)
Subject: highmem patch
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/11/96

Hi,
here comes a patch against 2.3.26. Without this patch a kernel configured for 4GB
memory won't boot if you have usable RAM in your e820 map above 4GB.
--- linux-2.3.26/arch/i386/kernel/setup.c	Tue Oct 26 05:51:13 1999
+++ linux-2.3.26-4GBpatch/arch/i386/kernel/setup.c	Thu Nov 11 16:01:46 1999
@@ -600,6 +600,10 @@
 		if (e820.map[i].type != E820_RAM)
 			continue;
 		curr_pfn = PFN_DOWN(e820.map[i].addr + e820.map[i].size);
+#ifndef  CONFIG_X86_PAE
+		if (curr_pfn != PFN_DOWN(PFN_PHYS(curr_pfn)))
+			continue;
+#endif
 		if (curr_pfn > max_pfn)
 			max_pfn = curr_pfn;
 	}
-Gerhard.