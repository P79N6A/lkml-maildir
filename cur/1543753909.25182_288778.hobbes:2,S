Date: Fri, 21 Jan 2005 14:55:09 -0800
From: Mitch Williams <>
Subject: [PATCH 3/3] change sematics of read flag
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/1/21/273

This patch reverses the semantics of the read fill flag, getting rid of an
extra assignment at allocation time.
Generated from 2.6.11-rc1.
Signed-off-by:  Mitch Williams <mitch.a.williams@intel.com>
diff -uprN -X dontdiff linux-2.6.11-clean/fs/sysfs/file.c linux-2.6.11/fs/sysfs/file.c
--- linux-2.6.11-clean/fs/sysfs/file.c	2004-12-24 13:33:50.000000000 -0800
+++ linux-2.6.11/fs/sysfs/file.c	2005-01-21 13:09:21.000000000 -0800
@@ -61,7 +61,7 @@ struct sysfs_buffer {
 	char			* page;
 	struct sysfs_ops	* ops;
 	struct semaphore	sem;
-	int			needs_read_fill;
+	int			read_filled;
 };
@@ -89,7 +89,7 @@ static int fill_read_buffer(struct dentr
 		return -ENOMEM;
 	count = ops->show(kobj,attr,buffer->page);
-	buffer->needs_read_fill = 0;
+	buffer->read_filled = 1;
 	BUG_ON(count > (ssize_t)PAGE_SIZE);
 	if (count >= 0)
 		buffer->count = count;
@@ -154,7 +154,7 @@ sysfs_read_file(struct file *file, char
 	ssize_t retval = 0;
 	down(&buffer->sem);
-	if (buffer->needs_read_fill) {
+	if (!buffer->read_filled) {
 		if ((retval = fill_read_buffer(file->f_dentry,buffer)))
 			goto out;
 	}
@@ -308,7 +307,6 @@ static int check_perm(struct inode * ino
 	if (buffer) {
 		memset(buffer,0,sizeof(struct sysfs_buffer));
 		init_MUTEX(&buffer->sem);
-		buffer->needs_read_fill = 1;
 		buffer->ops = ops;
 		file->private_data = buffer;
 	} else
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/