Date: Mon, 20 Jan 2003 18:45:10 +0100
From: Dick Streefland <>
Subject: [PATCH] /proc/cmdline broken since 2.4.19
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/1/20/105

Reading /proc/cmdline one character at a time produces garbage since
kernel version 2.4.19:
$ cat /proc/cmdline
auto BOOT_IMAGE=2.4.20-x78 ro root=302 nomodules
$ dd bs=1 if=/proc/cmdline | od -x
49+0 records in
49+0 records out
0000000 0200 5555 0006 0000 622d 7361 0068 5555
0000020 5555 cfcf cfcf cfcf 5555 5555 0000 0000
0000040 02f7 5555 000b 0000 6c6e 4e5f 404c 7565
0000060 0072
0000061
The following patch fixes this:
--- linux-2.4.20/fs/proc/proc_misc.c.orig	Wed Dec  4 11:01:33 2002
+++ linux-2.4.20/fs/proc/proc_misc.c	Mon Jan 20 18:33:02 2003
@@ -422,9 +422,9 @@
 				 int count, int *eof, void *data)
 {
 	extern char saved_command_line[];
-	int len;
+	int len = 0;
 
-	len = snprintf(page, count, "%s\n", saved_command_line);
+	proc_sprintf(page, &off, &len, "%s\n", saved_command_line);
 	return proc_calc_metrics(page, start, off, count, eof, len);
 }
 
-- 
Dick Streefland                      ////                      Altium BV
dick.streefland@altium.nl           (@ @)          
http://www.altium.com
--------------------------------oOO--(_)--OOo---------------------------
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/