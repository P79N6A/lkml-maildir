Date: Sun, 30 Sep 2007 17:53:30 +0200
From: Ingo Molnar <>
Subject: Re: [PATCH] fix console change race exposed by CFS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/9/30/70

* Jan Luebbe <jluebbe@lasnet.de> wrote:
> I'm currenly porting the OpenMoko patchset to 2.6.23-rc8. We are using 
> psplash and kdrive. When booting, I got an error from psplash about 
> being unable to switch consoles. Strangely, it was possible to start 
> kdrive manually. So i set up qemu for kernel debugging, set some 
> interesting breakpoints and then saw that it was scheduling away 
> directly after the kill_pid. Then it was quite obvious.
> 
> It was triggering every time, on the device and in qemu identically. 
> Most people testing the RCs probably don't run psplash (or any other 
> program which sets vt_mode.mode to VT_PROCESS), so it wasn't noticed 
> earlier.
thx for the description. I did some searching on google.com/codesearch, 
and here are some other console apps that make active use of VT_PROCESS:
   1diskxwin-2.0.0/X11/programs/Xserver/hw/kdrive/linux/linux.c
   usr/include/dev/wscons/wsdisplay_compat_usl.c
   busybox-1.01/loginutils/vlock.c
   allegro-4.2.2/src/linux/vtswitch.c
   tvision/classes/linux/linuxkey.cc
   xc/programs/Xserver/hw/xfree86/os-support/pmax/pmax_init.c
   aalib-1.4.0/src/aalinuxkbd.c
   qt-embedded-opensource-4.0.0-b2/src/gui/embedded/qkbdtty_qws.cpp
   mc-4.5.55/src/cons.handler.c
   psplash-0.1/psplash-console.c
   quakeforge-0.5.5/libs/video/targets/vid_fbdev.c
just in case someone has a regression with any of them, on an older 
kernel. To me it appears X should have triggered this too. Perhaps 
people dont switch between VGA and X all that frequently anymore ...
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/