Date: Thu, 27 Jul 2000 21:15:27 +0200 (CEST)
From: Gérard Roudier <>
Subject: Re: SCSI strangenesses...
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/27/106

On Thu, 27 Jul 2000, Francis Galiegue wrote:
> Kernel is 2.2.16. My SCSI adapter is a Tekram DC390 U2W, using sym53c8xx
> chipset, which has the following peripherals:
> 
> - two IBM hard drives, but they're not the problem (id 1 and 6 though I doubt
>   that it matters at all)
> - one Pionneer DVD reader, id 2
> - one CD writer, Racer 12/8/32
> 
> The problem is with the DVD drive and CD writer. When I query the SCSI utility
> at boot about these two drives' capabilitites, it says that none of them
> support wide negociation or TCQ. By default, though, these settings were
> enabled on both. The DVD drive worked, but not the CD writer.
In theory at least, the [sym|ncr]53c8xx drivers donnot initiate Wide
negotiations neither use tags with a device if they haven't seen these
features reported by the device in the INQUIRY response. The fact that one
device works and the other fails seems strange too.
 
> I then disabled these two settings by hand, and my CD writer worked... My
> questions are the following:
Mine could be::-)
1. Why did you disable the both settings at the same time instead of one 
   at a time ?
2. What 'hand' did you use to disable the feature ? (could be either the
   NVRAM setup, the boot command line, ...)
Btw, I would prefer to be told about the INQUIRY data the devices actually 
return. You may use the 'scsiinfo' tool for that.
> 1. how come the SCSI card didn't disable these options automatically, even
> though it knew about the drive capabilities?
The card has NVRAM (NV=non volatile) that stores the user setup. There is
no valuable reasons for the Tekram setup program to prevent user from
entering any setup it wishes, in my opinion.
> 2. is it possible to query a drive about its capabilities from a SCSI driver,
> and to enable/disable such settings?
This already works this way (modulo bugs). The SCSI driver sends an
INQUIRY command to each device and expects as response, notably, the
capabilities the device claim to support.
> (as a side note, this problems occurs with both the ncr53c8xx driver or the
> sym53c8xx one)
I am not surprised of both driver giving same results here. :-)
For now, you may try to enable some debug traces in the driver, starting
with the following (boot command line):
           sym53c8xx=debug:0x200,verb:2
The debug flag will tells the driver to print out all negotiation messages
and resulting parameter's value.
  Gérard.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/