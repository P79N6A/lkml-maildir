Date: Thu, 07 Feb 2008 18:28:22 -0500
From: Chuck Ebbert <>
Subject: Re: [PATCH] x86_64: make traps on 'iret' be debuggable in user	space
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/7/588

On 02/07/2008 03:30 PM, Roland McGrath wrote:
>> Did you test without CONFIG_PARAVIRT, and CONFIG_PARAVIRT booted both with and
>> without the "noreplace-paravirt" parameter?
> 
> I did not test CONFIG_PARAVIRT at all.  I just fixed what its introduction
> had done to break generic x86-64.
> 
> 
It looks you may have broken paravirt (if even that case worked) because
the iret is actually at the iret_label you removed (after the instruction
is patched.) And most likely neither version worked with "noreplace-paravirt',
because then the iret instruction is out-of-line and the INTERRUPT_RETURN
jumps to it.