Date: Tue, 27 Jan 2009 14:50:18 +0900 (JST)
From: KOSAKI Motohiro <>
Subject: Re: [PATCH] make checkpatch warn about access to current->comm
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/27/17

> +# direct access to current task name is racy, suggest accessor instead.
> +		if ($line =~ /current\-\>comm/) {
> +			WARN("direct access to current->comm is racy, use get_task_comm() instead.\n" . $herecurr);
> +		}
> +
>  # use of NR_CPUS is usually wrong
>  # ignore definitions of NR_CPUS and usage to define arrays as likely right
>  		if ($line =~ /\bNR_CPUS\b/ &&
./scripts/checkpatch --file fs/exec.c
------------------------------------------------------
WARNING: direct access to current->comm is racy, use get_task_comm() instead.
#952: FILE: exec.c:952:
+       char tcomm[sizeof(current->comm)];
(snip)
WARNING: direct access to current->comm is racy, use get_task_comm() instead.
#1459: FILE: exec.c:1459:
+                                             "%s", current->comm);
(snip)
WARNING: direct access to current->comm is racy, use get_task_comm() instead.
#1788: FILE: exec.c:1788:
+               if (!strcmp(delimit, current->comm)) {
---------------------------
I think "char tcomm[sizeof(current->comm)];" is valid code.
if checkpatch.pl don't warn "sizeof(current->comm)", I'm glad.