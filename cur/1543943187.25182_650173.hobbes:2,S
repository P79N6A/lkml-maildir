Date: Fri, 8 Feb 2008 03:24:23 +0000
From: Alasdair G Kergon <>
Subject: Re: [git pull] device-mapper update for 2.6.25
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/7/686

On Thu, Feb 07, 2008 at 07:04:47PM -0800, Andrew Morton wrote:
> On Fri, 8 Feb 2008 02:45:32 +0000 Alasdair G Kergon <agk@redhat.com> wrote:
> 
> >       dm: move deferred bio flushing to workqueue
> 
> To my unpracticed eye this one looks fairly fundamental.  Unfortunately the
> changelog:
> 
>   Add a single-thread workqueue for each mapped device and move flushing
>   of the lists of pushback and deferred bios to this new workqueue.
> 
> tells us nothing of the reasons for this change.  (It should have done so!)
> 
> It _looks_ pretty unscalable.  Perhaps these deferred BIOs don't happen
> very often?
Indeed - it's a rare occurrence - happens when the dm device is
suspended/resumed which usually means it was being reconfigured by something in
userspace.
It's the first patch of a series that will provide barrier support (slated for
2.6.26).
The appearance of all these workqueues in dm goes back to this old change:
  md-dm-reduce-stack-usage-with-stacked-block-devices.patch
Alasdair
-- 
agk@redhat.com