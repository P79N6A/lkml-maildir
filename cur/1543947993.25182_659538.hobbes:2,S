Date: Mon, 25 Feb 2008 22:54:54 +0100
From: Pavel Machek <>
Subject: Re: [(RT RFC) PATCH v2 3/9] rearrange rt_spin_lock sleep
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/25/360

Hi!
> @@ -720,7 +728,8 @@ rt_spin_lock_slowlock(struct rt_mutex *lock)
>  	 * saved_state accordingly. If we did not get a real wakeup
>  	 * then we return with the saved state.
>  	 */
> -	saved_state = xchg(&current->state, TASK_UNINTERRUPTIBLE);
> +	saved_state = current->state;
> +	smp_mb();
> 
>  	for (;;) {
>  		unsigned long saved_flags;
Please document what the barrier is good for.
Plus, you are replacing atomic operation with nonatomic; is that ok?
									Pavel
-- 
(english) 
http://www.livejournal.com/~pavelmachek
(cesky, pictures) 
http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html