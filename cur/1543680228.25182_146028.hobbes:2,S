Date: 08 Jul 2003 13:40:35 +0200
From: Christian Axelsson <>
Subject: Re: 2.5.74-mm2 + nvidia (and others)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/8/59

On Tue, 2003-07-08 at 09:03, Martin Schlemmer wrote:
> On Mon, 2003-07-07 at 21:30, Andrew Morton wrote:
> 
> > Well that will explode if someone enables highpmd and has highmem.
> > This would be better:
> > 
> > --- nv.c.orig	2003-07-05 22:55:10.000000000 -0700
> > +++ nv.c	2003-07-05 22:55:58.000000000 -0700
> > @@ -2105,11 +2105,14 @@
> >      if (pgd_none(*pg_dir))
> >          goto failed;
> > 
> > -    pg_mid_dir = pmd_offset(pg_dir, address);
> > -    if (pmd_none(*pg_mid_dir))
> > +    pg_mid_dir = pmd_offset_map(pg_dir, address);
> > +    if (pmd_none(*pg_mid_dir)) {
> > +	pmd_unmap(pg_mid_dir);
> >          goto failed;
> > +    }
> > 
> >      NV_PTE_OFFSET(address, pg_mid_dir, pte);
> > +    pmd_unmap(pg_mid_dir);
> > 
> >      if (!pte_present(pte))
> >          goto failed;
> > 
> > -
> 
> Bit too specific to -mm2, what about the the attached?
Compiles nicely, havent but I havent reloaded it yet.
-- 
Christian Axelsson
smiler@lanil.mine.nu
[unhandled content-type:application/pgp-signature]