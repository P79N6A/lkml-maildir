Date: Sat, 08 Dec 2007 17:31:51 -0700
From: (Eric W. Biederman)
Subject: Re: [PATCH 2/3] ptrace_stop: remove the wrong ->group_stop_count bookkeeping
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/8/217

Oleg Nesterov <oleg@tv-sign.ru> writes:
> ptrace_stop() decrements ->group_stop_count to "participate" in group stop.
> This looks very wrong to me, the task can in fact decrement this counter twice.
> If the tracee returns to the user-space before other threads complete the group
> stop, it will notice TIF_SIGPENDING and do it again.
This is one of those interesting weird cases.  The ptrace interface remains per
task.
So need to handle a simultaneous thread group stop and a per task stop.
>
> Another problem is that we don't set SIGNAL_STOP_STOPPED if the counter becomes
> zero.
>
> I must admit, I don't undestand the reason why this code was added, it is very
> old.
I haven't dug in enough yet to understand better, but it is my hunch we
need to do something when we have both kinds of stop happening simultaneously.
Eric