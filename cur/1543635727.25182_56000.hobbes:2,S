Date: Fri, 12 Jul 2002 15:39:50 -0700
From: William Lee Irwin III <>
Subject: NUMA-Q breakage 3/7 irqbalance stuffs unreachable cpu's in IO-APICS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/7/12/177

irqbalance stuffs unreachable cpus' APIC ID's into the IO-APICs.
This cannot be done generically, as the cpu's that can be reached
from a given IO-APIC depend on the subarch. The net effect of the bug
is deadlocking while waiting for interrupts to come back from devices,
i.e. booting is impossible.
Fix (due to Matt Dobson) below.
Cheers,
Bill
diff -Nur linux-2.5.23-vanilla/arch/i386/kernel/io_apic.c linux-2.5.23-patched/arch/i386/kernel/io_apic.c
--- linux-2.5.23-vanilla/arch/i386/kernel/io_apic.c	Tue Jun 18 19:11:52 2002
+++ linux-2.5.23-patched/arch/i386/kernel/io_apic.c	Thu Jun 27 14:28:51 2002
@@ -247,7 +247,7 @@
 
 static inline void balance_irq(int irq)
 {
-#if CONFIG_SMP
+#if (CONFIG_SMP && !CONFIG_MULTIQUAD)
 	irq_balance_t *entry = irq_balance + irq;
 	unsigned long now = jiffies;
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/