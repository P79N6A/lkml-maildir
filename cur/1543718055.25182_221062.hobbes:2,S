Date: Mon, 17 May 2004 12:01:59 +0200
From: Andi Kleen <>
Subject: Re: i810 AGP fails to initialise (was Re: 2.6.6-mm2)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/5/17/31

On Mon, May 17, 2004 at 09:49:56AM +0100, Sean Neakums wrote:
> Sean Neakums <sneakums@zork.net> writes:
> 
> > Sean Neakums <sneakums@zork.net> writes:
> >
> >> Andi Kleen <ak@suse.de> writes:
> >>
> >>> Sean, can you double check that when you compile the AGP driver as module
> >>> that the 7124 PCI ID appears in modinfo intel-agp ? 
> >>> And does the module also refuse to load ? 
> >>
> >> I rebuilt with agpgart, intel-agp and i810 as modules, modprobed them,
> >> and it works.
> >
> > I just realised that I probably forgot to reapply the patch before
> > doing this test.  Will check Monday.  Sorry about this.
> 
> Below is modinfo output.  The module loads but doesn't initialise the
> AGP.
Someone else reported that it worked modular at least. When you apply
the following patch what output do you get in the kernel log when you
load the module?
-Andi
--- linux-2.6.6-work/drivers/char/agp/intel-agp.c.~2~	2004-05-10 20:59:24.000000000 +0200
+++ linux-2.6.6-work/drivers/char/agp/intel-agp.c	2004-05-17 11:56:01.000000000 +0200
@@ -1263,9 +1263,13 @@
 	u8 cap_ptr = 0;
 	struct resource *r;
 
+	printk("agp_intel_probe device %x\n", pdev->device); 
+
 	cap_ptr = pci_find_capability(pdev, PCI_CAP_ID_AGP);
-	if (!cap_ptr)
+	if (!cap_ptr) { 
+		printk("no cap\n");
 		return -ENODEV;
+	}
 
 	bridge = agp_alloc_bridge();
 	if (!bridge)
@@ -1432,6 +1436,7 @@
 	pci_set_drvdata(pdev, bridge);
 	return agp_add_bridge(bridge);
  fail:
+	printk("failure\n");
 	agp_put_bridge(bridge);
 	return -ENODEV;
 }
@@ -1518,6 +1523,7 @@
 		return 0;
 	agp_initialised=1;
 
+	printk("agp_intel_init\n");
 	return pci_module_init(&agp_intel_pci_driver);
 }
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/