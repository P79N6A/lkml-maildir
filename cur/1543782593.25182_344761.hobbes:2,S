Date: Fri, 26 Aug 2005 11:37:00 +0100 (BST)
From: "Maciej W. Rozycki" <>
Subject: Re: question on memory barrier
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/8/26/36

On Fri, 26 Aug 2005, moreau francis wrote:
> I don't think that MIPS cpu reorder memory access, but gcc can ! And I
> don't think that the use of 'volatile' can prevent it to do that.
 Well, certain MIPS implementations may merge multiple uncached writes in 
the writeback buffer, e.g. writes to different bytes within a single 
aligned word.  This is true for consecutive writes; I'm not sure this 
permits jumping the writeback queue, though.
> > To return to the point directly at hand - on MIPS architectures to date,
> > simply doing your memory access through a "volatile u32 *" is sufficient
> > to ensure that the IO hits the bus (assuming that your pointer points to
> > kseg1, not kseg0, or is otherwise uncached), because 'volatile' forces
> > gcc to generate a "sw" for each store, and all MIPS so far have been
> > designed so that multiple uncached writes to mmio locations do generate
> > multiple bus transactions.
 Unfortunately this is not true -- see above.  This is why even wmb() 
isn't a no-op on MIPS.
  Maciej
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/