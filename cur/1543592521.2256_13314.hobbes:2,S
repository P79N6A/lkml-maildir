Date: Sun, 27 May 2001 00:22:58 -0400 (EDT)
From: Alexander Viro <>
Subject: Re: Linux-2.4.5, reiserfs, Oops!
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/5/27/2

On Sat, 26 May 2001, Chris Rankin wrote:
> Linux 2.4.5, SMP, devfs, < 1 GB memory, compiled with gcc-2.95.3
> drive. I didn't do anything clever with parameters or anything; just
> "mkreisferfs /dev/sda1", mounted it and then unmounted it again. And
> the kernel oopsed on me.
Bloody hell. 
--- fs/super.c       Fri May 25 21:51:14 2001
+++ fs/super.c.new     Sun May 27 00:21:53 2001
@@ -873,6 +873,7 @@
        }
        spin_unlock(&dcache_lock);
        down_write(&sb->s_umount);
+       lock_kernel();
        sb->s_root = NULL;
        /* Need to clean after the sucker */
        if (fs->fs_flags & FS_LITTER)
@@ -901,6 +902,7 @@
        put_filesystem(fs);
        sb->s_type = NULL;
        unlock_super(sb);
+       unlock_kernel();
        up_write(&sb->s_umount);
        if (bdev) {
                blkdev_put(bdev, BDEV_FS);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/