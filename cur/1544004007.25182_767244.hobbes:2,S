Date: Mon, 10 Nov 2008 22:44:18 +0100
From: "Alexander van Heukelum" <>
Subject: Re: [PATCH RFC/RFB] x86_64, i386: interrupt dispatch changes
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/11/10/304

On Mon, 10 Nov 2008 07:39:22 -0800, "H. Peter Anvin" <hpa@zytor.com>
said:
> Ingo Molnar wrote:
> > * Alexander van Heukelum <heukelum@fastmail.fm> wrote:
> > 
> > hackbench is _way_ too noisy to measure such cycle-level differences 
> > as irq entry changes cause. It also does not really stress interrupts 
> > - it only stresses networking, the VFS and the scheduler.
> > 
> > a better test might have been to generate a ton of interrupts, but 
> > even then it's _very_ hard to measure it properly. The best method is 
> > what i've suggested to you early on: run a loop in user-space and 
> > observe irq costs via RDTSC, as they happen. Then build a histogram 
> > and compare the before/after histogram. Compare best-case results as 
> > well (the first slot of the histogram), as those are statistically 
> > much more significant than a noisy average.
> > 
> 
> For what it's worth, I tested this out, and I'm pretty sure you need to
> run a uniprocessor configuration (or system) for it to make sense --
> otherwise you end up missing too many of the interrupts.  I first tested
> this on an 8-processor system and, well, came up with nothing.
> 
> I'm going to try this later on a uniprocessor, unless Alexander beats me
> to it.
I did the rdtsctest again for the irqstubs patch you sent. The data
is at 
http://heukelum.fastmail.fm/irqstubs/
 and the latency histogram
is 
http://heukelum.fastmail.fm/irqstubs/latency_hpa.png
Greetings,
    Alexander
> 	-hpa
-- 
  Alexander van Heukelum
  heukelum@fastmail.fm
-- 
http://www.fastmail.fm
 - Same, same, but different...