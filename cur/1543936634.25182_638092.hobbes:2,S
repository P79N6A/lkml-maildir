Date: Mon, 14 Jan 2008 15:58:54 +0100
From: Ingo Molnar <>
Subject: Re: [PATCH x86] [15/16] Force __cpuinit on for CONFIG_PM without HOTPLUG_CPU
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/14/175

* Sam Ravnborg <sam@ravnborg.org> wrote:
> > ok, i've dropped this patch from x86.git for now:
> > 
> >  Subject: x86: force __cpuinit on for CONFIG_PM without HOTPLUG_CPU
> >  From: Andi Kleen <ak@suse.de>
> > 
> > but longer-term, shouldnt these annotations be automated? We'll see 
> > a constant stream of them, all around the clock as people regularly 
> > get it wrong (because it's not intuitive).
>
> Would be great to have them automated - just dunno how to do it. Do 
> you see a feasible way to do it?
a good starting point would be to make the warnings a lot more 
self-explanatory. Right now it's often non-obvious trying to figure out 
how the dependencies are structured and which one should be changed to 
get rid of the bug.
> Short term modpost etc. will be enhanced to be less dependent on the 
> actual configuration when performing the checks. It should not matter 
> if CONFIG_HOTPLUG_CPU is enabled or not when we check the __cpuint 
> annotations but this is how we see it today so far too many faults 
> slip through.
a good way i see is to:
 - improve the debug output so that it's obvious at a glance what the 
   problem is.
 - quickly reach a close-to-100%-perfect stage, brute-force. Drop 
   __init* annotations en masse if they are not perfectly layered. 
   Whoever reintroduces them will then have to do it perfectly.
 - then turn these into hard failures (which they _are_ in a significant 
   percentage of the situations).
once it's a hard build failure, people will fix them quickly and 
automated tests will pick them up as well.
	Ingo