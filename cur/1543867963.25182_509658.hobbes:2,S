Date: Fri, 16 Feb 2007 12:06:03 -0500 (EST)
From: "Robert P. J. Day" <>
Subject: Re: [KJ] [PATCH] is_power_of_2 in ia64mm
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/16/255

i'm not clear on what the possible problem is here:
On Fri, 16 Feb 2007, Richard Knutsson wrote:
> Andreas Schwab wrote:
> > Richard Knutsson <ricknu-0@student.ltu.se> writes:
> >
> >> Andreas Schwab wrote:
> >>
> >>> Richard Knutsson <ricknu-0@student.ltu.se> writes:
> >>>
> >>>
> >>>> Vignesh Babu BM wrote:
> >>>>
> >>>>> @@ -175,7 +176,7 @@ static int __init hugetlb_setup_sz(char *str)
> >>>>>  		tr_pages = 0x15557000UL;
> >>>>>   	size = memparse(str, &str);
> >>>>> -	if (*str || (size & (size-1)) || !(tr_pages & size) ||
> >>>>> +	if (*str || !is_power_of_2(size) || !(tr_pages & size) ||
> >>>>>  		size <= PAGE_SIZE ||
> >>>>>  		size >= (1UL << PAGE_SHIFT << MAX_ORDER)) {
> >>>>>  		printk(KERN_WARNING "Invalid huge page size specified\n");
> >>>>>
> >>>> As we talked about before; is this really correct? !is_power_of_2(0) ==
> >>>> true while (0 & (0-1)) == 0.
> >>>>
> >>> size == 0 is also covered by the next two conditions, so the overall value
> >>> does not change.
> >>>
> >> Yes, but is it meant to state that 'size' is not a power of two?
> >>
> >
> > What else can it mean?
> What about !one_or_less_bit()? It has not been implemented (yet?)
> but been discussed.
but whether or not it's been implemented doesn't change whether or not
the code above can be simplified.  given what's being tested, and the
error message about whether a page size is valid, it seems fairly
clear that this is a power of two test.  what's the problem?
> It ended by concluding that is_power_of_2() should be fixed up first
> and then we can see about it.
there's nothing about is_power_of_2() that needs "fixing".  it's
correct as it's currently implemented.
> And as I stated before; !is_power_of_2(size) != (size & (size-1))!
> It may be a bug but then we have to be sure it is suppose to be the
> power of 2.
it may be that certain tests in the current code need to be examined
carefully to clarify what's being tested.  but the code above seems
straightforward.
rday
-- 
========================================================================
Robert P. J. Day
Linux Consulting, Training and Annoying Kernel Pedantry
Waterloo, Ontario, CANADA
http://fsdev.net/wiki/index.php?title=Main_Page
========================================================================
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/