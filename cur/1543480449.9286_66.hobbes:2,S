Date: Mon, 18 Jan 1999 09:21:30 -0500
From: Matthew Harrell <>
Subject: 2.2.0pre* 3c59x vortex and network hanging
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/18/66

Hi,
        Is anyone other than me having problems with the vortex driver?  I can
get all the recent kernels to hang networking almost instantly if I get ftp to
another computer and attempt to download a large number of large files.
Sometimes it hangs 10 MB into the transfer, sometimes 1 MB but the only fix is
to reboot the machine if I want to get networking back.  I've attached the 
dmesg log below - the relevent 3c59x stuff is at the end of it.  
-- 
  Matthew Harrell                          Beauty is in the eye of the beer
  Simulation Technology Division, SAIC      holder.
  mharrell@std.saic.com
Linux version 2.2.0-pre7-ac7-SMP (root@tbilisi) (gcc version egcs-2.91.60 19981201 (egcs-1.1.1 release)) #1 SMP Mon Jan 18 08:06:43 EST 1999
Intel MultiProcessor Specification v1.1
    Virtual Wire compatibility mode.
OEM ID: INTEL    Product ID: 440FX        APIC at: 0xFEE00000
Processor #1 Pentium(tm) Pro APIC version 17
Processor #0 Pentium(tm) Pro APIC version 17
I/O APIC #2 Version 17 at 0xFEC00000.
Processors: 2
mapped APIC to ffffe000 (fee00000)
mapped IOAPIC to ffffd000 (fec00000)
Detected 199311777 Hz processor.
Console: colour VGA+ 80x25
Calibrating delay loop... 198.66 BogoMIPS
Memory: 257284k/262144k available (976k kernel code, 420k reserved, 3420k data, 44k init)
Checking 386/387 coupling... OK, FPU using exception 16 error reporting.
Checking 'hlt' instruction... OK.
POSIX conformance testing by UNIFIX
mtrr: v1.26 (19981001) Richard Gooch (rgooch@atnf.csiro.au)
per-CPU timeslice cutoff: 50.07 usecs.
CPU1: Intel Pentium Pro stepping 07
calibrating APIC timer ... 
..... CPU clock speed is 199.3162 MHz.
..... APIC bus clock speed is 66.4385 MHz.
Booting processor 0 eip 2000
Calibrating delay loop... 199.07 BogoMIPS
OK.
CPU0: Intel Pentium Pro stepping 07
Total of 2 processors activated (397.72 BogoMIPS).
enabling symmetric IO mode... ...done.
ENABLING IO-APIC IRQs
init IO_APIC IRQs
 IO-APIC pin 0, 16, 20, 21, 22, 23 not connected.
number of MP IRQ sources: 19.
number of IO-APIC registers: 24.
testing the IO APIC.......................
.... register #00: 02000000
.......    : physical APIC id: 02
.... register #01: 00170011
.......     : max redirection entries: 0017
.......     : IO APIC version: 0011
.... register #02: 00000000
.......     : arbitration: 00
.... IRQ redirection table:
 NR Log Phy Mask Trig IRR Pol Stat Dest Deli Vect:   
 00 000 00  1    0    0   0   0    0    0    00
 01 000 00  0    0    0   0   0    1    1    59
 02 0FF 0F  0    0    0   0   0    1    1    51
 03 000 00  0    0    0   0   0    1    1    61
 04 000 00  0    0    0   0   0    1    1    69
 05 000 00  0    0    0   0   0    1    1    71
 06 000 00  0    0    0   0   0    1    1    79
 07 000 00  0    0    0   0   0    1    1    81
 08 000 00  0    0    0   0   0    1    1    89
 09 000 00  0    0    0   0   0    1    1    91
 0a 000 00  0    0    0   0   0    1    1    99
 0b 000 00  0    0    0   0   0    1    1    A1
 0c 000 00  0    0    0   0   0    1    1    A9
 0d 000 00  1    0    0   0   0    0    0    00
 0e 000 00  0    0    0   0   0    1    1    B1
 0f 000 00  0    0    0   0   0    1    1    B9
 10 000 00  1    0    0   0   0    0    0    00
 11 0FF 0F  1    1    0   1   0    1    1    C1
 12 0FF 0F  1    1    0   1   0    1    1    C9
 13 0FF 0F  1    1    0   1   0    1    1    D1
 14 000 00  1    0    0   0   0    0    0    00
 15 000 00  1    0    0   0   0    0    0    00
 16 000 00  1    0    0   0   0    0    0    00
 17 000 00  1    0    0   0   0    0    0    00
IRQ to pin mappings:
IRQ0 -> 2
IRQ1 -> 1
IRQ3 -> 3
IRQ4 -> 4
IRQ5 -> 5
IRQ6 -> 6
IRQ7 -> 7
IRQ8 -> 8
IRQ9 -> 9
IRQ10 -> 10
IRQ11 -> 11
IRQ12 -> 12
IRQ13 -> 13
IRQ14 -> 14
IRQ15 -> 15
IRQ17 -> 17
IRQ18 -> 18
IRQ19 -> 19
.................................... done.
PCI: PCI BIOS revision 2.10 entry at 0xfd9de
PCI: Using configuration type 1
PCI: Probing PCI hardware
PCI->APIC IRQ transform: (B0,I15,P0) -> 19
PCI->APIC IRQ transform: (B0,I16,P0) -> 18
PCI->APIC IRQ transform: (B0,I17,P0) -> 17
PCI: 00:00 [8086/1237]: Passive release enable (00)
Linux NET4.0 for Linux 2.2
Based upon Swansea University Computer Society NET3.039
NET4: Unix domain sockets 1.0 for Linux NET4.0.
NET4: Linux TCP/IP 1.0 for NET4.0
IP Protocols: ICMP, UDP, TCP, IGMP
Linux IP multicast router 0.06 plus PIM-SM
Initializing RT netlink socket
Starting kswapd v 1.5 
pty: 256 Unix98 ptys configured
apm: BIOS not found.
Real Time Clock Driver v1.09
PIIX3: IDE controller on PCI bus 00 dev 39
PIIX3: device not capable of full native PCI mode
PIIX3: device disabled (BIOS)
md driver 0.36.6 MAX_MD_DEV=4, MAX_REAL=8
(scsi0) <Adaptec AHA-294X Ultra2 SCSI host adapter> found at PCI 17/0
(scsi0) Wide Channel, SCSI ID=7, 32/255 SCBs
(scsi0) Downloading sequencer code... 407 instructions downloaded
scsi0 : Adaptec AHA274x/284x/294x (EISA/VLB/PCI-Fast SCSI) 5.1.10/3.2.4
       <Adaptec AHA-294X Ultra2 SCSI host adapter>
scsi : 1 host.
  Vendor: SEAGATE   Model: ST32171N          Rev: 0280
  Type:   Direct-Access                      ANSI SCSI revision: 02
Detected scsi disk sda at scsi0, channel 0, id 0, lun 0
  Vendor: SEAGATE   Model: ST19101W          Rev: 0014
  Type:   Direct-Access                      ANSI SCSI revision: 02
Detected scsi disk sdb at scsi0, channel 0, id 1, lun 0
  Vendor: SEAGATE   Model: ST34371N          Rev: 0338
  Type:   Direct-Access                      ANSI SCSI revision: 02
Detected scsi disk sdc at scsi0, channel 0, id 2, lun 0
  Vendor: SEAGATE   Model: ST34371N          Rev: 0280
  Type:   Direct-Access                      ANSI SCSI revision: 02
Detected scsi disk sdd at scsi0, channel 0, id 3, lun 0
  Vendor: iomega    Model: jaz 1GB           Rev: H.72
  Type:   Direct-Access                      ANSI SCSI revision: 02
Detected scsi removable disk sde at scsi0, channel 0, id 4, lun 0
  Vendor: PLEXTOR   Model: CD-ROM PX-12CS    Rev: 1.00
  Type:   CD-ROM                             ANSI SCSI revision: 02
scsi : detected 5 SCSI disks total.
(scsi0:0:0:0) Synchronous at 20.0 Mbyte/sec, offset 15.
SCSI device sda: hdwr sector= 512 bytes. Sectors= 4222640 [2061 MB] [2.1 GB]
(scsi0:0:1:0) Synchronous at 40.0 Mbyte/sec, offset 15.
SCSI device sdb: hdwr sector= 512 bytes. Sectors= 17783240 [8683 MB] [8.7 GB]
(scsi0:0:2:0) Synchronous at 20.0 Mbyte/sec, offset 15.
SCSI device sdc: hdwr sector= 512 bytes. Sectors= 8496960 [4148 MB] [4.1 GB]
(scsi0:0:3:0) Synchronous at 20.0 Mbyte/sec, offset 15.
SCSI device sdd: hdwr sector= 512 bytes. Sectors= 8496960 [4148 MB] [4.1 GB]
(scsi0:0:4:0) Synchronous at 10.0 Mbyte/sec, offset 15.
SCSI device sde: hdwr sector= 512 bytes. Sectors= 2091050 [1021 MB] [1.0 GB]
sde: Write Protect is off
Partition check:
 sda: sda1
 sdb: sdb1 sdb2 sdb3
 sdc: sdc1 sdc4
 sdd:
 sde: sde4
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 44k freed
Adding Swap: 130748k swap-space (priority 1)
Adding Swap: 128516k swap-space (priority 2)
Serial driver version 4.27 with SHARE_IRQ enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
3c59x.c:v0.99H 11/17/98 Donald Becker 
http://cesdis.gsfc.nasa.gov/linux/drivers/vortex.html
eth0: 3Com 3c595 Vortex 100baseTx at 0xece0,  00:60:97:53:e7:1f, IRQ 18
  Internal config register is 141001b, transceivers 0xe10a.
  64K word-wide RAM 3:1 Rx:Tx split, autoselect/100baseTX interface.
eth0: Overriding PCI latency timer (CFLT) setting of 64, new value is 248.
eth0: Initial media type 100baseTX.
eth0: vortex_open() InternalConfig 0141001b.
eth0: vortex_open() irq 18 media status 8802.
eth0: Media selection timer tick happened, 100baseTX.
eth0: Media 100baseTX has link beat, 8882.
eth0: Media selection timer finished, 100baseTX.
nfsd_init: initialized fhcache, entries=256
nfsd_init: initialized fhcache, entries=256
eth0: Transmit error, Tx status register 90.
eth0: Transmit error, Tx status register 90.
eth0: Transmit error, Tx status register 90.
eth0: Transmit error, Tx status register c0.
eth0: Transmit error, Tx status register c0.
eth0: Transmit error, Tx status register c0.
Socket destroy delayed (r=0 w=384)