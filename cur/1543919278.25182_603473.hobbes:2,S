Date: Wed, 10 Oct 2007 10:49:35 -0400
From: Gregory Haskins <>
Subject: [PATCH] RT: Fix special-case exception for preempting the local CPU
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/10/101

Applies to 2.6.23-rc9-rt2...  This is another RTO related fix from the thread
two days ago.
---
RT: Fix special-case exception for preempting the local CPU
Check whether the local CPU is eligible to take the task before trying to
preempt it.
Signed-off-by: Gregory Haskins <ghaskins@novell.com>
---
 kernel/sched.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)
diff --git a/kernel/sched.c b/kernel/sched.c
index 3e75c62..b7f7a96 100644
--- a/kernel/sched.c
+++ b/kernel/sched.c
@@ -1869,7 +1869,8 @@ out_activate:
 		 * extra locking in this particular case, because
 		 * we are on the current CPU.)
 		 */
-		if (TASK_PREEMPTS_CURR(p, this_rq))
+		if (TASK_PREEMPTS_CURR(p, this_rq)
+		    && cpu_isset(this_cpu, p->cpus_allowed))
 			set_tsk_need_resched(this_rq->curr);
 		else
 			/*
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/