Date: Mon, 28 May 2007 06:34:36 +0400
From: Andrey Borzenkov <>
Subject: 2.6.22-rc3: regression: make M=$PWD modules_install does nothing
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/27/190

This has been working up and including -rc2:
{pts/1}% sudo make -C ~/src/linux-git O=$HOME/build/linux-2.6.22 M=PWD V=1 
modules_install
make: Entering directory `/home/bor/src/linux-git'
make -C /home/bor/build/linux-2.6.22 \
        KBUILD_SRC=/home/bor/src/linux-git \
        KBUILD_EXTMOD="PWD" -f /home/bor/src/linux-git/Makefile 
modules_install
test -e include/linux/autoconf.h -a -e include/config/auto.conf || (           
\
        echo;                                                           \
        echo "  ERROR: Kernel configuration is invalid.";               \
        echo "         include/linux/autoconf.h or include/config/auto.conf 
are missing.";      \
        echo "         Run 'make oldconfig && make prepare' on kernel src to 
fix it.";  \
        echo;                                                           \
        /bin/false)
mkdir -p /lib/modules/2.6.22-rc3-1avb/extra
make -f /home/bor/src/linux-git/scripts/Makefile.modinst
  if [ -r System.map -a -x /sbin/depmod ]; then /sbin/depmod -ae -F System.map  
2.6.22-rc3-1avb; fi
make: Leaving directory `/home/bor/src/linux-git'
Makefile is trivial:
{pts/1}% cat Makefile
#
# Makefile for wlags49_cs_xxx
#
EXTRA_CFLAGS 
+= -I$(src) -I$(src)/include -I$(src)/include/hcf -I$(src)/include/wireless \
                -DBUS_PCMCIA -DUSE_UIL -DUSE_OLD_PARMS -DUSE_WPA \
                -DUSE_WEXT -DWVLAN_49 \
#               -DDBG \
#               -DUSE_PROFILE
obj-m           += wlags49_h1_cs.o
wlags49_h1_cs-y := wl_profile.o \
            wl_sysfs.o \
            wl_wext.o \
            wl_priv.o \
            wl_main.o \
            wl_enc.o \
            wl_util.o \
            wl_netdev.o \
            wl_cs.o \
            mmd.o \
            hcfio.o \
            hcf.o \
            dhf.o \
            sta_h1.o \
            ap_h1.o
ifndef src
src = .
endif
foo: foo.c hcf.h dhf.h hcfdef.h sta_h1.c
        $(CC) -o foo $(EXTRA_CFLAGS) foo.c
[unhandled content-type:application/pgp-signature]