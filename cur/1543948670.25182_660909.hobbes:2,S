Date: Thu, 28 Feb 2008 08:26:13 +0000
From: Ian Campbell <>
Subject: [PATCH 1/2] x86: Add nodmi command line option to turn off DMI parsing.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/28/67

Signed-off-by: Ian Campbell <ijc@hellion.org.uk>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: Ingo Molnar <mingo@redhat.com>
Cc: H. Peter Anvin <hpa@zytor.com>
Cc: Jeremy Fitzhardinge <jeremy@goop.org>
Cc: Mark McLoughlin <markmc@redhat.com>
---
 drivers/firmware/dmi_scan.c |   12 ++++++++++++
 1 files changed, 12 insertions(+), 0 deletions(-)
diff --git a/drivers/firmware/dmi_scan.c b/drivers/firmware/dmi_scan.c
index 4072449..62b6200 100644
--- a/drivers/firmware/dmi_scan.c
+++ b/drivers/firmware/dmi_scan.c
@@ -117,6 +117,12 @@ static int __init dmi_checksum(const u8 *buf)
 static char *dmi_ident[DMI_STRING_MAX];
 static LIST_HEAD(dmi_devices);
 int dmi_available;
+static int __init setup_disable_dmi(char *str)
+{
+	dmi_available = -1;
+	return 0;
+}
+early_param("nodmi", setup_disable_dmi);
 
 /*
  *	Save a DMI string
@@ -359,6 +365,12 @@ void __init dmi_scan_machine(void)
 	char __iomem *p, *q;
 	int rc;
 
+	if (dmi_available < 0) {
+		printk(KERN_INFO "DMI disabled.\n");
+		dmi_available = 0;
+		return;
+	}
+
 	if (efi_enabled) {
 		if (efi.smbios == EFI_INVALID_TABLE_ADDR)
 			goto out;
-- 
1.5.4.2