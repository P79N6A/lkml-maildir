Date: Fri, 15 Jun 2007 09:52:53 +0400
From: Evgeniy Polyakov <>
Subject: Re: w1_therm_read_bin: suspicious usage of flush_signals()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/15/24

On Thu, Jun 14, 2007 at 10:10:07PM -0700, Roland McGrath (roland@redhat.com) wrote:
> > Well, it can be uninterruptible sleep, but why?
> > It is not allowed to return to userspace until transaction is completed,
> > so having uninterruptible sleep will result in exactly same lost of
> > signals.
> 
> Delay, not loss.
Yep, you are right. I missed that state checks are performed after
signal was queued.
I've chcked other usage of signals in w1 and they are only related to
the control thread and unloading time when signals are used only to 
indicate that another check must be performed.
This patch resolves the issue with reading from temperature sensor.
Thanks for pointing to that issue.
Signed-off-by: Evgeniy Polyakov <johnpol@2ka.mipt.ru>
diff --git a/drivers/w1/slaves/w1_therm.c b/drivers/w1/slaves/w1_therm.c
index 732db47..1a6937d 100644
--- a/drivers/w1/slaves/w1_therm.c
+++ b/drivers/w1/slaves/w1_therm.c
@@ -191,11 +191,7 @@ static ssize_t w1_therm_read_bin(struct kobject *kobj, char *buf, loff_t off, si
 
 			w1_write_8(dev, W1_CONVERT_TEMP);
 
-			while (tm) {
-				tm = msleep_interruptible(tm);
-				if (signal_pending(current))
-					flush_signals(current);
-			}
+			msleep(tm);
 
 			if (!w1_reset_select_slave(sl)) {
 
Signed-
-- 
	Evgeniy Polyakov
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/