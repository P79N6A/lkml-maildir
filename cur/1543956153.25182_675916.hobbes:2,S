Date: Fri, 4 Apr 2008 19:13:50 +0200
From: Pierre Ossman <>
Subject: pci: add to global list before sysfs?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/4/4/251

Hi Greg,
I have a PCI hotplug problem I was hoping you could provide some
insight into.
I want the PCI layer to make sure that all subfunctions of a newly
added card are visible via pci_get_device() before any of them are
binded to drivers. I.e. I want pci_bus_add_devices() to first make a
pass and add the devices to the global list, then a second pass for
device_add().
The reason I want this is because I have at least two chips where I
need to know which other subfunctions are present on the card in order
to correctly initalise the subfunction I'm currently probing. Right now
that fails miserably as the driver does not see the other devices in
its probe function.
Is it possible to do this or will things break left and right if I
add them to the global list before I register them with the driver core?
Rgds
-- 
     -- Pierre Ossman
  Linux kernel, MMC maintainer        
http://www.kernel.org
  PulseAudio, core developer          
http://pulseaudio.org
  rdesktop, core developer          
http://www.rdesktop.org