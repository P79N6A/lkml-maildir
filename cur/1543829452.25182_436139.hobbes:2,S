Date: Fri, 23 Jun 2006 12:55:05 +0200
From: Ingo Molnar <>
Subject: Re: [patch 55/61] lock validator: special locking: sb->s_umount
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/6/23/132

* Andrew Morton <akpm@osdl.org> wrote:
> > +++ linux/fs/dcache.c
> > @@ -470,8 +470,9 @@ static void prune_dcache(int count, stru
> >  		s_umount = &dentry->d_sb->s_umount;
> >  		if (down_read_trylock(s_umount)) {
> >  			if (dentry->d_sb->s_root != NULL) {
> > -				prune_one_dentry(dentry);
> > +// lockdep hack: do this better!
> >  				up_read(s_umount);
> > +				prune_one_dentry(dentry);
> >  				continue;
> 
> argh, you broke my kernel!
> 
> I'll whack some ifdefs in here so it's only known-broken if 
> CONFIG_LOCKDEP.
> 
> Again, we'd need the real fix here.
yeah. We should undo this patch for now. This will only be complained 
about if CONFIG_DEBUG_NON_NESTED_UNLOCKS is enabled. [i'll do this in my 
refactored queue]
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/