Date: Sat, 29 Dec 2007 09:20:37 -0600
From: Dave Kleikamp <>
Subject: Re: [PATCH] jfs: clear PAGECACHE_TAG_DIRTY for no-write pages
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/29/68

On Sat, 2007-12-29 at 13:51 +0800, Fengguang Wu wrote:
> On Fri, Dec 28, 2007 at 10:50:59PM -0600, Dave Kleikamp wrote:
> > 
> > On Sat, 2007-12-29 at 10:21 +0800, Fengguang Wu wrote:
> > > This line should be moved below:
> > > > +	set_page_writeback(page);
> > 
> > No.  set_page_writeback() needs to be called before submit_bio() is
> > called.
> 
> Ah yes.
> 
> > I don't think there is any harm in calling set_page_writeback(),
> > redirty_page_for_writeback() and end_page_writeback() in the case where
> > there is no I/O to submit, and some dirty data cannot be written.  It is
> > consistent with what happens in __block_write_full_page().
> > 
> > It's also possible that some part of the page was written, and another
> > part cannot be, causing the page to be redirtied.
> 
> You are right. I revisited the code and there's nothing wrong with
> your patch :-)
Fengguang,
Thank you for all your help with this bug.  I've been on vacation and
hadn't had much time to look at it.  We'd probably still be scratching
our heads wondering where the problem was without your hard work.
Shaggy
> 
> Regards,
> Fengguang
> 
-- 
David Kleikamp
IBM Linux Technology Center