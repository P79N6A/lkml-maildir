Date: Tue, 28 May 2002 13:50:26 +0900
From: Go Taniguchi <>
Subject: [PATCH] fixup pcnet32 workaround xSeries250
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/5/28/2

Hi,
I have sent the update patch for pcnet32 which included the workaround for xSeries250 
on the other day.
However, the workaround has the problem with 79C970A 10M full duplex cards 
which causes the netowrk slowing-down.
To solve this problem, the workaound is set to be turned on for "79C975" only.
Please apply.
-- GO!
--- linux/drivers/net/pcnet32.c.orig	Mon May 27 17:15:12 2002
+++ linux/drivers/net/pcnet32.c	Tue May 28 12:35:29 2002
@@ -847,8 +847,9 @@
 	    if (lp->options == (PCNET32_PORT_FD | PCNET32_PORT_AUI))
 		val |= 2;
 	} else if (lp->options & PCNET32_PORT_ASEL) {
-	/* workaround for xSeries250 */
-	    val |= 3;
+	/* workaround of xSeries250, turn on for 79C975 only */
+	    i = ((lp->a.read_csr(ioaddr, 88) | (lp->a.read_csr(ioaddr,89) << 16)) >> 12) & 0xffff;
+	    if (i == 0x2627) val |= 3;
 	}
 	lp->a.write_bcr (ioaddr, 9, val);
     }
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/