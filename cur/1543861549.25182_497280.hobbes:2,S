Date: Mon, 8 Jan 2007 09:52:46 +0100
From: Jens Axboe <>
Subject: Re: [BUG 2.6.20-rc3-mm1] raid1 mount blocks for ever
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/8/41

On Sat, Jan 06 2007, Torsten Kaiser wrote:
> On Saturday 06 January 2007 11:02, Jens Axboe wrote:
> > On Sat, Jan 06 2007, Torsten Kaiser wrote:
> > > On Saturday 06 January 2007 04:59, Andrew Morton wrote:
> > > > 
http://userweb.kernel.org/~akpm/2.6.20-rc3-mm1x.bz2
 is basically
> > > > 2.6.20-rc3-mm1, minus git-block.patch.  Can you and Torsten please
> > > > test that, see if the hangs go away?
> > >
> > > Works for me too.
> >
> > Torsten, can you test XFS with barriers disabled? I have a feeling that
> > is where the problem lies.
> 
> With your patch from Bug 7775: Same hang detected by NMI watchdog
Does this fix it? Only apply this one, not the patch from 7775.
diff --git a/block/ll_rw_blk.c b/block/ll_rw_blk.c
index ec40e44..bae57e0 100644
--- a/block/ll_rw_blk.c
+++ b/block/ll_rw_blk.c
@@ -1542,7 +1542,7 @@ static inline void queue_sync_plugs(request_queue_t *q)
 	 * If the current process is plugged and has barriers submitted,
 	 * we will livelock if we don't unplug first.
 	 */
-	blk_unplug_current();
+	blk_replug_current_nested();
 
 	synchronize_qrcu(&q->qrcu);
 }
-- 
Jens Axboe
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/