Date: 02 Aug 2003 11:23:53 +0200
From: Marcel Holtmann <>
Subject: Re: Linux 2.4.22-pre10-ac1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/2/34

Hi Manuel,
> > ccache gcc -D__KERNEL__ -I/home/barryn/lsx/kernels/2.4/build/linux-2.4.22-pre10-ac1/include -Wall -Wstrict-prototypes -Wno-trigraphs -Os -fno-strict-aliasing -fno-common -fomit-frame-pointer -pipe -mpreferred-stack-boundary=2 -march=athlon -DMODULE -DMODVERSIONS -include /home/barryn/lsx/kernels/2.4/build/linux-2.4.22-pre10-ac1/include/linux/modversions.h  -nostdinc -iwithprefix include -DKBUILD_BASENAME=firmware_class  -DEXPORT_SYMTAB -c firmware_class.c
> > firmware_class.c: In function `call_helper':
> > firmware_class.c:78: error: `hotplug_path' undeclared (first use in this function)
> > firmware_class.c:78: error: (Each undeclared identifier is reported only once
> > firmware_class.c:78: error: for each function it appears in.)
> > make[1]: *** [firmware_class.o] Error 1
> > make[1]: Leaving directory `/home/barryn/lsx/kernels/2.4/build/linux-2.4.22-pre10-ac1/lib'
> > make: *** [_mod_lib] Error 2
> [snip]
> > # CONFIG_HOTPLUG is not set
> 
>  CONFIG_HOTPLUG needs to be enabled, attached patch to make it explicit:
your patch didn't fix the problem, because it will be the same if some
internal driver needs request_firmware() and CONFIG_HOTPLUG is not set.
The call_helper() funtcion needs to be put into #idef's.
Regards
Marcel
diff -urN linux-2.4.22-pre10-ac1/lib/firmware_class.c linux-2.4.22-pre10-ac1-reqfrm-hotplug/lib/firmware_class.c
--- linux-2.4.22-pre10-ac1/lib/firmware_class.c	Sat Aug  2 10:50:04 2003
+++ linux-2.4.22-pre10-ac1-reqfrm-hotplug/lib/firmware_class.c	Sat Aug  2 11:21:02 2003
@@ -67,6 +67,8 @@
 static struct proc_dir_entry *proc_dir_timeout;
 static struct proc_dir_entry *proc_dir;
 
+#ifdef CONFIG_HOTPLUG
+
 static int
 call_helper(char *verb, const char *name, const char *device)
 {
@@ -126,7 +128,9 @@
 
 	envp[i++] = 0;
 
+#ifdef  DEBUG
 	dbg("firmware: %s %s %s", argv[0], argv[1], verb);
+#endif
 
 	retval = call_usermodehelper(argv[0], argv, envp);
 	if (retval) {
@@ -137,6 +141,15 @@
 	kfree(envp);
 	return retval;
 }
+#else
+
+static inline int
+call_helper(char *verb, const char *name, const char *device)
+{
+	return -ENOENT;
+}
+
+#endif /* CONFIG_HOTPLUG */
 
 struct firmware_priv {
 	struct completion completion;