Date: Wed, 05 Jul 2006 10:14:20 -0600
From: (Eric W. Biederman)
Subject: Re: [Fastboot] [PATCH] kdump: add a missing notifier before crashing
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/5/140

"Akiyama, Nobuyuki" <akiyama.nobuyuk@jp.fujitsu.com> writes:
> Hi all,
>
> The attached patch adds a missing notifier before crashing.
NAK
It's not missing.  It should not exist.
> This patch is remade for 2.6.17-git22.
> I tested this patch on a i386-box.
>
> Please refer to the previous discussions for details:
> 
http://lists.osdl.org/pipermail/fastboot/2006-May/003018.html
> 
http://lists.osdl.org/pipermail/fastboot/2006-June/003113.html
>
> Description:
> We don't have a simple and light weight way to know the
> kernel dies. The panic notifier does not be called if kdump
> is activated because crash_kexec() does not return,
> and there is no mechanism to notify of a crash before
> crashing by SysRq-c.
> Although notify_die() exists, but the function depends on
> architecture. If notify_die() is added in panic and SysRq
> respectively like existing implementation, the code will be
> very ugly. I think that adding a generic hook in crash_kexec()
> is better to simplify the code.
>
> For example, the clustering system can take advantage of this
> notifier. On a mission critical system, failover needs to start
> within a few milli-second. The notifier could be called on
> 2nd kernel, but it is no use because it takes the time of
> second order to boot up.
>
> On an actual system, the notifier turns off HBA's power to
> stop accessing shared disk, and then notifies standby node
> that the current node died. 
And again NAK.
Just call the stupid HBA routine directly if this is necessary.
The call can compile to nothing when you HBA is not compiled in.
This is completely unacceptable until we see the code that you are
calling.
If we do export your notifier list it needs to be at least a
GPL only export as this is very much in the guts of the kernel.
As written this seriously destabilizes the kexec on panic support.
I will happy to have a solution to this problem but not this solution.
Especially not without an in-kernel user.
Nacked-by: Eric Biederman <ebiederm@xmission.com>
Eric
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/