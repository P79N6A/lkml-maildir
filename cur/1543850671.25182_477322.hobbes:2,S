Date: Sun, 29 Oct 2006 15:17:06 +0100
From: Daniel Paschka <>
Subject: IDE lost interrupt with 2.6.18
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/29/49

I have finally had time to upgrade my older box to 2.6.18.1. After
booting I got a message about disabling IRQ #15 making it impossible to
access my harddrive connected to the secondary IDE port.
I tried different kernelversions. The problem started with 2.6.18-rc5
(rc4 was the last one which was ok).
Starting with the irqpoll option made the drive work again, but I have
still a disabling IRQ message in the log.
Looking into /proc/interrupt shows over 90000 IRQs for interruptline 15
directly after booting.
Attached a dmesg and an output of lspci.
00:00.0 Host bridge: VIA Technologies, Inc. VT82C598 [Apollo MVP3] (rev 04)
	Flags: bus master, medium devsel, latency 16
	Memory at e0000000 (32-bit, prefetchable) [size=64M]
	Capabilities: <available only to root>
00:01.0 PCI bridge: VIA Technologies, Inc. VT82C598/694x [Apollo MVP3/Pro133x AGP] (prog-if 00 [Normal decode])
	Flags: bus master, 66Mhz, medium devsel, latency 0
	Bus: primary=00, secondary=01, subordinate=01, sec-latency=0
	I/O behind bridge: 0000d000-0000dfff
00:07.0 ISA bridge: VIA Technologies, Inc. VT82C586/A/B PCI-to-ISA [Apollo VP] (rev 47)
	Subsystem: VIA Technologies, Inc. MVP3 ISA Bridge
	Flags: bus master, stepping, medium devsel, latency 0
00:07.1 IDE interface: VIA Technologies, Inc. VT82C586A/B/VT82C686/A/B/VT823x/A/C PIPC Bus Master IDE (rev 06) (prog-if 8a [Master SecP PriP])
	Flags: bus master, medium devsel, latency 64
	I/O ports at e000 [size=16]
00:07.2 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1.1 Controller (rev 02) (prog-if 00 [UHCI])
	Subsystem: VIA Technologies, Inc. (Wrong ID) USB Controller
	Flags: bus master, medium devsel, latency 64, IRQ 11
	I/O ports at e400 [size=32]
00:07.3 Host bridge: VIA Technologies, Inc. VT82C586B ACPI (rev 10)
	Flags: medium devsel
00:11.0 Multimedia controller: Philips Semiconductors SAA7146 (rev 01)
	Subsystem: Technotrend Systemtechnik GmbH Technotrend-Budget / Hauppauge WinTV-NOVA-S DVB card
	Flags: bus master, medium devsel, latency 64, IRQ 10
	Memory at e6000000 (32-bit, non-prefetchable) [size=512]
00:12.0 Ethernet controller: 3Com Corporation 3c905B 100BaseTX [Cyclone] (rev 24)
	Subsystem: 3Com Corporation 3C905B Fast Etherlink XL 10/100
	Flags: bus master, medium devsel, latency 64, IRQ 5
	I/O ports at e800 [size=128]
	Memory at e6002000 (32-bit, non-prefetchable) [size=128]
	Expansion ROM at e4000000 [disabled] [size=128K]
	Capabilities: <available only to root>
00:13.0 Ethernet controller: 3Com Corporation 3c905C-TX/TX-M [Tornado] (rev 74)
	Subsystem: 3Com Corporation 3C905C-TX Fast Etherlink for PC Management NIC
	Flags: bus master, medium devsel, latency 64, IRQ 9
	I/O ports at ec00 [size=128]
	Memory at e6001000 (32-bit, non-prefetchable) [size=128]
	Expansion ROM at e5000000 [disabled] [size=128K]
	Capabilities: <available only to root>
00:14.0 USB Controller: ALi Corporation USB 1.1 Controller (rev 03) (prog-if 10 [OHCI])
	Subsystem: ALi Corporation USB 1.1 Controller
	Flags: bus master, 66Mhz, medium devsel, latency 64, IRQ 10
	Memory at e6003000 (32-bit, non-prefetchable) [size=4K]
	Capabilities: <available only to root>
00:14.1 USB Controller: ALi Corporation USB 1.1 Controller (rev 03) (prog-if 10 [OHCI])
	Subsystem: ALi Corporation USB 1.1 Controller
	Flags: bus master, 66Mhz, medium devsel, latency 64, IRQ 5
	Memory at e6004000 (32-bit, non-prefetchable) [size=4K]
	Capabilities: <available only to root>
00:14.2 USB Controller: ALi Corporation USB 1.1 Controller (rev 03) (prog-if 10 [OHCI])
	Subsystem: ALi Corporation USB 1.1 Controller
	Flags: bus master, 66Mhz, medium devsel, latency 64, IRQ 9
	Memory at e6005000 (32-bit, non-prefetchable) [size=4K]
	Capabilities: <available only to root>
00:14.3 USB Controller: ALi Corporation USB 2.0 Controller (rev 01) (prog-if 20 [EHCI])
	Subsystem: ALi Corporation: Unknown device 5272
	Flags: bus master, 66Mhz, medium devsel, latency 64, IRQ 11
	Memory at e6006000 (32-bit, non-prefetchable) [size=256]
	Capabilities: <available only to root>
Linux version 2.6.18.1 (root@willow.de) (gcc version 4.0.0 20050423 (Red Hat 4.0.0-2)) #7 Sun Oct 29 13:53:40 CET 2006
BIOS-provided physical RAM map:
 BIOS-e820: 0000000000000000 - 00000000000a0000 (usable)
 BIOS-e820: 00000000000f0000 - 0000000000100000 (reserved)
 BIOS-e820: 0000000000100000 - 0000000014000000 (usable)
 BIOS-e820: 00000000ffff0000 - 0000000100000000 (reserved)
320MB LOWMEM available.
On node 0 totalpages: 81920
  DMA zone: 4096 pages, LIFO batch:0
  Normal zone: 77824 pages, LIFO batch:15
DMI 2.1 present.
ACPI: Unable to locate RSDP
Allocating PCI resources starting at 20000000 (gap: 14000000:ebff0000)
Detected 400.998 MHz processor.
Built 1 zonelists.  Total pages: 81920
Kernel command line: BOOT_IMAGE=2.6.18.1poll root=801 ide2=noprobe ide3=noprobe ide4=noprobe ide5=noprobe ro root=/dev/sda1 usb-storage.delay_use=0 irqpoll
ide_setup: ide2=noprobe
ide_setup: ide3=noprobe
ide_setup: ide4=noprobe
ide_setup: ide5=noprobe
Misrouted IRQ fixup and polling support enabled
This may significantly impact system performance
Initializing CPU#0
PID hash table entries: 2048 (order: 11, 8192 bytes)
Console: colour VGA+ 80x25
Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)
Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)
Memory: 321460k/327680k available (1696k kernel code, 5736k reserved, 635k data, 204k init, 0k highmem)
Checking if this processor honours the WP bit even in supervisor mode... Ok.
Calibrating delay using timer specific routine.. 802.62 BogoMIPS (lpj=1605255)
Mount-cache hash table entries: 512
CPU: After generic identify, caps: 008021bf 808029bf 00000000 00000000 00000000 00000000 00000000
CPU: After vendor identify, caps: 008021bf 808029bf 00000000 00000000 00000000 00000000 00000000
CPU: L1 I Cache: 32K (32 bytes/line), D cache 32K (32 bytes/line)
CPU: After all inits, caps: 008021bf 808029bf 00000000 00000002 00000000 00000000 00000000
CPU: AMD-K6(tm) 3D processor stepping 0c
Checking 'hlt' instruction... OK.
NET: Registered protocol family 16
EISA bus registered
PCI: PCI BIOS revision 2.10 entry at 0xfb3c0, last bus=1
PCI: Using configuration type 1
Setting up standard PCI resources
ACPI: Interpreter disabled.
SCSI subsystem initialized
usbcore: registered new driver usbfs
usbcore: registered new driver hub
PCI: Probing PCI hardware
PCI: Probing PCI hardware (bus 00)
PCI quirk: region 4000-40ff claimed by vt82c586 ACPI
PCI: Using IRQ router VIA [1106/0586] at 0000:00:07.0
PCI: Bridge: 0000:00:01.0
  IO window: d000-dfff
  MEM window: disabled.
  PREFETCH window: disabled.
PCI: Setting latency timer of device 0000:00:01.0 to 64
NET: Registered protocol family 2
IP route cache hash table entries: 4096 (order: 2, 16384 bytes)
TCP established hash table entries: 16384 (order: 4, 65536 bytes)
TCP bind hash table entries: 8192 (order: 3, 32768 bytes)
TCP: Hash tables configured (established 16384 bind 8192)
TCP reno registered
Initializing Cryptographic API
io scheduler noop registered
io scheduler deadline registered (default)
Activating ISA DMA hang workarounds.
Real Time Clock Driver v1.12ac
loop: loaded (max 8 devices)
PCI: setting IRQ 5 as level-triggered
PCI: Found IRQ 5 for device 0000:00:12.0
PCI: Sharing IRQ 5 with 0000:00:14.1
3c59x: Donald Becker and others. www.scyld.com/network/vortex.html
0000:00:12.0: 3Com PCI 3c905B Cyclone 100baseTx at d4800000.
PCI: setting IRQ 9 as level-triggered
PCI: Found IRQ 9 for device 0000:00:13.0
PCI: Sharing IRQ 9 with 0000:00:14.2
0000:00:13.0: 3Com PCI 3c905C Tornado at d4802000.
PPP generic driver version 2.4.2
PPP Deflate Compression module registered
PPP BSD Compression module registered
NET: Registered protocol family 24
Linux video capture interface: v2.00
saa7146: register extension 'budget dvb'.
PCI: setting IRQ 10 as level-triggered
PCI: Found IRQ 10 for device 0000:00:11.0
PCI: Sharing IRQ 10 with 0000:00:14.0
saa7146: found saa7146 @ mem d4804000 (revision 1, irq 10) (0x13c2,0x1003).
saa7146 (0): dma buffer size 192512
DVB: registering new adapter (TT-Budget/WinTV-NOVA-S  PCI).
adapter has MAC addr = 00:d0:5c:1f:c0:b6
DVB: registering frontend 0 (ST STV0299 DVB-S)...
Uniform Multi-Platform E-IDE driver Revision: 7.00alpha2
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
VP_IDE: IDE controller at PCI slot 0000:00:07.1
VP_IDE: chipset revision 6
VP_IDE: not 100% native mode: will probe irqs later
VP_IDE: VIA vt82c586b (rev 47) IDE UDMA33 controller on pci0000:00:07.1
    ide0: BM-DMA at 0xe000-0xe007, BIOS settings: hda:DMA, hdb:DMA
    ide1: BM-DMA at 0xe008-0xe00f, BIOS settings: hdc:DMA, hdd:DMA
Probing IDE interface ide0...
hda: ExcelStor Technology J360, ATA DISK drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
Probing IDE interface ide1...
hdc: Maxtor 6Y160L0, ATA DISK drive
ide1 at 0x170-0x177,0x376 on irq 15
hda: max request size: 512KiB
hda: 120103200 sectors (61492 MB) w/1821KiB Cache, CHS=16383/255/63, UDMA(33)
hda: cache flushes supported
 hda: hda1 hda2
hdc: max request size: 512KiB
hdc: 320173056 sectors (163928 MB) w/2048KiB Cache, CHS=19929/255/63, UDMA(33)
hdc: cache flushes supported
 hdc: hdc1
usbmon: debugfs is not available
PCI: setting IRQ 15 as level-triggered
PCI: Found IRQ 15 for device 0000:00:14.3
IRQ routing conflict for 0000:00:07.2, have irq 11, want irq 15
IRQ routing conflict for 0000:00:14.3, have irq 11, want irq 15
ehci_hcd 0000:00:14.3: EHCI Host Controller
ehci_hcd 0000:00:14.3: new USB bus registered, assigned bus number 1
ehci_hcd 0000:00:14.3: debug port 1
ehci_hcd 0000:00:14.3: irq 11, io mem 0xe6006000
ehci_hcd 0000:00:14.3: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 6 ports detected
USB Universal Host Controller Interface driver v3.0
PCI: Found IRQ 15 for device 0000:00:07.2
IRQ routing conflict for 0000:00:07.2, have irq 11, want irq 15
IRQ routing conflict for 0000:00:14.3, have irq 11, want irq 15
uhci_hcd 0000:00:07.2: UHCI Host Controller
uhci_hcd 0000:00:07.2: new USB bus registered, assigned bus number 2
uhci_hcd 0000:00:07.2: irq 11, io base 0x0000e400
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 2 ports detected
Initializing USB Mass Storage driver...
usb 1-2: new high speed USB device using ehci_hcd and address 2
usb 1-2: configuration #1 chosen from 1 choice
scsi0 : SCSI emulation for USB Mass Storage devices
usbcore: registered new driver usb-storage
USB Mass Storage support registered.
usb-storage: device found at 2
  Vendor: USB 2.0   Model: Memory Adapter    Rev:     
  Type:   Direct-Access                      ANSI SCSI revision: 02
serio: i8042 AUX port at 0x60,0x64 irq 12
serio: i8042 KBD port at 0x60,0x64 irq 1
mice: PS/2 mouse device common for all mice
SCSI device sda: 251904 512-byte hdwr sectors (129 MB)
sda: Write Protect is off
sda: Mode Sense: 03 00 00 00
sda: assuming drive cache: write through
input: PC Speaker as /class/input/input0
SCSI device sda: 251904 512-byte hdwr sectors (129 MB)
sda: Write Protect is off
sda: Mode Sense: 03 00 00 00
sda: assuming drive cache: write through
 sda: sda1
EISA: Probing bus 0 at eisa.0
ip_conntrack version 2.4 (2560 buckets, 20480 max) - 204 bytes per conntrack
sd 0:0:0:0: Attached scsi removable disk sda
usb-storage: device scan complete
ip_tables: (C) 2000-2006 Netfilter Core Team
irq 15: nobody cared (try booting with the "irqpoll" option)
 [<c012ba6b>] __report_bad_irq+0x2b/0x69
 [<c012bc32>] note_interrupt+0x189/0x1c3
 [<c012b2b4>] __do_IRQ+0x72/0xa1
 [<c0104297>] do_IRQ+0x40/0x4d
 [<c0102c3a>] common_interrupt+0x1a/0x20
 [<c0101a22>] default_idle+0x31/0x59
 [<c0101a82>] cpu_idle+0x38/0x4d
 [<c034a5f3>] start_kernel+0x246/0x248
handlers:
[<c0219666>] (ide_intr+0x0/0x16e)
Disabling IRQ #15
TCP bic registered
Initializing IPsec netlink socket
NET: Registered protocol family 1
NET: Registered protocol family 17
NET: Registered protocol family 15
Using IPI Shortcut mode
Time: tsc clocksource has been installed.
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 204k freed
input: AT Translated Set 2 keyboard as /class/input/input1
input: AT Translated Set 2 keyboard as /class/input/input2
EXT2-fs warning: mounting unchecked fs, running e2fsck is recommended
ReiserFS: hda2: found reiserfs format "3.6" with standard journal
ReiserFS: hda2: using ordered data mode
ReiserFS: hda2: journal params: device hda2, size 8192, journal first block 18, max trans len 1024, max batch 900, max commit age 30, max trans age 30
ReiserFS: hda2: checking transaction log (hda2)
ReiserFS: hda2: Using r5 hash to sort names
PM: Writing back config space on device 0000:00:12.0 at offset 1 (was 82100007, writing 2100007)
eth0:  setting full-duplex.
PM: Writing back config space on device 0000:00:13.0 at offset 1 (was 82100007, writing 2100007)
dsl0:  setting full-duplex.