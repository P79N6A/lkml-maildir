Date: Tue, 3 Jan 2006 23:16:02 -0800
From: David Brown <>
Subject: Re: 2.6.15-rt1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/4/15

> This patch should fix compilation issues in net/ipv6 subsystem
> w/ rt patch.
>
> Signed-off-by: YOSHIFUJI Hideaki <yoshfuji@linux-ipv6.org>
>
> diff --git a/net/ipv6/mcast.c b/net/ipv6/mcast.c
> index f829a4a..15264f4 100644
> --- a/net/ipv6/mcast.c
> +++ b/net/ipv6/mcast.c
> @@ -224,7 +224,7 @@ int ipv6_sock_mc_join(struct sock *sk, i
>
>         mc_lst->ifindex = dev->ifindex;
>         mc_lst->sfmode = MCAST_EXCLUDE;
> -       mc_lst->sflock = RW_LOCK_UNLOCKED;
> +       mc_lst->sflock = RW_LOCK_UNLOCKED(mc_lst->sflock);
>         mc_lst->sflist = NULL;
>
>         /*
> diff --git a/net/ipv6/netfilter/nf_conntrack_reasm.c b/net/ipv6/netfilter/nf_conntrack_reasm.c
> index c2c52af..bfd7a2b 100644
> --- a/net/ipv6/netfilter/nf_conntrack_reasm.c
> +++ b/net/ipv6/netfilter/nf_conntrack_reasm.c
> @@ -98,7 +98,7 @@ struct nf_ct_frag6_queue
>  #define FRAG6Q_HASHSZ  64
>
>  static struct nf_ct_frag6_queue *nf_ct_frag6_hash[FRAG6Q_HASHSZ];
> -static rwlock_t nf_ct_frag6_lock = RW_LOCK_UNLOCKED;
> +static rwlock_t nf_ct_frag6_lock = RW_LOCK_UNLOCKED(nf_ct_frag6_lock);
>  static u32 nf_ct_frag6_hash_rnd;
>  static LIST_HEAD(nf_ct_frag6_lru_list);
>  int nf_ct_frag6_nqueues = 0;
> @@ -371,7 +371,7 @@ nf_ct_frag6_create(unsigned int hash, u3
>         init_timer(&fq->timer);
>         fq->timer.function = nf_ct_frag6_expire;
>         fq->timer.data = (long) fq;
> -       fq->lock = SPIN_LOCK_UNLOCKED;
> +       fq->lock = SPIN_LOCK_UNLOCKED(fq->lock);
>         atomic_set(&fq->refcnt, 1);
>
>         return nf_ct_frag6_intern(hash, fq);
>
> --
Thanks and the patch worked fine, but I have a question about the
patch submitted to the url...
I created a new patch with the included ipv6 subsystem fix but I'm
getting a smaller patch than what is posted on the website.
$ wc -l patch-2.6.15-rt1
57869 patch-2.6.15-rt1
$ wc -l patch-2.6.15-rt1-1
57156 patch-2.6.15-rt1-1
patch-2.6.15-rt1-1 has the ipv6 patch yet is smaller than the initial
patch. I created the patch using:
$ diff -uprN linux-2.6.15 linux-2.6.15-rt1 > patch-2.6.15-rt1-1
Is this not the way you did it? I noticed different headers in my
patch vs. the patch posted. Really I'm concerned about missing
anything in the patch, considering it's 700+ lines smaller.
- David Brown
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/