Date: Mon, 7 Nov 2005 17:32:00 +0000
From: Chris Boot <>
Subject: 2.6.14-mm1 libata pata_via
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/11/7/185

Hi all,
Since I've only got a DVD drive on good ol' PATA, I thought I'd try  
Alan's latest VIA PATA driver for libata, to see where I got. Well,  
the machine simply doesn't boot, preferring to get stuck after  
detecting the drive. I've tried with and without  
libata.atapi_enabled=1 and get the same result in both cases. Here's  
my log with some SysRq output that might be useful:
[4294671.089000] ACPI: PCI Interrupt Link [ALKA] BIOS reported IRQ  
11, using IRQ 20
[4294671.125000] ACPI: PCI Interrupt Link [ALKA] enabled at IRQ 20
[4294671.159000] ACPI: PCI Interrupt 0000:00:0f.0[B] -> Link [ALKA] - 
 > GSI 20 (level, low) -> IRQ 177
[4294671.196000] PCI: Via IRQ fixup for 0000:00:0f.0, from 11 to 1
[4294671.230000] sata_via 0000:00:0f.0: routed to hard irq line 1
[4294671.264000] ata3: SATA max UDMA/133 cmd 0xB800 ctl 0xBC02 bmdma  
0xC800 irq 177
[4294671.300000] ata4: SATA max UDMA/133 cmd 0xC000 ctl 0xC402 bmdma  
0xC808 irq 177
[4294671.687000] ata3: dev 0 ATA-7, max UDMA/133, 488397168 sectors:  
LBA48
[4294671.722000] ata3: dev 0 configured for UDMA/133
[4294671.754000] scsi2 : sata_via
[4294672.136000] ata4: dev 0 ATA-7, max UDMA/133, 488397168 sectors:  
LBA48
[4294672.172000] ata4: dev 0 configured for UDMA/133
[4294672.203000] scsi3 : sata_via
[4294672.232000]   Vendor: ATA       Model: ST3250823AS       Rev: 3.03
[4294672.267000]   Type:   Direct-Access                      ANSI  
SCSI revision: 05
[4294672.302000]   Vendor: ATA       Model: ST3250823AS       Rev: 3.03
[4294672.338000]   Type:   Direct-Access                      ANSI  
SCSI revision: 05
[4294672.373000] ACPI: PCI Interrupt 0000:00:0f.1[A] -> Link [ALKA] - 
 > GSI 20 (level, low) -> IRQ 177
[4294672.411000] PCI: Via IRQ fixup for 0000:00:0f.1, from 255 to 1
[4294672.446000] ata5: PATA max UDMA/100 cmd 0x1F0 ctl 0x3F6 bmdma  
0xD000 irq 14
[4294672.785000] ata5: dev 0 ATAPI, max UDMA/33
[4295878.655000] SysRq : Show State
[4295878.655000]
[4295878.655000]                                                sibling
[4295878.655000]   task             PC      pid father child younger  
older
[4295878.655000] swapper       D C0374BC0     0     1      0      
2               (L-TLB)
[4295878.655000] c1921d30 0000007b 0000007b c0374bc0 c0117d2d  
00000060 00000286 00000036
[4295878.655000]        c1921d40 00325aa0 6fbe5080 00000000 78be6440  
000f41fb c18fea50 c18feb78
[4295878.655000]        c1921dc8 c1921d64 c1920000 c1921d84 c03285af  
00000000 c18fea50 c0114460
[4295878.655000] Call Trace:
[4295878.655000]  [<c0117d2d>] release_console_sem+0x1d/0xa0
[4295878.655000]  [<c03285af>] wait_for_completion+0x7f/0xd0
[4295878.655000]  [<c0114460>] default_wake_function+0x0/0x10
[4295878.655000]  [<c0215e09>] __delay+0x9/0x10
[4295878.655000]  [<c0114460>] default_wake_function+0x0/0x10
[4295878.655000]  [<c0298ecf>] ata_dev_identify+0xbf/0x560
[4295878.655000]  [<c0299463>] ata_bus_probe+0x33/0xc0
[4295878.655000]  [<c029d07a>] ata_device_add+0x1ca/0x200
[4295878.655000]  [<c029d7ae>] ata_pci_init_one+0x39e/0x3b0
[4295878.655000]  [<c02d2549>] pci_read+0x29/0x30
[4295878.655000]  [<c02a14d3>] via_init_one+0x123/0x290
[4295878.655000]  [<c021beea>] pci_call_probe+0xa/0x10
[4295878.655000]  [<c021bf3e>] __pci_device_probe+0x4e/0x60
[4295878.655000]  [<c021bf76>] pci_device_probe+0x26/0x60
[4295878.655000]  [<c027bed3>] driver_probe_device+0x33/0xc0
[4295878.655000]  [<c027c03a>] __driver_attach+0x5a/0x60
[4295878.655000]  [<c027b59a>] bus_for_each_dev+0x3a/0x60
[4295878.655000]  [<c027c056>] driver_attach+0x16/0x20
[4295878.655000]  [<c027bfe0>] __driver_attach+0x0/0x60
[4295878.655000]  [<c027ba4b>] bus_add_driver+0x7b/0xd0
[4295878.655000]  [<c027c44f>] driver_register+0x2f/0x40
[4295878.655000]  [<c021c1d5>] __pci_register_driver+0x65/0xa0
[4295878.655000]  [<c0117a27>] printk+0x17/0x20
[4295878.655000]  [<c03ca883>] do_initcalls+0x53/0xb0
[4295878.655000]  [<c03e5445>] netfilter_init+0x65/0x90
[4295878.655000]  [<c0100280>] init+0x0/0x170
[4295878.655000]  [<c0100280>] init+0x0/0x170
[4295878.655000]  [<c01002ba>] init+0x3a/0x170
[4295878.655000]  [<c0100f35>] kernel_thread_helper+0x5/0x10
I've got CONFIG_IDE=n and CONFIG_SCSI_PATA_VIA=y. ata1 and ata2 are  
two other Seagate HDDs on a sata_sil controller. I can provide a full  
dmesg and other details should they be required!
HTH,
Chris
-- 
Chris Boot
bootc@bootc.net
http://www.bootc.net/
[unhandled content-type:application/pkcs7-signature]