Date: Tue, 02 Feb 1999 18:48:36 +0100
From: Jens Axboe <>
Subject: [patch] bug in unregister_proc_table
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/2/2/125

Hi,
This bothered me for some time now and to me it seems like
a bug in the above mentioned function. I won't bother
explaining, it is fairly obvious.
--- virgin/kernel/sysctl.c      Sat Jan  9 07:54:16 1999
+++ linux/kernel/sysctl.c       Tue Feb  2 18:47:43 1999
@@ -559,8 +559,8 @@
                        unregister_proc_table(table->child, de);
                }
                /* Don't unregister proc directories which still have
-                  entries... */
-               if (!((de->mode & S_IFDIR) && de->subdir)) {
+                  entries or are still being used... */
+               if (!((de->mode & S_IFDIR) && de->subdir) && !de->count)
{
                        proc_unregister(root, de->low_ino);
                        table->de = NULL;
                        kfree(de);
-- 
*  Jens Axboe <axboe@image.dk>
*  Linux CD-ROM Maintainer
* "The only thing that interferes with my
*  learning is my education." -- A. Einstein
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/