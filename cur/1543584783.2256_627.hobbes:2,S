Date: Mon, 12 Mar 2001 01:27:38 +0100
From: Petr Vandrovec <>
Subject: Re: VMware 2.0.3 & Kernel 2.4.2-ac17
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/3/11/69

> While compiling the vmnet module, there is a warning
> 
> make: Entering directory `/tmp/vmware-config2/vmnet-only'
> bridge.c: In function `VNetBridgeReceiveFromDev':
> bridge.c:788: warning: implicit declaration of function `skb_datarefp'
> 
> and while inserting the module
> 
> /tmp/vmware-config2/vmnet.o: unresolved symbol skb_datarefp
> 
> I have traced this back to 2.4.2-ac4 by looking for where this function 
> was removed.
Try this patch. I believe that there are no other needed changes
in vmnet code, but as I do not have any scatter-gather checksumming
hardware around, I'm not 100% sure. But up to now nobody complained 
about getting 'xxx invoked with paged skb', so I believe that rest
of code is correct.
diff -u vmnet-only.dist/vnetInt.h vmnet-only/vnetInt.h
--- vmnet-only.dist/vnetInt.h	Thu Nov  2 02:40:20 2000
+++ vmnet-only/vnetInt.h	Mon Mar 12 01:12:00 2001
@@ -16,9 +16,15 @@
 #  define KFREE_SKB(skb, type)		kfree_skb(skb)
 #  define DEV_KFREE_SKB(skb, type)	dev_kfree_skb(skb)
 #  define SKB_INCREF(skb)		atomic_inc(&(skb)->users)
-#  define SKB_IS_CLONE_OF(clone, skb)	( \
-      skb_datarefp(clone) == skb_datarefp(skb) \
-   )
+#  ifdef skb_shinfo
+#    define SKB_IS_CLONE_OF(clone, skb)	( \
+        skb_shinfo(clone) == skb_shinfo(skb) \
+     )
+#  else
+#    define SKB_IS_CLONE_OF(clone, skb)	( \
+        skb_datarefp(clone) == skb_datarefp(skb) \
+     )
+#  endif
 #  define SK_ALLOC(pri)			sk_alloc(0, pri, 1)
 #  define DEV_QUEUE_XMIT(skb, dev, pri)	( \
       (skb)->dev = (dev), \
> yes, technically this probably is OT, and properly belong on the VMware 
> list, but I can't access their nntp server.
Is problem on your side or on VMware side? If on VMware one, I'd like to
know (private pls.).
						Best regards,
							Petr Vandrovec
							vandrove@vc.cvut.cz
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/