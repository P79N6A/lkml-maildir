Date: Tue, 14 Dec 1999 12:52:00 +0100
From: Alain Schroeder <>
Subject: ALSA crashes on SMP (GUS PnP)... Spinlock bug???
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/12/14/51

<intermission>
If this does _only_ belong into ALSA devel please ignore this posting on
linux-kernel-ml... (I send it to both because of 2.3.31 Ooops which says, 
there is a bug in spinlock.h...) Please send flamings to /dev/null or directly
to me...
</intermission>
I have very big Problems using ALSA on my SMP maschine. Things that happen 
depend on the specific kernel:
  2.2.13 SMP - driver loads fine, but maschine crashed as soon as I generate
               any network traffic (ping - using my eepro100) Playing a tune 
	       does result in nothing... See strace... I did not looked into
	       this very far, because 2.3.30-pre6 worked a lot better.
  2.3.31 UP  - Everything works fine
  2.3.31 SMP - The driver loads fine and I can use the mixer (same as 2.2.13),
	       AND there is no crash when I use the network... :))
	       BUT using any player (mpg123, aplay) generates a Ooops because
	       2.3.31 kills the client... (well - it looks that way to me)
--- 2.2.13 - strace mpg123 ---
[...]
open("/dev/snd/pcmC0D0", O_WRONLY)      = 5
ioctl(5, 0x80044100, 0xbffff824)        = 0
close(4)                                = 0
ioctl(5, 0xc01c4110, 0x8080af4)         = 0
ioctl(5, 0x80684102, 0xbffff898)        = 0
ioctl(5, 0xc01c4112, 0xbffff87c)        = 0
ioctl(5, 0xc01c4110, 0x8080af4)         = 0
ioctl(5, 0x80684102, 0xbffff898)        = 0
ioctl(5, 0xc01c4112, 0xbffff87c)        = 0
ioctl(5, 0xc01c4110, 0x8080af4)         = 0
ioctl(5, 0x80684102, 0xbffff898)        = 0
ioctl(5, 0xc01c4112, 0xbffff87c)        = 0
write(5, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 16384) = 16384
write(5, "\322\376\2\377\335\377\216\0\236\0\344\0\211\1\315\1\227"..., 16384) = 16384
write(5, "\313\32\217\32\231\31{\30\362\27\25\30&\31\322\32q\33O"..., 16384) = 16384
write(5, "\221 \373\37\16\37\256\36{\36z\35\260\33\31\32\375\30\241"..., 16384) = 16384
write(5, "J\22\255\21\320\20_\20u\20d\20\344\17h\17.\17\354\16\202"..., 16384) = -1 EIO (Input/output error)
write(5, "\325\1t\366X\354f\355h\370\270\3m\10\353\5\235\376\325"..., 16384) = -1 EIO (Input/output error)
--- 2.3.31 - Ooops ---
eip: d086e88c
kernel BUG at /usr/src/linux/include/asm/spinlock.h:78!
invalid operand: 0000
CPU:    0
EIP:    0010:[<d086e8be>]
EFLAGS: 00010082
eax: 00000038   ebx: cf093ea4   ecx: c021857c   edx: cf361f78
esi: cf093f28   edi: cf093f28   ebp: 00000246   esp: cd3addd4
ds: 0018   es: 0018   ss: 0018
Process mpg123 (pid: 360, stackpage=cd3ad000)
Stack: 0000004e 00000246 cf2cc704 cf2cc5c4 cf093ea4 00000000 cf85e004 00000018 
       cf2cc5c4 00000000 cf85e004 00000018 00000000 d086f195 cf2cc704 00000000 
       cd3adeec cd37cbe0 00000000 cd3ac000 cf093ea4 c0000000 cf85e004 00000000 
Call Trace: [<d086f195>] [<d0870262>] [iget4+331/340] [<d0870556>] [<d08512c1>] [tvecs+28089/38648] [chrdev_open+60/72] 
       [filp_open+207/276] [sys_open+161/556] [system_call+52/56] 
Code: 0f 0b 83 c4 10 90 f0 0f ba 2e 00 0f 82 81 30 00 00 80 4b 3d 
--- 2.3.31 - strace mpg123 ---
open("/dev/snd/controlC0", O_RDWR)      = 3
ioctl(3, 0x80045500, 0xbffff7b8)        = 0
brk(0)                                  = 0x8084750
brk(0x8084770)                          = 0x8084770
brk(0x8085000)                          = 0x8085000
ioctl(3, 0xc0045520, 0xbffff7e8)        = 0
ioctl(3, 0xc004552b, 0xbffff7ec)        = 0
open("/dev/snd/pcmC0D0", O_WRONLY <unfinished ...>
+++ killed by SIGSEGV +++
--- About my System ---
2 P-III (Katmai) on a Tyan Tiger 100
Further Information on 
http://www.lug-owl.de/~schroder/kernel-bug/
  
	Bye,
	  - -- Alain -- -
PS:  System.map ends with c02b0eec...
PPS: gcc version 2.95.2 19991109 (Debian GNU/Linux)
-- 
"This may seem a bit weird, but that's okay, because it is weird."
  				-- Larry Wall in the Perl v5 man page
[unhandled content-type:application/pgp-signature]