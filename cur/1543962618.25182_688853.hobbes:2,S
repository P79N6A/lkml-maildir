Date: Sat, 03 May 2008 09:34:16 -0500
From: Clark Williams <>
Subject: Re: preempt-rt, need old style rwlocks for systemtap
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/5/3/101

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
Frank Ch. Eigler wrote:
> Hi -
> 
> It has come to my attention that the preempt-rt patch suite
> deliberately defeats the potential concurrency intended by systemtap's
> use of rwlocks to permit concurrent readers of various data
> structures.  Since systemtap's probe handlers are all atomic,
> nonblocking, nonpreemptable, it does not seem like there is any
> real-time-oriented benefit in this.  What can we do to work around
> this and permit reader concurrency again in preempt-rt?
> 
The reason it "defeats" the concurrent behavior is that it's really complicated to
have concurrent readers with Priority Inheritance, so the initial cut of rtmutexes
serialized all lock accesses.
Steven has posted a patch for comment (with no takers yet) that implements r/w locks
with concurrent readers and PI. We've just started running it on the MRG RT kernel
with some success, but I wouldn't say that it's ready for prime time.
You're welcome to help test it though...
Clark
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Fedora - 
http://enigmail.mozdev.org
iEYEARECAAYFAkgcd+gACgkQHyuj/+TTEp2JCwCg4ZhqdqHCb9SZM+zrkKcyohtL
2coAoKLyUGZnRKha5NH7UDrM1QsP5ZaE
=FQas
-----END PGP SIGNATURE-----