Date: Mon, 21 Jan 2008 10:22:51 -0500
From: Steven Rostedt <>
Subject: [RFC PATCH 20/23 -v4] Add marker in try_to_wake_up
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/21/146

I looked at what Mathieu Desnoyers did in his LTTng patches
to use as a marker for the wakeup latency timings. But unfortunately,
his marker didn't give me enough information. What I need is the
task pointer itself. I also look at its priority but I need to
keep track of the task itself incase it gets pulled to another
CPU. (and no, I'm not going to hook into the migration code)
I took his marker and added a pointer to p and the pointer
to the current running task on p's runqueue (note it may not
be the same runqueue as current is on).
Signed-off-by: Steven Rostedt <srostedt@redhat.com>
---
 kernel/sched.c |    4 ++++
 1 file changed, 4 insertions(+)
Index: linux-mcount.git/kernel/sched.c
===================================================================
--- linux-mcount.git.orig/kernel/sched.c	2008-01-21 10:03:29.000000000 -0500
+++ linux-mcount.git/kernel/sched.c	2008-01-21 10:05:41.000000000 -0500
@@ -1633,6 +1633,10 @@ out_set_cpu:
 
 out_activate:
 #endif /* CONFIG_SMP */
+	trace_mark(kernel_sched_wakeup,
+		   "p %p rq->curr %p",
+		   p, rq->curr);
+
 	schedstat_inc(p, se.nr_wakeups);
 	if (sync)
 		schedstat_inc(p, se.nr_wakeups_sync);
-- 