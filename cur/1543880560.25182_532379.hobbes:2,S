Date: Thu, 19 Apr 2007 10:19:55 +0200
From: Frank Pavlic <>
Subject: Re: [PATCH] s390/net/lcs: Convert to the kthread API
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/4/19/117

ACK  for both patches,  
thank you Eric for the patches, will add them to my patchset
for Jeff.
Frank
On Thu, Apr 19, 2007 at 01:58:40AM -0600, Eric W. Biederman wrote:
> From: Eric W. Biederman <ebiederm@xmission.com>
> 
> Use kthread_run to start the lcs kernel threads not a
> combination of kernel_thread and daemonize.  This makes
> the code slightly simpler and more maintainable.
> 
> Cc: Frank Pavlic <fpavlic@de.ibm.com>
> Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
> ---
>  drivers/s390/net/lcs.c |    8 +++-----
>  1 files changed, 3 insertions(+), 5 deletions(-)
> 
> diff --git a/drivers/s390/net/lcs.c b/drivers/s390/net/lcs.c
> index 08a994f..0300d87 100644
> --- a/drivers/s390/net/lcs.c
> +++ b/drivers/s390/net/lcs.c
> @@ -36,6 +36,7 @@
>  #include <linux/in.h>
>  #include <linux/igmp.h>
>  #include <linux/delay.h>
> +#include <linux/kthread.h>
>  #include <net/arp.h>
>  #include <net/ip.h>
> 
> @@ -1248,7 +1249,6 @@ lcs_register_mc_addresses(void *data)
>  	struct in_device *in4_dev;
> 
>  	card = (struct lcs_card *) data;
> -	daemonize("regipm");
> 
>  	if (!lcs_do_run_thread(card, LCS_SET_MC_THREAD))
>  		return 0;
> @@ -1728,11 +1728,10 @@ lcs_start_kernel_thread(struct work_struct *work)
>  	struct lcs_card *card = container_of(work, struct lcs_card, kernel_thread_starter);
>  	LCS_DBF_TEXT(5, trace, "krnthrd");
>  	if (lcs_do_start_thread(card, LCS_RECOVERY_THREAD))
> -		kernel_thread(lcs_recovery, (void *) card, SIGCHLD);
> +		kthread_run(lcs_recovery, card, "lcs_recover");
>  #ifdef CONFIG_IP_MULTICAST
>  	if (lcs_do_start_thread(card, LCS_SET_MC_THREAD))
> -		kernel_thread(lcs_register_mc_addresses,
> -				(void *) card, SIGCHLD);
> +		kernel_run(lcs_register_mc_addresses, card, "regipm");
>  #endif
>  }
> 
> @@ -2232,7 +2231,6 @@ lcs_recovery(void *ptr)
>          int rc;
> 
>  	card = (struct lcs_card *) ptr;
> -	daemonize("lcs_recover");
> 
>  	LCS_DBF_TEXT(4, trace, "recover1");
>  	if (!lcs_do_run_thread(card, LCS_RECOVERY_THREAD))
> -- 
> 1.5.0.g53756
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/