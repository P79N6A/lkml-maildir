Date: Fri, 28 Nov 2003 14:59:08 -0200
From: Lucas Correia Villa Real <>
Subject: Re: [SisopIII-l] Re: [PATCH] fix #endif misplacement
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/11/28/67

Hi,
Actually, the original code seems to be ok:
#ifndef CONFIG_NUMA
        if (!use_tsc)
#endif
        return (unsigned long long)jiffies * (1000000000 / HZ);
That is: on x86 we'll get into "#ifndef CONFIG_NUMA", and "if (!use_tsc)" will 
be called, which should be the expected behaviour.
Maybe in your case the use_tsc flag was being set to 0 (bug in detection code 
/ unsupported feature by the processor?), leading your code to ignore the TSC 
and return the current time based on the current jiffies instead.
Lucas
On Friday 28 November 2003 14:39, Felipe W Damasio wrote:
> 	Hi Tim,
>
> Tim Schmielau wrote:
> > No, this is exactly what is intended: don't use the TSC on NUMA, use
> > jiffies instead.
>
> 	The patch didn't hurt this.
>
> > Look at the comment just above those lines.
>
> 	The patch doesn't uses jiffies indiscriminately: Only if we're on a
> NUMA system with !use_tsc.
>
> 	Otherwise (on x86 SMP, for example) we use rdtsc...which seems The
> Right Thing(tm). Hece move the #endif a bit down.
>
> 	Cheers
>
> Felipe
>
> -
> To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  
http://vger.kernel.org/majordomo-info.html
> Please read the FAQ at  
http://www.tux.org/lkml/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/