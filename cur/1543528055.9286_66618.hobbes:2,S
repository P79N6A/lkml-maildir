Date: Wed, 1 Mar 2000 10:25:42 +1100 (EST)
From: Neil Brown <>
Subject: Re: OT: Diagnosing NFS Performance Problem with Retransmission Timeouts
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/2/29/212

On Tuesday February 29, bmccann@indusriver.com wrote:
> Sorry for the off-topic posting, but I have a NFS performance problem that has
> me stumped. I have three PC's:
> 
> 		S
> 	       / \
>               /   \
> 	     C1    C2
> 
> S:  Linux 2.2.13 on Pentium 233 MMX		(NFS Server)
> C1: Linux 2.2.15pre10 on AMD K6-450		(NFS Client)
> C2: Linux 2.2.15pre10 on Pentium 200 MMX	(NFS Client)
> 
> My problem is NFS performance between C1 and S sucks but it works great between
> C2 and S. I'm getting _many_ timeouts between C1 and S and none between C2 and
> S.
> (About 10% of my client RPC calls are timing out according to nfsstat). Note
> the timeouts appear to happen most when I transfer large files. I get hardly
> any when I do something like 'ls -lR' over a large NFS mounted directory tree.
> 
> I thought this could be flaky hardware but TCP performance is fine. For example:
> 
> 	C1 - S (NFS read)	~200 KBytes/Second
> 	C2 - S (NFS read)	~1000 KBytes/Second
> 	C1 - S (FTP get)	~1000 KBytes/Second
> 
> All tests are on a 10baseT network connected via a hub.
> 
> Any ideas on how I can track down the cause of these timeouts? (The timeouts
> are reported via nfsstat). I don't see any other errors reported via 'dmesg'
> or via /var/log/messages on either the server or the client.
These symptoms are exactly symptomatic of a suboptimal network
connection, almost certinaly the network card in your case.
FTP is better than NFS because FTP uses TCP, which is much better at
resending just the lost packets. NFS uses UDP, typically with large
packets that fragment, and has to re-send  all of the fragments.
You can probably improve throughput by mounting with rsize of 1024.
NFS over TCP is nearly working I believe.  It may well be in 2.2.16,
and will almost certianly be in 2.4.
NeilBrown
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/