Date: Tue, 10 Jul 2007 20:26:18 -0400
From: Brian Gerst <>
Subject: Re: [x86 setup 13/33] Header file to produce 16-bit code with gcc
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/10/504

Pawel Dziepak wrote:
> On 7/10/07, Segher Boessenkool <segher@kernel.crashing.org> wrote:
>> > The alternative, of course, is to compile to an .s file and insert
>> > .code16gcc into the .s file.  This makes the Makefile uglier, but
>> > would
>> > be more resilient against oddball gcc changes.
>>
>> This would be even more fragile.  The exact format of GCC's
>> assembler code output isn't defined at all, so in principle
>> this is a hopeless task.  In practice just putting the
>> .code16gcc directive on the first line would likely work
>> though, GCC never generates a .code32 AFAIK, but it isn't
>> guaranteed that this will work (or will keep working).
> 
> Unfortunately, .code16gcc is still experimental (at least binutils'
> website says that). What is worse, it says that it is possible that
> 16bit code produced on GCC won't work on pre-80386 processors (before
> switching to protected mode you have to think about cpu as a
> pre-80386).
What .code16gcc does is produce 32-bit instructions that are meant to be
run from a 16-bit code segment (real mode or 16-bit protected) by using
address and data size override prefixes.  This means that pre-386
processors cannot run the code because they cannot understand 32-bit
instructions.
--
				Brian Gerst
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/