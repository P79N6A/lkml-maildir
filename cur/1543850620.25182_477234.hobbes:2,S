Date: Sat, 28 Oct 2006 12:42:45 -0700
From: 	thockin@hockin ...
Subject: Re: AMD X2 unsynced TSC fix?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/28/144

On Sat, Oct 28, 2006 at 09:32:18PM +0200, Willy Tarreau wrote:
> > Was the problem that they were not synced at poweron or that they would
> > drift due to power-states?
> 
> They resynced at power up, but would constantly drift. I don't even know
> if it was caused by power states. When the machine was loaded, a single
> task moving across the cores could see its time jump back and forth 
> several times a second by an offset sometimes close to +2/-2s.
That sounds like C1, to me.
> > Did you try running with idle=poll, to avoid ever entering C1 state (hlt)?
> 
> Yes, I remember trying such things. I also tried 'nohlt', completely
> disabling power management, including ACPI, etc... I also tried vanilla
> kernels as well as severely patched ones, but the problem remained the
> same in all circumstances, that only 'notsc' could solve.
That's exceedingly strange.  On my dual-socket dual-core, I can get
roughly synced TSCs (no appreciable drift) by just using idle=poll.  If
that did not work for you, I'd really want to poke at the system more.
> BTW, I've just found a remain of dmesg capture after boot in case you'd
> like to look for anything in it.
A dmesg won't be that useful, I'd actually have to poke at the system.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/