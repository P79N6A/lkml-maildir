Date: Sat, 8 Jul 2000 13:22:26 +0200 (MET DST)
From: Mikael Pettersson <>
Subject: [PATCH] compile fixes for 2.4.0-test3-pre6
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/8/24

Here's a couple of patches which fix compilation problems with
2.4.0-test3-pre6 in some configurations.
* drivers/parport/partport_pc.c: sio_via_686a_probe() and
  parport_pc_superio_info are unused if CONFIG_PCI is off.
* drivers/sound/cs4232.c: Module parameter "synthirq" is
  unused if CONFIG_SOUND_WAVEFRONT_MODULE is off.
* fs/fat/fatfs_syms.c: msdos and vfat modules need fat_brelse.
  (Keith Owens' patch not mine.)
* Fixed two declarations of the do_nfsservctl function pointer
  to match fs/nfsd/nfsctl.c:handle_sys_nfsservctl().
/Mikael
--- linux-2.4.0-test3-pre6/drivers/parport/parport_pc.c.~1~	Sat Jul  8 11:30:35 2000
+++ linux-2.4.0-test3-pre6/drivers/parport/parport_pc.c	Sat Jul  8 11:36:24 2000
@@ -2174,7 +2174,7 @@
 	return p;
 }
 
-
+#ifdef CONFIG_PCI
 /* Via support maintained by Jeff Garzik <jgarzik@mandrakesoft.com> */
 static int __devinit sio_via_686a_probe (struct pci_dev *pdev)
 {
@@ -2266,20 +2266,21 @@
 		port1, irq, dma);
 	return 0;
 }
-
+#endif
 
 enum parport_pc_sio_types {
 	sio_via_686a = 0,	/* Via VT82C686A motherboard Super I/O */
 	last_sio
 };
 
+#ifdef CONFIG_PCI
 /* each element directly indexed from enum list, above */
 static struct parport_pc_superio {
 	int (*probe) (struct pci_dev *pdev);
 } parport_pc_superio_info[] __devinitdata = {
 	{ sio_via_686a_probe, },
 };
-
+#endif
 
 enum parport_pc_pci_cards {
 	siig_1s1p_10x_550 = last_sio,
--- linux-2.4.0-test3-pre6/drivers/sound/cs4232.c.~1~	Sat Jul  1 00:14:03 2000
+++ linux-2.4.0-test3-pre6/drivers/sound/cs4232.c	Sat Jul  8 11:38:55 2000
@@ -316,7 +316,9 @@
 static int __initdata mpuio	= -1;
 static int __initdata mpuirq	= -1;
 static int __initdata synthio	= -1;
+#ifdef CONFIG_SOUND_WAVEFRONT_MODULE
 static int __initdata synthirq	= -1;
+#endif
 
 
 MODULE_PARM(io,"i");
@@ -326,7 +328,9 @@
 MODULE_PARM(mpuio,"i");
 MODULE_PARM(mpuirq,"i");
 MODULE_PARM(synthio,"i");
+#ifdef CONFIG_SOUND_WAVEFRONT_MODULE
 MODULE_PARM(synthirq,"i");
+#endif
 
 /*
  *	Install a CS4232 based card. Need to have ad1848 and mpu401
--- linux-2.4.0-test3-pre6/fs/fat/fatfs_syms.c.~1~	Sat Jul  8 11:30:37 2000
+++ linux-2.4.0-test3-pre6/fs/fat/fatfs_syms.c	Sat Jul  8 11:37:15 2000
@@ -42,6 +42,7 @@
 EXPORT_SYMBOL(fat_add_entries);
 EXPORT_SYMBOL(fat_dir_empty);
 EXPORT_SYMBOL(fat_truncate);
+EXPORT_SYMBOL(fat_brelse);
 
 static int __init init_fat_fs(void)
 {
--- linux-2.4.0-test3-pre6/fs/filesystems.c.~1~	Sat Jul  1 00:14:07 2000
+++ linux-2.4.0-test3-pre6/fs/filesystems.c	Sat Jul  8 11:36:24 2000
@@ -50,7 +50,7 @@
 
 #ifndef CONFIG_NFSD
 #ifdef CONFIG_NFSD_MODULE
-int (*do_nfsservctl)(int, void *, void *);
+long (*do_nfsservctl)(int, void *, void *);
 #endif
 long
 asmlinkage sys_nfsservctl(int cmd, void *argp, void *resp)
--- linux-2.4.0-test3-pre6/kernel/ksyms.c.~1~	Sat Jul  8 11:30:40 2000
+++ linux-2.4.0-test3-pre6/kernel/ksyms.c	Sat Jul  8 11:36:24 2000
@@ -56,7 +56,7 @@
 extern int console_loglevel;
 extern void set_device_ro(kdev_t dev,int flag);
 #if !defined(CONFIG_NFSD) && defined(CONFIG_NFSD_MODULE)
-extern int (*do_nfsservctl)(int, void *, void *);
+extern long (*do_nfsservctl)(int, void *, void *);
 #endif
 
 extern void *sys_call_table;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/