Date: Mon, 18 Sep 2000 15:31:12 +0400
From: Yuri Pudgorodsky <>
Subject: Ptrace broken since 2.4.0-test8pre4?...
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/18/13

Hi!
Beeing an active user mode linux user :-) I can say that since
2.4.0-test8 (host kernel) I cannot run uml-linux successfully.
In contrast with popular feeling that "threaded programes screwed
signal handling on test8.", it is actually a  small change to
arch/i386/ptrace.c introduced since test8pre4.
Also, I remember complains from  Andi Kleen noticed that new kernels
break ups (an alternative debugger).
See the following postings -
  
http://kernelnotes.org/lnxlists/linux-kernel/lk_0009_01/msg00265.html
  
http://kernelnotes.org/lnxlists/linux-kernel/lk_0009_01/msg00283.html
resulted in this change -
--- v2.4.0-test7/linux/arch/i386/kernel/ptrace.c Fri Jun 23 21:55:07 2000
+++ linux/arch/i386/kernel/ptrace.c Sat Sep 2 12:00:02 2000
@@ -99,6 +99,11 @@
                case EFL:
                        value &= FLAG_MASK;
                        value |= get_stack_long(child, EFL_OFFSET) & ~FLAG_MASK;
+                       break;
+               case EIP:
+                       /* Mark us as not being in a system call, so that no restart issues happen */
+                       put_stack_long(child, 4*ORIG_EAX - sizeof(struct pt_regs), -1);
+                       break;
        }
        if (regno > GS*4)
                regno -= 2*4;
While I cannot comment on the above change from technical point of view,
it seems the patch breaks more then it cures. Time to consider reversing?
Regards,
Yuri Pudgorodsky
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/