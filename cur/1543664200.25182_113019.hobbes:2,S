Date: Wed, 26 Feb 2003 12:09:22 -0800
From: Janet Morgan <>
Subject: Re: 2.5.62 Oops during nfs mount
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/2/26/214

Trond Myklebust wrote:
> >>>>> " " == Maneesh Soni <maneesh@in.ibm.com> writes:
>
>      > Following patch should fix this problem. I think Trond can say
>      > whether it is correct or not. In my opinion rpc_rmdir should
>      > test for negative dentry after lookup_hash() returns, like
>      > rpc_unlink() does.
>
> No. You are 'fixing' a symptom of a more fundamental
> bug/misunderstanding: lookup_path("") returns no error, and is
> sometimes causing us to remove the top level directory.
> See the 2-line patch I posted yesterday. It should fix the Oops you
> are reporting.
Thanks Trond, your patch below indeed fixed the Oops I reported:
--- linux-2.5.61-up/net/sunrpc/clnt.c.orig      2003-02-15
21:05:02.000000000 +0100
+++ linux-2.5.61-up/net/sunrpc/clnt.c   2003-02-17 19:39:20.000000000
+0100
@@ -208,7 +208,8 @@
                rpcauth_destroy(clnt->cl_auth);
                clnt->cl_auth = NULL;
        }
-       rpc_rmdir(clnt->cl_pathname);
+       if (clnt->cl_pathname[0])
+               rpc_rmdir(clnt->cl_pathname);
        if (clnt->cl_xprt) {
                xprt_destroy(clnt->cl_xprt);
                clnt->cl_xprt = NULL;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/