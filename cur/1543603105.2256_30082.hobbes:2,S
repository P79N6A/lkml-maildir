Date: Mon, 1 Oct 2001 08:35:03 -0700 (PDT)
From: Linus Torvalds <>
Subject: Re: 2.4.11-pre1 oops in bdget()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/10/1/84

On Mon, 1 Oct 2001, Chris Mason wrote:
>
> >>> EIP; c0133664 <bdget+f8/180>   <=====
> > Trace; c0133792 <bd_acquire+26/80>
> > Trace; c0133c16 <blkdev_open+16/b8>
>
> Well, this isn't good, looks like we've already freed something and are
> still using it.  Could you please turn on 'Debug memory allocations' in the
> kernel debugging section of make config, and try to reproduce again?
No, it's actually the thing that Al already warned me about, and I didn't
realize how serious it was.
The thing we oops on is the _old_ blksize_size[] array information for the
floppy, which was loaded as a module and then unloaded - it's ugly that it
doesn't clean up its copy of the blksize_size array, but the real cause
for the problem is that bdget() references it before it has opened the
device.
The (untested) fix is to just remove the line in bdget() that sets
i_blkbits, as the thing is later set correctly in blkdev_get().
		Linus
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/