Date: Mon, 18 Mar 2002 15:03:40 +0100
From: "Martin Schwidefsky" <>
Subject: Re: 2.4.9-pre3 s390 patch for partition code
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/3/18/3

Hi Pete,
>This is a patch that I extracted from a tarball received last week.
>It is said to be failed by Marcelo for 2.4.18, but something is
>need to fix this.
Definitly.
>To that end, I considered pulling ioctls and replacing them with
>reads, but it is too much work. So, I talked to Al Viro
>and secured his help to have ioctl_by_bdev working at check_part()
>time with a proper fix. Before it is available, I suggest we
>push the fs/block_dev.c change into 2.4.19-preX as a stop-gap.
Even worse, you can't replace the ioctls by reads. You need two
pieces of information 1) the number of the label block which is
different for the three formats CMS1, VOL1, and LNX1 and 2) the
geometry of the device to do the calculations for the VOL1 format.
Both informations are only known to the dasd driver. The only
clean way to get them is to "ask" the dasd driver using an ioctl.
The try to be smarter then the dasd driver and do you own reads
to find out what is needed is imho asking for trouble.
>The fs/partitions/ibm.c change from the tarball was useful, but
>I *STRONGLY* disagree with putting so much crap on the stack.
>It may explain why we have so much trouble with stacks on s390:
>they are simply overused. I changed the code to allocate structures
>properly. This should go in regartless of Al's work on ioctl.
I just checked. Its 744 bytes for ibm_partition(). Probably a bit
much ... so you version makes sense.
blue skies,
   Martin
Linux/390 Design & Development, IBM Deutschland Entwicklung GmbH
Schönaicherstr. 220, D-71032 Böblingen, Telefon: 49 - (0)7031 - 16-2247
E-Mail: schwidefsky@de.ibm.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/