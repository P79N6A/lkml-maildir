Date: Tue, 14 Sep 2004 11:51:02 -0400
From: Jeff Garzik <>
Subject: Re: Changes to ide-probe.c in 2.6.9-rc2 causing improper detection
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/9/14/220

Mark Lord wrote:
> One obvious safeguard would be to never use FLUSH_CACHE on any
> drive that lacks UDMA, unless the drive claims to support FLUSH_CACHE.
> 
> That will eliminate all current FLASH memory devices.
I think you're hunting for hueristics, not making a general rule.  IMO 
any assumption that this behavior will always be limited to flash 
devices is a shaky assumption.
Your initial suggestion is probably much better:
> But one could augment it with a check of the ATA revision code,
> and possibly exclude drives that predate the *formal* introduction
> of the FLUSH_CACHE command, unless their IDENTIFY data specifically
> claims to include it. 
That implies my code would become
	if (ata version < 4)
		return not-supported
	if (wbcache-enabled or have-flush-cache or have-flush-cache-ext)
		return supported
	return not-supported
Yes?
Alan, do you still feel that the "wbcache-enabled" test should be removed?
Since wbcache-enabled is more of a hueristic than a formal test, I don't 
mind removing it.
	Jeff
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/