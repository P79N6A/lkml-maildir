Date: Tue, 25 Jan 2000 13:23:23 -0800 (PST)
From: (Scott Lurndal)
Subject: Re: Corruption caused by umount not flushing the buffer cache.  [mail.linux-kernel]
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/1/26/35

------ Forwarded Article <86k6kn$u15rr@fido.engr.sgi.com>
------ From Alan Cox <alan@lxorguk.ukuu.org.uk>
> I know I can get around this by forcing a BLKFLSBUF ioctl to the device after 
> the unmount but this strikes me as a bug in the linux umount semantics which 
> will bite more people than just me as linux enters the SAN arena.
Solve policy problems in user space. If you want a umount to do that put
it in the _application_. I don't want my caches flushing all the time just
because I remount stuff
Alan
------ End of Forwarded Article
Alan, 
   I believe it would be better for the kernel to invalidate the buffers
when the 'umount' system call is issued on a device.   The reasons
I believe this are:
	1) Production users of linux don't remount filesystems.
	2) Most other unix systems will invalidate the buffers
	   upon umount, thus an expectation has been placed into
	   the customers awareness that such behavior would also
	   apply to linux.
	3) A user-space solution is much more error prone.
If there is a weighting of features for production systems 
versus features for developers (specifically kernel developers), 
I'd bias towards production systems - this includes making the
system as bulletproof as possible.
  for your consideration, 
scott lurndal
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/