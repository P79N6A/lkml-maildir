Date: Fri, 21 Sep 2001 11:01:12 +0300
From: VDA <>
Subject: Re: NFS daemons in D state for 2 minutes at shutdown
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/9/21/25

Hello Trond,
Thursday, September 20, 2001, 8:15:21 PM, you wrote:
TM>      > Hi NFS folks, I am still fighting witn nfsd/lockd not dying
TM>      > upon killall5.  (they are stuck in D state for 2 mins and then
TM>      > die with "rpciod: active tasks at shutdown?!" at console)
TM>      > I found out that nfsd and lockd die as expected when I use
TM>      > modified killall5 which do not SIGSTOP all tasks before killing
TM>      > them.
TM> killall5 is a bad idea as a method for killing nfsd/lockd. You are
TM> better off using something more targeted so you can ensure the correct
TM> ordering.
Well, do you mean I must update my shutdown script whenever I install
something new just because this "something new" does not like
standard, well accepted method of signalling apps to exit?
Come on, this sounds like The Wrong Way.
TM> If you kill the portmapper before the nfs/lockd daemons have finished
TM> unregistering their services then the above behaviour is completely
TM> normal.
So, why modified killall5 does the job?
Why not make portmapper+NFS daemons killable by TERM, giving them
the chance to do proper cleanups rather than abrupt KILL?
-- 
Best regards, VDA
mailto:VDA@port.imtp.ilyichevsk.odessa.ua
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/