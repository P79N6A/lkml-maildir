Date: Sat, 02 Jan 1999 17:17:08 +0100
From:  Hakan.Lennestal@cdt ...
Subject: ISDN problem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/2/93

I don't know if there is any use reporting ISDN problems here ?
Anyway, to be able to compile the latest stuff from the cvs archive (as module)
I have to make a small patch:
*** /home/hakan/src/isdn4linux-990102/isdn/drivers/isdn/hisax/callc.c	Sat Jan  2 11:05:15 1999
--- callc.c	Sat Jan  2 12:10:48 1999
***************
*** 109,115 ****
  #include "../avmb1/capicmd.h"  /* this should be moved in a common place */
  
  #ifdef MODULE
! #define MOD_USE_COUNT ((&__this_module)->usecount)
  #endif				/* MODULE */
  
  const char *lli_revision = "$Revision: 2.24 $";
--- 109,115 ----
  #include "../avmb1/capicmd.h"  /* this should be moved in a common place */
  
  #ifdef MODULE
! #define MOD_USE_COUNT ((&__this_module)->uc.usecount)
  #endif				/* MODULE */
  
  const char *lli_revision = "$Revision: 2.24 $";
***************
*** 1866,1872 ****
  #ifdef MODULE
  			if (csta->channel[0].debug & 0x400)
  				HiSax_putstatus(csta, "   LOCK ", "modcnt %lx",
! 					MOD_USE_COUNT);
  #endif				/* MODULE */
  			break;
  		case (ISDN_CMD_UNLOCK):
--- 1866,1872 ----
  #ifdef MODULE
  			if (csta->channel[0].debug & 0x400)
  				HiSax_putstatus(csta, "   LOCK ", "modcnt %lx",
! 					GET_USE_COUNT(&__this_module));
  #endif				/* MODULE */
  			break;
  		case (ISDN_CMD_UNLOCK):
***************
*** 1874,1880 ****
  #ifdef MODULE
  			if (csta->channel[0].debug & 0x400)
  				HiSax_putstatus(csta, " UNLOCK ", "modcnt %lx",
! 					MOD_USE_COUNT);
  #endif				/* MODULE */
  			break;
  		case (ISDN_CMD_IOCTL):
--- 1874,1880 ----
  #ifdef MODULE
  			if (csta->channel[0].debug & 0x400)
  				HiSax_putstatus(csta, " UNLOCK ", "modcnt %lx",
! 					GET_USE_COUNT(&__this_module));
  #endif				/* MODULE */
  			break;
  		case (ISDN_CMD_IOCTL):
***************
*** 1974,1980 ****
  					break;
  #ifdef MODULE
  				case (55):
! 					MOD_USE_COUNT = 0;
  					HiSax_mod_inc_use_count();
  					break;
  #endif				/* MODULE */
--- 1974,1980 ----
  					break;
  #ifdef MODULE
  				case (55):
! 					atomic_set(&MOD_USE_COUNT, 0);
  					HiSax_mod_inc_use_count();
  					break;
  #endif				/* MODULE */
I don't know if the above is correct, but it seem to work.
When running this with the 2.2.0-pre3 kernel there seem to be some routing
problem (not present in 2.1.132-ac2).
The first time a connection is made it works as expected but the second time
I get:
  Jan  2 04:14:42 tuttifrutti ipppd[654]: Remote message:
  Jan  2 04:14:42 tuttifrutti ipppd[654]: MPPP negotiation, He: No We: No
  Jan  2 04:14:42 tuttifrutti ipppd[654]: CCP enabled! Trying CCP.
  Jan  2 04:14:42 tuttifrutti ipppd[654]: CCP: got ccp-unit 0 for link 1 (protocol: 0x80fd)
  Jan  2 04:14:42 tuttifrutti ipppd[654]: ccp_resetci!
  Jan  2 04:14:42 tuttifrutti ipppd[654]: local  IP address xxx.xxx.xxx.xxx
  Jan  2 04:14:42 tuttifrutti ipppd[654]: remote IP address xxx.xxx.xxx.yyy
  Jan  2 04:14:42 tuttifrutti ipppd[654]: ioctl(SIOCADDRT) device route (ippp0/xxx.xxx.xxx.xxx/ffffffff): File exists
And the connection is dead.
Btw, I'm using a Teles 16.3 non-PNP-card.
Regards.
/HÃ¥kan
---------------------------------------
e-mail: Hakan.Lennestal@lu.erisoft.se |
     or Hakan.Lennestal@cdt.luth.se   |
     or hakan@tuttifrutti.cdt.luth.se |
---------------------------------------
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/