Date: Wed, 04 Feb 2004 10:23:05 -0800
From: john stultz <>
Subject: Re: TSC and real-time clock slippage with 2.6.2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/4/135

On Wed, 2004-02-04 at 05:34, Ian Chard wrote:
> Ever since I upgraded from 2.4.20 to the 2.6 tree, I've had a problem
> with real-time clock slippage and hard hangs on my Athlon XP 2500+
> (1830MHz according to /proc/cpuinfo).  I've kept an eye on the list and
> have applied new patches as the problem seems to be known about, but as
> the problem's still there with 2.6.2 I thought it was about time I
> reared my ugly head.
> 
> At or shortly after boot time, I get the "Losing too many ticks!"
> message (this seems to be related to how hard the system is working --
> if it runs an fsck, the message appears immediately).  Then, while the
> system is running, the real-time clock will lose time: the more jobs use
> the CPU, the more time I lose.  Occasionally, the system will oops or
> hard-hang altogether (which could be an unrelated driver issue; it is
> pretty unusual).
> 
> I'm willing to test any patches you clever folk want to throw at me, or
> alternatively if there's an easy solution I'll try anything.
Are you using the amd76x_pm module?
Also, does time still drift backward with the following patch?
Could you also send me your dmesg and ntp drift file for both with and
without this patch?
thanks
-john
===== arch/i386/kernel/timers/timer_tsc.c 1.35 vs edited =====
--- 1.35/arch/i386/kernel/timers/timer_tsc.c	Wed Jan  7 00:31:11 2004
+++ edited/arch/i386/kernel/timers/timer_tsc.c	Tue Jan 20 13:22:54 2004
@@ -226,7 +226,7 @@
 	delta += delay_at_last_interrupt;
 	lost = delta/(1000000/HZ);
 	delay = delta%(1000000/HZ);
-	if (lost >= 2) {
+	if (0 && (lost >= 2)) {
 		jiffies_64 += lost-1;
 
 		/* sanity check to ensure we're not always losing ticks */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/