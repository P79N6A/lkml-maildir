Date: Wed, 06 Jun 2007 21:42:27 -0400
From: Steven Rostedt <>
Subject: [PATCH RT] enable interrupts in do_page_fault for users (take 2 - add i386 fix too)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/6/519

Thomas,
Can you replace my previous patch with this one. This one includes the
fix for i386.
-- Steve
Index: linux-2.6.21-rt9/arch/x86_64/mm/fault.c
===================================================================
--- linux-2.6.21-rt9.orig/arch/x86_64/mm/fault.c
+++ linux-2.6.21-rt9/arch/x86_64/mm/fault.c
@@ -476,6 +476,10 @@ bad_area:
 bad_area_nosemaphore:
 	/* User mode accesses just cause a SIGSEGV */
 	if (error_code & PF_USER) {
+
+		/* it's possible to have interrupts off here */
+		local_irq_enable();
+
 		if (is_prefetch(regs, address, error_code))
 			return;
 
Index: linux-2.6.21-rt9/arch/i386/mm/fault.c
===================================================================
--- linux-2.6.21-rt9.orig/arch/i386/mm/fault.c
+++ linux-2.6.21-rt9/arch/i386/mm/fault.c
@@ -459,6 +459,10 @@ bad_area:
 bad_area_nosemaphore:
 	/* User mode accesses just cause a SIGSEGV */
 	if (error_code & 4) {
+
+		/* it's possible to have interrupts off here */
+		local_irq_enable();
+
 		/* 
 		 * Valid to do another page fault here because this one came 
 		 * from user space.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/