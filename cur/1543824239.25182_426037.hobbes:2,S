Date: Mon, 22 May 2006 10:15:35 -0700
From: Zachary Amsden <>
Subject: [PATCH] Fix typo in arch/i386/power/cpu.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/22/179

Fix a typo which caused us to corrupt CR2 (not likely a problem) and 
fail to restore CR0 (potentially a problem on APM systems, since TS/EM 
bits might be lost) after suspend.
Fix a typo in suspend code noticed by Artur Zaprzala.  I'm unsure if this
actually causes a bug in practice, since the ACPI wakeup code also restores
CR0, and the APM code returns to protected mode, but the fix is obviously much
better.
Signed-off-by: Zachary Amsden <zach@vmware.com>
Index: linux-2.6.17-rc/arch/i386/power/cpu.c
===================================================================
--- linux-2.6.17-rc.orig/arch/i386/power/cpu.c	2006-03-19 21:53:29.000000000 -0800
+++ linux-2.6.17-rc/arch/i386/power/cpu.c	2006-05-22 09:50:50.000000000 -0700
@@ -92,7 +92,7 @@ void __restore_processor_state(struct sa
 	write_cr4(ctxt->cr4);
 	write_cr3(ctxt->cr3);
 	write_cr2(ctxt->cr2);
-	write_cr2(ctxt->cr0);
+	write_cr0(ctxt->cr0);
 
 	/*
 	 * now restore the descriptor tables to their proper values