Date: Mon, 17 May 2004 07:52:17 -0700
From: Larry McVoy <>
Subject: Re: 1352 NUL bytes at the end of a page? (was Re: Assertion `s && s->tree' failed: The saga continues.)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/5/17/78

On Mon, May 17, 2004 at 07:32:44AM -0700, Linus Torvalds wrote:
> My claim (which may be bogus, but isn't), is that you wrote the file with 
> a buffered interface like stdio (or your own buffers), and that the buffer 
> size is likely a nice round number like 8kB or something. I think that's 
> what stdio uses by default.
Yup, that's what we do.
> And at some point earlier in the process you did an fflush(), or somebody
> else had written a header of n*PAGE_SIZE + 0x4ff bytes, or something like
> that. Since this was the ChangeSet file, I suspect that the "header" is 
> the checkin-comment section at the beginning, and the "second phase" is 
> the actual key list thing. You know how you write the ChangeSet file 
> better than I do.
I don't think we flush along the way but let me look.  Whoops, you're right,
we do.  Right where you thought too.  But that doesn't explain there being
3 blocks of nulls (there should NEVER be a null in the s.ChangeSet file, we
don't compress that, it's always ascii).
But the bigger problem is that you are missing the point that I mentioned
elsewhere, we are writing to a tmp file, the tmp file is NOT mmapped.
We mmap only after that file is closed and renamed.  We don't map the
tmp file.
-- 
---
Larry McVoy                lm at bitmover.com           
http://www.bitkeeper.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/