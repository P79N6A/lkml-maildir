Date: Mon, 22 Dec 2008 10:49:43 +1030
From: Rusty Russell <>
Subject: per-cpu stats in block device: overkill?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/21/159

Hi Jens, Tejun, Jerome,
  I've been auditing alloc_per_cpu users, and got to genhd.  The code is fairly complex, but I can't help wondering if per-cpu counters are overkill.  After all, we have a single queue lock.
  The reason I care is that I'm changing alloc_per_cpu to use the static per-cpu area: at 40/80 bytes (32/64 bit) per stat, we'd be restricted to a few hundred disks unless the percpu area is enlarged (in current patches, a cmdline param).  Or, I can change genhd to use big_percpu_alloc which will use the current inefficient dynamic per-cpu system until we get dynamic per-cpu regions (if ever).
Cheers,
Rusty.