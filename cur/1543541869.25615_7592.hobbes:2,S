Date: Sun, 20 Aug 2000 20:14:49 +0200 (CEST)
From: Willy Tarreau <>
Subject: [BUG] matroxfb (kernel 2.2) / Xfree 4
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/20/3

Hi !
I'm experiencing a little trouble with the Matrox G400 console
frame buffer (kernel-2.2.17pre19) since I upgraded from XFree 3.3.6
to XFree 4.0.1. Explaination :
   - my system boots with a 1024x768x8 console frame buffer.
     Everything works well for now.
   - if I launch X, and switch back to text mode (exit or Ctrl-Alt-F1)
     AFTER a root image has been displayed (eg: xv -root), the
     matrox_cfbX_bmove() function behaves badly: when inserting text at the
     beginning of a the command line, or worse, when using vi, wrong parts of
     images gets copied to the dest location. In most cases, this concretes by
     the moving part being replaced with crap. I could even get half a screen
     from my previous reboot containing last messages, including "Restarting
     system." (could be nice in some situations :-).
   - for now, the only way to get a good behaviour back is to
     simply launch "xinit xsetroot", and everything works ok.
I must say I've tried several combinations of console modes and X modes.
All seem to give the same results. If I replace the reference to the function
matrox_cfbX_bmove() with fbcon_cfb8_bmove() in matroxfb.c, it behaves
correctly (but slowly). Same if I start with matroxfb=noaccel.
I've tested several kernels from 2.2.17pre19 back to 2.2.15 to see if the
problem is new, but 2.2.15 already behaves badly. I think that XFree 4 may
set a register that's not used by matroxfb, but I don't have enough info in
the source to write a register dumper (provided registers aren't write-only).
Since I've found an ugly workaround, this is not urgent, but any help in
debugging this would be appreciated ;-)
I can do some more tests if needed. Altough my kernels are *heavily* patched,
I don't think this is the problem because of the number of kernels affected.
well, what more ? it's an athlon on a K7V, MTRRs enabled or disabled, the G400
has 16 MB RAM, and the PC has 192 MB.
Hoping this can help,
Willy
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/