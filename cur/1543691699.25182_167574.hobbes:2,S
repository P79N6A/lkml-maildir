Date: Mon, 22 Sep 2003 10:07:54 -0600
From: Bjorn Helgaas <>
Subject: Re: [PATCH] 2.4 fix pci_generic_prep_mwi export breakage
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/22/113

On Sunday 21 September 2003 12:28 pm, Marcelo Tosatti wrote:
> On Sat, 20 Sep 2003, Jeff Garzik wrote:
> > Bjorn Helgaas wrote:
> > > I think the recent change to pci.c to export pci_generic_prep_mwi() 
> > > is incorrect.
> > > 
> > > pci_generic_prep_mwi() is only defined if !HAVE_ARCH_PCI_MWI,
> > > so it is wrong to export it.  In particular, it breaks on
> > > ia64, because we define HAVE_ARCH_PCI_MWI.
> > > 
> > > It looks to me like the following patch should be applied.  This
> > > removes the export and in fact makes pci_generic_prep_mwi() static
> > > as it is in 2.5.
> > 
> > Looks OK to me.  Marcelo applied this already, right?
> 
> Well I dont remember applying it but I dont seem to have 
> pci_generic_prep_mwi exported. 
Looks to me like your tree still needs this change.  Here's the
patch again in case you need it:
===== drivers/pci/pci.c 1.45 vs edited =====
--- 1.45/drivers/pci/pci.c	Sun Aug 31 07:52:15 2003
+++ edited/drivers/pci/pci.c	Mon Sep 22 12:27:35 2003
@@ -921,7 +921,7 @@
  *
  * RETURNS: An appriopriate -ERRNO error value on eror, or zero for success.
  */
-int
+static int
 pci_generic_prep_mwi(struct pci_dev *dev)
 {
 	u8 cacheline_size;
@@ -2151,7 +2151,6 @@
 EXPORT_SYMBOL(pci_set_master);
 EXPORT_SYMBOL(pci_set_mwi);
 EXPORT_SYMBOL(pci_clear_mwi);
-EXPORT_SYMBOL(pci_generic_prep_mwi);
 EXPORT_SYMBOL(pci_set_dma_mask);
 EXPORT_SYMBOL(pci_dac_set_dma_mask);
 EXPORT_SYMBOL(pci_assign_resource);
===== include/linux/pci.h 1.34 vs edited =====
--- 1.34/include/linux/pci.h	Sun Aug 31 07:52:15 2003
+++ edited/include/linux/pci.h	Mon Sep 22 12:27:35 2003
@@ -628,7 +628,6 @@
 #define HAVE_PCI_SET_MWI
 int pci_set_mwi(struct pci_dev *dev);
 void pci_clear_mwi(struct pci_dev *dev);
-int pci_generic_prep_mwi(struct pci_dev *dev);
 int pci_set_dma_mask(struct pci_dev *dev, u64 mask);
 int pci_dac_set_dma_mask(struct pci_dev *dev, u64 mask);
 int pci_assign_resource(struct pci_dev *dev, int i);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/