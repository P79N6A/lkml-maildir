Date: Mon, 7 Jul 2003 20:36:53 +0100 (BST)
From: Leon Stedman <>
Subject: Epson printer-scanner on UBS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/7/164

Any help with this problem would be appreciated.
Leon Stedman
[1.] One line summary of the problem:
Problem using Epson Stylus CX3200 printer/scanner.
[2.] Full description of the problem/report: Printer/Scanner is attached
to UBS. When booting with printer turned on the output to dmsg is as
below. If the printer is turned on after booting the printer and scanner
are found, but neither is usable. During setup with RedHat's set up tool
the printer worked as did the scanner when set up under XSANE. Neither
printer nor scanner are accessible after reboot, with printer's error light
on. 
[3.] Keywords (i.e., modules, networking, kernel): Epson printer-scanner,
UBS. 
[4.] Kernel version:
Linux version 2.4.18-14 (bhcompile@astest.test.redhat.com) (gcc version 3.2 20020903 (Red Hat Linux 8.0 3.2-7)) #1 Wed Sep 4 12:13:11 EDT 2002
[5.] Output of Oops:
part of dmsg:
usb.c: registered new driver usbdevfs
usb.c: registered new driver hub
usb-uhci.c: $Revision: 1.275 $ time 12:23:37 Sep  4 2002
usb-uhci.c: High bandwidth mode enabled
usb-uhci.c: USB UHCI at I/O 0xd400, IRQ 11
usb-uhci.c: Detected 2 ports
usb.c: new USB bus registered, assigned bus number 1
hub.c: USB hub found
hub.c: 2 ports detected
usb-uhci.c: USB UHCI at I/O 0xd800, IRQ 11
usb-uhci.c: Detected 2 ports
usb.c: new USB bus registered, assigned bus number 2
hub.c: USB hub found
hub.c: 2 ports detected
usb-uhci.c: USB UHCI at I/O 0xdc00, IRQ 11
usb-uhci.c: Detected 2 ports
usb.c: new USB bus registered, assigned bus number 3
hub.c: USB hub found
hub.c: 2 ports detected
usb-uhci.c: v1.275:USB Universal Host Controller Interface driver
usb.c: registered new driver hiddev
usb.c: registered new driver hid
hid-core.c: v1.8.1 Andreas Gal, Vojtech Pavlik <vojtech@suse.cz>
hid-core.c: USB HID support drivers
hub.c: USB new device connect on bus1/2, assigned device number 2
usb.c: USB device 2 (vend/prod 0x4b8/0x802) is not claimed by any active driver.
EXT3 FS 2.4-0.9.18, 14 May 2002 on ide0(3,2), internal journal
Adding Swap: 1044216k swap-space (priority -1)
Adding Swap: 72284k swap-space (priority -2)
usb.c: registered new driver usbscanner
Unable to handle kernel paging request at virtual address 000102c2
 printing eip:
e08df95f
*pde = 00000000
Oops: 0000
scanner hid input usb-uhci usbcore ext3 jbd  
CPU:    0
EIP:    0010:[<e08df95f>]    Not tainted
EFLAGS: 00010246
EIP is at probe_scanner [scanner] 0xdf (2.4.18-14)
eax: 00000000   ebx: 00000002   ecx: 00000000   edx: 000102c3
esi: 000102c0   edi: dfa08200   ebp: 00000001   esp: df6ffe4c
ds: 0018   es: 0018   ss: 0018
Process modprobe (pid: 227, stackpage=df6ff000)
Stack: df6ffe6c e08e0918 00000000 01000000 c25a2800 00001041 00000212 00001000 
       6e616373 3072656e 0001e600 00000212 e08e183c e085247c c248f658 00000001 
       e082eddb dfa08200 00000001 00000000 00000018 dfa08214 e08e1820 00000000 
Call Trace: [<e08e0918>] .rodata.str1.1 [scanner] 0x0 (0xdf6ffe50))
[<e08e183c>] scanner_driver [scanner] 0x1c (0xdf6ffe7c))
[<e085247c>] hid_driver [hid] 0x1c (0xdf6ffe80))
[<e082eddb>] usb_find_interface_driver [usbcore] 0x1fb (0xdf6ffe8c))
[<e08e1820>] scanner_driver [scanner] 0x0 (0xdf6ffea4))
[<e0840760>] usb_driver_list [usbcore] 0x0 (0xdf6ffeac))
[<e082e9bd>] usb_check_support [usbcore] 0x4d (0xdf6ffec0))
[<e082e9d8>] usb_check_support [usbcore] 0x68 (0xdf6ffed4))
[<e0840768>] usb_bus_list [usbcore] 0x0 (0xdf6ffee0))
[<e082e140>] usb_scan_devices_Rca4f6301 [usbcore] 0x40 (0xdf6ffee8))
[<e08e1820>] scanner_driver [scanner] 0x0 (0xdf6ffef0))
[<e082e0db>] usb_register_Ree3d8a5f [usbcore] 0x7b (0xdf6ffef4))
[<e0839cc0>] .rodata.str1.32 [usbcore] 0x0 (0xdf6ffef8))
[<e08e0922>] .rodata.str1.1 [scanner] 0xa (0xdf6ffefc))
[<e08dfdef>] usb_scanner_init [scanner] 0xf (0xdf6fff14))
[<e08e1820>] scanner_driver [scanner] 0x0 (0xdf6fff18))
[<c011bee9>] sys_init_module [kernel] 0x4d9 (0xdf6fff1c))
[<e08df060>] irq_scanner [scanner] 0x0 (0xdf6fff20))
[<e08e0a0c>] .kmodtab [scanner] 0x0 (0xdf6fff2c))
[<e08df060>] irq_scanner [scanner] 0x0 (0xdf6fff58))
[<c01090ff>] system_call [kernel] 0x33 (0xdf6fffc0))
Code: 0f b7 42 ff 83 e0 80 66 3d 80 02 0f 84 47 03 00 00 80 7c 24 
 <6>usb.c: registered new driver usblp
kjournald starting.  Commit interval 5 seconds
EXT3 FS 2.4-0.9.18, 14 May 2002 on ide0(3,1), internal journal
EXT3-fs: mounted filesystem with ordered data mode.
SCSI subsystem driver Revision: 1.00
scsi0 : SCSI host adapter emulation for IDE ATAPI devices
  Vendor: LG        Model: CD-RW CED-8083B   Rev: 1.05
  Type:   CD-ROM                             ANSI SCSI revision: 02
[6.] A small shell script which triggers the problem:
Problem occurs during boot-up
[7.] Environment:
RedHat 8.0 Wiley Publishing Inc edition.
Jetway motherboard with integrated USB and controllers.
Epson stylus CX3200 on USB connection.
[7.1.] Software:
If some fields are empty or look unusual you may have an old version.
Compare to the current minimal requirements in Documentation/Changes.
 
Linux rumahmas.fsnet.co.uk 2.4.18-14 #1 Wed Sep 4 12:13:11 EDT 2002 i686 athlon i386 GNU/Linux
 
Gnu C                  gcc (GCC) 3.2 20020903 (Red Hat Linux 8.0 3.2-7) Copyright (C) 2002 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
Gnu make               3.79.1
util-linux             2.11r
mount                  2.11r
modutils               2.4.18
e2fsprogs              1.27
pcmcia-cs              3.1.31
PPP                    2.4.1
isdn4k-utils           3.1pre4
Linux C Library        2.2.93
Dynamic linker (ldd)   2.2.93
Procps                 2.0.7
Net-tools              1.60
Kbd                    1.06
Sh-utils               2.0.12
Modules Loaded         parport_pc lp parport ipt_REJECT iptable_filter ip_tables ide-scsi scsi_mod ide-cd cdrom printer scanner hid input usb-uhci usbcore ext3 jbd
[7.2.] Processor information:
processor	: 0
vendor_id	: AuthenticAMD
cpu family	: 6
model		: 4
model name	: AMD Athlon(tm) processor
stepping	: 4
cpu MHz		: 1049.180
cache size	: 256 KB
fdiv_bug	: no
hlt_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 1
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 sep mtrr pge mca cmov pat pse36 mmx fxsr syscall mmxext 3dnowext 3dnow
bogomips	: 2081.35
[7.3.] Module information:
parport_pc             19108   1 (autoclean)
lp                      8996   0 (autoclean)
parport                37152   1 (autoclean) [parport_pc lp]
ipt_REJECT              3736   6 (autoclean)
iptable_filter          2412   1 (autoclean)
ip_tables              14840   2 [ipt_REJECT iptable_filter]
ide-scsi               10512   0
scsi_mod              107176   1 [ide-scsi]
ide-cd                 33608   0
cdrom                  33696   0 [ide-cd]
printer                 8992 (initializing)
scanner                10324 (initializing)
hid                    22244   0 (unused)
input                   5888   0 [hid]
usb-uhci               26188   0 (unused)
usbcore                77056   1 [printer scanner hid usb-uhci]
ext3                   70400   2
jbd                    52212   2 [ext3]
[7.4.] Loaded driver and hardware information:
0000-001f : dma1
0020-003f : pic1
0040-005f : timer
0060-006f : keyboard
0070-007f : rtc
0080-008f : dma page reg
00a0-00bf : pic2
00c0-00df : dma2
00f0-00ff : fpu
0170-0177 : ide1
01f0-01f7 : ide0
02f8-02ff : serial(auto)
0376-0376 : ide1
0378-037a : parport0
03c0-03df : vga+
03f6-03f6 : ide0
03f8-03ff : serial(auto)
0cf8-0cff : PCI conf1
d000-d00f : VIA Technologies, Inc. Bus Master IDE
  d000-d007 : ide0
  d008-d00f : ide1
d400-d41f : VIA Technologies, Inc. UHCI USB
  d400-d41f : usb-uhci
d800-d81f : VIA Technologies, Inc. UHCI USB (#2)
  d800-d81f : usb-uhci
dc00-dc1f : VIA Technologies, Inc. UHCI USB (#3)
  dc00-dc1f : usb-uhci
e000-e0ff : VIA Technologies, Inc. VT8233 AC97 Audio Controller
00000000-0009fbff : System RAM
0009fc00-0009ffff : reserved
000a0000-000bffff : Video RAM area
000c0000-000c7fff : Video ROM
000f0000-000fffff : System ROM
00100000-1ffeffff : System RAM
  00100000-00247f2e : Kernel code
  00247f2f-0033ed03 : Kernel data
1fff0000-1fff2fff : ACPI Non-volatile Storage
1fff3000-1fffffff : ACPI Tables
e0000000-e7ffffff : VIA Technologies, Inc. VT8367 [KT266]
e8000000-e9ffffff : nVidia Corporation Vanta [NV6]
ea000000-eaffffff : nVidia Corporation Vanta [NV6]
ffff0000-ffffffff : reserved
[7.5.] PCI information:
00:00.0 Host bridge: VIA Technologies, Inc. VT8367 [KT266]
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort+ >SERR- <PERR-
	Latency: 0
	Region 0: Memory at e0000000 (32-bit, prefetchable) [size=128M]
	Capabilities: [a0] AGP version 2.0
		Status: RQ=31 SBA+ 64bit- FW- Rate=x1
		Command: RQ=0 SBA- AGP- 64bit- FW- Rate=<none>
	Capabilities: [c0] Power Management version 2
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:01.0 PCI bridge: VIA Technologies, Inc. VT8367 [KT333 AGP] (prog-if 00 [Normal decode])
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz+ UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort+ >SERR- <PERR-
	Latency: 0
	Bus: primary=00, secondary=01, subordinate=01, sec-latency=0
	I/O behind bridge: 0000f000-00000fff
	Memory behind bridge: fff00000-000fffff
	Prefetchable memory behind bridge: fff00000-000fffff
	BridgeCtl: Parity- SERR- NoISA+ VGA- MAbort- >Reset- FastB2B-
	Capabilities: [80] Power Management version 2
		Flags: PMEClk- DSI- D1+ D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:08.0 VGA compatible controller: nVidia Corporation RIVA TNT2 Model 64 (rev 15) (prog-if 00 [VGA])
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz+ UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 32 (1250ns min, 250ns max)
	Interrupt: pin A routed to IRQ 11
	Region 0: Memory at ea000000 (32-bit, non-prefetchable) [size=16M]
	Region 1: Memory at e8000000 (32-bit, prefetchable) [size=32M]
	Expansion ROM at <unassigned> [disabled] [size=64K]
	Capabilities: [60] Power Management version 1
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:11.0 ISA bridge: VIA Technologies, Inc. VT8233 PCI to ISA Bridge
	Subsystem: VIA Technologies, Inc.: Unknown device 0000
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping+ SERR- FastB2B-
	Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 0
	Capabilities: [c0] Power Management version 2
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:11.1 IDE interface: VIA Technologies, Inc. VT82C586B PIPC Bus Master IDE (rev 06) (prog-if 8a [Master SecP PriP])
	Subsystem: VIA Technologies, Inc. VT82C586B PIPC Bus Master IDE
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 32
	Interrupt: pin A routed to IRQ 0
	Region 4: I/O ports at d000 [size=16]
	Capabilities: [c0] Power Management version 2
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:11.2 USB Controller: VIA Technologies, Inc. USB (rev 1b) (prog-if 00 [UHCI])
	Subsystem: VIA Technologies, Inc. (Wrong ID) USB Controller
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 32, cache line size 08
	Interrupt: pin D routed to IRQ 11
	Region 4: I/O ports at d400 [size=32]
	Capabilities: [80] Power Management version 2
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:11.3 USB Controller: VIA Technologies, Inc. USB (rev 1b) (prog-if 00 [UHCI])
	Subsystem: VIA Technologies, Inc. (Wrong ID) USB Controller
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 32, cache line size 08
	Interrupt: pin D routed to IRQ 11
	Region 4: I/O ports at d800 [size=32]
	Capabilities: [80] Power Management version 2
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:11.4 USB Controller: VIA Technologies, Inc. USB (rev 1b) (prog-if 00 [UHCI])
	Subsystem: VIA Technologies, Inc. (Wrong ID) USB Controller
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 32, cache line size 08
	Interrupt: pin D routed to IRQ 11
	Region 4: I/O ports at dc00 [size=32]
	Capabilities: [80] Power Management version 2
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
00:11.5 Multimedia audio controller: VIA Technologies, Inc. VT8233 AC97 Audio Controller (rev 30)
	Subsystem: Avance Logic Inc.: Unknown device 34dc
	Control: I/O+ Mem- BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-
	Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Interrupt: pin C routed to IRQ 5
	Region 0: I/O ports at e000 [size=256]
	Capabilities: [c0] Power Management version 2
		Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-
[7.6.] SCSI information:
Attached devices: 
Host: scsi0 Channel: 00 Id: 00 Lun: 00
  Vendor: LG       Model: CD-RW CED-8083B  Rev: 1.05
  Type:   CD-ROM                           ANSI SCSI revision: 02
[7.7.] Other information:
[X.] Other notes, patches, fixes, workarounds::
From "
http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd"
"You have to remove the following from the "drivers/usb/scanner.c" file in the
kernel source:
    if (dev->config[0].bNumInterfaces != 1) {
        info("probe_scanner: Only one device interface is supported.");
        return NULL;
    }
"Then you have to recompile, install, and reload the "scanner.o" kernel module
 (the commands have to be executed as "root", we assume that the kernel source
 code is in the "/usr/src/linux" directory):
    cd /usr/src/linux 
    make modules
    cp drivers/usb/scanner.o /lib/modules/&lt;Linux version&gt;/kernel/drivers/usb/
    rmmod scanner
    modprobe scanner vendor=0x04b8 product=0x0802
    After having done so you can configure SANE to use the
    CX3200 with the "epson" scanner driver, it is
    compatible to the Epson Perfection 1200U.
=================