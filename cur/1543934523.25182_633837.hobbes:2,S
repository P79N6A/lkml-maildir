Date: Thu, 03 Jan 2008 12:46:23 +0100
From: Jochen Friedrich <>
Subject: Re: [PATCHv3] powerpc: DBox2 Board Support
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/3/92

Hi David,
>> +/ {
>> +	model = "unknown,dbox2"; // boot wrapper fills in correct manufacturer
> 
> Probably better just to leave model out of the dts and let the
> bootwrapper add it.
Unfortunately, dtc requires a model:
$ dtc arch/powerpc/boot/dts/dbox2.dts
DTC: dts->dts  on file "arch/powerpc/boot/dts/dbox2.dts"
ERROR: Missing "model" property in /
>> +		flash@0,0 {
>> +			compatible = "cfi-flash";
>> +			reg = <0 0 800000>;
>> +			bank-width = <4>;
>> +			device-width = <1>;
>> +			#address-cells = <1>;
>> +			#size-cells = <1>;
>> +			partition@0 {
>> +				label = "BR bootloader";
>> +				reg = <0 20000>;
>> +				read-only;
>> +			};
>> +			partition@20000 {
>> +				label = "FLFS (U-Boot)";
>> +				reg = <20000 20000>;
>> +			};
>> +			partition@40000 {
>> +				label = "rootfs";
>> +				reg = <40000 7c0000>;
>> +			};
>> +			ovpartition@20000 {
> 
> Uh.. I really don't know what the MTD driver will handle these
> overlapping partitions.  I suspect it will not be pretty...
> 
>> +				label = "Flash without bootloader";
>> +				reg = <20000 7e0000>;
>> +			};
>> +			ovpartition@0 {
>> +				label = "Complete Flash";
>> +				reg = <0 800000>;
>> +				read-only;
>> +			};
>> +		};
>> +	};
MTD handles this correctly. dbox2 uses "Flash without bootloader" for flashing image updates and "Complete Flash" for creating a backup of everything.
OpenWRT also uses overlapping partitions BTW (and also for flashing updates).
Thanks,
Jochen