Date: Sat, 10 Jul 1999 18:49:41 +0200 (CEST)
From: Willy Tarreau <>
Subject: Re: KMSGDUMP: dump kernel messages to a diskette
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/7/10/52

> > 0xa does immediately branch to the address given at 40:67, whereas 0x9 does
> > a little more before. On my computer, (asus P5A, K6/2), it seems to
> > reinitialize something in the PCI chipsets, so it may be better than 0xA.
> 
>  This indicates it's even less standard than I suspected -- in the 286 and
> 386 days 0x9 used only to pop registers off the stack in a predefined way
> and then execute retf.  If you want to perform some initialization then
> 0x5 performs exactly what 0xa does but additionally it resets the 8259s to
> PC defaults.
On my old PC, I noticed that 0x5 did lots of initializations, but on the actual
one, I couldn't identify what it does. If it does at least chipset-specific
init and 8259s, then this will allow me to reduce the code.
> > One other problem I didn't speak about concerns people using loadlin. Their
> > interrupts might redirect to DOS drivers such as smartdrive, in which case
> > no dump would not work.
> 
>  There might be a "well-known" BIOS entry point which could help here.  I
> don't have the list of BIOS entry points handy but BIOS developers still
> seem to keep compatible with the IBM's original.
There is a well-known bios entry point. The problem is that it depends on
devices and add-on bioses. When you don't have hard disks, you get the
original entry point at 0xf000:0xec59, IIRC. When you have hard disks, this
address becomes int 0x40 and an other pointer replaces int 0x13. This one
should be standard too. But when you have an SCSI card, then you can't know
the pointer. It can be 0xc800:xxxx or 0xd000:xxxx ...
Concerning the possibilities of executing code upon a manual reset, I've
tested it and it doesn't work. The PC simply reboots. I remember that some
chipsets clean all the memory themselves upon reset. But what I can't
understand is why the bios doesn't hang instead of rebooting. Since my
CMOS register contains 0xA or 0x9 or anything else, the bios should notice it.
I can't imagine that the reset also clears this flags !
Perhaps we should try an NMI. Anyone has a "red button" connected to NMI input ?
(a hardware debugger did that at the time of my old 8088).
Willy
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/