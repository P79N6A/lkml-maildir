Date: Tue, 6 May 2003 09:40:34 +0100
From: "Jamie Harris" <>
Subject: Failing to allocated file handles?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/5/6/60

Hello all,
Sorry if this isn't the kind of thing you guys deal with, if this is the
case then feel free to tell me a better place to ask my question!  I
haven't managed to find anywhere else that's got lots of people who know
a sufficient amount about kernel internals.
We've got an SMP P3 server running Redhat's (sorry, I would roll my own
but it's not 'my' box) 2.4.18-27.7.xsmp kernel.  This box runs Apache
and ColdFusion (spit!).  The ColdFusion (spit!) server appears to decide
to open a number of files in a short burst, then promptly dies.  I've
worked out from monitoring /proc/sys/fs/file-nr that we're running out
of available file handles.  The number of allocated file handles (sorry
if my terminalogy is way off, I'm talking about the first number in
/proc/sys/fs/file-nr) hovers around 2500, the number of available file
handles (the second number) drops to around zero, then gets to zero and
the ColdFusion (spit!) server dies and reports being out of files.
It appears that the system is not allocating new file handles fast
enough to keep up with the rate they are being consumed.  Is this
possible?  I'm unable to replicated this on a single processor machine
so am assuming that it's related to different threads on different CPUs
not 'keeping up with one another'.  
What do the kernel devlopers think?  Any info creatly appreaciated, even
if its only "get and build the latest kernel", at least I'll have some
more info to tell our customer and the powers-that-be.  Oddly enough
we're only experiencing this on a single machine, although we have lots
of identical boxes running similar software.
Cheers all.
Jamie...
--
Jamie Harris, NISS Service Delivery Team, 
EduServ, Queen Anne House, 11 Charlotte Street, Bath, BA1 2NE
Tel: +44 (0)1225 474300 Fax: +44 (0)1225 474301
Direct Tel: +44 (0)1225 474388
**  This message was transmitted on 100% recycled electrons **
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/