Date: Tue, 13 Mar 2007 03:52:50 -0800
From: Andrew Morton <>
Subject: Re: [QUICKLIST 0/4] Arch independent quicklists V2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/13/128

> On Tue, 13 Mar 2007 19:03:38 +1100 Nick Piggin <nickpiggin@yahoo.com.au> wrote:
> Andrew Morton wrote:
> >>On Tue, 13 Mar 2007 00:13:25 -0700 (PDT) Christoph Lameter <clameter@sgi.com> wrote:
> >>Page table pages have the characteristics that they are typically zero
> >>or in a known state when they are freed.
> > 
> > 
> > Well if they're zero then perhaps they should be released to the page allocator
> > to satisfy the next __GFP_ZERO request.  If that request is for a pagetable
> > page, we break even (except we get to remove special-case code).  If that
> > __GFP_ZERO allocation was or some application other than for a pagetable, we
> > win.
> > 
> > iow, can we just nuke 'em?
> 
> Page allocator still requires interrupts to be disabled, which this doesn't.
Bah.  How many cli/sti statements fit into a single cachemiss?
> Considering there isn't much else that frees known zeroed pages, I wonder if
> it is worthwhile.
If you want a zeroed page for pagecache and someone has just stuffed a
known-zero, cache-hot page into the pagetable quicklists, you have good
reason to be upset.
In fact, if you want a _non_-zeroed page and someone has just stuffed a
known-zero, cache-hot page into the pagetable quicklists, you still have
reason to be upset.  You *want* that cache-hot page.
Generally, all these little private lists of pages (such as the ones which
slab had/has) are a bad deal.  Cache effects preponderate and I do think
we're generally better off tossing the things into a central pool.
Plus, we can get in a situation where take a cache-cold, known-zero page
from the pte quicklist when there is a cache-hot, non-zero page sitting in
the page allocator.  I suspect that zeroing the cache-hot page would take a
similar amount of time to a single miss agains the cache-cold page.
I'm not saying that I _know_ that the quicklists are pointless, but I don't
think it's established that they are pointful.
ISTR that experiments with removing the i386 quicklists made zero
difference, but that was an awfully long time ago.  Significantly, it
predated per-cpu-pages..
> Last time the zeroidle discussion came up was IIRC not actually real performance
> gain, just cooking the 1024 CPU threaded pagefault numbers ;)
Maybe, dunno.  It was apparently a win on powerpc many years ago.  I had a
fiddle with it 5-6 years ago on x86 using a cache-disabled mapping of the
page.  But it needed too much support in core VM to bother.  Since then
we've grown per-cpu page magazines and __GFP_ZERO.  Plus I'm not aware of
anyone having tried doing it on x86 with non-temporal stores.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/