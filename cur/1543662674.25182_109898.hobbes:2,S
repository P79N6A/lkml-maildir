Date: Sat, 15 Feb 2003 11:00:28 +0100
From: Mike Galbraith <>
Subject: Re: [PATCH] CFQ scheduler, #2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/2/15/26

At 03:19 PM 2/14/2003 +0100, Jens Axboe wrote:
>Hi,
Greetings
>The version posted the other day did fair queueing of requests between
>processes, but it did not help to provide fair request allocation. This
>version does that too, results are rather remarkable. In addition, the
>following changes were made:
>
>- Fix lost request problem with rbtree aliasing. The default io
>   scheduler in 2.5.60 has the same bug, a fix has been sent separetely
>   to Linus that addresses this.
>
>- Add front merging.
>
>- Missing queue_lock grab in get_request_wait() before checking request
>   list count. Again, a generic kernel bug. A patch will be sent to Linus
>   to address that as well.
I gave this a burn, and under hefty load it seems to provide a bit of 
anti-thrash benefit.
i(dang, wish I had pine/vi for winders box)log data attached
         -Mike2.5.61virgin make bzImage reference run
(poor box isn't _rediculously_ overloaded;)
real    8m9.710s
user    7m27.045s
sys     0m34.605s
three consecutive make -j30 bzImage runs
2.5.61cfq2
real    8m41.834s   8m36.908s   8m38.164s
user    7m37.208s   7m36.986s   7m36.456s
sys     0m42.921s   0m43.387s   0m43.312s
2.5.61virgin
real    8m39.723s   8m39.456s   8m42.102s
user    7m39.343s   7m38.800s   7m38.542s
sys     0m43.417s   0m43.322s   0m43.502s
/proc/vmstat    2.5.61cfq2   2.5.61virgin
-----------------------------------------
nr_dirty                20             13
nr_writeback             0              0
nr_pagecache          7308           7593
nr_page_table_pages     85             85
nr_reverse_maps       3229           3198
nr_mapped              599            599
nr_slab               1203           1184
pgpgin             1767432        1911614
pgpgout            1606743        1746497
pswpin              311297         338436
pswpout             371161         406675
pgalloc            3037961        3070811
pgfree             3060825        3093420
pgactivate          142329         135616
pgdeactivate        514672         507026
pgfault            4896877        4928530
pgmajfault           74342          84476
pgscan             2751953        5328260  <== ? hmm
pgrefill           1821561        1972715
pgsteal             528014         575301
pginodesteal             0              0
kswapd_steal        380282         522126
kswapd_inodesteal     7010           7132
pageoutrun            1107           1956
allocstall            3472           1238
pgrotated           358243         413450