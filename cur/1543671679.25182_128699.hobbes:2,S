Date: Wed, 30 Apr 2003 09:09:10 +0100
From: Adam Mercer <>
Subject: [PATCH 2.4.21-rc1] vesafb with large memory
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/4/30/18

Hi
I've recently been having a problem with the vesafb refusing to boot on
my system, after investigation the problem further I found that it had
been mentioned on the 27 March 2003, in this thread
http://marc.theaimsgroup.com/?l=linux-kernel&m=104878364823195&w=2
In the thread Walt H, waltabbyh <at> comcast <dot> net, provides a fix.
After just downloading 2.4.21-rc1 I noticed that this fix was not
present. So heres a patch against 2.4.21-rc1 to fix this probelm.
Please CC me with any responses as I'm not on the list.
Cheers
Adam
diff -urN linux-2.4.21-rc1-orig/drivers/video/vesafb.c linux-2.4.21-rc1/drivers/video/vesafb.c
--- linux-2.4.21-rc1-orig/drivers/video/vesafb.c  2002-11-28 23:53:15.000000000 +0000
+++ linux-2.4.21-rc1/drivers/video/vesafb.c 2003-04-30 08:32:02.000000000 +0100
@@ -520,7 +520,7 @@
	video_width         = screen_info.lfb_width;
	video_height        = screen_info.lfb_height;
	video_linelength    = screen_info.lfb_linelength;
-	video_size          = screen_info.lfb_size * 65536;
+	video_size          = screen_info.lfb_width *	screen_info.lfb_height * video_bpp;
	video_visual = (video_bpp == 8) ?
		FB_VISUAL_PSEUDOCOLOR : FB_VISUAL_TRUECOLOR;						
diff -urN linux-2.4.21-rc1-orig/drivers/video/vesafb.c linux-2.4.21-rc1/drivers/video/vesafb.c
--- linux-2.4.21-rc1-orig/drivers/video/vesafb.c	2002-11-28 23:53:15.000000000 +0000
+++ linux-2.4.21-rc1/drivers/video/vesafb.c	2003-04-30 08:32:02.000000000 +0100
@@ -520,7 +520,7 @@
 	video_width         = screen_info.lfb_width;
 	video_height        = screen_info.lfb_height;
 	video_linelength    = screen_info.lfb_linelength;
-	video_size          = screen_info.lfb_size * 65536;
+	video_size          = screen_info.lfb_width * screen_info.lfb_height * video_bpp;
 	video_visual = (video_bpp == 8) ?
 		FB_VISUAL_PSEUDOCOLOR : FB_VISUAL_TRUECOLOR;
 