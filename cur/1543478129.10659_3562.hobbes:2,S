Date: Fri, 15 Jan 1999 23:45:02 -0500 (EST)
From: Rafael Reilova <>
Subject: [PATH] AMD-K5 sep flag tweak to /proc/cpuinfo
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/1/15/266

Hi,
	I was just going over the CPU detection code after a long break
from the list.  It seems someone finally decided to fix the bit 10 that
was appearing in /proc/cpuinfo for the AMD-K5, which is great!, but... I
think that what we want to do is something like what I'm appending (or
maybe stuff it as a func. in bugs.h). Just in case someone actually ever
implements the FAST_SYSCALL and checks the actual bits (X86_FEATURE_SEP). 
	Cheers,
		Rafael
--- linux-2.2.0-pre6/arch/i386/kernel/setup.c   Sun Jan 10 14:26:22 1999
+++ linux/arch/i386/kernel/setup.c      Fri Jan 15 23:36:09 1999
@@ -260,6 +260,11 @@
        cpuid(0x80000003, &v[4], &v[5], &v[6], &v[7]);
        cpuid(0x80000004, &v[8], &v[9], &v[10], &v[11]);
        c->x86_model_id[48] = 0;
+
+       /* fix errata on the AMD-K5 model 6: sep flag in bit 10 */
+       if (c->x86_vendor == X86_VENDOR_AMD && c->x86 == 5 && c->x86_model == 6)
+               c->x86_capability = (c->x86_capability & ~X86_FEATURE_10)
+                       | ((c->x86_capability & X86_FEATURE_10)<<1);
        return 1;
 }
 
@@ -689,8 +694,6 @@
                } else if (c->x86_vendor == X86_VENDOR_AMD) {
                        x86_cap_flags[16] = "fcmov";
                        x86_cap_flags[31] = "3dnow";
-                       if (c->x86 == 5 && c->x86_model == 6)
-                               x86_cap_flags[10] = "sep";
                } else if (c->x86_vendor == X86_VENDOR_INTEL) {
                        x86_cap_flags[6] = "pae";
                        x86_cap_flags[9] = "apic";
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/