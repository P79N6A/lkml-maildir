Date: Wed, 25 Jul 2007 09:45:54 +0200
From: Sébastien Dugué <>
Subject: Re: commit 7e92b4fc34 - x86, serial: convert legacy COM ports to platform devices - broke my serial console
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/25/74

  Hi Bjorn, 
  looks like the commit was dropped, nevertheless here is some more info
to try and understand what may be going on so it may benefit the posterity ;-)
On Tue, 24 Jul 2007 09:48:45 -0600 Bjorn Helgaas <bjorn.helgaas@hp.com> wrote:
> On Tuesday 24 July 2007 08:28:05 am Sébastien Dugué wrote:
> >  your commit 7e92b4fc345f5b6f57585fbe5ffdb0f24d7c9b26 broke the serial console
> > on my box. Adding 'legacy_serial.force=1' to my boot param as a workaround
> > solves the issue, but this may be hiding bugs in Linux PnP support or
> > in my firmware.
> 
> Thanks for your report.  We need to figure out why the 8250_pnp driver
> didn't find your serial console device.  Can you confirm that you also
> have CONFIG_ACPI and CONFIG_PNPACPI in your .config?
  Yep, both =y
CONFIG_ACPI=y
CONFIG_PNPACPI=y
> 
> If you have those, and it still doesn't work, can you collect the DSDT
> dump, the output of "grep . /sys/bus/pnp/devices/*/*", and the dmesg
> from your "legacy_serial.force=1" boot? 
  Please find those attached. I also include the output from dmidecode
just in case (I'm not sure it contains anything interesting in this case
though).
  dsdt.dsl -> DSDT dump
  dmi.txt  -> output from dmidecode
  pnp-info.txt -> output of the grep
  dmesg-ok.txt -> dmesg with 'legacy_serial.force=1' (CONFIG_PNP_DEBUG=y)
  dmesg-bad.txt -> dmesg without 'legacy_serial.force=1' (CONFIG_PNP_DEBUG=y)
> Then we can tell which port
> the blind probe finds and whether it's described somewhere by ACPI.
> 
> Thanks,
>   Bjorn
  Thanks,
  Sébastien.
> 
> >   The box is a dual HT Xeon running a vanilla 2.6.22 x86_64 kernel
> > 
> >   here is my .config:
> > 
> > CONFIG_PNP=y
> > CONFIG_SERIAL_8250=y
> > CONFIG_SERIAL_8250_CONSOLE=y
> > CONFIG_SERIAL_8250_PCI=y
> > CONFIG_SERIAL_8250_PNP=y
> > CONFIG_SERIAL_8250_NR_UARTS=4
> > CONFIG_SERIAL_8250_RUNTIME_UARTS=4
> > CONFIG_SERIAL_8250_EXTENDED=y
> > CONFIG_SERIAL_8250_SHARE_IRQ=y
> > CONFIG_SERIAL_8250_DETECT_IRQ=y
> > 
> >   lspci output attached.
> > 
> >   Any ideas to help me debug this?
> > 
> >   If you need more info (like DSDT dump), just ask.
> > 
> >   Thanks,
> > 
> >   Sébastien.
> > 
> > 
> > 
> 
> 
[unhandled content-type:application/x-bzip]