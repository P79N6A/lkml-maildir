Date: Fri, 06 Feb 2004 21:36:52 +0300
From: "Good Oleg"  <>
Subject: Re: [BUG]: kernel BUG at mm/swapfile.c:806! (2.6)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/6/130

REM: TNX, for all that, and good luck with all of Your's
-----Original Message-----
From: Andrew Morton <akpm@osdl.org>
To: "Good Oleg"   <olecom.gnu-linux@mail.ru>
Date: Thu, 5 Feb 2004 17:57:23 -0800
Subject: Re: [BUG]: kernel BUG at mm/swapfile.c:806! (2.6)
> 
> Are you using the swapd daemon?
> 
gluon:/home/olecom# ps aux | grep swap
root         9  0.0  0.0     0    0 ?        SW   20:12   0:00 [kswapd0]
root       651  0.0  0.2  3632  720 pts/3    S    20:20   0:00 grep swap
gluon:/home/olecom# swapon /mnt/swap/swap 
gluon:/home/olecom# ps aux | grep swap
root         9  0.0  0.0     0    0 ?        SW   20:12   0:00 [kswapd0]
root       667  0.0  0.2  3632  720 pts/3    S    20:21   0:00 grep swap
gluon:/home/olecom# swapoff /mnt/swap/swap 
gluon:/home/olecom# ps aux | grep swap
root         9  0.0  0.0     0    0 ?        SW   20:12   0:00 [kswapd0]
root       683  0.0  0.2  3632  720 pts/3    S    20:21   0:00 grep swap
gluon:/home/olecom#
AFAIK, i use no additionaly daemons for swap.
-----Original Message-----
From: Rik van Riel <riel@redhat.com>
To: "Good Oleg"  <olecom.gnu-linux@mail.ru>
Date: Thu, 5 Feb 2004 21:40:31 -0500 (EST)
Subject: Re: [BUG]: kernel BUG at mm/swapfile.c:806! (2.6)
> 
> Can you reproduce the problem without proprietary drivers loaded ?
> 
> -- 
I'd remove all /lib/modules/2.6.2/, reboot my box, `swapon
/mnt/swap/swap`, gimp, gqview, and: see attach syslog_no_modules.txt
(it's "Tainted: G S"), my .config is in attach my_kconfig.txt (grep -e =y /usr/src/linux/.config > my_kconfig.txt)
-----Original Message-----
From: Hugh Dickins <hugh@veritas.com>
To: "Good Oleg"  <olecom.gnu-linux@mail.ru>
Date: Fri, 6 Feb 2004 07:21:54 +0000 (GMT)
Subject: Re: [BUG]: kernel BUG at mm/swapfile.c:806! (2.6)
> Interesting, thank you.  That's the second report (first on 16 Jan,
> and in that case Not Tainted).  I looked around and found some bugs in
I had "Tained: XFS". I have (as You can see) rootfs on xfs, i removed swap file,
i cheked /dev/hda1 completely via xfs_check, made swap via dd. That didn't help.
--
TNX
request_module: failed /sbin/modprobe -- net-pf-10. error = 256
------------[ cut here ]------------
kernel BUG at mm/swapfile.c:806!
invalid operand: 0000 [#1]
CPU:    0
EIP:    0060:[<c015c7c4>]    Tainted: G S
EFLAGS: 00010246
EIP is at map_swap_page+0x34/0x60
eax: cf23d220   ebx: 00000500   ecx: cf23d220   edx: 00000390
esi: c05a1890   edi: cf23d220   ebp: c05a1880   esp: c135fd3c
ds: 007b   es: 007b   ss: 0068
Process kswapd0 (pid: 9, threadinfo=c135e000 task=c13746b0)
Stack: 00000500 c05a1880 c3989e80 c11953c0 c015a9d2 c05a1880 00000500 c11953c0
       c11953c0 c135fdd4 00000000 c015ab11 00000010 c11953c0 c015aa30 00000500
       c135e000 c11953c0 c135fdd4 c135e000 c014cd15 c11953c0 c135fdb4 00000046
Call Trace:
 [<c015a9d2>] get_swap_bio+0x52/0xb0
 [<c015ab11>] swap_writepage+0x41/0xf0
 [<c015aa30>] end_swap_bio_write+0x0/0x50
 [<c014cd15>] shrink_list+0x3e5/0x6b0
 [<c014ba68>] __pagevec_release+0x28/0x40
 [<c014d1b1>] shrink_cache+0x1d1/0x390
 [<c014d9f4>] shrink_zone+0x94/0xc0
 [<c014de01>] balance_pgdat+0x1a1/0x230
 [<c014dfbf>] kswapd+0x12f/0x150
 [<c01245c0>] autoremove_wake_function+0x0/0x50
 [<c010b4b2>] ret_from_fork+0x6/0x14
 [<c01245c0>] autoremove_wake_function+0x0/0x50
 [<c014de90>] kswapd+0x0/0x150
 [<c01092a9>] kernel_thread_helper+0x5/0xc
Code: 0f 0b 26 03 72 44 46 c0 eb d6 8b 40 04 eb e8 29 d3 31 d2 89
 ------------[ cut here ]------------
kernel BUG at mm/swapfile.c:806!
invalid operand: 0000 [#2]
CPU:    0
EIP:    0060:[<c015c7c4>]    Tainted: G S
EFLAGS: 00010246
EIP is at map_swap_page+0x34/0x60
eax: cf23d420   ebx: 00000501   ecx: cf23d420   edx: 000000e0
esi: c05a1890   edi: cf23d420   ebp: c05a1880   esp: caf87a74
ds: 007b   es: 007b   ss: 0068
Process gimp (pid: 944, threadinfo=caf86000 task=cafaace0)
Stack: 00000501 c05a1880 cd109cc0 c1195370 c015a9d2 c05a1880 00000501 c1195370
       c1195370 caf87b0c 00000000 c015ab11 00000010 c1195370 c015aa30 00000501
       caf86000 c1195370 caf87b0c caf86000 c014cd15 c1195370 caf87aec cffe4a10
Call Trace:
 [<c015a9d2>] get_swap_bio+0x52/0xb0
 [<c015ab11>] swap_writepage+0x41/0xf0
 [<c015aa30>] end_swap_bio_write+0x0/0x50
 [<c014cd15>] shrink_list+0x3e5/0x6b0
 [<c014d1b1>] shrink_cache+0x1d1/0x390
 [<c014d9f4>] shrink_zone+0x94/0xc0
 [<c014dad8>] shrink_caches+0xb8/0xd0
 [<c014db9c>] try_to_free_pages+0xac/0x170
 [<c01465c2>] __alloc_pages+0x1d2/0x350
 [<c0148830>] do_page_cache_readahead+0x160/0x1c0
 [<c01489f3>] page_cache_readahead+0x163/0x1a0
 [<c0142791>] do_generic_mapping_read+0xe1/0x3e0
 [<c0142a90>] file_read_actor+0x0/0x100
 [<c0142d7f>] __generic_file_aio_read+0x1ef/0x220
 [<c0142a90>] file_read_actor+0x0/0x100
 [<c028e1fa>] xfs_ichgtime+0x10a/0x10c
 [<c02ba2f1>] xfs_read+0x171/0x2a0
 [<c033bd03>] __ide_dma_count+0x13/0x20
 [<c033ba30>] __ide_dma_read+0xd0/0xe0
 [<c033b650>] dma_timer_expiry+0x0/0x90
 [<c02b5c4d>] linvfs_read+0x8d/0xa0
 [<c016036b>] do_sync_read+0x8b/0xc0
 [<c011f401>] do_page_fault+0x341/0x53e
 [<c012f96b>] update_wall_time+0xb/0x40
 [<c0160458>] vfs_read+0xb8/0x130
 [<c015fd80>] generic_file_llseek+0x0/0xe0
 [<c0160702>] sys_read+0x42/0x70
 [<c010b5db>] syscall_call+0x7/0xb
Code: 0f 0b 26 03 72 44 46 c0 eb d6 8b 40 04 eb e8 29 d3 31 d2 89
CONFIG_X86=y
CONFIG_MMU=y
CONFIG_UID16=y
CONFIG_GENERIC_ISA_DMA=y
CONFIG_EXPERIMENTAL=y
CONFIG_CLEAN_COMPILE=y
CONFIG_STANDALONE=y
CONFIG_SWAP=y
CONFIG_SYSVIPC=y
CONFIG_SYSCTL=y
CONFIG_IKCONFIG=y
CONFIG_IKCONFIG_PROC=y
CONFIG_KALLSYMS=y
CONFIG_FUTEX=y
CONFIG_EPOLL=y
CONFIG_IOSCHED_NOOP=y
CONFIG_IOSCHED_AS=y
CONFIG_IOSCHED_DEADLINE=y
CONFIG_MODULES=y
CONFIG_MODULE_UNLOAD=y
CONFIG_MODULE_FORCE_UNLOAD=y
CONFIG_OBSOLETE_MODPARM=y
CONFIG_KMOD=y
CONFIG_X86_PC=y
CONFIG_MK7=y
CONFIG_X86_GENERIC=y
CONFIG_X86_CMPXCHG=y
CONFIG_X86_XADD=y
CONFIG_RWSEM_XCHGADD_ALGORITHM=y
CONFIG_X86_WP_WORKS_OK=y
CONFIG_X86_INVLPG=y
CONFIG_X86_BSWAP=y
CONFIG_X86_POPAD_OK=y
CONFIG_X86_GOOD_APIC=y
CONFIG_X86_INTEL_USERCOPY=y
CONFIG_X86_USE_PPRO_CHECKSUM=y
CONFIG_X86_USE_3DNOW=y
CONFIG_HPET_TIMER=y
CONFIG_SMP=y
CONFIG_PREEMPT=y
CONFIG_X86_LOCAL_APIC=y
CONFIG_X86_IO_APIC=y
CONFIG_X86_TSC=y
CONFIG_X86_MCE=y
CONFIG_X86_MCE_NONFATAL=y
CONFIG_X86_MCE_P4THERMAL=y
CONFIG_X86_CPUID=y
CONFIG_NOHIGHMEM=y
CONFIG_MTRR=y
CONFIG_HAVE_DEC_LOCK=y
CONFIG_PM=y
CONFIG_ACPI=y
CONFIG_ACPI_BOOT=y
CONFIG_ACPI_INTERPRETER=y
CONFIG_ACPI_SLEEP=y
CONFIG_ACPI_SLEEP_PROC_FS=y
CONFIG_ACPI_AC=y
CONFIG_ACPI_BATTERY=y
CONFIG_ACPI_BUTTON=y
CONFIG_ACPI_FAN=y
CONFIG_ACPI_PROCESSOR=y
CONFIG_ACPI_THERMAL=y
CONFIG_ACPI_BUS=y
CONFIG_ACPI_EC=y
CONFIG_ACPI_POWER=y
CONFIG_ACPI_PCI=y
CONFIG_ACPI_SYSTEM=y
CONFIG_APM_CPU_IDLE=y
CONFIG_APM_RTC_IS_GMT=y
CONFIG_PCI=y
CONFIG_PCI_GOANY=y
CONFIG_PCI_BIOS=y
CONFIG_PCI_DIRECT=y
CONFIG_PCI_NAMES=y
CONFIG_BINFMT_ELF=y
CONFIG_BINFMT_AOUT=y
CONFIG_BINFMT_MISC=y
CONFIG_PARPORT=y
CONFIG_PARPORT_PC=y
CONFIG_PARPORT_1284=y
CONFIG_BLK_DEV_LOOP=y
CONFIG_BLK_DEV_RAM=y
CONFIG_BLK_DEV_INITRD=y
CONFIG_LBD=y
CONFIG_IDE=y
CONFIG_BLK_DEV_IDE=y
CONFIG_BLK_DEV_IDEDISK=y
CONFIG_IDEDISK_MULTI_MODE=y
CONFIG_BLK_DEV_IDECD=y
CONFIG_BLK_DEV_IDESCSI=y
CONFIG_IDE_TASKFILE_IO=y
CONFIG_IDE_GENERIC=y
CONFIG_BLK_DEV_CMD640=y
CONFIG_BLK_DEV_IDEPCI=y
CONFIG_IDEPCI_SHARE_IRQ=y
CONFIG_BLK_DEV_GENERIC=y
CONFIG_BLK_DEV_RZ1000=y
CONFIG_BLK_DEV_IDEDMA_PCI=y
CONFIG_IDEDMA_PCI_AUTO=y
CONFIG_BLK_DEV_ADMA=y
CONFIG_BLK_DEV_AMD74XX=y
CONFIG_BLK_DEV_PIIX=y
CONFIG_BLK_DEV_VIA82CXXX=y
CONFIG_BLK_DEV_IDEDMA=y
CONFIG_IDEDMA_AUTO=y
CONFIG_SCSI=y
CONFIG_SCSI_PROC_FS=y
CONFIG_BLK_DEV_SD=y
CONFIG_CHR_DEV_SG=y
CONFIG_SCSI_REPORT_LUNS=y
CONFIG_SCSI_SATA=y
CONFIG_SCSI_QLA2XXX_CONFIG=y
CONFIG_I2O=y
CONFIG_NET=y
CONFIG_PACKET=y
CONFIG_UNIX=y
CONFIG_INET=y
CONFIG_IP_MULTICAST=y
CONFIG_IP_PNP=y
CONFIG_IP_PNP_DHCP=y
CONFIG_IP_PNP_BOOTP=y
CONFIG_SYN_COOKIES=y
CONFIG_BRIDGE=y
CONFIG_NETFILTER=y
CONFIG_BRIDGE_NETFILTER=y
CONFIG_IP_NF_QUEUE=y
CONFIG_IP_NF_IPTABLES=y
CONFIG_IP_NF_MATCH_LIMIT=y
CONFIG_IP_NF_MATCH_IPRANGE=y
CONFIG_IP_NF_MATCH_MAC=y
CONFIG_IP_NF_MATCH_PKTTYPE=y
CONFIG_IP_NF_MATCH_MARK=y
CONFIG_IP_NF_MATCH_MULTIPORT=y
CONFIG_IP_NF_MATCH_TOS=y
CONFIG_IP_NF_MATCH_RECENT=y
CONFIG_IP_NF_MATCH_ECN=y
CONFIG_IP_NF_MATCH_DSCP=y
CONFIG_IP_NF_MATCH_AH_ESP=y
CONFIG_IP_NF_MATCH_LENGTH=y
CONFIG_IP_NF_MATCH_TTL=y
CONFIG_IP_NF_MATCH_TCPMSS=y
CONFIG_IP_NF_MATCH_OWNER=y
CONFIG_IP_NF_MATCH_PHYSDEV=y
CONFIG_IP_NF_FILTER=y
CONFIG_IP_NF_TARGET_REJECT=y
CONFIG_IP_NF_NAT_NEEDED=y
CONFIG_IP_NF_NAT_LOCAL=y
CONFIG_IP_NF_MANGLE=y
CONFIG_IP_NF_TARGET_TOS=y
CONFIG_IP_NF_TARGET_ECN=y
CONFIG_IP_NF_TARGET_DSCP=y
CONFIG_IP_NF_TARGET_MARK=y
CONFIG_IP_NF_TARGET_CLASSIFY=y
CONFIG_IP_NF_TARGET_LOG=y
CONFIG_IP_NF_TARGET_ULOG=y
CONFIG_IP_NF_TARGET_TCPMSS=y
CONFIG_IP_NF_ARPTABLES=y
CONFIG_IP_NF_ARPFILTER=y
CONFIG_IP_NF_ARP_MANGLE=y
CONFIG_IPV6_SCTP__=y
CONFIG_NET_PKTGEN=y
CONFIG_NETDEVICES=y
CONFIG_NET_ETHERNET=y
CONFIG_MII=y
CONFIG_NET_PCI=y
CONFIG_8139TOO=y
CONFIG_PPP_MULTILINK=y
CONFIG_IRDA_ULTRA=y
CONFIG_IRDA_DEBUG=y
CONFIG_INPUT=y
CONFIG_INPUT_MOUSEDEV=y
CONFIG_INPUT_MOUSEDEV_PSAUX=y
CONFIG_SOUND_GAMEPORT=y
CONFIG_SERIO=y
CONFIG_SERIO_I8042=y
CONFIG_INPUT_KEYBOARD=y
CONFIG_KEYBOARD_ATKBD=y
CONFIG_INPUT_MOUSE=y
CONFIG_MOUSE_PS2=y
CONFIG_MOUSE_SERIAL=y
CONFIG_INPUT_MISC=y
CONFIG_INPUT_PCSPKR=y
CONFIG_VT=y
CONFIG_VT_CONSOLE=y
CONFIG_HW_CONSOLE=y
CONFIG_SERIAL_8250_ACPI=y
CONFIG_SERIAL_8250_EXTENDED=y
CONFIG_SERIAL_8250_SHARE_IRQ=y
CONFIG_SERIAL_8250_DETECT_IRQ=y
CONFIG_UNIX98_PTYS=y
CONFIG_PRINTER=y
CONFIG_PPDEV=y
CONFIG_GEN_RTC_X=y
CONFIG_AGP=y
CONFIG_AGP_VIA=y
CONFIG_DRM=y
CONFIG_VGA_CONSOLE=y
CONFIG_DUMMY_CONSOLE=y
CONFIG_SOUND=y
CONFIG_SND=y
CONFIG_SND_SEQUENCER=y
CONFIG_SND_OSSEMUL=y
CONFIG_SND_MIXER_OSS=y
CONFIG_SND_PCM_OSS=y
CONFIG_SND_SEQUENCER_OSS=y
CONFIG_USB=y
CONFIG_USB_DEVICEFS=y
CONFIG_USB_EHCI_HCD=y
CONFIG_USB_UHCI_HCD=y
CONFIG_USB_STORAGE=y
CONFIG_USB_STORAGE_DEBUG=y
CONFIG_USB_GADGET_NET2280=y
CONFIG_EXT2_FS=y
CONFIG_EXT3_FS=y
CONFIG_EXT3_FS_XATTR=y
CONFIG_EXT3_FS_POSIX_ACL=y
CONFIG_EXT3_FS_SECURITY=y
CONFIG_JBD=y
CONFIG_FS_MBCACHE=y
CONFIG_FS_POSIX_ACL=y
CONFIG_XFS_FS=y
CONFIG_XFS_RT=y
CONFIG_XFS_QUOTA=y
CONFIG_XFS_POSIX_ACL=y
CONFIG_ROMFS_FS=y
CONFIG_QUOTA=y
CONFIG_QUOTACTL=y
CONFIG_AUTOFS4_FS=y
CONFIG_ISO9660_FS=y
CONFIG_JOLIET=y
CONFIG_UDF_FS=y
CONFIG_FAT_FS=y
CONFIG_MSDOS_FS=y
CONFIG_VFAT_FS=y
CONFIG_PROC_FS=y
CONFIG_PROC_KCORE=y
CONFIG_DEVFS_FS=y
CONFIG_DEVFS_MOUNT=y
CONFIG_DEVPTS_FS=y
CONFIG_DEVPTS_FS_XATTR=y
CONFIG_DEVPTS_FS_SECURITY=y
CONFIG_TMPFS=y
CONFIG_RAMFS=y
CONFIG_NFS_FS=y
CONFIG_NFS_V3=y
CONFIG_NFS_V4=y
CONFIG_NFSD=y
CONFIG_NFSD_V3=y
CONFIG_NFSD_V4=y
CONFIG_NFSD_TCP=y
CONFIG_LOCKD=y
CONFIG_LOCKD_V4=y
CONFIG_EXPORTFS=y
CONFIG_SUNRPC=y
CONFIG_SMB_FS=y
CONFIG_SMB_NLS_DEFAULT=y
CONFIG_MSDOS_PARTITION=y
CONFIG_NLS=y
CONFIG_NLS_CODEPAGE_437=y
CONFIG_NLS_CODEPAGE_850=y
CONFIG_NLS_CODEPAGE_855=y
CONFIG_NLS_CODEPAGE_866=y
CONFIG_NLS_CODEPAGE_1251=y
CONFIG_NLS_ISO8859_1=y
CONFIG_NLS_ISO8859_5=y
CONFIG_NLS_ISO8859_15=y
CONFIG_NLS_KOI8_R=y
CONFIG_NLS_KOI8_U=y
CONFIG_NLS_UTF8=y
CONFIG_DEBUG_KERNEL=y
CONFIG_MAGIC_SYSRQ=y
CONFIG_DEBUG_SPINLOCK_SLEEP=y
CONFIG_X86_FIND_SMP_CONFIG=y
CONFIG_X86_MPPARSE=y
CONFIG_CRC32=y
CONFIG_X86_SMP=y
CONFIG_X86_HT=y
CONFIG_X86_BIOS_REBOOT=y
CONFIG_X86_TRAMPOLINE=y
CONFIG_PC=y