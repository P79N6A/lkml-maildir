Date: Mon, 19 Nov 2007 05:32:40 -0700
From: Matthew Wilcox <>
Subject: Re: SCSI breakage on non-cache coherent architectures
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/11/19/64

On Mon, Nov 19, 2007 at 04:35:23PM +1100, Benjamin Herrenschmidt wrote:
> The other one I'm hitting now is that the SCSI layer nowadays embeds the
'nowadays'?  It has always been so.
> sense_buffer inside the scsi_cmnd structure without any kind of
> alignment whatsoever. I've been hitting irregulary is a crash on SCSI command
> completion that seems to be related to corruption of the "request"
> pointer in struct scsi_cmnd and I think it might be the cause.
> I'm now trying to setup a proper repro-case.
What other drivers do is DMA to their own allocation and then memcpy to
the sense buffer.
There is a movement to allocate the sense data as its own sg list, but
I don't think that patch has even been posted yet.
-- 
Intel are signing my paycheques ... these opinions are still mine
"Bill, look, we understand that you're interested in selling us this
operating system, but compare it to ours.  We can't possibly take such
a retrograde step."
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/