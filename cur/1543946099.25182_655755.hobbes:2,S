Date: Mon, 18 Feb 2008 10:53:42 -0800
From: Roland Dreier <>
Subject: Re: Unable to continue testing of 2.6.25
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/18/378

 > I've yet to see a user who wants WC. Lets face it, WC *sucks*. This is why
 > the folks who care about performance (the graphics guys) stopped using it.
 > WC is slow, and on modern cpus leads to really bad performance. I'm really
 > half tempted to just ignore WC entirely and suggest that we don't even implement
 > it in the kernel. Yes it's really that bad.
I know of one case at least where WC is very useful.  Some InfiniBand
adapters allow small messages to be written directly into the
adapter's PCI space BAR to lower latency (having the CPU write the
message avoids doing something like build descriptor, ring doorbell
register on adapter, adapter DMA message out of CPU memory).  And
mapping the PCI space with WC is a pretty big win -- for example for
mlx4 hardware it gets MPI latency from ~1.8 usec to ~1.3 usec which is
a big deal.  I think most real users of mlx4 hardware are using a
hacky out-of-tree patch to allow using PAT to set WC.
AFAIK mapping PCI memory WB is not allowed, so WC is really our only choice.
 - R.