Date: Wed, 26 May 2004 10:05:32 -0800
From: "Parag Sharma" <>
Subject: Question on the condition parameter in wait_event_interruptible()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/5/26/197

I looked at the kernel 2.4.21 sources and found that the 'condition' in 
calls to wait_event_interruptible() is usually a global variable. This 
global variable is updated before the wakeup is issued.
It is not clear to me how this update to the global variable is seen by the 
context that issued the wait_event_interruptible(). On certain processor 
architectures and on SMP systems, is it possible that the update is not 
reflected when the condition is tested in __wait_event_interruptible()?
If the answer to above is yes, then is it possible that there is a chance 
that a wakeup might be missed when the update & wakeup occur either before 
the call to add_wait_queue() or the call to 
set_current_state(TASK_INTERRUPTIBLE) in __wait_event_interruptible()?
Thanks,
Parag
PS: Please cc me on the reply.
#define __wait_event_interruptible(wq, condition, ret)                  \
do {                                                                    \
        wait_queue_t __wait;                                            \
        init_waitqueue_entry(&__wait, current);                         \
                                                                        \
        add_wait_queue(&wq, &__wait);                                   \
        for (;;) {                                                      \
                set_current_state(TASK_INTERRUPTIBLE);                  \
                if (condition)                                          \
                        break;                                          \
                if (!signal_pending(current)) {                         \
                        schedule();                                     \
                        continue;                                       \
                }                                                       \
                ret = -ERESTARTSYS;                                     \
                break;                                                  \
        }                                                               \
        current->state = TASK_RUNNING;                                  \
        remove_wait_queue(&wq, &__wait);                                \
} while (0)
_________________________________________________________________
Watch LIVE baseball games on your computer with MLB.TV, included with MSN 
Premium! 
http://join.msn.click-url.com/go/onm00200439ave/direct/01/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/