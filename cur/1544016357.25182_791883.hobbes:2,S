Date: Wed, 14 Jan 2009 10:15:01 +0000
From: richard kennedy <>
Subject: Re: [PATCH] module: kzalloc mod->ref
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/14/124

Kyle McMartin wrote:
> From: Kyle McMartin <kyle@redhat.com>
> 
> Dynamically allocate mod->ref instead of fixing it in the struct module.
> Reduces on disk space wasted in the module .ko, and kills a loop
> initializing the local_t it contains since we can just kzalloc it.
> 
> This matters when we're talking about large NR_CPUS.
> 
> Signed-off-by: Kyle McMartin <kyle@redhat.com>
> ---
> The patch removing cacheline_aligned from struct module_ref should be
> applied as well to cut down on the amount of memory we allocate. This
> patch makes a nice stopgap until we have per_cpu module references.
> 
> cheers, Kyle
> 
Hi Kyle,
As module_get/ put use module_ref as a per_cpu variable won't removing
the cacheline_aligned be a performance hit due to cacheline sharing on
machines with reasonable or small number of cpus?
(some of the network code seems to call module_get/put a lot!)
regards
Richard