Date: Wed, 9 Jan 2008 07:57:32 +0000
From: Christoph Hellwig <>
Subject: Re: [PATCHv3] kprobes: Introduce kprobe_handle_fault()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/9/36

On Tue, Jan 08, 2008 at 08:19:20PM -0800, Harvey Harrison wrote:
> Use a central kprobe_handle_fault() inline in kprobes.h to remove
> all of the arch-dependant, practically identical implementations in
> avr32, ia64, powerpc, s390, sparc64, and x86.
> 
> avr32 was the only arch without the preempt_disable/enable pair
> in its notify_page_fault implementation.
> 
> This uncovered a possible bug in the s390 version as that purely
> copied the x86 version unconditionally passing 14 as the trapnr
> rather than the error_code parameter.
This is not an equivalnet transformation.  The old code always made
sure to disable preemption and the new one just skips the whole
kprobes handler if preemption is enabled.  Please separate code
consolidation from changing semantics _and_ describe the semantics
changes in detail.