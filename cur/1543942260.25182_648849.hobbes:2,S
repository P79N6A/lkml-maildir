Date: Tue, 05 Feb 2008 17:04:30 -0500
From: Lee Schermerhorn <>
Subject: Re: [2.6.24-rc8-mm1][regression?] numactl --interleave=all doesn't works on memoryless node.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/5/459

On Tue, 2008-02-05 at 15:33 -0600, Paul Jackson wrote:
> David wrote:
> > It would be disappointing to see a lot of work done to fix
> 
> The suggested patch of KOSAKI Motohiro didn't look like a lot of work to me.
> 
> I continue to prefer not to hijack this thread for that other discussion.
> Just presenting your position and calling it "simple" is misleading.
> The discussion so far has involved over a hundred messages over months,
> and certainly your position, nor mine for that matter, obtained concensus.
> 
> How does the patch of KOSAKI Motohiro, earlier in this thread, look to you?
> 
Paul,
It wasn't clear to me whether Kosaki-san's patch required a modified
numactl/libnuma or not.   I think so, because that patch doesn't change
the error return in contextualize_policy() and in mpol_check_policy().
My modified numactl/libnuma avoids this by only passing in allowed mems
fetch via get_mempolicy() with the new MEMS_ALLOWED flags.
The patch I just posted doesn't depend on the numactl changes and seems
quite minimal to me.  I think it cleans up the differences between
set_mempolicy() and mbind(), as well.  However, some may take exception
to the change in behavior--silently ignoring dis-allowed nodes in
set_mempolicy().
Also, your cpuset/mempolicy work will probably need to undo the
unconditional masking in contextualize_policy() and/or save the original
node mask somewhere...
Lee