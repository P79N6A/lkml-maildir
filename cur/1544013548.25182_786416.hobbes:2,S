Date: Sun, 4 Jan 2009 04:23:49 -0500
From: Christoph Hellwig <>
Subject: Re: XFS internal error xfs_da_do_buf(1) at line 2015 of file fs/xfs/xfs_da_btree.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/4/30

On Sun, Jan 04, 2009 at 07:03:23PM +1000, Adam Nielsen wrote:
> No, I didn't realise I had to do that...in fact I didn't even realise 
> SATA disks *had* write caches, I thought the cache was for reading 
> only...
Which would be the better default (it's what high-end disks generally
do by default).  I've been wondering for a while how we can make default
setups in the presence of lvm/dm more secure, but there hasn't been
any progress yet.
>> Run xfs_repair over it to fix up the directory, and make sure to
>> configure your disks properly so that it doesn't happen again..
>
> Will do, thanks for the advice!  Is there any standard way to disable 
> write caching on a SATA disk?  hdparm -W seems to do the trick, but then 
> I can't run that until the system is up and running, leaving a small 
> window of opportunity for something to go wrong.
On Debian based systems you can add -W0 to /etc/default/hdparm and
it gets executed before the root filesystem is remounted read-write,
I'm not sure how other distributions handle it.