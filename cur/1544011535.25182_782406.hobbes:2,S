Date: Fri, 19 Dec 2008 16:30:36 +0900
From: "Magnus Damm" <>
Subject: Re: [PATCH] clocksource: pass clocksource to read() callback
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/19/33

On Thu, Dec 18, 2008 at 10:56 AM, Andrew Morton
<akpm@linux-foundation.org> wrote:
> On Thu, 11 Dec 2008 20:48:02 +0900
> Magnus Damm <magnus.damm@gmail.com> wrote:
>
>> Pass clocksource pointer to the read() callback for clocksources.
>> This allows us to share the callback between multiple instances.
>
> sparc64 allmodconfig:
>
>
>  CHK     include/linux/version.h
>  CHK     include/linux/utsrelease.h
>  SYMLINK include/asm -> include/asm-sparc
>  CC      arch/sparc/kernel/asm-offsets.s
> In file included from include/linux/ktime.h:25,
>                 from include/linux/timer.h:5,
>                 from include/linux/clocksource.h:16,
>                 from /usr/src/devel/arch/sparc/include/asm/timer_64.h:11,
>                 from /usr/src/devel/arch/sparc/include/asm/timer.h:4,
>                 from /usr/src/devel/arch/sparc/include/asm/timex_64.h:9,
>                 from /usr/src/devel/arch/sparc/include/asm/timex.h:4,
>                 from include/linux/timex.h:170,
>                 from include/linux/sched.h:54,
>                 from arch/sparc/kernel/asm-offsets.c:13:
> include/linux/jiffies.h:247:31: warning: "CLOCK_TICK_RATE" is not defined
[lot's of warning snipped]
How about the (unfortunately most likely mangled) patch below? Does it
help? If not then i'll setup a cross compiler.
Dave, do you want me to rework the patch somehow?
Thanks!
/ magnus
--- 0001/arch/sparc/include/asm/timex_64.h
+++ work/arch/sparc/include/asm/timex_64.h	2008-12-19 16:21:53.000000000 +0900
@@ -6,10 +6,10 @@
 #ifndef _ASMsparc64_TIMEX_H
 #define _ASMsparc64_TIMEX_H
-#include <asm/timer.h>
-
 #define CLOCK_TICK_RATE	1193180 /* Underlying HZ */
+#include <asm/timer.h>
+
 /* Getting on the cycle counter on sparc64. */
 typedef unsigned long cycles_t;
 #define get_cycles()	tick_ops->get_tick()