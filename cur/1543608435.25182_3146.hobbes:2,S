Date: Sun, 04 Nov 2001 00:34:55 -0000
From: Alex Bligh - linux-kernel <>
Subject: Re: [PATCH] IBM T23; quirks force enable interrupts in APM set power state, causes crash on suspend
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/11/3/76

Thomas,
--On Saturday, 03 November, 2001 7:20 PM -0500 Thomas Hood 
<jdthood@mail.com> wrote:
>> Summary: dmi_scan.c forces interrupt enable on during PCI BIOS
>> call for all IBM machines, which breaks T23, which needs it
>> off it seems.
> [...]
>> BIOS Vendor: IBM
>> BIOS Version: 1AET38WW (1.01b)
>> BIOS Release: 07/27/2001
>
> I would suggest that you try upgrading your firmware before
> concluding that your patch is necessary.  The latest firmware
> listed on IBM's website is version 1.03 = 1AET43WW,
> released 19 October 2001.  There have been a LOT of changes since
> version 1.01 of the firmware.  Here is IBM's changelog:
Here's the results
With my patch on 2.4.12-ac5, it was working.
First I took Arjan's pci-bridge patch alone (no BIOS
upgrade etc.). It crashes the machine on suspend.
Then I tried upgrading the BIOS firmware (to 1.03) and
the embedded controller firmware (to 1.02) - i.e. without
Arjan's patch, still running 2.4.12-ac5. It doesn't
resume properly and hung APM but didn't crash.
I believe this may be because I fixed the .config
to run the sound driver at the same time, and it oops'd,
and generally annoyed the suspend process - tsk tsk
changing too many variables at once.
Then I upgraded to 2.4.13-ac7 (which has Arjan's patch
in). All is now well. Any luck & I'll have sound working
too :-)
My conclusion is that the BIOS upgrade fixed the
necessity to call APM BIOS with interrupts off,
so the dmi_scan.c stuff which forces interrupts on
is now harmless.
So if you want to put a patch in, I guess it could
at least not break things on early T-23 BIOS's
(as that's what the dmi_scan does - as the config
option no longer has any effect), or at the /very/
least, document the fact that a BIOS & embedded
controller upgrade is extremely advisable.
[ I am recording T23 experiences at
    
http://www.alex.org.uk/T23
  for anyone interested - especially in contributing]
--
Alex Bligh
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/