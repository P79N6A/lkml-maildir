Date: Sat, 26 Aug 2000 02:41:13 +0200
From: Andries Brouwer <>
Subject: Re: ide20000805 partition table detection error w/ Via 82C586
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/25/177

On Fri, Aug 25, 2000 at 07:25:33PM -0400, Dan Hopper wrote:
> Just to see how it worked, I installed
> 
ftp://ftp.us.kernel.org/pub/linux/kernel/people/hedrick/ide.2.2.16.all.20000805.patch.gz
> The problem I was curious to see if it solved
> was that my devices on the secondary cable were not getting detected
> as UDMA capable (at least not automatically), using stock 2.2.16.
> 
> It did in fact appear to solve that problem, but it created another. 
> It doesn't appear to pull the correct geometry from hdc, which is an
> IBM Deskstar 75GXP 30G drive.
>
> The stock 2.2.16 case:
> ...
> hda: IBM-DHEA-38451, 8063MB w/472kB Cache, CHS=1027/255/63, UDMA
> hdb: IBM-DTTA-371440, 13783MB w/462kB Cache, CHS=1757/255/63, UDMA
> hdc: IBM-DTLA-307030, 29314MB w/1916kB Cache, CHS=59560/16/63
> ...
> Partition check:
>  hda: hda1 hda2 < hda5 hda6 >
>  hdb: hdb1 < hdb5 hdb6 > hdb2 hdb3
>  hdc: [PTBL] [3737/255/63] hdc1 < hdc5 hdc6 >
>
> In the 20000805 patch case:
> 
> hda: IBM-DHEA-38451, 8063MB w/472kB Cache, CHS=1027/255/63, UDMA(33)
> hdb: IBM-DTTA-371440, 13783MB w/462kB Cache, CHS=1757/255/63, UDMA(33)
> hdc: IBM-DTLA-307030, 29314MB w/1916kB Cache, CHS=59560/16/63, UDMA(66)
> ...
> Partition check:
>  hda: hda1 hda2 < hda5 hda6 >
>  hdb: hdb1 < hdb5 hdb6 > hdb2 hdb3
>  hdc: [PTBL] [1027/255/63] hdc1 < hdc5 hdc6 >
Yes, so all is fine except that this IDE patch mistreats the
partition table derived geometry.
Look at the file drivers/ide/ide-geometry.c as found e.g.
in 2.4.0test7. Take the routine ontrack() from there and
replace the routine ontrack() in Andre's patch by it.
I suspect that all will be well.
Andries
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/