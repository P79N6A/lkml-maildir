Date: Thu, 5 Jul 2007 00:43:47 +0400
From: Alexey Dobriyan <>
Subject: Re: [patch 09/10] F00F bug fixup for i386 - use immediate values
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/4/248

On Tue, Jul 03, 2007 at 12:40:55PM -0400, Mathieu Desnoyers wrote:
> Use the faster immediate values for F00F bug handling in do_page_fault.
> --- linux-2.6-lttng.orig/arch/i386/mm/fault.c
> +++ linux-2.6-lttng/arch/i386/mm/fault.c
> @@ -25,6 +25,7 @@
>  #include <linux/kprobes.h>
>  #include <linux/uaccess.h>
>  #include <linux/kdebug.h>
> +#include <linux/immediate.h>
> 
>  #include <asm/system.h>
>  #include <asm/desc.h>
> @@ -477,7 +478,7 @@
>  	/*
>  	 * Pentium F0 0F C7 C8 bug workaround.
>  	 */
> -	if (boot_cpu_data.f00f_bug) {
> +	if (unlikely(immediate(f00f_bug_fix))) {
As I understand it, this never triggers in normal valid and invalid
pagefaults, because even invalid userspace pagefaults take branch
slightly earlier where catch SIGSEGV. Nobody cares about performance if
you reach this branch.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/