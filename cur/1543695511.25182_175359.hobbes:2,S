Date: Tue, 28 Oct 2003 10:35:20 +0100
From: Lars Knudsen <>
Subject: Re: SiS900 driver multicast problems and patch.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/10/28/20

Måns Rullgård wrote:
>Lars Knudsen <gandalf@revicon.com> writes:
>
> 
>
>>After upgrading to kernel 2.4.22 we discovered that multicast was no
>>longer handled properly by the SiS900. Examining the changes between
>>2.4.19 and 2.4.22 it is clear that the handling of multicast was
>>changed but a bug was introduced.
>> 
>>
>
>Your patch is broken.  Long lines are wrapped, tabs are converted to
>spaces and it is reversed.
> 
>
Ah, the wonders of cut and paste and a mail program trying to be helpfull.
Here is an updated version. Sorry for the extra noise.
\Lars Knudsen
--- sis900.c.orig	Mon Oct 27 17:48:52 2003
+++ sis900.c	Mon Oct 27 17:49:36 2003
@@ -2101,9 +2101,8 @@
 		rx_mode = RFAAB;
 		for (i = 0, mclist = net_dev->mc_list; mclist && i < net_dev->mc_count;
 		     i++, mclist = mclist->next) {
-			unsigned int bit_nr =
-				sis900_mcast_bitnr(mclist->dmi_addr, revision);
-			mc_filter[bit_nr >> 4] |= (1 << bit_nr);
+			set_bit(sis900_mcast_bitnr(mclist->dmi_addr, revision),
+				mc_filter);
 		}
 	}
 