Date: Thu, 13 Jul 2000 23:48:00 +0200 (CEST)
From: Andrzej Krzysztofowicz <>
Subject: [PATCH] non-modular compilation
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/13/238

Hi,
The following patch fixes non-module compilation of some drivers in
test4-pre6.
Regards
   Andrzej
*************************************************************************
diff -u --recursive linux-2.4test4-6/drivers/net/acenic.c linux/drivers/net/acenic.c
--- linux-2.4test4-6/drivers/net/acenic.c	Mon May 15 21:10:26 2000
+++ linux/drivers/net/acenic.c	Thu Jul 13 12:57:58 2000
@@ -606,6 +606,7 @@
 MODULE_PARM(max_tx_desc, "1-" __MODULE_STRING(8) "i");
 MODULE_PARM(rx_coal_tick, "1-" __MODULE_STRING(8) "i");
 MODULE_PARM(max_rx_desc, "1-" __MODULE_STRING(8) "i");
+#endif
 
 
 void __exit ace_module_cleanup(void)
@@ -695,7 +696,6 @@
 		root_dev = next;
 	}
 }
-#endif
 
 
 int __init ace_module_init(void)
@@ -714,6 +714,7 @@
 
 
 #if (LINUX_VERSION_CODE < 0x02032a)
+#ifdef MODULE
 int init_module(void)
 {
 	return ace_module_init();
@@ -724,6 +725,7 @@
 {
 	ace_module_cleanup();
 }
+#endif /* MODULE */
 #else
 module_init(ace_module_init);
 module_exit(ace_module_cleanup);
diff -u --recursive linux-2.4test4-6/drivers/net/appletalk/ltpc.c linux/drivers/net/appletalk/ltpc.c
--- linux-2.4test4-6/drivers/net/appletalk/ltpc.c	Wed Jul  5 19:56:13 2000
+++ linux/drivers/net/appletalk/ltpc.c	Thu Jul 13 12:57:58 2000
@@ -1271,14 +1271,8 @@
 }
 
 __setup("ltpc=", ltpc_setup);
-#endif /* MODULE */
-
-MODULE_PARM(debug, "i");
-MODULE_PARM(io, "i");
-MODULE_PARM(irq, "i");
-MODULE_PARM(dma, "i");
 
-#ifdef MODULE
+#endif /* MODULE */
 
 static struct net_device dev_ltpc = {
 		"", 
@@ -1286,6 +1280,13 @@
 	 	0x0, 0,
 	 	0, 0, 0, NULL, ltpc_probe };
 
+#ifdef MODULE
+
+MODULE_PARM(debug, "i");
+MODULE_PARM(io, "i");
+MODULE_PARM(irq, "i");
+MODULE_PARM(dma, "i");
+
 int __init init_module(void)
 {
 	int err, result;
@@ -1308,7 +1309,7 @@
 		return 0;
 	}
 }
-#endif
+#endif /* MODULE */
 
 static void __exit ltpc_cleanup(void)
 {
diff -u --recursive linux-2.4test4-6/net/atm/mpoa_proc.c linux/net/atm/mpoa_proc.c
--- linux-2.4test4-6/net/atm/mpoa_proc.c	Sun Jul  9 04:26:13 2000
+++ linux/net/atm/mpoa_proc.c	Thu Jul 13 12:57:58 2000
@@ -1,4 +1,5 @@
 #include <linux/config.h>
+#include <linux/module.h>
 
 #ifdef CONFIG_PROC_FS
 #include <linux/errno.h>
diff -u --recursive linux-2.4test4-6/drivers/net/wan/cycx_main.c linux/drivers/net/wan/cycx_main.c
--- linux-2.4test4-6/drivers/net/wan/cycx_main.c	Tue Jun 20 23:14:51 2000
+++ linux/drivers/net/wan/cycx_main.c	Thu Jul 13 13:05:43 2000
@@ -103,7 +103,7 @@
  *		< 0	error.
  * Context:	process
  */
-static int __init cyclomx_init (void)
+int __init cyclomx_init (void)
 {
 	int cnt, err = 0;
 
*************************************************************************
-- 
=======================================================================
  Andrzej M. Krzysztofowicz               ankry@mif.pg.gda.pl
  phone (48)(58) 347 14 61
Faculty of Applied Phys. & Math.,   Technical University of Gdansk
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/