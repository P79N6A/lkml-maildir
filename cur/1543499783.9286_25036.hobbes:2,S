Date: Sun, 20 Jun 1999 16:37:52 METDST
From: furio ercolessi <>
Subject: Problem: Alpha, 2.2.7 "fork: Cannot allocate memory"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/6/20/38

Hello linux-kernel,
I am not a list reader but I have been recommended to let you guys
aware of my problem.
h/w: Alpha 21164/533 MHz, LX board, 512 MB RAM
base installation: RedHat 5.2
kernel: 2.2.7 compiled with: gcc version egcs-2.90.29 980515 (egcs-1.0.3 release)
swap: 256MB in a single partition
defaults changed:
	NR_OPEN from 1024 to 16384 (fs.h, limits.h)
	NR_FILE from 4096 to 16384 (fs.h)
	OPEN_MAX from 256 to 4096  (limits.h)
	__FD_SETSIZE from 1024 to 16384 (posix_types.h)
operational conditions: postfix (MTA) and squid (web caching)
	in a production environment
Problem: occasionally the system refuses to start new processes,
apparently without a valid reason.  Here is an example: 
-------------------------------------------------
# man ps
Formatting page, please wait...
sh: fork: Cannot allocate memory
sh: fork: Cannot allocate memory
Error executing formatting or display command.
[...]
# free
             total       used       free     shared    buffers     cached
Mem:        516720     510696       6024      71416     214536      97896
-/+ buffers/cache:     198264     318456
Swap:       262136       2280     259856
-------------------------------------------------
Of the 198MB used, about 120MB were used by squid.  
There were about 100 processes active.  
NR_TASKS was the default of 512; raising it to 4096 did not help.
I also tried to add an additional 1GB of swap (on a file), which
did not help either.
This problem did not appear when running postfix only (which
generates quite a bit of processes but does not use much
memory), or squid only (which uses a lot of memory but is
essentially a single-process application): it required both
products to operate simultaneously to manifest.
Memory allocation by squid appeared to be regular (that is,
"Total in use" only slightly larger than "Total accounted").
I moved to 2.0.37 and the problem disappeared.  Unfortunately
I am not in the position to do further testing with 2.2.x right now.
furio ercolessi
Spin - Trieste (Italy)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/