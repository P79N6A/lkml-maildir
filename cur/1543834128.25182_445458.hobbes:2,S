Date: Wed, 19 Jul 2006 11:36:02 -0400
From: Michael Krufky <>
Subject: Re: [v4l-dvb-maintainer] Re: [PATCH] V4L: struct video_device	corruption
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/19/88

Mauro Carvalho Chehab wrote:
> Em Seg, 2006-07-17 Ã s 17:25 -0700, Trent Piepho escreveu:
>> On Sat, 15 Jul 2006, Mauro Carvalho Chehab wrote:
>>> Em Sb, 2006-07-15 s 23:08 +0000, Robert Fitzsimons escreveu:
>>>> The layout of struct video_device would change depending on whether
>>>> videodev.h (V4L1) was include or not before v4l2-dev.h, which caused
>>>> the structure to get corrupted.
>>> Hmm... good point! However, I the proper solution would be to trust on
>>> CONFIG_VIDEO_V4L1_COMPAT or CONFIG_VIDEO_V4L1 instead. it makes no sense
>>> to keep a pointer to an unsupported callback, when V4L1 is not selected.
>> It's not so clear that the problem is with v4l2-dev.h, because if you look
>> that file:
>>
>> #ifdef CONFIG_VIDEO_V4L1
>> #include <linux/videodev.h>
>> #else
>> #include <linux/videodev2.h>
>> #endif
> That's true. I think the OOPS is related to this -git patch:
> 
http://www.kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=6ab3d5624e172c553004ecc862bfeac16d9d68b7
> 
> It removed config.h from bttv-cards (and other places), but we need
> CONFIG_* symbols before including v4l2-dev.h. Maybe the right solution
> would be to include autoconf.h or config.h at the top of v4l2-dev.h.
No, that is a red herring.
The #include <linux/config.h> has been removed in favor of command-line
-iMACRO inclusion...
In other words, config.h is still being included, but the explicit
#include language is no longer needed.
-- 
Michael Krufky
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/