Date: Sat, 10 Sep 2005 00:41:46 +0200
From: Sam Ravnborg <>
Subject: [PATCH 12/12] kbuild: um fix so it compile with generic asm-offsets.h support
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/9/369

um has it own set of files for asm-offsets. So for now the
gen-asm-offset macro is just duplicated in the um Makefile.
This may well be the final solution since um is a bit special compared
to other architectures - time will tell.
Also added a dummy arch/um/kernel/asm-offsets.h file to keep kbuild happy.
Signed-off-by: Sam Ravnborg <sam@ravnborg.org>
---
 arch/um/Makefile             |   16 ++++++++++++++++
 arch/um/kernel/asm-offsets.c |    1 +
 2 files changed, 17 insertions(+), 0 deletions(-)
 create mode 100644 arch/um/kernel/asm-offsets.c
f64a227b6b5cc1f8cc7f6ef9cc3351343636bac9
diff --git a/arch/um/Makefile b/arch/um/Makefile
--- a/arch/um/Makefile
+++ b/arch/um/Makefile
@@ -197,6 +197,22 @@ define filechk_umlconfig
 	sed 's/ CONFIG/ UML_CONFIG/'
 endef
 
+define filechk_gen-asm-offsets
+        (set -e; \
+         echo "#ifndef __ASM_OFFSETS_H__"; \
+         echo "#define __ASM_OFFSETS_H__"; \
+         echo "/*"; \
+         echo " * DO NOT MODIFY."; \
+         echo " *"; \
+         echo " * This file was generated by arch/$(ARCH)/Makefile"; \
+         echo " *"; \
+         echo " */"; \
+         echo ""; \
+         sed -ne "/^->/{s:^->\([^ ]*\) [\$$#]*\([^ ]*\) \(.*\):#define \1 \2 /* \3 */:; s:->::; p;}"; \
+         echo ""; \
+         echo "#endif" )
+endef
+
 $(ARCH_DIR)/include/uml-config.h : include/linux/autoconf.h
 	$(call filechk,umlconfig)
 
diff --git a/arch/um/kernel/asm-offsets.c b/arch/um/kernel/asm-offsets.c
new file mode 100644
--- /dev/null
+++ b/arch/um/kernel/asm-offsets.c
@@ -0,0 +1 @@
+/* Dummy file to make kbuild happy - unused! */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/