Date: Wed, 16 Nov 2005 21:57:06 +0300
From: Vitaly Bordug <>
Subject: [PATCH] ppc32: Fix incorrect PCI frequency value
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/11/16/245

The time to wait after deasserting PCI_RST has been counted with
incorrect value - this patch fixes the issue.
Signed-off-by: Vitaly Bordug <vbordug@ru.mvista.com>
Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
---
  arch/ppc/syslib/m82xx_pci.c |    3 ++-
  1 files changed, 2 insertions(+), 1 deletions(-)
applies-to: f571549f6e990531b853304fe9bf74cb488a02ac
ac9eb05c322380b1d11a0271e1507428b95ab994
diff --git a/arch/ppc/syslib/m82xx_pci.c b/arch/ppc/syslib/m82xx_pci.c
index 1d1c395..20f1fa3 100644
--- a/arch/ppc/syslib/m82xx_pci.c
+++ b/arch/ppc/syslib/m82xx_pci.c
@@ -248,7 +248,8 @@ pq2ads_setup_pci(struct pci_controller *
  	pci_div = ( (sccr & SCCR_PCI_MODCK) ? 2 : 1) *
  			( ( (sccr & SCCR_PCIDF_MSK) >> SCCR_PCIDF_SHIFT) + 1);
  	freq = (uint)((2*binfo->bi_cpmfreq)/(pci_div));
-	time = (int)666666/freq;
+	time = (int)66666666/freq;
+	
  	/* due to PCI Local Bus spec, some devices needs to wait such a long
  	time after RST 	deassertion. More specifically, 0.508s for 66MHz & twice more for 33 */
  	printk("%s: The PCI bus is %d Mhz.\nWaiting %s after deasserting RST...\n",__FILE__,freq,
---
Sincerely,
Vitaly
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/