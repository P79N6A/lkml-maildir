Date: Thu, 09 Jun 2005 11:03:42 -0700
From: Matthew Dobson <>
Subject: Fix warning in kernel/module.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/6/9/159

I get this warning compiling 2.6.12-rc6-mm1:
kernel/module.c:404: warning: `modinfo_attrs' defined but not used
The attached patch fixes the warning, which I guess was sort of caused by
me.  I was having compilation problems on -rc5-mm2 and I sent a patch to
move some definitions outside an ifdef.  Now the code only uses those
definitions INSIDE appropriately ifdef'd sections, so we get a warning
about not using them.  Bah.  This should (hopefully) end this.
-Matt
--- linux-2.6.12-rc6-mm1/kernel/module.c	2005-06-08 15:22:43.995409432 -0700
+++ linux-2.6.12-rc6-mm1/kernel/module.c.fixed	2005-06-08 15:21:55.286814264 -0700
@@ -370,6 +370,7 @@ static inline void percpu_modcopy(void *
 }
 #endif /* CONFIG_SMP */
 
+#ifdef CONFIG_MODULE_UNLOAD
 #define MODINFO_ATTR(field)	\
 static void setup_modinfo_##field(struct module *mod, const char *s)  \
 {                                                                     \
@@ -407,7 +408,6 @@ static struct module_attribute *modinfo_
 	NULL,
 };
 
-#ifdef CONFIG_MODULE_UNLOAD
 /* Init the unload section of the module. */
 static void module_unload_init(struct module *mod)
 {