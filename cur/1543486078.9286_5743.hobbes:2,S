Date: Tue, 16 Feb 1999 18:25:57 -0500 (EST)
From: "Steven N. Hirsch" <>
Subject: Re: [PATCH] VM buffer behaviour, was Re: [Wait!] pre4 is broken!
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/2/16/161

On Tue, 16 Feb 1999, Simon Kirby wrote:
> On Tue, 16 Feb 1999, Stephen C. Tweedie wrote:
> 
> > Anyway, I have a couple of people currently testing or waiting to test
> > the patch below against 2.2.2-pre4.  The wakeup_bdflush(1) test is now
> > conditional _only_ on the number of locked buffers, independently of
> > the number of dirty buffers.  The more people who can try this before
> > 2.2.2-pre4, the better.
> > 
> > More importantly, it adds the check in bdflush to refile locked
> > buffers on the clean list after IO.  Linus, you missed this bit of the
> > patch from 2.2.2-pre4, and it is the most important part of it:
> > without that, it is impossible to know how many of the BUF_LOCKED
> > buffers are _really_ locked, and therefore how to throttle the writes
> > while keeping the IO queues full.  There's no point releasing
> > 2.2.2-pre4 without that bit of the patch: it will simply stop doing
> > anything useful (as Simon found) because the refile_buffer logic will
> > see there being far too many BUF_LOCKED buffers, even after the IO has
> > completed.
> 
> The patch fixed it here!  Throughput to disk is a high as it use to be,
> context switches are back down to normal, and it seems to not blow up on
> the "rm".  Everything's happy. :)
> 
> I wonder why it didn't show up for other people?  It happened each and
> every time for me...Perhaps it only happens on a fresh boot or
> something...
No, I've had all of my machines head off into outer-swap-space at one
point or another.  Usually it was heavy NFS server activity which
triggered it.  The first time it happened, I was on-line and thought
someone had broken in and was erasing my disk <g>.  Looking forward to a
solution.
Steve
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/