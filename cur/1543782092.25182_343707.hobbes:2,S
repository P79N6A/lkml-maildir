Date: Mon, 22 Aug 2005 09:38:33 +0200
From: Ingo Molnar <>
Subject: Re: [PATCH 2.6.13-rc6-rt9]  PI aware dynamic priority adjustment
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/8/22/167

* Thomas Gleixner <tglx@linutronix.de> wrote:
> Hi all,
> 
> On Thu, 2005-08-18 at 08:01 +0200, Ingo Molnar wrote:
> > i have released the 2.6.13-rc6-rt9 tree, which can be downloaded from 
> > the usual place:
> 
> I reworked the code for dynamically setting the priority of the 
> hrtimer softirq to be aware of PI.
looks mostly good to me. I'm uneasy about the fact that we touch 
p->normal_prio without taking the runqueue lock. Best would be to clean 
these things up by introducing a wake_up_process_prio() and 
wake_up_process_chprio() method that does these things embedded in 
try_to_wake_up().
> I stumbled over "//#define MUTEX_IRQS_OFF" in the first attempt. My 
> assumption that all code protected by pi_lock (which is a raw lock) is 
> irq save turned out to be wrong. I missed that commented define :( I 
> guess it was introduced during the "IRQ latency contest" to squeeze 
> out the last nsecs :)
>
> Switching it back on is not really influencing system performance in a 
> measurable way, but it allows to use the pi aware boosting function in 
> irq context.
> 
> Quite contrary it makes the system more snappy and the overall test 
> latencies go down.
we can undo that flag - it's indeed only a couple of cycles worth of 
optimization, which wont count for most workloads. I've applied your 
patch, but we need to do those cleanups and the fact needs to be 
documented that !MUTEX_IRQS_OFF is not safe anymore. (most likely this 
means that the MUTEX_IRQS_OFF flag and all related changes needs to be 
gotten rid of)
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/