Date: Fri, 26 Feb 1999 12:16:35 -0600
From: "Barrett G. Lyon" <>
Subject: FTP timeouts.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/2/26/145

I have been using a 2.2.X kernel on a very loaded AXP machine.  This
machine always has about 2000 living tcp connections and 20 live users,
plus around 500+ processes.  I have been having a lot of problems ftping
from the machine out to almost any ftp server.  I have been getting a lot
of "Connection timed out" errors and it is a problem, the other BSD
machines on the same network do not have this problem.
I can't seem to figure out why this happens, and it only seems to effect
inbound ftp.  Maybe someone can help me clear this up?  
Here is a dump of the end of an ftp transfer.  Everything has been fine up
to this point, then all the sudden it dies with the client sending a FIN
and closing the connection.
The ftp client as "client" and the ftp server as "server":
10:06:22.793476 client.4962 > server.20: . ack 3254340 win 29200 (DF)
10:06:22.801119 server.20 > client.4962: . 3251420:3252880(1460) ack 1 win
33580 (DF)
10:06:22.801424 client.4962 > server.20: . ack 3254340 win 30660 (DF)
10:06:23.027097 server.20 > client.4962: . 3254340:3255800(1460) ack 1 win
33580 (DF)
10:06:23.034928 server.20 > client.4962: . 3255800:3257260(1460) ack 1 win
33580 (DF)
10:06:23.044098 server.20 > client.4962: . 3257260:3258720(1460) ack 1 win
33580 (DF)
10:06:33.267543 server.20 > client.4962: . 3254340:3255800(1460) ack 1 win
33580 (DF)
10:06:33.275046 server.20 > client.4962: . 3255800:3257260(1460) ack 1 win
33580 (DF)
10:06:33.275367 client.4962 > server.20: . ack 3254340 win 30660 (DF)
10:06:52.813828 client.4962 > server.20: F 1:1(0) ack 3254340 win 30660 (DF)
10:06:53.070996 server.20 > client.4962: . ack 2 win 33580 (DF)
10:06:53.076608 client.4950 > server.ftp: P 235:238(3) ack 2084 win 32120 (DF)
10:06:53.077140 client.4950 > server.ftp: P 238:239(1) ack 2084 win 32120
urg 1 (DF)
10:06:53.322037 server.ftp > client.4950: . ack 239 win 33580 (DF)
10:06:53.322211 client.4950 > server.ftp: P 239:245(6) ack 2084 win 32120 (DF)
10:06:53.551019 server.ftp > client.4950: P 2084:2131(47) ack 245 win 33580
(DF)
10:06:53.569968 client.4950 > server.ftp: . ack 2131 win 32120 (DF)
10:06:53.784586 server.ftp > client.4950: P 2131:2153(22) ack 4279237877
win 33580 (DF)
10:06:53.830300 server.20 > client.4962: . 3254340:3255800(1460) ack
4288673794 win 33580 (DF)
10:06:53.838336 server.20 > client.4962: . 2052306643:2052307915(1272) win
17196 (DF)
10:06:56.309056 server.ftp > client.4950: P 2131:2153(22) ack 245 win 33580
(DF)
10:06:56.328044 client.4950 > server.ftp: . ack 2153 win 32120 (DF)
At this point the connection has died and the ftp client has returned a
strace like this:
setitimer(ITIMER_REAL, {it_interval={0, 0}, 
it_value={30, 0}}, 
{it_interval={0, 0}, 
it_value={0, 0}}) = 0
read(10, 0x1201323d0, 32768)            = ? 
ERESTARTSYS (To be restarted)
--- SIGALRM (Alarm clock) ---
                                                setitimer(ITIMER_REAL,
{it_interval={0, 0}, it_value={0, 0}}, {it_interval={0, 0}, it_value={0,
0}}) = 0
sigaction(SIGALRM, {0x12001c9f8, [], 0}, {0x12000ef40, [], 0}) = 0
sigaction(SIGPIPE, {0x120022f60, [], 0}, {0x12000ef40, [], 0}) = 0
close(10)                               = 0
sigaction(SIGINT, {SIG_IGN}, {0x120022f60, [], 0}) = 0
sigaction(SIGPIPE, {SIG_IGN}, {0x120022f60, [], 0}) = 0
gettimeofday({920051625, 594935}, NULL) = 0
utimes("linux-2.2.2.tar.gz", {920051625, 0}) = 0
sigaction(SIGTSTP, {SIG_IGN}, {0x1200208c8, [], SA_INTEError: Error
occurred during read!
Reason: Connection timed out
** Aborting Transfer **) = 129
UPT|0x22f60}) = 0             sigaction(SIGTSTP, {0x1200208c8, [],
SA_STACK|SA_RESTART|SA_ONESHOT|SA_NOCLDSTOP|0x33a520}, NULL) = 0
write(1, "\33[1;43r\33[43;1H\n\n\n\33[1;45"..., 129
                                      send(7, "\377\364\377", 3, 0)
  = 3
send(7, "\362", 1, MSG_OOB)             = 1
write(7, "ABOR\r\n", 6)                 = 6
                                                    sigaction(SIGALRM,
{0x12001c9f8, [], 0}, {0x12001c9f8, [], 0}) = 0
setitimer(ITIMER_REAL, {it_interval={0, 0}, it_value={30, 0}},
{it_interval={0, 0}, it_value={0, 0}}) = 0
read(6, "426 Transfer aborted. Data conne"..., 8192) = 47
Any ideas??  
Thanks,
-Barrett
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/