Date: Wed, 9 Nov 2005 11:50:34 -0800
From: Ashok Raj <>
Subject: Re: Changing MSI to use physical delivery mode always.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/11/9/253

On Wed, Nov 09, 2005 at 02:56:50PM +0100, Andi Kleen wrote:
> On Tue, Nov 08, 2005 at 07:00:38AM -0800, Ashok Raj wrote:
> > Hi,
> > 
> > MSI was hard coded to use logical delivery mode for i386/x86_64 and 
> > physical mode for ia64.
> > 
> > With recent x86_64 we moved to physical flat mode that broke MSI.
> > 
> > Made MSI to work with physical mode, this will be consistent on all
> > archs. 
> 
> Nasty bug. Thanks for tracking that down.
> 
> It is outright scary though that such deeply architecture specific
> code is in drivers/pci. It should be in arch. I think that was
> because I missed it. Would you be willing to move the APIC specific parts 
> to arch/i386/pci ? 
I remember when it got started it was in each arch, but there was so much
code duplication, and it ended with the header file pulling in 
some from asm/msi.h for arch pieces.
but moving to arch will help choose the same delivery mode consistently
and we could use physical or logical whatever ends up being used for 
IOAPIC rte's as well.
I will send a cleanup once things settle down.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/