Date: Thu, 18 Oct 2007 11:01:57 -0700
From: Deepak Saxena <>
Subject: [PATCH] kbuild: Disable depmod in cross-compile kernel build
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/18/334

When building embedded systems in a cross-compile environment and
populating a target's file system image, we don't want to run the 
depmod on the host as we may be building for a completely different
architecture. Since there's no such thing as a cross-depmod, we
just disable running depmod in the cross-compile case and we just
run depmod on the target at bootup.
Signed-off-by: Armin Kuster <akuster@mvista.com>
Signed-off-by: Deepak Saxena <dsaxena@mvista.com>
diff --git a/Makefile b/Makefile
index 529b904..1705a91 100644
--- a/Makefile
+++ b/Makefile
@@ -1032,7 +1032,11 @@ depmod_opts	:= -b $(INSTALL_MOD_PATH) -r
 endif
 PHONY += _modinst_post
 _modinst_post: _modinst_
-	if [ -r System.map -a -x $(DEPMOD) ]; then $(DEPMOD) -ae -F System.map $(depmod_opts) $(KERNELRELEASE); fi
+	@if [ "$(CROSS_COMPILE)" = "" ]; then \
+		if [ -r System.map -a -x $(DEPMOD) ]; then \
+			$(DEPMOD) -ae -F System.map $(depmod_opts) $(KERNELRELEASE); \
+		fi \
+	fi
 
 else # CONFIG_MODULES
 
-- 
Deepak Saxena - dsaxena@plexity.net - 
http://www.plexity.net
 
"He who sacrifices freedom for security deserves neither" - Ben Franklin
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/