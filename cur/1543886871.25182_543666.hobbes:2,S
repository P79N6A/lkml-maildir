Date: Sat, 12 May 2007 14:21:37 +0200
From: Alexander van Heukelum <>
Subject: Re: x86 setup rewrite tree ready for flamage^W review
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/12/85

On Thu, May 10, 2007 at 03:48:08PM -0700, H. Peter Anvin wrote:
> > It doesn't probe the hardware in dangerous ways. (Search for mode_scan
> > in video.S) It works by trying to set a mode via the normal
> > AH=0/AL=mode/int 0x10 method for all possible values of mode. It then
> > checks if the bios reports the new mode as being set and reads a few
> > standard vga registers to determine if it is a text mode. It's
> > completely independent of the CONFIG_VIDEO_SVGA stuff.
> 
> It's dangerous, all right (which is why it doesn't do it by default),
> since you have no guarantee that the BIOS doesn't totally vomit on these
> calls -- or, like my laptop, take about a minute before giving up
> finding nothing.
I see. I think I just have too much trust in the biosses. Anyhow, the
'scan' option has always taken quite a bit of time, usually between 30
seconds and a minute.
> Anyway, I re-implemented scanning and pushed it out to the git tree;
> please try it out as it does absolutely nothing on any of my machines.
I can confirm that it works for at least one computer over here (a six
months old x86_64 machine with ATI ES1000-based on-board graphics). Some
non-vesa modes including a nice 100x30 one with 8x16 font are found by
the 'scan' option. No 100x60, however, but that is not a regression.
> > I thought the 32-bit jump was required to come before the segment loads.
> > Does this code load values from the gdt, or are they just loaded as real
> > mode segments? As long as it does not crash it does not matter, because
> > head.S reloads them again.
> 
> Once CR0.PE is set, segments are loaded from the GDT.
I believe you :).
Greetings,
	Alexander
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/