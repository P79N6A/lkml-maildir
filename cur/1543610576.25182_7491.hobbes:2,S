Date: Sat, 24 Nov 2001 12:36:18 -0600
From: Steve Bergman <>
Subject: Disk hardware caching, performance, and journalling
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/11/24/79

Hi,
I made a couple of discoveries today which were surprising to me:
1. Disk hardware caching defaults to ON. (hdparm -W1 /dev/hda)
2. It makes a *big* difference in write performance.
I had always thought that the default was off.  I also always assumed 
that a small cache behind a large (OS) cache would make no difference.
Here are my results with bonnie under kernel 2.4.14 on a reiserfs with a 
maxtor Diamond max+ 60GB udma100 drive:
Write caching on:
-------Sequential Output-------- ---Sequential Input-- --Random--
-Per Char- --Block--- -Rewrite-- -Per Char- --Block--- --Seeks---
Machine    MB K/sec %CPU K/sec %CPU K/sec %CPU K/sec %CPU K/sec %CPU  
/sec %CPU
                 256 12618 97.1 38027 36.3  9647  6.9 11250 73.6 31832 
12.1 200.9  1.2
Write caching off:
-------Sequential Output-------- ---Sequential Input-- --Random--
-Per Char- --Block--- -Rewrite-- -Per Char- --Block--- --Seeks---
Machine    MB K/sec %CPU K/sec %CPU K/sec %CPU K/sec %CPU K/sec %CPU  
/sec %CPU
                 256  9917 76.3 12280 11.2  5159  3.5  9934 65.3 33056 
14.1 203.9  1.4
                                        
Note that block writes are over 3 times faster with caching on.
So what are the implications here for journalling?  Do I have to turn 
off caching and suffer a huge performance hit?
-Steve Bergman
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/