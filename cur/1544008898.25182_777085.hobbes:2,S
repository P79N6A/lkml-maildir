Date: Thu, 4 Dec 2008 14:12:11 -0500
From: "Michael Kerrisk" <>
Subject: Re: fsync.2 does not mention error handling
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/4/317

Pavel,
On Tue, Dec 2, 2008 at 7:06 AM, Pavel Machek <pavel@suse.cz> wrote:
>
> fsync() transfers ("flushes") all modified in-core data of (i.e.,
> modified buffer cache pages for) the file referred to by the file
> descriptor fd to the disk device (or other permanent storage device)
> where that file resides.  The call blocks until the device reports
> that the transfer has completed.  It also flushes metadata information
> associated with the file (see stat(2)).
>
> Calling fsync() does not necessarily ensure that the entry in the
> directory containing the file has also reached disk.  For that an
> explicit fsync() on a file descriptor for the directory is also
> needed.
>
> ...
> RETURN VALUE         top
>
> On success, these system calls return zero.  On error, -1 is
> returned, and errno is set appropriately.
>
>
> --------------
>
>
> I guess it should mention that any errors during fsync are only
> mentioned to the first process calling it... which means that if you
>
> write file
> fsync file
> fsync .
>
> ... and someone else does "fsync ." in the meantime, you may get
> success when in fact directory entry of file is not written to the
> disk.
Could you provide some pointers to supporting information / mail
threads, relating to this?
Also, I'm still not 100% clear what you are saying above.  Do you mean
that in this scenario, an error may occur but the first caller above
won't know of it?  (It would help if you could write a few sentences
that you think should be in the man page.)
Cheers,
Michael
-- 
Michael Kerrisk
Linux man-pages maintainer; 
http://www.kernel.org/doc/man-pages/
git://git.kernel.org/pub/scm/docs/man-pages/man-pages.git
man-pages online: 
http://www.kernel.org/doc/man-pages/online_pages.html
Found a bug? 
http://www.kernel.org/doc/man-pages/reporting_bugs.html