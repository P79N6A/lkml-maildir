Date: 27 Mar 2000 18:14:45 +0200
From: Christoph Rohland <>
Subject: Re: v2.3.99p3: SHM probs
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/27/95

Hi Meino,
does the attached patch resolve your problems?
Greetings
		Christoph
-- 
--- linux/ipc/shm.c~	Fri Mar 24 18:48:50 2000
+++ linux/ipc/shm.c	Mon Mar 27 17:58:59 2000
@@ -1214,11 +1214,15 @@
 static int shm_remove_name(int id)
 {
 	int err;
+	kernel_cap_t save_cap = current->cap_effective;
 	char name[SHM_FMT_LEN+1];
+
 	sprintf (name, SHM_FMT, id);
+	cap_raise(current->cap_effective, CAP_FOWNER);
 	lock_kernel();
 	err = do_unlink (name, dget(shm_sb->s_root));
 	unlock_kernel();
+	current->cap_effective = save_cap;
 	return err;
 }
 