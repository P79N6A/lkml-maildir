Date: Tue, 21 Aug 2007 22:28:49 +0400
From: Andrey Borzenkov <>
Subject: Re: [2.6.23-rc3 possible regression] 8250 claims nonexisting device blocking IO port
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/21/259

On Monday 20 August 2007, Bjorn Helgaas wrote:
> On Monday 20 August 2007 10:28:22 am Andrey Borzenkov wrote:
> > This worked in 2.6.22 with the same quirks. I will test without later but
> > I fail to see how they are related.
>
> OK, let me know what happens.  The way it's related is that the quirk
> fiddles with the IRDA device, and it probably changes the SIR config
> so that it starts responding at the ttyS3 address.
You are probably right. Disabling quirk makes it work again (with pnp off in 
smsc-ircc2 of course).
Hmm ... is there any reason why this quirk is in PnP core in the first place? 
Would not it be more logical to have it in (PnP) part of smsc-ircc2? This way 
it could share code with legacy detection; and it even may have chance to 
work - assuming BIOS is aware that 0x100 is claimed by PCMCIA it could 
allocate different port when we try to activate device after that ... should 
I give it a try?
> In your 2.6.23 
> log, I see this:
>
> [  512.476243] pnp: Device 00:0a activated.
> [  512.476301]  00:0a: SMCf010 not responding at SIR 0x100, FIR 0x2e8;
> auto-configuring [  512.477861] pnp: Device 00:0a disabled.
> [  512.483492] pnp: Device 00:0a activated.
> [  512.483520]  00:0a: not responding at SIR 0x100, FIR 0x2e8; swapping
> SIR/FIR and reconfiguring [  512.485056] pnp: Device 00:0a disabled.
> [  512.491652] pnp: Device 00:0a activated.
> [  512.491679]  00:0a: responds at SIR 0x2e8, FIR 0x100
>
> After the quirk, the FIR part is enabled at 0x100 and we assume (the
> quirk doesn't actually check) the SIR part is enabled at 0x2e8.  The
> 8250 driver will claim a SIR device at 0x2e8 as ttyS3.
>
> Without the quirk, the SIR device seems to be either at 0x100 (where
> the 8250 driver will not look) or is not enabled at all.
>
> Bjorn
[unhandled content-type:application/pgp-signature]