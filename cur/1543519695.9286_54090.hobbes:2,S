Date: Fri, 17 Dec 1999 20:02:46 +0100 (CET)
From: Urban Widmark <>
Subject: Re: Cannot mount SMBFS in 2.2.14pre14
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/12/17/121

On Fri, 17 Dec 1999, Andris Pavenis wrote:
> I built kernel 2.2.14pre14 and after booting it I was not able to mount WinNT
> shares.  I'm getting message:
> 	SMBFS: need mount version 6
Same here.
Something was affected by this change (from pre13). By changing the #if 0
to #if 1 it mounts again (and the "mount data" is correct when it reaches
smbfs). I'll leave it for someone how knows what a "find_vma" is to
explain why and/or suggest a proper fix.
/Urban
diff -u --new-file --recursive --exclude-from ../exclude linux.vanilla/fs/super.c linux.14p13/fs/super.c
--- linux.vanilla/fs/super.c	Sat Aug 14 02:27:37 1999
+++ linux.14p13/fs/super.c	Fri Dec 10 00:39:01 1999
@@ -983,6 +983,7 @@
 	if (!data)
 		return 0;
 
+#if 0
 	vma = find_vma(current->mm, (unsigned long) data);
 	if (!vma || (unsigned long) data < vma->vm_start)
 		return -EFAULT;
@@ -991,10 +992,13 @@
 	i = vma->vm_end - (unsigned long) data;
 	if (PAGE_SIZE <= (unsigned long) i)
 		i = PAGE_SIZE-1;
-	if (!(page = __get_free_page(GFP_KERNEL))) {
+#else
+	i = PAGE_SIZE;		
+#endif		
+	if (!(page = get_free_page(GFP_KERNEL))) {
 		return -ENOMEM;
 	}
-	if (copy_from_user((void *) page,data,i)) {
+	if (copy_from_user((void *) page,data,i) == i) {
 		free_page(page); 
 		return -EFAULT;
 	}
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/