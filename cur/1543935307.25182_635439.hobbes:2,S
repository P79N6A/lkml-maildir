Date: Mon, 7 Jan 2008 18:37:56 -0800
From: "Yinghai Lu" <>
Subject: kexec fail
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/7/395

just found that when kexec 2.6.24-rc7 from RHEL 5.1 kernel got
Your BIOS doesn't leave a aperture memory hole
Please enable the IOMMU option in the BIOS setup
This costs you 64 MB of RAM
Mapping aperture over 65536 KB of RAM @ 20000000
Bad page state in process 'swapper'
page:ffffe20004000018 flags:0x0000000000000000
mapping:0000000000000000 mapcount:1 count:0
Trying to fix it up, but a reboot is needed
Backtrace:
Pid: 0, comm: swapper Not tainted 2.6.24-rc7-smp #1
Call Trace:
 [<ffffffff80263fa3>] bad_page+0x63/0x8d
 [<ffffffff802640ed>] __free_pages_ok+0x7c/0x2a5
 [<ffffffff80ba7161>] free_all_bootmem_core+0xd0/0x198
 [<ffffffff80ba3a22>] numa_free_all_bootmem+0x3b/0x76
 [<ffffffff80ba30a2>] mem_init+0x4e/0x165
 [<ffffffff80b959dc>] start_kernel+0x236/0x2c2
 [<ffffffff80b95123>] _sinittext+0x123/0x12a
Bad page state in process 'swapper'
page:ffffe20004000050 flags:0x0000000000000000
mapping:0000000000000000 mapcount:1 count:0
Trying to fix it up, but a reboot is needed
Backtrace:
Pid: 0, comm: swapper Tainted: G    B   2.6.24-rc7-smp #1
Call Trace:
 [<ffffffff80263fa3>] bad_page+0x63/0x8d
 [<ffffffff802640ed>] __free_pages_ok+0x7c/0x2a5
 [<ffffffff80ba7161>] free_all_bootmem_core+0xd0/0x198
 [<ffffffff80ba3a22>] numa_free_all_bootmem+0x3b/0x76
 [<ffffffff80ba30a2>] mem_init+0x4e/0x165
 [<ffffffff80b959dc>] start_kernel+0x236/0x2c2
 [<ffffffff80b95123>] _sinittext+0x123/0x12a
...
somewhere from 64M
start_kernel
        ==> mem_init
                ==> numa_free_all_bootmem
                        ==> free_all_bootmem_node (NODE_DATA(i))
                                ==> free_all_bootmem_core ()
                                        ==> __free_pages_boot_mem
                                                ==> __free_pages(page, oder)
                                                        ==>
__free_pages_ok(page, order)
                                                                ==>
free_pages_check
 ==> bad_pages...
try to kexec 2.6.23 from RHEL 5.1, will get
Your BIOS doesn't leave a aperture memory hole
Please enable the IOMMU option in the BIOS setup
This costs you 64 MB of RAM ======> reboot
but 2.6.24-rc7 kexec 2.6.24-rc7 is ok.
YH