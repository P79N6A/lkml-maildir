Date: Thu, 30 Mar 2006 09:53:26 +1000
From: Nigel Cunningham <>
Subject: Re: [rfc] fix Kconfig, hotplug_cpu is needed for swsusp
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/3/29/254

Hi.
On Thursday 30 March 2006 09:47, Ashok Raj wrote:
> On Thu, Mar 30, 2006 at 09:36:16AM +1000, Nigel Cunningham wrote:
> > Hi.
> >
> >
> > So if you have a single core x86, you want X86_PC, and if you have HT or
> > SMP, you want GENERICARCH? If so, could this be done via selects or
> > depends or at least defaults in Kconfig?
>
> Yes, i think only SUSPEND_SMP is affect by this. I thought Rafael cced
> Pavel during that exchange, maybe i missed.
>
> > Regards,
> >
> > Nigel
>
> How about this patch.
>
> Make SUSPEND_SMP depend on X86_GENERICARCH, since hotplug cpu requires
> !X86_PC due to some race in IPI handling.  See more discussion here
>
> http://marc.theaimsgroup.com/?l=linux-kernel&m=114303306032338&w=2
>
> Signed-off-by: Ashok Raj <ashok.raj@intel.com>
> --------------------------------------------------------------
>
> Index: linux-2.6.16-git16/kernel/power/Kconfig
> ===================================================================
> --- linux-2.6.16-git16.orig/kernel/power/Kconfig
> +++ linux-2.6.16-git16/kernel/power/Kconfig
> @@ -96,5 +96,5 @@ config SWSUSP_ENCRYPT
>
>  config SUSPEND_SMP
>         bool
> -       depends on HOTPLUG_CPU && X86 && PM
> +       depends on HOTPLUG_CPU && X86 && PM && X86_GENERICARCH
>         default y
Sounds like the right approach to me, but I think it's better to use selects. 
I reckon that if the user selects SMP and then selects suspend support, 
everything else required should be automatic. If we do too many 'depends 
on's, they have to mess about figuring out what they haven't selected yet and 
why they can't find the option to suspend. Most people don't seem to know 
about '/' in make menuconfig.
Regards,
Nigel
[unhandled content-type:application/pgp-signature]