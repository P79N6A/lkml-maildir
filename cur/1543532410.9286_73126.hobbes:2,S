Date: Thu, 30 Mar 2000 13:58:38 +0100 (BST)
From: Tigran Aivazian <>
Subject: [patch-2.3.99-pre4-1] a few more cleanups
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/3/30/54

Hi Linus,
Here are some rather obvious cleanups against 2.3.99-pre4-1. (these don't
conflict with the yesterday's patch to fs/super.c)
Regards,
Tigran
diff -urN -X dontdiff linux/fs/bad_inode.c work/fs/bad_inode.c
--- linux/fs/bad_inode.c	Sun Feb 27 04:33:04 2000
+++ work/fs/bad_inode.c	Thu Mar 30 13:42:44 2000
@@ -45,7 +45,7 @@
 	lock:		EIO_ERROR,
 };
 
-struct inode_operations bad_inode_ops =
+static struct inode_operations bad_inode_ops =
 {
 	create:		EIO_ERROR,
 	lookup:		EIO_ERROR,
diff -urN -X dontdiff linux/fs/block_dev.c work/fs/block_dev.c
--- linux/fs/block_dev.c	Fri Mar  3 05:55:53 2000
+++ work/fs/block_dev.c	Thu Mar 30 13:37:11 2000
@@ -17,7 +17,6 @@
 extern int *blk_size[];
 extern int *blksize_size[];
 
-#define MAX_BUF_PER_PAGE (PAGE_SIZE / 512)
 #define NBUF 64
 
 ssize_t block_write(struct file * filp, const char * buf,
diff -urN -X dontdiff linux/include/linux/fs.h work/include/linux/fs.h
--- linux/include/linux/fs.h	Wed Mar 29 10:57:16 2000
+++ work/include/linux/fs.h	Thu Mar 30 13:41:55 2000
@@ -470,7 +470,7 @@
 	/* needed for tty driver, and maybe others */
 	void			*private_data;
 };
-extern spinlock_t files_lock;
+extern spinlock_t files_lock; /* fs/file_table.c */
 #define file_list_lock() spin_lock(&files_lock);
 #define file_list_unlock() spin_unlock(&files_lock);
 
@@ -516,14 +516,14 @@
 	} fl_u;
 };
 
-extern struct file_lock			*file_lock_table;
+extern struct file_lock	*file_lock_table;
 
 #include <linux/fcntl.h>
 
+/* fs/locks.c */
 extern int fcntl_getlk(unsigned int, struct flock *);
 extern int fcntl_setlk(unsigned int, unsigned int, struct flock *);
 
-/* fs/locks.c */
 extern void locks_remove_posix(struct file *, fl_owner_t);
 extern void locks_remove_flock(struct file *);
 extern struct file_lock *posix_test_lock(struct file *, struct file_lock *);
@@ -627,7 +627,7 @@
 };
 
 /*
- * VFS helper functions..
+ * VFS helper functions -- fs/namei.c
  */
 extern int vfs_create(struct inode *, struct dentry *, int);
 extern int vfs_mkdir(struct inode *, struct dentry *, int);
@@ -738,6 +738,7 @@
 #define DECLARE_FSTYPE_DEV(var,type,read) \
 	DECLARE_FSTYPE(var,type,read,FS_REQUIRES_DEV)
 
+/* fs/super.c */
 extern int register_filesystem(struct file_system_type *);
 extern int unregister_filesystem(struct file_system_type *);
 
@@ -759,6 +760,7 @@
 #define FLOCK_VERIFY_READ  1
 #define FLOCK_VERIFY_WRITE 2
 
+/* fs/locks.c */
 extern int locks_mandatory_locked(struct inode *);
 extern int locks_mandatory_area(int, struct inode *, struct file *, loff_t, size_t);
 
@@ -800,7 +802,6 @@
 
 
 /* fs/open.c */
-
 asmlinkage long sys_open(const char *, int, int);
 asmlinkage long sys_close(unsigned int);	/* yes, it's really unsigned */
 extern int do_close(unsigned int, int);		/* yes, it's really unsigned */
@@ -812,30 +813,37 @@
 extern struct file *dentry_open(struct dentry *, int);
 extern int filp_close(struct file *, fl_owner_t id);
 
+/* fs/namei.c */
 extern char * getname(const char *);
 #define __getname()	((char *) __get_free_page(GFP_KERNEL))
 #define putname(name)	free_page((unsigned long)(name))
 
-enum {BDEV_FILE, BDEV_SWAP, BDEV_FS, BDEV_RAW};
+/* fs/fcntl.c */
 extern void kill_fasync(struct fasync_struct *, int, int);
+
+/* Block device interface -- fs/block_dev.c (char in fs/devices.c) */
+enum {BDEV_FILE, BDEV_SWAP, BDEV_FS, BDEV_RAW};
 extern int register_blkdev(unsigned int, const char *, struct block_device_operations *);
 extern int unregister_blkdev(unsigned int, const char *);
 extern struct block_device *bdget(dev_t);
 extern void bdput(struct block_device *);
 extern int blkdev_open(struct inode *, struct file *);
 extern struct file_operations def_blk_fops;
-extern struct file_operations def_fifo_fops;
 extern int ioctl_by_bdev(struct block_device *, unsigned, unsigned long);
 extern int blkdev_get(struct block_device *, mode_t, unsigned, int);
 extern int blkdev_put(struct block_device *, int);
+extern const struct block_device_operations *get_blkfops(unsigned int);
+extern const char * bdevname(kdev_t);
+extern int check_disk_change(kdev_t);
+
+/* fs/fifo.c */
+extern struct file_operations def_fifo_fops;
 
 /* fs/devices.c */
-extern const struct block_device_operations *get_blkfops(unsigned int);
 extern struct file_operations *get_chrfops(unsigned int, unsigned int);
 extern int register_chrdev(unsigned int, const char *, struct file_operations *);
 extern int unregister_chrdev(unsigned int, const char *);
 extern int chrdev_open(struct inode *, struct file *);
-extern const char * bdevname(kdev_t);
 extern const char * cdevname(kdev_t);
 extern const char * kdevname(kdev_t);
 extern void init_special_inode(struct inode *, umode_t, int);
@@ -844,7 +852,7 @@
 extern void make_bad_inode(struct inode *);
 extern int is_bad_inode(struct inode *);
 
-extern struct file_operations connecting_fifo_fops;
+/* fs/pipe.c */
 extern struct file_operations read_fifo_fops;
 extern struct file_operations write_fifo_fops;
 extern struct file_operations rdwr_fifo_fops;
@@ -852,9 +860,13 @@
 extern struct file_operations write_pipe_fops;
 extern struct file_operations rdwr_pipe_fops;
 
+/* fs/file_table.c */
 extern int fs_may_remount_ro(struct super_block *);
+
+/* fs/super.c */
 extern int fs_may_mount(kdev_t);
 
+/* fs/buffer.c */
 extern int try_to_free_buffers(struct page *);
 extern void refile_buffer(struct buffer_head * buf);
 
@@ -906,26 +918,37 @@
 
 #define atomic_set_buffer_dirty(bh) test_and_set_bit(BH_Dirty, &(bh)->b_state)
 
+/* fs/buffer.c */
 extern void balance_dirty(kdev_t);
-extern int check_disk_change(kdev_t);
-extern int invalidate_inodes(struct super_block *);
-extern void invalidate_inode_pages(struct inode *);
 #define invalidate_buffers(dev)	__invalidate_buffers((dev), 0)
 #define destroy_buffers(dev)	__invalidate_buffers((dev), 1)
 extern void __invalidate_buffers(kdev_t dev, int);
-extern int floppy_is_wp(int);
-extern void sync_inodes(kdev_t);
-extern void write_inode_now(struct inode *);
 extern void sync_dev(kdev_t);
 extern int fsync_dev(kdev_t);
+
+/* fs/super.c */
 extern void sync_supers(kdev_t);
+
+/* fs/inode.c */
+extern int invalidate_inodes(struct super_block *);
+extern void write_inode_now(struct inode *);
+extern void sync_inodes(kdev_t);
 extern int bmap(struct inode *, int);
+
+/* mm/filemap.c */
+extern void invalidate_inode_pages(struct inode *);
+
+/* fs/attr.c */
 extern int notify_change(struct dentry *, struct iattr *);
+
+/* fs/pipe.c */
+extern int do_pipe(int *);
+
+/* fs/namei.c */
 extern int permission(struct inode *, int);
 extern int get_write_access(struct inode *);
 extern void put_write_access(struct inode *);
 extern struct dentry * do_mknod(const char *, int, dev_t);
-extern int do_pipe(int *);
 extern int do_unlink(const char * name, struct dentry *);
 extern struct dentry * __open_namei(const char *, int, int, struct dentry *);
 
@@ -934,6 +957,7 @@
 	return __open_namei(pathname, 0, 0, NULL);
 }
 
+/* fs/exec.c */
 extern int kernel_read(struct file *, unsigned long, char *, unsigned long);
 extern struct file * open_exec(const char *);
  
@@ -1037,7 +1061,7 @@
 typedef int (*writepage_t)(struct file *, struct page *, unsigned long, unsigned long, const char *);
 typedef int (get_block_t)(struct inode*,long,struct buffer_head*,int);
 
-/* Generic buffer handling for block filesystems.. */
+/* Generic buffer handling for block filesystems -- fs/buffer.c */
 extern int block_flushpage(struct page *, unsigned long);
 extern int block_symlink(struct inode *, const char *, int);
 extern int block_write_full_page(struct page*, get_block_t*);
@@ -1048,32 +1072,33 @@
 int generic_block_bmap(struct address_space *, long, get_block_t *);
 int generic_commit_write(struct file *, struct page *, unsigned, unsigned);
 
+/* Generic page cache io interface -- mm/filemap.c */
 extern int generic_file_mmap(struct file *, struct vm_area_struct *);
 extern ssize_t generic_file_read(struct file *, char *, size_t, loff_t *);
 extern ssize_t generic_file_write(struct file *, const char *, size_t, loff_t *);
 extern void do_generic_file_read(struct file *, loff_t *, read_descriptor_t *, read_actor_t);
 
+/* fs/read_write.c */
 extern ssize_t generic_read_dir(struct file *, char *, size_t, loff_t *);
-
 extern struct file_operations generic_ro_fops;
 
+/* fs/namei.c */
 extern int vfs_readlink(struct dentry *, char *, int, const char *);
 extern struct dentry *vfs_follow_link(struct dentry *, struct dentry *, unsigned, const char *);
 extern int page_readlink(struct dentry *, char *, int);
 extern struct dentry *page_follow_link(struct dentry *, struct dentry *, unsigned);
 extern struct inode_operations page_symlink_inode_operations;
 
+/* fs/readdir.c */
 extern int vfs_readdir(struct file *, filldir_t, void *);
 
 extern struct super_block *get_super(kdev_t);
 struct super_block *get_empty_super(void);
 void remove_vfsmnt(kdev_t dev);
-extern void put_super(kdev_t);
-unsigned long generate_cluster(kdev_t, int b[], int);
-unsigned long generate_cluster_swab32(kdev_t, int b[], int);
 extern kdev_t ROOT_DEV;
-extern char root_device_name[];
 
+/* init/main.c */
+extern char root_device_name[];
 
 extern void show_buffers(void);
 extern void mount_root(void);
@@ -1083,11 +1108,9 @@
 extern int change_root(kdev_t, const char *);
 #endif
 
-extern ssize_t char_read(struct file *, char *, size_t, loff_t *);
 extern ssize_t block_read(struct file *, char *, size_t, loff_t *);
 extern int read_ahead[];
 
-extern ssize_t char_write(struct file *, const char *, size_t, loff_t *);
 extern ssize_t block_write(struct file *, const char *, size_t, loff_t *);
 
 extern int file_fsync(struct file *, struct dentry *);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/