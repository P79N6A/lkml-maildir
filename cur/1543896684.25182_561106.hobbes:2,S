Date: Fri, 22 Jun 2007 15:34:07 +0200
From: Nicolas Ferre <>
Subject: Re: [PATCH] mmc-atmel : fix kunmap wrong usage
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/22/164

Hugh Dickins :
> Aren't you just guessing there?  Those kunmap_atomics in at91_mci.c
> may look wrong to you, but they're not incorrect (so long as sg->offset
> falls within the page, as it must do here to make sense of the page).
> Especially not on ARM, where kunmap_atomic actually has no interest
> in the argument passed.  And the oops was in the flush_dcache_page.
> 
> If you actually reproduced Nicolas' problem on ARM, and verified
> that your patch then fixes it, please let us know: that will be
> remarkably interesting.
Patch tested without success. Indeed, I always see the Oops with 
Marc's patch.
> I believe I posted the correct fix last night (or at least a safe fix
> for now: Christoph Lameter may prefer to undo it and change ARM's
> dma_mapping at leisure later), checking PageSlab in page_mapping;
> and Linus has already put that one into his git tree.
Here:
http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=b9bae3402572dc50a1e084c5b1ae5117918ef0f0
> But it would be good to hear from Nicolas whether that indeed fixes
> his oops: I couldn't actually try my patch on ARM either.
Ok tested on Atmel ARM AT91 (at91sam9263), this fixes this oops.
Thanks a lot to all of you for your precise help.
Regards,
-- 
Nicolas Ferre
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/