Date: Fri, 16 Jan 2004 15:32:32 +0300
From: Roman Kagan <>
Subject: Re: Fwd: [2.6] nfs_rename: target $file busy, d_count=2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/1/16/70

On Thu, Jan 16, 2004 at 05:01:12AM -0500, Mike Fedyk wrote:
> 1. nfs_rename: target $file busy, d_count=2
> 2. RPC request reserved 0 but used 40
> 
> Hi, I'm getting [1] in kernel log on the nfs client, and [2] on the nfs server.
> After that I get nfs stale file handles.
I started to get "RPC request reserved 0 but used X" where X ranged from
24 to 32900, when I switched from NFS over UDP to NFS over TCP.  Both
servers and clients are on vanilla 2.6.1, one of the servers exibiting
this does only readonly exports.  There are no apparent effects
associated with that message, however the comment in svc_sock_release()
in net/sunrpc/svcsock.c says that it's an indication of a bug.  I'll try
to run it with debugging enabled to see on which code path it happens.
I don't see your nfs_rename problem on the clients.  Nor do they get
stale NFS handles: there used to be some until I added no_subtree_check
export option.
> Both client and server are running the same 2.6.1-bk2 kernel with TCP-NFS.
> SMP, Highmem, & preempt.
In my case UP, no highmem, no preempt.
  Roman.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/