Date: Wed, 2 Jan 2008 09:37:50 -0500
From: Mike Frysinger <>
Subject: [patch] linux/{socket,stat}.h: change __GLIBC__ cruft to __KLIBC__
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/2/105

The __GLIBC__ hacks were re-added to the headers because the klibc peeps want
to be lazy.  But rather than properly address things, they just wrongly left
it as __GLIBC__.  This patch changes the __GLIBC__ cruft to __KLIBC__ so real
libcs don't get screwed due to kilbc's laziness.
Signed-off-by: Mike Frysinger <vapier@gentoo.org>
---
diff --git a/include/linux/socket.h b/include/linux/socket.h
index c22ef1c..90af15b 100644
--- a/include/linux/socket.h
+++ b/include/linux/socket.h
@@ -16,7 +16,7 @@ struct __kernel_sockaddr_storage {
 				/* _SS_MAXSIZE value minus size of ss_family */
 } __attribute__ ((aligned(_K_SS_ALIGNSIZE)));	/* force desired alignment */
 
-#if defined(__KERNEL__) || !defined(__GLIBC__) || (__GLIBC__ < 2)
+#if defined(__KERNEL__) || defined(__KLIBC__)
 
 #include <asm/socket.h>			/* arch-dependent defines	*/
 #include <linux/sockios.h>		/* the SIOCxxx I/O controls	*/
diff --git a/include/linux/stat.h b/include/linux/stat.h
index 611c398..e8c1943 100644
--- a/include/linux/stat.h
+++ b/include/linux/stat.h
@@ -7,7 +7,7 @@
 
 #endif
 
-#if defined(__KERNEL__) || !defined(__GLIBC__) || (__GLIBC__ < 2)
+#if defined(__KERNEL__) || defined(__KLIBC__)
 
 #define S_IFMT  00170000
 #define S_IFSOCK 0140000