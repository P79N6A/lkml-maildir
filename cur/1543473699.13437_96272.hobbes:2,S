Date: Thu, 31 Dec 1998 12:55:30 -0800 (PST)
From: Rick Franchuk <>
Subject: 2.2.0-pre2 futz
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1998/12/31/230

My apologies if this has already been posted (I haven't seen it myself).
When attempting to compile 2.2.0-pre2 without SMP support, I get the following:
gcc -D__KERNEL__ -I/usr/src/linux-2.2.0-pre2/include -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer -pipe -fno-strength-reduce -m486 -malign-loops=2 -malign-jumps=2 -malign-functions=2 -DCPU=686  -c -o init/main.o init/main.c
/usr/src/linux-2.2.0-pre2/include/asm/bugs.h: In function `check_config':
In file included from init/main.c:27:
/usr/src/linux-2.2.0-pre2/include/asm/bugs.h:354: `smp_found_config' undeclared (first use this function)
/usr/src/linux-2.2.0-pre2/include/asm/bugs.h:354: (Each undeclared identifier is reported only once
/usr/src/linux-2.2.0-pre2/include/asm/bugs.h:354: for each function it appears in.)
make: *** [init/main.o] Error 1
It appears that CONFIG_GOOD_APIC being defined also assumes that __SMP__ is
defined, which isn't a good assumption considering you can turn SMP off with
a config switch now ;)
Here's a piddly patch which worked for me. I leave it to you kernel gods to
determine if this is the best way to handle the problem.
--
  __________________________________________
 |                                          |
 |  Rick Franchuk  -  TranSpecT Consulting  |
 |_______                            _______|
         \mailto:rickf@transpect.net/
          \_____ICQ_#_4435025______/
--- bugs.h.old  Thu Dec 31 12:47:02 1998
+++ bugs.h      Thu Dec 31 12:45:05 1998
@@ -350,10 +350,12 @@
 #endif
 /* If we were told we had a good APIC for SMP, we'd better be a PPro */
+#ifdef __SMP__
 #ifdef CONFIG_GOOD_APIC
	if (smp_found_config && boot_cpu_data.x86 <= 5)
		panic("Kernel compiled for PPro+, assumes local APIC without read-before-write bug");
 #endif
+#endif /* __SMP__ */
 }
 __initfunc(static void check_bugs(void))
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/