Date: Mon, 23 Oct 2006 12:33:53 +0200
From: Patrick McHardy <>
Subject: Re: [PATCH] sata_sis: fix flags handling for the secondary port
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/23/97

Tejun Heo wrote:
> sis_init_one() modifies probe_ent->port_flags after allocating and
> initializing it using ata_pci_init_native_mode().  This makes
> port_flags for the secondary port (probe_ent->pinfo2->flags) go out of
> sync resulting in misdetection of device due to incorrectly
> initialized SCR access flag.
> 
> This patch make probe_ent alloc/init happen after the final port flags
> value is determined.  This is fragile but probe_ent and all the
> related mess are scheduled to go away soon for exactly this reason.
> We just need to hold everything together till then.
> 
> This has been spotted and diagnosed by Patrick McHardy.
> 
> Signed-off-by: Tejun Heo <htejun@gmail.com>
> Cc: Patric McHardy <kaber@trash.net>
> ---
> Patrick, can you test this patch and post result?
The patch fixes the problem, both ports are properly detected and work
fine. Thanks Tejun.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/