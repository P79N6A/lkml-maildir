Date: Thu, 9 Feb 2006 20:23:51 +0100
From: Michael Buesch <>
Subject: Re: [PATCH v2 02/07] cpuset use combined atomic_inc_return calls
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/2/9/221

On Thursday 09 February 2006 19:54, you wrote:
> @@ -1770,8 +1769,7 @@ static long cpuset_create(struct cpuset 
>  	atomic_set(&cs->count, 0);
>  	INIT_LIST_HEAD(&cs->sibling);
>  	INIT_LIST_HEAD(&cs->children);
> -	atomic_inc(&cpuset_mems_generation);
> -	cs->mems_generation = atomic_read(&cpuset_mems_generation);
> +	cs->mems_generation = atomic_inc_return(&cpuset_mems_generation);
>  	fmeter_init(&cs->fmeter);
> 
>  	cs->parent = parent;
> @@ -1861,7 +1859,7 @@ int __init cpuset_init_early(void)
>  	struct task_struct *tsk = current;
> 
>  	tsk->cpuset = &top_cpuset;
> -	tsk->cpuset->mems_generation = atomic_read(&cpuset_mems_generation);
> +	tsk->cpuset->mems_generation = atomic_inc_return(&cpuset_mems_generation);
>  	return 0;
>  }
Is this hunk really correct? I did not look into the code, but from
the patch context it seems like it adds an inc here.
-- 
Greetings Michael.
[unhandled content-type:application/pgp-signature]