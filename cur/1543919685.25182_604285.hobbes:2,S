Date: Fri, 12 Oct 2007 17:08:23 +0100
From: David Howells <>
Subject: [PATCH 36/52] CRED: Make ext3_fill_super() pass credentials down
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/12/262

Make ext3_fill_super() pass credentials down to the functions that it calls.
Signed-off-by: David Howells <dhowells@redhat.com>
---
 fs/ext3/super.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)
diff --git a/fs/ext3/super.c b/fs/ext3/super.c
index 4bb76d3..2be33c1 100644
--- a/fs/ext3/super.c
+++ b/fs/ext3/super.c
@@ -1257,9 +1257,9 @@ static int ext3_check_descriptors (struct super_block * sb)
  * inode cleanup for us, so we can safely abort without any further action.
  */
 static void ext3_orphan_cleanup (struct super_block * sb,
-				 struct ext3_super_block * es)
+				 struct ext3_super_block * es,
+				 struct cred *cred)
 {
-	struct cred *cred = current->cred;
 	unsigned int s_flags = sb->s_flags;
 	int nr_orphans = 0, nr_truncates = 0;
 #ifdef CONFIG_QUOTA
@@ -1398,6 +1398,7 @@ static ext3_fsblk_t descriptor_loc(struct super_block *sb,
 
 static int ext3_fill_super (struct super_block *sb, void *data, int silent)
 {
+	struct cred *cred = current->cred;
 	struct buffer_head * bh;
 	struct ext3_super_block *es = NULL;
 	struct ext3_sb_info *sbi;
@@ -1799,7 +1800,7 @@ static int ext3_fill_super (struct super_block *sb, void *data, int silent)
 	 * superblock lock.
 	 */
 	EXT3_SB(sb)->s_mount_state |= EXT3_ORPHAN_FS;
-	ext3_orphan_cleanup(sb, es);
+	ext3_orphan_cleanup(sb, es, cred);
 	EXT3_SB(sb)->s_mount_state &= ~EXT3_ORPHAN_FS;
 	if (needs_recovery)
 		printk (KERN_INFO "EXT3-fs: recovery complete.\n");
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/