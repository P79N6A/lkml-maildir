Date: Sun, 28 May 2006 17:49:35 -0400
From: Mark Lord <>
Subject: Re: Resume stops working between 2.6.16 and 2.6.17-rc1 on Dell Inspiron 6000
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/5/28/114

We've just now put out a one-liner patch to libata that fixes
resume on my own Inspiron, and for other machines as well.
Does it fix the problem here too?  (copy of patch is attached)
--- linux-2.6.17-rc5/drivers/scsi/libata-core.c
+++ linux/drivers/scsi/libata-core.c
@@ -4296,6 +4296,7 @@ static int ata_start_drive(struct ata_po
  */
 int ata_device_resume(struct ata_port *ap, struct ata_device *dev)
 {
 	if (ap->flags & ATA_FLAG_SUSPENDED) {
+		ata_busy_wait(ap, ATA_BUSY | ATA_DRQ, 200000);
 		ap->flags &= ~ATA_FLAG_SUSPENDED;
 		ata_set_mode(ap);