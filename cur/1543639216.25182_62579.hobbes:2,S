Date: Thu, 8 Aug 2002 14:06:32 +0200
From: Harald Welte <>
Subject: Re: [PATCH] fix HIPQUAD macro in kernel.h
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/8/8/101

On Thu, Aug 08, 2002 at 01:41:13PM +0200, Andi Kleen wrote:
> On Thu, Aug 08, 2002 at 01:31:12PM +0200, Harald Welte wrote:
> > Hi Dave!
> > 
> > Below is a fix for the HIPQUAD macro in kernel.h.  The macro is currently
> > not endian-aware - it just assumes running on a little-endian machine.
> > 
> > If you don't like the #ifdefs in kernel.h, the macros could be moved into 
> > include/linux/byteorder/.
> > 
> > Please apply, thanks
> 
> That change is wrong. IP address should be always in network order (=BE) 
> while in kernel.
well, there is for example a short codepath in ip_conntrack_irc.c, where
the ip address is parsed from the packet payload (after which it is present
in host byte order).  Before it is written to the apropriate data structures,
we convert it to network byte order.  And just before this happens,
there are debug printk's which use HIPQUAD.
What is the point of providing two macros (HIPQUAD and NIPQUAD), if
one of them does only work on little-endian.  I would understand your point
if th HIPQUAD macro wasn't present at all (and only NIPQUAD existed).
I assumed that NIPQUAD does parse an ip address in network byte order,
and HIPQUAD in host byte order.  If they are really meant for little or
big endian, they should be renamed to BEIPQUAD and LEIPQUAD.
> -Andi
-- 
Live long and prosper
- Harald Welte / laforge@gnumonks.org               
http://www.gnumonks.org/
============================================================================
GCS/E/IT d- s-: a-- C+++ UL++++$ P+++ L++++$ E--- W- N++ o? K- w--- O- M+ 
V-- PS++ PE-- Y++ PGP++ t+ 5-- !X !R tv-- b+++ !DI !D G+ e* h--- r++ y+(*)
[unhandled content-type:application/pgp-signature]