Date: Mon, 4 Feb 2008 11:22:03 +0000
From: Andy Whitcroft <>
Subject: Re: [PATCH] checkpatch: add __asm__ to function-space-paren exception list
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/4/61

On Tue, Jan 29, 2008 at 05:17:28PM -0600, Timur Tabi wrote:
> checkpatch.pl thinks that __asm__ is a function name, so it complains about
> a space between the function name and a parenthesis when it sees
> "__asm__ ("mov ax,bx")".
> 
> This change will also encourage developers to use '__asm__' instead of 'asm'.
> 
> Signed-off-by: Timur Tabi <timur@freescale.com>
> ---
>  scripts/checkpatch.pl |    2 +-
>  1 files changed, 1 insertions(+), 1 deletions(-)
> 
> diff --git a/scripts/checkpatch.pl b/scripts/checkpatch.pl
> index 579f50f..971c822 100755
> --- a/scripts/checkpatch.pl
> +++ b/scripts/checkpatch.pl
> @@ -1115,7 +1115,7 @@ sub process {
> 
>  # check for spaces between functions and their parentheses.
>  		while ($line =~ /($Ident)\s+\(/g) {
> -			if ($1 !~ /^(?:if|for|while|switch|return|volatile|__volatile__|__attribute__|format|__extension__|Copyright|case)$/ &&
> +			if ($1 !~ /^(?:if|for|while|switch|return|volatile|__volatile__|__attribute__|format|__extension__|Copyright|case|__asm__)$/ &&
>  		            $line !~ /$Type\s+\(/ && $line !~ /^.\#\s*define\b/) {
>  				WARN("no space between function name and open parenthesis '('\n" . $herecurr);
>  			}
> -- 
It truly is not clear what "type" of thing an __asm__ is these days.
Cirtainly it seems we can use it as an attribute of a type:
        register unsigned long __r16 __asm__("$16") = rtc_access->function;
and yet also in its more traditional form:
	__asm__("	call foo");
The latter form feels like a function?  But cirtainly in the examples it
is shown with a space some of the time, and not others.  Is __asm__ an
attribute of the null function (;) in this context or ... well ?
This patch really just removes any checks for spacing on __asm__ do we
have a preferred style for these?  Attributes do seem to have spaces,
though in their most attribute like usage the __asm__ "attribute" does
not seem to be used with a space, so far anyhow.
Oh and why are we preferring the use of __asm__ over asm?  They both
seem valid.  Should we be recommending one over the other?
-apw