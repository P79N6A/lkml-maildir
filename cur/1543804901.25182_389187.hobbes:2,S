Date: Mon, 23 Jan 2006 09:57:00 +0000
From: Russell King <>
Subject: Re: [PATCH] serial: serial_txx9 driver update
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/23/58

On Mon, Jan 23, 2006 at 03:05:02PM +0900, Atsushi Nemoto wrote:
> -			if (disr & TXX9_SIDISR_UOER)
> +			if (disr & TXX9_SIDISR_UOER) {
>  				up->port.icount.overrun++;
> +				/*
> +				 * The receiver read buffer still hold
> +				 * a char which caused overrun.
> +				 * Ignore next char by adding RFDN_MASK
> +				 * to ignore_status_mask temporarily.
> +				 */
> +				next_ignore_status_mask |=
> +					TXX9_SIDISR_RFDN_MASK;
> +			}
I'm not sure what you mean here.
If we successfully received the string ABCDEFGH, and the next character
to be received (I) causes an overrun condition, what happens in the
case that overruns are not ignored?
Will you read ABCDEFG without any errors from the UART, and then H with
an overrun error?  If so, you should pass to the TTY layer ABCDEFGH and
then a NUL character with TTY_OVERRUN set.  Note that uart_insert_char()
does this for you.
Alternatively, the UART may give you: ABCDEFGI where I is marked as an
overrun error.  In this case, you want to pass to the TTY layer ABCDEFG,
then a NUL character with TTY_OVERRUN set, then I.
If overruns are ignored, you merely omit to insert the NUL character with
TTY_OVERRUN set.
-- 
Russell King
 Linux kernel    2.6 ARM Linux   - 
http://www.arm.linux.org.uk/
 maintainer of:  2.6 Serial core
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/