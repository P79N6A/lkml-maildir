Date: Thu, 13 Mar 2008 21:52:57 -0800
From: David Brownell <>
Subject: Re: [patch 2.6.25-rc5 1/2] gpiolib:  dynamic gpio number allocation
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/14/34

On Thursday 13 March 2008, Andrew Morton wrote:
> > > > Actually, I tried IDRs for a while and they broke platforms
> > > > which needed to initialize and use GPIOs early: before kmalloc
> > > > would work.  A real PITA that was -- and slow too.
> > > 
> > > If IDRs were slow, that linear search will be glacial.
> > 
> > The slowness of IDRs was needing to use them for the
> > routine lookups ... versus the current array index,
> > which costs a fraction of an instruction cycle and
> > doesn't need separate locks.
> > 
> > Or were you implying they should be used for something
> > other than mapping GPIO numbers to controllers/state?
> 
> For dynamic allocation.  There should be no need for lookups outside
> register/unregister.
So -- a secondary data structure used only for allocation?
With the primary one as it is now? 
If allocation were a hotspot something like that might be
worth considering ... though such duplication is usually
error prone.  But it's not; such allocation is a rarity.
> Where did the CONFIG_NR_GPIOS discussion disappear to?
http://marc.info/?l=linux-kernel&m=120545979527097&w=2
I could maybe see a CONFIG_NR_EXTRA_GPIOS.