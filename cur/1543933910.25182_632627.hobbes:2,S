Date: Sun, 30 Dec 2007 13:01:11 +0200
From: Adrian Bunk <>
Subject: Re: [PATCH] x86: unify x86 Makefile(s)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/30/75

On Sun, Dec 30, 2007 at 03:00:51AM +0100, Andi Kleen wrote:
> 
> > Without inlining the maxmimum stack usage inside foobar() is
> > max(stack usage foo(), stack usage bar()). [1]
> 
> It's a little more complicated. gcc 4.x (not sure which x, might 0) 
> is clever enough to not use max() stack, but only use the stack for the 
> different scopes as needed similar as when the calls weren't inlined. 
> But gcc 3 didn't do that.
That's roughly what I wanted to say.
> > With foo() and bar() inlined (-funit-at-a-time also enables 
> > -finline-functions-called-once), the maxmimum stack usage inside 
> > foobar() is sum(stack usage foo(), stack usage bar()). And this
> > worst case is the area where gcc 4 is much better than gcc 3.4.
> 
> Yes exactly.  If the functions weren't inlined the problem wouldn't
> occur because the stack sizes do not add up in the same dynamic call chain. 
> Thus a few statetic noinlines will fix it.
And we are back at my main point that risking regressions for getting 
better code with some ancient compiler isn't worth it.
Plus the fact that noinline's might result in slightly worse code with 
current compilers.
> -Andi
cu
Adrian
-- 
       "Is there not promise of rain?" Ling Tan asked suddenly out
        of the darkness. There had been need of rain for many days.
       "Only a promise," Lao Er said.
                                       Pearl S. Buck - Dragon Seed