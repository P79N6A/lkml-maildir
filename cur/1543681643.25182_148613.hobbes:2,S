Date: Wed, 16 Jul 2003 10:44:48 +0200
From: Gerd Knorr <>
Subject: Re: [RFC/PATCH] sysfs'ify video4linux
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/16/36

> >   * some usb webcam drivers (usbvideo.ko, stv680.ko, se401.ko 
> >     and ov511.ko) use the video_proc_entry() to add additional
> >     procfs files.  These drivers must be converted to sysfs too
> >     because video_proc_entry() doesn't exist any more.
> 
> I'd be glad to do this work once your change makes it into the core.  Is
> there any need for these drivers to export anything through sysfs now
> instead of /proc?  From what I remember, it only looked like debugging
> and other general info stuff.
IIRC some tuning / debugging / info stuff, the drivers should work just
fine without.  Temporarely disableling that wouldn't be a big issue
IMHO.
> So dev should point to the dev of the video class device?
Exactly.  videodev.o will put that into class_device->dev which in turn
will produce these symlinks:
eskarina kraxel /sys/class/video4linux/video0# ll device
lrwxrwxrwx    1 root     root           53 Jul 15 17:20 device -> ../../../devices/pci0000:00/0000:00:06.0/0000:02:07.0/
> > Comments?
> 
> You _have_ to set up a release function for your class device.  You
> can't just kfree it like I think you are doing, otherwise any users of
> the sysfs files will oops the kernel after the video class device is
> gone.
class_device_unregister() is called from video_unregister_device() which
looks fine to me.  Or do you talk about something else?
> Other than that, how about exporting the dev_t value for the video
> device?  Then you automatically get udev support, and I don't have to go
> add it to this code later :)
Do you have a pointer to sample code for that?
  Gerd
-- 
sigfault
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/