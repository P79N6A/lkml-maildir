Date: Mon, 21 Aug 2000 15:12:11 +0200 (MET DST)
From: Christian Ehrhardt <>
Subject: Re: [FIX] Make deadlock detection work for file locking
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/21/36

On Mon, Aug 21, 2000 at 04:40:21PM +1000, Stephen Rothwell wrote:
Hi,
> Somewhere along the line, deadlock detection on fcntl locks
> broke.  Again, this was deteced by Chris Yeoh's POSIX
> compliance testing.  The following patch (part of a patch
Mostly curious: What kind of problems did you have with deadlock
detection? AFAICS your patch looks ok, but deadlock detections seems
to be functionally equivilent with or without the patch.
The only thing that could affect deadlock detection is the following
piece of the patch, because it adds the necessary list_add call for the
otherwise unneeded list_del call in locks_delete_block. But if this
is the case we should see list corruption, not just deadlock detection
failing.
> @@ -351,8 +356,8 @@
>  		locks_delete_block(waiter);
>  	}
>  	list_add_tail(&waiter->fl_block, &blocker->fl_block);
> -//	list_add(&waiter->fl_link, &blocked_list);
> -//	waiter->fl_next = blocker;
> +	list_add(&waiter->fl_link, &blocked_list);
> +	waiter->fl_next = blocker;
>  }
> 
>  /* Wake up processes blocked waiting for blocker.
   regards   Christian
-- 
THAT'S ALL FOLKS!
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/