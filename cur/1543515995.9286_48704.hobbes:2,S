Date: Sat, 13 Nov 1999 08:25:54 +0000
From: Jeff Garzik <>
Subject: PATCH 2.3.28: drivers/net/Makefile update
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/13/11

Attached is a patch against 2.3.28 which causes 'net.o' to be output not
'net.a'.  I believe this is necessary in order to use initcall drivers,
which will not be linked into the kernel image otherwise.
Long term, it would be nice to output *.a files again.  How can ld be
told it needs to link those initcall-only modules into vmlinux?
Regards,
	Jeff
-- 
Jeff Garzik              | Just once, I wish we would encounter
Building 1024            | an alien menace that wasn't immune to
MandrakeSoft, Inc.       | bullets.   -- The Brigadier, "Dr. Who"Index: Makefile
===================================================================
RCS file: /g/cvslan/linux_2_3/Makefile,v
retrieving revision 1.1.1.17
retrieving revision 1.1.1.17.4.1
diff -u -r1.1.1.17 -r1.1.1.17.4.1
--- Makefile	1999/11/12 22:59:05	1.1.1.17
+++ Makefile	1999/11/13 07:50:32	1.1.1.17.4.1
@@ -112,6 +112,7 @@
 DRIVERS		=drivers/block/block.a \
 		 drivers/char/char.o \
 		 drivers/misc/misc.o \
+		 drivers/net/net.o \
 	         drivers/parport/parport.a
 LIBS		=$(TOPDIR)/lib/lib.a
 SUBDIRS		=kernel drivers mm fs net ipc lib
@@ -123,8 +124,6 @@
 ifeq ($(CONFIG_ISDN),y)
 DRIVERS := $(DRIVERS) drivers/isdn/isdn.a
 endif
-
-DRIVERS := $(DRIVERS) drivers/net/net.a
 
 ifdef CONFIG_NET_FC
 DRIVERS := $(DRIVERS) drivers/net/fc/fc.a
Index: drivers/net/Makefile
===================================================================
RCS file: /g/cvslan/linux_2_3/drivers/net/Makefile,v
retrieving revision 1.1.1.11
retrieving revision 1.1.1.11.8.1
diff -u -r1.1.1.11 -r1.1.1.11.8.1
--- drivers/net/Makefile	1999/11/11 04:52:09	1.1.1.11
+++ drivers/net/Makefile	1999/11/13 07:50:32	1.1.1.11.8.1
@@ -19,8 +19,8 @@
 MOD_IN_SUB_DIRS :=
 ALL_SUB_DIRS := $(SUB_DIRS) fc hamradio irda pcmcia tokenring wan
 
-L_TARGET := net.a
-L_OBJS   := auto_irq.o
+O_TARGET := net.o
+O_OBJS   := auto_irq.o
 M_OBJS   :=
 MOD_LIST_NAME := NET_MODULES
 
@@ -258,14 +258,11 @@
 
 # Translate to Rules.make lists.
 
-O_OBJS          := $(filter-out $(export-objs), $(obj-y))
+O_OBJS          += $(filter-out $(export-objs), $(obj-y))
 OX_OBJS         := $(filter     $(export-objs), $(obj-y))
 M_OBJS          := $(sort $(filter-out $(export-objs), $(obj-m)))
 MX_OBJS         := $(sort $(filter     $(export-objs), $(obj-m)))
 
-L_OBJS += $(O_OBJS)
-L_OBJS += $(OX_OBJS)
-
 include $(TOPDIR)/Rules.make
 
 clean: