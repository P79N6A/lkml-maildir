Date: Mon, 08 Nov 1999 23:39:56 +0100
From: Luca Montecchiani <>
Subject: [2.3.26] no DMA with AliM15x3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/8/133

I'm having trouble getting DMA/UDMA capabilities with ali1533 chipset (see dmesg later).
The same disks work fine in UDMA mode with my previous PIIX4 mobo.
Using hda after an "hdparm -d1 /dev/hda" give :
   home kernel: hda: timeout waiting for DMA
   home kernel: hda: irq timeout: status=0x58 { DriveReady SeekComplete DataRequest }
   home kernel: hda: DMA disabled
   home kernel: ide0: reset: success
Follow some debug infos:
with my old good PIIX4 mobo:
----------------------------
PIIX4: IDE controller on PCI bus 00 dev 39                                                
PIIX4: not 100% native mode: will probe irqs later                                        
    ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:pio, hdb:pio                        
    ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:pio, hdd:pio                        
hda: Maxtor 84320D4, ATA DISK drive                                                       
hdc: WDC AC24300L, ATA DISK drive                                                         
hdd: ASUS CD-S340, ATAPI CDROM drive                                                      
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14                                                       
ide1 at 0x170-0x177,0x376 on irq 15                                                       
hda: Maxtor 84320D4, 4028MB w/256kB Cache, CHS=1023/128/63, UDMA                          
hdc: WDC AC24300L, 4112MB w/256kB Cache, CHS=8912/15/63, UDMA                             
hdd: ATAPI 34X CD-ROM drive, 128kB Cache                                                  
Uniform CDROM driver Revision: 2.55
With my current alim1533 mobo:
------------------------------
Uniform Multi-Platform E-IDE driver Revision: 6.20                                        
ALI15X3: IDE controller on PCI bus 00 dev 78                                              
ALI15X3: not 100% native mode: will probe irqs later                                      
    ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:DMA, hdb:pio                        
    ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:DMA, hdd:DMA                        
hda: Maxtor 84320D4, ATA DISK drive                                                       
ide: Assuming 40MHz system bus speed for PIO modes; override with idebus=xx               
hdc: WDC AC24300L, ATA DISK drive                                                         
hdd: ASUS CD-S340, ATAPI CDROM drive                                                      
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14                                                       
ide1 at 0x170-0x177,0x376 on irq 15                                                       
hda: Maxtor 84320D4, 4028MB w/256kB Cache, CHS=1023/128/63                                
hdc: WDC AC24300L, 4112MB w/256kB Cache, CHS=8912/15/63                                   
hdd: ATAPI 34X CD-ROM drive, 128kB Cache                                                  
Uniform CD-ROM driver Revision: 3.05   
#cat /proc/ide/ali
                                Ali M15x3 Chipset.                                        
                                ------------------                                        
PCI Clock: 33.                                                                            
CD_ROM FIFO:No , CD_ROM DMA:No                                                            
FIFO Status: contains 0 Words, runs.                                                      
                                                                                          
-------------------primary channel-------------------secondary channel---------           
                                                                                          
channel status:       On                                On                                
both channels togth:  Yes                               Yes                               
Channel state:        OK                                DRQ                               
Add. Setup Timing:    1T                                1T                                
Command Act. Count:   3T                                3T                                
Command Rec. Count:   3T                               3T                                 
                                                                                          
----------------drive0-----------drive1------------drive0-----------drive1------          
                                                                                          
DMA enabled:      Yes              No                Yes              Yes                 
FIFO threshold:    8 Words          8 Words           8 Words          8 Words            
FIFO mode:        FIFO On          FIFO On           FIFO On          FIFO Off            
Dt RW act. Cnt     3T               8T                3T               3T                 
Dt RW rec. Cnt     1T              16T                1T               1T                 
                                                                                          
-----------------------------------UDMA Timings--------------------------------           
                                                                                          
UDMA:             OK               No                OK               OK                  
UDMA timings:     2.5T             1.5T              2.5T             2.5T   
--
More info on request
thanks in advance,
luca
------------------------------------------------------------------
E-mail......: Luca Montecchiani <m.luca@iname.com>
W.W.W.......: 
http://i.am/m.luca
 - 
http://luca.myip.org
Speakfreely.: sflwl -hlwl.fourmilab.ch luca@
I.C.Q.......: 17655604
-----------------------=(Linux since 1995)=-----------------------
Non esiste vento favorevole per il marinaio che non sa dove andare
                                                          Seneca
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/