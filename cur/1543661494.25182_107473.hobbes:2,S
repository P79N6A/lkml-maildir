Date: Wed, 05 Feb 2003 09:08:38 +0100
From: Mike Galbraith <>
Subject: Re: 2.5.59-mm8
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/2/5/7

At 11:31 PM 2/3/2003 -0800, Andrew Morton wrote:
>. Ingo's latest scheduler changes are here.  I held off on that because it
>   appeared that there was some interaction with the I/O scheduler.  Whatever
>   that was has gone away without any CPU scheduler changes, so...
Greetings,
The scheduler changes cause some odd behavior here when running make -j30 
bzImage on my 128MB PIII/500 box.
It seems odd that I'm not getting the level of memory pressure I expect to 
get.  As you can see by the log, at times I _do_ briefly see 'proper' 
memory pressure.  I'm still trying to figure out if this is good or bad 
behavior... all I know for _sure_ is that it's odd=reportable behavior ;-)
         -Mike2.5.59virgin
time make -j30 bzImage
real    8m32.242s
user    7m36.300s
sys     0m45.279s
vmstat 15  (cs peaks are the ext3 sleep_on_buffer thing)
procs -----------memory---------- ---swap-- -----io---- --system-- ----cpu----
 b  w   swpd   free   buff  cache   si   so    bi    bo   in    cs us sy id wa
 0  0      0  26044  10004  78580    0    0     0    58 1010    15  0  0 100  0
31  1      0   4096   6860  43140    0    0   574    25 1110   298 62 13 11 14
31  0  12096   3872    356   6132  119  923   282  1049 1061   132 90 10  0  0
30  2  16444   9060   1308  13308  965 1122  1367  1184 1115   338 90 10  0  0
30  3  51964   8300    496   9272  314 2736   676  2784 1099   224 90 10  0  0
30  1  56036   4420    540  11112  455  967   592   991 1054 37051 83 17  0  0
11 20  63396  19356    484   7328 1693  930  1878   990 1105   327 92  8  0  0
30  2  11152  53140    644  14492 1656    0  1909     5 1100   487 89 11  0  0
26  4  31596   5208    528   5888  435 1818   548  1944 1128   159 91  7  0  2
30  1  30296   8808    612  12432  686 1082  1042  1092 1093   254 91  9  0  0
22  9  45044   7592    572   8860 1166 1509  1409  1567 1100   254 93  7  0  0
27  3  47228   8784    480   7644  749 1805  1027  1857 1101   240 91  9  0  0
18 13  69156   7976    384   8044  681 1973  1123  1999 1108   219 92  8  0  0
29  4  65872   3272    384   6636 1765  477  1989   506 1110   399 92  8  0  0
26  7  48752  21492    620   9796 1324   13  1606    47 1137   368 95  5  0  0
29  9  71664  17428    364   5444  554 2560   640  2597 1088   165 90  8  0  2
27 10  34064  70984    828  10344 1407   34  1769    57 1120   478 92  7  0  1
30  2  37936   4008    424   8164  366  459   575   531 1058   127 91  9  0  0
24  6  40388   4748    680   7484  589 1218   886  1291 1116 16452 90 10  0  0
17 14  29272  20172    752  11260  830  534  1220   592 1113  4176 89 11  0  0
31  0  37072   5736   1000  11988  312 1277   648  1335 1100   282 90 10  0  0
30  0  64908   5084    476   9212  225 2162   672  2201 1090   174 91  9  0  0
17 14  78096  10636    500   7868  991 1439  1194  1462 1087   208 92  8  0  0
19 11  72888  24556    736   7844 1906  246  2122   289 1111 18563 89 11  0  0
30  0  30504   4552    804   9668 1228  254  1437   298 1086   326 89 11  0  0
27  4  37568   4536    592   8408  355 1257   780  1334 1109 25522 87 13  0  0
27  3  56528   7668    916   7720  262 1996   557  2062 1099 27402 86 14  0  0
30  2  34592   5428   1208  15908 1752    0  2000     6 1107   401 90 10  0  0
30  2  38672   9408    788  10420  560 1597   862  1692 1107   254 91  9  0  0
28  2  53400   4312    456   6940  681 2205   949  2271 1101   165 90 10  0  0
20 13  58740   4968    480   6820 1054 1282  1454  1320 1110   261 91  9  0  0
16 14  46344  34272    736   9532 1585  490  1820   536 1109   384 94  6  0  0
14 15  34716  20292    692   8196 1205  518  1464   584 1113   372 91  9  0  0
 9  0   9504  49672    832  14148  379    0   556    33 1052   183 93  7  0  0
 1  0   3784  90932   1840  25600  164    0   541     6 1064   175 70  8  6 16
 0  0   3252  88684   1904  29504   18    0    27   313 1014    14 10  1 86  3
cat /proc/vmstat
nr_dirty 9
nr_writeback 0
nr_pagecache 8411
nr_page_table_pages 82
nr_reverse_maps 3013
nr_mapped 494
nr_slab 1091
pgpgin 656537
pgpgout 567703
pswpin 106716
pswpout 130805
pgalloc 974323
pgfree 996216
pgactivate 47559
pgdeactivate 166306
pgfault 1678430
pgmajfault 26378
pgscan 1636171
pgrefill 612528
pgsteal 189050
kswapd_steal 172191
pageoutrun 559
allocstall 394
pgrotated 133033
2.5.59mm8
time make -j30 bzImage
real    8m17.891s
user    7m32.807s
sys     0m37.855s
vmstat 15
procs -----------memory---------- ---swap-- -----io---- --system-- ----cpu----
 b  w   swpd   free   buff  cache   si   so    bi    bo   in    cs us sy id wa
 0  0      0  27504   9840  77228    0    0     0     1 1005    16  0  0 100  0
32  0      0   8468   5620  24840    0    0   562    99 1241   267 66 12  7 15
28  3   2468   6064   1312  16564    0  119    93   155 1024    70 93  7  0  0
29  1   8772   3992    700   8032   57  637   216   780 1165   107 93  7  0  0
30  0   7380  42208    584  13112  205  297   472   328 1052   132 92  8  0  0
31  0   5392  41108    788  15864   50    0   145    27 1141    90 91  9  0  0
30  0   5028  29400    832  17112   13    0    48    26 1008    68 90 10  0  0
30  0   4700   6820    868  19644   16    0    51    45 1009    56 92  8  0  0
31  0   6556  19780    564  12612  194  606   418   684 1059   116 91  9  0  0
31  0   6876   6764    624  14804   20   91   144   126 1026    77 93  7  0  0
30  0  23504  26300    608   8764  594 1814   828  1886 1094   196 93  7  0  0
31  0  14052  21500    776  14092  269    0   379    11 1027    99 91  9  0  0
30  0  12996  21568    840  15208   85    0   130    30 1013    77 91  9  0  0
29  0  13452   5884    724  10592   95  434   202   497 1046    84 93  7  0  0
30  0  12780   5180    752  13180  166  295   380   340 1057   117 92  8  0  0
30  0  11200  26108    780  14800  360  255   618   281 1059   138 92  8  0  0
30  0   5984  19264    864  16308   34    0    83    11 1012    68 92  8  0  0
35  2   5576  22904    956  17516    9    0    52    69 1121    72 91  9  0  0
28  1   9656   5080    812  12796   41  239   157   302 1126    88 92  8  0  0
30  0   6548   7716    856  16208   16  135   121   179 1021    71 92  8  0  0
32  0  18812  17360    792  12348  167 1084   423  1173 1070   134 93  7  0  0
25  7  30716   2036    344   5428  174 1024   263  1094 1046    96 92  8  0  0
32  0  33512  24400   1124  12016  562  603   963   628 1096   239 92  8  0  0
19 12  59868   8328    348   4584  889 2033  1025  2096 1085   286 92  8  0  0
33  0  21860  51380    828  11412 1663    0  1958    28 1560   324 95  5  0  0
30  0  17056   4184    748  10264  195  411   367   462 1040   107 91  9  0  0
30  1  14364  11592    480  11772  317  366   675   428 1077   159 92  8  0  0
27  5  24524  12612    448   7028  331 1066   530  1133 1066   135 93  7  0  0
31  0  20788   4336    592   9960  526  479   831   532 1080   162 92  8  0  0
27  3  15992  30696    484  10704  495  467   755   499 1069   134 93  7  0  0
26  0  12836  11568    768  15608  133    0   229    31 1024    67 92  8  0  0
16  0   6900  27020   1432  16540  124    0   243    31 1033    89 94  6  0  0
 2  0   3948  89740   1836  25836  150    0   452    54 1051   162 77 10  0 13
 0  0   3444  88092   1960  29964   17    0    26   285 1010    19 19  1 75  6
cat /proc/vmstat
nr_dirty 45
nr_writeback 0
nr_pagecache 8242
nr_page_table_pages 82
nr_reverse_maps 2968
nr_mapped 443
nr_slab 1093
pgpgin 288727
pgpgout 228599
pswpin 29935
pswpout 46709
pgalloc 860920
pgfree 883000
pgactivate 29331
pgdeactivate 53165
pgfault 1581553
pgmajfault 8197
pgscan 725596
pgrefill 262595
pgsteal 80259
pginodesteal 0
kswapd_steal 77602
kswapd_inodesteal 6800
pageoutrun 296
allocstall 62
pgrotated 49144
2.5.59mm8  (reboot and run again)
time make -j30 bzImage
real    8m23.052s
user    7m32.998s
sys     0m38.119s
vmstat 15
procs -----------memory---------- ---swap-- -----io---- --system-- ----cpu----
 b  w   swpd   free   buff  cache   si   so    bi    bo   in    cs us sy id wa
 0  0      0  26280   9828  78788    0    0     0     3 1006    15  0  0 100  0
30  0      0   4064   6612  46368    0    0   597   109 1115   292 60 13  7 20
30  2  13212  24908   1060   8548  282 1173   618  1220 1087   176 92  8  0  0
31  0   9228  10800   2048  13732  169    0   362   108 1050   140 91  9  0  0
30  1   7048  33100   2120  14916   42    0   130     6 1074    89 91  9  0  0
32  1   5636  22728   2156  17752   53    0    99    48 1013    72 91  9  0  0
30  0   5588   6616   2196  18884    2    0    28    29 1006    57 91  9  0  0
30  1   5588  13556   2232  18932    0    0    17    53 1007    54 92  8  0  0
31  1   7320  29180    672  14788  105  420   252   478 1035    89 91  9  0  0
30  0   5804   9968    628  17320   11    0    64    31 1011    59 92  8  0  0
16 20  30060  11476    572   5896  217 1833   387  1915 1074   144 93  7  0  0
30  0  20300   9204    680  12936  247    2   549    25 1058   152 93  7  0  0
29  1  18764   4008    616  10952  272  460   378   493 1039    84 92  8  0  0
27  1  16612  27556    668  11040  203  155   421   191 1131   114 94  6  0  0
30  0   8896   5936   1012  17892  189    0   353    11 1038   117 91  9  0  0
30  0  15548   7284    432   9416  235  727   443   820 1058   101 93  7  0  0
30  0  14576  24192    696  12640  241  439   451   462 1055   132 93  7  0  0
30  0  12276   9504    844  15500  130    0   222    33 1021    80 92  8  0  0
30  0  15000  24360    684  11976  246  521   389   577 1047   104 93  7  0  0
29  2  12620  30664    780  16176   57    0   122    40 1015    74 91  9  0  0
27  4  16492   5096    672  10932   85  354   162   428 1029    81 92  8  0  0
34  0  12296  15128    820  15356   78    0   227    55 1176   118 92  8  0  0
30  1  13348  16020    688  11844  135  383   280   455 1183   104 92  8  0  0
27  3  13888   5152    516   9452   61  357   195   422 1034    74 92  8  0  0
30  0  16640  14528    596  13580  232  600   641   633 1124   166 92  8  0  0
19 12  56068   8624    524   6104  418 2797   557  2868 1085   187 91  7  0  2
30  1  36076   5260    804  12532 1101    0  1398    26 1089   228 92  8  0  0
24  7  31848  12852    340   8348  600  661   794   728 1077   137 92  8  0  0
30  1  21700   4584    732  10172  421  298   683   356 1079   175 91  9  0  0
26  4  43768  25020    528   7040  527 1980   783  2049 1108   260 90  7  0  3
27  0  17740  79336    968  12516 1355    0  1721     4 1113   449 79  9  0 12
17  4  14824   8372    600   9504  143  301   193   360 1028    65 92  8  0  0
 6  0   7664  61484    860  14796  134  191   344   208 1041    96 96  4  0  0
 1  0   3996  88244   1604  27716   85    0   370    55 1048   142 73  7  0 20
 0  0   3468  89264   1780  28904   18    0    46   314 1017    18  2  1 88  9