Date: Wed, 26 Mar 2003 13:30:21 -0800
From: Andrew Morton <>
Subject: Re: [2.5.66] slab corruption
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/3/26/214

Jochen Hein <jochen@jochen.org> wrote:
>
> 
> This is when shutting down.  I have the two patches from Jack Simmons
> for the illegal context and the broken cursor applied and nothing
> else.
> 
> uhci-hcd 00:07.2: remove, state 3
> usb usb1: USB disconnect, address 1
There's some nastiness in the USB disconnect code.  Does David Brownell's
patch help?
--- 1.15/drivers/usb/core/urb.c	Thu Mar 13 10:45:40 2003
+++ edited/drivers/usb/core/urb.c	Thu Mar 20 11:17:55 2003
@@ -384,11 +384,11 @@
 	/* FIXME
 	 * We should not care about the state here, but the host controllers
 	 * die a horrible death if we unlink a urb for a device that has been
-	 * physically removed.
+	 * physically removed.  (after driver->disconnect returns...)
 	 */
 	if (urb &&
 	    urb->dev &&
-	    (urb->dev->state >= USB_STATE_DEFAULT) &&
+	    // (urb->dev->state >= USB_STATE_DEFAULT) &&
 	    urb->dev->bus &&
 	    urb->dev->bus->op)
 		return urb->dev->bus->op->unlink_urb(urb);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/