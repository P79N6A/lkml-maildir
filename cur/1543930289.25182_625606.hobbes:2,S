Date: Fri, 07 Dec 2007 17:41:24 -0800
From: Kevin Hilman <>
Subject: [PATCH/RFC -rt] local_bh_enable() is safe for irqs_disabled()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/7/345

In local_bh_enable() there is a WARN_ON(irqs_disabled()), but looking
at the rest of the code, it seems it expects to be used with
interrupts off, so is this warning really necessary?
I hit this warning in the ads7846 touchscreen driver timer function
where enable_irq() may be called with interrupts disabled.  Since
enable_irq now calls local_bh_disable/enable for IRQ resend, this
warning is triggered.
Patch against 2.6.23.9-rt12
Signed-off-by: Kevin Hilman <khilman@mvista.com>
diff --git a/kernel/softirq.c b/kernel/softirq.c
index 4c19017..68149ae 100644
--- a/kernel/softirq.c
+++ b/kernel/softirq.c
@@ -207,7 +207,6 @@ void local_bh_enable(void)
 
 	WARN_ON_ONCE(in_irq());
 #endif
-	WARN_ON_ONCE(irqs_disabled());
 
 #ifdef CONFIG_TRACE_IRQFLAGS
 	local_irq_save(flags);