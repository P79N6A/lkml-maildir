Date: Fri, 11 Jul 2003 13:48:42 +0800 (SGT)
From: Jeff Chua <>
Subject: Re: [PATCH] 2.4.22-pre4 ide module fix init_cmd640_vlb
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/11/12

One more thing ... when compiled as a module, DMA can't be enabled!
If compiled as non-modules (CONFIG_IDE=y, CONFIG_BLK_DEV_IDE=y), DMA works
fine.
# hdparm -d 1 /dev/hda
/dev/hda:
 setting using_dma to 1 (on)
 HDIO_SET_DMA failed: Operation not permitted
 using_dma    =  0 (off)
My .config ...
	CONFIG_IDE=m
	CONFIG_BLK_DEV_IDE=m
	CONFIG_BLK_DEV_IDEDISK=m
	CONFIG_IDEDISK_MULTI_MODE=y
	CONFIG_BLK_DEV_CMD640=y
	CONFIG_BLK_DEV_CMD640_ENHANCED=y
	CONFIG_BLK_DEV_IDEPCI=y
	CONFIG_IDEPCI_SHARE_IRQ=y
	CONFIG_BLK_DEV_IDEDMA_PCI=y
	CONFIG_IDEDMA_PCI_AUTO=y
	CONFIG_BLK_DEV_IDEDMA=y
	CONFIG_BLK_DEV_PIIX=y
	CONFIG_IDEDMA_AUTO=y
	CONFIG_BLK_DEV_IDE_MODES=y
Thanks,
Jeff
[ jchua@fedex.com ]
On Fri, 11 Jul 2003, Jeff Chua wrote:
> On Thu, 10 Jul 2003, James Bourne wrote:
>
> > On 10 Jul 2003, Alan Cox wrote:
> >
> > > And stops it working for everyone else. The function does exist too. See
> > > drivers/ide/pci/cmd640.c
>
> Sorry. Missed this one.
>
>
> > Here's a patch that does that exact thing, I haven't tested it though.
> >
>
> "make" doesn't seem to pick up ide/pci/cmd640.c when IDE is compiled as a
> module.
>
> 	touch drivers/ide/pci/cmd640.c; make; make modules;
> 	*** it doesn't compile cmd640.c
>
>
> Jeff
>
>
>
>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/