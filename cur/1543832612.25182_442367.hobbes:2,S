Date: Sun, 9 Jul 2006 22:02:04 -0400
From: "Brown, Len" <>
Subject: RE: 2.6.17-mm2 -- drivers/built-in.o: In function `is_pci_dock_device':acpiphp_glue.c:(.text+0x12364): undefined reference to `is_dock_device'
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/7/9/268

>it allows the illegal configuration
>ACPI_IBM_DOCK=y, HOTPLUG_PCI_ACPI=y/m, ACPI_DOCK=y/m.
Hmm, that seems to be an additional pre-existing problem.
Since ACPI_IBM_DOCK is going away, lets put the burden
of depending on ACPI_DOCK=n on it, rather than the reverse.
Lets not use select, since it baffles...
and lets add the EXPERIMENTAL that should be here too.
This works for me:
DOCK	HPA	IBM_DOCK	DOCK,HPA,IBM_DOCK
y	y	y	=> 	y,y,n
y	m	y	=> 	y,m,n
y	n	y	=> 	y,n,n
m	y	y	=> 	m,m,n
m	m	y	=> 	m,m,n
m	n	y	=> 	m,n,n
n	y	y	=> 	n,n,y
n	m	y	=> 	n,n,y
n	n	y	=> 	n,n,y
thanks,
-Len
diff --git a/drivers/acpi/Kconfig b/drivers/acpi/Kconfig
index fef7bab..82289f1 100644
--- a/drivers/acpi/Kconfig
+++ b/drivers/acpi/Kconfig
@@ -135,8 +135,7 @@ config ACPI_FAN
 
 config ACPI_DOCK
 	tristate "Dock"
-	depends on !ACPI_IBM_DOCK
-	default y
+	depends on EXPERIMENTAL
 	help
 	  This driver adds support for ACPI controlled docking stations
 
@@ -214,6 +213,7 @@ config ACPI_IBM
 config ACPI_IBM_DOCK
 	bool "Legacy Docking Station Support"
 	depends on ACPI_IBM
+	depends on ACPI_DOCK=n
 	default n
 	---help---
 	  Allows the ibm_acpi driver to handle docking station events.
diff --git a/drivers/pci/hotplug/Kconfig b/drivers/pci/hotplug/Kconfig
index 222a1cc..d305d21 100644
--- a/drivers/pci/hotplug/Kconfig
+++ b/drivers/pci/hotplug/Kconfig
@@ -77,7 +77,7 @@ config HOTPLUG_PCI_IBM
 
 config HOTPLUG_PCI_ACPI
 	tristate "ACPI PCI Hotplug driver"
-	depends on ACPI && HOTPLUG_PCI
+	depends on ACPI_DOCK && HOTPLUG_PCI
 	help
 	  Say Y here if you have a system that supports PCI Hotplug
using
 	  ACPI.[unhandled content-type:application/octet-stream]