Date: Thu, 19 Jul 2007 15:24:11 -0700
From: Arthur Jones <>
Subject: build fix for x86_64...
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/19/610

hi vasily,
commit b716395e2b8e450e294537de0c91476ded2f0395
breaks the build for x86_64 (and ia64 too, i guess) if
CONFIG_COMPAT is not turned on.  here is a patch, which
i think is more complete than the previous one posted
to LKML by Doug Chapman (which only fixes ia64, i think).
it lets the build continue, but i have no idea if it's
correct or not..
arthur
diff --git a/fs/quota.c b/fs/quota.c
index e6577ac..5baeede 100644
--- a/fs/quota.c
+++ b/fs/quota.c
@@ -387,7 +387,7 @@ asmlinkage long sys_quotactl(unsigned int cmd, const char __user *special, qid_t
 	return ret;
 }
 
-#if defined(CONFIG_X86_64) || defined(CONFIG_IA64)
+#if defined(CONFIG_COMPAT) && (defined(CONFIG_X86_64) || defined(CONFIG_IA64))
 /*
  * This code works only for 32 bit quota tools over 64 bit OS (x86_64, ia64)
  * and is necessary due to alignment problems.