Date: Wed, 07 Jan 2009 00:16:03 +0100
From: Peter Zijlstra <>
Subject: Re: [PATCH] configure HAVE_UNSTABLE_SCHED_CLOCK for SGI_SN systems
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/6/500

On Tue, 2009-01-06 at 16:50 -0600, Robin Holt wrote:
> On Tue, Jan 06, 2009 at 09:57:20PM +0100, Peter Zijlstra wrote:
> > On Tue, 2009-01-06 at 12:34 -0800, Luck, Tony wrote:
> > > > > All ia64 systems are potentially affected ... but perhaps you might
> > > > > never see the problem on most because the itc clocks are synced as close
> > > > > as s/w can get them when cpus are brought on line.
> > > >
> > > > Do you want Dimitri to resubmit with this set for all IA64 or leave it
> > > > as is?
> > > 
> > > I'd like to understand the impact of turning on HAVE_UNSTABLE_SCHED_CLOCK
> > > 
> > > It looks like both the i386_defconfig and x86_64_defconfig choose this,
> > > so at least ia64 will be hitting the well tested code paths
> > > 
> > > Have the other architectures just not hit this yet?  Or do they all have
> > > "stable" sched_clock() functions?
> > > 
> > > 
> > > sched_clock() seemed like such a straightforward thing to begin with. A
> > > quick & easy way to measure a time delta ON THE SAME CPU.  I'm not at
> > > all sure why it has been co-opted for general time measurement.
> > 
> > It came from the complication of needing to tell a remote cpu's time due
> > to remote wakeups in the scheduler.
> 
> But doesn't scheduler tick advance the rq->clock?  Why do the others
> need to fiddle with a remote runqueue's clock?  When that cpu starts
> taking ticks again, it will update it's rq->clock field and start the
> processes.  I guess I am a lot underinformed about the new scheduler
> design.
We try to do better than tick based time accounting these days.