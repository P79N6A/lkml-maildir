Date: Mon, 11 Mar 2002 09:07:00 +0100
From: Vojtech Pavlik <>
Subject: [patch] Minor fix for the via82cxxx.c IDE driver.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/3/11/49

Hi!
The attached patch fixes a case where the user enters a bad value for
the system bus clock. The 3.33 version will use a nonsensical value
instead of the bad value given by user.
Patch against 2.5.6, please apply.
Thanks.
-- 
Vojtech Pavlik
SuSE Labs
diff -urN linux-2.5.5/drivers/ide/via82cxxx.c linux-2.5.5-via/drivers/ide/via82cxxx.c
--- linux-2.5.5/drivers/ide/via82cxxx.c	Mon Mar 11 08:46:22 2002
+++ linux-2.5.5-via/drivers/ide/via82cxxx.c	Mon Mar 11 09:04:17 2002
@@ -1,5 +1,5 @@
 /*
- * $Id: via82cxxx.c,v 3.33 2001/12/23 22:46:12 vojtech Exp $
+ * $Id: via82cxxx.c,v 3.34 2002/02/12 11:26:11 vojtech Exp $
  *
  *  Copyright (c) 2000-2001 Vojtech Pavlik
  *
@@ -163,7 +163,7 @@
 
 	via_print("----------VIA BusMastering IDE Configuration----------------");
 
-	via_print("Driver Version:                     3.33");
+	via_print("Driver Version:                     3.34");
 	via_print("South Bridge:                       VIA %s", via_config->name);
 
 	pci_read_config_byte(isa_dev, PCI_REVISION_ID, &t);
@@ -495,7 +495,7 @@
 	if (via_clock < 20000 || via_clock > 50000) {
 		printk(KERN_WARNING "VP_IDE: User given PCI clock speed impossible (%d), using 33 MHz instead.\n", via_clock);
 		printk(KERN_WARNING "VP_IDE: Use ide0=ata66 if you want to assume 80-wire cable.\n");
-		via_clock = 33;
+		via_clock = 33333;
 	}
 
 /*