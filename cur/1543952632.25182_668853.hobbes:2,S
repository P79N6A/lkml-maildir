Date: Wed, 19 Mar 2008 14:25:35 -0300
From: Glauber de Oliveira Costa <>
Subject: [PATCH 40/79] [PATCH] wipe get_nmi_reason out of nmi_64.h
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/19/83

From: Glauber Costa <gcosta@redhat.com>
use mach_traps when it is supposed to be used.
Signed-off-by: Glauber Costa <gcosta@redhat.com>
---
 arch/x86/kernel/nmi_64.c   |    2 ++
 arch/x86/kernel/traps_64.c |    2 ++
 include/asm-x86/nmi_64.h   |    2 --
 3 files changed, 4 insertions(+), 2 deletions(-)
diff --git a/arch/x86/kernel/nmi_64.c b/arch/x86/kernel/nmi_64.c
index bd0fac5..5a29ded 100644
--- a/arch/x86/kernel/nmi_64.c
+++ b/arch/x86/kernel/nmi_64.c
@@ -26,6 +26,8 @@
 #include <asm/proto.h>
 #include <asm/mce.h>
 
+#include <mach_traps.h>
+
 int unknown_nmi_panic;
 int nmi_watchdog_enabled;
 int panic_on_unrecovered_nmi;
diff --git a/arch/x86/kernel/traps_64.c b/arch/x86/kernel/traps_64.c
index 3d36144..6d883b1 100644
--- a/arch/x86/kernel/traps_64.c
+++ b/arch/x86/kernel/traps_64.c
@@ -33,6 +33,8 @@
 #include <linux/kdebug.h>
 #include <linux/utsname.h>
 
+#include <mach_traps.h>
+
 #if defined(CONFIG_EDAC)
 #include <linux/edac.h>
 #endif
diff --git a/include/asm-x86/nmi_64.h b/include/asm-x86/nmi_64.h
index 2eeb74e..94a5b19 100644
--- a/include/asm-x86/nmi_64.h
+++ b/include/asm-x86/nmi_64.h
@@ -36,8 +36,6 @@ static inline void unset_nmi_pm_callback(struct pm_dev * dev)
 extern void default_do_nmi(struct pt_regs *);
 extern void die_nmi(char *str, struct pt_regs *regs, int do_panic);
 
-#define get_nmi_reason() inb(0x61)
-
 extern int unknown_nmi_panic;
 extern int nmi_watchdog_enabled;
 
-- 
1.5.0.6