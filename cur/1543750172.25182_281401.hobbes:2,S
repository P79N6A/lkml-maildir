Date: Mon, 27 Dec 2004 16:20:54 +0100
From: "K.F.J. Martens" <>
Subject: [PATCH] Bug in 2.6.10 mtd driver for physmem mapped flash chips
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/12/27/53

The patch below fixes a small but fatal bug in the code that handles
non-buswidth-aligned writes. The problem is that the code used the same
index in both map_word and buf, therefore putting the wrong words in the
map_word that partially contains old data and partially contains new
data. The result: corrupt data is being written.
Signed-off-by: Koen Martens <kmartens@sonologic.nl>
--- linux-2.6.10/include/linux/mtd/map.h        2004-12-24 22:34:31.000000000 +0100
+++ linux-2.6.10-gmc/include/linux/mtd/map.h    2004-12-27 15:59:02.631211329 +0100
@@ -322,7 +322,7 @@ static inline map_word map_word_load_par
                        bitpos = (map_bankwidth(map)-1-i)*8;
 #endif
                        orig.x[0] &= ~(0xff << bitpos);
-                       orig.x[0] |= buf[i] << bitpos;
+                       orig.x[0] |= buf[i-start] << bitpos;
                }
        }
        return orig;
-- 
K.F.J. Martens, Sonologic, 
http://www.sonologic.nl/
Networking, embedded systems, unix expertise, artificial intelligence.
Public PGP key: 
http://www.metro.cx/pubkey-gmc.asc
Wondering about the funny attachment your mail program
can't read? Visit 
http://www.openpgp.org/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/