Date: Sat, 11 Jun 2005 15:32:46 +0200
From: Ingo Molnar <>
Subject: Re: [PATCH] Real-Time Preemption, using msecs_to_jiffies() instead of HZ
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/6/11/65

* Luca Falavigna <dktrkranz@gmail.com> wrote:
> I was looking at kernel/softlookup.c when I noticed you used HZ in order to get
> a 10-second delay:
> 
> void softlockup_tick(struct pt_regs *regs)
> {
> 	...
> 	if (time_after(jiffies, timestamp + 10*HZ)) {
> 	...
> }
oops, indeed. (i've also forwarded your patch to akpm, as the softlockup 
patch is included in -mm too)
> I created this small patch (built against version 
> 2.6.12-rc6-V0.7.48-05) which does use of msecs_to_jiffies() to get a 
> correct behaviour with every platform. Similarly I modified function 
> watchdog and kernel/irq/autoprobe.c file (probe_irq_on function).
> 
> Here is the patch:
> ++	msleep(msecs_to_jiffies(20));
> ++	msleep(msecs_to_jiffies(100));
> ++		msleep_interruptible(msecs_to_jiffies(1000));
actually, this should be msleep(20/100/1000). I've fixed these in my 
tree.
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/