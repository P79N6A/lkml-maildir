Date: Mon, 15 Oct 2007 11:53:03 +1000
From: David Chinner <>
Subject: Re: [PATCH 01/52] CRED: Introduce a COW credentials record
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/14/237

On Fri, Oct 12, 2007 at 05:05:24PM +0100, David Howells wrote:
> diff --git a/fs/xfs/xfs_acl.c b/fs/xfs/xfs_acl.c
> index 4ca4beb..a460508 100644
> --- a/fs/xfs/xfs_acl.c
> +++ b/fs/xfs/xfs_acl.c
> @@ -383,7 +383,7 @@ xfs_acl_allow_set(
>  	error = bhv_vop_getattr(vp, &va, 0, NULL);
>  	if (error)
>  		return error;
> -	if (va.va_uid != current->fsuid && !capable(CAP_FOWNER))
> +	if (va.va_uid != current->cred->uid && !capable(CAP_FOWNER))
current_fsuid() should be used here.
>  		return EPERM;
>  	return error;
>  }
> @@ -457,13 +457,13 @@ xfs_acl_access(
>  		switch (fap->acl_entry[i].ae_tag) {
>  		case ACL_USER_OBJ:
>  			seen_userobj = 1;
> -			if (fuid != current->fsuid)
> +			if (fuid != current->cred->uid)
>  				continue;
>  			matched.ae_tag = ACL_USER_OBJ;
>  			matched.ae_perm = allows;
>  			break;
>  		case ACL_USER:
> -			if (fap->acl_entry[i].ae_id != current->fsuid)
> +			if (fap->acl_entry[i].ae_id != current->cred->uid)
and here as well....
Cheers,
Dave.
-- 
Dave Chinner
Principal Engineer
SGI Australian Software Group
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/