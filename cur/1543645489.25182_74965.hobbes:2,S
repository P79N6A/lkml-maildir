Date: 30 Sep 2002 16:39:23 +0200
From: Arjan van de Ven <>
Subject: Re: [PATCH] 2.5.39 s390 (3/26): drivers.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/9/30/130

> --- linux-2.5.39/drivers/s390/misc/chandev.c	Fri Sep 27 23:49:45 2002
> +++ linux-2.5.39-s390/drivers/s390/misc/chandev.c	Mon Sep 30 14:34:55 2002
> @@ -24,6 +24,7 @@
>  #include <asm/s390dyn.h>
>  #include <asm/queue.h>
>  #include <linux/kmod.h>
> +#include <linux/tqueue.h>
>  #ifndef MIN
>  #define MIN(a,b) ((a<b)?a:b)
>  #endif
> @@ -2825,6 +2826,7 @@
>  	struct stat statbuf;
>  	char        *buff;
>  	int         curr,left,len,fd;
> +	mm_segment_t oldfs;
> 
>  	/* if called from chandev_register_and_probe & 
>  	   the driver is compiled into the kernel the
> @@ -2835,6 +2837,7 @@
>  	if(in_interrupt()||current->fs->root==NULL)
>  		return;
>  	atomic_set(&chandev_conf_read,TRUE);
> +	oldfs = get_fs();
>  	set_fs(KERNEL_DS);
>  	if(stat(CHANDEV_FILE,&statbuf)==0)
>  	{
> @@ -2859,7 +2862,7 @@
>  			vfree(buff);
>  		}
>  	}
> -	set_fs(USER_DS);
> +	set_fs(oldfs);
>  }
> 
>  static void chandev_read_conf_if_necessary(void)
Ehm. Ok. This code STILL tries to read and parse config files. If you're
fixing it, can you please fix it to NOT read and parse config files from
inside the kernel? Please? 
Greetings,
   Arjan van de Ven
[unhandled content-type:application/pgp-signature]