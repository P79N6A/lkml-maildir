Date: Wed, 3 Dec 2003 21:03:09 +0100 (CET)
From: Ingo Molnar <>
Subject: Re: kernel BUG at kernel/exit.c:792!
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/12/3/134

On Wed, 3 Dec 2003, Linus Torvalds wrote:
> I think the problem is the BUG() itself, not really the caller. So I'd
> prefer the fix for this to be to just entirely remove the debug tests
> withing that "#ifdef CONFIG_SMP", rather than hide the threads from
> /proc when this happens.
> 
> Ingo, comments?
i'd like to keep the BUG() - it has caught this bug, and it has caught
other bugs too in the past. The next_thread() use of procfs is clearly
illegal if it happens after a thread has been removed from the tasklist.
procfs is really special in this regard (nothing else that accesses the
thread list is supposed to have a stale reference to the task).
removing the debug tests will cause further crashes i think - the thread
pointers are not valid anymore, they could point to truly freed tasks.  
(this particular task is not freed yet because it has a procfs reference -
but the thread list pointers are not valid anymore.)
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/