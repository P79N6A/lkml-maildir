Date: Fri, 29 Sep 2000 19:33:40 +0100 (BST)
From: Alan Cox <>
Subject: Re: [Q] net_device methods and disable_irq interaction (SMP&UP)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/29/61

> Can spin_lock_irqsave and the disable_irq & spin_lock combinations be
> safely mixed, particularly with regards to the networking layer? This does
> not seem to be done anywhere in the kernel so I suspect that I'm trying
> to do something wrong/bogus ...
We do it on the 8390 and 3c509.
#ifdef __SMP__
	        disable_irq_nosync(dev->irq);
	        spin_lock(&lp->lock);
#endif       
		slow stuff
#ifdef __SMP__
	        spin_unlock(&lp->lock);
     		enable_irq(dev->irq);
#endif          
You need to allow for an IRQ coming in after the disable_irq happens. If its
already pending at the wrong moment on SMP at least it happens very very
occasionally.
Alan
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/