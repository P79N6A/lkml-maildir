Date: Tue, 13 Feb 2007 13:02:46 +0100
From: Marcel Siegert <>
Subject: Re: dvb shared datastructure bug?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/13/108

On Tuesday 13 February 2007, Jakub Jelinek wrote:
> On Tue, Feb 13, 2007 at 03:14:23PM +0400, Manu Abraham wrote:
> > >thanks for pointing out this issue.
> > >
> > >attached find a patch that fixes the problem.
> > >
> > >@mauro - please pull changeset a7ac92d208fe
> > >   dvbdev: fix illegal re-usage of fileoperations struct
> > >
> > >from  
http://www.linuxtv.org/hg/~mws/v4l-dvb-fixtree
> > >
> > 
> > Ack'd-by: Manu Abraham <manu@linuxtv.org>
> 
> Wouldn't it be better to kmalloc both struct dvb_device and
> struct file_operations together instead of doing 2 separate allocations?
> struct dvd_device_plus_fops
> {
>   struct dvb_device dev;
>   struct file_operations fops;
> } *dev_fops = kmalloc (sizeof (struct dvd_device_plus_fops), GFP_KERNEL);
> *pdvbdev = dvbdev = (struct dvb_device *)dev_fops;
> if (dev_fops == NULL)
>   error handling;
> memset (&dev_fops->fops, 0, sizeof (dev_fops->fops));
> ...
> dvbdev->fops = &dev_fops->fops;
> 
> 	Jakub
> 
hi jakub, 
it may be worth doing that, but, imho that can be done when we are perfoming
some revise of the whole dvb-core subsystem. 
at the moment i would stay at "as-is", the code is more readable and the more "cost"
of the additional alloc is affordable.
thanks for your comments.
marcel
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/