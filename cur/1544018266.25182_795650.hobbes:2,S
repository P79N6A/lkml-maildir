Date: Thu, 22 Jan 2009 16:16:10 +1100
From: Benjamin Herrenschmidt <>
Subject: Re: 2.6.29-rc powerpc G5 Xorg legacy_mem regression
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/22/4

> That's as far as I took it: I can see there's code to set up
> "Legacy VGA memory" but it looks like that's not coming into play.
> dmesg and .config attached: I think you'll get to the point much
> quicker than I would.
> 
> Though I bet you're busy at the moment: no hurry, I can comment
> out the pci_create_legacy_files() from drivers/pci/bus.c for now.
It's actually an X bug :-(
IE, I always create the legacy files, I just make mmap fail when legacy
VGA isn't available. This is the right way to do it, as it properly
informs X that yes, I do support the new API and no, there's no point in
trying to access legacy VGA memory on this machine.
I honestly don't see how I can fix that without making proper support
for legacy memory / IO impossible, and thus guaranteeing that X will
eternally continue to crap on random bits of /dev/mem in the future :-(
Cheers,
Ben.