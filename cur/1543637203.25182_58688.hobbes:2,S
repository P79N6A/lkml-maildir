Date: Tue, 23 Jul 2002 22:56:28 +0200
From: Andrea Arcangeli <>
Subject: Re: kernel BUG at page_alloc.c:92! & page allocation failure. order:0, mode:0x0
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/7/23/204

On Tue, Jul 23, 2002 at 01:47:28PM -0700, Andrew Morton wrote:
> Andrea Arcangeli wrote:
> > 
> > On Tue, Jul 23, 2002 at 12:24:04PM -0700, Andrew Morton wrote:
> > > David F Barrera wrote:
> > > >
> > > > I have experienced the following errors while running a test suite (LTP
> > > > test suite)  on the 2.4.26 kernel.  Has anybody seen this problem, and, if
> > > > so, is there a patch for it?  Thanks.
> > > >
> > > > kernel BUG at page_alloc.c:92!
> > >
> > > Could you please replace the put_page(page) in
> > > kernel/ptrace.c:access_process_vm() with page_cache_release(page)
> > > and retest?
> > 
> > I prefer to drop page_cache_release and to have __free_pages_ok to deal
> > with the lru pages like it's been fixed in 2.4.
> 
> That would fix it too.  But a __free_pages_ok call from interrupt
> context can deadlock the box.
I guess you mean it can corrupt the lru list, not necessairly deadlock
the box. That's not the case either though, see the in_interrupt() check
in my tree in free_pages_ok, only normal context is allowed to play with
pagecache. (async-io isn't in my tree)
> 
> The removal of pages from the LRU is rather a mess.  It's getting
> better, and we can fix up some more of this if/when pagemap_lru_lock
> becomes an interrupt-safe lock.
that will allow irq to manage pagecahce but the fact it's not interrupt
safe it's really a irq latency feature, the fact disabling irqs during
the critical section decreases contention on the lock is kind of hack,
that is true for all spinlocks out there, by that argument all spinlocks
should be irq safe.
Andrea
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/