Date: Tue, 30 Oct 2007 19:44:04 -0400 (EDT)
From: Steven Rostedt <>
Subject: Re: [PATCH -rt] remove in_interrupt() BUG_ON in exit path
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/10/30/521

--
On Tue, 30 Oct 2007, Daniel Walker wrote:
> As you can see from the patch there is already a case to catch this type
> of problem. This BUG_ON() adds a resursive OOPS , since BUG() causes an OOPS
> and the OOPS just calls do_exit() , and do_exit() just causes another OOPS with
> this BUG_ON().. If we call panic() here then it's clear what the problem was,
> instead of causing an endless recursive crash.
>
> Signed-off-by: Daniel Walker <dwalker@mvista.com>
>
> ---
>  kernel/exit.c |    1 -
>  1 file changed, 1 deletion(-)
>
> Index: linux-2.6.23.1/kernel/exit.c
> ===================================================================
> --- linux-2.6.23.1.orig/kernel/exit.c
> +++ linux-2.6.23.1/kernel/exit.c
> @@ -895,7 +895,6 @@ fastcall NORET_TYPE void do_exit(long co
>
>  	WARN_ON(atomic_read(&tsk->fs_excl));
>
> -	BUG_ON(in_interrupt());
>  	if (unlikely(in_interrupt()))
>  		panic("Aiee, killing interrupt handler!");
>  	if (unlikely(!tsk->pid))
I did this change once before, while debugging. I had the same issue. This
BUG_ON was giving me recursive crashes that prevented me knowing WTF was
going on.  I thought I even submitted a patch to remove it. Perhaps I
forgot to. Nope, I did!
http://www.ussg.iu.edu/hypermail/linux/kernel/0707.0/1804.html
Since the change is added by the preempt-realtime-core.patch, I'll just
remove it from there.
IOW, I'll fold this into that patch.
-- Steve
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/