Date: Sat, 5 Feb 2005 03:26:05 -0800
From: Andrew Morton <>
Subject: Re: 2.6.11-rc3-mm1 : can't insmod dm-mod
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/2/5/66

Laurent Riffard <laurent.riffard@free.fr> wrote:
>
> Le 04.02.2005 19:33, Andrew Morton a Ã©crit :
>  > 
ftp://ftp.kernel.org/pub/linux/kernel/people/akpm/patches/2.6/2.6.11-rc3/2.6.11-rc3-mm1/
>  >
> 
>  loading dm-mod module fails with this message :
> 
>  FATAL: Error inserting dm-mod
>  (/lib/modules/2.6.11-rc3-mm1/kernel/drivers/md/dm-mod.ko): Device or resource busy
> 
>  The following line appears in dmesg :
> 
>  register_blkdev: failed to get major for device-mapper
You've enabled CONFIG_BASE_SMALL and so the major_names[] hashtable has
just one element.  device-mapper uses dynamic major allocation, the range
of which is limited to the size of the top-level major_names[] array.  You
ran out of slots and register_blkdev() failed.
So for now I guess we must drop base-small-shrink-major_names-hash.patch.
Al, that code looks rather crappy.  Shouldn't we be using an idr tree or
something?
Also, we can never generate a major number of zero if the caller passed in
major=0.  How come?
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/