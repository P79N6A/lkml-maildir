Date: Sun, 11 Feb 2007 20:34:26 +0000
From: Al Viro <>
Subject: Re: [PATCH v4] Fix rmmod/read/write races in /proc entries
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/11/155

> Does it pass everyone's bullshit detectors?
Nice, but incomplete.  What we need to add is
	* procfs-specific file_operations shared by all regular files
on procfs.  Stuff in there would call methods from pde->proc_fops,
after having done the same kind of exclusion you are currently doing
in proc_file_read(), et.al.
	* always set ->f_op of regular files on procfs to that sucker.
Don't reset it to NULL during removal.
	* now that exclusion is done in wrappers, no need to do it in
proc_file_read().
That'll solve the rest of issues.  Eventually we might want to divorce
->proc_fops from file_operations (and trim it down), but that's a separate
story.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/