Date: Thu, 03 May 2007 12:35:44 -0700
From: Tim Bird <>
Subject: Re: v2.6.21-rt1 - mips compile bugs
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/3/358

Ingo Molnar wrote:
> i have released the v2.6.20-rt1 kernel...
There was also a problem with the patch for arch/mips/kernel/entry.S
Some kind of cruft was in the patch.
Below is a patch which fixes both issues.  It at least allows compilation.
I haven't turned anything on, or looked at runtime yet.
Index: alp-linux/arch/mips/kernel/entry.S
===================================================================
--- alp-linux.orig/arch/mips/kernel/entry.S	2007-05-03 12:28:38.000000000 -0700
+++ alp-linux/arch/mips/kernel/entry.S	2007-05-03 12:21:47.000000000 -0700
@@ -21,8 +21,6 @@
 #endif
 #ifndef CONFIG_PREEMPT
-<<<<<<< delete 	local_irq_disable
-	raw_local_irq_disable
 #define resume_kernel	restore_all
 #else
 #define __ret_from_irq	ret_from_exception
@@ -32,7 +30,7 @@
 	.align	5
 #ifndef CONFIG_PREEMPT
 FEXPORT(ret_from_exception)
-	local_irq_disable			# preempt stop
+	raw_local_irq_disable			# preempt stop
 	b	__ret_from_irq
 #endif
 FEXPORT(ret_from_irq)
Index: alp-linux/include/asm-mips/atomic.h
===================================================================
--- alp-linux.orig/include/asm-mips/atomic.h	2007-05-03 12:28:38.000000000 -0700
+++ alp-linux/include/asm-mips/atomic.h	2007-05-03 11:56:58.000000000 -0700
@@ -566,7 +566,6 @@
 		raw_local_irq_restore(flags);
 	}
 #endif
-#endif
 	smp_mb();
=============================
Tim Bird
Architecture Group Chair, CE Linux Forum
Senior Staff Engineer, Sony Electronics
=============================
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/