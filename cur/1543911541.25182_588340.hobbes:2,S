Date: Fri, 24 Aug 2007 23:33:58 +0400
From: Alexey Dobriyan <>
Subject: [PATCH] Drop some headers from mm.h
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/8/24/326

mm.h doesn't use directly anything from mutex.h and backing-dev.h, so
remove them and add them back to files which need them.
Cross-compile tested on many configs and archs.
Signed-off-by: Alexey Dobriyan <adobriyan@gmail.com>
---
BTW, switching to SLUB makes this nice workload to go OOM, which SLAB
never allowed itself, however, I'm not prepared right now to tell the
story. It smells like semi-recent breakage, because, I can swear,
I ran it with SLUB for stress-testing purposes.
 fs/afs/write.c     |    2 +-
 include/linux/mm.h |    2 --
 mm/fremap.c        |    2 +-
 mm/mmap.c          |    1 +
 mm/truncate.c      |    1 +
 5 files changed, 4 insertions(+), 4 deletions(-)
diff --git a/fs/afs/write.c b/fs/afs/write.c
index a03b92a..4b72207 100644
--- a/fs/afs/write.c
+++ b/fs/afs/write.c
@@ -8,7 +8,7 @@
  * as published by the Free Software Foundation; either version
  * 2 of the License, or (at your option) any later version.
  */
-
+#include <linux/backing-dev.h>
 #include <linux/slab.h>
 #include <linux/fs.h>
 #include <linux/pagemap.h>
diff --git a/include/linux/mm.h b/include/linux/mm.h
index 1692dd6..57d44ae 100644
--- a/include/linux/mm.h
+++ b/include/linux/mm.h
@@ -10,9 +10,7 @@
 #include <linux/mmzone.h>
 #include <linux/rbtree.h>
 #include <linux/prio_tree.h>
-#include <linux/mutex.h>
 #include <linux/debug_locks.h>
-#include <linux/backing-dev.h>
 #include <linux/mm_types.h>
 
 struct mempolicy;
diff --git a/mm/fremap.c b/mm/fremap.c
index c395b1a..8dfae8f 100644
--- a/mm/fremap.c
+++ b/mm/fremap.c
@@ -5,7 +5,7 @@
  *
  * started by Ingo Molnar, Copyright (C) 2002, 2003
  */
-
+#include <linux/backing-dev.h>
 #include <linux/mm.h>
 #include <linux/swap.h>
 #include <linux/file.h>
diff --git a/mm/mmap.c b/mm/mmap.c
index 0d40e66..9e685b9 100644
--- a/mm/mmap.c
+++ b/mm/mmap.c
@@ -7,6 +7,7 @@
  */
 
 #include <linux/slab.h>
+#include <linux/backing-dev.h>
 #include <linux/mm.h>
 #include <linux/shm.h>
 #include <linux/mman.h>
diff --git a/mm/truncate.c b/mm/truncate.c
index 5cdfbc1..3bdf108 100644
--- a/mm/truncate.c
+++ b/mm/truncate.c
@@ -8,6 +8,7 @@
  */
 
 #include <linux/kernel.h>
+#include <linux/backing-dev.h>
 #include <linux/mm.h>
 #include <linux/swap.h>
 #include <linux/module.h>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/