Date: Mon, 26 Sep 2005 17:25:03 +1000
From: Nick Piggin <>
Subject: Re: [PATCH 17/21] mm: batch updating mm_counters
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/26/40

On Sun, 2005-09-25 at 17:08 +0100, Hugh Dickins wrote:
> tlb_finish_mmu used to batch zap_pte_range's update of mm rss, which may
> be worthwhile if the mm is contended, and would reduce atomic operations
> if the counts were atomic.  Let zap_pte_range now batch its updates to
> file_rss and anon_rss, per page-table in case we drop the lock outside;
> and copy_pte_range batch them too.
Good idea.
>  			progress++;
>  			continue;
>  		}
> -		copy_one_pte(dst_mm, src_mm, dst_pte, src_pte, vm_flags, addr);
> +		anon = copy_one_pte(dst_mm, src_mm, dst_pte, src_pte,
> +							vm_flags, addr);
> +		rss[anon]++;
How about passing rss[2] to copy_one_pte, and have that
increment the correct rss value accordingly? Not that
you may consider that any nicer than what you have here.
Nick
-- 
SUSE Labs, Novell Inc.
Send instant messages to your online friends 
http://au.messenger.yahoo.com
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/