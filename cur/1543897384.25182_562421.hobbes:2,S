Date: Tue, 26 Jun 2007 09:12:36 -0400
From: Rob Landley <>
Subject: [PATCH] Fix headers_install for x86-64 (now with less whitespace damage!)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/26/146

Signed-off-by: Rob Landley <rob@landley.net>
 A bug in headers_install for ARCH=x86_64 yields an asm/ directory full of
 files all of which are using the same #ifdef guard, "__ASM_STUB_" with no
 postfix. So the second and later asm files #included in the same C file
 (often through standard headers like ioctl.h) yields no symbols.
 --
 There's a missing semicolon after the assignment to FNAME (so the assignment
 of STUBDEF on the next line doesn't see the value), and it helps to export
 variables before calling a subshell.
 Second try, telling Kmail not to wordwrap inappropriately.  (I am up waaaay
 too early to get ready for OLS...)
--- linux-2.6/scripts/Makefile.headersinst	2007-06-15 02:45:07.000000000 -0400
+++ linux/scripts/Makefile.headersinst	2007-06-26 08:54:13.000000000 -0400
@@ -108,8 +108,8 @@
 
 quiet_cmd_gen		  = GEN     $(patsubst $(INSTALL_HDR_PATH)/%,%,$@)
       cmd_gen		  = \
-FNAME=$(patsubst $(INSTALL_HDR_PATH)/$(_dst)/%,%,$@)			\
-STUBDEF=__ASM_STUB_`echo $$FNAME | tr a-z.- A-Z__`;			\
+export FNAME=$(patsubst $(INSTALL_HDR_PATH)/$(_dst)/%,%,$@);		\
+export STUBDEF=__ASM_STUB_`echo $$FNAME | tr a-z.- A-Z__`;		\
 (echo "/* File autogenerated by 'make headers_install' */" ;		\
 echo "\#ifndef $$STUBDEF" ;						\
 echo "\#define $$STUBDEF" ;						\
-- 
"One of my most productive days was throwing away 1000 lines of code."
  - Ken Thompson.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/