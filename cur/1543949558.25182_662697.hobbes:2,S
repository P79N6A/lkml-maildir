Date: Mon, 3 Mar 2008 18:48:58 +0100
From: Ingo Molnar <>
Subject: Re: Regression in 2.6.25-rc3: s2ram segfaults before suspending
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/3/3/335

* Klaus S. Madsen <ksm@hjernemadsen.org> wrote:
> The following patch solves the segfault, by changing the mmap flags of 
> the video memory area, to allow execution. The patch is against 
> libx86-0.99 available from 
http://www.codon.org.uk/~mjg59/libx86/
> 
> --- libx86-0.99/x86-common.c	2006-09-08 00:44:27.000000000 +0200
> +++ libx86-0.99.new/x86-common.c	2008-03-01 10:08:25.000000000 +0100
> @@ -232,7 +232,7 @@
>  	}
> 
>  	m = mmap((void *)0xa0000, 0x100000 - 0xa0000,
> -	 PROT_READ | PROT_WRITE,
> +	 PROT_READ | PROT_WRITE | PROT_EXEC,
are you sure you ID-ed the right commit that broke things?
while requiring PROT_EXEC is fine, breaking existing user-space apps 
over that is not fine. So are you absolutely sure that by reverting that 
PWT|PCD commit, s2ram again starts to work? That's utmost weird...
perhaps there's some CPU bug that causes NX to _NOT_ work if only PCD is 
used (not PCD|PWT). Seems like a pretty unlikely scenario though.
	Ingo