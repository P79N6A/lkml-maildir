Date: Fri, 11 Mar 2005 15:00:08 +1100
From: Peter Chubb <>
Subject: Microstate Accounting for 2.6.11, patch 4/6
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/3/10/350

Microstate accounting:  Account for time in interrupt handlers for I386.
 arch/i386/kernel/irq.c |   13 ++++++++++++-
 1 files changed, 12 insertions(+), 1 deletion(-)
Index: linux-2.6-ustate/arch/i386/kernel/irq.c
===================================================================
--- linux-2.6-ustate.orig/arch/i386/kernel/irq.c	2005-03-10 09:13:00.115606274 +1100
+++ linux-2.6-ustate/arch/i386/kernel/irq.c	2005-03-10 09:16:16.032121680 +1100
@@ -55,6 +55,8 @@
 #endif
 
 	irq_enter();
+	msa_start_irq(irq);
+	
 #ifdef CONFIG_DEBUG_STACKOVERFLOW
 	/* Debugging check for stack overflow: is there less than 1KB free? */
 	{
@@ -101,6 +103,7 @@
 #endif
 		__do_IRQ(irq, regs);
 
+	msa_finish_irq(irq);
 	irq_exit();
 
 	return 1;
@@ -221,10 +224,18 @@
 		seq_printf(p, "%3d: ",i);
 #ifndef CONFIG_SMP
 		seq_printf(p, "%10u ", kstat_irqs(i));
+#ifdef CONFIG_MICROSTATE
+		seq_printf(p, "%10llu", msa_irq_time(0, i));
+#endif
 #else
 		for (j = 0; j < NR_CPUS; j++)
-			if (cpu_online(j))
+			if (cpu_online(j)) {
 				seq_printf(p, "%10u ", kstat_cpu(j).irqs[i]);
+#ifdef CONFIG_MICROSTATE
+				seq_printf(p, "%10llu", msa_irq_time(j, i));
+#endif
+			}
+
 #endif
 		seq_printf(p, " %14s", irq_desc[i].handler->typename);
 		seq_printf(p, "  %s", action->name);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/