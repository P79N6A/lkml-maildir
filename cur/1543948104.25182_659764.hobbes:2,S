Date: Tue, 26 Feb 2008 08:34:44 +0100
From: Ingo Molnar <>
Subject: Re: [PATCH] x86_64: remove wrong setting about CONSTANT_TSC for intel cpu
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/26/45

* Yinghai Lu <yhlu.kernel@gmail.com> wrote:
> >   #define set_cpu_cap(c, bit)     set_bit(bit, (unsigned long *)((c)->x86_capability)
> >
> >  which is the same. set_cpu_cap() is indeed the cleaner form to do this
> >  so your patch is correct as a cleanup.
> set_cpu_cap is right
> ==
> set_bit(X86_FEATURE_CONSTANT_TSC, &c->x86_capability); ===> is wrong
> should be
> set_bit(X86_FEATURE_CONSTANT_TSC, c->x86_capability);
> 
> x86_capability is a array ...
> 
> so this could prevent some data corruption.
ah, right you are! The commit was done in a sloppy, incomplete way, 
leaving around lots of direct c->x86_capability references and giving 
room for this bug ...
Btw., there's one other place that has the same bug. I'll fix that up 
too.
	Ingo