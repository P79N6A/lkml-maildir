Date: Thu, 8 Jul 2004 18:05:32 +0300 (EAT)
From: Asheesh Laroia <>
Subject: USB problems with iBook G4
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/7/8/110

I am running Linux (Debian Sid) on an iBook G4.  I was pleased to find 
that kernel 2.6.7 had support for my radeon chip, unlike earlier kernels, 
along with good support for the IDE chipset.  The iBook G4 is the newer 
1Ghz model; lspci -vv is attached.  I'm running kernel 2.6.7 stock.
The USB support has been a bit buggy.  I have two USB Mass Storage devices 
that have been having bad interactions, sometimes giving me oopses.  When 
the oopses occurred, I did dmesg | ksymoops to get more information about 
it.
The first time I plugged a Belkin Multi-Flash Memory Reader in to the USB 
port, and although I had a 128MB SD card in it, Linux reported "No medium 
found".  I tried with a CompactFlash card as well, but got the same 
result.  The setup worked just fine on a reboot to Mac OS X.  (On further 
examination, it seems the device also reports "No medium found" on Windows 
2000 with a Compact Flash card in it.  I'll follow up on this later; don't 
worry about this for now.)
Next I plugged an iHP-120 iRiver portable hard drive-based music player 
into the other USB port.  I got an oops; attached is "iriver-after-lexar", 
the dmesg|ksymoops result.
On a later boot, plugging the iRiver in caused an oops; dmesg|ksymoops 
output is attached as "iriver-crashing-messages".  I rebooted, and the 
iRiver worked fine as a USB mass storage device; the kernel's messages 
after success are attached as "iriver-success-messages".
I would be happy to try patches or tests if deemed necessary.  I am in 
Uganda while I normally live in the U.S., so I may be a bit slower than I 
would otherwise to respond.  Hopefully we can get this snag in iBook 
support behind us.  I would like to be CC:'d on reply.
I have also attached my .config as config-2.6.7take2.
-- Asheesh.
P.S. If there's someone (perhaps at Apple) I can bother to get the Airport 
Extreme to work, I'd be more than happy to do so.
-- 
Be cautious in your daily affairs.ksymoops 2.4.9 on ppc 2.6.7take2.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.6.7take2/ (default)
     -m /boot/System.map-2.6.7take2 (default)
Warning: You did not tell me where to find symbol information.  I will
assume that the log matches the kernel and modules that are running
right now and I'll use the default options above for symbol resolution.
If the current kernel and/or modules do not match the log, you can get
more accurate output by telling me the kernel version and where to find
map, modules, ksyms etc.  ksymoops -h explains the options.
Error (regular_file): read_ksyms stat /proc/ksyms failed
No modules in ksyms, skipping objects
No ksyms, skipping lsmod
Oops: kernel access of bad area, sig: 11 [#1]
NIP: D22ACE1C LR: D22AF668 SP: CF05BEF0 REGS: cf05be40 TRAP: 0300    Not tainted
Using defaults from ksymoops -t elf32-powerpc -a powerpc:common
MSR: 00009032 EE: 1 PR: 0 FP: 0 ME: 1 IR/DR: 11
TASK = cf48acf0[470] 'khubd' THREAD: cf05a000Last syscall: 120 
GPR00: 00000000 CF05BEF0 CF48ACF0 CF2F61CC D22BFD78 0034C33F C02FDD8C C02FDD2C 
GPR08: 0000001C D22C0000 CFFE1010 42C0000B 84002282 1001DC1C 00000000 00000000 
GPR16: 00000000 00000000 00000000 00000000 10001290 10036610 00000000 D22D0000 
GPR24: CFFEE3A4 00000002 CF05BF6E 00000501 CEE2CC24 CEE2CC00 CFFEE494 CF2F61C4 
Call trace:
Warning (Oops_read): Code line not seen, dumping what data is available
>>NIP; d22ace1c <__crc_blk_queue_max_sectors+3b2071/64bc09>   <=====
>>GPR1; cf05bef0 <__crc___ide_dma_bad_drive+97b992/f61d74>
>>GPR2; cf48acf0 <__crc___ide_dma_bad_drive+daa792/f61d74>
>>GPR3; cf2f61cc <__crc___ide_dma_bad_drive+c15c6e/f61d74>
>>GPR4; d22bfd78 <__crc_blk_queue_max_sectors+3c4fcd/64bc09>
>>GPR5; 0034c33f <__crc_follow_up+67130/21bf99>
>>GPR6; c02fdd8c <per_cpu__tvec_bases+98/1008>
>>GPR7; c02fdd2c <per_cpu__tvec_bases+38/1008>
>>GPR9; d22c0000 <__crc_blk_queue_max_sectors+3c5255/64bc09>
>>GPR10; cffe1010 <__crc_fb_blank+5b0dff/886102>
>>GPR11; 42c0000b <__crc_unregister_filesystem+1975bb/382a7d>
>>GPR12; 84002282 <__crc_in_aton+1f8120/43864a>
>>GPR13; 1001dc1c <__crc___skb_linearize+520241/5d4bd9>
>>GPR20; 10001290 <__crc___skb_linearize+5038b5/5d4bd9>
>>GPR21; 10036610 <__crc___skb_linearize+538c35/5d4bd9>
>>GPR23; d22d0000 <__crc_blk_queue_max_sectors+3d5255/64bc09>
>>GPR24; cffee3a4 <__crc_fb_blank+5be193/886102>
>>GPR26; cf05bf6e <__crc___ide_dma_bad_drive+97ba10/f61d74>
>>GPR28; cee2cc24 <__crc___ide_dma_bad_drive+74c6c6/f61d74>
>>GPR29; cee2cc00 <__crc___ide_dma_bad_drive+74c6a2/f61d74>
>>GPR30; cffee494 <__crc_fb_blank+5be283/886102>
>>GPR31; cf2f61c4 <__crc___ide_dma_bad_drive+c15c66/f61d74>
2 warnings and 1 error issued.  Results may not be reliable.
Initializing USB Mass Storage driver...
scsi0 : SCSI emulation for USB Mass Storage devices
  Vendor: TOSHIBA   Model: MK2004GAL         Rev: JC10
  Type:   Direct-Access                      ANSI SCSI revision: 02
USB Mass Storage device found at 2
usbcore: registered new driver usb-storage
USB Mass Storage support registered.
SCSI device sda: 39063024 512-byte hdwr sectors (20000 MB)
sda: assuming drive cache: write through
 /dev/scsi/host0/bus0/target0/lun0: p1
Attached scsi disk sda at scsi0, channel 0, id 0, lun 0
ksymoops 2.4.9 on ppc 2.6.7take2.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.6.7take2/ (default)
     -m /boot/System.map-2.6.7take2 (default)
Warning: You did not tell me where to find symbol information.  I will
assume that the log matches the kernel and modules that are running
right now and I'll use the default options above for symbol resolution.
If the current kernel and/or modules do not match the log, you can get
more accurate output by telling me the kernel version and where to find
map, modules, ksyms etc.  ksymoops -h explains the options.
Error (regular_file): read_ksyms stat /proc/ksyms failed
No modules in ksyms, skipping objects
No ksyms, skipping lsmod
Oops: kernel access of bad area, sig: 11 [#1]
NIP: D22B16CC LR: D22B2DD4 SP: CEE6BE80 REGS: cee6bdd0 TRAP: 0300    Not tainted
Using defaults from ksymoops -t elf32-powerpc -a powerpc:common
MSR: 00001032 EE: 0 PR: 0 FP: 0 ME: 1 IR/DR: 11
TASK = cf85f970[467] 'khubd' THREAD: cee6a000Last syscall: -1 
GPR00: 00000003 CEE6BE80 CF85F970 CF60F000 00000000 00000000 00000001 00000000 
GPR08: D22B1644 00000001 CF60F000 CF60F000 066CFE04 1001DC1C 00000000 00000000 
GPR16: 00000000 00000000 00000000 00000000 10001290 10036610 00000000 00000000 
GPR24: 00000000 00000000 CEE96864 00000000 00000008 CF60F000 00000000 00000000 
Call trace:
Warning (Oops_read): Code line not seen, dumping what data is available
>>NIP; d22b16cc <__crc_blk_queue_max_sectors+3b6921/64bc09>   <=====
>>GPR1; cee6be80 <__crc___ide_dma_bad_drive+78b922/f61d74>
>>GPR2; cf85f970 <__crc_fb_prepare_logo+1f3d4f/211b0f>
>>GPR3; cf60f000 <__crc___ide_dma_bad_drive+f2eaa2/f61d74>
>>GPR8; d22b1644 <__crc_blk_queue_max_sectors+3b6899/64bc09>
>>GPR10; cf60f000 <__crc___ide_dma_bad_drive+f2eaa2/f61d74>
>>GPR11; cf60f000 <__crc___ide_dma_bad_drive+f2eaa2/f61d74>
>>GPR12; 066cfe04 <__crc_devfs_register_tape+ce8e0/d8f51>
>>GPR13; 1001dc1c <__crc___skb_linearize+520241/5d4bd9>
>>GPR20; 10001290 <__crc___skb_linearize+5038b5/5d4bd9>
>>GPR21; 10036610 <__crc___skb_linearize+538c35/5d4bd9>
>>GPR26; cee96864 <__crc___ide_dma_bad_drive+7b6306/f61d74>
>>GPR29; cf60f000 <__crc___ide_dma_bad_drive+f2eaa2/f61d74>
2 warnings and 1 error issued.  Results may not be reliable.
ksymoops 2.4.9 on ppc 2.6.7take2.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.6.7take2/ (default)
     -m /boot/System.map-2.6.7take2 (default)
Warning: You did not tell me where to find symbol information.  I will
assume that the log matches the kernel and modules that are running
right now and I'll use the default options above for symbol resolution.
If the current kernel and/or modules do not match the log, you can get
more accurate output by telling me the kernel version and where to find
map, modules, ksyms etc.  ksymoops -h explains the options.
Error (regular_file): read_ksyms stat /proc/ksyms failed
No modules in ksyms, skipping objects
No ksyms, skipping lsmod
Oops: kernel access of bad area, sig: 11 [#1]
NIP: C006CE4C LR: C006E0E4 SP: CF501DF0 REGS: cf501d40 TRAP: 0300    Not tainted
Using defaults from ksymoops -t elf32-powerpc -a powerpc:common
MSR: 00009032 EE: 1 PR: 0 FP: 0 ME: 1 IR/DR: 11
TASK = cf83f320[915] 'khubd' THREAD: cf500000Last syscall: -1 
GPR00: C006E0E4 CF501DF0 CF83F320 00000000 00000001 00000000 CFF80000 C7F38CE4 
GPR08: C023E270 00000007 00000000 00000001 44002222 1001DC1C 00000000 00000000 
GPR16: 00000000 00000000 00000000 00000000 10001290 100366A0 00000000 D22D0000 
GPR24: CFFD9EE4 00000001 CF501F6E 00000000 00000000 CF501E40 CF1822F0 CF1822F0 
Call trace:
Warning (Oops_read): Code line not seen, dumping what data is available
>>NIP; c006ce4c <permission+18/60>   <=====
>>GPR0; c006e0e4 <__lookup_hash+2c/fc>
>>GPR1; cf501df0 <__crc___ide_dma_bad_drive+e21892/f61d74>
>>GPR2; cf83f320 <__crc_fb_prepare_logo+1d36ff/211b0f>
>>GPR6; cff80000 <__crc_fb_blank+54fdef/886102>
>>GPR7; c7f38ce4 <__crc_strspn+720bd/1a0cb7>
>>GPR8; c023e270 <dentry_unused+0/8>
>>GPR12; 44002222 <__crc_sock_alloc_send_pskb+11dbca/23713a>
>>GPR13; 1001dc1c <__crc___skb_linearize+520241/5d4bd9>
>>GPR20; 10001290 <__crc___skb_linearize+5038b5/5d4bd9>
>>GPR21; 100366a0 <__crc___skb_linearize+538cc5/5d4bd9>
>>GPR23; d22d0000 <__crc_blk_queue_max_sectors+3d5255/64bc09>
>>GPR24; cffd9ee4 <__crc_fb_blank+5a9cd3/886102>
>>GPR26; cf501f6e <__crc___ide_dma_bad_drive+e21a10/f61d74>
>>GPR29; cf501e40 <__crc___ide_dma_bad_drive+e218e2/f61d74>
>>GPR30; cf1822f0 <__crc___ide_dma_bad_drive+aa1d92/f61d74>
>>GPR31; cf1822f0 <__crc___ide_dma_bad_drive+aa1d92/f61d74>
2 warnings and 1 error issued.  Results may not be reliable.