Date: Wed, 14 Jan 2004 20:11:44 +0100
From: Thomas Schlichter <>
Subject: Re: 2.6.1-mm3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/1/14/162

Hi,
the patch "sched-sibling-map-to-cpumask.patch" inroduced following compile 
error on UP machines:
  CC [M]  arch/i386/kernel/cpu/cpufreq/p4-clockmod.o
arch/i386/kernel/cpu/cpufreq/p4-clockmod.c: In function `cpufreq_p4_setdc':
arch/i386/kernel/cpu/cpufreq/p4-clockmod.c:71: error: `cpu_sibling_map' 
undeclared (first use in this function)
arch/i386/kernel/cpu/cpufreq/p4-clockmod.c:71: error: (Each undeclared 
identifier is reported only once
arch/i386/kernel/cpu/cpufreq/p4-clockmod.c:71: error: for each function it 
appears in.)
The attached patch fixes it...
  Thomas Schlichter
--- linux-2.6.1-mm3/arch/i386/kernel/cpu/cpufreq/p4-clockmod.c.orig	2004-01-14 18:15:05.891246656 +0100
+++ linux-2.6.1-mm3/arch/i386/kernel/cpu/cpufreq/p4-clockmod.c	2004-01-14 18:27:35.876231608 +0100
@@ -68,7 +68,11 @@
 	cpus_allowed = current->cpus_allowed;
 
 	/* only run on CPU to be set, or on its sibling */
+#ifdef CONFIG_SMP
 	affected_cpu_map = cpu_sibling_map[cpu];
+#else
+	affected_cpu_map = cpumask_of_cpu(cpu);
+#endif
 	set_cpus_allowed(current, affected_cpu_map);
         BUG_ON(!cpu_isset(smp_processor_id(), affected_cpu_map));
 [unhandled content-type:application/pgp-signature]