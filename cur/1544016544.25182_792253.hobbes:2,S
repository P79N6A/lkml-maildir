Date: Wed, 14 Jan 2009 16:42:49 -0500 (EST)
From: Steven Rostedt <>
Subject: Re: [PATCH] tracing/function-graph-tracer: fix a regression while suspend to disk
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/14/494

On Wed, 14 Jan 2009, Frederic Weisbecker wrote:
> Impact: fix a crash while kernel image restore
> 
> When the function graph tracer is running and while suspend to disk, some racy
> and dangerous things happen against this tracer.
> 
> The current task will save its registers including the stack pointer which
> contains the return address hooked by the tracer. But the current task will
> continue to enter other functions after that to save the memory, and then
> it will store other return addresses, and finally loose the old depth which
> matches the return address saved in the old stack (during the registers saving).
> 
> So on image restore, the code will return to wrong addresses.
> And there are other things: on restore, the task will have it's "current"
> pointer overwritten during registers restoring....switching from one task to
> another... That would be insane to try to trace function graphs at these
> stages.
> 
> This patch makes the function graph tracer listening on power events, making
> it's tracing disabled for the current task (the one that performs the hibernation work)
> while suspend/resume to disk, making the tracing safe during hibernation.
> 
> Signed-off-by: Frederic Weisbecker <fweisbec@gmail.com>
Thanks, Frederic, I'll apply it and pass it on.
-- Steve