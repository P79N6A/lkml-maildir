Date: Mon, 28 Jan 2008 22:21:52 -0500
From: Mark Lord <>
Subject: Re: Problem with ata layer in 2.6.24
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/28/608

Gene Heskett wrote:
> On Monday 28 January 2008, Gene Heskett wrote:
>> On Monday 28 January 2008, Robert Hancock wrote:
>> [...]
>>
>>> Check the /etc/modprobe.conf file, a lot of distributions use this to
>>> generate the initrd. If there's references to pata_amd it'll try and
>>> include it.
>> Bingo!  Thanks Robert, I'll try it again with that line commented.  I wasn't
>> aware of that connection at all.  Yup, it worked, I feel a reboot coming
>> on. :)
> 
> But it didn't work, apparently commenting that line out needs to be balanced 
> by adding another line telling it amd74xx is the 'hostadapter', not 
> necessarily scsi.
> 
> Can this be made more universal so I don't have to edit /etc/modprobe.conf?
>..
You could really do it like Linus (and me), and not bother with modules
for critical services like hard disks.
Just build them *into* the core kernel (select "y" or "checkmark" rather
than "m" or "dot" for modules).  This eliminates a ton of crap that can fail,
and may also make your kernel a micro-MIP faster (core memory is often mapped
without page table entries, whereas loaded modules use page tables.. slower, slightly).
Linus just edits the /boot/grub/menu.lst, and clones an existing boot entry
for the new kernel, editing the "kernel" line to match the name of the file
that got installed in /boot by "make install" (from the kernel directory).
He just leaves the ramdisk/initrd line as-was --> wrong version, but that's okay.
I totally get rid of them here, but that requires hardcoding the root=/dev/xxxx
part on the "kernel" line.  No big deal, it works just fine that way.
Cheers