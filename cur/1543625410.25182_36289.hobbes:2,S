Date: Wed, 20 Mar 2002 11:14:56 -0500
From: Mark Gross <>
Subject: Re: [PATCH] multithreaded coredumps for elf exeecutables
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/3/20/172

I've only JUST started on the Itanium version of this patch.  In my initial 
testing, after hacking around some of the compilation issues,  I do get a 
type of process freezing when attempting this.  Could be this bug.  
Thanks for the tip ;)
--mgross
On Wednesday 20 March 2002 01:37 pm, Daniel Jacobowitz wrote:
> On Wed, Mar 20, 2002 at 11:36:30AM +0530, Vamsi Krishna S . wrote:
> > There is serialization at higher level. We take a write lock
> > on current->mm->mmap_sem at the beginning of elf_core_dump
> > function which is released just before leaving the function.
> > So, if one thread enters elf_core_dump and starts dumping core,
> > no other thread (same mm) of the same process can start
> > dumping.
> > 
> > static int elf_core_dump(long signr, struct pt_regs * regs, struct file *
> > file) {
> >       ...
> >       ...
> >         /* now stop all vm operations */
> >         down_write(&current->mm->mmap_sem);
> >       ...
> >       ...
> >       ...
> >         up_write(&current->mm->mmap_sem);
> >         return has_dumped;
> > }
>
> That's not a feature, it's a bug.  You can't take the mmap_sem before
> collecting thread status; it will cause a deadlock on at least ia64,
> where some registers are collected from user memory.
>
> (Thanks to Manfred Spraul for explaining that to me.)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/