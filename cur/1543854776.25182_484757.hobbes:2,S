Date: Tue, 21 Nov 2006 18:36:39 -0800 (PST)
From: Linus Torvalds <>
Subject: Re: Simple script that locks up my box with recent kernels
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/11/21/325

On Wed, 22 Nov 2006, Jesper Juhl wrote:
> 
> So it *seems* to be somehow related to running low on RAM and swap
> starting to be used.
Does it happen if you just do some simple "use all memory" script, eg run 
a few copies of
	#define SIZE (100<<20)
	char *buf = malloc(SIZE);
	memset(buf, SIZE, 0);
	sleep(100);
on your box?
> The box has 2GB of RAM and 768MB swap.
I wonder.. It _used_ to be true that we were pretty good at making swap be 
"extra" memory. But maybe we've lost some of that, and we have trouble 
with having more physical memory. We could end up in a situation where we 
allocate it all very quickly (because we don't actually page it out, we 
just allocate backing store for the pages), and we screw something up.
But stupid bugs there should still leave us trivially able to do the SysRQ 
things, so.. 
Is it highmem-related? Some bounce-buffering problem while having to swap? 
What block device driver do you use for the swap device?
I don't think we use any irq-disable locking in the VM itself, but I could 
imagine some nasty situation with the block device layer getting into a 
deadlock with interrupts disabled when it runs out of queue entries and 
cannot allocate more memory..
		Linus
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/