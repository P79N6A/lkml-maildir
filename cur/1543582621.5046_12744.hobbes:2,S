Date: Wed, 21 Feb 2001 16:28:59 +0100 (CET)
From: Francis Galiegue <>
Subject: Re: [PATCHES] 3 of them, resubmit, over 2.4.1-ac20
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/2/21/48

On Wed, 21 Feb 2001, Alan Cox wrote:
> 
> Care to include the actual patches tho..
> 
Argh! Brain damage... Sorry...
-- 
Francis Galiegue, fg@mandrakesoft.com - Normand et fier de l'Ãªtre
"Programming is a race between programmers, who try and make more and more
idiot-proof software, and universe, which produces more and more remarkable
idiots. Until now, universe leads the race"  -- R. Cook
--- linux/arch/i386/kernel/irq.c.old	Wed Feb 21 15:50:50 2001
+++ linux/arch/i386/kernel/irq.c	Wed Feb 21 15:51:23 2001
@@ -1080,7 +1080,6 @@
 
 	err = parse_hex_value(buffer, count, &new_value);
 
-#if CONFIG_SMP
 	/*
 	 * Do not allow disabling IRQs completely - it's a too easy
 	 * way to make the system unusable accidentally :-) At least
@@ -1088,7 +1087,6 @@
 	 */
 	if (!(new_value & cpu_online_map))
 		return -EINVAL;
-#endif
 
 	irq_affinity[irq] = new_value;
 	irq_desc[irq].handler->set_affinity(irq, new_value);--- linux/drivers/ide/ide-floppy.c.old	Wed Feb 21 15:53:20 2001
+++ linux/drivers/ide/ide-floppy.c	Wed Feb 21 15:55:23 2001
@@ -1517,15 +1517,21 @@
 				 unsigned int cmd, unsigned long arg)
 {
 	idefloppy_pc_t pc;
+	int prevent = (arg) ? 1 : 0;
 
 	switch (cmd) {
 	case CDROMEJECT:
+		prevent = 0;
+		/* fall through */
+	case CDROM_LOCKDOOR:
 		if (drive->usage > 1)
 			return -EBUSY;
-		idefloppy_create_prevent_cmd (&pc, 0);
-		(void) idefloppy_queue_pc_tail (drive, &pc);
-		idefloppy_create_start_stop_cmd (&pc, 2);
+		idefloppy_create_prevent_cmd (&pc, prevent);
 		(void) idefloppy_queue_pc_tail (drive, &pc);
+		if (cmd == CDROMEJECT) {
+			idefloppy_create_start_stop_cmd (&pc, 2);
+			(void) idefloppy_queue_pc_tail (drive, &pc);
+		}
 		return 0;
 	case IDEFLOPPY_IOCTL_FORMAT_SUPPORTED:
 		return (0);--- linux/mm/vmalloc.c.old	Wed Feb 21 15:56:20 2001
+++ linux/mm/vmalloc.c	Wed Feb 21 15:58:05 2001
@@ -151,7 +151,6 @@
 		if (!pmd)
 			break;
 
-		ret = -ENOMEM;
 		if (alloc_area_pmd(pmd, address, end - address, gfp_mask, prot))
 			break;
 