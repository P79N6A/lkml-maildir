Date: Thu, 6 Jan 2005 01:14:24 +0100 (CET)
From: Martin Drab <>
Subject: Re: APIC/LAPIC hanging problems on nForce2 system.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/1/5/286

On Wed, 5 Jan 2005, Prakash K. Cheemplavam wrote:
> lspci -xxx
> 
> then check
> 
> 0000:00:00.0 Host bridge: nVidia Corporation nForce2 AGP (different
> version?) (rev c1)
> 00: de 10 e0 01 06 00 b0 00 c1 00 00 06 00 00 80 00
> 10: 08 00 00 a0 00 00 00 00 00 00 00 00 00 00 00 00
> 20: 00 00 00 00 00 00 00 00 00 00 00 00 7b 14 00 1c
> 30: 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00
> 40: 02 60 30 00 1b 42 00 1f 02 03 00 00 ff ff ff ff
> 50: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> 60: 08 00 01 20 20 00 88 80 10 00 00 00 01 ff 01 9f <----
> 70: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff
> 80: 00 01 00 00 ff ff ff 3f 01 00 00 00 01 80 00 00
> 90: 14 80 40 a7 14 80 40 a5 00 30 00 00 00 00 00 00
> a0: 40 00 00 00 32 fb 10 00 01 00 00 00 00 00 00 00
> b0: cc ff 07 00 00 00 00 00 00 00 00 00 00 00 00 00
> c0: 33 33 03 00 00 00 00 00 00 00 00 00 00 00 00 00
> d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
> e0: d6 01 47 00 16 30 00 10 00 00 00 00 00 00 00 00
> f0: 0f 00 00 08 00 00 00 00 00 00 00 00 00 00 00 00
> 
> 
> From fixup.c:
>          * Chip  Old value   New value
>          * C17   0x1F0FFF01  0x1F01FF01
>          * C18D  0x9F0FFF01  0x9F01FF01
> 
> If there is old value, it needs to be fixed.
OK, so I investigated a bit, and found the following interesting 
and seemingly unexpected situation. I wrote a trivial debugging patch 
(attached as "nForce2-Fixup-DEBUG.diff") to take a closer look at what is 
going on in there. Result is attached as "kernel.log". Namely interesting 
part:
...
DEBUG: pci_fixup_nforce2() called.
DEBUG:   nForce2 revision byte = 0xC1.
DEBUG:   fixed value = 0x9F01FF01.
DEBUG:   current value = 0x8F0FFF01.  <---------------
...
So that means, that the device doesn't have the "C1 Halt Disconnect" 
enabled at that point, and, though, no fixup is done. However, if you take 
a closer look at the result of "lspci -xxx" (attached as "lspci-xxx.log"),
00:00.0 Host bridge: nVidia Corporation nForce2 AGP (different version?) (rev c1)
...
60: 08 00 01 20 20 00 88 80 10 00 00 00 01 ff 0f 9f <-------
...
you'll notice, that all of a sudden that bit 28 of PCI.0x6c *is set!! That 
means, that sometimes later, after the pci_fixup_nforce2() is called, 
something, smewhere, somehow has to set the bit to 1. But this part in the 
arch/i386/pci/fixup.c prevents it.
        /*
         * Apply fixup only if C1 Halt Disconnect is enabled
         * (bit28) because it is not supported on some boards.
         */
	    vvvvvvvvvvvvvvvvv
        if ((val & (1 << 28)) && val != fixed_val) {
                printk(KERN_WARNING "PCI: nForce2 C1 Halt Disconnect fixup\n");
                pci_write_config_dword(dev, 0x6c, fixed_val);
        }
So my question is: Is the condition necessary? If there really are boards, 
that don't support this, then is would probably have to be a more 
sophisticated test, or the fixup would have to be called again later, when 
the flag is set. BTW.: Any clue on what could possibly set the flag?
Anyway, I wrote a trivial patch (attached as "nForce2-Fixup-Fix.diff") 
which simply just removes the condition mentioned above. With this patch 
the fixup IS done on my MB and then everything works OK. So the problem 
really *is here. But I'm afraid that this trivial solution is rather an 
ugly workaround, then a real fix to this problem.
Upgrade of my BIOS could probably solve the problem, but since I thought 
it may be necessary to really fix the problem, so that others don't need 
to care to upgrade the BIOS as well. So I didn't upgrade, yet, in order to 
be able to test any better solution that there might be (if there is any).
Martin
diff -Naur old/arch/i386/pci/fixup.c new/arch/i386/pci/fixup.c
--- old/arch/i386/pci/fixup.c	2004-12-28 04:25:36.000000000 +0100
+++ new/arch/i386/pci/fixup.c	2005-01-05 22:51:31.000000000 +0100
@@ -230,8 +230,12 @@
 	u32 val, fixed_val;
 	u8 rev;
 
+	printk (KERN_WARNING "DEBUG: pci_fixup_nforce2() called.\n");
+
 	pci_read_config_byte(dev, PCI_REVISION_ID, &rev);
 
+	printk (KERN_WARNING "DEBUG:   nForce2 revision byte = 0x%02X.\n", rev);
+
 	/*
 	 * Chip  Old value   New value
 	 * C17   0x1F0FFF01  0x1F01FF01
@@ -242,8 +246,12 @@
 	 */
 	fixed_val = rev < 0xC1 ? 0x1F01FF01 : 0x9F01FF01;
 
+	printk (KERN_WARNING "DEBUG:   fixed value = 0x%04X.\n", fixed_val);
+
 	pci_read_config_dword(dev, 0x6c, &val);
 
+	printk (KERN_WARNING "DEBUG:   current value = 0x%02X.\n", val);
+
 	/*
 	 * Apply fixup only if C1 Halt Disconnect is enabled
 	 * (bit28) because it is not supported on some boards.klogd 1.4.1, log source = /proc/kmsg started.
Inspecting /boot/System.map-2.6.10-bk7
Loaded 25178 symbols from /boot/System.map-2.6.10-bk7.
Symbols match kernel version 2.6.10.
No module symbols loaded - kernel modules not enabled. 
Linux version 2.6.10-bk7 (root@interceptor) (gcc version 4.0.0 20050104 (experimental)) #2 Wed Jan 5 22:52:09 CET 2005
BIOS-provided physical RAM map:
 BIOS-e820: 0000000000000000 - 000000000009fc00 (usable)
 BIOS-e820: 000000000009fc00 - 00000000000a0000 (reserved)
 BIOS-e820: 00000000000f0000 - 0000000000100000 (reserved)
 BIOS-e820: 0000000000100000 - 000000003fff0000 (usable)
 BIOS-e820: 000000003fff0000 - 000000003fff3000 (ACPI NVS)
 BIOS-e820: 000000003fff3000 - 0000000040000000 (ACPI data)
 BIOS-e820: 00000000fec00000 - 00000000fec01000 (reserved)
 BIOS-e820: 00000000fee00000 - 00000000fee01000 (reserved)
 BIOS-e820: 00000000ffff0000 - 0000000100000000 (reserved)
Warning only 896MB will be used.
Use a HIGHMEM enabled kernel.
896MB LOWMEM available.
found SMP MP-table at 000f5360
DMI 2.3 present.
__iounmap: bad address c00f0000
ACPI: LAPIC (acpi_id[0x00] lapic_id[0x00] enabled)
Processor #0 6:10 APIC version 16
ACPI: LAPIC_NMI (acpi_id[0x00] dfl dfl lint[0x1])
ACPI: IOAPIC (id[0x02] address[0xfec00000] gsi_base[0])
IOAPIC[0]: apic_id 2, version 17, address 0xfec00000, GSI 0-23
ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)
ACPI: BIOS IRQ0 pin2 override ignored.
ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 high level)
Enabling APIC mode:  Flat.  Using 1 I/O APICs
Using ACPI (MADT) for SMP configuration information
Built 1 zonelists
Kernel command line: root=/dev/hda2 resume=/dev/hda3 splash=silent vga=794
Initializing CPU#0
CPU 0 irqstacks, hard=c0406000 soft=c0405000
PID hash table entries: 4096 (order: 12, 65536 bytes)
Detected 2191.136 MHz processor.
Using tsc for high-res timesource
Console: colour dummy device 80x25
Dentry cache hash table entries: 131072 (order: 7, 524288 bytes)
Inode-cache hash table entries: 65536 (order: 6, 262144 bytes)
Memory: 905208k/917504k available (1877k kernel code, 11696k reserved, 980k data, 208k init, 0k highmem)
Checking if this processor honours the WP bit even in supervisor mode... Ok.
Mount-cache hash table entries: 512 (order: 0, 4096 bytes)
CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)
CPU: L2 Cache: 512K (64 bytes/line)
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
CPU: AMD Athlon(tm) XP 3200+ stepping 00
Enabling fast FPU save and restore... done.
Enabling unmasked SIMD FPU exception support... done.
Checking 'hlt' instruction... OK.
 tbxface-0118 [02] acpi_load_tables      : ACPI Tables successfully acquired
Parsing all Control Methods:......................................................................................................................................................................................................................................................................
Table [DSDT](id F004) - 693 Objects with 76 Devices 262 Methods 23 Regions
ACPI Namespace successfully loaded at root c0441fc0
evxfevnt-0094 [03] acpi_enable           : Transition to ACPI mode successful
ENABLING IO-APIC IRQs
..TIMER: vector=0x31 pin1=0 pin2=-1
checking if image is initramfs...it isn't (no cpio magic); looks like an initrd
Freeing initrd memory: 208k freed
NET: Registered protocol family 16
PCI: PCI BIOS revision 2.10 entry at 0xfaee0, last bus=3
PCI: Using configuration type 1
mtrr: v2.0 (20020519)
ACPI: Subsystem revision 20041210
evgpeblk-0979 [06] ev_create_gpe_block   : GPE 00 to 1F [_GPE] 4 regs on int 0x9
evgpeblk-0987 [06] ev_create_gpe_block   : Found 9 Wake, Enabled 0 Runtime GPEs in this block
evgpeblk-0979 [06] ev_create_gpe_block   : GPE 20 to 5F [_GPE] 8 regs on int 0x9
evgpeblk-0987 [06] ev_create_gpe_block   : Found 0 Wake, Enabled 0 Runtime GPEs in this block
Completing Region/Field/Buffer/Package initialization:....................................................................
Initialized 23/23 Regions 1/1 Fields 29/29 Buffers 15/23 Packages (702 nodes)
Executing all Device _STA and_INI methods:.......exoparg2-0436 [14] ex_opcode_2A_1T_1R    : Index value (14) beyond end of buffer (14)
 psparse-1138: *** Error: Method execution failed [\STRC] (Node dffb1488), AE_AML_BUFFER_LIMIT
 psparse-1138: *** Error: Method execution failed [\_SB_.PCI0._INI] (Node dffa2508), AE_AML_BUFFER_LIMIT
  nsinit-0414 [06] ns_init_one_device    : \_SB_.PCI0._INI._INI failed: AE_AML_BUFFER_LIMIT
........................................................................
79 Devices found containing: 79 _STA, 0 _INI methods
ACPI: Interpreter enabled
ACPI: Using IOAPIC for interrupt routing
ACPI: PCI Root Bridge [PCI0] (00:00)
PCI: Probing PCI hardware (bus 00)
DEBUG: pci_fixup_nforce2() called.
DEBUG:   nForce2 revision byte = 0xC1.
DEBUG:   fixed value = 0x9F01FF01.
DEBUG:   current value = 0x8F0FFF01.
ACPI: PCI Interrupt Link [LNK1] (IRQs 3 4 *5 6 7 9 10 11 12 14 15)
ACPI: PCI Interrupt Link [LNK2] (IRQs 3 4 5 6 7 9 10 *11 12 14 15)
ACPI: PCI Interrupt Link [LNK3] (IRQs 3 4 5 6 7 9 10 *11 12 14 15)
ACPI: PCI Interrupt Link [LNK4] (IRQs 3 4 5 6 7 *9 10 11 12 14 15)
ACPI: PCI Interrupt Link [LNK5] (IRQs 3 4 5 6 7 9 10 11 12 14 15) *0, disabled.
ACPI: PCI Interrupt Link [LUBA] (IRQs 3 4 *5 6 7 9 10 11 12 14 15)
ACPI: PCI Interrupt Link [LUBB] (IRQs 3 4 5 6 7 9 *10 11 12 14 15)
ACPI: PCI Interrupt Link [LMAC] (IRQs 3 4 5 6 7 9 *10 11 12 14 15)
ACPI: PCI Interrupt Link [LAPU] (IRQs 3 4 *5 6 7 9 10 11 12 14 15)
ACPI: PCI Interrupt Link [LACI] (IRQs 3 4 5 6 7 9 *10 11 12 14 15)
ACPI: PCI Interrupt Link [LMCI] (IRQs 3 4 5 6 7 9 10 11 12 14 15) *0, disabled.
ACPI: PCI Interrupt Link [LSMB] (IRQs 3 4 5 6 7 *9 10 11 12 14 15)
ACPI: PCI Interrupt Link [LUB2] (IRQs 3 4 5 6 7 9 10 *11 12 14 15)
ACPI: PCI Interrupt Link [LFIR] (IRQs 3 4 5 6 7 *9 10 11 12 14 15)
ACPI: PCI Interrupt Link [L3CM] (IRQs 3 4 5 6 7 9 10 11 12 14 15) *0, disabled.
ACPI: PCI Interrupt Link [LIDE] (IRQs 3 4 5 6 7 9 10 11 12 14 15) *0, disabled.
ACPI: PCI Interrupt Link [APC1] (IRQs *16), disabled.
ACPI: PCI Interrupt Link [APC2] (IRQs *17), disabled.
ACPI: PCI Interrupt Link [APC3] (IRQs *18), disabled.
ACPI: PCI Interrupt Link [APC4] (IRQs *19), disabled.
ACPI: PCI Interrupt Link [APC5] (IRQs *16), disabled.
ACPI: PCI Interrupt Link [APCF] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCG] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCH] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCI] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCJ] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCK] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCS] (IRQs *23), disabled.
ACPI: PCI Interrupt Link [APCL] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCM] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [AP3C] (IRQs 20 21 22) *0, disabled.
ACPI: PCI Interrupt Link [APCZ] (IRQs 20 21 22) *0, disabled.
Linux Plug and Play Support v0.97 (c) Adam Belay
pnp: PnP ACPI init
pnp: PnP ACPI: found 13 devices
PnPBIOS: Disabled by ACPI
PCI: Using ACPI for IRQ routing
** PCI interrupts are no longer routed automatically.  If this
** causes a device to stop working, it is probably because the
** driver failed to call pci_enable_device().  As a temporary
** workaround, the "pci=routeirq" argument restores the old
** behavior.  If this argument makes the device work again,
** please email the output of "lspci" to bjorn.helgaas@hp.com
** so I can fix the driver.
pnp: 00:00: ioport range 0x1000-0x107f could not be reserved
pnp: 00:00: ioport range 0x1080-0x10ff has been reserved
pnp: 00:00: ioport range 0x1400-0x147f has been reserved
pnp: 00:00: ioport range 0x1480-0x14ff could not be reserved
pnp: 00:00: ioport range 0x1800-0x187f has been reserved
pnp: 00:00: ioport range 0x1880-0x18ff has been reserved
pnp: 00:01: ioport range 0x1c00-0x1c3f has been reserved
pnp: 00:01: ioport range 0x2000-0x203f has been reserved
apm: BIOS version 1.2 Flags 0x07 (Driver version 1.16ac)
apm: overridden by ACPI.
VFS: Disk quotas dquot_6.5.1
Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)
devfs: 2004-01-31 Richard Gooch (rgooch@atnf.csiro.au)
devfs: boot_options: 0x0
Initializing Cryptographic API
vesafb: framebuffer at 0xc0000000, mapped to 0xf8880000, using 5120k, total 131072k
vesafb: mode is 1280x1024x16, linelength=2560, pages=1
vesafb: protected mode interface info at c000:e910
vesafb: scrolling: redraw
vesafb: Truecolor: size=0:5:6:5, shift=0:11:5:0
Console: switching to colour frame buffer device 160x64
fb0: VESA VGA frame buffer device
isapnp: Scanning for PnP cards...
isapnp: No Plug & Play device found
serio: i8042 AUX port at 0x60,0x64 irq 12
serio: i8042 KBD port at 0x60,0x64 irq 1
Serial: 8250/16550 driver $Revision: 1.90 $ 48 ports, IRQ sharing enabled
ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
ttyS1 at I/O 0x2f8 (irq = 3) is a 16550A
ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
ttyS1 at I/O 0x2f8 (irq = 3) is a 16550A
ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
ttyS1 at I/O 0x2f8 (irq = 3) is a 16550A
io scheduler noop registered
io scheduler anticipatory registered
io scheduler deadline registered
io scheduler cfq registered
RAMDISK driver initialized: 1 RAM disks of 4096K size 1024 blocksize
Uniform Multi-Platform E-IDE driver Revision: 7.00alpha2
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
NFORCE2: IDE controller at PCI slot 0000:00:09.0
NFORCE2: chipset revision 162
NFORCE2: not 100%% native mode: will probe irqs later
NFORCE2: BIOS didn't set cable bits correctly. Enabling workaround.
NFORCE2: BIOS didn't set cable bits correctly. Enabling workaround.
NFORCE2: 0000:00:09.0 (rev a2) UDMA133 controller
    ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:DMA, hdb:DMA
    ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:DMA, hdd:DMA
hda: IBM-DTLA-307045, ATA DISK drive
elevator: using anticipatory as default io scheduler
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
hdc: Pioneer DVD-ROM ATAPIModel DVD-106S 010, ATAPI CD/DVD-ROM drive
hdd: LITE-ON DVDRW LDW-411S, ATAPI CD/DVD-ROM drive
ide1 at 0x170-0x177,0x376 on irq 15
hda: max request size: 128KiB
hda: Host Protected Area detected.
^Icurrent capacity is 90067727 sectors (46114 MB)
^Inative  capacity is 90069840 sectors (46115 MB)
hda: Host Protected Area disabled.
hda: 90069840 sectors (46115 MB) w/1916KiB Cache, CHS=65535/16/63, UDMA(100)
 /dev/ide/host0/bus0/target0/lun0: p1 p2 p3 p4
mice: PS/2 mouse device common for all mice
input: AT Translated Set 2 keyboard on isa0060/serio0
md: md driver 0.90.1 MAX_MD_DEVS=256, MD_SB_DISKS=27
NET: Registered protocol family 2
IP: routing cache hash table of 8192 buckets, 64Kbytes
TCP established hash table entries: 131072 (order: 8, 1048576 bytes)
TCP bind hash table entries: 65536 (order: 6, 262144 bytes)
TCP: Hash tables configured (established 131072 bind 65536)
NET: Registered protocol family 1
ACPI wakeup devices: 
HUB0 HUB1 USB0 USB1 USB2 F139 MMAC MMCI UAR1 
ACPI: (supports S0 S1 S4 S5)
md: Autodetecting RAID arrays.
md: autorun ...
md: ... autorun DONE.
RAMDISK: Compressed image found at block 0
VFS: Mounted root (ext2 filesystem).
EXT3-fs: mounted filesystem with ordered data mode.
kjournald starting.  Commit interval 5 seconds
Freeing unused kernel memory: 208k freed
ACPI: Power Button (FF) [PWRF]
SCSI subsystem initialized
ACPI: PCI Interrupt Link [APC2] enabled at IRQ 17
ACPI: PCI interrupt 0000:01:0c.0[A] -> GSI 17 (level, high) -> IRQ 177
Found Controller: IT8212 UDMA/ATA133 RAID Controller
FindDevices: device 0 is IDE
Channel[0] BM-DMA at 0xA000-0xA007
FindDevices: device 2 is IDE
IssueIdentify: resetting channel.
IssueIdentify(IDE): disk[1] not ready. status=0x1
FindDevices: device 3 is not present
Channel[1] BM-DMA at 0xA008-0xA00F
scsi0 : ITE RAIDExpress133
  Vendor: ITE       Model: IT8212F           Rev: 1.3 
  Type:   Direct-Access                      ANSI SCSI revision: 00
  Vendor: ITE       Model: IT8212F           Rev: 1.3 
  Type:   Direct-Access                      ANSI SCSI revision: 00
SCSI device sda: 240121728 512-byte hdwr sectors (122942 MB)
sda: asking for cache data failed
sda: assuming drive cache: write through
SCSI device sda: 240121728 512-byte hdwr sectors (122942 MB)
sda: asking for cache data failed
sda: assuming drive cache: write through
 /dev/scsi/host0/bus0/target0/lun0: p1 p2
Attached scsi disk sda at scsi0, channel 0, id 0, lun 0
SCSI device sdb: 234441648 512-byte hdwr sectors (120034 MB)
sdb: asking for cache data failed
sdb: assuming drive cache: write through
SCSI device sdb: 234441648 512-byte hdwr sectors (120034 MB)
sdb: asking for cache data failed
sdb: assuming drive cache: write through
 /dev/scsi/host0/bus0/target2/lun0: p1
Attached scsi disk sdb at scsi0, channel 0, id 2, lun 0
usbcore: registered new driver usbfs
usbcore: registered new driver hub
ACPI: PCI Interrupt Link [APCF] enabled at IRQ 22
ACPI: PCI interrupt 0000:00:02.0[A] -> GSI 22 (level, high) -> IRQ 185
ohci_hcd 0000:00:02.0: nVidia Corporation nForce2 USB Controller
ohci_hcd 0000:00:02.0: irq 185, pci mem 0xdb086000
ohci_hcd 0000:00:02.0: new USB bus registered, assigned bus number 1
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 3 ports detected
ACPI: PCI Interrupt Link [APCG] enabled at IRQ 21
ACPI: PCI interrupt 0000:00:02.1[B] -> GSI 21 (level, high) -> IRQ 193
ohci_hcd 0000:00:02.1: nVidia Corporation nForce2 USB Controller (#2)
ohci_hcd 0000:00:02.1: irq 193, pci mem 0xdb081000
ohci_hcd 0000:00:02.1: new USB bus registered, assigned bus number 2
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 3 ports detected
ACPI: PCI Interrupt Link [APCL] enabled at IRQ 20
ACPI: PCI interrupt 0000:00:02.2[C] -> GSI 20 (level, high) -> IRQ 201
ehci_hcd 0000:00:02.2: nVidia Corporation nForce2 USB Controller
ehci_hcd 0000:00:02.2: irq 201, pci mem 0xdb082000
ehci_hcd 0000:00:02.2: new USB bus registered, assigned bus number 3
ehci_hcd 0000:00:02.2: USB 2.0 initialized, EHCI 1.00, driver 26 Oct 2004
hub 3-0:1.0: USB hub found
hub 3-0:1.0: 6 ports detected
ohci_hcd 0000:00:02.1: wakeup
EXT3 FS on hda2, internal journal
device-mapper: 4.3.0-ioctl (2004-09-30) initialised: dm-devel@redhat.com
usb 2-1: new full speed USB device using ohci_hcd and address 3
hub 2-1:1.0: USB hub found
hub 2-1:1.0: 4 ports detected
Adding 2008116k swap on /dev/hda3.  Priority:-1 extents:1
Adding 1140604k swap on /dev/hda4.  Priority:-2 extents:1
nvidia: module license 'NVIDIA' taints kernel.
ACPI: PCI Interrupt Link [APC4] enabled at IRQ 19
ACPI: PCI interrupt 0000:03:00.0[A] -> GSI 19 (level, high) -> IRQ 209
NVRM: loading NVIDIA Linux x86 NVIDIA Kernel Module  1.0-6629  Wed Nov  3 13:12:51 PST 2004
Linux video capture interface: v1.00
usb 2-1.4: new low speed USB device using ohci_hcd and address 4
usbcore: registered new driver hiddev
input: USB HID v1.10 Mouse [Logitech USB-PS/2 Optical Mouse] on usb-0000:00:02.1-1.4
usbcore: registered new driver usbhid
drivers/usb/input/hid-core.c: v2.0:USB HID core driver
usbcore: registered new driver usbmouse
drivers/usb/input/usbmouse.c: v1.6:USB HID Boot Protocol mouse driver
bttv: driver version 0.9.15 loaded
bttv: using 4 buffers with 2080k (520 pages) each for capture
bttv: Bt8xx card found (0).
ACPI: PCI Interrupt Link [APC3] enabled at IRQ 18
ACPI: PCI interrupt 0000:01:06.0[A] -> GSI 18 (level, high) -> IRQ 217
bttv0: Bt878 (rev 17) at 0000:01:06.0, irq: 217, latency: 32, mmio: 0xd4000000
bttv0: detected: AVerMedia TVPhone98 [card=41], PCI subsystem ID is 1461:0003
bttv0: using: AVerMedia TVPhone 98 [card=41,autodetected]
bttv0: Avermedia eeprom[0x0a97]: tuner=5 radio:yes remote control:yes
bttv0: using tuner=5
bttv0: i2c: checking for MSP34xx @ 0x80... not found
bttv0: i2c: checking for TDA9875 @ 0xb0... not found
bttv0: i2c: checking for TDA7432 @ 0x8a... not found
tvaudio: TV audio decoder + audio/video mux driver
tvaudio: known chips: tda9840,tda9873h,tda9874h/a,tda9850,tda9855,tea6300,tea6420,tda8425,pic16c54 (PV951),ta8874z
tvaudio: found tda9840 @ 0x84
bttv0: i2c: checking for TDA9887 @ 0x86... not found
tuner: chip found at addr 0xc2 i2c-bus bt878 #0 [sw]
tuner: type set to 5 (Philips PAL_BG (FI1216 and compatibles)) by bt878 #0 [sw]
bttv0: registered device video0
bttv0: registered device vbi0
bttv0: registered device radio0
bttv0: PLL: 28636363 => 35468950 .. ok
bttv0: add subdevice "remote0"
md: md0 stopped.
md: bind<sdb1>
md: bind<sda1>
md: raid0 personality registered as nr 2
md0: setting max_sectors to 128, segment boundary to 32767
raid0: looking at sda1
raid0:   comparing sda1(117218176) with sda1(117218176)
raid0:   END
raid0:   ==> UNIQUE
raid0: 1 zones
raid0: looking at sdb1
raid0:   comparing sdb1(117218176) with sda1(117218176)
raid0:   EQUAL
raid0: FINAL 1 zones
raid0: done.
raid0 : md_size is 234436352 blocks.
raid0 : conf->hash_spacing is 234436352 blocks.
raid0 : nb_zone is 1.
raid0 : Allocating 4 bytes for hash.
kjournald starting.  Commit interval 5 seconds
EXT3 FS on md0, internal journal
EXT3-fs: mounted filesystem with ordered data mode.
NTFS driver 2.1.22 [Flags: R/O MODULE].
NTFS volume version 3.1.
loop: loaded (max 8 devices)
Adding 2835464k swap on /dev/sda2.  Priority:-3 extents:1
ohci1394: $Rev: 1223 $ Ben Collins <bcollins@debian.org>
ACPI: PCI Interrupt Link [APCM] enabled at IRQ 22
ACPI: PCI interrupt 0000:00:0d.0[A] -> GSI 22 (level, high) -> IRQ 185
ohci1394: fw-host0: OHCI-1394 1.1 (PCI): IRQ=[185]  MMIO=[db084000-db0847ff]  Max Packet=[2048]
ACPI: PCI Interrupt Link [APC1] enabled at IRQ 16
ACPI: PCI interrupt 0000:01:07.2[B] -> GSI 16 (level, high) -> IRQ 225
ohci1394: fw-host1: OHCI-1394 1.1 (PCI): IRQ=[225]  MMIO=[da024000-da0247ff]  Max Packet=[2048]
hdc: ATAPI 40X DVD-ROM drive, 256kB Cache, UDMA(66)
Uniform CD-ROM driver Revision: 3.20
hdd: ATAPI 40X DVD-ROM CD-R/RW drive, 2048kB Cache, UDMA(33)
Intel(R) PRO/1000 Network Driver - version 5.5.4-k2
Copyright (c) 1999-2004 Intel Corporation.
ACPI: PCI interrupt 0000:01:0b.0[A] -> GSI 16 (level, high) -> IRQ 225
e1000: eth0: e1000_probe: Intel(R) PRO/1000 Network Connection
forcedeth.c: Reverse Engineered nForce ethernet driver. Version 0.30.
ACPI: PCI Interrupt Link [APCH] enabled at IRQ 21
ACPI: PCI interrupt 0000:00:04.0[A] -> GSI 21 (level, high) -> IRQ 193
ohci1394: fw-host0: SelfID received outside of bus reset sequence
eth1: forcedeth.c: subsystem: 01458:e000 bound to 0000:00:04.0
eth1394: $Rev: 1224 $ Ben Collins <bcollins@debian.org>
eth1394: eth2: IEEE-1394 IPv4 over 1394 Ethernet (fw-host0)
eth1394: eth3: IEEE-1394 IPv4 over 1394 Ethernet (fw-host1)
ne2k-pci.c:v1.03 9/22/2003 D. Becker/P. Gortmaker
  
http://www.scyld.com/network/ne2k-pci.html
ACPI: PCI interrupt 0000:01:09.0[A] -> GSI 17 (level, high) -> IRQ 177
eth4: RealTek RTL-8029 found at 0x8800, IRQ 177, 00:30:4F:07:7C:62.
Software Watchdog Timer: 0.07 initialized. soft_noboot=0 soft_margin=60 sec (nowayout= 1)
ip_conntrack version 2.1 (7168 buckets, 57344 max) - 304 bytes per conntrack
ip_tables: (C) 2000-2002 Netfilter core team
Floppy drive(s): fd0 is 1.44M
FDC 0 is a post-1991 82077
i2c_adapter i2c-1: nForce2 SMBus adapter at 0x1c00
i2c_adapter i2c-2: nForce2 SMBus adapter at 0x2000
ACPI: PCI interrupt 0000:01:07.0[A] -> GSI 19 (level, high) -> IRQ 209
ACPI: PCI Interrupt Link [APCJ] enabled at IRQ 20
ACPI: PCI interrupt 0000:00:06.0[A] -> GSI 20 (level, high) -> IRQ 201
intel8x0_measure_ac97_clock: measured 49965 usecs
intel8x0: clocking to 47492
ACPI: PCI interrupt 0000:01:06.1[A] -> GSI 18 (level, high) -> IRQ 217
NET: Registered protocol family 17
e1000: eth0: e1000_watchdog: NIC Link is Up 1000 Mbps Full Duplex
ip_tables: (C) 2000-2002 Netfilter core team
ip_conntrack version 2.1 (7168 buckets, 57344 max) - 304 bytes per conntrack
lirc_dev: IR Remote Control driver registered, at major 61 
The bttv_* interface is obsolete and will go away,
please use the new, sysfs based interface instead.
lirc_gpio (-1): card type 0x29, id 0x31461
lirc_dev: lirc_register_plugin:sample_rate: 10
lirc_gpio (0): driver registered
program smartd is using a deprecated SCSI ioctl, please convert it to SG_IO
program smartd is using a deprecated SCSI ioctl, please convert it to SG_IO
program smartd is using a deprecated SCSI ioctl, please convert it to SG_IO
program smartd is using a deprecated SCSI ioctl, please convert it to SG_IO
Installing knfsd (copyright (C) 1996 okir@monad.swb.de).
NET: Registered protocol family 10
Disabled Privacy Extensions on device c036a4e0(lo)
IPv6 over IPv4 tunneling driver
cdrom: open failed.
cdrom: open failed.
Warning: /proc/ide/hd?/settings interface is obsolete, and will be removed soon!
00:00.0 Host bridge: nVidia Corporation nForce2 AGP (different version?) (rev c1)
00: de 10 e0 01 06 00 b0 00 c1 00 00 06 00 00 80 00
10: 08 00 00 d0 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
30: 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00
40: 02 60 20 00 17 02 00 1f 01 00 00 00 ff ff ff ff
50: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff
60: 08 00 01 20 20 00 88 80 10 00 00 00 01 ff 0f 9f <-------
70: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff
80: 0e 01 00 00 ff ff ff 3f 01 00 00 00 01 80 00 00
90: 10 80 00 f3 10 80 00 f1 f0 0f ff 00 00 00 00 00
a0: 00 00 00 00 11 87 38 00 01 00 00 00 00 00 00 00
b0: cc ff 07 00 00 00 00 00 00 00 00 00 00 00 00 00
c0: 33 33 03 00 00 00 00 00 00 00 00 00 00 00 00 00
d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
e0: d6 01 47 00 97 30 00 10 00 00 00 00 00 00 00 00
f0: 07 00 00 08 00 00 00 00 00 00 00 00 00 00 00 00
00:00.1 RAM memory: nVidia Corporation nForce2 Memory Controller 1 (rev c1)
...diff -Naur old/arch/i386/pci/fixup.c new/arch/i386/pci/fixup.c
--- old/arch/i386/pci/fixup.c	2004-12-28 04:25:36.000000000 +0100
+++ new/arch/i386/pci/fixup.c	2005-01-06 00:33:08.380177624 +0100
@@ -248,7 +248,7 @@
 	 * Apply fixup only if C1 Halt Disconnect is enabled
 	 * (bit28) because it is not supported on some boards.
 	 */
-	if ((val & (1 << 28)) && val != fixed_val) {
+	if (val != fixed_val) {
 		printk(KERN_WARNING "PCI: nForce2 C1 Halt Disconnect fixup\n");
 		pci_write_config_dword(dev, 0x6c, fixed_val);
 	}