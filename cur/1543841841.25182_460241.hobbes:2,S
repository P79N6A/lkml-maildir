Date: Mon, 4 Sep 2006 14:20:43 +0300
From: "Pekka Enberg" <>
Subject: Re: [PATCH 03/22][RFC] Unionfs: Branch management functionality
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/9/4/90

On 9/1/06, Josef Sipek <jsipek@cs.sunysb.edu> wrote:
> +struct dentry **alloc_new_dentries(int objs)
> +{
> +       if (!objs)
> +               return NULL;
> +
> +       return kzalloc(sizeof(struct dentry *) * objs, GFP_KERNEL);
kcalloc
> +struct unionfs_usi_data *alloc_new_data(int objs)
> +{
> +       if (!objs)
> +               return NULL;
> +
> +       return kzalloc(sizeof(struct unionfs_usi_data) * objs, GFP_KERNEL);
> +}
Same here. I suggest you kill the wrappers too.
> +int unionfs_ioctl_incgen(struct file *file, unsigned int cmd, unsigned long arg)
> +{
> +       struct super_block *sb;
> +       int gen;
> +
> +       sb = file->f_dentry->d_sb;
> +
> +       unionfs_write_lock(sb);
> +
> +       atomic_inc(&stopd(sb)->usi_generation);
> +       gen = atomic_read(&stopd(sb)->usi_generation);
You could use atomic_inc_return here. Is usi_generation protected by
write lock on sb or do you really need atomic ops?
> +
> +       atomic_set(&dtopd(sb->s_root)->udi_generation, gen);
> +       atomic_set(&itopd(sb->s_root->d_inode)->uii_generation, gen);
> +
> +       unionfs_write_unlock(sb);
> +
> +       return gen;
> +}
-- 
VGER BF report: U 0.5
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/