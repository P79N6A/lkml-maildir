Date: Mon, 22 Sep 2003 10:30:28 -0700
From: Chris Wright <>
Subject: Re: irq 9: nobody cared!
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/22/134

* Ruediger Scholz (rscholz@hrzpub.tu-darmstadt.de) wrote:
> Hi there!
> 
> I own a P4 with SIS 645DX-Chipset, so I tried kernel 2.6.0-test5-mm3 in 
> order to get a working IOAPIC mode with the SIS Chipset. When I boot the 
<snip> 
> If I use the boot param "pci=noacpi" then everything works fine, even sound.
Can you try this patch against 2.6.0-test5-mm3?  PCI IRQ routing is
broken in some circumstances with ACPI.
thanks,
-chris
-- 
Linux Security Modules     
http://lsm.immunix.org
     
http://lsm.bkbits.net
--- 2.6.0-test5-mm3/drivers/acpi/pci_link.c~acpi_pci_irq_fix	2003-09-22 10:00:16.000000000 -0700
+++ 2.6.0-test5-mm3/drivers/acpi/pci_link.c	2003-09-22 10:10:06.000000000 -0700
@@ -500,15 +500,15 @@ static int acpi_pci_link_allocate(struct
 		irq = link->irq.active;
 	} else {
 		irq = link->irq.possible[0];
-	}
 
-	/* 
-	 * Select the best IRQ.  This is done in reverse to promote 
-	 * the use of IRQs 9, 10, 11, and >15.
-	 */
-	for (i=(link->irq.possible_count-1); i>0; i--) {
-		if (acpi_irq_penalty[irq] > acpi_irq_penalty[link->irq.possible[i]])
-			irq = link->irq.possible[i];
+		/* 
+		 * Select the best IRQ.  This is done in reverse to promote 
+		 * the use of IRQs 9, 10, 11, and >15.
+		 */
+		for (i=(link->irq.possible_count-1); i>0; i--) {
+			if (acpi_irq_penalty[irq] > acpi_irq_penalty[link->irq.possible[i]])
+				irq = link->irq.possible[i];
+		}
 	}
 
 	/* Attempt to enable the link device at this IRQ. */
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/