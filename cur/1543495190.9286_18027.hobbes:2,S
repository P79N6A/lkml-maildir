Date: Sun, 9 May 1999 20:26:16 +0100 (BST)
From: Nix <>
Subject: Re: [OFFTOPIC] Searching for filesystem locator
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/5/9/79

Guest section DW writes:
> As far as I now know, there are four utilities that attempt to
> assist in recovering a lost partition table, or a partition
> that was deleted by mistake.
I lost *every* partition table at once :( the Disk Manager 64-sector
offset disappeared when DM shot itself, so every partition table had
wrong values in it. (Need I say there were 14 extended partitions on
this disk? :( )
> (iii) fixdisktable (
http://bmrc.berkeley.edu/people/chaffee/fat32.html
)
> is a utility that handles ext2, FAT, NTFS, ufs, BSD disklabels
> (but not yet old Linux swap partitions); it actually will rewrite
> the partition table, if you give it permission.
I've just tried this (thank you for pointing me at it) but it appears to 
suffer from a 2^31-sectors problem. I'm in the midst of debugging it
because it's annoying me...
> (iv) gpart (
http://home.pages.de/~michab/gpart/
) is a utility
> that handles ext2, FAT, Linux swap, HPFS, NTFS, FreeBSD and
> Solaris/x86 disklabels, minix, reiser fs; it prints a proposed
> contents for the primary partition table, and is well-documented.
... but this proved a godsend. I have the relevant offsets to dd the
filesystems off the stricken box onto another one, there to loopback
mount it and tar it up for the recovery phase. The offsets it gave were
identical to those given by a wreck[1] I hacked up to do the same job,
but it gave data for more than ext2fs, and it didn't have the off-by-one
bugs that my code did :) so I've used it instead of mine.
Thanks a lot for this. I expected maybe one or two tools; four is an
embarrassment of riches. It's proving surprisingly pleasant to fix this, 
because automated systems are doing all the grunt work for me. In the
Olden Days(tm) it was all manual partition table calculations to work
out something that `nearly worked' enough to get some data off, which
tended to take about six hours per partition. The combination of the
loopback fs and automated filesystem-spotting tools is wondrous by
comparison...
... the poor sod[2] with five days of un-backed-up work in the /home
that got eaten says thanks, too :)
[1] I hesitate to call it a tool. Don't write code when panicking; it
    gives ugly results...
[2] not me, thank goodness
-- 
/* I hate C so much... */ --- jwz, in driver/xscreensaver.c
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/