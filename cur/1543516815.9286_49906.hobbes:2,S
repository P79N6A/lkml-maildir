Date: 23 Nov 1999 04:15:14 GMT
From: "Matija Nalis" <>
Subject: UMSDOS patch for 2.2.12/2.2.13
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/23/11

Should fix UMSDOS_STAT_DOS errors umssyncing umsdos filesystem.
Also contains a pointer to new umssync/udosctl & other utils.
diff -ur linux/fs/umsdos/README-WIP.txt /usr/src/linux-2.2.12-my/fs/umsdos/README-WIP.txt
--- linux/fs/umsdos/README-WIP.txt	Mon Aug  9 21:04:40 1999
+++ /usr/src/linux-2.2.12-my/fs/umsdos/README-WIP.txt	Fri Aug 27 02:22:29 1999
@@ -11,6 +11,10 @@
 come and test it! See notes below for some more information, or if
 you are trying to use UMSDOS as root partition.
 
+Userland NOTE: new umsdos_progs (umssync, umssetup, udosctl & friends) that
+will compile and work on 2.2.x kernels and glibc based systems may be found
+at 
http://cvs.linux.hr/
+
 Legend: those lines marked with '+' on the beggining of line indicates it
 passed all of my tests, and performed perfect in all of them.
 
diff -ur linux/fs/umsdos/inode.c /usr/src/linux-2.2.12-my/fs/umsdos/inode.c
--- linux/fs/umsdos/inode.c	Mon Aug  9 21:04:40 1999
+++ /usr/src/linux-2.2.12-my/fs/umsdos/inode.c	Mon Nov 22 18:58:19 1999
@@ -349,7 +349,7 @@
 	if (!res)
 		goto out_fail;
 
-	printk (KERN_INFO "UMSDOS 0.85 "
+	printk (KERN_INFO "UMSDOS 0.85a "
 		"(compatibility level %d.%d, fast msdos)\n", 
 		UMSDOS_VERSION, UMSDOS_RELEASE);
 
diff -ur linux/fs/umsdos/ioctl.c /usr/src/linux-2.2.12-my/fs/umsdos/ioctl.c
--- linux/fs/umsdos/ioctl.c	Sat Sep 26 01:30:06 1998
+++ /usr/src/linux-2.2.12-my/fs/umsdos/ioctl.c	Mon Nov 22 21:17:22 1999
@@ -280,6 +280,8 @@
 old_dentry->d_parent->d_name.name, old_dentry->d_name.name,
 new_dentry->d_parent->d_name.name, new_dentry->d_name.name);
 			ret = msdos_rename (dir, old_dentry, dir, new_dentry);
+			d_drop(new_dentry);
+			d_drop(old_dentry);
 			dput(new_dentry);
 		}
 		dput(old_dentry);
-- 
Opinions above are GNU-copylefted.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/