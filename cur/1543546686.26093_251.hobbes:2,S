Date: Fri, 25 Aug 2000 16:01:11 -0400 (EDT)
From: Chaskiel M Grundman <>
Subject: psaux lockup on SMP 2.4.0-test7 after quitting X
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/8/25/93

I have encountered a problem on several machines that causes the machine
to lock up when gpm retakes control of the ps2 mouse device after X is
shut down, but only when the system is running an SMP kernel. I could
not find any reports of similar problems, which makes me wonder if I
might be doing something wrong.... Any ideas? Any other info I should
provide?
This problem also affects 2.2.16 running on the same hardware (in fact,
2.2.16 is my primary kernel for these systems...)
This problem occurs whether or not the machine has more than one CPU
This problem occurs whether or not the machine has an IOAPIC.
This problem occurs whether or not the kernel has been booted with
'nosmp' or 'noapic'
2.4.0-test7 kernels compiled for uniprocessor APIC operation do not have
this problem. (I tested this kernel only on a UP system with an IOAPIC)
I have experienced these lockups both with XFree86 4.0.1 and 3.3.5.
An affected kernel/system will always lock up.
Stopping and restarting gpm without running X does not trigger the problem. *
Stopping gpm, running X, quitting X, and  restarting gpm does trigger
the problem. *
* this was not tested with a 2.4 kernel, but I believe that it shouldn't
matter...
I have a trace from the NMI watchdog:
ksymoops 2.3.4 on i686 2.4.0-test7.  Options used
     -V (default)
     -k /proc/ksyms (default)
     -l /proc/modules (default)
     -o /lib/modules/2.4.0-test7/ (default)
     -m /boot/System.map-2.4.0-test7 (specified)
CPU: 0
EIP: 0010:[<c01fabdd>]
Using defaults from ksymoops -t elf32-i386 -a i386
Call Trace: [<c017d441>] [<c017d1ad>] [<c017d1ab>] [<c017d723>]
[<c017d8b9>] [<c016958c>] [<c013170a>]
         [<c013065e>] [<c013058e>] [<c01308a0>] [<c010a877>]
Code: 7e f5 e9 24 3b f8 ff 80 3d 40 5a 25 c0 f3 90 7e 5f e9 50
>>EIP; c01fabdd <stext_lock+49a5/83e8>   <=====
Trace; c017d441 <handle_kbd_event+85/19c>
Trace; c017d1ad <kb_wait+d/34>
Trace; c017d1ab <kb_wait+b/34>
Trace; c017d723 <aux_write_ack+1f/3c>
Trace; c017d8b9 <open_aux+59/7c>
Trace; c016958c <misc_open+114/190>
Trace; c013170a <chrdev_open+66/a8>
Trace; c013065e <dentry_open+c6/158>
Trace; c013058e <filp_open+52/5c>
Trace; c01308a0 <sys_open+3c/f4>
Trace; c010a877 <system_call+33/38>
Code;  c01fabdd <stext_lock+49a5/83e8>
00000000 <_EIP>:
Code;  c01fabdd <stext_lock+49a5/83e8>   <=====
   0:   7e f5                     jle    fffffff7 <_EIP+0xfffffff7>
c01fabd4 <stext_lock+499c/83e8>   <=====
Code;  c01fabdf <stext_lock+49a7/83e8>
   2:   e9 24 3b f8 ff            jmp    fff83b2b <_EIP+0xfff83b2b>
c017e708 <drive_is_flashcard+2c/11c>
Code;  c01fabe4 <stext_lock+49ac/83e8>
   7:   80 3d 40 5a 25 c0 f3      cmpb   $0xf3,0xc0255a40
Code;  c01fabeb <stext_lock+49b3/83e8>
   e:   90                        nop    
Code;  c01fabec <stext_lock+49b4/83e8>
   f:   7e 5f                     jle    70 <_EIP+0x70> c01fac4d
<stext_lock+4a15/83e8>
Code;  c01fabee <stext_lock+49b6/83e8>
  11:   e9 50 00 00 00            jmp    66 <_EIP+0x66> c01fac43
<stext_lock+4a0b/83e8>
The following systems were tested:
system            CPU's         chipset/apic      graphics card        lockup?
dell poweredge    4x ppro200    "Alder"/y         Isa clgd5424           n
6xxx
dell optiplex     1x PIII933     i810/y           AGP Nvidia TNT2 m64    y
GX300
Dell optiplex     1x PIII600     440BX/n          AGP ATI Rage Pro       y
GX1p
Dell Workstation  2x PIII800     i810/y           AGP Nvidia GeForce     y
420 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/