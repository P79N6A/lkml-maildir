Date: Sat, 9 Feb 2008 16:26:43 -0800
From: Andrew Morton <>
Subject: Re: 2.6.24-git20 -- BUG: sleeping function called from invalid context at include/asm/uaccess_32.h:449
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/9/274

On Sat, 9 Feb 2008 14:03:28 -0500 "Miles Lane" <miles.lane@gmail.com> wrote:
> Command run:
>      find /proc | xargs tail
> 
> [ 2710.028219] BUG: sleeping function called from invalid context at
> include/asm/uaccess_32.h:449
> [ 2710.028229] in_atomic():1, irqs_disabled():0
> [ 2710.028232] 1 lock held by head/9380:
> [ 2710.028234]  #0:  (hugetlb_lock){--..}, at: [<c016734f>]
> hugetlb_overcommit_handler+0x16/0x3e
> [ 2710.028248] Pid: 9380, comm: head Not tainted 2.6.24-git20 #5
> [ 2710.028260]  [<c0118749>] __might_sleep+0xc2/0xc9
> [ 2710.028267]  [<c021cb39>] copy_to_user+0x32/0x49
> [ 2710.028277]  [<c0123f6a>] do_proc_doulongvec_minmax+0x1df/0x27f
> [ 2710.028289]  [<c012403c>] proc_doulongvec_minmax+0x15/0x17
> [ 2710.028295]  [<c0167363>] hugetlb_overcommit_handler+0x2a/0x3e
> [ 2710.028303]  [<c01a1462>] proc_sys_read+0x5e/0x7b
> [ 2710.028311]  [<c01a1404>] ? proc_sys_read+0x0/0x7b
> [ 2710.028317]  [<c0170d7a>] vfs_read+0x8a/0x106
> [ 2710.028325]  [<c017116f>] sys_read+0x3b/0x60
> [ 2710.028331]  [<c0103e32>] sysenter_past_esp+0x5f/0xa5
Ugh, how did I let that one through?
Guys, how often mut it be said?  PLEASE always test all code with all
kernel deubg options enabled.