Date: Thu, 07 Jun 2007 18:09:41 +0100
From: "Stephen C. Tweedie" <>
Subject: Re: ext3fs: umount+sync not enough to guarantee metadata-on-disk
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/7/283

Hi,
On Thu, 2007-06-07 at 12:01 -0400, Mark Lord wrote:
> >>    mount /var/lib/mythtv -oremount,ro
> >>    sync
> >>    umount /var/lib/mythtv
> > 
> > Did this succeed?  If the application is still truncating that file, the
> > umount should have failed.
> 
> Actually, what I expect to happen is for the remount,ro
> to block  until the file deletion completes.  But it doesn't.
No -- all that the remount,ro sees is that there's a fd still open for
write.  It has no idea if or when that fd is going to get closed, so it
should fail.  Returning -EBUSY is the only thing it _can_ do: waiting
for the fs to be remountable might wait forever.
So the fs is still writable after that point.
--Stephen
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/