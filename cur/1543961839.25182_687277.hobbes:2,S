Date: Wed, 30 Apr 2008 18:34:33 +0100
From: David Woodhouse <>
Subject: Re: [rtc-linux] Re: [PATCH] RTC class driver for ppc_md RTC functions
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/4/30/290

On Wed, 2008-04-30 at 11:39 +0200, Alessandro Zummo wrote:
> On Mon, 28 Apr 2008 12:08:02 +0100
> David Woodhouse <dwmw2@infradead.org> wrote:
> 
> > 
> > I suspect that actually covers quite a lot of devices, but the RTC class
> > could happily cope with other types of devices too -- just giving an
> 
>  If we are talking about milliseconds I think a suspect is not enough.
Let me rephrase: This is how we're doing it for _every_ machine/platform
which supports update_persistent_clock(). It makes sense to let
individual RTC-class drivers do it differently if they need to, but it's
a damn good default behaviour until/unless someone actually shows that
they need it to be different. :)
>  The hardware RTC does not need to be updated every time the system
>  clock is. In fact, as long as the system is running, it's pretty useless.
> 
>  Most distributions update the RTC from the system timer on shutdown.
You're assuming that the machine will shut down in an orderly fashion. 
And the update from userspace, if enabled, will never be as accurate as
the one we do from the kernel. We currently go to great pains to ensure
that it happens at precisely the right time, and that's really only
feasible from within the kernel.
>  This kind of update will also be unreliable on any not-memory-mapped
>  RTC (think of SPI and I2C) .
It's still much more reliable from the kernel than it is from userspace.
>  My opinion is that such NTP mode could be removed from the kernel/not
>  implemented in rtc class without loosing anything.
Want to send a patch to lkml which removes update_persistent_clock() and
see what people think of that? :)
-- 
dwmw2