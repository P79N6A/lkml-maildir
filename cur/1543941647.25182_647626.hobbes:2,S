Date: Sat, 02 Feb 2008 23:45:13 -0500
From: Pavel Roskin <>
Subject: [PATCH] module: remove module taint on ndiswrapper
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/2/353

Revert 0aa5bd52d0c49ca56d24584c646e6544ccbb3dc9, which disallowed
ndiswrapper to use GPL-only symbols.
Add comments why ndiswrapper and driverloader are tainted to avoid
similar mistakes in the future.
Signed-off-by: Pavel Roskin <proski@gnu.org>
---
 kernel/module.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)
diff --git a/kernel/module.c b/kernel/module.c
index bd60278..c7f3fa6 100644
--- a/kernel/module.c
+++ b/kernel/module.c
@@ -1933,8 +1933,13 @@ static struct module *load_module(void __user *umod,
 	/* Set up license info based on the info section */
 	set_license(mod, get_modinfo(sechdrs, infoindex, "license"));
 
+	/* ndiswrapper can load proprietary drivers.  Don't use
+	   add_taint_module(), as ndiswrapper needs GPL-only symbols. */
 	if (strcmp(mod->name, "ndiswrapper") == 0)
-		add_taint_module(mod, TAINT_PROPRIETARY_MODULE);
+		add_taint(TAINT_PROPRIETARY_MODULE);
+
+	/* driverloader is proprietary, but it's known to be lying about
+	   its license in the license info */
 	if (strcmp(mod->name, "driverloader") == 0)
 		add_taint_module(mod, TAINT_PROPRIETARY_MODULE);
 