Date: Thu, 28 Oct 2004 21:23:59 +0530
From: Prasanna S Panchamukhi <>
Subject: Re: [0/3] PATCH Kprobes for x86_64- 2.6.9-final
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/10/28/210

Hi Andi,
Please see my comments inline below.
Thanks
Prasanna
On Thu, Oct 28, 2004 at 01:37:44PM +0200, Andi Kleen wrote:
> 
> Like I still would like to have the page fault notifier
> completely moved out of the fast path into no_context 
> (that i386 has it there is also wrong). Adding kprobe_runn 
> doesn't make a difference.
    The kprobes fault handler is called if an exception is 
generated for any instruction within the fault-handler or when 
Kprobes single-steps the probed instruction.
AFAIK kprobes does not handle page faults in the above case and just returns
immediately resuming the normal execution. 
> 
> And the jprobe_return_end change is wrong, my suggestion
> was to move it into the inline assembler statement. Adding asmlinkage 
> doesn't help at all 
> (I think i386 gets this wrong too) 
> 
In the below code, I moved jprobe_return_end to inline assembler statement.
void jprobe_return(void)
{
        preempt_enable_no_resched();
        asm volatile ("       xchg   %%rbx,%%rsp     \n"
                      "       int3                      \n"
                      "       .globl jprobe_return_end  \n"
                      "       jprobe_return_end:        \n"
                      "       nop                       \n"::"b"
                      (jprobe_saved_rsp):"memory");
}
> -Andi
-- 
Thanks & Regards
Prasanna S Panchamukhi
Linux Technology Center
India Software Labs, IBM Bangalore
Ph: 91-80-25044636
<prasanna@in.ibm.com>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/