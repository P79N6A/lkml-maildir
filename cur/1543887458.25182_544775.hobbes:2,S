Date: Tue, 15 May 2007 16:25:21 +0200
From: Martin Peschke <>
Subject: Re: 2.6.21-mm2 - CONFIG_STATISTIC and Intel PowerTOP...
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/5/15/155

Valdis.Kletnieks@vt.edu wrote:
> On Wed, 09 May 2007 01:23:22 PDT, Andrew Morton said:
>> 
ftp://ftp.kernel.org/pub/linux/kernel/people/akpm/patches/2.6/2.6.21/2.6.21-mm2/
> 
> So I'm trying to get the Intel PowerTop stuff working, and discovered that /
> proc/timer_stats and/or /proc/tstats has moved to /debug in -mm2 - but only if
> you're building for S390.  For other architechtures it just evaporates
> entirely.  I had to bash this patch in to get it to get included in an x86_64
> build:
My mistake. I should have submitted patches that make CONFIG_STATISTICS a 
Kconfig option for all archs.
Meanwhile, the patch that implements timerstats using lib/statistic.c
has been dropped from -mm, because there is already a tool, called powertop, 
that looks for timerstats in procfs. This fixes your issue.
I am wondering whether I should submit Kconfig patches as a precautionary 
measure anyway.
> 
> --- linux-2.6.21-mm2/arch/x86_64/Kconfig.statistics     2007-05-14 23:01:00.000000000 -0400
> +++ linux-2.6.21-mm2/arch/x86_64/Kconfig        2007-05-14 23:00:45.000000000 -0400
> @@ -793,6 +793,8 @@
> 
>  source "kernel/Kconfig.marker"
> 
> +source "lib/Kconfig.statistic"
> +
>  endmenu
> 
>  source "arch/x86_64/Kconfig.debug"
> 
> Am just replicating the choice to put it in arch/s390/Kconfig - not sure why
> it was in there rather than lib/Kconfig.debug - is there a reason here?
CONFIG_STATISTICS really is instrumentation support. Its users might provide 
statistics of general interest just as well as for debugging purposes, though.
> 
> Having bashed *that* into place, I hit this at kernel link time:
> 
> WARNING: lib/built-in.o - Section mismatch: reference to .init.text:statistic_hotcpu from .data between 'statistic_hotcpu_notifier' (at offset 0x640) and 'io_tlb_lock'
> 
I am not confident, but my guess is:
I should mark statistic_hotcpu_notifier as __cpuinitdata because it references 
statistic_hotcpu(), which is marked __cpuinit. This makes a similar warning just 
seen during a test compile on i386 go away.
Martin
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/