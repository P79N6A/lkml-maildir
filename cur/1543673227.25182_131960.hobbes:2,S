Date: Mon, 12 May 2003 10:12:55 -0400
From: "Robert L. Harris" <>
Subject: Re: removing a single device?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/5/12/104

Does it work on scsi-emulation devices such as 3Ware raid controllers?
I'm trying to swap out a failed IDE drive on a 3Ware card.  I went into
tw_cli and executed "maint remove c1 p1" and it shows the drive offline.
The disk is in what appears to be a hot-swap connection similar to SCA.
Do I need to do the line below to remove it since the 3ware card
registers the drive offline?
root@legato-disk4.acs:~# tw_cli info c1 p1
Controller 1, Port  1
----------------------
Status:    OFFLINE JBOD
Model:     Maxtor 4G160J8
Size:      163.92 GB (320173056 blocks)
Serial #:  G805DE1E
FW:        GAK819K0
Unit:       1
/proc/scsi/scsi does still show the device:
Host: scsi1 Channel: 00 Id: 01 Lun: 00
  Vendor: 3ware    Model: 3w-xxxx          Rev: 1.0 
  Type:   Direct-Access                    ANSI SCSI revision: ffffffff
and the echo, remove below doesn't remove it.  It does happily though
work on some other systems with SCA interfaces.
Thanks,
  Robert
Thus spake Douglas Gilbert (dgilbert@interlog.com):
> Robert L. Harris wrote:
> > A long time ago I used to be able to do:
> >
> > echo "scsi add-single-device 0 0 11 0" > /proc/scsi/scsi
> > echo "scsi remove-single-device 0 0 11 0" > /proc/scsi/scsi
> >
> > When I wanted to unplug a SCA scsi drive for replacement.  I tried this
> > recently on my 2.4.20 kernel and nothing happened.  No errors, no change
> > to /proc/scsi/scsi, no entry in dmsg, it just ignored it.  Has this been
> > deprecated for a new way of removing hotswap drives?
> 
> Robert,
> It is not deprecated (and is still present in the lk 2.5
> development series since we still have no other way of
> doing this from the user space).
> 
> The parsing of that expression is very rigid: no tabs
> or redundant spaces.
> 
> Doug Gilbert
[unhandled content-type:application/pgp-signature]