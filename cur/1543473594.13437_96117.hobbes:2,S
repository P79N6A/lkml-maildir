Date: Wed, 30 Dec 1998 16:44:37 -0600 (CST)
From: "Andre M. Hedrick" <>
Subject: IDE BUGFIX agaist (test1-patch-2.2.0-pre2)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1998/12/31/73

ide-disk.c :: typo error :: (minor, very needed, hasn't caused a problem yet)
ide.c      :: if (drive == NULL) in ide_xlate_1024 :: (major, must)
Submitted to Linus already..........
Cheers,
Andre Hedrick
The Linux IDE guy
The APC UPS Specialist for Linux
http://www.dyer.vanderbilt.edu/server/udma/
http://www.dyer.vanderbilt.edu/server/apcupsd/apcupsd-3.5.2.bin.tar.gz
You just need a bigger hammer, or learn how to swing the one you have better.
(C) me.....
diff -ur linux-2.2.0-pre2/drivers/block/ide-disk.c linux/drivers/block/ide-disk.c
--- linux-2.2.0-pre2/drivers/block/ide-disk.c	Wed Dec 30 10:13:54 1998
+++ linux/drivers/block/ide-disk.c	Wed Dec 30 15:18:11 1998
@@ -96,7 +96,7 @@
 	 * This is a split test for drives 8 Gig and Bigger only.
 	 */
 	if ((id->lba_capacity >= 16514064) && (id->cyls == 0x3fff) &&
-	    (id->heads == 16) && (id->sectors = 63)) {
+	    (id->heads == 16) && (id->sectors == 63)) {
 		id->cyls = lba_sects / (16 * 63); /* correct cyls */
 		return 1;	/* lba_capacity is our only option */
 	}
@@ -105,7 +105,7 @@
 	 * This is a split test for drives less than 8 Gig only.
 	 */
 	if ((id->lba_capacity < 16514064) && (lba_sects > chs_sects) &&
-	    (id->heads == 16) && (id->sectors = 63)) {
+	    (id->heads == 16) && (id->sectors == 63)) {
 		id->cyls = lba_sects / (16 * 63); /* correct cyls */
 		return 1;	/* lba_capacity is our only option */
 	}
diff -ur linux-2.2.0-pre2/drivers/block/ide.c linux/drivers/block/ide.c
--- linux-2.2.0-pre2/drivers/block/ide.c	Wed Dec 30 10:13:54 1998
+++ linux/drivers/block/ide.c	Wed Dec 30 15:20:26 1998
@@ -2579,6 +2579,9 @@
 	unsigned long tracks;
 
 	if ((drive = get_info_ptr(i_rdev)) == NULL || drive->forced_geom) {
+		/* bombs otherwise /axboe */
+		if (drive == NULL) 
+			return 0;
 		/*
 		 * Update the current 3D drive values.
 		 */