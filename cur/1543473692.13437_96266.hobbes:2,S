Date: Thu, 31 Dec 1998 14:49:14 -0600
From: Michael Elizabeth Chastain <>
Subject: Re: Some config/menuconfig/xconfig fixes
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1998/12/31/223

Hi Andrzej,
> - Not compatible dep_tristate in Menuconfig and Configure
>   (if dependency was set to "n" Configure disables option, Menuconfig
>   does not). Fixed by modifying Menuconfig.
Good idea, but it needs to call define_bool so that tests further
down will get the right value.  Can you try this patch instead:
    
ftp://ftp.shout.net/pub/users/mec/experimental/menuconfig-deptristate.diff
The patch is short so I'm appending it to this letter too.
I will try out your other patches next; they look reasonable to me.
> The main xconfig window became too large after Alan's config modifications.
> It needs either scrolling or dividing the menu into two columns.
> Does anybody work on it? 
Here is my opinion: re-arrange the menus so there are fewer of them at
the top level.  Specifically, move "code maturity level options" and
"loadable module support" into "general setup".  Then move all the device
menus into a "device setup" menu.
Michael Elizabeth Chastain
<mailto:mec@shout.net>
"love without fear"
===
diff -u -r -N linux-2.2.0-pre2/scripts/Menuconfig linux/scripts/Menuconfig
--- linux-2.2.0-pre2/scripts/Menuconfig	Wed Dec 30 03:27:06 1998
+++ linux/scripts/Menuconfig	Thu Dec 31 01:18:43 1998
@@ -57,6 +57,10 @@
 # 13 Dec 1998, Riley H Williams (rhw@bigfoot.com)
 # When an error occurs, actually display the error message as well as
 # our comments thereon.
+#
+# 31 Dec 1998, Michael Elizabeth Chastain (mec@shout.net)
+# Fix mod_bool to honor $CONFIG_MODULES.
+# Fix dep_tristate to call define_bool when dependency is "n".
 
 
 #
@@ -177,17 +181,13 @@
 #       else in the kernel.
 #
 function dep_tristate () {
-	if [ "$CONFIG_MODULES" != "y" ]
-	then
-		bool "$1" "$2"
-	else
-		if  eval [ "_$3" != "_m" ]
-		then
-			tristate "$1" "$2" $3
-		else
-			mod_bool "$1" "$2"
-		fi
-	fi
+	if [ "$3" = "y" ]; then
+	    tristate "$1" "$2"
+	else if [ "$3" = "m" ]; then
+	    mod_bool "$1" "$2"
+	else 
+	    define_bool "$2" "$n"
+	fi; fi
 }
 
 #
@@ -372,16 +372,20 @@
 # Same as bool() except options are (Module/No)
 #
 function mod_bool () {
-	set_x_info "$2" "n"
-
-	case $x in
-	y|m) flag='M' ;;
-	*)   flag=' ' ;;
-	esac
-
-	echo -ne "'$2' '<$flag> $1$info' " >>MCmenu
-
-	echo -e "function $2 () { l_mod_bool '$2' \"\$1\" ;}" >>MCradiolists
+	if [ "$CONFIG_MODULES" != "y" ]; then
+	    define_bool "$2" "n"
+	else
+	    set_x_info "$2" "n"
+ 
+	    case $x in
+	    y|m) flag='M' ;;
+	    *)   flag=' ' ;;
+	    esac
+ 
+	    echo -ne "'$2' '<$flag> $1$info' " >>MCmenu
+ 
+	    echo -e "function $2 () { l_mod_bool '$2' \"\$1\" ;}" >>MCradiolists
+	fi
 }
 
 #
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/