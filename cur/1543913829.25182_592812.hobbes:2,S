Date: Mon, 10 Sep 2007 15:07:30 -0400
From: 	Valdis.Kletnieks@vt ...
Subject: Re: 2.6.23-rc3-mm1 - vdso and gettimeofday issues with glibc
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/9/10/233

On Sun, 09 Sep 2007 09:27:06 +0200, Andi Kleen said:
> > Updating on this issue:   Both myself and another person have reported on
> > the RedHat bugzilla that it's a clocksource issue - if you are using the
> > hpet clocksource, the time warps, but booting with clocksource=acpi_pm works.
> > 
> > This ring any bells?
> 
> Does this patch fix it? 
> -Andi
> 
> Add missing mask operation to vdso
> 
> vdso vgetns() didn't mask the time source offset calculation, which could
> lead to time problems with 32bit HPET. Add the masking.
> 
> Thanks to Chuck Ebbert for tracking down.
> 
> Signed-off-by: Andi Kleen <ak@suse.de>
Confirming that does indeed fix it - booted with hpet clocksource and vdso=1,
and the time didn't warp at the 5-minute mark.
Tested-By: Valdis Kletnieks <valdis.kletnieks@vt.edu>
[unhandled content-type:application/pgp-signature]