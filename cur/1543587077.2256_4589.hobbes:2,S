Date: Mon, 09 Apr 2001 13:14:39 -0400
From: Wade Hampton <>
Subject: Re: 2.4.3, VMWare, 2 VMs
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/4/9/121

Petr Vandrovec wrote:
> 
> On  9 Apr 01 at 12:03, Wade Hampton wrote:
> 
> > Is anyone having problems with running more than
> As I already answered on VMware newsgroups:
Thanks.  I didn't see the post on the VMware newsgroup....
> VMware's 2.0.3 vmmon module uses save_flags() + cli()
> in poll() fops, and after this cli() it calls
> spin_lock() :-( It is not safest thing to do.
> But it should not cause reboot. You should get
> 
> /dev/vmmon: 11 wait for global VM lock XX
I had over 2000 of those in /var/log/messages
(not counting the "repeated" lines in /var/log/messages).
Yep, that's the problem....
> 
> and now dead machine with disabled interrupts...
Yes, basically a dead machine with NO response to 
anything....
> 
> As all other callers of HostIF_GlobalVMLock() hold
> big kernel lock, easiest thing to do is to add
> lock_kernel()/unlock_kernel() around LinuxDriver_Poll()
> body.
> 
> Removing whole save_flags/cli is for sure much better,
> but it is still in my queue (if you are looking into vmmon
> driver, then whole poll mess is there to get wakeup on
> next jiffy, and not on next + one...).
No, I can wait for the a release that fixes this.  If
you have a patch or test version, send it to me and I'll
test it on my development machine....
For now, I'll just not use 2 VMs until it is fixed.
Cheers,
-- 
W. Wade, Hampton  <whampton@staffnet.com>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/