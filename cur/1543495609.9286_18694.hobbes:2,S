Date: Thu, 13 May 1999 11:25:57 -0400 (EDT)
From: Alexander Viro <>
Subject: Re: [VFS] move active filesystem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/5/13/139

On Thu, 13 May 1999, Matthew Wilcox wrote:
> On Wed, May 12, 1999 at 02:13:03PM -0400, Alexander Viro wrote:
> > > > Another thing to consider: behaviour of NFS-exported filesystems. That has
> > > > nothing to loops. Look at the export table handling in knfsd. AFAICS it
> > > > may bite you if you are moving the stuff around that way.
> 
> > Could you look at it?
> 
> I'm not at all familiar with the knfsd code, but I went through
> export.c quickly.  It seems that it doesn't keep hold of the dentry
> for the filesystem it exports, so if you move a filesystem under it,
> it will then try the lookup when accessed and fail (unless you put
> another filesystem under it of course).  But accesses to old files
> will keep the same dentry and inode, so they will work.  Really, it
> shouldn't be any different to the underlying directory being renamed.
> Or have I completely missed your point?  (Entirely possible).
	The thing that actually worries me here being that all analysis of
potential races was done in assumption that mountpoints never move. Quite
probably your patch *is* safe (with addition of loop check, that is). As
for lookups - yes, you are right. It's not worse than renames (which are
not race-free wrt lookups ;-/) and the same fix will work here too.
	Well, it's 2.3, so... Let's try it and look whether it will give
any troubles wrt NFS. Final word here belongs to Trond and Linus, indeed.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/