Date: Mon, 23 Jul 2007 16:40:10 -0700
From: "Nelson, Shannon" <>
Subject: RE: __unsafe() usage
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/23/516

Rusty Russell [mailto:rusty@rustcorp.com.au] 
>> If this is true, and since the MOD_INC_USE_COUNT compat code is long 
>> gone, shouldn't we be able to completely remove __unsafe() and the 
>> struct member "unsafe"?
>
>Yes, indeed, something like this:
>==
>Remove "unsafe" from module struct
>
>Adrian Bunk points out that "unsafe" was used to mark modules 
>touched by
>the deprecated MOD_INC_USE_COUNT interface, which has long gone.  It's
>time to remove the member from the module structure, as well.
>
>If you want a module which can't unload, don't register an exit
>function.
>
>Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
>
>diff -r d7af727512fd drivers/dma/ioatdma.c
>--- a/drivers/dma/ioatdma.c	Tue Jul 24 08:30:05 2007 +1000
>+++ b/drivers/dma/ioatdma.c	Tue Jul 24 09:11:11 2007 +1000
>@@ -811,18 +811,17 @@ MODULE_AUTHOR("Intel Corporation");
> 
> static int __init ioat_init_module(void)
> {
>-	/* it's currently unsafe to unload this module */
>-	/* if forced, worst case is that rmmod hangs */
>-	__unsafe(THIS_MODULE);
>-
> 	return pci_register_driver(&ioat_pci_driver);
> }
> 
> module_init(ioat_init_module);
> 
>+/* it's currently unsafe to unload this module */
>+#if 0
> static void __exit ioat_exit_module(void)
> {
> 	pci_unregister_driver(&ioat_pci_driver);
> }
> 
> module_exit(ioat_exit_module);
>+#endif
Acked-by: Shannon Nelson <shannon.nelson@intel.com>
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/