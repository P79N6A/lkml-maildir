Date: Wed, 27 Apr 2005 12:41:53 +0200
From: Alexander Nyberg <>
Subject: Re: 2.6.12-rc2-mm3
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/4/27/54

The two functions:
crash_kexec()
smp_send_stop()
called from panic() wants preempt to be disabled which it may not be if
coming from a direct panic assertion (and not via the do_exit
assertions...).
Signed-off-by: Alexander Nyberg <alexn@telia.com> 
Index: mm/kernel/panic.c
===================================================================
--- mm.orig/kernel/panic.c	2005-04-26 11:15:29.000000000 +0200
+++ mm/kernel/panic.c	2005-04-26 23:18:07.000000000 +0200
@@ -64,6 +64,12 @@
         unsigned long caller = (unsigned long) __builtin_return_address(0);
 #endif
 
+	/* It's possible to come here directly from a panic-assertion and not
+	 * have preempt disabled. Some functions called from here want
+	 * preempt to be disabled. No point enabling it later though...
+	 */
+	preempt_disable();
+	
 	bust_spinlocks(1);
 	va_start(args, fmt);
 	vsnprintf(buf, sizeof(buf), fmt, args);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/