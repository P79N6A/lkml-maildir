Date: Mon, 31 May 1999 21:10:54 +0200
From: Roland Olsson <>
Subject: Simultaneous network/IDE traffic = reboot
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/5/31/180

Hi,
I have stumbled upon a _big_ problem with my machine. It makes a silent
and instantaneous soft reboot when performing (pretty tough) disk and
network access at the same time. I noticed this when trying to transfer
some 10+ Mb files from this machine as the screen just turned black and
the BIOS "welcome" screen appeared. No kernel oops or other message,
just a plain reboot. I can't find anything in the logs either. *sigh*
If I am using the machine "normally" everything works just fine. That is
no fiddling with large files or performing any extreme network activity.
I have found a very simple way of reproducing the crash. Just do a 'ping
-f' to the machine for a second or so and run 'hdparm -t /dev/hda' at
the same time. It reboots almost immediately. One more thing, if I do
'ping -f' locally no matter to what address/if, I can't make it crash.
But from another machine - reboot.
I have checked everything I can think of, i.e. conflicting IRQ:s, DMA
etc. I have tried to reassign almost everything in the BIOS but to no
avail. Also tested the 2.2.9 kernel but same thing there. I do not know
what to do next, does anyone of you have an idea?
Some facts about the machine:
  Intel Celeron 333
  128Mb DIMM
  Motherboard Abit BH6 (Award BIOS rev 4.51PG)
  2pcs NIC 3Com 3C905B-TX
  Seagate Medalist ST38420A IDE 8,6Gb
  Redhat 6.0 (kernel build 2.2.5-15)
Attached are some files from /proc that may or may not help you to help
me.
Regards,
/Roland::::::::::::::
cpuinfo
::::::::::::::
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 6
model name	: Celeron (Mendocino)
stepping	: 0
cpu MHz		: 334.098612
cache size	: 128 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 sep mtrr pge mca cmov pat pse36 mmx osfxsr
bogomips	: 333.41
::::::::::::::
devices
::::::::::::::
Character devices:
  1 mem
  2 pty
  3 ttyp
  4 ttyS
  5 cua
  7 vcs
 10 misc
 29 fb
 36 netlink
128 ptm
136 pts
Block devices:
  1 ramdisk
  3 ide0
  9 md
::::::::::::::
dma
::::::::::::::
 4: cascade
::::::::::::::
dmesg
::::::::::::::
Linux version 2.2.5-15 (root@porky.devel.redhat.com) (gcc version egcs-2.91.66 19990314/Linux (egcs-1.1.2 release)) #1 Mon Apr 19 23:00:46 EDT 1999
Detected 334098612 Hz processor.
Console: colour dummy device 80x25
Calibrating delay loop... 333.41 BogoMIPS
Memory: 63140k/65536k available (996k kernel code, 412k reserved, 928k data, 60k init)
VFS: Diskquotas version dquot_6.4.0 initialized
CPU: Intel Celeron (Mendocino) stepping 00
Checking 386/387 coupling... OK, FPU using exception 16 error reporting.
Checking 'hlt' instruction... OK.
POSIX conformance testing by UNIFIX
mtrr: v1.26 (19981001) Richard Gooch (rgooch@atnf.csiro.au)
PCI: PCI BIOS revision 2.10 entry at 0xfb460
PCI: Using configuration type 1
PCI: Probing PCI hardware
Linux NET4.0 for Linux 2.2
Based upon Swansea University Computer Society NET3.039
NET4: Unix domain sockets 1.0 for Linux NET4.0.
NET4: Linux TCP/IP 1.0 for NET4.0
IP Protocols: ICMP, UDP, TCP, IGMP
Initializing RT netlink socket
Starting kswapd v 1.5 
vesafb: framebuffer at 0xe6000000, mapped to 0xc4800000, size 4096k
vesafb: mode is 1024x768x32, linelength=4096, pages=0
vesafb: protected mode interface info at c000:7ee0
vesafb: scrolling: redraw
vesafb: directcolor: size=8:8:8:8, shift=24:16:8:0
Console: switching to colour frame buffer device 128x48
fb0: VESA VGA frame buffer device
Detected PS/2 Mouse Port.
Serial driver version 4.27 with MANY_PORTS MULTIPORT SHARE_IRQ enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
pty: 256 Unix98 ptys configured
apm: BIOS version 1.2 Flags 0x07 (Driver version 1.9)
Real Time Clock Driver v1.09
RAM disk driver initialized:  16 RAM disks of 4096K size
PIIX4: IDE controller on PCI bus 00 dev 39
PIIX4: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:DMA, hdb:DMA
    ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:DMA, hdd:DMA
hda: ST38420A, ATA DISK drive
hdb: Pioneer CD-ROM ATAPI Model DR-A12X 0100, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
hda: ST38420A, 8223MB w/512kB Cache, CHS=1048/255/63
hdb: ATAPI 12X CD-ROM drive, 128kB Cache
Uniform CDROM driver Revision: 2.54
floppy0: no floppy controllers found
md driver 0.90.0 MAX_MD_DEVS=256, MAX_REAL=12
raid5: measuring checksumming speed
raid5: using high-speed MMX checksum routine
   pII_mmx   :   813.054 MB/sec
   p5_mmx    :   787.908 MB/sec
   8regs     :   576.072 MB/sec
   32regs    :   413.766 MB/sec
using fastest function: pII_mmx (813.054 MB/sec)
scsi : 0 hosts.
scsi : detected total.
md.c: sizeof(mdp_super_t) = 4096
Partition check:
 hda: hda1 hda2 < hda5 hda6 hda7 hda8 hda9 >
autodetecting RAID arrays
autorun ...
... autorun DONE.
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 60k freed
Adding Swap: 72256k swap-space (priority -1)
3c59x.c:v0.99H 11/17/98 Donald Becker 
http://cesdis.gsfc.nasa.gov/linux/drivers/vortex.html
eth0: 3Com 3c905B Cyclone 100baseTx at 0xe400,  00:50:04:35:47:48, IRQ 10
  Internal config register is 1800000, transceivers 0xa.
  8K byte-wide RAM 5:3 Rx:Tx split, autoselect/Autonegotiate interface.
  MII transceiver found at address 24, status 786d.
  MII transceiver found at address 0, status 786d.
  Enabling bus-master transmits and whole-frame receives.
eth1: 3Com 3c905B Cyclone 100baseTx at 0xe800,  00:50:04:35:44:e8, IRQ 11
  Internal config register is 1800000, transceivers 0xa.
  8K byte-wide RAM 5:3 Rx:Tx split, autoselect/Autonegotiate interface.
  MII transceiver found at address 24, status 786d.
  MII transceiver found at address 0, status 786d.
  Enabling bus-master transmits and whole-frame receives.
eth0: Initial media type Autonegotiate.
eth0: MII #24 status 786d, link partner capability 0020, setting half-duplex.
eth0: vortex_open() InternalConfig 01800000.
eth0: vortex_open() irq 10 media status 8080.
eth1: Initial media type Autonegotiate.
eth1: MII #24 status 786d, link partner capability 41e1, setting full-duplex.
eth1: vortex_open() InternalConfig 01800000.
eth1: vortex_open() irq 11 media status 8080.
eth0: Media selection timer tick happened, Autonegotiate.
eth0: MII transceiver has status 7869.
eth1: Media selection timer tick happened, Autonegotiate.
eth1: MII transceiver has status 7869.
Installing knfsd (copyright (C) 1996 okir@monad.swb.de).
nfsd_init: initialized fhcache, entries=256
CSLIP: code copyright 1989 Regents of the University of California
SLIP: version 0.8.4-NET3.019-NEWTTY-MODULAR (dynamic channels, max=256) (6 bit encapsulation enabled).
SLIP linefill/keepalive option.
cat uses obsolete /proc/pci interface
::::::::::::::
interrupts
::::::::::::::
           CPU0       
  0:      87868          XT-PIC  timer
  1:        933          XT-PIC  keyboard
  2:          0          XT-PIC  cascade
  8:          2          XT-PIC  rtc
 10:       1598          XT-PIC  eth0
 11:        441          XT-PIC  eth1
 13:          1          XT-PIC  fpu
 14:     654584          XT-PIC  ide0
NMI:          0
::::::::::::::
ioports
::::::::::::::
0000-001f : dma1
0020-003f : pic1
0040-005f : timer
0060-006f : keyboard
0070-007f : rtc
0080-008f : dma page reg
00a0-00bf : pic2
00c0-00df : dma2
00f0-00ff : fpu
01f0-01f7 : ide0
03c0-03df : vga+
03f6-03f6 : ide0
03f8-03ff : serial(auto)
e400-e47f : eth0
e800-e87f : eth1
f000-f007 : ide0
f008-f00f : ide1
::::::::::::::
modules
::::::::::::::
slip                    7636   2 (autoclean)
slhc                    4392   1 (autoclean) [slip]
nfsd                  151576   8 (autoclean)
lockd                  31208   1 (autoclean) [nfsd]
sunrpc                 52420   1 (autoclean) [nfsd lockd]
3c59x                  18472   2 (autoclean)
::::::::::::::
pci
::::::::::::::
PCI devices found:
  Bus  0, device   0, function  0:
    Host bridge: Intel 440BX - 82443BX Host (rev 2).
      Medium devsel.  Master Capable.  Latency=64.  
      Prefetchable 32 bit memory at 0xe0000000 [0xe0000008].
  Bus  0, device   1, function  0:
    PCI bridge: Intel 440BX - 82443BX AGP (rev 2).
      Medium devsel.  Master Capable.  Latency=64.  Min Gnt=128.
  Bus  0, device   7, function  0:
    ISA bridge: Intel 82371AB PIIX4 ISA (rev 2).
      Medium devsel.  Fast back-to-back capable.  Master Capable.  No bursts.  
  Bus  0, device   7, function  1:
    IDE interface: Intel 82371AB PIIX4 IDE (rev 1).
      Medium devsel.  Fast back-to-back capable.  Master Capable.  Latency=64.  
      I/O at 0xf000 [0xf001].
  Bus  0, device   7, function  2:
    USB Controller: Intel 82371AB PIIX4 USB (rev 1).
      Medium devsel.  Fast back-to-back capable.  Master Capable.  Latency=64.  
      I/O at 0xe000 [0xe001].
  Bus  0, device   7, function  3:
    Bridge: Intel 82371AB PIIX4 ACPI (rev 2).
      Medium devsel.  Fast back-to-back capable.  
  Bus  0, device  13, function  0:
    Ethernet controller: 3Com 3C905B 100bTX (rev 48).
      Medium devsel.  IRQ 10.  Master Capable.  Latency=64.  Min Gnt=10.Max Lat=10.
      I/O at 0xe400 [0xe401].
      Non-prefetchable 32 bit memory at 0xea001000 [0xea001000].
  Bus  0, device  15, function  0:
    Ethernet controller: 3Com 3C905B 100bTX (rev 48).
      Medium devsel.  IRQ 11.  Master Capable.  Latency=64.  Min Gnt=10.Max Lat=10.
      I/O at 0xe800 [0xe801].
      Non-prefetchable 32 bit memory at 0xea000000 [0xea000000].
  Bus  0, device  17, function  0:
    VGA compatible controller: Matrox Mystique (rev 3).
      Medium devsel.  Fast back-to-back capable.  Master Capable.  Latency=64.  
      Prefetchable 32 bit memory at 0xe6000000 [0xe6000008].
      Non-prefetchable 32 bit memory at 0xe7000000 [0xe7000000].
      Non-prefetchable 32 bit memory at 0xe8000000 [0xe8000000].