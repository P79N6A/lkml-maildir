Date: Mon, 07 Nov 2005 00:58:10 -0200
From: 	mchehab@brturbo ...
Subject: [Patch 15/20] V4L(916) Fixes set scart parameter definitions and audout ioctl
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/11/6/196

From: Mauro Carvalho Chehab <mchehab@brturbo.com.br>
- Fixes set_scart parameter definitions and AUDOUT ioctl
Signed-off-by: Mauro Carvalho Chehab <mchehab@brturbo.com.br>
-----------------
diff -upNr oldtree/drivers/media/video/msp3400.c linux/drivers/media/video/msp3400.c
--- oldtree/drivers/media/video/msp3400.c	2005-11-06 16:13:22.000000000 -0200
+++ linux/drivers/media/video/msp3400.c	2005-11-06 16:13:23.000000000 -0200
@@ -417,7 +417,7 @@ static void msp3400c_set_scart(struct i2
 
 	msp->in_scart=in;
 
-	if (in<=2) {
+	if (in >= 1 && in <= 8 && out >= 0 && out <= 2) {
 		if (-1 == scarts[out][in])
 			return;
 
@@ -2128,10 +2128,11 @@ static int msp_command(struct i2c_client
 	case VIDIOC_G_AUDOUT:
 	{
 		struct v4l2_audioout *a=(struct v4l2_audioout *)arg;
+		int idx=a->index;
 
 		memset(a,0,sizeof(*a));
 
-		switch (a->index) {
+		switch (idx) {
 		case 0:
 			strcpy(a->name,"Scart1 Out");
 			break;
@@ -2160,8 +2161,8 @@ static int msp_command(struct i2c_client
 			else
 				msp->i2s_mode=0;
 		}
-printk("Setting audio out on msp34xx to input %i, mode %i\n",a->index,msp->i2s_mode);
-		msp3400c_set_scart(client,msp->in_scart,a->index);
+		dprintk("Setting audio out on msp34xx to input %i, mode %i\n",a->index,msp->i2s_mode);
+		msp3400c_set_scart(client,msp->in_scart,a->index+1);
 
 		break;
 	}
_______________________________________________________ 
Yahoo! Acesso Grátis: Internet rápida e grátis. 
Instale o discador agora!
http://br.acesso.yahoo.com/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/