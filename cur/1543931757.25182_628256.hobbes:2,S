Date: Fri, 14 Dec 2007 11:23:56 -0800 (PST)
From: David Miller <>
Subject: Re: [PATCH] AS apple talk protocol register_snap_client failed
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/14/289

From: "guanxun mu" <lyxmoo@gmail.com>
Date: Fri, 14 Dec 2007 14:03:05 +0800
> [PACTH APPLETALK]
> 
> This patch update proto_init process when register_snap_client failed
> 
> Signed-off-by: Michale Moore <lyxmoo@gmail.com>
> 
> diff --git a/net/appletalk/aarp.c b/net/appletalk/aarp.c
> index 6c5c6dc..d6573f6 100644
> --- a/net/appletalk/aarp.c
> +++ b/net/appletalk/aarp.c
> @@ -873,7 +873,10 @@ void __init aarp_proto_init(void)
>  {
>         aarp_dl = register_snap_client(aarp_snap_id, aarp_rcv);
>         if (!aarp_dl)
> -               printk(KERN_CRIT "Unable to register AARP with SNAP.\n");
> +       {
> +               printk(KERN_CRIT "Unable to register AARP with SNAP.\n");
> +               return;
> +       }
>         init_timer(&aarp_timer);
>         aarp_timer.function = aarp_expire_timeout;
>         aarp_timer.data     = 0;
Wrong coding style, the openning brace should be on the same line
as the if() check, see Documentation/CodingStyle   Your email
client has also corrupted the tab characters into spaces, making
the patch unusable even if it were correct.
Next, if you are going to do this, you should modify aarp_proto_init()
to return error values, so that atalk_init() can see it and thus
undo the initialization it does and return an error for the module
load.
It is not useful to add error checks, without propagating them,
because an OOPS is just as good as a partially-initialized protocol
since that is likely to crash or malfunction as well.
The protocol is thus equally broken before and after your changes.
Please completely implement this fix, thank you.