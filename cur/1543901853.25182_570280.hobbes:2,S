Date: Tue, 17 Jul 2007 13:01:14 +0800
From: Ian Kent <>
Subject: Re: [patch] CFS scheduler, -v19
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/7/17/15

On Mon, 2007-07-16 at 23:55 +0200, Ingo Molnar wrote:
> * Chuck Ebbert <cebbert@redhat.com> wrote:
> 
> > On 07/13/2007 05:19 PM, Bill Davidsen wrote:
> > > 
> > > I should really go back to 2.6.21.6, 2.6.22 has many bizarre behaviors
> > > with FC6. Automount starts taking 30% of CPU (unused at the moment)
> > 
> > Can you confirm whether CFS is involved, i.e. does it spin like that 
> > even without the CFS patch applied?
> 
> hmmm .... could you take out the kernel/time.c (sys_time()) changes from 
> the CFS patch, does that solve the automount issue? If yes, could 
> someone take a look at automount and check whether it makes use of 
> time(2) and whether it combines it with finer grained time sources?
Yes it does and I have two reported bugs so far.
In several places I have code similar to:
wait.tv_sec = time(NULL) + 1;
wait.tv_nsec = 0;
signaled = 0;
while (!signaled) {
        status = pthread_cond_timedwait(&cond, &mutex, &wait);
       if (status) {
             if (status == ETIMEDOUT)
                  break;
             fatal(status);
      }
}
lead to automount spinning with strace output a bit like:
futex(0x80034b60, FUTEX_WAKE, 1)  = 0
clock_gettime(CLOCK_REALTIME, {1184593936, 130925919}) = 0
time(NULL)                        = 1184593935
futex(0x80034b60, FUTEX_WAKE, 1)  = 0
clock_gettime(CLOCK_REALTIME, {1184593936, 131160876}) = 0
time(NULL)                        = 1184593935
futex(0x80034b60, FUTEX_WAKE, 1)  = 0
clock_gettime(CLOCK_REALTIME, {1184593936, 131377080}) = 0
time(NULL)                        = 1184593935
futex(0x80034b60, FUTEX_WAKE, 1)  = 0
clock_gettime(CLOCK_REALTIME, {1184593936, 131593297}) = 0
time(NULL)                        = 1184593935
futex(0x80034b60, FUTEX_WAKE, 1)  = 0
clock_gettime(CLOCK_REALTIME, {1184593936, 131871792}) = 0
There should be something like:
futex(0x5555557868c4, FUTEX_WAIT, 5321099, {0, 998091311}) = -1 ETIMEDOUT (Connection timed out)
in there I think.
Ian
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/