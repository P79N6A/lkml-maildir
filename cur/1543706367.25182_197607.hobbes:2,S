Date: Tue, 10 Feb 2004 11:49:16 -0500
From: Chris Friesen <>
Subject: question on pivot_root and kernel threads
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/2/10/114

I've got an embedded system that we're trying to move from 2.4.18 to 
2.4.22 (which involves a userspace upgrade as well).  It netboots with 
an initrd, and then at startup converts it to a tmpfs, unmounts the 
original ramdisk, and frees the memory.
With 2.4.22 suddenly it started complaining about being unable to 
unmount the original ramdisk.  After some digging, it seems that the 
kernel threads (keventd, ksoftirqd_CPU0, kswapd, bdflush, kupdated, and 
mtdblockd) are starting up with stdin/stdout/stderr set to /dev/console 
in the original ramdisk.  When I do the pivot_root so that the original 
ramdisk is mounted at "/mnt", I end up with a bunch of references to 
"/mnt/dev/console", and I can't unmount "/mnt" since the refcount is 
nonzero.
At a guess, its related to this thread:
http://groups.google.com/groups?hl=en&lr=&ie=UTF-8&selm=hpYn.1fz.21
%40gated-at.bofh.it
Did this ever get resolved properly?
Thanks,
Chris
-- 
Chris Friesen                    | MailStop: 043/33/F10
Nortel Networks                  | work: (613) 765-0557
3500 Carling Avenue              | fax:  (613) 765-2986
Nepean, ON K2H 8E9 Canada        | email: cfriesen@nortelnetworks.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/