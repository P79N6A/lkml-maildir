Date: Wed, 21 Feb 2007 19:18:51 +0100
From: Thomas Gleixner <>
Subject: Re: Linux 2.6.21-rc1
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/2/21/251

On Wed, 2007-02-21 at 09:38 -0800, Daniel Walker wrote:
> > > 
> > > Could be the switch over then which confuses the NMI . 
> > 
> > Why? The switch just stops the PIT/HPET. It does not fiddle with IO_APIC
> > and friends at all.
> 
> I'm not an expert on the io-apic, but the check_timer() function seemed
> to assume IRQ0 was happening regularly ..
Again: 
check_timer() is called _BEFORE_ we even touch the local APIC timers. At
this point PIT/HPET _IS_ firing IRQ0 with HZ frequency.
> Well, I'm pretty sure it's HRT, cause in prior versions this only
> happened when HRT is enabled. Then you guys went to the lapic all the
> time, and now this is happening all the time ..
The NMI is stuck:
                if (nmi_count(cpu) - prev_nmi_count[cpu] <= 5) {
                        printk("CPU#%d: NMI appears to be stuck (%d->%d)!\n",
                                cpu,
                                prev_nmi_count[cpu],
                                nmi_count(cpu));
This has nothing to do with jiffies.
There have been a bunch of changes in arch/i386/kernel/nmi.c as well. 
> You can't reproduce this?
Nope.
Also all my machines emit something like:
"ACPI: LAPIC_NMI (acpi_id[0x00] dfl dfl lint[0x1])"
In your boot log nothing to see.
	tglx
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/