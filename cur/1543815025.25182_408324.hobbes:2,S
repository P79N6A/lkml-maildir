Date: Mon, 20 Mar 2006 14:02:32 +0100
From: Sander <>
Subject: RAID5 grow success  (was: Re: 2.6.16-rc6-mm2)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/3/20/105

Andrew Morton wrote (ao):
> - Lots of MD and DM updates
I would like to report that growing an online raid5 device works like a
charm:
mdadm --version
mdadm - v2.4-pre1 - Not For Production Use - 20 March 2006
mdadm -C -l5 -n3 /dev/md0 /dev/sda1 /dev/sdb1 /dev/sdc1
While performing:
for i in `seq 4`
do dd if=/dev/zero of=bigfile.$i bs=1024k count=10000
done
md5sum bigfile.*
I do:
mdadm /dev/md0 -a /dev/sdd1
mdadm --grow /dev/md0 --raid-disks=4
When the dd and md5sum finishes, I umount and:
e2fsck -f /dev/md0
resize2fs -p /dev/md0
After mounting again the disk indeed is bigger, and the md5sum still
matches.
FWIW, I now try to add four more spares at once, and grow the raid5
again. It seems to work:
# mdadm /dev/md0 -a /dev/sde1 /dev/sdf1 /dev/sdg1 /dev/sdh1
mdadm: added /dev/sde1
mdadm: added /dev/sdf1
mdadm: added /dev/sdg1
mdadm: added /dev/sdh1
# mdadm --grow /dev/md0 --raid-disks=8
mdadm: Need to backup 448K of critical section..
mdadm: ... critical section passed.
#
It is still reshapeing ATM.
Thanks!
	Sander
-- 
Humilis IT Services and Solutions
http://www.humilis.net
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/