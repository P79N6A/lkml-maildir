Date: Thu, 1 Apr 2004 10:43:49 -0500
From: "Robert W. Maloy" <>
Subject: Possible error in fs/buffer.c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/4/1/123

	While code surfing I found what appears to be a problem with the 
following code in fs/buffer.c {function mark_buffer_inode_dirty}: 
       if (list_empty(&bh->b_assoc_buffers))
                buffer_insert_list(&buffer_mapping->private_lock,
                                bh, &mapping->private_list);
	From my research, the job of buffer_insert_list is to place the list 
contents of bh->b_assoc_buffers onto the list mapping->private list. 
The above code segment will only call buffer_insert_list if 
b_assoc_buffers is empty. Why waste the time, and resources 
attempting to add an empty list to the end of private_list?
	If this is a problem, then there are two possibilities for fixing 
this code: 
    1) This was just a mistake
	add "!" in the if, this only adds the list if there is 
        something to add.
		- if (list_empty(&bh->b_assoc_buffers))
		+ if (!list_empty(&bh->b_assoc_buffers))
    2) Some of the assoc buffers may already be on the private_list. 
If this is a possibility then this routine will need more work.
	
Please CC me on all responses since I am not a member of this list.
-- 
Cheers
Rob Maloy
r.w.maloy@acm.org
(410) 854-6637
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/