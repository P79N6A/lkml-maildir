Date: Wed, 31 Jan 2007 21:42:48 +1100
From: Bron Gondwana <>
Subject: Reiserfs and MMAP (was: How many people are using 2.6.16?)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/1/31/70

On Wed, Jan 31, 2007 at 08:02:37AM +0100, Adrian Bunk wrote:
> reiserfs:
> commit de14569f94513279e3d44d9571a421e9da1759ae
>   [PATCH] resierfs: avoid tail packing if an inode was ever mmapped
> backport to 2.6.16 required
Which would explain the "notail" I've been careful to cargo-cult
into every mount string since I started at this job, even though
we're storing mainly very small files.
Referring back to: <43BE1EDF.3010305@namesys.com> (which went
to reiserfs-dev and a couple of the ever-growing CC list above)
we're still not 100% sure if it's safe to remove the patch that
I attached there:
>>>>--- file.c~ 2004-10-02 12:29:33.223660850 +0400
>>>>+++ file.c 2004-10-08 10:03:03.001561661 +0400
>>>>@@ -1137,6 +1137,8 @@
>>>>return result;
>>>>  }
>>>>
>>>>+    return generic_file_write(file, buf, count, ppos);
>>>>+
>>>>  if ( unlikely((ssize_t) count < 0 ))
>>>>      return -EINVAL;
which Hans asserted was about 5% slower than the resierfs custom
write implementation, but we countered at least meant that we
didn't crash in a steaming pile of processes stuck in D state
with no way out every few days.
It doesn't apply against 2.6.19 any more, which may be a good
sign.  I haven't seen anything in the changelogs that jumped
out at me as the fix though.
Regards,
Bron.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/