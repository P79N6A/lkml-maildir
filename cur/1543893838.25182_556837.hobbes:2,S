Date: Thu, 14 Jun 2007 02:00:39 +0800
From: Wang Zhenyu <>
Subject: Re: I815 suddenly unkown to agpgart?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/13/191

On 2007.06.13 12:15:13 +0000, Dave Jones wrote:
>  >     [AGPGART] intel_agp: use table for device probe
>  >     
> Oh, we have this check in find_gmch ..
> 
>         if (gmch_device && PCI_FUNC(gmch_device->devfn) != 0) {
>                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> 
> Which isn't going to work, as Meelis has a gmch on device0, slot0, devfn1.
> Meelis, does it start working again if you change that to just
> 
> 	if (gmch_Device) {
No, the problem for i815 is that it has a config with no integrated gfx.
Sorry I missed it. Meelis, pls test with this patch, which adds a table 
item for this, and fixes wrong driver order within origin i815 driver with IGD.
Thanks.
---
diff --git a/drivers/char/agp/intel-agp.c b/drivers/char/agp/intel-agp.c
index d383168..6d50a37 100644
--- a/drivers/char/agp/intel-agp.c
+++ b/drivers/char/agp/intel-agp.c
@@ -1824,7 +1824,8 @@ static const struct intel_driver_description {
 	{ PCI_DEVICE_ID_INTEL_82810E_MC, PCI_DEVICE_ID_INTEL_82810E_IG, "i810",
 		NULL, &intel_810_driver },
 	{ PCI_DEVICE_ID_INTEL_82815_MC, PCI_DEVICE_ID_INTEL_82815_CGC, "i815",
-		&intel_810_driver, &intel_815_driver },
+		&intel_815_driver, &intel_810_driver },
+	{ PCI_DEVICE_ID_INTEL_82815_MC, 0, "i815", &intel_815_driver, NULL },
 	{ PCI_DEVICE_ID_INTEL_82820_HB, 0, "i820", &intel_820_driver, NULL },
 	{ PCI_DEVICE_ID_INTEL_82820_UP_HB, 0, "i820", &intel_820_driver, NULL },
 	{ PCI_DEVICE_ID_INTEL_82830_HB, PCI_DEVICE_ID_INTEL_82830_CGC, "830M",
---	 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/