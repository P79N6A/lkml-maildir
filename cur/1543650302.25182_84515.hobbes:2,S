Date: Tue, 29 Oct 2002 12:21:08 +0100
From: Florian Lohoff <>
Subject: [PATCH] radeonfb aggregated LY/LZ 8MB + ia64 void * vs u32
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/29/54

Hi,
this is an aggregated patch of 2 i found by google - With the M6 8MB
fix i got my Picturebook to work. The other one just looks like it makes
sense and does not harm my usage. I vote for inclusion into 2.4.x and
probably 2.5 as others already did.
This is the Radeon 8MB fix by :
http://www.uwsg.iu.edu/hypermail/linux/kernel/0207.2/0281.html
The void ptr vs u32 fix can be found here by David Mosberger:
https://external-lists.vasoftware.com/archives/linux-ia64/2002-July/003663.html
--- linux-2.4.19/drivers/video/radeonfb.c	Sat Aug  3 02:39:45 2002
+++ linux-2.4.19.flo/drivers/video/radeonfb.c	Thu Oct 24 22:35:36 2002
@@ -258,8 +258,8 @@
 	u32 mmio_base_phys;
 	u32 fb_base_phys;
 
-	u32 mmio_base;
-	u32 fb_base;
+	void *mmio_base;
+	void *fb_base;
 
 	struct pci_dev *pdev;
 
@@ -800,7 +800,7 @@
 	}
 
 	/* map the regions */
-	rinfo->mmio_base = (u32) ioremap (rinfo->mmio_base_phys,
+	rinfo->mmio_base = ioremap (rinfo->mmio_base_phys,
 				    		    RADEON_REGSIZE);
 	if (!rinfo->mmio_base) {
 		printk ("radeonfb: cannot map MMIO\n");
@@ -866,6 +866,13 @@
 	/* mem size is bits [28:0], mask off the rest */
 	rinfo->video_ram = tmp & CONFIG_MEMSIZE_MASK;
 
+	if (rinfo->video_ram == 0 &&
+		(pdev->device == PCI_DEVICE_ID_RADEON_LY ||
+		pdev->device == PCI_DEVICE_ID_RADEON_LZ)) {
+
+		rinfo->video_ram = 8192*1024;
+	}
+
 	/* ram type */
 	tmp = INREG(MEM_SDRAM_MODE_REG);
 	switch ((MEM_CFG_TYPE & tmp) >> 30) {
@@ -947,7 +954,7 @@
 		}
 	}
 
-	rinfo->fb_base = (u32) ioremap (rinfo->fb_base_phys,
+	rinfo->fb_base = ioremap (rinfo->fb_base_phys,
 				  		  rinfo->video_ram);
 	if (!rinfo->fb_base) {
 		printk ("radeonfb: cannot map FB\n");
Flo
-- 
Florian Lohoff                  flo@rfc822.org             +49-5201-669912
                        Heisenberg may have been here.
[unhandled content-type:application/pgp-signature]