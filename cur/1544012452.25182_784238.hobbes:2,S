Date: Fri, 26 Dec 2008 14:42:03 -0500
From: Rik van Riel <>
Subject: Re: BUG or virtualbox issue?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/26/164

Udo van den Heuvel wrote:
> Hello,
> 
> Just started virtualbox for the first time on x86_64 Phenom system; is 
> this a kernel issue or something for the VirtualBox people?
> 
> Dec 26 12:20:01 surfplank2 kernel: BUG: using smp_processor_id() in 
> preemptible [00000000] code: VirtualBox/26774
> Dec 26 12:20:01 surfplank2 kernel: caller is RTMpCpuId+0x9/0x10 [vboxdrv]
> Dec 26 12:20:01 surfplank2 kernel: Pid: 26774, comm: VirtualBox Not 
> tainted 2.6.28 #3
Looks like the virtualbox code forgot to switch off
preemption before calling smp_processor_id().
This is broken, because the thread could get de-scheduled
and re-scheduled onto another CPU, which means the code
could end up using the wrong smp processor ID.
-- 
All rights reversed.