Date: Fri, 21 Mar 2003 16:43:57 +0900
From: Osamu Tomita <>
Subject: Re: [PATCH] PC-9800 subarch. support for 2.5.64-ac3 (16/20) SCSI
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/3/21/30

Aplogize for slow respnse.
Geert Uytterhoeven wrote:
> 
> On Sun, 9 Mar 2003, Osamu Tomita wrote:
> > This is the patch to support NEC PC-9800 subarchitecture
> > against 2.5.64-ac3. (16/20)
> >
> > SCSI host adapter support.
> >  - BIOS parameter change for PC98.
> >  - Add pc980155 driver for old PC98.
> >  - wd33c93.h register address size to int, because PC-9801-55 mapped 0xcc0.
[snip]
> > +static int pc980155_abort(Scsi_Cmnd *cmd)
> > +{
> > +     if (wd33c93_abort(cmd) == SCSI_ABORT_SUCCESS)
> > +             return SUCCESS;
> > +
> > +     return FAILED;
> > +}
> 
> The abort handler is generic. Hence it can be moved to wd33c93.c, so the other
> wd33c93 drivers (my main interest :-) can use it.
I posted patch to merge into wd33c93.c aginst 2.5.65-ac1.
> > +static int pc980155_bus_reset(Scsi_Cmnd *cmd)
> > +{
> > +     struct WD33C93_hostdata *hostdata
> > +             = (struct WD33C93_hostdata *)cmd->device->host->hostdata;
> > +
> > +     pc980155_int_disable(hostdata->regs);
> > +     pc980155_assert_bus_reset(hostdata->regs);
> > +     udelay(50);
> > +     pc980155_negate_bus_reset(hostdata->regs);
> > +     (void) inb(*hostdata->regs.SASR);
> > +     (void) read_pc980155(hostdata->regs, WD_SCSI_STATUS);
> > +     pc980155_int_enable(hostdata->regs);
> > +     wd33c93_reset(cmd, 0);
> > +     return SUCCESS;
> > +}
> 
> Is there a generic (wd33c93) way to do this?
I'd been looking for better way. But It seems, standard WD33C93 has
no feature for control bus reset line. I think bus reset is board
specific.
> > +static int pc980155_host_reset(Scsi_Cmnd *cmd)
> > +{
> > +     wd33c93_reset(cmd, 0);
> > +     return SUCCESS;
> > +}
> 
> The host reset handler is generic, too.
Patch for PC-98 aginst 2.5.65-ac1 includes this too.
Thanks,
Osamu Tomita
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/