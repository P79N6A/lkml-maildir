Date: Fri, 20 Jan 2006 20:06:53 +0100
From: Jan Blunck <>
Subject: Re: [PATCH] Busy inodes after unmount, be more verbose in generic_shutdown_super
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/1/20/246

On Thu, Jan 19, Kirill Korotaev wrote:
> CPU 1				CPU 2
> ~~~~~				~~~~~
> umount /dev/sda1
> generic_shutdown_super          shrink_dcache_memory()
> shrink_dcache_parent            dput dentry
> select_parent                   prune_one_dentry()
>                                 <<<< child is dead, locks are released,
>                                   but parent is still referenced!!! >>>>
> skip dentry->parent,
> since it's d_count > 0
> 
> message: BUSY inodes after umount...
>                                 <<< parent is left on dentry_unused list,
>                                    referencing freed super block >>>
I see. The problem is that dcache_lock is given up before dereferencing the
parent. But your patch seems to be wrong anyway IMHO. I'll post patches in a
seperate thread.
Regards,
	Jan
-- 
Jan Blunck                                               jblunck@suse.de
SuSE LINUX AG - A Novell company
Maxfeldstr. 5                                          +49-911-74053-608
D-90409 NÃ¼rnberg                                      
http://www.suse.de
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/