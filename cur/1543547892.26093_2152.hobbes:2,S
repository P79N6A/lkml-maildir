Date: Wed, 6 Sep 2000 19:07:41 -0400 (EDT)
From: Byron Stanoszek <>
Subject: VIA IDE Driver Problems, test8-pre5 & 6.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/9/6/102

I'm having a problem with the new VIA IDE controller.
It initializes my drives correctly, then proceeds to start up the operating
system, gets to about crond, then the drive halts for about 30 seconds with its
light on solid. After 30 seconds, it says DMA timed out and disables DMA.
This does not happen on 2.4.0-test7, and DMA works like a charm.
Here's a boot log starting with IDE (and me hitting Alt+SysRq a couple of times):
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
VP_IDE: IDE controller on PCI bus 00 dev 39
VP_IDE: chipset revision 16
VP_IDE: not 100% native mode: will probe irqs later
VP_IDE: VIA vt82c686a IDE UDMA66 controller on pci0:7.1
    ide0: BM-DMA at 0xd000-0xd007, BIOS settings: hda:DMA, hdb:pio
    ide1: BM-DMA at 0xd008-0xd00f, BIOS settings: hdc:DMA, hdd:pio
hda: Maxtor 91303D6, ATA DISK drive
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
hdc: Pioneer DVD-ROM ATAPIModel DVD-115 0111, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
ide1 at 0x170-0x177,0x376 on irq 15
hda: 25450992 sectors (13031 MB) w/512KiB Cache, CHS=1584/255/63, UDMA(33)
hdc: ATAPI DVD-ROM drive, 512kB Cache, UDMA(33)
Uniform CD-ROM driver Revision: 3.11
Partition check:
 hda: hda1 hda2
Floppy drive(s): fd0 is 1.44M
FDC 0 is a post-1991 82077
udf: registering filesystem
Serial driver version 5.02 (2000-08-09) with MANY_PORTS SHARE_IRQ SERIAL_PCI ISAPNP enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
ttyS01 at 0x02f8 (irq = 3) is a 16550A
ttyS04 at port 0xec00 (irq = 5) is a 16550A
PPP generic driver version 2.4.1
PPP Deflate Compression module registered
PPP BSD Compression module registered
Linux agpgart interface v0.99 (c) Jeff Hartmann
agpgart: Maximum main memory to use for agp memory: 96M
agpgart: Detected Via Apollo Pro KX133 chipset
agpgart: AGP aperture is 32M @ 0xd0000000
[drm] AGP 0.99 on VIA Apollo KX133 @ 0xd0000000 32MB
[drm] Initialized mga 1.0.0 20000719 on minor 63
ISAPnP reports AWE64 WaveTable at i/o 0x620
<SoundBlaster EMU8000 (RAM12288k)>
Soundblaster audio driver Copyright (C) by Hannu
Savolainen 1993-1996
sb: Creative SB AWE64 PnP detected
sb: ISAPnP reports 'Creative SB AWE64 PnP' at i/o 0x220, irq 10, dma 1, 5
sb: 1 Soundblaster PnP card(s) found.
kmem_create: Forcing size word alignment - nfs_fh
VFS: Mounted root (ext2 filesystem) readonly.
named startup succeeded
sshd startup succeeded
EIP: 0010:[default_idle+35/48] EFLAGS: 00000246
EAX: 00000000 EBX: c0108740 ECX: c1258250 EDX: c1258250
ESI: c029c000 EDI: c0108740 EBP: 0008e000 DS: 0018 ES: 0018
CR0: 8005003b CR2: 4006ded0 CR3: 013f7000 CR4: 00000090
<30-second delay>
hda: timeout waiting for DMA
ide_dmaproc: chipset supported ide_dma_timeout func only: 14
hda: irq timeout: status=0x58 { DriveReady SeekComplete DataRequest }
hda: status timeout: status=0xd0 { Busy }
hda: DMA disabled
hda: drive not ready for command
ide0: reset: success
crond startup succeeded
...
- - -
With the old VIA driver, it did this:
Uniform Multi-Platform E-IDE driver Revision: 6.31
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
VP_IDE: IDE controller on PCI bus 00 dev 39
VP_IDE: chipset revision 16
VP_IDE: not 100% native mode: will probe irqs later
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
VT 8371
 Chipset Core ATA-66
Split FIFO Configuration:  8 Primary buffers, threshold = 1/2
                           8 Second. buffers, threshold = 1/2
    ide0: BM-DMA at 0xd000-0xd007, BIOS settings: hda:DMA, hdb:pio
ide0: VIA Bus-Master (U)DMA Timing Config Success
    ide1: BM-DMA at 0xd008-0xd00f, BIOS settings: hdc:DMA, hdd:pio
ide1: VIA Bus-Master (U)DMA Timing Config Success
hda: Maxtor 91303D6, ATA DISK drive
hdc: Pioneer DVD-ROM ATAPIModel DVD-115 0111, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
ide1 at 0x170-0x177,0x376 on irq 15
hda: 25450992 sectors (13031 MB) w/512KiB Cache, CHS=1584/255/63, UDMA(33)
hdc: ATAPI DVD-ROM drive, 512kB Cache, UDMA(33)
Uniform CD-ROM driver Revision: 3.11
Partition check:
 hda: hda1 hda2
and functioned pretty much normally.
Any ideas?
  -Byron
-- 
Byron Stanoszek                         Ph: (330) 644-3059
Systems Programmer                      Fax: (330) 644-8110
Commercial Timesharing Inc.             Email: bstanoszek@comtime.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at 
http://www.tux.org/lkml/