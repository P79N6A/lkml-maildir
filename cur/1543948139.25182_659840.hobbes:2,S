Date: Tue, 26 Feb 2008 11:27:19 +0100
From: Willy Tarreau <>
Subject: Re: PROBLEM: 2.4.36.1 hangs.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/26/121

On Tue, Feb 26, 2008 at 03:13:46AM -0700, dann frazier wrote:
> I'm now able to reliably reproduce it by creating/removing a chroot
> (pbuilder create on a Debian system, though I'm sure a simpler test
> exists). Correcting the le16_to_cpu placement as Glen described
> fixes the issue for me.
OK that's excellent news.
> > BTW, I notice that 2.6 also has one extra chunk that 2.4 does not
> > have :
> > 
> >                 if (unlikely(need_revalidate)) {
> > +                       if (offset) {
> >                                 offset = ext2_validate_entry(kaddr, offset, chunk_mask);
> > +                               filp->f_pos = (n<<PAGE_CACHE_SHIFT) + offset;
> > +                       }
> > +                       filp->f_version = inode->i_version;
> >                         need_revalidate = 0;
> >                 }
> > 
> > I have no idea whether this part is needed, we'd better ask Theo or Al
> > for some advices, as I'm not tempted by merging an uncertain patch when
> > it comes to filesystems.
> 
> Looks like a test case may be available:
> 
http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=2d7f2ea9c989853310c7f6e8be52cc090cc8e66b
Dann, would you care to ping Al about the opportunity to merge this entire
patch, as well as Masoud for his test-case ? The patch looks like all what
remains different between 2.4 and 2.6, so I would bet we need it too.
Thanks,
Willy