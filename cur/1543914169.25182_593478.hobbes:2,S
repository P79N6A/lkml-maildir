Date: Wed, 12 Sep 2007 02:00:35 -0400
From: Matt LaPlante <>
Subject: Re: Problem charging blackberry 8700c with berry_charge (2.6.22.6)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/9/12/12

On Mon, 10 Sep 2007 23:35:02 -0700
Greg KH <greg@kroah.com> wrote:
> 
> > Sep  9 13:49:01 prizm kernel: [  584.407498] drivers/usb/core/inode.c: creating file '003'
> > Sep  9 13:49:01 prizm kernel: [  584.407509] hub 5-0:1.0: state 7 ports 8 chg 0000 evt 0004
> > Sep  9 13:49:01 prizm kernel: [  584.407520] hub 1-0:1.0: state 7 ports 2 chg 0000 evt 0004
> > Sep  9 13:49:03 prizm kernel: [  586.405512] usb 1-2: usb auto-suspend
> > Sep  9 13:49:03 prizm kernel: [  586.421471] hub 5-0:1.0: hub_suspend
> > Sep  9 13:49:03 prizm kernel: [  586.421481] ehci_hcd 0000:00:10.4: suspend root hub
> > Sep  9 13:49:03 prizm kernel: [  586.421496] usb usb5: usb auto-suspend
> > Sep  9 13:49:05 prizm kernel: [  588.421351] hub 1-0:1.0: hub_suspend
> > Sep  9 13:49:05 prizm kernel: [  588.421361] usb usb1: suspend_rh
> > Sep  9 13:49:05 prizm kernel: [  588.421481] usb usb1: usb auto-suspend
> 
> Ah, oh wait, now we just turned the power off.
> 
> Try disabling CONFIG_USB_SUSPEND and see if that fixes this issue.  Or
> you can manually turn the power back on to your blackberry by writing to
> the autosuspend file for the usb device in sysfs, but that can be a
> pain.
> 
> Let me know if just changing that config option works for you.
> 
And now for the dramatic conclusion...
To begin, I have no access to the original machine at the moment, as I'm now out of that area for a couple weeks.  I built a similar kernel (same version) on another box that I have at my current location.  The new machine is different hardware, so some kernel re-configuring was required, but I kept with the same USB settings (and similar overall design).  Interestingly, this machine didn't reproduce the "magic command failed" error, but it did fail very similarly to the original at charging the device.  I disabled CONFIG_USB_SUSPEND as suggested, and lo and behold, it now charges the berry.  Looks like an excellent diagnosis to me, doctor.  
Thanks! :)
> thanks,
> 
> greg k-h
-- 
Matt
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/