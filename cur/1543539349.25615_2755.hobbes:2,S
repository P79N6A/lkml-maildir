Date: Thu, 20 Jul 2000 21:23:33 +0200 (MET DST)
From: Mikael Pettersson <>
Subject: [PATCH] allow emu10k1 as non-module in 2.2.17pre
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/7/20/86

Recent 2.2.17pre include the emu10k1 sound driver. Cool.
Unfortunately it only works as a module. The following
trivial patch allows it to also work as a non-module by
having sound_core initialise it.
/Mikael
--- linux-2.2.17pre13/drivers/sound/emu10k1/main.c.orig	Mon Jul 17 00:16:59 2000
+++ linux-2.2.17pre13/drivers/sound/emu10k1/main.c	Mon Jul 17 00:24:41 2000
@@ -768,3 +768,10 @@
 
 module_init(emu10k1_init_module);
 module_exit(emu10k1_cleanup_module);
+
+#ifndef MODULE
+int __init init_emu10k1(void)
+{
+	return emu10k1_init_module();
+}
+#endif
--- linux-2.2.17pre13/drivers/sound/sound_core.c.orig	Mon Jul 17 00:16:59 2000
+++ linux-2.2.17pre13/drivers/sound/sound_core.c	Mon Jul 17 00:24:41 2000
@@ -85,6 +85,9 @@
 #ifdef CONFIG_SOUND_FUSION
 extern int cs_probe(void);
 #endif
+#ifdef CONFIG_SOUND_EMU10K1
+extern int init_emu10k1(void);
+#endif
 
 /*
  *	Low level list operator. Scan the ordered list, find a hole and
@@ -448,6 +451,9 @@
 #endif
 #ifdef CONFIG_SOUND_FUSION
 	cs_probe();
+#endif
+#ifdef CONFIG_SOUND_EMU10K1
+	init_emu10k1();
 #endif
 	return 0;
 }
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/