Date: Sun, 6 Jun 2004 07:26:15 +0200
From: Ingo Molnar <>
Subject: Re: WINE + NX (No eXecute) support for x86, 2.6.7-rc2-bk2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/6/6/5

* Mike McCormack <mike@codeweavers.com> wrote:
> Fedore Code 1's exec-shield patch broke Wine badly, as there was no
> way for an application to turn it off from user space, and Wine
> depended upon certain areas of virtual memory being free.
there are multiple methods in FC1 to turn this off:
- FC1 has PT_GNU_STACK support and all binaries that have no
  PT_GNU_STACK program header will have the stock Linux VM layout. 
  (including executable stack/heap) So by stripping the PT_GNU_STACK 
  header from the wine binary you get this effect.
- you get the same effect by setting the personality to PER_LINUX32 via:
	personality(PER_LINUX32);
  this is a NOP on stock x86 Linux, and turns off exec-shield on FC1.
all these methods were present in FC1 from day 1 on. In fact we
specifically targetted Wine (and similar applications) with these
methods to make it easy for them to be built under FC1. (of course
existing binaries of Wine worked and work fine because they dont have
PT_GNU_STACK.)
> We developed a hack to work around this problem by creating a staticly
> linked binary to reserve memory then load ld-linux.so.2 and a
> dynamically executable into memory manually and run start them.
while this should work too - why not one of the methods above?
	Ingo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/