Date: Fri, 02 May 2008 14:37:02 +0200
From: Mike Galbraith <>
Subject: Re: Horrendous Audio Stutter - current git
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/5/2/172

On Fri, 2008-05-02 at 08:21 -0400, Parag Warudkar wrote:
> On Fri, May 2, 2008 at 8:09 AM, Mike Galbraith <efault@gmx.de> wrote:
> >  Hm.  I've stumbled across a regression that may be related.  Can you
> >  please try the attached with group scheduling enabled in current git?
> 
> In file included from kernel/sched.c:1902:
> kernel/sched_fair.c: In function 'print_cfs_rq_tasks':
> kernel/sched_fair.c:1602: error: implicit declaration of function
> 'calc_delta_weight'
> kernel/sched_fair.c:1603: warning: format '%lu' expects type 'long
> unsigned int', but argument 5 has type 'int'
> make[1]: *** [kernel/sched.o] Error 1
> make: *** [kernel] Error 2
> 
> 'calc_delta_weight' or a replacement not found easily to fix it up!
Oops, I have an unrelated patch in my tree which you also need.
	-Mike
commit 7ba2e74ab5a0518bc953042952dd165724bc70c9
Author: Peter Zijlstra <a.p.zijlstra@chello.nl>
Date:   Sat Apr 19 19:45:00 2008 +0200
    sched: debug: show a weight tree
    Print a tree of weights.
    Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>
Index: linux-2.6.26.git/kernel/sched_fair.c
===================================================================
--- linux-2.6.26.git.orig/kernel/sched_fair.c
+++ linux-2.6.26.git/kernel/sched_fair.c
@@ -1611,30 +1611,6 @@ static const struct sched_class fair_sch
 };
 
 #ifdef CONFIG_SCHED_DEBUG
-static void
-print_cfs_rq_tasks(struct seq_file *m, struct cfs_rq *cfs_rq, int depth)
-{
-	struct sched_entity *se;
-
-	if (!cfs_rq)
-		return;
-
-	list_for_each_entry_rcu(se, &cfs_rq->tasks, group_node) {
-		int i;
-
-		for (i = depth; i; i--)
-			seq_puts(m, "  ");
-
-		seq_printf(m, "%lu %s %lu\n",
-				se->load.weight,
-				entity_is_task(se) ? "T" : "G",
-				calc_delta_weight(SCHED_LOAD_SCALE, se)
-				);
-		if (!entity_is_task(se))
-			print_cfs_rq_tasks(m, group_cfs_rq(se), depth + 1);
-	}
-}
-
 static void print_cfs_stats(struct seq_file *m, int cpu)
 {
 	struct cfs_rq *cfs_rq;
@@ -1642,9 +1618,6 @@ static void print_cfs_stats(struct seq_f
 	rcu_read_lock();
 	for_each_leaf_cfs_rq(cpu_rq(cpu), cfs_rq)
 		print_cfs_rq(m, cpu, cfs_rq);
-
-	seq_printf(m, "\nWeight tree:\n");
-	print_cfs_rq_tasks(m, &cpu_rq(cpu)->cfs, 1);
 	rcu_read_unlock();
 }
 #endif