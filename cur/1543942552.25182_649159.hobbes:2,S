Date: Wed, 6 Feb 2008 10:13:39 -0800 (PST)
From: 	kerndev@sc-softw ...
Subject: Bug: 2.6.24-smp: Eeek! page_mapcount(page) went negative! (-1)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/6/212

Hi,
I have recently had a couple of seemingly hard hangs requiring reboot by 
reset button. I could not ping the box.
Until now, the console log (log level 7) was empty/normal...
This morning I finally seem to have found out what the failures are...
an rmap bug for real mem > 4G...
First, some info on my system...
Kernel 2.6.24 SMP on AMD Athlon 64 X2 4000
top - 09:44:55 up 24 min, 42 users,  load average: 0.05, 0.11, 0.16
Tasks: 206 total,   3 running, 203 sleeping,   0 stopped,   0 zombie
Cpu(s):  0.3%us,  1.3%sy,  0.0%ni, 96.2%id,  0.0%wa,  0.0%hi,  2.2%si,
0.0%st
Mem:   8248340k total,  3769556k used,  4478784k free,    82732k buffers
Swap:  7828572k total,        0k used,  7828572k free,  3254360k cached
***  top used was about 6.2G  w 0k Swap usage.
I was working on local X (there were also 2 remote xdm KDE sessions as
well)  when my openoffice edit acted strangely. A couple minutes
later, X completely locked up.
A remote ssh session allowed me to do a normal shutdown.
On reboot, I found the bug log in the console log, included below
Before digging into this myself (don't really have enought time),
I thought I'd submit it here...
my .config is tar gz'd as an attachment
Any input would be appreciated...
Thnx much,
johnh
.
===========================================================
John Heil
South Coast Software
Custom firmware, device drivers and board bring up services
Ph: 1-714-774-6952
Fx: 1-714-774-7053
www.sc-software.com
email: johnhscs@sc-software.com
===========================================================
Feb  6 09:09:47 sc-software kernel: Eeek! page_mapcount(page) went 
negative! (-1)
Feb  6 09:09:47 sc-software kernel:   page pfn = 12b1b1
Feb  6 09:09:47 sc-software kernel:   page->flags = 80080014
Feb  6 09:09:47 sc-software kernel:   page->count = 0
Feb  6 09:09:47 sc-software kernel:   page->mapping = 00000000
Feb  6 09:09:47 sc-software kernel:   vma->vm_ops = 0x0
Feb  6 09:09:47 sc-software kernel: ------------[ cut here ]------------
Feb  6 09:09:47 sc-software kernel: kernel BUG at mm/rmap.c:631!
Feb  6 09:09:47 sc-software kernel: invalid opcode: 0000 [#2] PREEMPT SMP
Feb  6 09:09:47 sc-software kernel: Modules linked in: shpchp pci_hotplug 
ohci1394 ieee1394
Feb  6 09:09:47 sc-software kernel:
Feb  6 09:09:47 sc-software kernel: Pid: 3710, comm: X Tainted: G      D 
(2.6.24 #1)
Feb  6 09:09:47 sc-software kernel: EIP: 0060:[<c016fc36>] EFLAGS: 
00213246 CPU: 0
Feb  6 09:09:47 sc-software kernel: EIP is at page_remove_rmap+0xe6/0x110
Feb  6 09:09:47 sc-software kernel: EAX: 00000000 EBX: c516deb8 ECX: 
c01280a8 EDX: 00000001
Feb  6 09:09:47 sc-software kernel: ESI: f7120ee4 EDI: 11605000 EBP: 
f1b31d70 ESP: f1b31d60
Feb  6 09:09:47 sc-software kernel:  DS: 007b ES: 007b FS: 00d8 GS: 0000 
SS: 0068
Feb  6 09:09:47 sc-software kernel: Process X (pid: 3710, ti=f1b30000 
task=f0586aa0 task.ti=f1b30000)
Feb  6 09:09:47 sc-software kernel: Stack: c074dda2 00000000 c516deb8 
f0662028 f1b31db4 c01683ce 2b1b1065 00000001
Feb  6 09:09:47 sc-software kernel:        00000000 00000000 2b1b1065 
00000001 c1a9657c fffffffb ffffffff f71cb300
Feb  6 09:09:47 sc-software kernel:        f7120ee4 c8e36180 1a004000 
11800000 f07fe460 f1b31df8 c016858d 11600000
Feb  6 09:09:47 sc-software kernel: Call Trace:
Feb  6 09:09:47 sc-software kernel:  [<c0103e5a>] 
show_trace_log_lvl+0x1a/0x30
Feb  6 09:09:47 sc-software kernel:  [<c0103f2a>] 
show_stack_log_lvl+0x9a/0xc0
Feb  6 09:09:47 sc-software kernel:  [<c01040d7>] 
show_registers+0xc7/0x250
Feb  6 09:09:47 sc-software kernel:  [<c010441f>] die+0x11f/0x220
Feb  6 09:09:47 sc-software kernel:  [<c01045b1>] do_trap+0x91/0xd0
Feb  6 09:09:47 sc-software kernel:  [<c0104859>] do_invalid_op+0x89/0xa0
Feb  6 09:09:47 sc-software kernel:  [<c0657c22>] error_code+0x72/0x78
Feb  6 09:09:47 sc-software kernel:  [<c01683ce>] 
zap_pte_range+0x22e/0x320
Feb  6 09:09:47 sc-software kernel:  [<c016858d>] 
unmap_page_range+0xcd/0x180
Feb  6 09:09:47 sc-software kernel:  [<c016870d>] unmap_vmas+0xcd/0x210
Feb  6 09:09:47 sc-software kernel:  [<c016dd36>] exit_mmap+0x76/0x120
Feb  6 09:09:47 sc-software kernel:  [<c0124c39>] mmput+0x39/0xa0
Feb  6 09:09:47 sc-software kernel:  [<c0129b3e>] exit_mm+0x8e/0xf0
Feb  6 09:09:47 sc-software kernel:  [<c012a393>] do_exit+0x153/0x350
Feb  6 09:09:47 sc-software kernel:  [<c012a5e9>] do_group_exit+0x29/0x70
Feb  6 09:09:47 sc-software kernel:  [<c0134452>] 
get_signal_to_deliver+0x242/0x2e0
Feb  6 09:09:47 sc-software kernel:  [<c0102e4c>] do_signal+0x5c/0x170
Feb  6 09:09:47 sc-software kernel:  [<c0102f9c>] 
do_notify_resume+0x3c/0x40
Feb  6 09:09:47 sc-software kernel:  [<c01031b5>] work_notifysig+0x13/0x1a
Feb  6 09:09:47 sc-software kernel:  =======================
Feb  6 09:09:47 sc-software kernel: Code: bb dd 74 c0 e8 dc 2f fe ff 8b 46 
44 85 c0 75 1f 8b 46 4c 85
c0 74 14 8b 40 10 85 c0 74 0d 8b 50 2c b8 14 ec 74 c0 e8 ba 2f fe ff <0f> 
0b eb fe 8b 50 0c b8 38
ec 74 c0 e8 a9 2f fe ff 8b 46 44 8b
Feb  6 09:09:47 sc-software kernel: EIP: [<c016fc36>] 
page_remove_rmap+0xe6/0x110 SS:ESP 0068:f1b31d60
Feb  6 09:09:47 sc-software kernel: ---[ end trace 791c1b0a2eb87d50 ]---
Feb  6 09:09:47 sc-software kernel: Fixing recursive fault but reboot is 
needed!
Feb  6 09:09:47 sc-software kernel: BUG: scheduling while atomic: 
X/3710/0x00000003
Feb  6 09:09:47 sc-software kernel: INFO: lockdep is turned off.
Feb  6 09:09:47 sc-software kernel: Pid: 3710, comm: X Tainted: G      D 
2.6.24 #1
Feb  6 09:09:47 sc-software kernel:  [<c0103e5a>] 
show_trace_log_lvl+0x1a/0x30
Feb  6 09:09:47 sc-software kernel:  [<c0103e82>] show_trace+0x12/0x20
Feb  6 09:09:47 sc-software kernel:  [<c0103ffd>] dump_stack+0x6d/0x80
Feb  6 09:09:47 sc-software kernel:  [<c0120f56>] __schedule_bug+0x66/0x70
Feb  6 09:09:47 sc-software kernel:  [<c0655655>] 
__sched_text_start+0x295/0x490
Feb  6 09:09:47 sc-software kernel:  [<c012a4ab>] do_exit+0x26b/0x350
Feb  6 09:09:47 sc-software kernel:  [<c0104513>] die+0x213/0x220
Feb  6 09:09:47 sc-software kernel:  [<c01045b1>] do_trap+0x91/0xd0
Feb  6 09:09:47 sc-software kernel:  [<c0104859>] do_invalid_op+0x89/0xa0
Feb  6 09:09:47 sc-software kernel:  [<c0657c22>] error_code+0x72/0x78
Feb  6 09:09:47 sc-software kernel:  [<c01683ce>] 
zap_pte_range+0x22e/0x320
Feb  6 09:09:47 sc-software kernel:  [<c016858d>] 
unmap_page_range+0xcd/0x180
Feb  6 09:09:47 sc-software kernel:  [<c016870d>] unmap_vmas+0xcd/0x210
Feb  6 09:09:47 sc-software kernel:  [<c016dd36>] exit_mmap+0x76/0x120
Feb  6 09:09:47 sc-software kernel:  [<c0124c39>] mmput+0x39/0xa0
Feb  6 09:09:47 sc-software kernel:  [<c0129b3e>] exit_mm+0x8e/0xf0
Feb  6 09:09:47 sc-software kernel:  [<c012a393>] do_exit+0x153/0x350
Feb  6 09:09:47 sc-software kernel:  [<c012a5e9>] do_group_exit+0x29/0x70
Feb  6 09:09:47 sc-software kernel:  [<c0134452>] 
get_signal_to_deliver+0x242/0x2e0
Feb  6 09:09:47 sc-software kernel:  [<c0102e4c>] do_signal+0x5c/0x170
Feb  6 09:09:47 sc-software kernel:  [<c0102f9c>] 
do_notify_resume+0x3c/0x40
Feb  6 09:09:47 sc-software kernel:  [<c01031b5>] work_notifysig+0x13/0x1a
Feb  6 09:09:47 sc-software kernel:  =======================
[unhandled content-type:application/octet-stream]