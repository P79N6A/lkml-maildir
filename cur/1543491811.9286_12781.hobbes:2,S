Date: Sun, 4 Apr 1999 02:29:20 +1000 (EST)
From: Nathan Hand <>
Subject: patch: bttv driver: support for pixelview card
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/4/3/28

Thanks to Kevin Wang <kevin130@serv.prolink.com.tw> for ProLink, makers
of the PixelView products, Linux now supports the PixelView PlayTV PRO+
(model number PV-BT878P+) in the bttv driver. I've sent a similar patch
to the seperately maintained bttv driver to rjkm@thp.uni-koeln.de.
The tuner type is 5. The cards is 0x10. The card optionally features an
FM radio which I've verified works fine with gradio, fmtools, etc.
I've commented out the AUDIO_UNMUTE in radio_close, following the exact
same behaviour for bttv_close. Without that line commented out, command
line tools like "fmtools" are useless, because they close the device on
every setfreq call. Is there a frequently argued quibble about this?
--
Nathan Hand - Chirp Web Design - 
http://www.chirp.com.au/
 - $e^{i\pi}+1 = 0$
Phone: +61 2 6230 1871   Fax: +61 2 6230 4455   E-mail: nathanh@chirp.com.au
diff -uNr orig/bttv.c new/bttv.c
--- orig/bttv.c	Sun Apr  4 02:12:53 1999
+++ new/bttv.c	Sun Apr  4 02:13:03 1999
@@ -541,6 +541,8 @@
         { 3, 1, 0, 2, 7, { 2, 3, 1, 1}, { 0, 1, 2, 3, 4}},
         /* Zoltrix TV-Max */
         { 3, 1, 0, 2,15, { 2, 3, 1, 1}, { 0, 0, 0, 0, 0}},
+        /* Pixelview PlayTV (bt878) */
+        { 3, 4, 0, 2, 0x01e000, { 2, 0, 1, 1}, {0x01c000, 0, 0x018000, 0x014000, 0x002000, 0 }},
 };
 #define TVCARDS (sizeof(tvcards)/sizeof(tvcard))
 
@@ -2388,7 +2390,7 @@
   
 	btv->user--;
 	btv->radio = 0;
-	audio(btv, AUDIO_MUTE);
+	/*audio(btv, AUDIO_MUTE);*/
 	MOD_DEC_USE_COUNT;  
 }
 
@@ -2927,6 +2929,12 @@
 			btv->pll.pll_crystal=BT848_IFORM_XT0;
 		}
         }
+
+        if (btv->type == BTTV_PIXVIEWPLAYTV) {
+		btv->pll.pll_ifreq=28636363;
+		btv->pll.pll_crystal=BT848_IFORM_XT0;
+        }
+
         if(btv->type==BTTV_AVERMEDIA98)
         {
         	btv->pll.pll_ifreq=28636363;
diff -uNr orig/bttv.h new/bttv.h
--- orig/bttv.h	Sun Apr  4 02:12:53 1999
+++ new/bttv.h	Sun Apr  4 02:13:03 1999
@@ -208,6 +208,7 @@
 #define BTTV_AVERMEDIA98   0x0d
 #define BTTV_VHX           0x0e
 #define BTTV_ZOLTRIX       0x0f
+#define BTTV_PIXVIEWPLAYTV 0x10
 
 #define AUDIO_TUNER        0x00
 #define AUDIO_RADIO        0x01