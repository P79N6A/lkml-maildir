Date: Sun, 24 Feb 2008 19:21:21 +0100
From: Pavel Machek <>
Subject: Re: [Bug 10030] Suspend doesn't work when SD card is inserted
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/24/71

Hi!
> Index: usb-2.6/drivers/base/power/main.c
> ===================================================================
> --- usb-2.6.orig/drivers/base/power/main.c
> +++ usb-2.6/drivers/base/power/main.c
> @@ -25,6 +25,7 @@
>  #include <linux/pm.h>
>  #include <linux/resume-trace.h>
>  #include <linux/rwsem.h>
> +#include <linux/sched.h>
> 
>  #include "../base.h"
>  #include "power.h"
> @@ -59,6 +60,13 @@ static DECLARE_RWSEM(pm_sleep_rwsem);
> 
>  int (*platform_enable_wakeup)(struct device *dev, int is_on);
> 
> +static struct task_struct *suspending_task;
What locking protects this variable? What happens when suspending_task
exits? (Hmm, that would probably be bug, anyway?)
Or are we running UP when this is accessed? This at least needs a big
fat comment.
> +bool in_suspend_context(void)
> +{
> +	return (suspending_task == current);
> +}
							Pavel
-- 
(english) 
http://www.livejournal.com/~pavelmachek
(cesky, pictures) 
http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html