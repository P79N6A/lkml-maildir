Date: Sat, 22 Dec 2007 12:32:48 -0500
From: Dave Dillow <>
Subject: Re: list corruption on ib_srp load in v2.6.24-rc5
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/22/94

On Sun, 2007-12-23 at 01:41 +0900, FUJITA Tomonori wrote:
> I think that as Pete pointed out, srp_remove_one needs to call
> srp_remove_host.
> 
> Can you try this?
If I need to escape family during the holidays, I'll test it from home.
Otherwise I'll be able to test on Wednesday.
Thanks for the patch,
Dave
> diff --git a/drivers/infiniband/ulp/srp/ib_srp.c b/drivers/infiniband/ulp/srp/ib_srp.c
> index 950228f..bdb6f85 100644
> --- a/drivers/infiniband/ulp/srp/ib_srp.c
> +++ b/drivers/infiniband/ulp/srp/ib_srp.c
> @@ -2053,6 +2053,7 @@ static void srp_remove_one(struct ib_device *device)
> 
>  		list_for_each_entry_safe(target, tmp_target,
>  					 &host->target_list, list) {
> +			srp_remove_host(target->scsi_host);
>  			scsi_remove_host(target->scsi_host);
>  			srp_disconnect_target(target);
>  			ib_destroy_cm_id(target->cm_id);