Date: Fri, 04 Apr 2008 11:37:20 +0200
From: Bodo Eggert <>
Subject: Re: Slow tape drive timeout
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/4/4/74

Kai Makisara <Kai.Makisara@kolumbus.fi> wrote:
> On Wed, 2 Apr 2008, Robert Hancock wrote:
>> Why is accessing the tape drive with no tape in it causing a timeout in the
>> first place? I should think that would fail immediately with some "medium not
>> present" error from the drive. Unless the drive has no mechanism to detect
>> it, but that seems really retarded..
>> 
> It does not seem retarded to me. If a program wants to just wait until the
> tape drive becomes ready (e.g., loads the tape), it can use the blocking
> open. This is simple.
This would be simple, if there were no timeout. Having the timeout, the program
must loop anyway.
> If a program wants to test the status, it uses 
> non-blocking open. The behavior mandated by the standards provides
> alternatives. If O_NONBLOCK is not supported, the user program must
> implement the waiting logic if the program just wants to wait until the
> drive is ready before starting i/o.
Therfore a portable program SHOULD implement a waiting logic that won't burn
the CPU if there is no tape in the drive.
It's still sane to allow waiting for media change, but this applies to any
removable media.