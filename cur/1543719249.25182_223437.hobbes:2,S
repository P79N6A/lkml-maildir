Date: Fri, 28 May 2004 12:50:17 +0800 (CST)
From: "Zhu, Yi" <>
Subject: Re: idebus setup problem (2.6.7-rc1)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/5/28/8

On Thu, 27 May 2004, Auzanneau Gregory wrote:
> 
> Hello,
> 
> It seems there is a problem with idebus parameter with 2.6.7-rc1.
> Indeed, it doesn't take into account lilo append.
> 
> With 2.6.7-rc1-mm1, i've got:
> Kernel command line: BOOT_IMAGE=LinuxNEW ro root=304 idebus=66
> ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
> 
> With 2.6.6-mm3, i've got:
> May 24 11:37:43 greg-port kernel: Kernel command line:
> BOOT_IMAGE=LinuxNEW ro root=304 idebus=66
> May 24 11:37:43 greg-port kernel: ide_setup: idebus=66
> May 24 11:37:43 greg-port kernel: ide: Assuming 66MHz system bus speed
> for PIO modes
My bad. I missed ide_setup(), please try below patch.
--- linux-2.6.7-rc1-mm1.orig/init/main.c	2004-05-28 12:39:15.549314064 +0800
+++ linux-2.6.7-rc1-mm1/init/main.c	2004-05-28 12:40:29.399087192 +0800
@@ -162,7 +162,7 @@ static int __init obsolete_checksetup(ch
 	p = &__setup_start;
 	do {
 		int n = strlen(p->str);
-		if (len <= n && !strncmp(line, p->str, n)) {
+		if (n == 0 || (len <= n && !strncmp(line, p->str, n))) {
 			/* Already done in parse_early_param? */
 			if (p->early)
 				return 1;
Andrew, could you apply?
Thanks,
-yi
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/