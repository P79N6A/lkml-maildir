Date: Fri, 9 May 2008 11:27:53 +0200
From: Bartlomiej Zolnierkiewicz <>
Subject: Re: kernel 2.6.25 with ide driver cs5520 does not boot.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/5/9/75

On Friday 09 May 2008, TAKADA Yoshihito wrote:
> Thanks for quick reply.
> 
> I tried 2.6.26rc1. It hangs same as 2.6.25.
> kernel 2.6.26rc1 with cs5520 cannot boot. cs5520 scans ide0 and ide1.
> It seems 2nd port DMA base issue was solved.
[...]
Thanks.
The following patch for 2.6.26-rc1 disables VDMA, please give it a try
(I haven't time to fully audit VDMA support yet but lets see if it is
the main source of the problems).
---
 drivers/ide/pci/cs5520.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
Index: b/drivers/ide/pci/cs5520.c
===================================================================
--- a/drivers/ide/pci/cs5520.c
+++ b/drivers/ide/pci/cs5520.c
@@ -119,6 +119,7 @@ static const struct ide_dma_ops cs5520_d
 	.dma_timeout		= ide_dma_timeout,
 };
 
+/* FIXME: VDMA is disabled because it caused problems */
 #define DECLARE_CS_DEV(name_str)				\
 	{							\
 		.name		= name_str,			\
@@ -126,7 +127,6 @@ static const struct ide_dma_ops cs5520_d
 		.dma_ops	= &cs5520_dma_ops,		\
 		.host_flags	= IDE_HFLAG_ISA_PORTS |		\
 				  IDE_HFLAG_CS5520 |		\
-				  IDE_HFLAG_VDMA |		\
 				  IDE_HFLAG_NO_ATAPI_DMA |	\
 				  IDE_HFLAG_ABUSE_SET_DMA_MODE, \
 		.pio_mask	= ATA_PIO4,			\