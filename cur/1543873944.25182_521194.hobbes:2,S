Date: Sat, 17 Mar 2007 19:31:44 +0100
From: Thomas Meyer <>
Subject: Re: Bug in pci_restore_msi_state
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/17/119

Pekka Enberg schrieb:
> On 3/17/07, Thomas Meyer <thomas@m3y3r.de> wrote:
>> Hello everybody.
>>
>> I get this bug after suspending to disk twice:
>>
>> 
http://m3y3r.de/bilder/Bug-pci_restore_msi_state.png
>>
>> This happens with current git head
>> cd05a1f818073a623455a58e756c5b419fc98db9.
>
> If you know a kernel that works, please consider doing git bisect:
>
> 
http://www.kernel.org/pub/software/scm/git/docs/howto/isolate-bugs-with-bisect.txt
>
>
I don't think so, because suspend to disk began to work again with the
latest commit.
But it seems to have to do with dev->msi_enabled, that is enabled, but
the msi_attrib for this device is empty (pos is zero) in the function
__pci_restore_msi_state. irq=19 and msi_attrib=0 before the bug happens
(trying to accessing msi_attrib.pos).
But 19 is not an msi interrupt, isn't it?
           CPU0       CPU1
  0:     168998          0   IO-APIC-edge      timer
  9:       9056          0   IO-APIC-fasteoi   acpi
 16:         43          0   IO-APIC-fasteoi   uhci_hcd:usb5
 17:       8278      19996   IO-APIC-fasteoi   wifi0
 18:      11388          0   IO-APIC-fasteoi   libata, uhci_hcd:usb4
 19:          3          0   IO-APIC-fasteoi   uhci_hcd:usb3, ohci1394
 20:     115285          0   IO-APIC-fasteoi   ehci_hcd:usb1, uhci_hcd:usb2
 21:        225          0   IO-APIC-fasteoi   HDA Intel
218:      14365          0   PCI-MSI-edge      libata
219:          1          0   PCI-MSI-edge      eth0
NMI:          0          0
LOC:      49119      88723
ERR:          0
MIS:          0
Shouldn't  the flag msi_enabled be set to zero in function
msi_remove_pci_irq_vectors?
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/