Date: Tue, 18 Jan 2000 23:56:42 +0100 (CET)
From: Andrzej Krzysztofowicz <>
Subject: Re: [2.3.3x] ALI M15x3 chipset support (EXPERIMENTAL)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2000/1/19/64

> 
> Tom> On a related issue: I find kernel 2.3.37 which I am running at the moment 
> Tom> does not report the "ide: Assuming xxMHz system bus speed..." at all. 
> Tom> Previously I was running 2.3.24 which did report 40MHz assumed speed. I 
> Tom> did a quick grep of the two sources and the routines for this in 
> Tom> drivers/block/{ide.c,ali15x3.c} are the same. Any idea whats going on?
> 
> Alim15x3 driver prior to kernel 2.3.28 was unable to properly detect our chipset rev ;)
> Anyway you can read your PCI bus speed from /proc/ide/ali
Unless your BIOS does set an apropriate PCI cinfiguration register properly.
Mine does not. Whatever PCI clock I set (jumpers) on the MoBo I always get 33
MHz from /proc/ide/ali ...
> Tom> I hope to try this once I have backed-up my root HD. I'm puzzled by the 
> Tom> argument to idebus. Where do you get the 30 from? I cannot find any 
> 
> Reading the source, idebus is used only if you are PIOing wich is not your case and
> that's why you don't see "..assuming 40Mhz" message anymore.
Normally there's no way to set apropriate timings for DMA modes. However it
seems to me that timings which are set for PIO modes are also used in DMA
modes, i.e. benchmarks show difference.
I also recalculated manually the standard PIO timings which are set by my
BIOS and they look like being calculated basing on 42 MHz PCI clock...
> Tom> Does anybody know the nature of the 'instability' ? 
> 
> I've hack the driver to _force_ udma33 with my revision 0x20, please don't do that !!
> This completely _fuck_ my hdc WDC AC24300L, and I need to repartitioning
> but with my new IBM-DJNA-371350 I've got _very_ good result and right
> now I didn't fall back to dma2 :| 
Chih-Jen Tsai <cjtsai@ali.com.tw> suggested that UDMA problems are WD drives 
specyfic and disappear when CRC errors are ignored. I'm not sure if it is
easy to ignore CRC errors for specyfic hardware combinations only, but if it
is - it could be a workaround of the problem.
Could you send me the patch you use for Rev.20/UDMA, please ?
-- 
=======================================================================
  Andrzej M. Krzysztofowicz               ankry@mif.pg.gda.pl
  phone (48)(58) 347 14 61
Faculty of Applied Phys. & Math.,   Technical University of Gdansk
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/