Date: Mon, 8 Nov 1999 10:50:55 -0600
From: Tim Walberg <>
Subject: 2.2.13 rtc problem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/11/8/62

System:
	Supermicro P6DNE m/b
	2 200MHz PPro
	512Mb RAM
Kernel:
	2.2.13ac2 (compiled either with egcs-2.91.66 or pgcc-2.95.1)
Symptoms:
	in /var/log/messages:
		Nov  8 07:07:19 calvin kernel: rtc: lost some interrupts at 256Hz.
		Nov  8 07:08:54 calvin last message repeated 14 times
		Nov  8 07:09:41 calvin kernel: rtc: lost some interrupts at 256Hz.
		Nov  8 08:03:13 calvin kernel: set_rtc_mmss: can't update from 52 to 3
		Nov  8 08:04:14 calvin kernel: set_rtc_mmss: can't update from 52 to 4
		Nov  8 08:05:15 calvin kernel: set_rtc_mmss: can't update from 52 to 5
		Nov  8 08:06:16 calvin kernel: set_rtc_mmss: can't update from 52 to 6
		Nov  8 08:40:20 calvin kernel: set_rtc_mmss: can't update from 59 to 10
		Nov  8 08:41:21 calvin kernel: set_rtc_mmss: can't update from 59 to 11
		Nov  8 08:42:22 calvin kernel: set_rtc_mmss: can't update from 59 to 12
		Nov  8 08:43:23 calvin kernel: set_rtc_mmss: can't update from 59 to 13
	[root@calvin /root]# hwclock; date
	Mon Nov  8 07:36:36 1999  -0.092696 seconds
	Mon Nov  8 09:42:09 CST 1999
	[root@calvin /root]# hwclock; date
	Mon Nov  8 07:36:36 1999  -0.003614 seconds
	Mon Nov  8 09:42:30 CST 1999
Description:
	Above messages are logged to /var/log/messages, and after this happens,
	the rtc seems to be frozen. Running 'hwclock --systohc' succeeds, and
	updates the time, but the clock is still not ticking. Kernel periodic
	updates to rtc work until the next hour wraparound point, where
	|cmos_minutes-real_minutes|>30 (arch/i386/kernel/time.c[326]),
	and the set_rtc_mmss message is logged.
	This seems to cause some wierdness on reboot, as well, if I forget to
	fix the rtc before I boot again, as there are dates all over the file
	system that are "in the future"...
Questions:
	Has anyone seen and resolved such an issue before?
	Is it possibly the fault of a faulty rtc (I suspect not, since this
		didn't happen until I upgraded to 2.2.13ac2 this weekend)?
	Is there a way (short of rebooting) to kickstart the rtc to get
		it running again?
	What are the implications of leaving out the "Enhanced RTC Support"
		in the kernel? Will that avoid this problem (while obviously
		letting the rtc free-run)?
	Any other suggestions, workarounds, hacks, etc.?
If you need further information, feel free to contact me.
				tw
-- 
+------------------------------+--------------------------+
| Tim Walberg                  | Phone: 847-782-2472      |
| TERAbridge Technologies Corp | FAX:   847-623-1717      |
| 1375 Tri-State Parkway       | twalberg@terabridge.com  |
| Gurnee, IL 60031             | 800-SKY-TEL2 PIN 9353299 |
+------------------------------+--------------------------+
[unhandled content-type:application/pgp-signature]