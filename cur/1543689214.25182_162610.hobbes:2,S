Date: Wed, 03 Sep 2003 18:11:23 +0200
From: Benjamin Herrenschmidt <>
Subject: [PATCH] IDE: fix Power Management
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/3/204

This is the "final" one hopefully, Bart, check out it's correct,
Andrew that I did no typo this time ;)
Spacing is a bit fucked up in setup_driver_defaults due to the
field name beeing too long (gah !) but that isn't too bad...
Ben.
diff -urN for-linus-ppc/drivers/ide/ide.c linuxppc-2.5-benh/drivers/ide/ide.c
--- for-linus-ppc/drivers/ide/ide.c	2003-09-03 18:07:14.000000000 +0200
+++ linuxppc-2.5-benh/drivers/ide/ide.c	2003-09-03 18:09:01.000000000 +0200
@@ -2406,6 +2406,12 @@
 	return ide_abort(drive, msg);
 }
 
+static int default_start_power_step(ide_drive_t *drive, struct request *rq)
+{
+	rq->pm->pm_step = ide_pm_state_completed;
+	return ide_stopped;
+}
+
 static void setup_driver_defaults (ide_driver_t *d)
 {
 	if (d->cleanup == NULL)		d->cleanup = default_cleanup;
@@ -2420,6 +2426,7 @@
 	if (d->capacity == NULL)	d->capacity = default_capacity;
 	if (d->special == NULL)		d->special = default_special;
 	if (d->attach == NULL)		d->attach = default_attach;
+	if (d->start_power_step == NULL)d->start_power_step = default_start_power_step;
 }
 
 int ide_register_subdriver (ide_drive_t *drive, ide_driver_t *driver, int version)
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/