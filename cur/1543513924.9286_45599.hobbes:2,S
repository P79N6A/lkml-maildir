Date: Sun, 24 Oct 1999 13:01:24 +0300 (EET DST)
From: Kai Makisara <>
Subject: Patch to compile bttv.c in 2.3.23
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/10/24/10

The following patch enables me to use bttv in 2.3.23 while waiting for
Alan Cox (or some other person) to fix the driver properly. The idea for
this patch comes from the changes in fs/proc/array.c for 2.3.23.
	Kai
--------------------------8<--------------------------
--- linux-2.3/drivers/char/bttv.c.23	Sun Oct 24 10:29:45 1999
+++ linux-2.3/drivers/char/bttv.c	Sun Oct 24 11:13:03 1999
@@ -34,7 +34,7 @@
 #include <linux/signal.h>
 #include <asm/io.h>
 #include <linux/ioport.h>
-#include <asm/pgtable.h>
+#include <linux/pagemap.h>
 #include <asm/page.h>
 #include <linux/sched.h>
 #include <asm/segment.h>
@@ -122,7 +122,7 @@
                         ptep = pte_offset(pmd, adr);
                         pte = *ptep;
                         if(pte_present(pte))
-                                ret = (pte_page(pte)|(adr&(PAGE_SIZE-1)));
+                                ret = (kmap(pte_page(pte), KM_READ)|(adr&(PAGE_SIZE-1)));
                 }
         }
         MDEBUG(printk("uv2kva(%lx-->%lx)", adr, ret));
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/