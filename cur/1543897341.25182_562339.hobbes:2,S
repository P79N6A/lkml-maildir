Date: Tue, 26 Jun 2007 09:58:17 +0200 (CEST)
From: Nikola Ciprich <>
Subject: arcmsr + dmcrypt problem
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/6/26/64

Hello everybody,
I've stumbled upon a problem with arcmsr driver: trying to use a dmcrypt 
encrypted volume on top of areca volume always hangs the card.
Steps to reproduce:
1) create some kind of raid on areca (raid5, or even a passthrough disc)
2) cryptsetup luksFormat /dev/sda1 (or whatever areca sdX device is)
3) cryptsetup luksOpen /dev/sda1 cryptotest
4) mkfs.xfs /dev/mapper/cryptotest
5) mount /dev/mapper/cryptotest /mnt/cryptotest
6) copy some data to /mnt/cryptotest
this hangs card and printk's following messages:
[  288.160614] arcmsr0: isr get an illegal ccb command done acb='0xffff810144758548'ccb='0xffff810020020000' ccbacb='0x50a05ed7588a40c0' startdone = 0xbcda ccboutstandingcount=1 --
I have tested it on:
1) SMP amd64 machine running 2.6.18 x86_64 kernel with external arcmsr 
module or 2.6.21.3 - it it always hangs on step 4
2) SMP xeon machine running 2.6.21 and also 2.6.22-rc6, UP or SMP, with 
acpi on or off, also tried disabling NCQ - always hangs on step 6
Card information:
Firmware Version   : V1.43 2007-4-17
BOOT ROM Version   : V1.43 2007-4-17
Controller Name    : ARC-1220
Apparently I'm not the first person to encounter this problem:
http://forums.storagereview.net/index.php?showtopic=25513
Should somebody be willing to hunt down this bug, I'd be more than happy 
to assist.
best regards
nik.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/