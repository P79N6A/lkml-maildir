Date: Wed, 16 Oct 2002 21:40:24 -0700
From: Andrew Morton <>
Subject: Re: 2.5.43 IO-APIC bug and spinlock deadlock
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/17/6

Doug Ledford wrote:
> 
> On Wed, Oct 16, 2002 at 11:33:02PM -0400, Doug Ledford wrote:
> > IO-APIC bug: regular kernel, UP, no IO-APIC or APIC on UP enabled, compile
> > fails (does *everyone* run SMP or at least UP + APIC now?)
> 
> OK, this is real.
> 
Linus has merged a patch for this.  Does it work for you?  I don't
think you've sent us any error output.
 include/asm-i386/apic.h |    4 ++--
 include/asm-i386/smp.h  |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)
--- 2.5.43/include/asm-i386/smp.h~mpparse-fix	Tue Oct 15 21:26:18 2002
+++ 2.5.43-akpm/include/asm-i386/smp.h	Tue Oct 15 21:26:31 2002
@@ -37,6 +37,7 @@
  #endif /* CONFIG_CLUSTERED_APIC */
 #endif 
 
+#define BAD_APICID 0xFFu
 #ifdef CONFIG_SMP
 #ifndef __ASSEMBLY__
 
@@ -65,7 +66,6 @@ extern void zap_low_mappings (void);
  * the real APIC ID <-> CPU # mapping.
  */
 #define MAX_APICID 256
-#define BAD_APICID 0xFFu
 extern volatile int cpu_to_physical_apicid[NR_CPUS];
 extern volatile int physical_apicid_to_cpu[MAX_APICID];
 extern volatile int cpu_to_logical_apicid[NR_CPUS];
--- 2.5.43/include/asm-i386/apic.h~mpparse-fix	Tue Oct 15 21:34:03 2002
+++ 2.5.43-akpm/include/asm-i386/apic.h	Tue Oct 15 21:34:05 2002
@@ -7,8 +7,6 @@
 #include <asm/apicdef.h>
 #include <asm/system.h>
 
-#ifdef CONFIG_X86_LOCAL_APIC
-
 #define APIC_DEBUG 0
 
 #if APIC_DEBUG
@@ -17,6 +15,8 @@
 #define Dprintk(x...)
 #endif
 
+#ifdef CONFIG_X86_LOCAL_APIC
+
 /*
  * Basic functions accessing APICs.
  */
.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/