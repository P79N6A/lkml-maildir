Date: Fri, 09 Jan 2009 14:07:22 -0500
From: Chris Mason <>
Subject: Re: Increase dirty_ratio and dirty_background_ratio?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/9/260

On Fri, 2009-01-09 at 19:02 +0100, Jan Kara wrote:
>   What we observe in the seekwatcher graphs is, that there are three
> processes writing back the single database file in parallel (2 pdflush
> threads because the machine has 2 CPUs, and the database process itself
> because of dirty throttling). Each of the processes is writing back the
> file at a different offset and so they together create even more random IO
> (I'm attaching the graph and can provide blocktrace data if someone is
> interested). If there was just one process doing the writeback, we'd be
> writing back those data considerably faster...
I spent some time trying similar things for btrfs, and went as far as
making my own writeback thread and changing pdflush and throttled writes
to wait on it.  It was a great hack, but in the end I found the real
problem was the way write_cache_pages is advancing the page_index.
You probably remember the related ext4 discussion, and you could try my
simple patch in this workload to see if it helps ext3.
http://lkml.org/lkml/2008/10/1/278
Ext3 may need similar tricks.
-chris