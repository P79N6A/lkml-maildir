Date: Fri, 30 Jan 2009 00:00:09 +0900
From: "J. R. Okajima" <>
Subject: [PATCH 1/1] s_umount in sget()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/29/199

It seems to be forgotten to release s_umount rwsem in a error path of
sget(). I don't think it harmful generally since the rwsem is freed. But
I am afarid unnecessary info left in some debugging subsystem (lockdep
or something).
Signed-off-by: J. R. Okajima <hooanon05@yahoo.co.jp>
---
 fs/super.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)
diff --git a/fs/super.c b/fs/super.c
index 645e540..0331ff9 100644
--- a/fs/super.c
+++ b/fs/super.c
@@ -372,6 +372,7 @@ retry:
 	err = set(s, data);
 	if (err) {
 		spin_unlock(&sb_lock);
+		up_write(&s->s_umount);
 		destroy_super(s);
 		return ERR_PTR(err);
 	}
-- 
1.6.1.284.g5dc13