Date: Fri, 27 Oct 2006 18:22:10 +1000
From: Nick Piggin <>
Subject: Re: [PATCH, RFC/T] Fix handling of write failures to swap devices
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/27/39

Richard Purdie wrote:
> Fix handling of write failures to swap devices.
> 
> Calling SetPageError(page) marks the data in memory as bad and processes using
> the page in question will die unexpectedly. This isn't necessary as the data 
> in the memory page is still valid, just the copy on disk isn't. This patch 
> therefore removes this call.
> 
> Setting set_page_dirty(page) is good as the memory page will be retained and 
> processes don't die. It will try to write out the page again soon but a second 
> attempt at a write is probably no more likely to succeed than the first 
> resulting in IO loops. We can do better.
> 
> This patch attempts to unuse the page in a similar manner to swapoff. If 
> successful, mark the swap page as bad and remove it from use. If we fail to
> remove all references, we fall back on set_page_dirty above which will retry 
> the write.
> 
> If we can mark the swap page as bad, adjust the VM accounting to reflect this.
> 
> Signed-off-by: Richard Purdie <rpurdie@openedhand.com>
> 
> ---
> 
> Comments and testing from people who know this area of code better than
> me would be appreciated!
This is the right approach to handling swap write errors. However, you need
to cut down on the amount of code duplication. Also, if you hit that BUG_ON,
then you probably have a bug, don't remove it!
Otherwise, this would be nice to have so it's great you're working on it,
thanks.
-- 
SUSE Labs, Novell Inc.
Send instant messages to your online friends 
http://au.messenger.yahoo.com
 
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/