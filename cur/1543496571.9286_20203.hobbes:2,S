Date: Sat, 22 May 1999 19:34:02 +0200
From: Thierry Danis <>
Subject: Slow NFS reading with multiple clients
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/5/24/62

Hello,
I am resending that post since it has had no echo and seemed to hide some
problem.
I have installed the RH 6.0 on a Linux NFS server and updated the kernel
to 2.2.7-ac1.
I am testing NFS with iozone.
The NFS server is doing rather well with one client (6,8Mo/s with a
2.2.{6,7}-ac1 Linux client, 7,3 Mo/s with a FreeBSD client for writing,
4,5 Mo/s during reading for Linux, 4,8 Mo/s for FreeBSD).
Unfortunately, when I run two clients at the same time, reading
performance drops drastically : 700 Ko/s each. During rereading,
the load of the server climbs between 4 and 5. With 1 client, the
load during reading ist around 0,20.
When I run two iozones locally on the server, I get 3,5 Mo/s on each
iozone (ie, the global rate is  around 7 Mo/s, which is consistent).
So, to summary :
1)      1 NFS client : ~ 7 Mo/s writing, 5 Mo/s reading
2)      2 NFS clients: ~ 7 Mo/s writing, 1,5 Mo/s reading (cumulated : BAD)
3)      1 local client : ~ 9 Mo/s writing,  7 Mo/s reading
4)      2 local clients : ~ 9 Mo/s writing,  7 Mo/s reading. (cumulated : OK)
Where can the problem (1,5 Mo/s) be ?
I tried with 2.2.6-ac1 on the server, without any change.
No process seems to eat that much CPU :
>   7:32pm  up 18 min,  1 user,  load average: 6.95, 3.91, 2.09
> 47 processes: 44 sleeping, 3 running, 0 zombie, 0 stopped
> CPU states:  0.1% user,  1.7% system,  0.0% nice, 98.0% idle
> Mem:   63392K av,  61900K used,   1492K free,   2536K shrd,   1320K buff
> Swap: 120480K av,   4372K used, 116108K free                 56472K cached
> 
>   PID USER     PRI  NI  SIZE  RSS SHARE STAT  LIB %CPU %MEM   TIME COMMAND
>   485 root       2   0     0    0     0 DW      0  0.3  0.0   0:10 nfsd
>   486 root       1   0     0    0     0 DW      0  0.3  0.0   0:09 nfsd
>   973 danis      2   0   488  448   336 R       0  0.3  0.7   0:04 top
>   483 root       1   0     0    0     0 DW      0  0.1  0.0   0:10 nfsd
>   484 root       1   0     0    0     0 DW      0  0.1  0.0   0:10 nfsd
>   487 root       2   0     0    0     0 DW      0  0.1  0.0   0:10 nfsd
>   488 root       1   0     0    0     0 DW      0  0.1  0.0   0:09 nfsd
...
A +,
-- 
	Thierry Danis
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/