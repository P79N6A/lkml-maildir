Date: Wed, 4 Aug 2004 12:41:57 +0200
From: Guido Guenther <>
Subject: Re: [PATCH][PPC32] Makefile cleanups and gcc-3.4+binutils-2.14 c
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2004/8/4/68

On Fri, Jul 30, 2004 at 02:03:18PM -0700, Tom Rini wrote:
> 
> On Fri, Jul 30, 2004 at 10:48:28PM +0200, Giuliano Pochini wrote:
> 
> [snip]
> > gcc 3.3.3 + binutils 2.15 fails quite soon here:
> >
> >   AS      arch/ppc/kernel/l2cr.o
> > arch/ppc/kernel/l2cr.S: Assembler messages:
> > arch/ppc/kernel/l2cr.S:110: Error: Unrecognized opcode: `dssall'
> > arch/ppc/kernel/l2cr.S:278: Error: Unrecognized opcode: `dssall'
> > arch/ppc/kernel/l2cr.S:387: Error: Unrecognized opcode: `dssall'
> > make[1]: *** [arch/ppc/kernel/l2cr.o] Error 1
> 
> Can you try with the following?
Doesn't apply against 2.6.8-rc3. For what it's worth, I've attached a version that does.
Cheers,
 -- Guido
--- ../linux-2.6.8-rc3.orig/arch/ppc/Makefile	2004-06-16 07:18:57.000000000 +0200
+++ arch/ppc/Makefile	2004-08-04 11:39:26.518867808 +0200
@@ -15,14 +15,20 @@
 
 LDFLAGS_vmlinux	:= -Ttext $(KERNELLOAD) -Bstatic
 CPPFLAGS	+= -Iarch/$(ARCH)
-AFLAGS		+= -Iarch/$(ARCH)
+aflags-y	+= -Iarch/$(ARCH)
 cflags-y	+= -Iarch/$(ARCH) -msoft-float -pipe \
 		-ffixed-r2 -Wno-uninitialized -mmultiple -mstring
 CPP		= $(CC) -E $(CFLAGS)
 
+aflags-$(CONFIG_4xx)		+= -m405
 cflags-$(CONFIG_4xx)		+= -Wa,-m405
+aflags-$(CONFIG_6xx)		+= -maltivec
+cflags-$(CONFIG_6xx)		+= -Wa,-maltivec
+aflags-$(CONFIG_E500)		+= -me500
+aflags-$(CONFIG_PPC64BRIDGE)	+= -mppc64bridge
 cflags-$(CONFIG_PPC64BRIDGE)	+= -Wa,-mppc64bridge
 
+AFLAGS += $(aflags-y)
 CFLAGS += $(cflags-y)
 
 [unhandled content-type:application/pgp-signature]