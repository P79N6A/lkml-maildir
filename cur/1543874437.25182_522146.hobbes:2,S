Date: Tue, 20 Mar 2007 17:31:13 +0100
From: Pavel Machek <>
Subject: Re: strange keyboard lag after suspend testing
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/3/20/189

Hi!
> >> > I was testing suspend in 2.6.21-rc4 a lot, and now... machine feels
> >> > like someone added 50..100msec delay somewhere in keyboard
> >> > handling. Mouse does not seem affected. /proc/interrupts seem to
> >> > increase as they should, for both keyboard and mouse. Can someone
> >> > reproduce it? Any ideas how to debug it?
> >>
> >> Probably just asking the obvious:
> >> it's not a trivial "failed to re-configure repeat rate upon resume"
> >> (which one could rule out by running "kbdrate" again)
> >> but a lag in some interrupt handler or somewhere else deeper, right?
> >
> >No, it is not keyboard rate. Keyboard lags during normal typing,
> >sometimes letters come in groups of two or so...
> 
> I might start looking at embedded controller changes and switches. If
> ACPI misbehaves that could starve keyboard controller... But you
> said
Mouse _seems_ okay, but I'm not sure if I'd notice lag there.
> that mouse is OK... Hmm, what happens if you load evbug and type while
> watching syslog. Do you observe the same delays?
Hmm, seems that it only happens in X... so maybe it is some strange
scheduling artefact?
Hmm, something is wrong here:
On console, I get expected 4-5 ticks a second. In x in gnome-terminal,
I get this:
root@amd:~# while true ; do echo -n . ; sleep .2; date; done
.Tue Mar 20 17:28:34 CET 2007
.Tue Mar 20 17:28:35 CET 2007
.Tue Mar 20 17:28:35 CET 2007
.Tue Mar 20 17:28:35 CET 2007
.Tue Mar 20 17:28:36 CET 2007
.Tue Mar 20 17:28:36 CET 2007
.Tue Mar 20 17:28:36 CET 2007
.Tue Mar 20 17:28:36 CET 2007
.Tue Mar 20 17:28:37 CET 2007
.Tue Mar 20 17:28:37 CET 2007
.Tue Mar 20 17:28:37 CET 2007
.Tue Mar 20 17:28:37 CET 2007
.Tue Mar 20 17:28:38 CET 2007
.Tue Mar 20 17:28:38 CET 2007
.Tue Mar 20 17:28:38 CET 2007
.Tue Mar 20 17:28:39 CET 2007
.Tue Mar 20 17:28:39 CET 2007
.Tue Mar 20 17:28:39 CET 2007
.Tue Mar 20 17:28:39 CET 2007
.Tue Mar 20 17:28:39 CET 2007
.Tue Mar 20 17:28:40 CET 2007
.Tue Mar 20 17:28:40 CET 2007
.Tue Mar 20 17:28:40 CET 2007
.Tue Mar 20 17:28:40 CET 2007
.Tue Mar 20 17:28:41 CET 2007
.Tue Mar 20 17:28:41 CET 2007
.Tue Mar 20 17:28:41 CET 2007
.Tue Mar 20 17:28:42 CET 2007
.Tue Mar 20 17:28:42 CET 2007
So sorry for false alarm, it is not keyboard related, it is just very
very strange.
									Pavel
-- 
(english) 
http://www.livejournal.com/~pavelmachek
(cesky, pictures) 
http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/