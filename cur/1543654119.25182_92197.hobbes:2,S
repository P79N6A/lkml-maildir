Date: Mon, 25 Nov 2002 13:09:34 -0800
From: Matthew Dobson <>
Subject: [patch] Fix panic on multi-node / NUMA machines
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/11/25/123

Linus,
	2.5.49 panics on multi-node machines because of an mistake in the order 
topology drivers/devclasses are registered with sysfs.  This patch fixes 
the problem.
Please apply.
Cheers!
-Matt
diff -Nur linux-2.5.49-vanilla/drivers/base/memblk.c linux-2.5.49-test/drivers/base/memblk.c
--- linux-2.5.49-vanilla/drivers/base/memblk.c	Fri Nov 22 13:41:12 2002
+++ linux-2.5.49-test/drivers/base/memblk.c	Mon Nov 25 13:32:31 2002
@@ -49,7 +49,7 @@
 
 static int __init register_memblk_type(void)
 {
-	driver_register(&memblk_driver);
-	return devclass_register(&memblk_devclass);
+	devclass_register(&memblk_devclass);
+	return driver_register(&memblk_driver);
 }
 postcore_initcall(register_memblk_type);
diff -Nur linux-2.5.49-vanilla/drivers/base/node.c linux-2.5.49-test/drivers/base/node.c
--- linux-2.5.49-vanilla/drivers/base/node.c	Fri Nov 22 13:40:21 2002
+++ linux-2.5.49-test/drivers/base/node.c	Mon Nov 25 13:32:04 2002
@@ -93,7 +93,7 @@
 
 static int __init register_node_type(void)
 {
-	driver_register(&node_driver);
-	return devclass_register(&node_devclass);
+	devclass_register(&node_devclass);
+	return driver_register(&node_driver);
 }
 postcore_initcall(register_node_type);