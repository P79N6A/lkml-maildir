Date: Thu, 10 Jul 2003 12:04:17 +0200 (CEST)
From: Etienne Lorrain <>
Subject: memset (was: Redundant memset in AIO read_events)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/7/10/58

 Note that using memset() is better reserved to initialise variable-size
 structures or buffers. Even if memset() is extremely optimised,
 it is still not as fast as not doing anything.
read_events(...) {
   struct io_event ent;
   memset(&ent, 0, sizeof(ent));
   while (...) {
      aio_read_evt(ctx, &ent);
   }
   ...
}
 Should be written (when "ent" has to be cleared):
read_events(...) {
   struct io_event ent = {};
   while (...) {
      aio_read_evt(ctx, &ent);
   }
   ...
}
  Just compare the code generated by (using GCC):
   struct io_event ent;
   memset(&ent, 0, sizeof(ent));
   ent.data = 0;
   if (ent.obj != 0) printf ("bad");
  And:
   struct io_event ent = {};
   ent.data = 0;
   if (ent.obj != 0) printf ("bad");
  and that is even without speaking of complete variable elimination
 when the structure is not used, unknown pointer alignement when
 memset function is not inlined, or aliasing optimisation.
  Etienne.
___________________________________________________________
Do You Yahoo!? -- Une adresse @yahoo.fr gratuite et en fran√ßais !
Yahoo! Mail : 
http://fr.mail.yahoo.com
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/