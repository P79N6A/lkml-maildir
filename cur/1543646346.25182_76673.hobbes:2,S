Date: Fri, 4 Oct 2002 14:52:22 -0700
From: Greg KH <>
Subject: Re: [BK PATCH] pcibios_* removals for 2.5.40
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/4/330

On Fri, Oct 04, 2002 at 05:34:40PM -0400, Jeff Garzik wrote:
> Greg KH wrote:
> >@@ -1563,13 +1562,11 @@
> > 
> >     if (pci_present()) {
> 
> an example of pci_present() that can be eliminated, as I described earlier
I agree I could have done more invasive work on these drivers, they sure
need it :)
But I was going for a minimal set of patches to remove the pcibios_*
functions and still let things work.
> > 	for (i = 0; i < NPCI_CHIP_IDS; ++i) 
> >-	    for (pci_index = 0;
> >-		!pcibios_find_device (PCI_VENDOR_ID_NCR, 
> >-		    pci_chip_ids[i].pci_device_id, pci_index, &pci_bus, 
> >-		    &pci_device_fn); 
> >-    		++pci_index)
> >+	    while ((pdev = pci_find_device (PCI_VENDOR_ID_NCR,
> >+					    pci_chip_ids[i].pci_device_id,
> >+					    pdev)))
> > 		if (!ncr_pci_init (tpnt, BOARD_GENERIC, 
> > 		pci_chip_ids[i].chip, -		    pci_bus, pci_device_fn, /* no 
> >options */ 0))
> >+		    pdev->bus->number, pdev->devfn, /* no options */ 0))
> 
> 
> can you eliminate the need of ncr_pci_init to have number/devfn args?
No, it wouldn't be that easy, as that function is called from other
places.  That driver needs some major work, as it still is not converted
over to the proper DMA fixes that went into the tree a long time ago.
thanks,
greg k-h
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/