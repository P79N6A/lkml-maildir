Date: Fri, 05 Dec 2008 12:32:02 -0800 (PST)
From: David Miller <>
Subject: Re: [PATCH] percpu_counter: FBC_BATCH might be too big
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/5/291

From: Eric Dumazet <dada1@cosmosbay.com>
Date: Fri, 05 Dec 2008 17:05:16 +0100
> For NR_CPUS >= 16 values, FBC_BATCH is 2*NR_CPUS
> 
> Considering more and more distros are using high NR_CPUS values,
> it makes sense to use a more sensible value for FBC_BATCH.
> 
> A sensible value is 2*num_online_cpus(), with a minimum value of 32
> (This minimum value helps branch prediction in __percpu_counter_add())
> 
> We already have a hotcpu notifier, so we can adjust FBC_BATCH dynamically.
> 
> Signed-off-by: Eric Dumazet <dada1@cosmosbay.com>
The downside is now we must load this value in these common
routines.  But I think the gain outweights the loss so:
Acked-by: David S. Miller <davem@davemloft.net>