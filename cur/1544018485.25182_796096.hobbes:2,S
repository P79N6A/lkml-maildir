Date: Thu, 22 Jan 2009 20:17:19 -0500
From: Jeff Layton <>
Subject: Re: [linux-cifs-client] [PATCH] cifs: wrap cifs_dnotify_thread in  CONFIG_BROKEN
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2009/1/22/451

On Thu, 22 Jan 2009 17:56:09 -0600
Steve French <smfrench@gmail.com> wrote:
> One of the obvious reasons that we could throw away the idea of a cifs
> dnotify thread for cifs is if we could guarantee that all of the
> functions in include/linux/fsnotify.h are nonblocking.  If the
> fsnotify.h worker functions are nonblocking then we could safely
> process all of the notify responses in cifs_demultiplex_thread (since
> we wouldn't have to queue them) without clogging up response
> processing for the socket.   Note that notify responses are unusual -
> they don't have an application thread waiting on them ("multishot"
> responses) typically (there is only one other type of SMB response
> that does not have an application thread associated with it).
> 
I'm not arguing against the need for a kthread to handle notifications.
Heck, I'm even ok with more than one thread if it's necessary.
We simply don't have such an implementation today. Until we do, this
kthread is just dead weight. There's simply no need to keep this in
place until we have working code that uses it.
-- 
Jeff Layton <jlayton@redhat.com>