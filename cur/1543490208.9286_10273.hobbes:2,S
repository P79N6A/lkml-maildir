Date: Wed, 17 Mar 1999 13:03:27 +0100
From: Vojtech Pavlik <>
Subject: Re: /dev/psaux troubles with 2.2.2
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/3/17/89

On Wed, Mar 17, 1999 at 12:57:40PM +0100, Ralf Corsepius wrote:
> > Another idea - could it be that there is a bug in the implementation of
> > the 'put mouse buffer' command on that motherboard that puts the byte
> > into the keyboard buffer instead? It'd be interesting to check that.
> 
> Unfortunately, I am not knowledgeable on psaux controllers.
> 
> If somebody provides me with a piece of code, I would be willing to
> help/try/test.
Try this:
--- pc_keyb.c.orig	Wed Mar 17 12:58:51 1999
+++ pc_keyb.c	Wed Mar 17 13:01:07 1999
@@ -753,11 +753,8 @@
 	outb(0x5a, KBD_DATA_REG); /* 0x5a is a random dummy value. */
 
 	do {
-		unsigned char status = inb(KBD_STATUS_REG);
-
-		if (status & KBD_STAT_OBF) {
-			(void) inb(KBD_DATA_REG);
-			if (status & KBD_STAT_MOUSE_OBF) {
+		if (inb(KBD_STATUS_REG) & KBD_STAT_OBF) {
+			if (inb(KBD_DATA_REG) == 0x5a) {
 				printk(KERN_INFO "Detected PS/2 Mouse Port.\n");
 				retval = 1;
 			}
Have fun,
	Vojtech
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/