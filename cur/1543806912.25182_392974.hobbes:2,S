Date: Thu, 2 Feb 2006 18:28:17 -0500
From: Chuck Ebbert <>
Subject: Re: 2.6.16-rc1-mm4 i386 atomic operations broken on SMP (in  modules at least)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/2/2/409

In-Reply-To: <20060202135205.08d91b76.akpm@osdl.org>
On Thu, 2 Feb 2006 at 13:52:05 -0800, Andrew Morton wrote:
> Chuck Ebbert <76306.1226@compuserve.com> wrote:
> > 
> > SMP alternatives is re-using the constant_tsc X86 feature bit.
> > 
> 
> Darn, how did you spot that?
I went looking for which bit represented X86_FEATURE_UP and there
it was...
>
> Should `feature_up' appear in /proc/cpuinfo?
Probably.  The bug would have been nearly impossible if that had
been done to begin with.
i386: show x86 feature "up" in cpuinfo
Show feature bit "up" (SMP kernel running on uniprocessor) in
/proc/cpuinfo.
Signed-off-by: Chuck Ebbert <76306.1226@compuserve.com>
--- 2.6.16-rc1-mm4-386.orig/arch/i386/kernel/cpu/proc.c
+++ 2.6.16-rc1-mm4-386/arch/i386/kernel/cpu/proc.c
@@ -40,7 +40,7 @@ static int show_cpuinfo(struct seq_file 
 		/* Other (Linux-defined) */
 		"cxmmx", "k6_mtrr", "cyrix_arr", "centaur_mcr",
 		NULL, NULL, NULL, NULL,
-		"constant_tsc", NULL, NULL, NULL, NULL, NULL, NULL, NULL,
+		"constant_tsc", "up", NULL, NULL, NULL, NULL, NULL, NULL,
 		NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL,
 		NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL,
 
-- 
Chuck
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/