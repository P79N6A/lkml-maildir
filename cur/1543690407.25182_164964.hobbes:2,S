Date: Wed, 10 Sep 2003 22:22:32 +0100
From: Jon Fairbairn <>
Subject: Omnibook PCMCIA slots unusable after suspend.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/9/10/327

[I'm not subscribed, so please Cc me in any replies]
In short: I'm using an HP Ombibook 800CT, have started using
a Carbus PCMCIA network card and am losing the card after
suspends.
I've tried searching lkml for similar things but didn't find
anything that seemed close enough, so here's a little more
detail (though I don't want to add too much until I know you
want to hear about it).
"modprobe yenta_socket" normally logs:
Sep  4 21:39:10 graffito kernel: Linux Kernel Card Services 3.1.22
Sep  4 21:39:10 graffito kernel:   options:  [pci] [cardbus] [pm]
Sep  4 21:39:10 graffito kernel: PCI: Found IRQ 9 for device 00:04.0
Sep  4 21:39:10 graffito kernel: PCI: Found IRQ 7 for device 00:04.1
Sep  4 21:39:10 graffito kernel: Yenta IRQ list 0448, PCI irq9
Sep  4 21:39:10 graffito kernel: Socket status: 30000020
Sep  4 21:39:10 graffito kernel: Yenta IRQ list 0448, PCI irq7
Sep  4 21:39:10 graffito kernel: Socket status: 30000006
but after "apm --suspend" I get the same except:
Sep  6 23:23:55 graffito kernel: Socket status: 66012d18
...
Sep  6 23:23:55 graffito kernel: Socket status: 2a035c8a
The effect of this is that it can't see anything in the
socket, so I can't get it to load the driver for the PCMCIA
card.  It only happens if the machine has been on battery
power during the suspend. It doesn't happen if the socket is
set to PCIC mode in the BIOS, though in that case I can't
use the card anyway. It happens whether or not the card is
present, and whether or not cardmgr is running, and it
happens in 2.4.21, 2.4.22 and 2.6.0-test4.
Rebooting without powering off clears the condition, but
nothing else I've tried (cardctl eject &c, loading and
unloading modules round the suspend, using setpci to restore
the registers of the bridge, passing do_apm=0 to
pcmcia_core) makes any difference.
The card in question is a netgear FA511, but I don't think
that's relevant as the problem happens even if I don't plug
it in until after the suspend, and so long as yenta_socket
reports a sensible status it works fine (with the tulip
driver). 
Please let me know if you need more information.
Thanks,
   Jón
-- 
Jón Fairbairn
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/