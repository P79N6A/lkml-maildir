Date: Tue, 27 Nov 2001 09:02:24 +0100
From: "Marco Berizzi" <>
Subject: Kernel Panic: too few segs for DMA mapping increase AHC_NSEG
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2001/11/27/340

I have upgraded my PC from 768MB RAM to 1GB.
I have recompiled the kernel (2.4.16) for hi mem support (4GB).
I have several file system on the same disk (vfat file system). I have
compiled vfat driver both in the main kernel and as a module. When I
load the module I issue a
'modprobe vfat' and I get this message (only with hi mem kernel
support):
Warning: loading /lib/modules/2.4.16/kernel/fs/vfat/vfat.o will taint
the kernel: no license
 I'm using Slackware 8.0. + modutils 2.4.12
Then if I try to copy a file from that filesystem to the root filesystem
I get this error:
Kernel panic: too few segs for DMA mappings increase AHC_NSEG
Kernel panic: too few segs for DMA mappings increase AHC_NSEG
Usually this is the procedure:
root login
modprobe vfat
mount /dev/sda2 /mnt   (to mount the fat partition)
cd /usr/src
cp /mnt/linux/kernel/linux-2.2.20.tar.bz2 . (I want to copy kernel
source tarball from the vfat partition to /usr/src)
CRASH..........
Then the system freeze completely, so I press the reset button.
At the startup INIT calls fsck and when the checking is at about 55% it
displays this message:
SCSI1:A:0:0 locking max tag count at 128
then the following startup procedure goes well.
Kernel 2.2.20 works perfectly, both with and without hi mem support.
My MB is ABIT KT7A (bios rev ID 65  11/07/2001). Two 512 MB SDRAM
(takei).
Other HW: AHA 39160, SCSI IBM HD DDYS 18130, Matrox G450.
gcc version 2.95.3
If I compile a kernel without hi mem support all is fine.
Attach contain .config
[unhandled content-type:application/octet-stream]