Date: Tue, 17 Oct 2006 12:11:27 -0600
From: (Eric W. Biederman)
Subject: [PATCH] x86_64: Put more than one cpu in TARGET_CPUS
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/17/205

TARGET_CPUS is the default irq routing poicy.  It specifies which cpus
the kernel should aim an irq at.  In physflat delivery mode we can
route an irq to a single cpu.  But that doesn't mean our default
policy should only be a single cpu is allowed. 
By allowing the irq routing code to select from multiple cpus this
enables systems with more irqs then we can service on a single
processor to actually work. 
I just audited and tested the code and irqbalance doesn't care, and
the io_apic.c doesn't care if we have extra cpus in the mask.
Everything will use or assume we are using the lowest numbered cpu in
the mask if we can't use them all.
So this should result in no behavior changes except on systems that need it.
Thanks for YH Lu for spotting this problem in his testing.
Cc: Yinghai Lu <yinghai.lu@amd.com>
Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
---
 arch/x86_64/kernel/genapic_flat.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)
diff --git a/arch/x86_64/kernel/genapic_flat.c b/arch/x86_64/kernel/genapic_flat.c
index 0dfc223..7c01db8 100644
--- a/arch/x86_64/kernel/genapic_flat.c
+++ b/arch/x86_64/kernel/genapic_flat.c
@@ -153,7 +153,7 @@ struct genapic apic_flat =  {
 
 static cpumask_t physflat_target_cpus(void)
 {
-	return cpumask_of_cpu(0);
+	return cpu_online_map;
 }
 
 static cpumask_t physflat_vector_allocation_domain(int cpu)
-- 
1.4.2.rc3.g7e18e-dirty
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/