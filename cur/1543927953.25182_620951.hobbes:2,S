Date: Sun, 25 Nov 2007 11:21:45 +0100
From: Prakash Punnoor <>
Subject: Re: [PATCH 1/2] msi: set 'En' bit of MSI Mapping Capability on HT platform
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/11/25/14

Hi,
> According to the HyperTransport spec, 'En' indicate if the MSI Mapping is
> active. So it should be set when enable the MSI.
Great! This is what I needed to get MSI going on my MCP51 board. I added some 
ids, but I think there were not necessary, as I only got
PCI: 0000:00:00.0: enabled HT MSI mapping
PCI: 0000:00:10.1: enabled HT MSI mapping
were those devices are:
00:00.0 RAM memory: nVidia Corporation C51 Host Bridge (rev a2)
        Subsystem: ASUSTeK Computer Inc. Unknown device 81c0
        Flags: bus master, 66MHz, fast devsel, latency 0
        Capabilities: [44] HyperTransport: Slave or Primary Interface
        Capabilities: [e0] HyperTransport: MSI Mapping Enable+ Fixed-
00: de 10 f0 02 06 00 b0 00 a2 00 00 05 00 00 80 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 43 10 c0 81
30: 00 00 00 00 44 00 00 00 00 00 00 00 ff 00 00 00
According to your patch, you named this device
+#define PCI_DEVICE_ID_NVIDIA_NFORCE_C51_MEMC0   0x02F0
So is the lspci database not correct or your naming? lspci lists some 
memcontrollers for me, but they don't seem to have MSI specific items.
00:10.1 Audio device: nVidia Corporation MCP51 High Definition Audio (rev a2)
        Subsystem: ASUSTeK Computer Inc. Unknown device 81cb
        Flags: bus master, 66MHz, fast devsel, latency 0, IRQ 319
        Memory at fe024000 (32-bit, non-prefetchable) [size=16K]
        Capabilities: [44] Power Management version 2
        Capabilities: [50] Message Signalled Interrupts: Mask+ 64bit+ 
Queue=0/0 Enable+
        Capabilities: [6c] HyperTransport: MSI Mapping Enable+ Fixed+
00: de 10 6c 02 06 04 b0 00 a2 00 03 04 00 00 80 00
10: 00 40 02 fe 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 43 10 cb 81
30: 00 00 00 00 44 00 00 00 00 00 00 00 05 02 02 05
Yay:
cat /proc/interrupts
319:         26       9357   PCI-MSI-edge      HDA Intel
So, now sata_nv and nvidia binary graphics driver could activate MSI, as 
well. :-)
One thing I noticed in the patch:
+		if (((bridge_dev = pci_find_slot(0, 0)) != NULL) &&
You rather want to use pci_get_bus_and_slot instead, as pci_find_slot is 
deprecated.
Thanks!
-- 
(°=                 =°)
//\ Prakash Punnoor /\\
V_/                 \_V
[unhandled content-type:application/pgp-signature]