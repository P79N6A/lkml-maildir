Date: Sun, 22 Oct 2006 17:45:33 +0200
From: Németh Márton <>
Subject: [patch] input: function call order in serio_exit()
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/10/22/73

Hi,
the order of the bus registration and the kthread start was changed
between linux kernel 2.6.17.11 and 2.6.18. The order is now first
register the bus and then start the kthread. The serio_exit() left
unchanged.
I think that the order of the function calls in serio_exit() should also
be changed: first stop the kthread and then unregister the bus.
What do you think?
	NMarci
--- linux-2.6.19-rc2.orig/drivers/input/serio/serio.c	2006-10-13 18:25:04.000000000 +0200
+++ linux-2.6.19-rc2/drivers/input/serio/serio.c	2006-10-17 08:17:30.000000000 +0200
@@ -958,8 +958,8 @@ static int __init serio_init(void)
 
 static void __exit serio_exit(void)
 {
-	bus_unregister(&serio_bus);
 	kthread_stop(serio_task);
+	bus_unregister(&serio_bus);
 }
 
 subsys_initcall(serio_init);