Date: Mon, 10 Nov 2008 22:35:07 +0100
From: "Alexander van Heukelum" <>
Subject: Re: [PATCH RFC/RFB] x86_64, i386: interrupt dispatch changes
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/11/10/302

On Mon, 10 Nov 2008 14:07:09 +0100, "Ingo Molnar" <mingo@elte.hu> said:
> * Alexander van Heukelum <heukelum@fastmail.fm> wrote:
> > On Mon, 10 Nov 2008 09:58:46 +0100, "Ingo Molnar" <mingo@elte.hu> said:
> > > * Alexander van Heukelum <heukelum@fastmail.fm> wrote:
> > > > Hi all,
> > > > 
> > > > I have spent some time trying to find out how expensive the 
> > > > segment-switching patch was. I have only one computer available at 
> > > > the time: a "Sempron 2400+", 32-bit-only machine.
> > > > 
> > > > Measured were timings of "hackbench 10" in a loop. The average was 
> > > > taken of more than 100 runs. Timings were done for two seperate 
> > > > boots of the system.
> > 
> > Hi Ingo,
> > 
> > I guess you just stopped reading here?
> 
> yeah, sorry! You describe and did exactly the kind of histogram that i 
> wanted to see done ;-)
I thought so ;).
> I'm not sure i can read out the same thing from the result though. 
> Firstly, it seems the 'after' histograms are better, because there the 
> histogram shifted towards shorter delays. (i.e. lower effective irq 
> entry overhead)
> 
> OTOH, unless i'm misreading them, it's a bit hard to compare them 
> visually: the integral of the histograms does not seem to be constant, 
> they dont seem to be normalized.
The total number of measured intervals (between two almost-adjacent
rdtsc's) is exactly the same for all histograms (10^10). Almost all
measurements are of the "nothing happened" type, i.e., around 11
clock cycles on this machine. The user time spent inside the
rdtsctest program is almost independent of the load, but it
measures time spent outside of the program... But what should be
attributed to what effect is unclear to me at the moment.
> It should be made constant for them to be comparable. (i.e. the total 
> number of irq hits profiled should be equal - or should be normalized 
> with the sum after the fact)
Basically the difference between the "idle" and "hack10" versions
should indicate the effect of extra interrupts (timer) and additional
exceptions and cache effects due to context switching.
Thanks,
    Alexander
> 	Ingo
-- 
  Alexander van Heukelum
  heukelum@fastmail.fm
-- 
http://www.fastmail.fm
 - I mean, what is it about a decent email service?