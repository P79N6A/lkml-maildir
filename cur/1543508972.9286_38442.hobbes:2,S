Date: Sat, 11 Sep 1999 16:50:11 -0400 (EDT)
From: "Steven N. Hirsch" <>
Subject: Re: 2.2.13-pre6
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/1999/9/11/113

On Sat, 11 Sep 1999, Jens Axboe wrote:
> > The VM pops up an error dialog, and its own log captures:
> > 
> > Sep 11 12:20:29: Forking AIO IDE1:0 pid=1150 sharedArea=0x41554000 size=0x1000
> > Sep 11 12:20:29: CDROM: Verify Ioctl '/dev/cdrom' failed: 'Function not implemented'
> > 
> > Then, VM gives up.. (from /var/log/messages again):
> > 
> > Sep 11 12:20:29 pii kernel: cdrom: entering cdrom_release 
> 
> The log doesn't tell you what ioctl it failed? I think that this
> hunk of the patch might be responsible, could you try reversing
> it and giving it a second go?
I assumed (perhaps naively) that 'Verify' was the name of an ioctl.  But,
no, it doesn't say any more than what I posted previously.
> @@ -875,7 +883,7 @@
> 
>  	case CDROM_DRIVE_STATUS: {
>  		cdinfo(CD_DO_IOCTL, "entering CDROM_DRIVE_STATUS\n"); 
> -		if (!(cdo->capability & CDC_DRIVE_STATUS))
> +		if (!CDROM_CAN(CDC_DRIVE_STATUS))
>  			return -ENOSYS;
>                  if ((arg == CDSL_CURRENT) || (arg == CDSL_NONE)) 
>  			return cdo->drive_status(cdi, arg);
Yup.  Reverting the patch above fixed the problem.
Here are the logs now.
Autofs mounts the cd:
Sep 11 16:38:11 pii automount[986]: attempting to mount entry /misc/cd
Sep 11 16:38:11 pii kernel: cdrom: entering cdrom_open 
Sep 11 16:38:11 pii kernel: cdrom: entering open_for_data 
Sep 11 16:38:11 pii kernel: cdrom: drive_status=4 
Sep 11 16:38:11 pii kernel: cdrom: entering cdrom_count_tracks 
Sep 11 16:38:11 pii kernel: cdrom: track 1: format=2, ctrl=4 
Sep 11 16:38:11 pii kernel: cdrom: disc has 1 tracks: 0=audio 1=data 0=Cd-I 0=XA 
Sep 11 16:38:11 pii kernel: cdrom: all seems well, opening the device. 
Sep 11 16:38:11 pii kernel: cdrom: opening the device gave me 0. 
Sep 11 16:38:11 pii kernel: cdrom: door locked. 
Sep 11 16:38:11 pii kernel: cdrom: device opened successfully. 
Sep 11 16:38:11 pii kernel: cdrom: Use count for "/dev/hdc" now 1 
Sep 11 16:38:11 pii kernel: cdrom: entering CDROMMULTISESSION 
Sep 11 16:38:11 pii kernel: cdrom: CDROMMULTISESSION successful 
VMware session is started:
Sep 11 16:38:22 pii kernel: cdrom: entering cdrom_open 
Sep 11 16:38:22 pii kernel: cdrom: Use count for "/dev/hdc" now 2 
Sep 11 16:38:22 pii kernel: cdrom: entering CDROMVOLREAD 
Sep 11 16:38:22 pii kernel: cdrom: entering cdrom_release 
Sep 11 16:38:22 pii kernel: cdrom: entering cdrom_open 
Sep 11 16:38:22 pii kernel: cdrom: Use count for "/dev/hdc" now 2 
Sep 11 16:38:22 pii kernel: cdrom: entering CDROM_SET_OPTIONS 
Sep 11 16:38:22 pii kernel: cdrom: entering CDROM_CLEAR_OPTIONS 
Sep 11 16:38:22 pii kernel: cdrom: entering cdrom_release 
Sep 11 16:38:22 pii kernel: cdrom: entering cdrom_open 
Sep 11 16:38:22 pii kernel: cdrom: Use count for "/dev/hdc" now 2 
Sep 11 16:38:22 pii kernel: cdrom: Unlocking door. 
Sep 11 16:38:22: Forking AIO IDE1:0 pid=2044 sharedArea=0x4157c000 size=0x1000
Sep 11 16:38:22: ATAPI_CDROM: cdrom.modeSenseInterval=8
Sep 11 16:38:30 pii kernel: cdrom: entering CDROM_DRIVE_STATUS 
Sep 11 16:38:30 pii kernel: cdrom: entering CDROM_MEDIA_CHANGED 
Sep 11 16:38:30 pii kernel: cdrom: entering cdrom_open 
Sep 11 16:38:30 pii kernel: cdrom: entering open_for_data 
Sep 11 16:38:30 pii kernel: cdrom: drive_status=4 
Sep 11 16:38:30 pii kernel: cdrom: entering cdrom_count_tracks 
Sep 11 16:38:30 pii kernel: cdrom: track 1: format=2, ctrl=4 
Sep 11 16:38:30 pii kernel: cdrom: disc has 1 tracks: 0=audio 1=data 0=Cd-I 0=XA 
Sep 11 16:38:30 pii kernel: cdrom: all seems well, opening the device. 
Sep 11 16:38:30 pii kernel: cdrom: opening the device gave me 0. 
Sep 11 16:38:30 pii kernel: cdrom: device opened successfully. 
Sep 11 16:38:30 pii kernel: cdrom: Use count for "/dev/hdc" now 3 
Sep 11 16:38:30 pii kernel: cdrom: entering CDROMMULTISESSION 
Sep 11 16:38:30 pii kernel: cdrom: CDROMMULTISESSION successful 
Sep 11 16:38:32 pii kernel: cdrom: Unlocking door. 
Sep 11 16:38:32 pii kernel: cdrom: entering cdrom_release 
Sep 11 16:39:00 pii kernel: cdrom: entering CDROM_DRIVE_STATUS 
Sep 11 16:39:00 pii kernel: cdrom: entering CDROM_MEDIA_CHANGED 
Sep 11 16:39:00 pii kernel: cdrom: entering cdrom_open 
Sep 11 16:39:00 pii kernel: cdrom: entering open_for_data 
Sep 11 16:39:00 pii kernel: cdrom: drive_status=4 
Sep 11 16:39:00 pii kernel: cdrom: entering cdrom_count_tracks 
Sep 11 16:39:00 pii kernel: cdrom: track 1: format=2, ctrl=4 
Sep 11 16:39:00 pii kernel: cdrom: disc has 1 tracks: 0=audio 1=data 0=Cd-I 0=XA 
Sep 11 16:39:00 pii kernel: cdrom: all seems well, opening the device. 
Sep 11 16:39:00 pii kernel: cdrom: opening the device gave me 0. 
Sep 11 16:39:00 pii kernel: cdrom: device opened successfully. 
Sep 11 16:39:00 pii kernel: cdrom: Use count for "/dev/hdc" now 3 
and VM:
Sep 11 16:39:00: ATAPI_CDROM: Mode Sense (Almost) Completely Emulated.
Sep 11 16:39:00: ATAPI_CDROM: Mode Sense Packet 0x5A 0x0 0x1B 0x0 0x0 0x0 0x0 0x0 0x14 0x0 0x0 0x0
Sep 11 16:39:00: ATAPI_CDROM: Mode Sense for Unsupported Page 0x1B
Sep 11 16:39:01: ATAPI_CDROM: Mode Sense (Almost) Completely Emulated.
Sep 11 16:39:01: ATAPI_CDROM: Mode Sense Packet 0x5A 0x0 0x1 0x0 0x0 0x0 0x0 0x0 0x14 0x0 0x0 0x0
Sep 11 16:39:01: ATAPI_CDROM: Mode Sense (Almost) Completely Emulated.
Sep 11 16:39:01: ATAPI_CDROM: Mode Sense Packet 0x5A 0x0 0x1 0x0 0x0 0x0 0x0 0x0 0x18 0x0 0x0 0x0
Perhaps the rest of the trace will provide a clue?  BTW, why is the door
being unlocked so frequently?  I thought it needed to stay locked until
all references were released.
> For what it's worth, VMWare works flawlessly on my drives.
Hey, like Linus says, ".. works for me!"(tm) <g>.
Many thanks!
Steve
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at 
http://www.tux.org/lkml/