Date: Sat, 26 Oct 2002 10:11:45 -0700
From: Greg KH <>
Subject: Re: 2.5.44-ac3 usb audio - illegal sleep call
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/10/26/93

On Sat, Oct 26, 2002 at 10:13:52AM -0400, Kevin Brosius wrote:
> I've been trying to get USB up to test a audio device and just managed
> to get it all working to some extent.  When using xmms to play audio
> (usb audio module - oss soundcore) I see the following kernel messages
> repeatedly, maybe once a second or so:
Can you try this patch and let us know if it fixes your problem?
thanks,
greg k-h
===== drivers/usb/class/audio.c 1.43 vs edited =====
--- 1.43/drivers/usb/class/audio.c	Fri Oct 18 21:31:28 2002
+++ edited/drivers/usb/class/audio.c	Sat Oct 26 10:22:43 2002
@@ -914,7 +914,7 @@
 	if (!usbin_retire_desc(u, urb) &&
 	    u->flags & FLG_RUNNING &&
 	    !usbin_prepare_desc(u, urb) && 
-	    (suret = usb_submit_urb(urb, GFP_KERNEL)) == 0) {
+	    (suret = usb_submit_urb(urb, GFP_ATOMIC)) == 0) {
 		u->flags |= mask;
 	} else {
 		u->flags &= ~(mask | FLG_RUNNING);
@@ -1274,7 +1274,7 @@
 	if (!usbout_retire_desc(u, urb) &&
 	    u->flags & FLG_RUNNING &&
 	    !usbout_prepare_desc(u, urb) && 
-	    (suret = usb_submit_urb(urb, GFP_KERNEL)) == 0) {
+	    (suret = usb_submit_urb(urb, GFP_ATOMIC)) == 0) {
 		u->flags |= mask;
 	} else {
 		u->flags &= ~(mask | FLG_RUNNING);
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/