Date: Wed, 19 Jun 2002 02:53:00 -0500
From: Felipe Contreras <>
Subject: [PATCH] Compaq hotplug fix for 2.5.23
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/6/19/59

Hi,
This one makes posible to compile the compaq hotplug module.
-- 
Felipe Contreras
diff -ur linux-2.5.23/drivers/hotplug/cpqphp.h linux-shx/drivers/hotplug/cpqphp.h
--- linux-2.5.23/drivers/hotplug/cpqphp.h	Sun Jun  9 00:28:26 2002
+++ linux-shx/drivers/hotplug/cpqphp.h	Wed Jun 19 02:13:23 2002
@@ -30,6 +30,7 @@
 
 #include "pci_hotplug.h"
 #include <asm/io.h>		/* for read? and write? functions */
+#include <linux/tqueue.h>
 
 
 #if !defined(CONFIG_HOTPLUG_PCI_COMPAQ_MODULE)
diff -ur linux-2.5.23/drivers/hotplug/cpqphp_pci.c linux-shx/drivers/hotplug/cpqphp_pci.c
--- linux-2.5.23/drivers/hotplug/cpqphp_pci.c	Sun Jun  9 00:31:23 2002
+++ linux-shx/drivers/hotplug/cpqphp_pci.c	Wed Jun 19 02:13:24 2002
@@ -37,6 +37,8 @@
 #include "cpqphp_nvram.h"
 #include "../../arch/i386/pci/pci.h"	/* horrible hack showing how processor dependant we are... */
 
+#define TRUE  1
+#define FALSE 0
 
 u8 cpqhp_nic_irq;
 u8 cpqhp_disk_irq;
@@ -150,7 +152,7 @@
 	//Notify the drivers of the change
 	if (temp_func->pci_dev) {
 		pci_proc_attach_device(temp_func->pci_dev);
-		pci_announce_device_to_drivers(temp_func->pci_dev);
+		run_sbin_hotplug(temp_func->pci_dev, TRUE);
 	}
 
 	return 0;
diff -ur linux-2.5.23/drivers/pci/hotplug.c linux-shx/drivers/pci/hotplug.c
--- linux-2.5.23/drivers/pci/hotplug.c	Sun Jun  9 00:31:22 2002
+++ linux-shx/drivers/pci/hotplug.c	Wed Jun 19 02:12:33 2002
@@ -101,3 +101,4 @@
 
 EXPORT_SYMBOL(pci_insert_device);
 EXPORT_SYMBOL(pci_remove_device);
+EXPORT_SYMBOL(run_sbin_hotplug);