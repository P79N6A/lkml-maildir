Date: Fri, 30 Aug 2002 09:48:25 +1000
From: Stephen Rothwell <>
Subject: Re: PROBLEM:  conflict between apm and system clock on Inspiron 8100
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/8/29/255

Hi Mike,
On Thu, 29 Aug 2002 10:19:41 -0700 (PDT) mike heffner <mdheffner@yahoo.com> wrote:
>
>   I have timed the "cat /proc/apm" to take at least
> 36ms on my inspiron 8100 using an external clock.  I
> shut down my ntp daemon so the clock is free running. 
> I then did "ntpdate -q clock".  With no calls to apm
> the number returned is rather stable over a few
> minuites with multiple ntpdate calls.  I then execute
> 10 times "cat /proc/apm" and do "ntpdate -q clock"
> again.  I take the difference and divide by 10.  That
> gives me an average of about 36ms, or 3 to 4
> interrupts missed for each call.
Interesting ... My timings were, of course, very suspect ...
>   Last night I also ran though all of Dell's BIOSs.  I
> installed each of the 8 or so of them on there web
> site.  A few of them broke apm, but none fixed this
> problem.  If we are sure the BIOS is the problem, I
> will continue to pester Dell.  So just to verify, you
> are *not* disabling interrupts in the kernel for an
> apm call?  I am still trying to understand the code.
>   I have also tried kernel 2.4.2-2.  I don't remember
> this problem with an earlier installation I had on
> this laptop.  It turns out it is still a problem with
> that kernel version.  I am currently using 2.4.18-10.
OK, for the Dells, we autodetect the 4000 series and allow
interrupts during BIOS calls, but not the 8000's (unless
your RedHat patched kernel does this).  So could you try
booting with "apm=allow_ints" on the command line (or load
the apm modules with "allow_ints=1"). and try again.  If
this changes things, then we need to add the 8100 to the
list of things we automatically allow interrupts for.
The default from the very beginning has been to disable interrupts
and on most machines this works fine.  The option of leaving
interrupts enabled was introduced when we discovered that the
Thinkpads won't resume if you disable them ...
-- 
Cheers,
Stephen Rothwell                    sfr@canb.auug.org.au
http://www.canb.auug.org.au/~sfr/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/