Date: Tue, 13 May 2003 14:11:12 -0700 (PDT)
From: Matthew Jacob <>
Subject: [patch] 2.4 fix to allow vmalloc at interrupt time
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/5/13/340

This fixes a buglet wrt doing vmalloc at interrupt time for 2.4.
get_vm_area should call kmalloc with GFP_ATOMIC- after all, it's
set up to allow for an allocation failure. As best as I read
the 2.4 code, the rest of the path through _kmem_cache_alloc
should be safe.
===== vmalloc.c 1.15 vs edited =====
--- 1.15/mm/vmalloc.c	Wed Feb 12 05:30:56 2003
+++ edited/vmalloc.c	Fri May  9 23:42:09 2003
@@ -173,7 +173,7 @@
 	unsigned long addr, next;
 	struct vm_struct **p, *tmp, *area;
-	area = (struct vm_struct *) kmalloc(sizeof(*area), GFP_KERNEL);
+	area = (struct vm_struct *) kmalloc(sizeof(*area), GFP_ATOMIC);
 	if (!area)
 		return NULL;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/