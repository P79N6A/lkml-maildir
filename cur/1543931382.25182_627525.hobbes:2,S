Date: Thu, 13 Dec 2007 11:43:16 +0100
From: "Remy Bohmer" <>
Subject: Re: 2.6.23.9-rt13
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2007/12/13/168

Hello Steven,
If I compile -rt13 I get some compile warnings on ARM (AT91):
1) This one did not exist in rt1:
In file included from kernel/sched.c:911:
kernel/sched_rt.c: In function 'dec_rt_tasks':
kernel/sched_rt.c:88: warning: unused variable 'highest_prio'
2)  This one is there already for a much longer time:
CC      kernel/rcupreempt.o
kernel/rcupreempt.c:1001: warning: 'per_cpu__rcu_dyntick_snapshot'
defined but not used
Both warnings are fixed by the attached patch, but warning 2 needs some review.
This var is defined twice in this file, 1 in the NO_HZ ifdef, and 1
which seems to be not used.
Kind Regards,
Remy
2007/12/13, Steven Rostedt <rostedt@goodmis.org>:
> We are pleased to announce the 2.6.23.9-rt13 tree, which can be
> downloaded from the location:
>
> 
http://www.kernel.org/pub/linux/kernel/projects/rt/
>
> Changes since 2.6.23.9-rt12
>
>   - Backported the new RT Balancing code from sched-devel
>        New changes by Steven Rostedt, Gregory Haskins,
>         Ingo Molnar, and Dmitry Adamushko
>
>   - 2 dimension CPU Prio RT balancing search (Gregory Haskins)
>
>   - ARM compile fix (Kevin Hilman)
>
>   - Disable HPET legacy replacement for kdump (OGAWA Hirofumi)
>
>   - disable HPET on shutdown (OGAWA Hirofumi)
>
>   - fix for futex_wait signal stack corruption (Steven Rostedt)
>
>   - Handle IRQ_PENDING for simple irq thread (Steven Rostedt)
>
>   - latency tracer updates (Daniel Walker)
>
>   - Remove warning in local_bh_enable (Kevin Hilman)
>
>   - use real time pcp locking for page draining during cpu (Andi Kleen)
>
>   - Revert lazy disable irq from simple irq handler (Steven Rostedt)
>
>   - AT91 switch to edge from simple irq (Remy Bohmer)
>
>
> to build a 2.6.23.9-rt13 tree, the following patches should be applied:
>
>   
http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.23.9.tar.bz2
>   
http://www.kernel.org/pub/linux/kernel/projects/rt/patch-2.6.23.9-rt13.bz2
>
> And like always, my RT version of Matt Mackall's ketchup will get this
> for you nicely:
>
>   
http://people.redhat.com/srostedt/rt/tools/ketchup-0.9.8-rt2
>
>
> The broken out patches are also available.
>
> -- Steve
>
>
> -
> To unsubscribe from this list: send the line "unsubscribe linux-rt-users" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  
http://vger.kernel.org/majordomo-info.html
>
Fix a compile warning on -rt13, and UP (ARM AT91rm9200)
Signed-off-by: Remy Bohmer <linux@bohmer.net>
---
 kernel/rcupreempt.c |    2 --
 kernel/sched_rt.c   |    3 ++-
 2 files changed, 2 insertions(+), 3 deletions(-)
Index: linux-2.6.23/kernel/sched_rt.c
===================================================================
--- linux-2.6.23.orig/kernel/sched_rt.c	2007-12-13 10:59:54.000000000 +0100
+++ linux-2.6.23/kernel/sched_rt.c	2007-12-13 11:06:41.000000000 +0100
@@ -85,8 +85,9 @@ static inline void inc_rt_tasks(struct t
 
 static inline void dec_rt_tasks(struct task_struct *p, struct rq *rq)
 {
+#ifdef CONFIG_SMP
 	int highest_prio = rq->rt.highest_prio;
-
+#endif
 	WARN_ON(!rt_task(p));
 	WARN_ON(!rq->rt.rt_nr_running);
 	rq->rt.rt_nr_running--;
Index: linux-2.6.23/kernel/rcupreempt.c
===================================================================
--- linux-2.6.23.orig/kernel/rcupreempt.c	2007-12-13 10:59:54.000000000 +0100
+++ linux-2.6.23/kernel/rcupreempt.c	2007-12-13 11:38:28.000000000 +0100
@@ -998,8 +998,6 @@ void __init rcu_init_rt(void)
 	rcu_preempt_boost_init();
 }
 
-static DEFINE_PER_CPU(long, rcu_dyntick_snapshot);
-
 /*
  * Deprecated, use synchronize_rcu() or synchronize_sched() instead.
  */