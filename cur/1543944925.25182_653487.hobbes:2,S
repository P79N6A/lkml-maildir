Date: Thu, 14 Feb 2008 02:04:37 -0500
From: Christoph Hellwig <>
Subject: Re: [PATCH] sysv: [bl]e*_add_cpu conversion
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/14/41

On Wed, Feb 13, 2008 at 12:06:21AM +0100, marcin.slusarz@gmail.com wrote:
> From: Marcin Slusarz <marcin.slusarz@gmail.com>
> 
> replace all:
> big/little_endian_variable = cpu_to_[bl]eX([bl]eX_to_cpu(big/little_endian_variable) +
> 					expression_in_cpu_byteorder);
> with:
> 	[bl]eX_add_cpu(&big/little_endian_variable, expression_in_cpu_byteorder);
> generated with semantic patch
The patch looks correct to me, so ACK.
> diff --git a/fs/sysv/sysv.h b/fs/sysv/sysv.h
> index 42d51d1..38ebe3f 100644
> --- a/fs/sysv/sysv.h
> +++ b/fs/sysv/sysv.h
> @@ -217,9 +217,9 @@ static inline __fs32 fs32_add(struct sysv_sb_info *sbi, __fs32 *n, int d)
>  	if (sbi->s_bytesex == BYTESEX_PDP)
>  		*(__u32*)n = PDP_swab(PDP_swab(*(__u32*)n)+d);
>  	else if (sbi->s_bytesex == BYTESEX_LE)
> -		*(__le32*)n = cpu_to_le32(le32_to_cpu(*(__le32*)n)+d);
> +		le32_add_cpu((__le32 *)n, d);
>  	else
> -		*(__be32*)n = cpu_to_be32(be32_to_cpu(*(__be32*)n)+d);
> +		be32_add_cpu((__be32 *)n, d);
>  	return *n;
but now that you've named the be and le primitives *_add_cpu it would
be nice if you could submit a second patch to sysv to rename fs*_add
to fs*_add_cpu aswell.