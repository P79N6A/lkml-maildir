Date: Fri, 28 Feb 2003 00:29:35 -0800
From: Andrew Morton <>
Subject: Re: [PATCH] documentation for basic guide to profiling
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/2/28/24

"Martin J. Bligh" <mbligh@aracnet.com> wrote:
>
> ...
> +get readprofile binary fixed for 2.5 / akpm's 2.5 patch from 
> +
ftp://ftp.kernel.org/pub/linux/
       people/mbligh/tools/readprofile/
                                  kernel/
> +add "profile=2" to the kernel command line.
> +
> +clear		echo 2 > /proc/profile
> +		<test>
> +dump output	readprofile -m /boot/System.map > catured_profile
util-linux-2.11z (at least) has the fixed readprofile.
Of course, installing standard util-linux turns your boot process
into a complete mess because vendors have added incompatible features
to their versions.  But it seems to struggle through.
> +Oprofile
> +--------
> +get source (I use 0.5) from 
http://oprofile.sourceforge.net/
> +add "poll=idle" to the kernel command line 
> +Configure with CONFIG_PROFILING=y and CONFIG_OPROFILE=y & reboot on new kernel
> +./configure --with-kernel-support
> +make install
> +
> +One time setup (pick appropriate one for your CPU):
> +P3		opcontrol --setup --vmlinux=/boot/vmlinux \
> +		--ctr0-event=CPU_CLK_UNHALTED --ctr0-count=100000
> +Athalon		opcontrol --setup --vmlinux=/boot/vmlinux \
   Athlon
> +		--ctr0-event=RETIRED_INSNS --ctr0-count=100000
> +P4		opcontrol --setup --vmlinux=/boot/vmlinux \
> +		--ctr0-event=GLOBAL_POWER_EVENTS \
> +		--ctr0-unit-mask=1 --ctr0-count=100000
> +
> +start daemon	opcontrol --start-daemon
> +clear		opcontrol --reset
> +start		opcontrol --start
> +		<test>
> +stop		opcontrol --stop
> +dump output	oprofpp -dl -i /boot/vmlinux  >  output_file
> +
OK.  Might be worth adding a pointer to this in REPORTING-BUGS, but
nobody reads that anyway.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/