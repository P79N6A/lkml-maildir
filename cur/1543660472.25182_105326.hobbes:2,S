Date: Thu, 23 Jan 2003 19:47:44 +0100
From: "Mario 'BitKoenig' Holbe" <>
Subject: 2.4.x: ide: smart ioctl() doesnt work...
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/1/23/103

Holla,
It seems, that it isn't possible to enable the SMART
Automatic Offline Test anymore with 2.4.x (I tried
2.4.13 and 2.4.20).
And additionally: Enabling an already enabled Automatic
Offline Test with 2.4.x disables it.
Switching back to 2.2.20 I was able to re-enable it.
I tried this with different tools: ide-smart, smartsuite,
smartmontools and had a look at their sources, but they
all use the same ioctl():
__u8 args[4] = {WIN_SMART, 0xF8, SMART_AUTO_OFFLINE, 0};
ioctl(fd, HDIO_DRIVE_CMD, &args);
The ioctl() returns no error, but it doesn't do anything:
root@darkside:~# uname -a
Linux darkside 2.4.20 #1 Thu Dec 5 23:17:41 CET 2002 i686 unknown unknown GNU/Linux
root@darkside:~# ide-smart /dev/hdb | grep AutoOff
OffLineStatus=130 {Completed}, AutoOffLine=No, OffLineTimeout=0 minutes
root@darkside:~# ide-smart -1 /dev/hdb
root@darkside:~# ide-smart /dev/hdb | grep AutoOff
OffLineStatus=130 {Completed}, AutoOffLine=No, OffLineTimeout=0 minutes
and:
root@darkside:~# ide-smart /dev/hdc | grep AutoOff
OffLineStatus=130 {Completed}, AutoOffLine=Yes, OffLineTimeout=38 minutes
root@darkside:~# ide-smart -1 /dev/hdc
root@darkside:~# ide-smart /dev/hdc | grep AutoOff
OffLineStatus=130 {Completed}, AutoOffLine=No, OffLineTimeout=38 minutes
Booting 2.2.20 I'm able to enable AutoOffLine via ide-smart -1.
I searched through the archives but didnt find anything
matching this...
Is this a known problem?
Did the ioctl() change somehow?
Am I able to work around it on a currently running 2.4 system?
And btw... Am I able to change the OffLineTimeout value somehow?
PS: Please CC: me in replies, since I'm not on the list.
regards,
   Mario
-- 
Ho ho ho! I am Santa Claus of Borg. Nice assimilation all together!
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/