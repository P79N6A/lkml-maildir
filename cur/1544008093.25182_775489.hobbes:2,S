Date: Mon, 01 Dec 2008 12:50:15 -0500
From: Andrew Gallatin <>
Subject: Re: [PATCH] lro: IP fragment checking
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/1/231

Jan-Bernd Themann wrote:
> This patch prevents that ip fragmented TCP packets are considered vaild
> for aggregation
<...>
> +	if (iph->frag_off & IP_MF)
> +		return -1;
> +
I think there is an endian bug, and that you should also check
IP_OFFSET.  What about:
	if (iph->frag_off & htons(IP_MF|IP_OFFSET))
As to whether or not to do it in the drivers/hardware or in the
LRO code, I favor doing it in the LRO code just so that it is not
missed in some driver.
Drew