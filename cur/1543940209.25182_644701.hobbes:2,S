Date: Mon, 28 Jan 2008 17:30:47 -0500
From: Jarod Wilson <>
Subject: Re: [PATCH update] firewire: fix "kobject_add failed for fw* with -EEXIST"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/1/28/467

On Sunday 27 January 2008 12:20:40 pm Stefan Richter wrote:
> There is a race between shutdown and creation of devices:  fw-core may
> attempt to add a device with the same name of an already existing
> device.  
http://bugzilla.kernel.org/show_bug.cgi?id=9828
>
> Impact of the bug:  Happens rarely, forces the user to unplug and replug
> the new device to get it working.
>
> The fix moves deregistration of the minor number and device_unregister()
> into a common rw_sem protected section.
>
> We also move the ref count increment from fw_device_op_open into an
> rw_sem protected section with the lookup of the device, so that the
> device pointer can't become invalid between lookup and usage.
>
> Signed-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>
While I've got remaining issues with firewire mdraid, this does appear fix the 
problem of devices racing the grab the same fw* device node, and it seems 
obvious that should indeed be the case from the code changes.
Signed-off-by: Jarod Wilson <jwilson@redhat.com>
-- 
Jarod Wilson
jwilson@redhat.com