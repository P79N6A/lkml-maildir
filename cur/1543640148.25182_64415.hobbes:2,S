Date: Thu, 15 Aug 2002 15:58:26 +0100
From: Matthew Wilcox <>
Subject: [PATCH] lockd shouldn't call posix_unblock_lock here
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2002/8/15/198

nlmsvc_notify_blocked() is only called via the fl_notify() pointer which
is only called immediately after we already did a locks_delete_block(),
so calling posix_unblock_lock() here is always a NOP.  Please apply.
diff -urpNX dontdiff linux-2.5.31/fs/lockd/svclock.c linux-2.5.31-willy/fs/lockd/svclock.c
--- linux-2.5.31/fs/lockd/svclock.c	2002-08-01 14:16:16.000000000 -0700
+++ linux-2.5.31-willy/fs/lockd/svclock.c	2002-08-15 07:32:19.000000000 -0700
@@ -472,7 +472,6 @@ nlmsvc_notify_blocked(struct file_lock *
 	struct nlm_block	**bp, *block;
 
 	dprintk("lockd: VFS unblock notification for block %p\n", fl);
-	posix_unblock_lock(fl);
 	for (bp = &nlm_blocked; (block = *bp); bp = &block->b_next) {
 		if (nlm_compare_locks(&block->b_call.a_args.lock.fl, fl)) {
 			nlmsvc_insert_block(block, 0);
-- 
Revolutions do not require corporate support.
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/