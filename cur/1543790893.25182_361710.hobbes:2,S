Date: Mon, 31 Oct 2005 16:38:43 +1100
From: Paul Mackerras <>
Subject: Fix drivers/macintosh/adbhid.c stupid breakage
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/10/31/7

Commit c7f7a569d9b4ea7c53ab6fcd1377895312d8372b ("[PATCH] Input:
convert drivers/macintosh to dynamic input_dev allocation") breaks any
machine with an ADB keyboard or mouse, which includes my G4
powerbook.  Was it given any testing at all?
The problem is that adbhid[]->input is NULL, so the kernel oopses with
a null pointer dereference as soon as I press a key.  The following
patch fixes it.
Signed-off-by: Paul Mackerras <paulus@samba.org>
---
diff -urN powerpc-merge/drivers/macintosh/adbhid.c merge-hack/drivers/macintosh/adbhid.c
--- powerpc-merge/drivers/macintosh/adbhid.c	2005-10-31 13:15:26.000000000 +1100
+++ merge-hack/drivers/macintosh/adbhid.c	2005-10-31 16:30:31.000000000 +1100
@@ -723,6 +723,7 @@
 
 	sprintf(hid->phys, "adb%d:%d.%02x/input", id, default_id, original_handler_id);
 
+	hid->input = input_dev;
 	hid->id = default_id;
 	hid->original_handler_id = original_handler_id;
 	hid->current_handler_id = current_handler_id;
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/