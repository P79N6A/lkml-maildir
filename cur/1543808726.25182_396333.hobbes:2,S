Date: Mon, 13 Feb 2006 02:27:57 +0100
From: Diego Calleja <>
Subject: AGP serverworks chipset not being initializated properly?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/2/12/196

For a while, I've been having this on my dmesg:
agpgart: Xorg tried to set rate=x12. Setting to AGP3 x8 mode.
agpgart: Putting AGP V2 device at 0000:00:00.1 into 2x mode
agpgart: Putting AGP V2 device at 0000:01:00.0 into 2x mode
[drm] Loading R200 Microcode
This is really weird since my motherboard (CNB20HE chipset)
only supports 2x AGP cards and my xorg.conf file has this: 
Section "Device"
        Identifier      "RADEON9200SE"
        Driver          "radeon"
        Option     "AGPMode" "2"
EndSection
Looking at the code I found out that the code path being run  to get
this printk is:
------------------------------------------------------------------
    /* Check to see if we are operating in 3.0 mode */
    if (agp_bridge->mode & AGPSTAT_MODE_3_0)     
	agp_v3_parse_one(&requested_mode, &bridge_agpstat, &vga_agpstat); <----------
    else
	agp_v2_parse_one(&requested_mode, &bridge_agpstat, &vga_agpstat);
------------------------------------------------------------------
so it looks like agp_brige->mode is not being initializated properly, it is
sworks-agp.c:serverworks_configure() who initializates it in my box so
something has to be wrong with one of these 2 lines?:
------------------------------------------------------------------
        agp_bridge->capndx = pci_find_capability(serverworks_private.svrwrks_dev, PCI_CAP_ID_AGP);
        /* Fill in the mode register */
        pci_read_config_dword(serverworks_private.svrwrks_dev,
                              agp_bridge->capndx+PCI_AGP_STATUS, &agp_bridge->mode);
------------------------------------------------------------------
What is going on, is this a know bug, should I just ignore it (it doesn't
harms anything), file a bugzilla bug? My dmesg says:
Linux agpgart interface v0.101 (c) Dave Jones
agpgart: AGP aperture is 128M @ 0xd0000000
agpgart: Detected ServerWorks CNB20HE chipset: No AGP present.
agpgart: Detected ServerWorks CNB20HE chipset: No AGP present.
Full lspci output is included. 
[unhandled content-type:application/octet-stream]