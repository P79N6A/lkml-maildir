Date: Tue, 13 Jun 2006 21:54:46 +0200
From: Andreas Mohr <>
Subject: [PATCH -mm] i386 syscall opcode reordering (pipelining)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/6/13/182

Hi all,
I'd guess that this version features improved pipeline parallelism,
since we isolate competing %ebx accesses (_syscall4()) and
stack push operations (_syscall5()), right?
Signed-off-by: Andreas Mohr <andi@lisas.de>
diff -urN linux-2.6.17-rc6-mm2.orig/include/asm-i386/unistd.h linux-2.6.17-rc6-mm2.my/include/asm-i386/unistd.h
--- linux-2.6.17-rc6-mm2.orig/include/asm-i386/unistd.h	2006-06-13 19:28:15.000000000 +0200
+++ linux-2.6.17-rc6-mm2.my/include/asm-i386/unistd.h	2006-06-13 19:40:07.000000000 +0200
@@ -400,7 +400,7 @@
 type name (type1 arg1,type2 arg2,type3 arg3,type4 arg4,type5 arg5) \
 { \
 long __res; \
-__asm__ volatile ("push %%ebx ; movl %2,%%ebx ; movl %1,%%eax ; " \
+__asm__ volatile ("push %%ebx ; movl %1,%%eax ; movl %2,%%ebx ; " \
                   "int $0x80 ; pop %%ebx" \
 	: "=a" (__res) \
 	: "i" (__NR_##name),"ri" ((long)(arg1)),"c" ((long)(arg2)), \
@@ -415,8 +415,8 @@
 { \
 long __res; \
   struct { long __a1; long __a6; } __s = { (long)arg1, (long)arg6 }; \
-__asm__ volatile ("push %%ebp ; push %%ebx ; movl 4(%2),%%ebp ; " \
-                  "movl 0(%2),%%ebx ; movl %1,%%eax ; int $0x80 ; " \
+__asm__ volatile ("push %%ebp ; movl %1,%%eax ; push %%ebx ; " \
+                  "movl 4(%2),%%ebp ; movl 0(%2),%%ebx ; int $0x80 ; " \
                   "pop %%ebx ;  pop %%ebp" \
 	: "=a" (__res) \
 	: "i" (__NR_##name),"0" ((long)(&__s)),"c" ((long)(arg2)), \
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/