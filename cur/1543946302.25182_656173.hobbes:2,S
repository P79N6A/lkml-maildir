Date: Tue, 19 Feb 2008 14:53:35 +0100
From: Omar Schiaratura <>
Subject: sun neptune driver
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/19/183

Hi all,
i'm trying to write a back-porting of the Sun neptune NIC driver(niu module) in kernel 2.6.24 to the kernel 2.6.20
because i need that driver in a xen linux environment.
The driver now compile and goes up clearly, NIC is configured, but doesn't work properly.
If i send packets to another machine with the same NIC and kernel 2.6.24,I saw with tcpdump that the packets was received and the answer was sent,
but at the other end (kernel 2.6.20 with my backported driver, and without XEN) nothing appens (tcpdump report sent packages, but i can't see anything sent from other side)
Do you have some tricks for me or can you suggest me something to do?
Some of the problem i encountered during port is that i can't find a function equivalent to compound_head, and if i port it to the source i can't find a way to use
an equivalent variable like page->first_page found in compound_head.
another proble was the folowing function:
static inline unsigned char *skb_transport_header(const struct sk_buff *skb)
{
        return (unsigned char *)((unsigned int)skb->head + (unsigned int)skb->h.raw);
}
that get the error: "error: invalid operands to binary +"
if i can't cast it in unsigned int, the same in skb_network_header (both back-ported from include/skbuff.h)
thanks,
Omar