Date: Thu, 14 Feb 2008 18:50:52 +1100
From: Jeremy Fitzhardinge <>
Subject: Re: 2.6.25-rc1 xen pvops regression
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/2/14/55

Joel Becker wrote:
> On Wed, Feb 13, 2008 at 10:59:33PM +1100, Jeremy Fitzhardinge wrote:
> 
>>> I thought I'd try out 2.6.25-rc1 as a xen 32-bit pae domU the other day.
>>> Unfortunately, I didn't get very far very fast, as the domain just crashed
>>> immediately upon booting, without any direct feedback (I did have messages
>>> on the xen message buffer, which helped). This even with earlyprintk turned on.
>>>
>>> After a long, arduous journey, I managed to track this down to the following:
>>>
>>> ----------
>>> commit	551889a6e2a24a9c06fd453ea03b57b7746ffdc0
>>> 
>
> 	I'm seeing the same problem, with no messages at all from xen
> other than "domain crashed, restart disabled" in xend.log.  I got a
> different commit in my bisect, 0947b2f31ca1ea1211d3cde2dbd8fcec579ef395
> (i386 boot: replace boot_io    remap with enhanced bt_ioremap - enhance
> bt_ioremap).  I started from yesterday's
> 96b5a46e2a72dc1829370c87053e0cd558d58bc0 (WMI: initialize
> wmi_blocks.list even if ACPI is disabled) and a known good
> 9b73e76f3cf63379dcf45fcd4f112f5812418d0a (Merge
> git://git.kernel.org/pub/scm/linux/kernel/git/jejb/scsi-misc-2.6).
>
> 
>> Although I'm on vacation, I happened to download a recent copy of  
>> x86.git and found that it crashes early.  Here's a couple of patches to  
>> apply; I don't know if they apply to current git, but I hope it helps.
>> 
>
> 
>> Subject: x86/early_ioremap: don't assume we're using swapper_pg_dir
>> Subject: xen: unpin initial Xen pagetable once we're finished with it
>> 
>
> 	After my bisect was done, I re-pulled from Linus and discovered
> these patches.  Searching for these emails, they certainly sound like my
> problem.  But the kernel does not boot, commit
> 10270d4838bdc493781f5a1cf2e90e9c34c9142f (acpi: fix
> acpi_os_read_pci_configuration() misuse of raw_pci_read()).  Still no
> output from Xen - pygrub selects the kernel, and then the domain just
> dies back to the dom0 shell.
> 	Attached are my latest .config and my bisect log.
> 
Is the domain ending up in the crashed state?  Do you get a register 
dump with xm dmesg?  That would be very useful in determining what went 
wrong.  You may need to compile Xen with debug=y in Config.mk.
    J