Date: Mon, 15 Dec 2003 22:00:08 +0100
From: Emilio Gargiulo <>
Subject: Re: 2.4.24-pre1 hangs with XFS on LVM filesystem full
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/12/15/178

Yes, a simple overfill of a XFS filesystem on LVM hangs the kernel.
It is easy to reproduce with dd if=/dev/zero of=file_on_dest_xfs_filesystem 
bs=1024k.
It was full reproducible with 2.4.24-pre1.
Is also reproduceable on 2.4.23 + XFS snapshot-2.4.23-2003-12-01_00:33_UTC 
patch.
It is reproduceable on LVM and on simple partition like /dev/hda10.
It is NOT reproduceable with other filesystems (reiserfs, ext3, jfs).
I compiled the kernel with gcc 3.2.3. (Slackware 9.1)
I am unable to reproduce the problem if I compile the kernel with gcc 3.3.1.
Also is not reproduceable on small XFS filesystem (if the filesystem is 
smaller than system RAM). It seems a VMM related problem....
When hang the num-lock key change the led status.
I will try to use KDB...
Thanks
Emilio Gargiulo
Alle 06:11, domenica 14 dicembre 2003, Eric Sandeen ha scritto:
> So you are seeing a hang when you (over)fill the filesystem, if
> I understand correctly?  If there is any chance that you could
> test it with XFS to a normal disk (no LVM) or with some other
> filesystem with LVM, that might help to narrow down the problem.
> Nightly XFS QA tests do check ENOSPC conditions, but perhaps
> there is bad interaction with LVM.
>
> You could also get a CVS kernel from oss.sgi.com, or apply
> the KDB patch you your kernel, and enter kdb when the system
> freezes.  Then you could look at backtraces of the relevant
> processes to get an idea of where things are stuck.
>
> -Eric
>
> On Sat, 13 Dec 2003, Emilio Gargiulo wrote:
> > Hi
> > There is a severe XFS problem with kernel 2.4.24-pre1. If you try to copy
> > a file in a XFS filesystem on LVM bigger than free spaces, the Linux Box
> > will hang. No messages, no warnings, it just freeze. It happens also if
> > the filesystem was not the root filesystem.
> > The problem is fully reproducible on 2 different computer, an old
> > K6/400MHz and a P4/2,4GHz.
> >
> > If i can do something for address the issue, please tell me.
> > Thanks
> > Emilio Gargiulo
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/