Date: Fri, 17 Nov 2006 15:54:43 +0300
From: Vasily Averin <>
Subject: Re: [Q] workaround for ide (native) leads to irq storm?
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/11/17/88

Vasily Averin wrote:
> Tejun Heo wrote:
>> Vasily Averin wrote:
>>> I've reproduced this issue on linux 2.6.19-rc5 kernel.
>>>
>>> Please see 
http://bugzilla.kernel.org/show_bug.cgi?id=7518
 for details
>>
>> Fortunately, libata is immune to the problem because it does 
>> ap->ops->irq_clear(ap) in ata_host_intr() regardless of command type in 
>> flight.  So, not loading IDE piix and using libata to drive all piix 
>> ports solves the problem.
> 
> I've disabled IDE support in the config and recompiled the kernel.
> It seems you are right, problem go away, new kernel was booted without any
> problems and works well.
> 
> As a linux support engeneer I've seen this issue several times on the user-nodes
> and it was very hard to understand what's happened and how to prevent this issue
> in the future. First question is resolved now but from support point of view it
> is very important to find some workaround against this issue on existing
> distributions. Right now I see only one way: if this issue is detected on the
> user node, we can add something like "ide=disable" into kernel commandline.
I've tried to find the some work around for this issue. "hda=noprobe" helps, CD
is not detected on the node and all other devices on the node works well...
However if I have additional device who uses the same irq the issue returns
back. When I enable USB support on my testnode, one of USB controllers requests
the same IRQ line. And IRQ storm occurs again when I load uhci_hcd driver on the
node. It is very strange for me: we do not have any IDE devices in this case.
I would note, that I've seen the same behaviour when I detach the CDROM manually.
I've updated the bug.
Thank you,
	Vasily Averin
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/