Date: Fri, 2 Jun 2006 15:56:30 +0200
From: Ingo Molnar <>
Subject: [patch, -rc5-mm2] lock validator: early_boot_irqs_[on|off]() build fix
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2006/6/2/145

Subject: lock validator: early_boot_irqs_[on|off]() build fix
From: Ingo Molnar <mingo@elte.hu>
fix build bug if CONFIG_TRACE_IRQFLAGS is off: the existence of
early_boot_irqs_[on|off]() depends on CONFIG_TRACE_IRQFLAGS,
not on CONFIG_LOCKDEP.
Signed-off-by: Ingo Molnar <mingo@elte.hu>
---
 include/linux/lockdep.h |   13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)
Index: linux/include/linux/lockdep.h
===================================================================
--- linux.orig/include/linux/lockdep.h
+++ linux/include/linux/lockdep.h
@@ -210,9 +210,6 @@ extern void lockdep_release(struct lockd
 
 # define INIT_LOCKDEP				.lockdep_recursion = 0,
 
-extern void early_boot_irqs_off(void);
-extern void early_boot_irqs_on(void);
-
 #else /* LOCKDEP */
 # define lockdep_init()				do { } while (0)
 # define lockdep_info()				do { } while (0)
@@ -222,14 +219,20 @@ extern void early_boot_irqs_on(void);
 # define INIT_LOCKDEP
 # define lockdep_reset()		do { debug_locks = 1; } while (0)
 # define lockdep_free_key_range(start, size)	do { } while (0)
-# define early_boot_irqs_off()			do { } while (0)
-# define early_boot_irqs_on()			do { } while (0)
 /*
  * The type key takes no space if lockdep is disabled:
  */
 struct lockdep_type_key { };
 #endif /* !LOCKDEP */
 
+#ifdef CONFIG_TRACE_IRQFLAGS
+extern void early_boot_irqs_off(void);
+extern void early_boot_irqs_on(void);
+#else
+# define early_boot_irqs_off()			do { } while (0)
+# define early_boot_irqs_on()			do { } while (0)
+#endif
+
 /*
  * For trivial one-depth nesting of a lock-type, the following
  * global define can be used. (Subsystems with multiple levels
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/