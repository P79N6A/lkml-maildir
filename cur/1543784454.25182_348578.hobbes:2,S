Date: Fri, 9 Sep 2005 13:36:33 +0300
From: Pekka Enberg <>
Subject: Re: [PATCH 2/25] NTFS: Allow highmem kmalloc() in ntfs_malloc_nofs() and add _nofail() version.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2005/9/9/105

On 9/9/05, Anton Altaparmakov <aia21@cam.ac.uk> wrote:
> -static inline void *ntfs_malloc_nofs(unsigned long size)
> +static inline void *__ntfs_malloc(unsigned long size,
> +               unsigned int __nocast gfp_mask)
>  {
>         if (likely(size <= PAGE_SIZE)) {
>                 BUG_ON(!size);
>                 /* kmalloc() has per-CPU caches so is faster for now. */
> -               return kmalloc(PAGE_SIZE, GFP_NOFS);
> -               /* return (void *)__get_free_page(GFP_NOFS | __GFP_HIGHMEM); */
> +               return kmalloc(PAGE_SIZE, gfp_mask);
> +               /* return (void *)__get_free_page(gfp_mask); */
>         }
>         if (likely(size >> PAGE_SHIFT < num_physpages))
> -               return __vmalloc(size, GFP_NOFS | __GFP_HIGHMEM, PAGE_KERNEL);
> +               return __vmalloc(size, gfp_mask, PAGE_KERNEL);
Unrelated to this patch but why do you have this wrapper instead of
using kmalloc() where you can and__vmalloc() where you really have to?
                                     Pekka
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/