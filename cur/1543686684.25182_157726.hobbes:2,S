Date: Fri, 15 Aug 2003 14:14:19 -0400
From: Jason Lunz <>
Subject: Re: pivot_root solved by patch to 2.4.22-pre7
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/8/15/151

In gmane.linux.kernel, you wrote:
>> the unshare_files change causes init to no longer share the same fd table
>> with the other kernel threads. thus, when init closes or opens fds it does
> 
> Ah yes.. because of do_basic_setup. Having /sbin/init sharing with
> kernel threads doesn't actually strike me as too clever anyway although
> none of them should be using fd stuff.
> 
> In which case I guess we should call unshare_files directly before we
> open /dev/console in init/main.c.
Is this going to be fixed for 2.4.22? In -rc2, I still get this after
pivot_root (I'm using pivot_root, but not initrd):
	halfoat:0:~ # umount /mnt
	umount: /mnt: device is busy
	halfoat:1:~ # lsof /mnt
	COMMAND   PID USER   FD   TYPE DEVICE SIZE NODE NAME
	keventd     2 root    0u   CHR    5,1        21 /mnt/dev/console
	keventd     2 root    1u   CHR    5,1        21 /mnt/dev/console
	keventd     2 root    2u   CHR    5,1        21 /mnt/dev/console
	ksoftirqd   3 root    0u   CHR    5,1        21 /mnt/dev/console
	ksoftirqd   3 root    1u   CHR    5,1        21 /mnt/dev/console
	ksoftirqd   3 root    2u   CHR    5,1        21 /mnt/dev/console
	ksoftirqd   4 root    0u   CHR    5,1        21 /mnt/dev/console
	ksoftirqd   4 root    1u   CHR    5,1        21 /mnt/dev/console
	ksoftirqd   4 root    2u   CHR    5,1        21 /mnt/dev/console
	kswapd      5 root    0u   CHR    5,1        21 /mnt/dev/console
	kswapd      5 root    1u   CHR    5,1        21 /mnt/dev/console
	kswapd      5 root    2u   CHR    5,1        21 /mnt/dev/console
	bdflush     6 root    0u   CHR    5,1        21 /mnt/dev/console
	bdflush     6 root    1u   CHR    5,1        21 /mnt/dev/console
	bdflush     6 root    2u   CHR    5,1        21 /mnt/dev/console
	kupdated    7 root    0u   CHR    5,1        21 /mnt/dev/console
	kupdated    7 root    1u   CHR    5,1        21 /mnt/dev/console
	kupdated    7 root    2u   CHR    5,1        21 /mnt/dev/console
	kjournald  64 root    0u   CHR    5,1        21 /mnt/dev/console
	kjournald  64 root    1u   CHR    5,1        21 /mnt/dev/console
	kjournald  64 root    2u   CHR    5,1        21 /mnt/dev/console
Jason
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/