Date: Mon, 15 Dec 2008 18:26:03 +0000
From: "Chen, Justin" <>
Subject: RE: PCI BAR mem resource allocation "regression"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2008/12/15/194

>-----Original Message-----
>From: Chiang, Alexander
>
>> Also, is it just the error message, or does it actually affect
>> functionality?
>
>Hm, that is a good question. ;) The particular device I was
>testing with was an infiniband device, and I have never actually
>pushed any traffic over it; just used it to reproduce the error.
>
>I can try and hook the card up to something and push traffic over
>it, but that will have to wait until Monday. Maybe Justin (cc'ed)
>knows, since he was the one who first reported this to me.
It affects functionality.  The BAR is not reprogrammed after hotplug.  Below is an example:
Original lspci dump:
------------------------------
002b:01:00.0 Ethernet controller: Intel Corporation 82571EB Gigabit Ethernet Controller (rev 06)
        Subsystem: Hewlett-Packard Company: Unknown device 704f
        Flags: bus master, fast devsel, latency 0, IRQ 61
        Memory at 00000f7200000000 (32-bit, non-prefetchable) [size=128K]
        Memory at 00000f7200020000 (32-bit, non-prefetchable) [size=128K]
        I/O ports at e000 [size=32]
        Expansion ROM at 00000f7200040000 [disabled] [size=128K]
        Capabilities: [c8] Power Management version 2
        Capabilities: [d0] Message Signalled Interrupts: 64bit+ Queue=0/0 Enable-
        Capabilities: [e0] #10 [0001]
Mainline lspci after remove/hotplug the device:
------------------------------------------------------------------
002b:01:00.0 Ethernet controller: Intel Corporation 82571EB Gigabit Ethernet Controller (rev 06)
        Subsystem: Hewlett-Packard Company: Unknown device 704f
        Flags: fast devsel, IRQ 61
        I/O ports at <unassigned> [disabled]
        Capabilities: [c8] Power Management version 2
        Capabilities: [d0] Message Signalled Interrupts: 64bit+ Queue=0/0 Enable-
        Capabilities: [e0] #10 [0001]
Revert lspci after remove/hotplug the device:
---------------------------------------------------------------
002b:01:00.0 Ethernet controller: Intel Corporation 82571EB Gigabit Ethernet Controller (rev 06)
        Subsystem: Hewlett-Packard Company: Unknown device 704f
        Flags: bus master, fast devsel, latency 0, IRQ 61
        Memory at 00000f7200000000 (32-bit, non-prefetchable) [size=128K]
        Memory at 00000f7200020000 (32-bit, non-prefetchable) [size=128K]
        I/O ports at e000 [size=32]
        Expansion ROM at 00000f7200040000 [disabled] [size=128K]
        Capabilities: [c8] Power Management version 2
        Capabilities: [d0] Message Signalled Interrupts: 64bit+ Queue=0/0 Enable-
        Capabilities: [e0] #10 [0001]
Thanks,
Justin