Date: Fri, 7 Mar 2003 18:29:14 -0500
From: Pete Zaitcev <>
Subject: Re: Fwd: [PATCH] s390 (1/7): s390 arch fixes.
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
X-Lkml-Link: https://lkml.org/lkml/2003/3/7/347

> --- linux-2.5.64/arch/s390/kernel/time.c	Wed Mar  5 04:28:53 2003
> +++ linux-2.5.64-s390/arch/s390/kernel/time.c	Fri Mar  7 11:40:12 2003
> @@ -202,14 +203,14 @@
>  	unsigned long cr0;
>  	__u64 timer;
> 
> +	timer = jiffies_timer_cc + jiffies_64 * CLK_TICKS_PER_JIFFY;
> +	S390_lowcore.jiffy_timer = timer;
> +	timer += CLK_TICKS_PER_JIFFY + CPU_DEVIATION;
> +	asm volatile ("SCKC %0" : : "m" (timer));
>          /* allow clock comparator timer interrupt */
>          asm volatile ("STCTL 0,0,%0" : "=m" (cr0) : : "memory");
>          cr0 |= 0x800;
>          asm volatile ("LCTL 0,0,%0" : : "m" (cr0) : "memory");
> -	timer = init_timer_cc + jiffies_64 * CLK_TICKS_PER_JIFFY;
> -	S390_lowcore.jiffy_timer = timer;
> -	timer += CLK_TICKS_PER_JIFFY + CPU_DEVIATION;
> -	asm volatile ("SCKC %0" : : "m" (timer));
>  }
> 
>  /*
This is a good fix, I confirm it fixing my booting problem ...
on 2.4! Seriously, I can't believe it worked before.
Please send it to Marcelo, too.
-- Pete
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  
http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  
http://www.tux.org/lkml/